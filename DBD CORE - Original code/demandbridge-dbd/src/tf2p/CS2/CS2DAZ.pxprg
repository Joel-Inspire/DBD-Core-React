0010 REM "Get next Requisition Number <CS2DAZ>
0035 REM "3.3 - 12/17/90 - 11.37
0040 REM "Copyright 1990 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0110 REM "F0 IF FMP FILE SLOT
0120 ENTER X3$,X4$,F0,F9$,X$
0500 REM "CHECK FOR FILE OPEN
0520 IF F0=0 THEN DIM Z[NUM(X3$(60,3))]; Z$="01O FMP... "; GOSUB 9750; F0=Z[1]
7700 REM "AUTO REQ NUMBER
7710 EXTRACT RECORD (F0,KEY=F9$(1,11))F9$
7712 X$=F9$(214,10),X=POS("#"=X$),O9=POS("#"<>X$(X))-1; DIM X$(O9,"9"),Z1$(10,"0"); O8=NUM(X$)
7715 Z=NUM(F9$(205,9))+1; IF Z>O8 THEN Z=1
7718 F9$(205,9)=STR(Z:Z1$(1,9))
7720 WRITE RECORD (F0,KEY=F9$(1,11))F9$
7730 X$=F9$(214,10),P=POS("@"=X$); IF P>0 THEN X$(P,3)=X3$(40,3)
7735 P=POS("#"=X$),X$(P,O9)=STR(Z:Z1$(1,O9))
7795 GOTO 9900
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9740 RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 Y8=2
9910 IF Y0$>"" THEN CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},Z0,Z1
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9999 END 
