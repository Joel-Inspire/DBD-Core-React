0010 REM "Repository Code Print <ZR2RBA>
0025 REM "(C) Copyright 1986 - All Rights Reserved
0035 REM "5.3 - 03/21/05 - 10.513055 - jir - SSP# 182297
0040 REM "Copyright 2005 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="ZR2RBA",X1$="Repository Report"
0120 DIM A$(227),A[4],B$(145),B[4],C$(100),C[4],S0$(40)
0140 Z0$="#,###"
0160 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
0210 T=1,T0=1,T1=1
0220 W3=131
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3)
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0300 REM "I/O lists
0305 REM "IOLIST FOR AP4 - Vendor Masterfile
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4]
0315 REM "IOLIST FOR AP6 - Vendor Lookup Sort
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4]
0330 IOLIST C$,C[0],C[1],C[2]
0340 IOLIST D$
0420 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01O ZR1...  03O ZR0...  040 AR1...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0530 READ (Z[3],KEY=V0$(73,10))IOL=0330
0600 REM "Set line length based on params
0620 REM "LET W3=C[0]
0630 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3)
0700 REM "Open Printer
0720 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0721,9920
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 T9=(POS(" "=V0$(107,20))-1)/2
0820 DIM U[T9]
0825 U=0,U[0]=0,U0=0
0830 FOR I=1 TO T9
0835 U[I]=NUM(V0$(105+2*I,2)),U=U+U[I],U0=U0+1
0840 NEXT I
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0987 V4$=V0$(73,10)+V4$
0990 READ (U1,KEY=V4$,DOM=0991)
1000 REM "Read next record
1005 U$=KEY(U1,END=5000)
1006 REM "check key against range info"
1007 IF U$(1,10)<>V0$(73,10) THEN GOTO 5000
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2+10,U[U9])>=V2$(U3,U[U9]) THEN GOTO 1030 ELSE READ (U1,KEY=U$(1,U2-1+10)+V2$(U3,U[U9]),DOM=1021)
1025 EXITTO 1000
1030 IF U$(U2+10,U[U9])<=V2$(U3+U[U9],U[U9]) THEN GOTO 1040 ELSE READ (U1,KEY=U$(1,U2-1+10)+$FF$,DOM=1032)
1035 EXITTO 1000
1040 NEXT U9
1100 REM "Get record"
1110 U9$=U$
1150 READ (Z[1],KEY=U9$,DOM=1000)IOL=0310
1200 REM "Check other parameters/options
1210 IF POS(V0$(83,1)="YR")<>0 AND POS(" "<>A$(109,6))<>0 THEN GOTO 1000; REM "If print only unprinted, and the last printed date is set, then skip it.
1220 IF V0$(83,1)="R" THEN IF LEN(A$)<121 THEN GOTO 1000 ELSE READ (Z[13],KEY="R/L"+A$(119,3),DOM=1000)J$; IF J$(10,1)<>"2" OR J$(9,1)="Y" THEN GOTO 1000; REM "IF 'R' in the print unprinted field, then check source company and skip companies that are not really remote (j$(10,1)<>"2") or that print their invoices on-site(j$(9,1)="Y")
1300 REM "Make sure the correct file is open for this document
1305 IF A$(96,8)=F0$ THEN GOTO 1325
1310 IF F0$<>"" THEN Z$="02C "+F0$+" " ELSE Z$=""
1315 Z$=Z$+"02O "+A$(96,8)+" ",F0$=A$(96,8)
1320 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
1500 REM "Print Data
1505 REM "Loop thru lines for this doc, printing each one
1510 P0=1,L0=1; REM "P0=current page, L0=the line we are fixin' to print on
1515 IF W+1>W0 THEN GOSUB 6000
1520 READ (Z[4],KEY=A$(11,10),DOM=1521)IOL=0340
1530 REM "READ (Z[2],END=01900) IOL=00320; IF B$(1,5)<>A$(104,5) THEN GOTO 01900
1560 GOSUB 2000
1590 GOSUB 7300
1900 REM "Accumulate Totals"
1950 T[0,1]=T[0,1]+A[0]
1960 REM "Set date & time last printed.
1965 REM "LET A$(109,6)=X3$(21,6), T9=TIM, A$(115,4)=STR(INT(T9):"00")+STR(FPT(T9)*100:"00")
1970 REM "WRITE (Z[1],KEY=U9$) IOL=00310
1995 GOTO 1000
2000 REM "Print a line on the item
2010 REM "IF NUM(B$(6,4))>P0 THEN GOSUB 02300; GOTO 02010
2030 REM "IF NUM(B$(10,3))>L0 THEN GOSUB 02350; GOTO 02030; REM "ADD BLANK LINES THAT MAY HAVE BEEN SKIPPED
2035 IF A$(1,10)="AR_INVOICE" THEN Y5$(2)="Customer code: ",Y5$(17)=A$(11,10),Y5$(30)=D$(11,35),Y5$(70)="Invoice #: ",Y5$(81)=A$(21,8),Y5$(100)="Version: ",Y5$(109)=A$(51,2) ELSE IF A$(1,10)="DETAIL_JRL" OR A$(1,10)="SALES_JRNL" THEN Y5$(2)="Date: ",Y5$(17)=FND$(A$(11,6)),Y5$(70)="Audit ctl #: ",Y5$(84)=A$(17,6),Y5$(100)="Version: ",Y5$(109)=A$(51,2)
2040 GOSUB 7300
2045 Y5$(2)=FND$(A$(53,6)),Y5$(13)=FNT$(A$(59,4)),Y5$(22)=A$(63,3),Y5$(28)=A$(66,30),Y5$(60)=A$(96,8),Y5$(69)=A$(104,5),Y5$(78)=FND$(A$(109,6)),Y5$(89)=FNT$(A$(115,4)),Y5$(100)=FND$(A$(122,6)),Y5$(111)=FNT$(A$(128,4)),Y5$(123)=STR(A[0]:Z0$),Y5$(130)=$0A$
2050 REM "GOSUB 02350
2095 RETURN 
2300 REM "Finish old page, prepare for next
2305 REM "Check to see if reprint words have not been printed yet, if so go down and print them
2310 IF NUM(V0$(84,3))>=L0 THEN GOSUB 2350; GOTO 2310; REM "Print extra lines if needed
2330 IF C$(77,1)="Y" THEN IF V3$(2,2)<>"T " THEN PRINT (W9)'FF',
2340 P0=P0+1,L0=1
2345 RETURN 
2350 REM "Print a line, possibly including 'reprint' words and inc L0
2360 IF NUM(V0$(84,3))=L0 THEN Y5$(INT(W3/2-LEN(FNS$(V0$(87,20)))/2),LEN(FNS$(V0$(87,20))))=FNS$(V0$(87,20))
2370 GOSUB 7300
2380 L0=L0+1
2385 IF V3$(2,2)="T " THEN IF W>20 THEN PRINT (W9)'LF','LF',; CALL "ZZPROM",".5",X3$,Z0,"","","",0; IF Z0=1 THEN GOTO 9900 ELSE W=1
2395 RETURN 
5000 REM "End of Print
5020 IF W8=0 THEN GOTO 5290
5030 T0$="END"
5040 IF V1>0 THEN GOSUB 3120
5050 T=0,T$="Report"; GOSUB 7000
5200 REM "
5290 GOTO 9900
6000 REM "Page header
6035 IF T0$="END" THEN W0$=""
6040 CALL "ZZHEAD",X0$,X1$,X2$,X3$,W0$,W1$,W2$,W3$,W3,W,W9,W8,W0,W5,W2,W4$,W5$
6045 IF T0$="END" THEN GOTO 6060 ELSE ON W5 GOTO 6046,9900
6060 GOSUB 6100
6070 GOSUB 7300
6090 RETURN 
6100 REM "Print Column Headings
6115 Y5$(59)=A$(1,10)+$0A$
6120 GOSUB 7300
6140 Y5$(2)="Deposit at",Y5$(22)="By",Y5$(28)="Description",Y5$(60)="File Name/Index",Y5$(78)="Date/Time lst prted",Y5$(100)="Date/Time Sec. Arch.",Y5$(123)="Pages"
6145 GOSUB 7300
6199 RETURN 
7000 REM "Totaling for pages
7005 IF W+3>W0 THEN GOSUB 6000
7010 Y5$(100)=$0A$+"Total Pages: ",Y5$(124)=STR(T[0,1]:Z0$)
7030 GOSUB 7300
7099 RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+2
7330 IF Y5$=Y6$ THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; DIM Y5$(W3)
7390 IF W>=W0 THEN GOSUB 6000
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"   ")-1)
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7525 REM "Modified stmts:
7550 REM "Added stmts:
7575 REM "Deleted stmts:
8900 REM 
8910 DEF FNS$(Z9$)=Z9$(1,POS(S0$=Z9$+S0$)-1)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "End program
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9925 IF %GUI THEN CALL Y4$,ERR=*NEXT
9927 IF %GUI THEN EXIT 
9930 IF Y4$<>"" THEN RUN Y4$,ERR=9931
9940 RUN "ZMENU"
9999 END 
