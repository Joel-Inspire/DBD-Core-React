0010 REM "Check Req Maximum <FS2DAH>
0020 SETESC 9300; SETERR 9000
0035 REM "4.1 - 07/14/98 - 16.36 - dmm - SSP# 094880
0040 REM "Copyright 1997 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 REM "K$(1,20)=Cust/Item, (21,5)=ship to code/location, (1,1)="!" means coming from CS2DAB and no operation options allowed, (1,1)="?" means coming from FO2UBA, no prompt display
0051 REM "Can't use Inventory Committed since it is not by shipping location, only storing location.  Left in just in case needed somehow later.
0090 CLEAR ; SETERR 0100; ENTER X3$,K$,Q,Z
0100 SETERR 9000
0110 X0$="FS2DAH"
0120 IF K$(1,1)="!" OR K$(1,1)="?" THEN F0$=K$(1,1),K$=K$(2)
0200 IF LEN(K$)=8 THEN GOTO 0291
0210 IF K$(21,1)<>"C" THEN GOTO 9900
0220 IF K$(22,4)="    " THEN GOTO 9900
0290 K$=K$(1,20)+K$(22)
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21],B[22],B[23],B[24],B[25],B[26],B[27],B[28],B[29]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4]
0350 IOLIST E$,E9$,E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="02O FS2...  03O PO3...  05O FM4...  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0605 FIND (Z[13],KEY=X3$(9,3)+"F/M")OPS_PARM$
0910 DIM E[15],B[29],C[4],S0$(80)
0990 Z=99
0995 IF LEN(K$)=8 THEN GOTO 2000
1000 REM 
1020 READ (Z[5],KEY=K$,DOM=1021)IOL=0350
1050 IF E[10]=0 OR Q=0 THEN GOTO 9900
1060 IF Q+E[5]<=E[10] THEN GOTO 9900
1070 IF F0$="?" THEN Z=1; GOTO 9900
1080 IF F0$="!" THEN CALL "ZZPROM",".4",X3$,0,"Sorry, location's monthly requisition maximum exceeded.  Try ordering less.","","",0; Z=0; GOTO 9900
1090 IF OPS_PARM$(262,1)="Y" THEN MESSAGE$="WARNING: Req Maximum of "+STR(E[10])+" Exceeded for this Location-DELETE LINE?" ELSE MESSAGE$="WARNING: Requisition Maximum Exceeded for this Location-DELETE LINE?"
1100 CALL "ZZPROM",".Y",X3$,Z,MESSAGE$,"","",0
1900 GOTO 9900
2000 REM "Called from Order Entry - check all lines
2020 READ (Z[2],KEY=K$,DOM=2021)
2040 READ (Z[2],END=9900)IOL=0320
2060 IF B$(147,8)<>K$ THEN GOTO 9900
2080 IF B$(155,1)<>"C" THEN GOTO 2040
2100 IF B$(18,1)="Y" THEN GOTO 2300
2120 READ (Z[3],KEY=K$+S0$(1,5),DOM=2040)IOL=0330
2140 IF C$(11,1)<>"C" THEN GOTO 2040
2150 Q=B[0]
2160 GOSUB 2500
2180 GOTO 2040
2300 REM "Special Ship
2320 READ (Z[3],KEY=K$+" "+B$(6,3),DOM=2321)
2340 READ (Z[3],END=2040)IOL=0330
2360 IF C$(166,9)+C$(7,3)<>K$+" "+B$(6,3) THEN GOTO 2040
2389 Q=C[0]
2400 GOSUB 2500
2490 GOTO 2340
2500 REM " Check it
2510 IF Q=0 OR C$(12,4)="    " THEN GOTO 2690
2520 READ (Z[5],KEY=B$(161,10)+B$(19,10)+C$(12,4),DOM=2690)IOL=0350
2540 IF E[10]=0 THEN GOTO 2690
2550 REM PRINT 'CS',"Q=",Q,"  E(5)=",E(5),"  E(10)=",E(10); INPUT *,
2560 IF Q+E[5]<=E[10] THEN GOTO 2690
2580 IF OPS_PARM$(262,1)="Y" THEN X$="Req Max of "+STR(E[10])+" exceeded for line "+B$(6,3)+". Item: "+B$(19,10) ELSE X$="Requisition Max exceeded for line "+B$(6,3)+". Item: "+B$(19,10)
2600 CALL "ZZPROM",".4",X3$,Z,X$,"","",0
2690 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "END PROGRAM
9905 PRINT @(0,22),'CE',
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
