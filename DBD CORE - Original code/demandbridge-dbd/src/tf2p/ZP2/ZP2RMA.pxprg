0010 REM "Telemarketing Mailing Label Printing <ZP2RMA>
0035 REM "5.2 - 09/25/03 - 10.744722 - tma - SSP# 164744
0040 REM "Copyright 2003 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0100 SETERR 9000; SETESC 9300
0110 X0$="ZP2RMA",X1$="Telemarketing Mailing Label Printing"
0120 DIM A$(439),A[1],I[19],S$(40)
0140 Z0$="##,###,###.00-"
0170 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0175 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0180 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
0190 DEF FNE$(Z9$)=STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0210 T=1,T0=1,T1=1
0215 REM "SET W0 TO 24 FOR CSI LABEL"
0220 W3=79,P8=8
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0300 REM "I/O lists
0305 REM "IOLIST FOR AR1 - Customer Masterfile
0310 IOLIST A$,L0
0320 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15],I[16],I[17],I[18],I[19]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6]
0340 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6]
0380 IOLIST C1$,C[0],C[1]
0420 IOLIST X3$,X4$,V1$,V3$,V2$,IOL=0425
0425 IOLIST V$,V[0],V[1]
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01L ZP8...  02O ZP9...  03O ZY3...  04O ZY4...  06O ZY2...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0700 REM "Open Printer
0720 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0721,9920
0725 PRINT (W9)""
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[1]; U=4,U0=1,U[0]=0,U[1]=4,T0=0,U0$="    ",T5$="                "; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0920 GOSUB 4800
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
1000 REM "Read next record
1005 U$=KEY(U1,END=5000); READ (U1)
1010 U3=1,U2=1
1020 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1030 IF U$(U2,U[U9])<V2$(U3,U[U9]) THEN READ (U1,END=5000); EXITTO 1000
1040 IF U$(U2,U[U9])>V2$(U3+U[U9],U[U9]) THEN IF U=1 THEN EXITTO 5000 ELSE READ (U1,END=5000); EXITTO 1000
1050 NEXT U9
1100 REM "Get record
1110 U9$=U$
1130 READ (Z[1],KEY=U$,DOM=1000)IOL=0310
1135 IF Q9=1 AND A$(204,3)="   " THEN REMOVE (Z[1],KEY=U$,DOM=1000); GOTO 1000
1140 IF POS("M"=A$(204,3))=0 THEN GOTO 1000
1144 REM "If in remove mode, and we printed this label and If all of the codes have been printed, then remove the record
1145 IF Q9=1 THEN IF POS("M"=A$(84,3))<>0 AND A$(84,3)=A$(204,3) THEN REMOVE (Z[1],KEY=U$,DOM=1000); GOTO 1000 ELSE GOTO 1000
1160 IF V$(87,1)="Y" AND POS("M"=A$(84,3))<>0 THEN GOTO 1000; REM "Skip printed inmailing labels if option is set
1520 GOSUB 4000
1530 W8=W8+1
1900 REM "Accumulate Totals"
1990 T[T0,0]=T[T0,0]+1
1995 P=POS("M"=A$(204,3)),A$(84+P-1,1)="M"; WRITE (Z[1],KEY=U$)IOL=0310
1999 GOTO 1000
3100 REM "Subtotal logic goes here, see -ZREPS
3180 RETURN 
4010 IF F9=W0 THEN GOSUB 6000
4015 Y5$(1)=A$(311,40); GOSUB 7300
4025 Y5$(1)=A$(16,40); GOSUB 7300
4030 Y5$(1)=A$(111,30); GOSUB 7300
4035 IF POS(" "<>A$(141,30))>0 THEN Y5$(1)=A$(141,30); GOSUB 7300
4040 CALL "ZZDISP","AX",A$(189,9),"ZIP",X3$,X$,"",0,0,X4$
4045 Y5$(1)=FNS$(A$(56,28))+",  "+A$(187,2)+"    "+X$; GOSUB 7300
4250 IF F9=W0 THEN GOSUB 6000
4260 F9=F9+1,W=0
4290 RETURN 
4700 REM "CHANGE FORMAT
4720 CALL "ZZ2PDA",X3$,X4$,Q0$,Q1$
4730 READ (Z[13],KEY=Q1$,DOM=4700)F0$
4800 REM "TEST PATTERN
4805 W=0,W0=NUM(F0$(51,1)),F0=NUM(F0$(49,2))+NUM(F0$(54,1)),F1=F0*W0,F2=NUM(F0$(52,2))+NUM(F0$(55,1)),F9=0,Q$="+("+FNS$(F0$(7,40))+")",F8=NUM(F0$(47,2)); DIM F9$(F1*F2)
4810 CALL "ZZPROM","L1ZZPRIN",X3$,S3,Q$,"","",0; ON S3 GOTO 4990,4811,4700,9900
4820 DIM A$(LEN(A$),"*")
4840 FOR X=1 TO NUM(F0$(51,1))
4850 GOSUB 4000
4860 NEXT X
4865 GOSUB 6000
4895 GOTO 4810
4900 REM 
4995 RETURN 
5000 REM "End of Print
5005 IF Q9=1 THEN GOSUB 5700; GOTO 9916
5010 IF F9>0 THEN GOSUB 6000
5015 GOTO 9900
5025 CALL "ZZPROM","Y",X3$,S3,"Do you wish to update the Telemarketing Letter files?","","",0
5030 ON S3 GOTO 5040,9916
5200 Q9=1; GOTO 0990
5290 GOTO 9916
5295 GOTO 9900
5700 REM "If file is empty except for the "" record, then reinit all letter files
5705 READ (Z[1],KEY="",DOM=5795); REM "If no "" record, then we are done
5710 K$=KEY(Z[1],END=5711); GOTO 5795; REM "if other records exist, don't fix the "" record, or clear the files, just leave
5712 REM "If here, then only the "" record exists, there are no letters left, init all files
5715 CALL "ZZINIT",STR(Z[1]:"00")+STR(Z[2]:"00")
5795 RETURN 
6000 REM "PRINT LABELS
6040 FOR X=0 TO F2-1
6050 PRINT (W9)@(F8),F9$(X*F1+1,F1)
6060 NEXT X
6070 REM 
6085 F9=0; DIM F9$(F1*F2)
6090 RETURN 
6100 REM "
6195 IF FID(W9)=FID(0) THEN PRINT 'SF',
6199 RETURN 
6900 REM "SORT
6905 IF S9$="X" THEN GOTO 6990 ELSE S0=Z[1],S1=Z[2]
6940 CALL "ZZSORT",X3$,"",V1$,S9$,"","",0,0,0,S0,S1,X9
6955 IF S9$="X" THEN GOTO 6990 ELSE S0=Z[1],S1=Z[2]
6970 CALL "ZZSORT",X3$,"",V1$,S9$,"","",0,0,0,S0,S1,S9; ON S9 GOTO 6971,9920
6990 RETURN 
7000 REM "Totals logic
7001 IF T=T0 THEN IF T[T0,0]<2 THEN GOSUB 7300; GOTO 7100
7002 IF W+3>W0 THEN GOSUB 6000
7003 GOTO 7190
7005 IF T=T0 THEN IF T[T0,0]<2 THEN GOSUB 7300; GOTO 7100
7007 IF W+3>W0 THEN GOSUB 6000
7010 Y5$(1)=T3$(1,T0+1-T)+" "
7015 IF T$<>"" THEN Y5$(T0+2-T)=T$+" "+Q2$+" ("+STR(T[T,0]:"0")+"):"
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7200; GOTO 7190
7095 GOSUB 7300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7205 GOSUB 7300; Y5$(1)=Q1$+": "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 T4$=STR(INT(T2):"##0")
7230 T3=INT(FPT(T2)*3600)
7240 T3=T3/60
7250 T4$=T4$+":"+STR(T3:"00")
7260 Y5$(1)=Q3$+": "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7305 IF Y5$(1,LEN(S$))=S$ THEN GOTO 7395
7310 F9$(F9*F0+W*F1+1,F0)=Y5$
7320 REM 
7390 W=W+1
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     13O ZZPARM  "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7435 DIM V[1]
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7460 READ (Z[13],KEY="LABEL"+V3$(17,1),DOM=7461)F0$; GOTO 7465
7462 CALL "ZZPROM","L0ZZPRIN",X3$,0,"","","",0; GOTO 9900
7465 W0=NUM(F0$(51,1))
7480 X3$(178,7)=Y4$,V0=NUM(V$(71,1)),W3$=V$(19,POS("   "=V$(19,40)+"  ")-1)
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7525 REM "Modified stmts:
7550 REM "Added stmts:
7575 REM "Deleted stmts:
7600 REM "USE PROFILE
7620 U$=KEY(Z[4],END=5000); READ (Z[4])
7640 U$=U$(1,4)+U$(30,6)
7650 U9$=U$
7690 GOTO 1150
8950 DEF FNQ$(Z9,Z9$)=STR(Z9:Z9$)
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "End program
9905 W8=0; REM "To prevent formfeed
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9915 GOTO 5020
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 IF Y4$<>"" THEN RUN Y4$,ERR=9931
9940 RUN "ZMENU"
9999 END 
