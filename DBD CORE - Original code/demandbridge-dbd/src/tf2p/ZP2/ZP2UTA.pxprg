0010 REM "Write ASCII File into T/M <ZP2UTA>
0035 REM "3.9 - 03/22/96 - 13.82 - tma & dmm
0040 REM "Copyright 1996 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 BEGIN 
0105 SETERR 9000
0110 X0$="ZP2UTA",X1$="Merge ASCII Fax File into T/M"
0120 DIM S$(20),Z0$(80,"-")
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O ZP4...  02O ZPA... "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0680 GOSUB 6000
0690 Z$="03O "+F0$
0695 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0696,9900
0720 CALL "ZZPROM","Y",X3$,S3,"Continue?","","",0; ON S3 GOTO 0721,9900
0920 X9$=$0D0A$
1020 P=POS(X9$=A$); IF P=0 THEN READ RECORD (Z[3],END=5000)X$; A$=A$+X$; GOTO 1000
1040 Q$=A$(1,P-1),A$=A$(P+LEN(X9$))
1050 R0=R0+1,F0=0
1070 DIM F0$(1210)
1100 REM "
1120 GOSUB 4400
1130 Q$=Q$+","+$22$
1200 REM "RECORD
1202 IF F0=39 THEN GOTO 2000
1205 P=POS($22$+","=Q$+","+$22$); IF P=0 THEN ESCAPE ELSE Q9$=Q$(1,P),Q$=Q$(P+2); GOTO 1250
1210 IF Q$="" THEN GOTO 2000
1220 CALL "ZA2UAB",Q$,Q9$,Q
1225 IF Q$>"" THEN CALL "ZA2UAB",Q$,X$,Q; IF Q<>1 OR X$<>"," THEN ESCAPE 
1250 REM "Strip off quotes
1260 IF Q9$(1,1)<>$22$ THEN ESCAPE ELSE Q9$=Q9$(2),Q9$=Q9$(1,LEN(Q9$)-1)
1265 F0$(F0*30+1,30)=Q9$,F0=F0+1
1280 GOSUB 4000
1290 GOTO 1200
1990 GOTO 1000
2000 REM "
2020 GOSUB 4500
2040 WRITE (Z[1],KEY=B$(1,10))B$
2042 WRITE (Z[2],KEY=B$(1,4)+B$(150,10)+B$(5,6))
2045 Q1$=A$
2050 PRINT @(0,8),'LD',@(0,18),B$(1,75),
2090 GOTO 1000
4000 REM "Place field based on F0 field number
4010 IF F0=4 THEN B$(11,40)=Q9$; GOTO 4290
4040 IF F0=39 THEN P=POS("-"=Q9$); IF P>0 THEN Q9$=Q9$(1,P-1)+Q9$(P+1); GOTO 4040 ELSE B$(138,10)=Q9$; GOTO 4290
4290 RETURN 
4400 REM "DEFAULT RECORD
4410 B$=D9$
4420 B$(5,6)=STR(R1:"000000"),R1=R1+1
4495 RETURN 
4500 REM "AFTER THE FACT
4510 Q$=FNS$(B$(11,40)); IF Q$="" THEN GOTO 4590
4515 FOR X=LEN(Q$) TO 1 STEP -1; IF Q$(X,1)=" " THEN EXITTO 4520 ELSE NEXT X; GOTO 4590
4520 Z9$=Q$(X+1); CALL "YUCASE",X3$,Z9$,Q$
4540 B$(150,10)=Q$
4600 REM "
4690 RETURN 
5000 REM "
5080 GOTO 9900
6000 REM 
6010 PRINT @(0,7),'SB',Z0$
6020 INPUT @(0,3),'CL',"Enter the file name: ",Q$; IF Q$="" THEN GOTO 9900
6030 CLOSE (14); OPEN (14,ERR=6035)Q$; F0$=Q$; CLOSE (14); GOTO 6050
6035 Q$="FILE "+Q$+" NOT FOUND ("+STR(ERR)+")"; CALL "ZZPROM",".4",X3$,0,Q$,"","",0; GOTO 6000
6050 REM "ENTER LIST CODE
6060 INPUT @(0,5),'CL',"Enter the list code to update: ",D9$; D9$=D9$+"    "; D9$=D9$(1,4)
6080 READ (Z[1],KEY=D9$(1,4)+"000000",DOM=6081)D9$; GOTO 6100
6085 Q$="There must be a default contact with code 0000 for this list.  Press Enter: "; CALL "ZZPROM",".4",X3$,0,Q$,"","",0; GOTO 9900
6100 R1=1
6190 RETURN 
8905 DEF FNS$(Z9$)=Z9$(1,POS(S$=Z9$+S$)-1)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9740 RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 Y8=2
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
