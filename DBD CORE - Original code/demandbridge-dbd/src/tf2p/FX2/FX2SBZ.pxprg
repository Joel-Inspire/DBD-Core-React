0010 REM "Pass output file to spooler <FX2SBB> OLD VERSION
0035 REM "4.1 - 12/10/97 - 17.62 - kmc - SSP# 092618
0040 REM "Copyright 1997 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
1015 REM "F0=OUTPUT DEVICE
1016 REM "T0$=TAG1, T1$=TAG2
1019 REM " R0$=FAX DEVICE, R1$=ID NUMBER, R2$=PHONE NUMBER
1020 ENTER X3$,F0,T0$,T1$,R0$,R1$,R2$,X9
1021 REM 
1024 REM "Just in case, just call new version and leave
1025 CALL "FX2SBB",X3$,F0,T0$,T1$,R0$,R1$,R2$,X9; GOTO 9900
1040 R0$="",R1$="",R2$=""
1050 X9=-1
1110 S7$="TMPFX"+FID(0)
1112 ERASE S7$,ERR=1113; GOTO 1112
1115 S8$="/usr/vsifax/bin/fx"
1120 S9$=">/usr/lib/pvx/UTILS/TMPFX"+FID(0)
1130 D0$="/tmp/"
1135 D1$="/usr/lib/pvx/UTILS/"
1138 F0$=FID(F0); IF LEN(F0$)<>2 THEN GOTO 9800
1140 F0$="PRN."+FID(0)+F0$
1200 REM "BUILD UNIX COMMAND STRING
1210 GOSUB 7000; F8$=F9$
1215 S0$="PATH=$PATH:/usr/vsifax/bin:/usr/vsifax/spool; export PATH;"
1230 S0$=S0$+"cat "+F8$
1240 S0$=S0$+"|"+S8$+" -Fmac "
1250 IF T0$>"" THEN S0$=S0$+" -t tag1="+$22$+T0$+$22$
1255 IF T1$>"" THEN S0$=S0$+" -t tag2="+$22$+T1$+$22$
1260 S0$=S0$+" -N "
1280 S0$=S0$+S9$
1400 REM 
2000 REM "SEND INFO TO FAX SPOOLER
2040 INVOKE S0$
2100 REM "RETRIEVE Rx$ DATA
2120 GOSUB 7030
2140 F7$=F9$
2150 Q$="Fax Request id ",P=POS(Q$=F7$); IF P<>1 THEN GOTO 9800
2155 F7$=F7$(LEN(Q$)+1)
2160 P=POS("-"=F7$),R0$=F7$(1,P-1),F7$=F7$(P+1)
2165 P=POS(" "=F7$),R1$=F7$(1,P-1),F7$=F7$(P+1)
2170 REM "NUMBER IS IN PARENS
2175 F7$=F7$(2),P=LEN(F7$),R2$=F7$(1,P-1)
2200 REM 
3000 REM "CLOSE OUTPUT DEVICE
3020 CLOSE (F0)
4000 REM 
4090 GOTO 9900
7000 REM "GET TEMP FILE NAME FROM D0$ DIRECTORY IN F9$
7020 Q$="umask 0; ls "+D0$+F0$+"*"+">"+D1$+S7$
7025 INVOKE Q$
7030 CLOSE (14); OPEN (14)S7$
7040 READ RECORD (14,END=9800)F9$
7045 IF POS($00$<>F9$)=0 THEN GOTO 9800
7050 P=POS($0A$=F9$); IF P=0 THEN GOTO 9800 ELSE F9$=F9$(1,P-1)
7090 CLOSE (14)
7095 RETURN 
9800 REM 
9840 GOTO 9940
9900 REM 
9920 X9=0
9940 EXIT 
9980 CLOSE (14)
9985 ERASE S7$,ERR=9986
9999 END 
