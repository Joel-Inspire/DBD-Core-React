0010 REM "Remote T/M Output <RT2OUT>
0015 REM "Prog Type: IP-3.1.2
0020 SETESC 9300; SETERR 9000
0035 REM "3.9 - 06/10/96 - 11.11 - kmc
0040 REM "Copyright 1995 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0070 REM "C is command - 0 = init file in A$
0071 REM "      1 = Write record A$ to file with command C$
0072 REM "      2 = Flush buffer to disk
0075 REM "F is file slot, file is open on
0076 REM "A$ is data
0077 REM "B$ is buffer for use by program, don't touch
0078 REM "C$ is command for data in record A$
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,C,F,A$,C$,B$
0100 SETERR 9000
0110 X0$="RT2OUT",X1$="Remote Telemarketing Output"
0120 DIM S$(40)
0130 REM Bas_Sep$ is basic field seperator
0131 REM tilde$ is pkg field sep
0132 REM PKG_SEP$ is pkg record sep
0140 BAS_SEP$=$8A$,TILDE$=$7E$,PKG_SEP$=$0A$
0300 REM "IOLISTS
0900 REM 
0905 ON C GOTO INITIALIZE_FILE,WRITE_RECORD,FLUSH_BUFFER_2_DISK,9900
1000 INITIALIZE_FILE:
1005 B$=""; REM "Clear buffer
1010 CLOSE (14)
1020 ERASE A$,ERR=*NEXT
1055 D0$=%DATAPATH$
1060 SERIAL A$,0,0
1095 END_INITIALIZE_FILE:GOTO 9900
1100 WRITE_RECORD:REM "write record to pkg with command C$ and data D$
1101 REM "Field seps are turned into tildes in A$ first, then an CRC is cal"+          "culated and added to the end of the command (C$)+ data (A$). Fina"+          "lly the overall length is computed and added to the front
1105 B1$=A$
1110 P=POS(BAS_SEP$=B1$)
1111 WHILE P
1112 B1$(P,1)=TILDE$
1113 P=POS(BAS_SEP$=B1$) REM "Change field seps to tildes
1114 WEND 
1120 B1$=C$+B1$
1121 B1$=B1$+HTA(CRC(B1$))+PKG_SEP$
1130 B1$=STR(LEN(B1$):"00000")+B1$
1160 GOSUB ADD_DATA_2_BUFFER
1195 END_WRITE_RECORD:GOTO 9900
1200 FLUSH_BUFFER_2_DISK:
1210 WRITE RECORD (F)B$; B$=""
1295 GOTO 9900
7700 ADD_DATA_2_BUFFER:
7705 REM if B$>16384 bytes then write out 16384 bytes chunks
7710 B$=B$+B1$
7715 IF LEN(B$)>16384 THEN {
7720 WRITE RECORD (F)B$(1,16384)
7725 B$=B$(16385)
7730 GOTO 7715
7740  }
7745 END_ADD_DATA_2_BUFFER:RETURN 
8910 DEF FNA$(Z9$)=Z9$(1,POS("     "=Z9$+"     ")-1)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9740 RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
