0010 REM "Gather Salesperson/Div Info <EI2UAA>
0015 REM "Prog Type: I -2.9     
0020 SETESC 9300; SETERR 9000
0035 REM "4.4 - 04/06/00 - 11.05 - tma - SSP# 123872
0040 REM "Copyright 2000 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000; SETESC 9300
0110 X0$="EI2UAA",X1$="Gather Salesperson/Div Info",K9$="",K9=0
0120 DIM Z0$(80,"-")
0130 K0=4,K1=1
0135 C9=-1,V9=-2
0140 M0$="#,###,##0-",M1$="###.00%-"
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(65,1)>"2" THEN PRECISION NUM(X3$(65,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7]
0340 IOLIST D$
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8]
0365 IOLIST F$,F[0],F[1]
0400 REM "GET E/I Info - added 400-460 by cwj 6/22/98 ssp#091686
0405 DIM Z[NUM(X3$(60,3))]
0410 Z$="13O ZZPARM  "
0415 GOSUB 9750; ON Z0 GOTO 0416,9900
0420 FIND (13,KEY=X3$(9,3)+"E/I")E0$
0425 IF E0$(7,1)<>"Y" THEN E1$="..."; GOTO 0500 ELSE E1$=X3$(40,3)
0430 OPEN (1,ERR=0435)"EI0"+E1$; CLOSE (1); GOTO 0450
0435 IF ERR=12 THEN DIRECT "EI0"+E1$,4,0,228,0,0; GOTO 0450
0440 GOTO 9000
0450 OPEN (1,ERR=0455)"EI1"+E1$; CLOSE (1); GOTO 0480
0455 IF ERR=12 THEN DIRECT "EI1"+E1$,4,0,280,0,0; GOTO 0480
0460 GOTO 9000
0500 REM "Files - cwj 6/22/98 mod to 510 ssp#091686 adding E1$
0510 Z$="01L EI0"+E1$+"  02L EI1"+E1$+"  04O AR3...  05O ARA...  06O FSA...  07O FSD...  13O ZZPARM  "
0520 GOSUB 9750; ON Z0 GOTO 0521,9900
0530 READ (Z[13],KEY=X3$(9,3)+"A/R")P0$
0540 READ (Z[1],KEY="",DOM=0541)P$
0550 READ (Z[13],KEY="STATAR3")S5$
0600 REM "
0610 A9$=P0$(7,6)
0620 GOSUB 7500
1000 REM "
1040 GOSUB 6000; GOSUB 6200
1060 GOTO 2000
1800 REM "
1820 CALL "ZZPROM","0",X3$,Z,"Proceed with gathering of data for Executive Information System","","V",X0; ON Z GOTO 2500,9900,2000
2000 REM "DATA SEQ
2010 C0=0,X0=-1,X1=1
2020 SETERR 9000; X$="",Q$="",C0=ABS(C0),X0=X0+1; IF C0=2 THEN IF X0>0 THEN X0=X0-2
2025 IF INT(C0)=3 THEN GOSUB 7300 ELSE IF C0>3 OR X0<0 THEN GOTO 1800
2035 IF V9<>-2 THEN IF 6*(X0+K1)+5<LEN(V9$) THEN IF V9$((X0+K1)*6+5,1)="3" THEN GOTO 2020 ELSE IF V9$((X0+K1)*6+5,1)="2" AND C0<>2 THEN GOTO 2020
2038 IF X0<LEN(V7$) THEN V7$(X0+1,1)=""
2040 ON X0 GOTO 2100,2150,1800
2100 REM "Fiscal Year
2110 CALL "ZZENTR","Z",A{ALL},A9$,X4$,X3$,18,6,1,4,C0,"","{3"+X$,"","EI2UAA02","","",""
2120 GOSUB 7500; IF G$="" THEN GOTO 2110
2140 GOTO 2020
2150 REM "Accounting Period
2160 CALL "ZZENTR","Z",A{ALL},A9$,X4$,X3$,43,6,5,2,C0,"","{3"+X$,"","EI2UAA04","","",""
2170 IF A9$(5,2)<"01" OR A9$(5,2)>"13" THEN GOTO 2160
2180 GOSUB 7530; GOSUB 7550
2190 GOTO 2020
2500 REM "Start Gathering of Statistics
2505 PRINT @(10,12),"Gathering of Statistics in Progress........",
2510 CALL "ZZINIT",STR(Z[1]:"00")+STR(Z[2]:"00")
2515 REM "Set up records in EI0 from Salesperson file
2520 READ (Z[4],KEY="",DOM=2521)
2530 READ (Z[4],END=3000)IOL=0340
2540 DIM A$(50),A[7]
2550 A$(1,4)=D$(1,4),A$(5,2)=D$(235,2)
2555 REM "Invoiced Orders - Sales
2560 F0=Z[5],S9$=S5$,Q1$=D$(1,4)+A9$(1,4),Q0$="S"; GOSUB 7100
2570 A[4]=A[0]+P[1],A[6]=A[2]+P[0]
2585 REM "Invoiced Orders - Profit
2590 Q0$="P"; GOSUB 7100
2610 A[5]=A[5]+P[1],A[7]=A[7]+P[0]
2635 REM "Orders Booked - Sales
2640 Q0$="B"; GOSUB 7100
2660 A[0]=A[0]+P[1],A[2]=A[2]+P[0]
2675 REM "Orders Booked - Profit
2680 Q0$="D"; GOSUB 7110
2700 A[1]=A[1]+P[1],A[3]=A[3]+P[0]
2780 WRITE (Z[1],KEY=A$(1,4))IOL=0310
2790 GOTO 2530
3000 REM "Obtain Booking from FSA Daily booking file (What about F(8)?)
3010 DIM F[8],A$(50)
3020 READ (Z[6],KEY="",DOM=3021)
3040 K$=KEY(Z[6],END=3150); READ (Z[6],KEY=K$)IOL=0360
3045 IF K$<>F$(1,LEN(K$)) THEN GOTO 3040
3050 IF F$(3,6)>G1$ THEN GOTO 3040
3060 FOR I=0 TO 4
3070 IF POS(" "<>F$(28+I*4,4))=0 OR F[I]=0 THEN GOTO 3085
3075 IF F$(28+I*4,4)<>A$(1,4) THEN GOSUB 3100
3080 X=F[5]*F[I]*.01,A[0]=A[0]+X,A[2]=A[2]+X,I1=F[6]*F[I]*.01,A[1]=A[1]+X-I1,A[3]=A[3]+X-I1
3085 NEXT I
3090 GOTO 3040
3100 REM 
3110 IF A$(1,4)<>DIM(4) THEN WRITE (Z[1],KEY=A$(1,4))IOL=0310
3120 IF F$<>"END" THEN DIM A$(50),A[7]; READ (Z[1],KEY=F$(28+I*4,4),DOM=3121)IOL=0310
3140 RETURN 
3150 REM "END OF FSA
3160 F$="END"; GOSUB 3100
3200 REM "Obtain Booking from FSD Monthly Order Booking
3220 DIM F[1],A$(0)
3230 READ (Z[7],KEY="",DOM=3231)
3240 KEY$=KEY(Z[7],END=3400); READ (Z[7],KEY=KEY$)IOL=0365
3245 IF KEY$<>F$(1,LEN(KEY$)) THEN GOTO 3240
3250 IF F$(7,6)>G1$ OR F$(3,1)="z" THEN GOTO 3240
3260 IF A$="" OR F$(3,4)<>A$(1,4) THEN GOSUB 3350
3270 A[0]=A[0]+F[0],A[1]=A[1]+F[0]-F[1],A[2]=A[2]+F[0],A[3]=A[3]+F[0]-F[1]
3290 GOTO 3240
3350 REM "Only update when salesperson changes
3360 IF A$<>"" THEN WRITE (Z[1],KEY=A$(1,4))IOL=0310
3370 IF F$<>"END" THEN DIM A$(50),A[7]; READ (Z[1],KEY=F$(3,4),DOM=3371)IOL=0310
3390 RETURN 
3400 REM "END OF FSD
3420 F$="END"; GOSUB 3350
3800 REM "Build Division Totals in EI1
3810 READ (Z[1],KEY="",DOM=3811)
3820 READ (Z[1],END=5000)IOL=0310
3830 DIM B$(50),B[7]; B$(1,2)="00",B$(3,2)=A$(5,2)
3840 READ (Z[2],KEY=B$(1,4),DOM=3841)IOL=0320
3850 FOR I=0 TO 7
3860 B[I]=B[I]+A[I]
3870 NEXT I
3880 WRITE (Z[2],KEY=B$(1,4))IOL=0320
3890 GOTO 3820
5000 REM "END
5020 DIM P$(50)
5040 P$(1,6)=A9$,P$(7,6)=G1$,P$(13,6)=X3$(21,6)
5060 P$(19,5)=STR(INT(TIM):"00")+":"+STR(FPT(TIM)*60:"00")
5080 P$(24,3)=X3$(40,3),P$(27,2)=FID(0)
5100 REM "End
5102 IF E0$(7,1)="Y" THEN P$(29,3)=X3$(9,3); REM "cwj 6/22/98 ssp#091686
5105 WRITE (Z[1],KEY="")P$
5110 WRITE (Z[2],KEY="")P$
5120 GOTO 9900
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6050 GOSUB 7700
6060 PRINT @(5,6),"Fiscal Year:",@(24),"Accounting Period:",
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6215 GOSUB 6450
6220 PRINT @(18,6),A9$(1,4),@(43,6),A9$(5,2),
6240 GOSUB 7550
6390 RETURN 
6400 REM "WHOLE SCREEN
6402 IF C9=0 THEN IF ABS(C0)=17 THEN GOTO 6970
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6455 IF C9<0 THEN GOTO 6445
6490 RETURN 
7100 REM "Read stats (Packed/Unpacked), P(0)=YTD,P(1)=MTD
7110 DIM K[14],P[1]
7120 Q=POS(Q0$=S9$(49),17); IF Q=0 THEN GOTO 7190 ELSE M0$=S9$(Q+48,17)
7130 CALL "ZZPACK",X3$,"R",M0$(3,2),"",0,0,K{ALL},F0,Q0$,Q1$,S9$
7140 FOR I=0 TO NUM(A9$(5,2))
7150 P[0]=P[0]+K[I]
7160 NEXT I
7170 P[1]=K[NUM(A9$(5,2))]
7190 RETURN 
7195 RETURN 
7500 REM "Period Ending Date
7510 G$=""
7520 FIND (Z[13],KEY=X3$(9,3)+"G/LYE"+A9$(1,4),DOM=7521)G$
7530 G1$=G$(15+NUM(A9$(5,2))*6,6)
7540 RETURN 
7550 REM 
7560 PRINT @(46,6),"ending ",FND$(G1$),
7590 RETURN 
7700 REM "Date upated data
7705 IF LEN(P$)<50 THEN GOTO 7740
7710 PRINT @(0,3),'CE',@(3,3),"Current data for Fiscal Year: ",P$(1,4),"  Accounting Period: ",P$(5,2)," ending ",FND$(P$(7,6)),@(3,4),"Last updated: ",FND$(P$(13,6))," at ",P$(19,5)," by ",P$(24,3)," on terminal: ",P$(27,2),@(0,5),Z0$,
7740 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9740 RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
