0010 REM "A/P Purchases Journal Update <AP2DUA>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 07/05/11 - 14.046111 - crg - SSP# 197952
0037 REM "197952-Streamline processing by user - Chained journal updates     
0040 REM "Copyright 2011 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0080 IF %GUI THEN GOTO 0100
0090 BEGIN 
0100 SETERR 9000
0110 X0$="AP2DUA",X1$="A/P Purchases Journal Update"
0120 DIM Z0$(80,"-"),P0$(12),H$(200,"0")
0122 DIM BLK$(12),E[27]; REM "cwj 7/8/98 ssp#089851
0125 H$(1,9)="?"
0140 M1$="###,###.00-"
0150 IF POS("MS"=UCS(SYS)) THEN ISWIN=1 ELSE ISWIN=0
0170 DEF FNV$(Z9$)=CHR(INT(NUM(Z9$)/10)-125)+STR(MOD(NUM(Z9$),10))
0185 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0195 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####"); REM "added cwj 7/8/98 ssp#089851
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0250 DEF FNC$(C)=CHR(32+INT(C/95))+CHR(32+MOD(C,95))
0260 DEF FND(Z9$)=(ASC(Z9$(1,1))-32)*95+ASC(Z9$(2,1))-32
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14]
0320 IOLIST B$
0330 IOLIST C$,C[0],C[1],C[2]
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6]
0350 IOLIST E$(1,LEN(E$)),E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15],E[16],E[17],E[18],E[19],E[20],E[21],E[22],E[23],E[24],E[25],E[26],E[27]
0380 IOLIST H$
0390 IOLIST I$,I0$,I[0]
0400 IOLIST J$
0410 IOLIST K$,K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],K[8],K[9],K[10],K[11],K[12],K[13]
0420 IOLIST L$
0485 IOLIST GLV$,GLV[0],GLV[1],GLV[2],GLV[3],GLV[4]
0500 REM "FILES
0505 Z=NUM(X3$(60,3)); DIM Z[Z]; F0$="APDAPE",T1$="PU"; IF X3$(146,6)<>"AP2DBS" THEN F0$="APAAPU",T1$="MP"
0510 Z$="01L "+F0$(1,3)+"...  02L "+F0$(4,3)+"...  04O AP5...  05O API...  06X APJ...  07O APK...  08O APX...  09O GL6...  10O AP4...  11O AP9...  12O APP... "
0515 Z$=Z$+"13O ZZPARM  "+"03O APS...  30O GLV...  31O FS1...  32O FT3...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 0521,9900
0525 READ (Z[13],KEY=X3$(9,3)+"A/P",DOM=9900)F0$
0530 F2$=""; IF X3$(330,1)="1" THEN READ (Z[13],KEY="R/L"+X3$(9,3))F2$,*,*,*,F2
0545 IF F0$(68,1)="Y" THEN DIM F1$(110); READ (Z[13],KEY=X3$(9,3)+"AP2A",DOM=0546)F1$
0550 READ (Z[13],KEY=X3$(9,3)+"G/L")G0$
0554 REM "EXPORT_ON$ is "Y" if we are exporting to a file
0555 EXPORT_ON$="N"; READ (Z[13],KEY=X3$(9,3)+"EXPORTAP",DOM=0556)EXPORT_PARAM$; IF EXPORT_PARAM$(12,1)="Y" THEN EXPORT_ON$="Y"
0560 IF X3$(30,1)="M" THEN READ (Z[13],KEY="PFGG/L")F3$
0580 IF G0$(40,1)="A" OR G0$(180,1)="Y" THEN Q9$="A"
0582 REM IF T1$="MP" THEN LET Q9$=G0$(40,1); IF G0$(180,1)="Y" AND Q9$="C" THEN LET Q9$=Q9$+"A"
0585 READ (Z[13],KEY="STAT"+"A/P")S9$
0590 REM "Audit control for GL trans audit
0595 REMOVE (Z[9],KEY="",DOM=0596)
0600 REM "
0610 GOSUB 8190
0695 CALL "ZZPROM","U6",X3$,0,U9$,"","",0
0730 DIM A$(146),A[14]
0740 DIM B$(1)
0800 REM "CHECK FOR ROOM?
0805 CALL "ZZPROM","U1",X3$,0,"","","",0
0810 DIM X[Z,1],X$(0)
0815 FOR X=1 TO Z
0820 CALL "ZZINFO",X,0,X3$,A,B,0,0,0,0,0,""; X[X-1,0]=A,X[X-1,1]=B
0825 NEXT X
0830 PRINT @(0,22),'CL',
0835 IF T1$<>"MP" THEN IF X[0,0]=0 THEN CALL "ZZPROM","U2",X3$,S3,"","","",0; GOTO 9900
0840 GOTO 0900
0880 REM "PROMPT OUT OF ROOM
0885 X$="There is not enough room to update this data. Press <Return>: "
0890 CALL "ZZPROM","U3",X3$,S3,"","","",0; GOTO 9900
0900 REM "RESTART LOGIC
0905 V0$=X3$(1,6)+X3$(40,3)+DAY+STR(TIM*100:"0000")+X3$(178,6); WRITE (Z[1],KEY="",DOM=0906)V0$
0910 EXTRACT (Z[1],KEY="")V0$,K0$,K1$,K0,K1; I1=IND(Z[1]); IF V0$="" THEN GOTO 9800
0915 GOSUB 6000
0920 IF K0$="" THEN READ (Z[1],KEY=K0$); GOTO 0960
0930 A$=K0$; EXTRACT (Z[1],KEY=K0$,DOM=0931)IOL=0310
0935 PRINT @(12,12),"Restarting update with record: ",A$(1,4)+"-"+A$(5,2)+"-"+A$(7,10)+"-"+A$(17,10)
0940 CALL "ZZPROM","U5",X3$,0,"","","",14
0969 IF %CHAINED_UPDATE_MODE THEN GOTO 0971 ! Do not prompt if in chained update mode - 197952
0970 IF T1$<>"MP" THEN CALL "ZZPROM","9",X3$,S3,"","","",0; ON S3 GOTO 0971,9900
0975 PRINT @(0,12),'CL',
0979 CALL "ZZDAPP",X3$,"DALL"
0980 CALL "ZZFLES",X3$,Y1$,Y0$,"13C ZZPARM  ",Z{ALL},Z0,0
0990 IF POS(X3$(9,3)="144244",3)<>0 THEN S$="PU Update "+V0$(22,4)+"."+V0$(26,2)+" "+DAY+" "+STR(TIM*100:"0000"); S1$="echo "+QUO+S$+QUO+" >> "+HWD+DLM+"PU_log"; INVOKE S1$
1000 REM "READ NEXT RECORD
1020 K0$=KEY(Z[1],END=5000)
1030 READ (Z[1],KEY=K0$)IOL=0310
1040 GL$=""; DIM GL[20]; REM "Initialize for exporting
1080 DIM J$(306); EXTRACT (Z[10],KEY=A$(7,10),DOM=1081)IOL=0400
1085 J0$=J$; REM "ssp102775 cwj
1090 PRINT @(12,12),U9$,A$(1,4)+"-"+A$(5,2)+"-"+A$(7,10)+"-"+A$(17,10),
1100 REM "
1210 GOSUB 3500
1215 REM "IF POS(X3$(9,3)="321490500",3)=0 THEN IF J$(209,12)<>BLK$ THEN GOTO 01300; REM "CWJ 7/8/98 SSP#089851,118664
1220 GOSUB 2300
1230 GOSUB 2600
1240 GOSUB 2900
1260 GOSUB 4000
1300 REM "Update G/L distribution lines
1302 IF X3$(30,1)<>"M" OR A$(104,3)=X3$(9,3) THEN GOTO 1320 ELSE IF A$(7,2)>"01" THEN GOTO 1320
1303 Z$="13O ZZPARM "; GOSUB 9750
1304 READ (Z[13],KEY="R/L"+A$(104,3))R0$,*,R3,R4
1305 READ (Z[13],KEY="ROYALTY"+R0$(58,3))*,R0
1308 Z$="13C ZZPARM "; GOSUB 9750
1310 Q0$=F3$(91,12),Q0=A[1]; GOSUB 7900
1311 REM "Reduce royalty fees/Adv acct , freight costs
1312 IF A[2]=0 THEN GOTO 1320 ELSE Q0$=F3$(31,12),Q0=(-R0)*A[2]/100; GOSUB 7900
1314 Q0$=F3$(19,12),Q0=-Q0; GOSUB 7900
1315 REM "DA Fees reduced by freight cost (DA PERCENT IS IN R3&R4)
1316 Q0$=F3$(67,12),Q0=(-Q0)*(R3+R4)/100; GOSUB 7900
1318 Q0$=F3$(79,12),Q0=-Q0; GOSUB 7900
1325 IF Q9$="" THEN Q9$=" "
1380 FOR R0=1 TO LEN(Q9$)
1400 REM 
1410 P0$(1,8)=X3$(9,3)+"G/LYE"
1415 IF P0$(9,4)<>A$(1,4) THEN P0$(9,4)=A$(1,4); CLOSE (Z); OPEN (Z)"ZZPARM"; READ (Z,KEY=P0$(1,12))P0$
1420 Q=NUM(P0$(13,2)),Q=15+Q*6
1440 IF Q9$>"" THEN Q$=FNV$(P0$(9,4))+A$(5,2)+T1$+Q9$(R0,1)+V0$(22,6)+"AP"
1445 T8$=FNV$(P0$(9,4))+A$(5,2),R9$=J$(3,NUM(F0$(14,1)))+"\"
1450 R9$=R9$+FNS$(J$(11,35))+"\I# "+FNS$(A$(17,10))+"\"+FNS$(A$(47,15)); IF F0$(13,1)="Y" THEN R9$=A$(7,2)+"-"+R9$ ! SSP#297317
1460 REM LET R9$="V# "+R9$
1480 GOSUB 3100
1490 R1=0,R2=0
1500 REM "UPDATE LINES
1501 REM "X3$(30,1) INDICATES MASTER LOCATION, A$(104,4) IS SOURCE COMPANYU CODE PLUS LOCATION TYPE (1=REMOTE) UPDATED IN A/P DATA ENTRY
1502 IF X3$(30,1)="M" THEN IF A$(104,3)<>X3$(9,3) THEN GOTO 1521
1505 IF Q9$=" " THEN R9$=""
1510 A0=A[0],A1=E[1],A2=E[0]
1512 IF L0$="" THEN J$=""
1515 F$=A$(7,20)+A$(89,1)+A$(27,6)+A$(1,6)+V0$(22,6),R9=1,W0$="APE...",W0=7; IF T1$="MP" THEN W0$="APU..."
1517 IF G0$(32,1)<>"Y" THEN GOTO 1520
1518 CALL "GL2XUV",X3$,X4$,W0$,7,Q$,R9$,A0,3,4,R9,Z[1],I1,"APK...",F$+A$(62,9)+SLSP$+CUST$,A1,Z[6],J$,J[0],A2,0,R1,R2,"","",E$
1519 A0=A[0],A1=E[1],A2=E[0]
1520 CALL "GL2XUA",X3$,X4$,W0$,7,Q$,R9$,A0,3,4,R9,Z[1],I1,"APK...",F$,A1,Z[6],J$,J[0],A2,0,R1,R2,"","",E$
1550 NEXT R0
1560 ! IF J0$(209,12)<>BLK$ THEN GOTO 1750; REM "cwj 7/9/98 ssp#089851 !SSP#236474
1600 REM "UPDATE OPEN INVOICE RECORD  W/ INDEX
1610 E[1]=A1,E[0]=A2
1620 GOSUB 2800
1750 IF K0>0 THEN GOTO 1520
1800 REM "RESTART LOGIC
1810 GOSUB 6600
1850 REM "
1855 REM "If this is a remote location company, then if invoice is
1856 REM "for division 00, then add to transmission file
1860 IF X3$(330,1)="1" THEN IF A$(7,2)="00" THEN CALL "CM2AAA",X3$,Z[1],0,K0$,"",Q
1889 REM "If Export is on and this is not an adjustment to an existing invoice (L0$='') then export the invoice
1890 IF L0$="" THEN IF EXPORT_ON$="Y" THEN CALL "AP2XAA",X3$,X4$,EXPORT_PARAM$,EXPORT_FILES{ALL},A$,A{ALL},GL$,GL{ALL},Z{ALL},V0$
1950 GOTO 1000
2300 REM "Vendor status
2310 IF J$<>"" THEN IF J$(209,12)<>BLK$ THEN RETURN 
2320 DIM D$(38),D[6]
2325 D$(1,10)=A$(7,10)
2330 EXTRACT (Z[4],KEY=D$(1,10),DOM=2331)IOL=0340
2340 IF D$(11,6)="      " OR D$(11,6)<A$(27,6) THEN D$(11,6)=A$(27,6)
2350 D[0]=D[0]+A[1]-A[7]*POS("Y"=F0$(15,1))
2370 WRITE (Z[4],KEY=D$(1,10))IOL=0340
2390 RETURN 
2600 REM "Update A/P Open Invoice File
2605 REM "If Master system, if processing for non-remote location, if div=00
2609 IF A$(104,3)="144" THEN GOTO 2611
2610 IF X3$(30,1)="M" THEN IF X3$(330,1)<>"1" THEN IF A$(7,2)="00" THEN CALL "CM2UAC",X3$,"A",A$,A{ALL},"","",0
2620 DIM E$(160),E[27]
2625 E$(1,20)=A$(7,20),L0$="",I5=0
2630 EXTRACT (Z[5],KEY=E$(1,20),DOM=2638)IOL=0350; A$(89,1)="A"
2635 L0$=E$(66,3)+E$(1,20),I5=IND(Z[5]),L1$=E$(83,1)
2636 IF POS(X3$(9,3)="144244",3)<>0 THEN IF E$(118,3)<>A$(104,3) THEN GOSUB 7600; REM "Write out to log file if source co's don't match
2638 IF LEN(A$)=103 THEN A$=A$+X3$(9,3)+X3$(330,1)
2640 E$(21,63)=A$(27,63),E$(84,10)=A$(90,10),E$(114,4)=A$(100,4),E$(118,4)=A$(104,4); IF POS(" "<>E$(106,6))=0 THEN E$(106,6)=V0$(22,6)
2645 E$(125,6)=A$(111,6),E[22]=A[14]; REM "WP131561, 2nd discount date/amt
2650 IF A$(89,1)="I" OR E$(94,6)="      " THEN E$(94,6)=A$(1,6)
2655 IF A$(1,6)>E$(100,6) THEN E$(100,6)=A$(1,6)
2660 FOR X=2 TO 5; E[X+1]=E[X+1]+A[X]; NEXT X
2665 E[7]=E[7]+A[7],E[8]=E[8]+A[8],E[2]=E[2]+A[1]
2670 E[9]=A[10],E[13]=E[13]+A[1]
2675 IF L0$="" THEN E[10]=A[1] ELSE E$(83,1)=L1$
2680 IF F2>0 THEN IF E[2]>F2 THEN E$(81,1)="Y"
2685 IF POS(" "<>A$(108,3))<>0 THEN E$(122,3)=A$(108,3),E[18]=A[12],E[19]=A[13]
2800 REM "WRITE A/P INVOICE RECORD
2810 IF J0$(209,12)<>BLK$ THEN E[13]=0,E[12]=E[2]
2870 WRITE (Z[5],KEY=E$(1,20))IOL=0350
2890 RETURN 
2900 REM "A/P statistical history data
2910 Q1$=A$(7,10)+A$(1,4),Q1=NUM(A$(5,2)),F0=Z[11]
2920 Q0$="P",Q0=A[1]; IF F0$(77,1)="Y" THEN Q0=A[1]-A[3]; GOSUB 7000 ELSE GOSUB 7000
2930 Q0$="A"; IF A$(89,1)<>"I" THEN Q0=A[0]; GOSUB 7000
2940 Q0$="I",Q0=1; GOSUB 7000
2950 FOR X=0 TO 3; Q0$=STR(X+1:"0"),Q0=A[X+2]; GOSUB 7000; NEXT X
2960 IF LEN(Q1$)=14 AND F0$(70,1)="Y" THEN F0=Z[3],Q1$=Q1$(1,10)+A$(100,4)+Q1$(11); GOTO 2920
2995 RETURN 
3100 REM "Invoice transaction history
3110 DIM J$(55),J[1]
3120 J$(1,20)=A$(7,20),J$(21,15)="Adj: "+A$(90,10),J$(36,1)=A$(89,1),J$(37,6)=A$(1,6),J$(43,6)=V0$(22,6),J$(49,6)=A$(27,6),J[0]=A[1]
3190 RETURN 
3500 REM "G/L Interface
3510 Q$=A$(7,2); IF F0$(20,1)="Y" THEN Q$=A$(75,9)
3515 FIND (Z[31],KEY=A$(62,8),DOM=3517)FS1$
3516 CUST$=FS1$(6,10),SLSP$=FS1$(93,4)+FS1$(102,16); GOTO 3520
3517 FIND (Z[32],KEY=A$(62,8),DOM=3519)FT3$
3518 CUST$=FT3$(6,10),SLSP$=FT3$(93,4)+FT3$(102,16); GOTO 3520
3519 CUST$=DIM(10),SLSP$=DIM(20)
3520 IF H$(1,LEN(Q$))<>Q$ THEN FIND (Z[8],KEY=Q$,DOM=3521)H$(1) ! 194099
3530 IF J$(209,12)=BLK$ THEN Q0$=H$(33,12),Q0=-A[1]; GOSUB 8000 ELSE Q0$=J$(209,12),Q0=-A[1]; GOSUB 8200
3531 IF G0$(32,1)<>"Y" THEN GOTO 3545
3532 DIM GLV$(223),GLV[4]
3533 GLV$(1,4)=FNV$(A$(1,4))+A$(5,2),GLV$(5,6)=X3$(15,6),GLV$(11,1)=Q9$,GLV$(12,2)="AP"
3534 GLV$(14,12)=Q0$,GLV[0]=Q0,GLV$(53,10)=A$(7,10),GLV$(71,10)=A$(17,10),GLV$(112,6)=V0$(22,6),GLV$(118,6)=A$(27,6),GLV$(101,9)=A$(62,9),GLV$(93,8)=A$(62,8),GLV$(135,20)=SLSP$,GLV$(125,10)=CUST$
3535 GLV_SEQ$=STR(1:"00000")
3536 GLV$(26,5)=GLV_SEQ$
3540 WRITE (Z[30],KEY=GLV$(1,32),DOM=*NEXT)IOL=0485; GOTO 3545
3541 IF GLV_SEQ$="99999" THEN ESCAPE ELSE GLV_SEQ$=STR(NUM(GLV_SEQ$)+1:"00000")
3542 GOTO 3536
3545 IF A[8]<>0 THEN Q0$=H$(69,12),Q0=-A[8]; GOSUB 8000
3547 IF G0$(32,1)<>"Y" THEN GOTO 3570
3548 GLV$(14,12)=Q0$,GLV[0]=Q0
3549 GLV_SEQ$=STR(1:"00000")
3550 GLV$(26,5)=GLV_SEQ$
3555 WRITE (Z[30],KEY=GLV$(1,32),DOM=*NEXT)IOL=0485; GOTO 3570
3560 IF GLV_SEQ$="99999" THEN ESCAPE ELSE GLV_SEQ$=STR(NUM(GLV_SEQ$)+1:"00000"); GOTO 3570
3562 GOTO 3550
3570 REM "Post Special Amts to G/L
3572 IF X3$(30,1)="M" THEN IF A$(104,3)<>X3$(9,3) THEN GOTO 3599
3575 IF F1$="" THEN GOTO 3599
3579 REM "3580-3584, cwj 7/8/98 ssp#089851
3580 Q1$="A"; FOR X=0 TO 3
3582 Q0$=H$(X*12+81,12),Q0=A[X+2]*1
3584 IF F1$(24+X*20,1)="Y" THEN IF J$(209,12)=BLK$ THEN GOSUB 8000 ELSE GOSUB 8200
3585 IF G0$(32,1)<>"Y" THEN GOTO 3598
3586 IF Q0=0 THEN GOTO 3598
3587 GLV_SEQ$=STR(1:"00000"),GLV$(14,12)=Q0$,GLV[0]=Q0
3588 GLV$(26,5)=GLV_SEQ$
3589 WRITE (Z[30],KEY=GLV$(1,32),DOM=*NEXT)IOL=0485; GOTO 3598
3590 IF GLV_SEQ$="99999" THEN ESCAPE ELSE GLV_SEQ$=STR(NUM(GLV_SEQ$)+1:"00000")
3591 GOTO 3588
3598 NEXT X
3599 RETURN 
3790 RETURN 
4000 REM "Update APP - Invoice sort by bank code
4005 REM "L0$ set in 2600
4020 L$=A$(72,3)+A$(7,10)+A$(17,10)
4025 IF L0$="" THEN GOTO 4060 ELSE IF L0$=L$ THEN GOTO 4090
4030 REM "Remove old record
4035 REMOVE (Z[12],KEY=L0$,DOM=4036)
4060 WRITE (Z[12],KEY=L$)
4090 RETURN 
5000 REM "END OF UPDATE
5005 CALL "AP2DUM",X3$,X4$ ! 307403-DBD-265
5020 GOSUB 8100
5100 REM "
5200 REM "CLEAR FILES
5205 PRINT @(0,10),'CE',
5210 CALL "ZZPROM","U7",X3$,0,"","","",10
5220 CALL "ZZINTZ",X3$,"B",0,STR(Z[1]:"00")+STR(Z[2]:"00")
5225 CALL "ZZFLES",X3$,Y1$,Y0$,"13O ZZPARM  ",Z{ALL},Z0,0
5230 GOSUB 6700
5240 PRINT 'CF'
5280 Y4$="ZMENU"; IF T1$="MP" THEN Y4$="AP2CUA"
5400 REM 
5450 GOTO 9900
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6019 REM PRINT @(12,4),"This program will update information from the",; IF T1$<>"MP" THEN PRINT @(12,5),"A/P Invoice data entry file." ELSE PRINT @(12,5),"A/P Manual Check data entry file"
6020 CALL "ZZPROM","U9",X3$,0,"","","",4
6025 CALL "ZZPROM","U8",X3$,0,"+ "+V0$(22,4)+"."+V0$(26,2),"","",7
6065 PRINT (0,ERR=6066)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6225 GOSUB 6450
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6410 GOSUB 6000
6430 IF C9>0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6490 RETURN 
6600 REM "RESTART LOGIG
6605 RETURN 
6610 WRITE (Z[1],IND=I1)V0$,K0$,K1$,K0,K1
6690 RETURN 
6700 REM "Increment Audit Control No.
6704 IF T1$="MP" THEN RETURN 
6705 F9=Z[13]
6710 A2$=X3$(146,6)+"  000100",A0$=X3$(9,3)+"AUDIT",A1$=""; EXTRACT (F9,KEY=A0$,DOM=6716)A0$,A1$
6715 A0=POS(A2$(1,6)=A1$,14); IF A0=0 THEN A1$=A1$+A2$; GOTO 6715 ELSE A2=NUM(A1$(A0+8,4))+1,A2$(9,4)=STR(A2:"0000"),A1$(A0,14)=A2$
6720 WRITE (F9,KEY=A0$)A0$,A1$
6740 RETURN 
7000 REM "Update stats q0$ in period q1 with data q0
7005 IF Q0=0 OR POS(Q0$=F0$(22,10))=0 THEN GOTO 7090
7010 DIM K[14]; P9$=Q1$+Q0$
7020 GOSUB 7100
7040 K[Q1]=K[Q1]+Q0
7060 GOSUB 7150
7090 RETURN 
7100 REM "Read stats (Packed/Unpacked)
7105 Q=POS(Q0$=S9$(49),17); IF Q=0 THEN EXITTO 7090 ELSE M0$=S9$(Q+48,17)
7110 CALL "ZZPACK",X3$,"E",M0$(3,2),"",0,0,K{ALL},F0,Q0$,Q1$,S9$
7135 GOTO 7190
7150 REM "Write stats
7160 CALL "ZZPACK",X3$,"W",M0$(3,2),"",0,0,K{ALL},F0,Q0$,Q1$,S9$
7190 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7600 REM "Write out to log file (/tmp/PU.log) for PFG if source co of API is different than source co of APD
7605 REM "S$=Vendor+Invoice+APD Source Co+APD Gross Amt+APD Ref No+API Source Co+API Total Booked to A/P+API Ref No
7610 S$=A$(7,10)+" "+A$(17,10)+" "+A$(104,3)+" "+STR(A[1]:M1$)+" "+A$(62,10)+" "+E$(118,3)+" "+STR(E[2]:M1$)+" "+E$(56,10)
7620 S1$="echo "+QUO+S$+QUO+" >> "+HWD+DLM+"PU_log"
7630 INVOKE S1$
7640 S2$="echo "+QUO+S$+QUO+" | mail csi root"
7650 INVOKE S2$
7695 RETURN 
7900 REM 
7920 P=POS("???"=Q0$); IF P>0 THEN Q0$(P,3)=A$(104,3)
8000 REM "G/L control postings accumulation
8005 REM "q0$=G/L account number, q0=amount
8007 IF EXPORT_ON$="Y" THEN GL$=GL$+Q0$,GL[LEN(GL$)/12]=Q0; REM "IF exporting invoices then store g/l # & amount, Just add to string, don't accumulate
8010 IF A$(1,6)<>T0$ THEN GOSUB 8100; T0$=A$(1,6)
8020 P=POS(Q0$=T9$,12); IF P>0 THEN P=INT(P/12),T[P]=T[P]+Q0; GOTO 8090
8025 IF LEN(T9$)<14*LEN(Q0$) THEN T9$=T9$+Q0$; GOTO 8020
8030 GOSUB 8100; GOTO 8020
8095 RETURN 
8100 REM "FLUSH G/L ACCUM - SUMMARY POST
8105 IF POS("A"=Q9$)=0 OR T9$="" THEN GOTO 8190
8110 FOR X=1 TO LEN(T9$) STEP 12
8115 P=INT(X/12)
8120 IF T[P]=0 THEN GOTO 8185
8125 I$="A"+T8$(1,4)+T1$+V0$(22,6)+T9$(X,12)+"~~"+X3$(15,6)+"AP"
8130 I0$="Purchase Journal"; DIM I[1]
8135 EXTRACT (Z[9],KEY=I$(1,27),DOM=8136)IOL=0390
8140 I[0]=I[0]+T[P]
8145 WRITE (Z[9],KEY=I$(1,27))IOL=0390
8185 NEXT X
8190 T9=14,T9$=""; DIM T[T9]
8195 RETURN 
8200 REM "G/L control postings accumulation
8204 GOSUB 8100; GOSUB 8300
8205 REM "Q0$=G/L account number, Q0=amount
8207 IF EXPORT_ON$="Y" THEN GL$=GL$+Q0$,GL[LEN(GL$)/12]=Q0; REM "If porting invoices then store G/L# & amount, Just add to string, don't accummulate
8210 IF POS("A"=Q9$)=0 THEN GOTO 8290
8215 IF Q0=0 THEN GOTO 8290
8218 IF T8$="" THEN GOSUB 8300
8220 I$="A"+T8$(1,4)+T1$+V0$(22,6)+Q0$+"00"+X3$(15,6)+"AP"
8225 I0$="Purchase Journal - "+A$(7,10)+" - "+A$(17,10)+" - "+FND$(A$(27,6)); DIM I[1]; I[0]=Q0
8230 WRITE (Z[9],KEY=I$(1,27),DOM=8240)IOL=0390; GOTO 8290
8240 I$(26,2)=FNC$(FND(I$(26,2))+1) ! use same logic as GL2XUA - ssp# 152061
8250 GOTO 8230
8295 RETURN 
8300 REM "Get info for update
8302 CLOSE (Z); OPEN (Z)"ZZPARM"
8305 P0$(1,8)=X3$(9,3)+"G/LYE"
8310 IF P0$(9,4)<>A$(1,4) THEN P0$(9,4)=A$(1,4)
8312 READ (Z,KEY=P0$(1,12))P0$
8320 Q=NUM(P0$(13,2)),Q=15+Q*6
8325 IF Q9$>"" THEN Q$=FNV$(P0$(9,4))+A$(5,2)+T1$+Q9$(1,1)+V0$(22,6)+"AP"
8330 T8$=FNV$(P0$(9,4))+A$(5,2),R9$=J$(3,NUM(F0$(14,1)))+"\"
8390 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,1
9050 ON Y7 GOTO 9060,9100,9190,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOSUB 6600; GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9750 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
9790 RETURN 
9800 REM 
9830 IF %GUI THEN Y4$="" ELSE Y4$="ZMENU"
9900 REM "END PROGRAM
9907 CALL "ZZDAPP",X3$,"AALL"
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9950 IF NOT(NUL(Y4$)) THEN IF %GUI AND Y4$="ZMENU" THEN EXIT ELSE IF %GUI THEN CALL Y4$ ELSE RUN Y4$
9960 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
56005 REM "194099-error 47 in AP2DUA if g/l distribution not on file          
56006 REM "236474-Cannot adjust an Intercompany Payable invoice downward if   
56007 REM "197952-Streamline processing by user - Chained journal updates     
