0010 REM "Vendor Delete Routine <AP2UAB>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 08/12/10 - 10.783055 - tma - SSP# 240339
0037 REM "240339-Request from ssp to add the list of where activity detected 
0040 REM "Copyright 2010 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$,Q2$,Q3$
0100 SETERR 9000
0110 X0$="AP2UAB",X1$="Vendor Delete Routine",K9$="",K9=0
0120 DIM Z0$(80,"-"),C[5],Y[4],F[14],K[14],J[14]
0160 DEF FNS$(Z9$)=Z9$(1,POS("  "=Z9$+"  ")-1)
0200 REM "
0240 REM "CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0300 REM "IOLISTS
0310 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5]
0320 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0509 REM "Carefull - do not use slot 12 or too many files will be open!
0510 Z$="01O AP4...  02O API...  03O AP5...  04O PO4...  05O AP9...  06O AP6...  07O AP7...  08O AP8...  09O FMQ...  10O FMR...  11O APS...  12O AP1...  13O ZZPARM  "
0520 GOSUB 9750
0600 READ (Z[13],KEY="STAT"+"A/P")S9$
0630 GOSUB 9700
1000 REM "
1010 REM "CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
1100 READ (Z[1],KEY=Q1$(1,10),DOM=5000)A$
1200 REM "Check if active
1210 REM "Open invoices?
1220 READ (Z[2],KEY=A$(1,10),DOM=1221)
1230 READ (Z[2],END=1250)B$
1240 IF B$(1,10)=A$(1,10) THEN Q2$=MSG("OPEN_INVO")+", "; GOTO 1250 ! SSP#240339
1250 REM "Vendor status file
1260 READ (Z[3],KEY=A$(1,10),DOM=1300)IOL=0310
1270 IF C[0]<>0 THEN Q2$=Q2$+MSG("OPEN_BAL")+", "; GOTO 1280 ! SSP#240339
1275 IF A$(246,1)="T" THEN GOTO 1300; REM "TEMP VENDOR WO87609 DXM
1280 IF C$(37,1)<>" " AND (C[2]<>0 OR C[4]<>0) THEN Q2$=Q2$+MSG("1099_BAL")+", "; GOTO 1300 ! SSP#240339
1300 REM "Open P/O?
1310 READ (Z[4],KEY=A$(1,10),DOM=1311)
1320 K$=KEY(Z[4],END=1350); READ (Z[4])
1330 IF K$(1,10)=A$(1,10) THEN Q2$=Q2$+MSG("OPEN_PO"); GOTO 5000 ! SSP#240339
1390 IF Q2$<>"" AND Q2$<>"Y" THEN GOTO 5000 ! SSP#240339
1400 REM "CHECK MORE FOR TEMP VENDOR REMOVAL CRITERIA
1410 IF A$(246,1)<>"T" THEN GOTO 2000
2000 REM "Delete vendor information
2001 IF Q3$<>"P" THEN GOTO 2100
2003 PRINT @(0,16),'CL',@(12),"Vendor No:  ",
2005 CALL "ZZDISP","A",A$(1,10),"A/P",X3$,"","",24,16,X4$
2100 REM "Lookup Code file
2110 REMOVE (Z[6],KEY=A$(133,10)+A$(1,10),DOM=2120)
2120 REM "Alt Vendor Sort by Category
2130 REMOVE (Z[7],KEY=A$(247,9)+A$(1,10),DOM=2131)
2140 REM "Vendor Message
2150 REMOVE (Z[8],KEY=A$(1,10),DOM=2151)
2155 REM " Z$="08C AP8... 08O AP1...  "; GOSUB 9750
2160 REM "Phone Sort
2170 REMOVE (Z[12],KEY=A$(195,10)+A$(1,10),DOM=2171)
2180 REM "Z$="08C AP1...  08O AP8...  "; GOSUB 9750
2200 REM "I/C Ink chart set-up
2210 READ (Z[9],KEY=A$(1,10),DOM=2211)
2220 K$=KEY(Z[9],END=2250); READ (Z[9])
2230 IF K$(1,10)<>A$(1,10) THEN GOTO 2250
2240 REMOVE (Z[9],KEY=K$); GOTO 2220
2249 REM "Ink Chart Sort
2250 READ (Z[10],KEY=A$(1,10),DOM=2251)
2260 K$=KEY(Z[10],END=2300); READ (Z[10])
2270 IF K$(1,10)<>A$(1,10) THEN GOTO 2300
2280 REMOVE (Z[10],KEY=K$)
2290 GOTO 2260
2300 REM "Status
2310 REMOVE (Z[3],KEY=A$(1,10),DOM=2311)
2400 REM "Combine Stats
2410 F9=Z[5]
2430 READ (F9,KEY=A$(1,10),DOM=2431)
2440 K$=KEY(F9,END=2580)
2445 IF K$(1,10)<>A$(1,10) THEN GOTO 2580
2450 IF F9=Z[5] THEN Q1$=K$(1,14),Q0$=K$(15,1) ELSE Q1$=K$(1,18),Q0$=K$(19,1)
2455 P9$=Q1$+Q0$
2460 DIM K[14],J[14]
2470 GOSUB 7100
2480 FOR X=0 TO 14; J[X]=K[X]; NEXT X
2500 Q1$(1,10)=A$(1,2)+"z       ",P9$=Q1$+Q0$
2505 IF F9=Z[5] THEN GOSUB 6000
2510 DIM K[14]
2520 GOSUB 7100
2530 FOR X=0 TO 14; K[X]=K[X]+J[X]; NEXT X
2540 GOSUB 7150
2545 REMOVE (F9,KEY=K$)
2547 READ (F9,KEY=K$,DOM=2548)
2550 GOTO 2440
2580 IF F9=Z[5] THEN F9=Z[11]; GOTO 2430
2600 REM "History
2603 Z$="09CRFMQ...  06CRAP6...  07CRAP7...  "
2605 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 2606,9900
2607 Z$="09ORAPQ...  06ORAPJ...  07ORAPK...  "
2610 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 2611,9900
2612 F9=Z[9]
2615 READ (F9,KEY=A$(1,10),DOM=2620)
2620 K$=KEY(F9,END=2700); READ (F9)IOL=0360
2630 IF K$(1,10)<>A$(1,10) THEN GOTO 2700
2640 REMOVE (F9,KEY=K$)
2650 F=Z[6],A0=F[0]; GOSUB 5900
2660 F=Z[7],A0=F[1]; GOSUB 5900
2670 GOTO 2620
2700 REM "User defined fields
2703 Z$="09CRAPQ...  06CRAPJ...  07CRAPK...  "
2705 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 2706,9900
2707 Z$="09ORAPB...  06ORAPF...  "
2710 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 2711,9900
2712 F9=Z[9]
2715 READ (F9,KEY=A$(1,10),DOM=2716)
2720 K$=KEY(F9,END=2750); READ (F9)APB$
2725 IF K$(1,10)<>A$(1,10) THEN GOTO 2750
2730 REMOVE (F9,KEY=K$)
2735 REMOVE (Z[6],KEY=K$(11,4)+K$(1,10),DOM=2736)
2740 GOTO 2720
2800 REMOVE (Z[1],KEY=A$(1,10))
3100 REM "Delete Return to Overlay
3110 Q2$="Y"
3140 GOTO 9900
5000 REM "No Delete Return to Overlay
5010 ! Q2$="N"  SSP#240339
5090 GOTO 9900
5900 REM "REMOVE LINES
5910 DIM DET[1]; CALL "AR2XAB",X3$,X4$,F,F$,A0,"",DET{ALL},FLAG$,SEQ$,"D"
5911 GOTO 5990
5919 IF A0=0 THEN GOTO 5990; REM "Old logic for indexed files
5920 EXTRACT (F,IND=0,ERR=5960)IOL=0320
5925 IF Y[4]=-2 THEN READ (F,IND=0); WAIT 0; GOTO 5920 ELSE Y[4]=-2; WRITE (F,IND=0)IOL=0320
5930 A1=Y[1],Y[1]=A0,Y[0]=Y[0]-1
5935 READ (F,IND=A0,ERR=5940)A; IF A>0 THEN Y[0]=Y[0]-1,A0=A; GOTO 5935
5940 WRITE (F,IND=A0)A1
5950 Y[4]=-1; WRITE (F,IND=0)IOL=0320
5955 GOTO 5990
5960 IF ERR=0 THEN RETRY ELSE GOTO 9000
5990 RETURN 
6000 REM "Write z record to master & sorts
6010 DIM A2$(426); A2$(1,38)=Q1$(1,10)+"Deleted vendor's statistics ",A2$(145,1)="z",A2$(247,1)="z"; WRITE (Z[1],KEY=A2$(1,10),DOM=6011)A2$,0,0
6020 WRITE (Z[6],KEY="z         "+Q1$(1,10),DOM=6021)
6030 WRITE (Z[7],KEY="z        "+Q1$(1,10),DOM=6031)
6050 RETURN 
7000 REM "Update stats
7010 DIM K[14]; P9$=Q1$+Q0$
7020 GOSUB 7100
7030 FOR Q1=0 TO 13
7040 K[Q1]=K[Q1]+J[Q1]
7050 NEXT Q1
7060 GOSUB 7150
7090 RETURN 
7100 REM "Read stats (Packed/Unpacked)
7105 Q=POS(Q0$=S9$(49),17); IF Q=0 THEN EXITTO 7090 ELSE M0$=S9$(Q+48,17)
7110 CALL "ZZPACK",X3$,"E",M0$(3,2),"",0,0,K{ALL},F9,Q0$,Q1$,S9$
7135 GOTO 7190
7150 REM "Write stats
7160 CALL "ZZPACK",X3$,"W",M0$(3,2),"",0,0,K{ALL},F9,Q0$,Q1$,S9$
7190 RETURN 
9000 REM "ERROR PROCESSING
9001 PRINT ERR,"   ",TCB(5)
9002 INPUT *
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 9900
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9750 REM "FILE OPEN
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 9761,9900
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 SETESC 9350
9950 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
56001 REM "240339-Request from ssp to add the list of where activity detected 
