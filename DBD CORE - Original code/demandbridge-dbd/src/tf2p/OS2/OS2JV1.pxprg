0010 REM "<OS2JV1> FIX FOR Download SPR NUMBER CHANGES
0035 REM "5.6 - 08/14/08 - 10.74 - jvv - SSP# 221600
0037 REM "221600-Problem with SP Richards when sku has been changed by       
0040 REM "Copyright 2008 DemandBridge, Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 ! F %GUI=0 THEN SETERR 9000
0110 X0$="OS2ZAD",X1$="Download File - SP RICHARDS"
0200 REM "Initialization
0210 WINCHECK=TCB(88)
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; ; IF X1>0 THEN GOTO 9920
0245 IF X3$(65,1)>"2" THEN PRECISION NUM(X3$(65,1),ERR=0246)
0300 DIM BLANK$(40," "),RECORD2$(30," ")
0350 IOLIST FM1$,FM1[0],FM1[1],FM1[2],FM1[3],FM1[4],FM1[5],FM1[6],FM1[7],FM1[8],FM1[9],FM1[10],FM1[11],FM1[12],FM1[13],FM1[14],FM1[15],FM1[16],FM1[17],FM1[18],FM1[19],FM1[20],FM1[21],FM1[22],FM1[23],FM1[24],FM1[25],FM1[26],FM1[27],FM1[28],FM1[29],FM1[30]
0355 IOLIST IC0$,IC0[0],IC0[1],IC0[2],IC0[3],IC0[4],IC0[5],IC0[6],IC0[7],IC0[8],IC0[9],IC0[10],IC0[11],IC0[12],IC0[13],IC0[14],IC0[15],IC0[16],IC0[17],IC0[18],IC0[19],IC0[20],IC0[21],IC0[22],IC0[23],IC0[24],IC0[25],IC0[26],IC0[27],IC0[28],IC0[29],IC0[30],IC0[31],IC0[32],IC0[33],IC0[34],IC0[35],IC0[36],IC0[37],IC0[38],IC0[39],IC0[40]
0360 IOLIST OSU1$,NEW_ITEM$,OSU3$,OSU4$,OSU5$
0370 IOLIST OLD1$,OLD_ITEM$,OLD3$,OLD4$
0410 IOLIST S5$,S[0],S[1]
0450 ! SPR_PREFIX$="SPR"
0500 REM %DATAPATH$ IS DATA PATH
0600 OPEN (1)"OSWOLD"
0718 DIM Z[NUM(X3$(60,3))]
0720 Z$="02O OS2...  04O OS1...  06O OS0...  07O OS7...  13O ZZPARM 22O OS2...  24O OS1...  26O OS0...  27O OS7...  28O OSU..."
0730 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0731,9900
0731 READ (Z[13],KEY=X3$(9,3)+"OSP")OSP_PARMS$
0732 SPFX$=OSP_PARMS$(218,1),SPR$=SPFX$; REM "C"=SPR(Canada), "S"=SPR(USA)
0733 ! F SPR$="S" THEN SFNAME$="OSSPRC" ELSE SFNAME$="OSSPRR"
0735 READ (Z[13],KEY=X3$(9,3)+"OSD")DEFAULTS$
0800 ! IM OS1$(250),OS2$(127)
0810 ! IM OS0$(800)
0820 ! IM OS7$(125)
0850 OPEN (24)"OS1500"; OPEN (27)"OS7500"
1000 REM "BEGIN MAIN PROCESS
1001 PROCESS$="",%LOAD_DATE$=DAY
1005 ESCAPE 
1010 READ (1,END=5000)OLDSKU$,*,NEWSKU$,*
1020 FIND (Z[28],KEY=NEWSKU$,DOM=1010)IOL=0360
1025 FIND (Z[28],KEY=OLDSKU$,DOM=1010)IOL=0370
1026 IF OLD_ITEM$=NEW_ITEM$ THEN GOTO 1010
1030 FIND (Z[6],KEY=NEW_ITEM$,DOM=1010)OS0$; NSTAT$=OS0$(124,1)
1040 K6$=OLD_ITEM$,OS0$(1,10)=K6$,OS0$(27,10)=K6$; WRITE (Z[6],KEY=K6$)OS0$
1045 K6$=NEW_ITEM$,OS0$(1,10)=K6$,OS0$(27,10)=K6$,OS0$(124,1)="D"; WRITE (Z[6],KEY=K6$)OS0$
1050 READ (Z[4],KEY=NEW_ITEM$,DOM=1060)
1060 K4$=KEY(Z[4],END=1100)
1070 READ (Z[4],KEY=K4$)OS1$; IF K4$(1,10)<>NEW_ITEM$ THEN GOTO 1100
1080 K24$=K4$,K24$(1,10)=OLD_ITEM$,OS1$(1,10)=OLD_ITEM$; WRITE (24,KEY=K24$)OS1$
1090 GOTO 1060
1100 FIND (Z[2],KEY=NEW_ITEM$,DOM=1200)OS2$
1105 ESCAPE 
1110 OS2$(1,10)=OLD_ITEM$
1120 WRITE (Z[22],KEY=OLD_ITEM$)OS2$
1200 READ (Z[7],KEY=NEW_ITEM$,DOM=1210)
1210 K7$=KEY(Z[7],END=1300)
1215 ESCAPE 
1220 READ (Z[7],KEY=K7$)OS7$; IF K7$(1,10)<>NEW_ITEM$ THEN GOTO 1300
1230 K27$=K7$,K27$(1,10)=OLD_ITEM$,OS7$(1,10)=OLD_ITEM$; WRITE (27,KEY=K27$)OS7$
1240 GOTO 1210
1250 ! SU4$=OLDSKU$,OSU5$="800263    ",NEW_ITEM$=OLD_ITEM$; WRITE (Z[28],KEY=NEWSKU$)IOL=0360
1300 OSU4$=OLDSKU$,OSU5$=NEW_ITEM$,NEW_ITEM$=OLD_ITEM$; WRITE (Z[28],KEY=NEWSKU$)IOL=0360
1500 ! =C+1; IF MOD(C,T0)=1 THEN GOSUB 8150
1560 REM "GOSUB 4500
1600 GOTO 1010
5000 END 
7200 REM "FIND UNIQUE ITEM # FROM OSU XREF FILE
7203 IF U28_OLD_ITEM$=DIM(15) THEN OITEM$=""; GOTO 7208 ELSE GOSUB 7400 ! SP 221600
7204 OKY$=UO1_PREFIX$+U28_OLD_ITEM$+DIM(5); REM " SSP 221600
7206 FIND (Z[28],KEY=OKY$,DOM=7208)IOL=0360; U27_PRODUCT_NUMBER$=OSU2$,OITEM$=U28_OLD_ITEM$ ! SSP 221600
7208 SKY$=U1_PREFIX$+U2_STOCK_BUTTED$+DIM(5); REM " SUPPLIER ITEM
7210 FIND (Z[28],KEY=SKY$,DOM=*NEXT)IOL=0360; GOTO 7230
7215 OSU1$=SKY$,OSU2$=U27_PRODUCT_NUMBER$,OSU3$=DATE$,OSU4$=OITEM$
7230 U27_PRODUCT_NUMBER$=OSU2$
7235 ! F U27_PRODUCT_NUMBER$<>OSU2$ THEN ESCAPE ELSE U27_PRODUCT_NUMBER$=OSU2$
7250 RETURN 
7400 REM "STRIP OLD ITEM NUMBER SSP 221600
7405 U28_OLD$=STP(U28_OLD_ITEM$,2),U28_HOLD$=""
7410 FOR IIND=1 TO LEN(U28_OLD$)
7415 IF POS(U28_OLD$(IIND,1):"_./")>0 THEN GOTO 7430
7420 U28_HOLD$=U28_HOLD$+U28_OLD$(IIND,1)
7430 NEXT IIND
7440 UO1_PREFIX$=U28_HOLD$(1,3),U28_OLD_ITEM$=U28_HOLD$(4,12),OITEM$=U28_HOLD$
7450 RETURN 
7500 REM "Convert date Q$ into Q0$                                              
7501 REM "Q$ in YYYYMMDD format or YYMMDD                                       
7505 Q0$=""
7506 Q$=STP(Q$,1)
7507 IF Q$="" THEN GOTO 7549
7508 ! IF Q$(1,2)="06" THEN Q$(1,2)="07"
7510 IF LEN(Q$)=8 THEN GOTO 7520 ELSE IF LEN(Q$)=6 THEN D1$=STR(NUM(Q$(1,2)):"0 0") ELSE GOTO 7549
7515 IF D1$<"50" THEN Q$="20"+Q$ ELSE Q$="19"+Q$
7520 Q0$=CHR(NUM(Q$(1,3),ERR=7521)-125)+Q$(4,1)+Q$(5,2)+Q$(7,2)
7549 RETURN 
7600 REM " READ PRODUCT CLASS
7699 RETURN 
8000 REM "GET THE THREE CHARACTER PRODUCT CODE FROM PC2
8010 DIM PC2$(64); READ (Z[1],KEY=OSP_PARMS$(58,10)+U8_PROD_CLASS$+DIM(6),DOM=8040)PC2$
8020 DIM PC$(4); PC$=PC2$(56,3)
8030 RETURN 
8040 REM "IF ERROR
8045 IF ERR=11 THEN PC$=DEFAULTS$(9,3); GOTO 8049
8049 RETURN 
8100 REM "GOSUB here, once, at the beginning, after the background is set and before the Proceed? question. Set T to total # to do (by calling ZZINFO) and T0 to the reporting interval (report every T0 number of records) this is typically 2% of total; This also prints a message (@8115),so adjust accordingly
8107 T=0
8113 CALL "ZZ2FNC;SERIALRECCNT",32501,T
8115 IF %GUI=0 THEN PRINT @(10,16),"There are "+STR(T)+" records to process"
8116 REM "PRINT @(10,17),"Start Time: ",DAY,"   ",STR(TIM*100:"00:00")
8129 REM "Set T0, we make sure T0 is > 1, because later on we MOD and look for avalue of 1. IF T0 is 1, then nothing would get reported. We look for a result of 1 because this causes the first record to automatically start the reporting instead of waiting until the T0'th record to get the first report
8130 T0=INT(T*.02); IF T0<=1 THEN T0=2
8145 RETURN 
8150 REM "Call this each time to update the bar graph. Display horiz. bar graph given total #, T and current #, C, and time counter T1 (T1 is init'ed here and used here, just don't use it somewhere else)
8155 CALL "ZZBARG",X3$,"H",19,10,50,T1,T,C
8195 RETURN 
8200 REM "Just like 8100, but for second phase
8202 CALL "ZZINFO",Z[4],T9,X3$,T4,T0,K,B,D,S0,S1,F$
8204 CALL "ZZINFO",Z[5],T9,X3$,T7,T0,K,B,D,S0,S1,F$
8206 CALL "ZZINFO",Z[7],T9,X3$,T5,T0,K,B,D,S0,S1,F$
8208 ZX=32501
8210 CALL "ZZINFO",ZX,T9,X3$,T,T0,K,B,D,S0,S1,F$
8212 IF DEFAULTS$(13,1)="Y" THEN T=T+T4+T7+T5
8215 C=0,T1=0
8230 T0=INT(T*.02); IF T0<=1 THEN T0=2
8245 RETURN 
8950 DEF FNS$(Z9$)=Z9$(1,POS("     "=Z9$+"     ")-1)
9000 REM "ERROR PROCESSING
9001 ESCAPE 
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 REM SSP 192075 If Consumer only price, make the cost zero
56001 REM "191073-Changes to SPR download program to correct OS5 column and
56002 REM "203458-Addition of S.P. Richards to TOPS module                    
56003 REM 206721 - SP Richards Price plans are always three long...if consumer and A(ll) needed to move one space
