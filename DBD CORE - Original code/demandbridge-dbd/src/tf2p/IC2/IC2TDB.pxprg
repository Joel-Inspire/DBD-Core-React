0010 REM "Inventory Transaction Entry - II <IC2TDB>
0035 REM "5.7 - 03/30/15 - 11.504722 - tma - SSP# 275719
0037 REM "275719-IC transaction entry screen is not painting properly when   
0040 REM "Copyright 2015 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 SETERR 9000; SETESC 9300
0120 DIM S$(10),G$(20),G[1]
0130 REM "set I0 
0131 DIM X$(20,"X"); CALL "ZZDISP","AX",X$,"I/C",X3$,X1$,"",0,0,X4$
0132 I0=8+V1+LEN(X1$),X$="",X1$="",X0$="IC2TDB"
0140 M0$="##,###,###.00-",M1$="###,###.00-",M2$="####0",M9$="00000    "
0280 IF D9$="*" THEN GOTO 6525
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0310 IOLIST A,B$,B[0],B[1],B[2],B[3],B[4]
0311 IOLIST A,B$,B[0],STR(B[1]),B[2],B[3],B[4]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4]
0330 IOLIST C$
0331 IOLIST C0$
0332 IOLIST C1$
0340 IOLIST D$,D[0],D[1],D[2]
0350 IOLIST E$,E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15],E[16],E[17],E[18],E[19],E[20]
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14],F[15],F[16]
0370 IOLIST G$,G[0],G[1]
0380 IOLIST H$,H[0],H[1],H[2]
0390 IOLIST K$,K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],K[8],K[9],K[10],K[11],K[12] ! SSP#236215
0430 GOSUB 6800
0500 REM "SET-UP
0505 A1=16,A2=1
0510 A3=INT((22-A1)/A2),A4=1,Y9=2,K8=LEN(A1$),Y$=""
0520 DIM X[2],Y[6],T[3]
0525 IF A0=0 THEN U1=7,U2=U1,A9$=""; GOSUB 5200; GOTO 0800
0530 IF A0=0 THEN GOTO 0800
0540 GOSUB 5100
0550 L=1; GOTO 6425
0560 X[0]=1
0590 GOTO 1125
0800 REM "NEW ENTRY
0810 Y$=""
0830 X[0]=1; GOTO 1125
1000 REM 
1045 B$(1,LEN(B1$))=A1$; IF A1$="" THEN B$(1,LEN(K9$))=K9$
1100 REM "SELECT LINE
1110 GOTO 7000
1125 A6=0,A4=X[0]
1129 IF A4=0 THEN GOTO 7000
1130 A4=X[0],Y=(A4-1)*Y9+1; IF Y>LEN(Y$) THEN Y=-1,A4=LEN(Y$)/Y9+1,X[0]=A4
1132 PRINT @(0,7),A4:"##0",
1135 IF Y<0 THEN GOTO 1200
1140 A5=DEC(Y$(Y,Y9))
1150 READ (F,IND=A5)IOL=0310
1160 GOSUB 6200
1165 REM "TO AVOID DISPLAY; GOTO 1400 HERE!!!
1170 IF POS(BIN(A4,Y9)=L0$,Y9)>0 THEN GOTO 1400
1175 GOSUB 7300; GOTO 1400
1200 REM "NEW LINE
1210 IF A9<=0 THEN GOSUB 5200 ELSE GOSUB 5200
1220 Y$=Y$+BIN(A9,Y9),A6=1,A5=A9,A=-1,A9=-1,C6=1
1280 GOSUB 6800; GOSUB 6200
1290 GOTO 1400
1310 C0=-C0
1400 REM "MAINTAIN ENTRY
1490 GOTO 2000
1500 REM "OPTIONS (DISPLAY)
1510 C0=ABS(C0)
1515 C0=ABS(C0)
1520 IF C0=1 THEN GOTO 1125 ELSE GOTO 7000
1580 GOTO 2000
1600 REM "
1800 REM "PRIOR LINE
1810 IF X[0]>1 THEN X[0]=X[0]-1
1820 GOTO 1125
1900 REM "Finished with line
1950 REM "
1955 IF T<>0 OR U=1 THEN GOSUB 6700
1965 IF C0=3.2 THEN X[0]=X[0]-2
1968 IF A7=1 THEN GOSUB 5700
1970 IF C6=1 THEN C0=0,C6=0
1972 REM 
1973 REM 
1975 IF C0=4 AND U=0 THEN GOTO 7000 ELSE X[0]=X[0]+1; GOTO 1125
2000 REM "DATA SEQ
2010 C0=0,D9=1,X0=-1,X1=1,T=0,U=0,Q$="?"; IF Y<0 OR A7=1 THEN T=-1,X0=0
2020 X$="",C0=ABS(C0); IF C0=2 AND X0=0 THEN X0=999; GOTO 2040 ELSE IF C0=2 THEN X0=X0-1 ELSE X0=X0+1; IF C0=2 AND X0=0 THEN X[0]=X[0]-1; GOTO 1100
2025 IF C0>3 OR X0<0 THEN X0=999
2030 IF X0>0 THEN IF T=0 THEN T=-1; GOSUB 7200
2040 ON X0 GOTO 2050,2100,2150,2200,2250,2300,2700,2350,2400,2450,2500,2550,2600,2650,1900
2050 REM "STATUS
2055 C0=0,Q$="?",X$="MDNPLEIA"
2060 C1=1
2062 IF C1>1 THEN GOTO 5800
2070 IF T=0 THEN T=-1; GOSUB 7200
2090 GOTO 2020
2100 REM "Transaction type
2105 PRINT @(0,22),'CL',
2106 X$="T=transfer, R=receive, A=adjust, P=purchase order, C=commit"
2107 X$=X$(1,31); IF GB$="Y" THEN X$=X$+", W=adjust waste"
2108 IF B$(57,1)="W" THEN B$(1,1)="W",B$(57,1)=""
2110 CALL "ZZENTR","SRUX",B{ALL},B$,X4$,X3$,6,7,1,1,C0,"","{1"+X$,"TRAW ","IC2TDA02","","",""; IF ABS(C0)>4 THEN GOTO 6500
2111 IF B$(1,1)="W" THEN B$(1,1)="A",B$(57,1)="W"
2112 IF ABS(C0)=2 THEN GOTO 2110
2115 IF Y<0 THEN IF U=0 AND C0<0 AND (ABS(C0)=2 OR ABS(C0)=4 OR INT(ABS(C0))=3) THEN C7=1; GOTO 5400
2116 REM 
2117 IF B$(1,1)=" " THEN GOTO 2110
2120 GOSUB 7500
2129 REM "Force insert into line"
2130 IF X9=-4 AND U=0 THEN IF ABS(C0)>1 THEN GOTO 2106 ELSE X9=0
2140 GOTO 2020
2150 REM "Transaction date
2158 U=1
2159 IF C0<>2 THEN GOTO 2020
2160 CALL "ZZENTR","D",B{ALL},B$,X4$,X3$,19,7,2,6,C0,"","{3"+X$,"","IC2TDA04","","",""; IF ABS(C0)>4 THEN GOTO 6500
2190 GOTO 2020
2200 REM "Location
2205 IF POS(" "<>B$(8,4))<>0 AND C0<>2 THEN GOTO 2020
2206 IF POS(" "<>B$(8,4))<>0 THEN IF E$(112,1)="Y" THEN GOTO 2020
2209 REM "mod cwj 3/20/98 SSP# 96568 - fix location entry to all entry
2210 CALL "ZZENTR","SZX",B{ALL},B$,X4$,X3$,38,6,8,4,C0,"","{3"+X$,"D"+DIM(10),"IC2TDA06","FM0D","FM2SKA",""; IF ABS(C0)>4 THEN GOTO 6500; REM "SSP#207767
2215 IF C0=-2 THEN GOTO 2240
2219 REM "
2220 FIND (Z[3],KEY="D"+S$(1,10)+B$(8,4),DOM=2210)IOL=0330
2225 W$=C$,W0=44,W1=6; GOSUB 7550
2240 GOTO 2020
2250 REM "Vendor
2255 IF POS(B$(1,1)="RP")=0 THEN B$(12,14)=""; PRINT @(38,7),B$(12,14),@(60,7),'CL',; GOTO 2020
2257 IF POS(" "<>B$(12,10))<>0 AND C0<>2 THEN X0=X0+1; GOTO 2020
2260 CALL "ZZENTR","AUX",B{ALL},B$,X4$,X3$,38,7,12,10,C0,"A/P","{3"+X$,"","IC2TDA08","AP4","X",""; IF ABS(C0)>4 THEN GOTO 6500
2261 IF C0=-2 THEN GOTO 2290
2265 IF C0<0 AND POS(B$(1,1)="RP")=0 THEN GOTO 2275
2270 FIND (Z[4],KEY=B$(12,10),DOM=2260)IOL=0340
2275 DIM W$(129); W$(16,35)=D$(11,35),W$(111,18)=D$(106),W0=20,W1=22; GOSUB 7550
2290 GOTO 2020
2300 REM "Plant
2305 IF POS(" "<>B$(12,10))=0 THEN GOTO 2020 ELSE J$="P"+B$(12,10)
2310 CALL "ZZENTR","SUZX",B{ALL},B$,X4$,X3$,60,7,22,4,C0,"","{3"+X$,J$,"IC2TDA10","FM0P","X",""; IF ABS(C0)>4 THEN GOTO 6500
2311 IF C0=-2 THEN GOTO 2340
2315 IF POS("0"<>B$(22,4))=0 THEN B$(22,4)=""
2316 IF POS(" "<>B$(22,4))=0 THEN PRINT @(60,7),'CL',; GOTO 2340
2320 FIND (Z[3],KEY=J$+B$(22,4),DOM=2310)IOL=0331
2325 W$=C0$,W0=20,W1=22; GOSUB 7550
2340 GOTO 2020
2350 REM "Item code
2354 IF POS(" "<>B$(36,10))<>0 THEN IF E$(112,1)="Y" THEN GOTO 2020
2355 IF P0$(38,1)="Y" THEN J0=36,J1=10,J$=B$(26,10),J0$="ICE" ELSE J0=26,J1=20,J$="",J0$="I/C"
2360 CALL "ZZENTR","AUX",B{ALL},B$,X4$,X3$,6+V1,10,J0,J1,C0,J0$,"{3"+X$,J$,"IC2TDA12","IC0","IC2MAB",""; IF ABS(C0)>4 THEN GOTO 6500
2365 IF C0=-2 THEN GOTO 2390
2370 FIND (Z[5],KEY=B$(26,20),DOM=2360)IOL=0350
2375 IF C0>0 THEN GOSUB 8115
2380 IF C0>0 THEN IF P4$(241,1)="Y" THEN X=16; CALL "FS2DAI",X3$,B$(26,20),X
2390 GOTO 2020
2400 REM "Quantity
2405 IF P0$(44,1)="Y" AND E$(112,1)="Y" AND POS(B$(1,1)="TRA")<>0 THEN GOSUB 8200; GOTO 8600
2408 IF B$(1,1)="A" THEN X$="To reduce inventory, enter negative (-) quantity"
2410 CALL "ZZENTR","NX.",B{ALL},B$,X4$,X3$,6,13,0,822,C0,M0$,"{3"+X$,"","IC2TDA14","","",""; IF ABS(C0)>4 THEN GOTO 6500
2415 IF C0>0 THEN GOSUB 7700
2440 GOTO 2020
2450 REM "Cost
2454 IF P0$(44,1)="Y" AND E$(112,1)="Y" AND POS(B$(1,1)="TRA")<>0 THEN GOTO 8600
2455 IF POS(B$(1,1)="TC")<>0 THEN GOTO 2020
2460 PRECISION M6[1]; CALL "ZZENTR","NX&",B{ALL},B$,X4$,X3$,21,13,1,M6[0],C0,M6$,"{3"+X$,"","IC2TDA16","","",""; PRECISION 2; IF ABS(C0)>4 THEN GOTO 6500
2465 IF C0>0 THEN GOSUB 7700
2490 GOTO 2020
2500 REM "Unit of measure
2504 IF P0$(44,1)="Y" AND E$(112,1)="Y" AND POS(B$(1,1)="TRA")<>0 THEN GOTO 2540
2505 O0=B[2]
2510 CALL "ZZENTR","SUX",B{ALL},B$,X4$,X3$,34,13,46,4,C0,"","{3"+X$,"U/M","IC2TDA18","U/M","X",""; IF ABS(C0)>4 THEN GOSUB 8150; GOTO 6500
2515 IF C0<0 THEN GOTO 2540
2520 DIM G$(20),G[1]; FIND (Z[13],KEY="U/M"+B$(46,4),DOM=2510)IOL=0370
2536 GOSUB 8160
2540 GOTO 2020
2550 REM "Qty per UM
2551 IF G$(20,1)="Y" THEN GOTO 2020
2554 IF P0$(44,1)="Y" AND E$(112,1)="Y" AND POS(B$(1,1)="TRA")<>0 THEN GOTO 2590
2555 O0=B[2]
2560 CALL "ZZENTR","NX",B{ALL},B$,X4$,X3$,41,13,2,500,C0,M2$,"{3"+X$,"","IC2TDA20","","",""; IF ABS(C0)>4 THEN GOTO 6500
2570 GOSUB 7900; GOSUB 7700
2590 GOTO 2020
2600 REM "Extension
2605 IF B[0]<>0 OR B[1]<>0 OR B$(1,1)<>"A" OR E$(112,1)="Y" THEN GOTO 2020
2610 CALL "ZZENTR","N",B{ALL},B$,X4$,X3$,50,13,3,621,C0,M1$,"{3"+X$,"","IC2TDA22","","",""; IF ABS(C0)>4 THEN GOTO 6500
2640 GOTO 2020
2650 REM "Transfer to location
2655 IF B$(1,1)<>"T" THEN GOTO 2020
2657 IF POS(" "<>B$(50,4))<>0 THEN IF E$(112,1)="Y" THEN GOTO 2670
2659 W9$=B$(50,4)
2660 CALL "ZZENTR","SZX",B{ALL},B$,X4$,X3$,71,13,50,4,C0,"","{3"+X$,"D"+S$(1,10),"IC2TDA24","FM0D","",""; IF ABS(C0)>4 THEN GOTO 6500
2665 IF B$(50,4)=B$(8,4) THEN GOTO 2660
2666 FIND (Z[3],KEY="D"+S$(1,10)+B$(50,4),DOM=2660)
2667 IF X3$(43,2)<>"SU" AND B$(50,1)="9" AND B$(8,1)<>"9" OR (X3$(43,2)<>"SU" AND B$(50,1)<>"9" AND B$(8,1)="9") THEN GOTO 2660
2668 IF C0=-2 THEN GOTO 2690
2670 GOSUB 8700
2675 REM "LET W$=C1$,W0=20,W1=22; GOSUB 7550
2690 GOTO 2020
2700 REM "Customer #
2705 IF C0<>2 OR P0$(38,1)<>"Y" THEN GOTO 2020
2706 IF POS(" "<>B$(26,10))<>0 THEN IF E$(112,1)="Y" THEN GOTO 2020
2710 CALL "ZZENTR","AXU",B{ALL},B$,X4$,X3$,1,10,26,10,C0,"A/R","{3"+X$,"","IC2TDA13","AR1","X",""; IF ABS(C0)>4 THEN GOTO 6500
2711 IF C0=-2 THEN GOTO 2740
2720 IF POS(" "<>B$(26,10))=0 THEN GOTO 2740
2730 FIND (Z[7],KEY=B$(26,10),DOM=2710)C0$
2735 PRINT @(20,22),C0$(11,35),'CL',
2740 GOTO 2020
4900 REM "END OF LINES
4910 Y[4]=-1; WRITE (F,IND=0)IOL=0290
4920 CALL "ZZEXPF",X3$,X4$,"X"+STR(F),"",G9; IF G9>0 THEN GOTO 7000
4925 EXTRACT (F,IND=0)IOL=0290
4930 Z=NUM(FIN(F,"MAXREC")); Y[3]=Z-1
4935 Y[4]=-2; WRITE (F,IND=0)IOL=0290
4940 GOTO 5230
4980 GOTO 7000
5000 REM "LINE LINE Z0 TO LINE Z1
5010 Y=(Z0-1)*Y9+1; IF Y>LEN(Y$) OR Y<1 THEN GOTO 5090 ELSE Z9=DEC(Y$(Y,Y9))
5012 Y=(Z1-1)*Y9+1; IF Y>LEN(Y$) OR Y<1 THEN Z8=-1 ELSE Z8=DEC(Y$(Y,Y9))
5015 READ (F,IND=Z9)IOL=0310
5020 IF Z1>LEN(Y$)/Y9 THEN Z8=-1
5030 IF A<>Z8 THEN A=Z8; WRITE (F,IND=Z9)IOL=0311
5095 RETURN 
5100 REM "BUILD INDEX STRING
5105 Y$="",Y=A0
5120 IF Y<=0 THEN GOTO 5195 ELSE Q$=BIN(Y,Y9); IF POS(Q$=Y$,Y9)=0 THEN Y$=Y$+Q$ ELSE GOTO 5195
5130 READ (F,IND=Y,END=5131)Y; GOTO 5120
5140 IF Y$>"" THEN Y$=Y$(1,LEN(Y$)-Y9)
5195 RETURN 
5200 REM "GET NEXT INDEX TO FILE IN A9
5205 IF A9$>"" THEN A9=DEC(A9$(1,Y9)),A9$=A9$(Y9+1); GOTO 5290
5210 EXTRACT (F,IND=0,ERR=5295)IOL=0290
5215 IF Y[4]=-2 THEN READ (F); WAIT 0; GOTO 5210
5220 Y[4]=-2; WRITE (F,IND=0)IOL=0290
5230 IF Y[1]<1 THEN A9=Y[2],Y[2]=Y[2]+1; GOTO 5260
5255 A9=Y[1]; READ (F,IND=A9)Y[1]
5260 IF Y[0]<Y[3] THEN Y[0]=Y[0]+1,Y[4]=-1 ELSE Y[2]=Y[2]-1; GOTO 4900
5270 IF U1>0 THEN U1=U1-1,A9$=A9$+BIN(A9,Y9); IF U1>0 THEN GOTO 5230
5280 WRITE (F,IND=0)IOL=0290
5285 IF A0=0 THEN A0=A9
5290 RETURN 
5295 IF ERR<>0 THEN GOTO 9000 ELSE RETRY 
5300 REM "REMOVE INDEX Z
5302 REM IF POS(BIN(Z,Y9)=A9$,Y9)>0 THEN ESCAPE
5305 IF U2>0 THEN A9$=BIN(Z,Y9)+A9$; GOTO 5360
5310 EXTRACT (F,IND=0)IOL=0290
5315 IF Y[4]=-2 THEN READ (F); WAIT 0; GOTO 5310 ELSE Y[4]=-2
5320 WRITE (F,IND=0)IOL=0290
5330 WRITE (F,IND=Z)Y[1]
5340 Y[1]=Z,Y[4]=-1,Y[0]=Y[0]-1
5350 WRITE (F,IND=0)IOL=0290
5360 Q0$=BIN(Z,Y9),Q=POS(Q0$=Y$,Y9); IF Q=0 THEN GOTO 5390
5365 Y$=Y$(1,Q-1)+Y$(Q+Y9)
5390 RETURN 
5395 ON ERR GOTO 5310,5311,9000
5400 REM "DELETE CURRENT LINE
5405 Z0=A4-1,Z1=A4+1,A5=DEC(Y$((A4-1)*Y9+1,Y9))
5410 IF T=0 THEN T=-1; GOSUB 7200
5415 GOSUB 5000; Z=A5
5417 IF Q$="D" THEN READ (F,IND=Z)IOL=0310
5418 IF Q$="D" OR T=0 THEN IF P0$(44,1)="Y" THEN CALL "IC2TB1",X3$,X4$,Z[10],A$,B$,Z
5420 GOSUB 5300
5430 GOSUB 6800
5435 IF ABS(C0)=3.2 THEN C0=2 ELSE IF ABS(C0)=3.1 THEN C0=4
5485 IF C7=1 THEN C7=0,C0=ABS(C0); IF C0=2 THEN X[0]=X[0]-1; D9=0; GOTO 1120 ELSE GOTO 7000
5490 IF Q$="D" THEN GOSUB 5700; GOTO 6100 ELSE GOTO 1125
5495 X[0]=999,D9=0; GOTO 1120
5500 REM "INSERT CURRENT LINE
5510 GOSUB 5200
5515 Y$=Y$(1,Y-1)+BIN(A9,Y9)+Y$(Y),A5=A9,A9=-1
5520 GOSUB 6800
5530 A6=1,X[0]=A4,A7=1
5540 WRITE (Z[2],IND=A5)IOL=0311; Q$="I"; GOSUB 6000; A4=X[0]
5590 GOTO 1160
5600 REM "TACK ON LINE TO END
5610 Z7=A8; IF Z7=0 THEN GOTO 5635
5620 READ (F,IND=Z7)IOL=0310
5625 A=Y[A5],Z8=0
5630 WRITE (F,IND=Z7)IOL=0311
5635 Z8=0
5690 RETURN 
5700 REM "DISPLAY AFTER DELETE/INSERT
5705 IF A7=1 THEN GOSUB 7300; A7=0; GOTO 5750
5710 IF L0$>"" THEN Z=DEC(L0$(1,Y9)); GOSUB 6000
5750 RETURN 
5800 REM "LINE CONTROL
5810 IF T<>0 THEN T=1; GOSUB 7200; T=0
5820 IF C0=2 THEN GOTO 1100
5880 ON POS(Q$="?DNPLEIA") GOTO 2060,2020,5400,1900,1800,6400,7000,5500,5495
5900 REM "Reset reserved links as avail
5910 Z=DEC(A9$(1,Y9)); GOSUB 5310
5915 A9$=A9$(Y9+1); IF A9$>"" THEN GOTO 5910 ELSE RETURN 
6000 REM "DISPLAY PAGE @ LINE Z
6002 IF Z<=0 THEN Z=1
6005 Y0=(Z-1)*Y9+1,L0=0,J1=Z,L0$="",L2=0,L2$=""
6010 PRINT @(0,A1),'CE',
6020 IF Y0>LEN(Y$) THEN Z=Z-1,A4=Z,L0$=""; GOTO 7320 ELSE IF Y0<1 THEN GOTO 6090
6022 IF Q$="I" AND A4=L1 THEN GOTO 6040
6025 READ (F,IND=DEC(Y$(Y0,Y9)))IOL=0310
6030 GOSUB 6600; GOSUB 6300
6040 L2$=L2$+CHR(1)+CHR(L0+A1)+CHR(3)+STR(J1:"##0")
6080 L0$=L0$+BIN(J1,Y9),L0=L0+1,J1=J1+1,Y0=Y0+Y9
6085 IF Y0>LEN(Y$) THEN L2=1 ELSE IF L0<A3 THEN GOTO 6022
6090 READ (F,IND=A5)IOL=0310
6095 RETURN 
6100 REM "SELECT LINE ROUTINE
6105 IF Y$="" THEN GOTO 7000 ELSE L1=DEC(L0$(1,Y9)),L2=DEC(L0$(LEN(L0$)-Y9+1,Y9)),X8=A4-L1
6106 C1$="004018012014001"
6110 CALL "ZZSLCT",X3$,"CX",C1$,"",L2$,"{4","",X8,X9,A4; A4=A4+L1,X[0]=A4,X0=A4,Y=(A4-1)*Y9+1; IF X9=-5 THEN Q$="D"; GOSUB 6170; ON S3 GOTO 6111,6110 ELSE IF X9=-4 THEN Q$="I" ELSE IF X9=-3 THEN X9=0 ELSE IF X9=-6 THEN X9=0
6112 IF X9<0 THEN ON -X9 GOTO 6115,6113,7000,6113,5500,5400,6120
6115 IF X9=0 THEN IF A4>=0 AND A4<=L2 THEN X0=A4; GOTO 7100
6120 IF X9<0 THEN A4=L1 ELSE Y=(A4-1)*Y9+1; IF A4>LEN(Y$)/Y9 THEN GOTO 7000
6130 X0=A4
6150 IF X9=1 AND L1=1 THEN X8=0; GOTO 6110 ELSE IF X9=1 THEN Z=DEC(L0$(1,Y9))-1 ELSE Z=LEN(L0$)-Y9+1,Z=DEC(L0$(Z,Y9))+1
6155 Z=INT(Z/A3)*A3; IF Z=0 THEN Z=1
6160 GOSUB 6000
6165 X8=A4-J1+1; GOTO 6105
6170 X$="",X8=A4-J1; CALL "ZZPROM","L2",X3$,0,X$,"","",0; X$=X$+" ( #"+STR(A4)+" )"
6175 CALL "ZZPROM","Y",X3$,S3,X$,"","",0
6180 RETURN 
6200 REM "PRINT ONE ENTRY
6210 GOSUB 6600
6220 PRINT @(6,7),B$(1,1),
6221 GOSUB 7500
6224 CALL "ZZDISP","D ",B$(2,6),"",X3$,"","",19,7,X4$
6228 PRINT @(38,6),B$(8,4),
6229 W$=C$,W0=44,W1=6; GOSUB 7550
6232 CALL "ZZDISP","A ",B$(12,10),"A/P",X3$,"","",38,7,X4$
6236 PRINT @(60,7),B$(22,4),
6238 IF P0$(38,1)="Y" THEN CALL "ZZDISP","A",B$(26,10),"A/R",X3$,"","",1,10,X4$
6240 CALL "ZZDISP","A ",B$(26,20),"I/C",X3$,"","",6+V1,10,X4$
6242 GOSUB 7800
6244 PRINT @(6,13),B[0]:M0$,@(21,13),B[1]:M6$,@(34,13),B$(46,4),@(41,13),B[2]:M2$,@(50,13),B[3]:M1$,@(71,13),B$(50,4),
6280 REM 
6290 RETURN 
6300 REM "DISPLAY ONE LINE
6302 GOSUB 6600
6304 L0=L0
6305 PRINT @(1,L0+A1),J1:"##0",; IF GB$="Y" THEN PRINT @(5,L0+A1),B$(57,1), ELSE PRINT @(5,L0+A1),B$(1,1),
6310 GOSUB 7750
6315 PRINT @(54,L0+A1),B[0]:M0$,
6320 W2$=FNS$(B$(46,4)); PRINT @(74-LEN(W2$),L0+A1),W2$,"/",FNR$(STR(B[2]:M2$)),
6390 RETURN 
6400 REM "LIST OPTION
6405 L=1
6410 CALL "ZZPROM","L3",X3$,S3,"","","V",X; ON S3 GOTO 6411,7000
6415 IF S3<0 THEN IF (X-1)*Y9+1>LEN(Y$) THEN X=LEN(Y$)/Y9-1 ELSE IF X<=0 THEN X=1
6420 IF S3<0 THEN L=X+1
6425 Z=L-1; GOSUB 6000
6430 IF L2=1 THEN GOTO 7000 ELSE L=L+L0; GOTO 6410
6460 GOTO 6410
6500 REM "RE-DO SCREEN
6505 D9$="*"
6510 GOSUB 6700
6520 L0=3; RUN "IC2TDA"
6525 D9$="",Z=INT(A4/A3)*A3; IF Z=0 THEN Z=1; IF C0>4 THEN C0=C0-5
6530 GOSUB 6000; GOSUB 7280; IF D9=0 THEN GOTO 1100
6535 PRINT @(0,7),A4:"##0",
6540 READ (F,IND=A5)IOL=0310
6542 IF X0=7 THEN GOSUB 8100; GOSUB 8150
6545 GOSUB 6200
6548 IF X0=13 THEN GOTO 2661
6550 ON C0 GOTO 2040,2020
6600 REM "ALTERNATE DATA READS FOR 1 LINE
6605 DIM C$(214),D$(310),D[2],E$(139),E[20],F$(65),F[16],G$(20),G[1]
6610 FIND (Z[3],KEY="D"+S$(1,10)+B$(8,4),DOM=6611)IOL=0330
6615 FIND (Z[4],KEY=B$(12,10),DOM=6616)IOL=0340
6620 FIND (Z[3],KEY="D"+B$(12,10)+B$(22,4),DOM=6621)IOL=0331
6625 FIND (Z[5],KEY=B$(26,20),DOM=6626)IOL=0350
6630 FIND (Z[3],KEY="D"+S$(1,10)+B$(50,4),DOM=6631)IOL=0332
6635 FIND (Z[6],KEY=B$(26,20)+B$(12,14),DOM=6636)IOL=0360
6640 FIND (Z[13],KEY="U/M"+B$(46,4),DOM=6641)IOL=0370
6645 FIND (Z[8],KEY=B$(26,20)+B$(8,4),DOM=6646)IOL=0380
6690 RETURN 
6700 REM "WRITE CURRENT LINE
6710 IF A=0 THEN A=DEC(Y$(Y+Y9,Y9))
6715 IF D9$<>"*" THEN T=1; GOSUB 7200; T=0
6720 WRITE (F,IND=A5)IOL=0311; Z=A,Q=Y
6725 IF A6<>0 THEN Z0=A4-1,Z1=A4; GOSUB 5000; READ (F,IND=A5)IOL=0310
6760 IF Z<0 THEN A6=1 ELSE A6=0
6780 IF D9$="" THEN IF A7<>1 THEN GOSUB 7300
6790 RETURN 
6800 REM "SET-UP DATA FOR 1 LINE
6810 B1$=B$
6820 DIM B$(57),B[4],C$(214),D$(310),D[2],E$(139),E[20],F$(65),F[16],G$(20),G[1],H$(24),H[2]
6825 B$(2,6)=X3$(15,6),F0$=""
6827 IF A$(53,3)="   " THEN A$(53,3)="000",B$(54,3)="000" ELSE A$(53,3)=STR(NUM(A$(53,3))+1:"000"); B$(54,3)=A$(53,3)
6830 IF B1$>"" THEN B$(1,25)=B1$(1,25)
6840 IF GB$="Y" THEN B$(1,1)="W"
6880 GOSUB 6600
6895 RETURN 
6900 REM "SET LAST LINE TO NO LINK
6905 IF Y$="" THEN A0=0; GOTO 6945 ELSE A5=DEC(Y$(LEN(Y$)-1,2)),A0=DEC(Y$(1,Y9))
6910 READ (F,IND=A5)IOL=0310
6940 A=-1; WRITE (F,IND=A5)IOL=0311
6945 RETURN 
6950 WRITE (F,IND=A5)IOL=0311
6960 PRINT @(38,6),'CL',@(0,7),'CL',
6965 PRINT 'SB',@(30,7),"Vendor:",@(53),"Plant:",'SF',
6970 PRINT @(0,10),'CL',@(0,13),'CL',
6990 RETURN 
7000 REM "END OF ENTRIES
7005 GOSUB 6900
7010 Z9=2,Z8=1
7020 GOSUB 6950
7030 CALL "ZZPROM","8",X3$,S3,"","","V",X0
7040 ON S3+1 GOTO 7100,7050,7060,5495,6400,6100
7055 IF T[0]<>0 THEN CALL "ZZ2PRM","J1",X3$,S3,"","","",0; ON S3 GOTO 7000,7060,7060
7060 L0=1; IF S3=1 THEN L0=2
7070 IF A9$>"" THEN GOSUB 5900
7075 J1=0
7080 RUN "IC2TDA"
7100 REM "GOTO LINE NUMBER X0
7105 IF X0<=0 THEN X0=1
7110 X[0]=X0; GOTO 1125
7200 REM "TOTAL LOGIC (T= 1 OR -1)
7290 RETURN 
7300 REM "Display logic
7310 Q=POS(BIN(A4,Y9)=L0$,Y9),L0=INT(Q/Y9); IF Q>0 THEN GOTO 7400
7311 L0=INT((LEN(L0$)+1)/Y9)
7312 L2$=L2$+CHR(1)+CHR(L0+A1)+CHR(3)+STR(A4:"##0")
7315 IF BIN(A4,Y9)>=L0$ THEN IF LEN(L0$)/Y9<A3 THEN L0$=L0$+BIN(A4,Y9); GOTO 7310
7320 Z=INT(A4/A3)*A3; IF Z=0 THEN Z=1
7330 IF Y$>"" THEN GOSUB 6000
7390 IF X0>0 THEN X0=X0-0
7395 RETURN 
7400 REM "Lines section - display line a4
7410 Q=INT(Q/Y9),L0=Q,J1=A4
7440 GOSUB 6300
7490 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7505 ON POS(B$(1,1)="TCRAP") GOTO 7535,7510,7515,7520,7525,7530
7510 PRINT @(7,7),"-Transfer"; GOTO 7540
7515 PRINT @(7,7),"-Commit  "; GOTO 7540
7520 PRINT @(7,7),"-Receipt "; GOTO 7540
7525 PRINT @(7,7),"-Adjust  "; GOTO 7540
7530 PRINT @(7,7),"-P/O     "; GOTO 7540
7535 PRINT @(7,7),"         "
7540 RETURN 
7550 REM "Display warehouse loc in W$ at W0,W1
7555 W0$=FNS$(W$(16,35)); IF POS(" "<>W$(111,16))=0 THEN W1$="" ELSE W1$=" - "+FNS$(W$(111,16))+", "+W$(127,2)
7560 IF W0+LEN(W0$)+LEN(W1$)>80 THEN PRINT @(W0,W1),W0$,'CL', ELSE PRINT @(W0,W1),W0$,W1$,'CL',
7590 RETURN 
7700 REM "Figure extension based on quantity and cost
7710 IF G$(20,1)<>"Y" OR G[0]=0 THEN B[3]=B[0]*B[1] ELSE B[3]=B[0]*B[1]/G[0]
7720 PRINT @(50,13),B[3]:M1$,
7740 RETURN 
7750 REM "Setup display of cust # & inv # & desc
7755 IF P0$(38,1)="Y" AND POS(" "<>B$(26,10))<>0 THEN GOTO 7770
7760 CALL "ZZDISP","AX",B$(26,20),"I/C",X3$,D7$,"",0,0,X4$
7765 PRINT @(7,L0+A1),D7$," ",E$(21,40),@(54),'CL',
7769 GOTO 7790
7770 CALL "ZZDISP","AX",B$(26,10),"A/R",X3$,D8$,"",0,0,X4$
7772 CALL "ZZDISP","AX",B$(36,10),"ICE",X3$,D7$,"",0,0,X4$
7775 PRINT @(7,L0+A1),D8$,"-",D7$," ",E$(21,40),@(54),'CL',
7790 RETURN 
7800 REM "Display stuff for item code - I0 assumed as set in lines 130'S
7830 PRINT @(I0,10),E$(21,40),@(69,10),E$(124,4),@(74,10),E[15]:M2$,
7840 RETURN 
7850 REM "Set values based on new item code & display
7855 B$(46,4)=E$(124,4),B[2]=E[15]
7857 IF POS(B$(1,1)="TA")<>0 THEN B[1]=E[18] ELSE IF B$(1,1)<>"C" THEN B[1]=E[17]
7860 DIM F$(65),F[16]; FIND (Z[6],KEY=B$(26,20)+B$(12,14),DOM=7870)IOL=0360
7865 B$(46,4)=F$(55,4),B[2]=F[14],F0$="*"
7870 DIM G$(20),G[1]; FIND (Z[13],KEY="U/M"+B$(46,4),DOM=7871)IOL=0370
7874 DIM H$(24),H[2]; FIND (Z[8],KEY=B$(26,20)+B$(8,4),DOM=7875)IOL=0380
7875 PRECISION M6[1]; IF E[15]<>0 AND B$(1,1)<>"C" THEN IF H[2]<>0 THEN B[1]=H[2]*B[2]/E[15] ELSE B[1]=E[18]*B[2]/E[15]
7885 PRECISION 2; PRINT @(21,13),B[1]:M6$,@(34,13),B$(46,4),@(41,13),B[2]:M2$,
7890 RETURN 
7900 REM "Adjust cost if Trans or adj when UM changes
7910 IF O0=B[2] OR POS(B$(1,1)="TA")=0 THEN GOTO 7940
7915 B[1]=E[18]*B[2]/E[15]
7920 PRINT @(21,13),B[1]:M1$,
7940 RETURN 
8100 REM "Kludge for lookup on item code
8110 FIND (Z[5],KEY=B$(26,20),DOM=8111)IOL=0350
8115 GOSUB 7800; GOSUB 7850
8140 RETURN 
8150 REM "Kludge for UM lookup
8155 DIM G$(20),G[1]; FIND (Z[13],KEY="U/M"+B$(46,4),DOM=8156)IOL=0370
8160 IF G$(20,1)="Y" THEN IF G[0]<>0 THEN B[2]=G[0] ELSE B[2]=G[1]
8165 PRINT @(41,13),B[2]:M2$,
8180 GOSUB 7900; GOSUB 7700
8190 RETURN 
8200 REM "Lot inventory
8201 REM "If recipt or adjustment goto 8300, else if transfer goto 8400, then to 8300
8202 REM "If not, check to see if any lots exist, if not goto 8300 to receive
8203 REM "else goto 8400 to adj or transfer, transfer then goto 8300 to receive afterwards.
8205 IF A5>99999 THEN ESCAPE ELSE X$=B$(26,20)+B$(8,4)+"TR"+STR(A5:M9$)
8210 IF POS(B$(1,1)="AR")<>0 THEN GOTO 8300
8214 REM "Do any lots already exist?
8215 READ (Z[9],KEY=X$(1,24),DOM=8216)
8220 K$=KEY(Z[9],END=8300); IF K$(1,24)<>X$(1,24) THEN GOTO 8300
8225 GOTO 8400
8250 REM "Clear bottom of screen
8260 PRINT @(0,15+V0),'CE',@(1,15+V0),"Ln#",@(5,15+V0),"Tp",@(8,15+V0),"Item number/Description",@(59,15+V0),"Quantity",@(73,15+V0),"Unit",
8265 GOSUB 6700
8270 GOTO 6525
8295 RETURN 
8300 REM "Receive lots
8305 IF A5>99999 THEN ESCAPE ELSE J0$=B$(1,1)+"TR"+STR(A5:M9$),J1$=B$(26,20)+B$(8,4)+B$(2,6)+B$(12,14)
8308 IF B$(1,1)="T" THEN GOTO 8800
8309 PRINT @(0,3),'CE',
8310 CALL "IC2LAG",X3$,X4$,J0$,J1$,J0,J1,J2
8315 B[0]=J0,B[3]=J1
8316 GOSUB 8500
8390 GOSUB 6500
8395 RETURN 
8400 REM "Remove lots
8405 CALL "IC2LCA",X3$,X4$," ",12,X$,Q,C,F0
8408 PRINT @(0,12),'CE',@(0,11+V0),Z0$,@(10,12+V0),"Quantity",@(26,12+V0),"Cost",@(34,12+V0),"Unit",@(40,12+V0),"Qty/Unit",@(51,12+V0),"Extension",@(64,12+V0),"Transfer to Loc",@(0,14+V0),Z0$,@(1,15+V0),"Ln#",@(5,15+V0),"Tp",@(8,15+V0),"Item number/Description",@(59,15+V0),"Quantity",@(73,15+V0),"Unit", ! SSP#275719
8410 B[3]=C; IF B$(1,1)="T" THEN B[0]=Q ELSE B[0]=-Q
8411 GOSUB 8500
8415 PRINT @(6,13),B[0]:M0$,@(21,13),B[1]:M6$,
8440 GOSUB 8250
8495 RETURN 
8500 REM "Assumes B(0) and B(3) set, Adjust B(0) to U/M and set B(1)
8504 REM "Figure cost first while B(0) is in eaches then convert B(0)
8505 REM "Figure cost
8510 CALL "FM2EXT",Z[13],1,B$(46,4),B[2],B[0],U,B[3],M6[1]
8515 B[1]=U
8525 REM "Convert B(0) to units
8530 IF G$(20,1)="Y" THEN N0=G[1] ELSE N0=B[2]
8531 IF N0=0 THEN N0=1
8535 B[0]=B[0]/N0
8595 RETURN 
8600 REM "Stop and let operator see the line before moving on
8601 IF B$(1,1)="T" THEN GOTO 8645
8605 CALL "ZZPROM","10",X3$,S3,"","","",0
8610 IF S3=0 THEN GOTO 2400
8645 GOTO 2020
8700 REM "Handle transfers
8701 REM "Assumes ICF records have been set and W9$=previous whse location
8704 REM "If W9$ all blanks then this is a virgin transfer, else remove old ICK records before proceeding.
8705 IF A5>99999 THEN ESCAPE ELSE J0$=B$(26,20)+B$(8,4),J1$="TR"+STR(A5:M9$)
8710 IF POS(" "<>W9$)=0 THEN GOTO 8750
8715 READ (Z[10],KEY=J0$(1,20)+W9$,DOM=8716)
8720 K$=KEY(Z[10],END=8750)
8725 IF K$(1,24)<>J0$(1,20)+W9$ THEN GOTO 8750
8730 READ (Z[10],KEY=K$)J2$
8735 IF J2$(110,11)=J1$ THEN REMOVE (Z[10],KEY=K$,DOM=8736)
8740 GOTO 8720
8750 REM "Read thru ICF, for each applicable record create an ICK record with the location changed to B$(50,4) and a new seq # as needed
8754 DIM K[12]; K0=0 ! SSP#236215
8755 READ (Z[9],KEY=J0$,DOM=8756)
8760 READ (Z[9],END=8590)IOL=0390
8765 IF K$(1,24)<>J0$ THEN GOTO 8590
8770 IF K$(110,11)<>J1$ THEN GOTO 8785
8774 REM "Ok create new one from this one
8775 K$(21,4)=B$(50,4)
8779 IF A5>99999 THEN ESCAPE ELSE K5$="TR"+STR(A5:M9$)+K$(1,32)
8780 WRITE (Z[10],KEY=K5$)IOL=0390
8785 GOTO 8760
8795 RETURN 
8800 REM "On transfer, check to see if any lots in the shipping whse.
8801 REM "NOTE: this is not a subroutine, but a GOTO, so that we can exit out to the qty entry part.
8805 READ (Z[9],KEY=X$(1,24),DOM=8806)
8810 K$=KEY(Z[9],END=8830); IF K$(1,24)<>X$(1,24) THEN GOTO 8830
8815 REM "Ok, so end normally
8820 GOTO 8309; REM " GOTO, NOT RETURN
8830 REM "No lots, so prompt and set qty to 0
8835 CALL "ZZPROM",".4",X3$,0,"There are no lots in this warehouse to transfer!","","",0
8845 GOTO 2020
8900 REM "Function Statements
8905 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
8910 DEF FND$(Z9$)=Z9$(3,2)+"/"+Z9$(5,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
8920 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9505 GOTO 6500
9510 SETERR 9000; GOSUB 6500
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 BEGIN ; SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 REM "236215-IC-Transaction update.  This is loosing some fields when it 
56001 REM "275719-IC transaction entry screen is not painting properly when   
