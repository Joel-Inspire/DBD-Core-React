0010 REM "Physical Count Checklists <IC2PJA>
0035 REM "5.7 - 10/17/11 - 14.421944 - crg - SSP# 250159
0037 REM "250159-Enhancement to Physical Inventory process to allow committed
0040 REM "Copyright 2011 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="IC2PJA",X1$="Physical Count Checklists"
0120 DIM A$(292),A[12],B$(45),B[9],C$(214),D$(256),D[19],S$(50),E$(21),E[1],F$(21),F[1]
0140 Z0$="##,##0",Z1$="##,###,###.00-",Z2$="##,##0"
0210 T=1,T0=1,T1=2
0220 W3=131
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0300 REM "I/O lists
0305 REM "IOLIST FOR ICL - Physical Count Data Entry
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12]
0312 IOLIST X5$,X[0],X[1],X[2],X[3],X[4],X[5],X[6],X[7],X[8],X[9],X[10],X[11],X[12]
0315 REM "IOLIST FOR IC1 - Inventory Detail Location
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9]
0325 REM "IOLIST FOR FM0 - Warehouse Locations
0330 IOLIST C$
0335 REM "IOLIST FOR IC0 - Item Masterfile
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15],D[16],D[17],D[18],D[19]
0350 IOLIST E$,E[0],E[1]
0390 IOLIST I0$,I[0],I[1]
0395 IOLIST F$,F[0],F[1]
0420 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01O ICL...  02O IC1...  03O FM0...  04O IC0...  05OSICL...  07O AR1...  13O ZZPARM  "; IF V1$(1,3)<>Y$(5,3) THEN Y$=Y$+"02O "+V1$+"  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0610 FIND (Z[13],KEY=X3$(9,3)+"I/C")P0$
0700 REM "Open Printer
0720 REM 
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[5]; U=35,U0=5,U[0]=0,U[1]=4,U[2]=10,U[3]=10,U[4]=10,U[5]=1,V1=4,V2=10,V3=20,T0=3,U0$="Y   ",T5$="                "; GOTO 0850; REM "154364
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0895 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W8$,W9$,W0,W9,W2,W3,W4; ON W4 GOTO 0896,9920
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
1000 REM "Read next record
1005 U$=KEY(U1,END=5000)
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])<V2$(U3,U[U9]) THEN READ (U1,END=5000); EXITTO 1000
1030 IF U$(U2,U[U9])>V2$(U3+U[U9],U[U9]) THEN IF U5=1 THEN EXITTO 5000 ELSE READ (U1,END=5000); EXITTO 1000
1040 NEXT U9
1100 REM "Get record"
1110 U9$=U$
1120 ON V0 GOTO 1150,1150,1130,1140
1150 READ (Z[1],KEY=U$,DOM=1000)IOL=0310
1180 REM "Check if no count record, and do we include it
1185 IF A$(222,1)<>"Y" AND V0$(73,1)<>"Y" THEN GOTO 1000
1189 REM "If printing no counts, and only no counts, do we skip it?
1190 IF V0$(74,1)="Y" AND A$(222,1)="Y" THEN GOTO 1000
1200 REM "Check for only print variant ones
1205 IF V0$(72,1)<>"Y" THEN GOTO 1300
1210 X6=A[4],X7=A[8]+A[10]+A[12],X6$=U$; DIM X[12]
1215 READ (Z[5],KEY=U$)
1220 READ (Z[5],END=1260)IOL=0312
1225 IF X5$(1,30)<>A$(1,30) THEN GOTO 1260
1228 IF P0$(54,1)="Y" THEN BIN$=DIM(10) ELSE BIN$=X5$(100,10)
1230 X6=X6+X[4],X7=X7+X[8]+X[10]+X[12],X6$=X5$(21,4)+BIN$+X5$(1,20)+X5$(25,6)+X5$(31,2)
1240 GOTO 1220
1270 IF X6=X7 THEN READ (U1,KEY=X6$,DOM=1000); GOTO 1000
1300 REM "Read other data
1320 READ (Z[2],KEY=A$(1,24),DOM=1321)IOL=0320
1340 READ (Z[4],KEY=A$(1,20),DOM=1341)IOL=0340
1350 DIM J1$(46); READ (Z[7],KEY=A$(1,10),DOM=1351)J1$
1400 REM "Subtotals"
1415 GOSUB 3100
1420 ON T GOTO 1470,1430,1440,1450,1460
1430 GOSUB 6300
1490 T=0
1500 REM "Print Data
1510 IF W+3>W0 THEN GOSUB 6000
1550 IF K$<>"" THEN IF U$(1,LEN(U$)-2)=K$ THEN GOTO 1572
1560 IF O$="" THEN GOSUB 7300
1565 Y5$(1)=A$(100,10),Y8$=D$
1567 IF POS(" "=J1$(1,2))<>0 THEN GOTO 1570
1568 CALL "ZZDISP","AX",J1$(1,10),"A/R",X3$,X$,"",0,0,X4$; Y5$(14)=X$,Y5$(28)=J1$(11,35)
1569 GOSUB 7300
1570 CALL "ZZDISP","AX",A$(1,20),"I/C",X3$,X$,"",0,0,X4$; Y5$(12)=X$; GOSUB 7750; Y5$(23)=Y9$
1571 GOSUB 7300
1573 IF POS(" "<>A$(247,10))<>0 THEN Y5$(1)="New Bin:",Y5$(12)=A$(247,10)
1574 IF A$(31,2)<>"  " THEN Y5$(15)="Seq: "+A$(31,2); GOSUB 7800 ELSE GOSUB 7800 END_IF ; IF NOT(NUL(A$(110,11))) THEN Y5$(41)="** "+FN%ZZDISP$(A$(110,8),"O/P")+" "+A$(118,3) ! Order number, order line number - if committed lot 250159
1575 IF A$(221,1)<>"Y" THEN GOSUB 4500; Y5$(71-LEN(X$))=X$; IF O$="" THEN O$=X$; O0=A[4]/A[2],O1=A[4]
1577 IF A$(222,1)<>"Y" THEN Y5$(103)="Not Counted"; GOSUB 4700; GOSUB 7300; GOTO 1650
1578 IF A$(221,1)="Y" THEN GOSUB 4500; Y5$(71-LEN(X$))=X$; O$="",O0=0; IF POS(" "<>A$(125,4))<>0 THEN O1=O1+A[2]*A[3]*A[4] ELSE O1=O1+A[3]*A[4]
1580 IF A$(221,1)="Y" THEN Y5$(73)=STR(A[8]:Z1$) ELSE Y5$(73)=STR(A[8]/A[2]:Z1$)
1590 IF A$(221,1)<>"Y" THEN Y5$(88)=STR(A[8]:Z1$) ELSE IF POS(" "<>A$(125,4))<>0 THEN Y5$(88)=STR(A[2]*A[3]*A[8]:Z1$) ELSE Y5$(88)=STR(A[3]*A[8]:Z1$)
1595 GOSUB 4700; GOSUB 7300
1600 IF A$(221,1)="Y" THEN GOTO 1650
1605 U0=1; GOSUB 4600
1610 U0=2; GOSUB 4600
1700 K$=U$(1,LEN(U$)-2)
1900 REM "Accumulate Totals"
1905 IF A$(222,1)<>"Y" THEN T[T0,1]=O1; GOTO 1990
1910 IF A$(221,1)="Y" THEN GOSUB 7950 ELSE GOSUB 7900
1990 T[T0,0]=T[T0,0]+1
1995 GOTO 1000
3000 REM "Subtotaling Routines"
3050 REM "Add to T$ for total title, T & T5 should be set
3055 T7$=T5$(T*4-3,4)
3060 IF T7$(1,1)=" " THEN RETURN 
3070 IF T7$(1,1)<>"S" THEN CALL "ZZDISP",T7$(1,1)+"X",T6$,T7$(2,3),X3$,T6$,"",0,0,X4$
3080 IF T$="" THEN T$=T6$ ELSE T$=T$+" "+T6$
3090 RETURN 
3100 REM "High order break"
3110 IF V1=0 THEN RETURN ELSE IF U1$=U9$(1,V1) THEN GOSUB 3200; RETURN 
3120 GOSUB 3220
3130 IF U1$="" THEN GOTO 3160
3150 T=1,T$=U5$,T6$=U1$; GOSUB 3050; GOSUB 7000
3152 U1$=U9$(1,V1); GOSUB 6300
3155 IF U0$(1,1)="Y" AND T0$<>"END" THEN GOSUB 6000
3160 U1$=U9$(1,V1); GOSUB 6300
3180 RETURN 
3200 REM "Second highest order break"
3210 IF V2=0 THEN RETURN ELSE IF U2$=U9$(V5,V2) THEN GOSUB 3300; RETURN 
3220 GOSUB 3320
3230 IF U2$="" THEN GOTO 3260
3250 T=2,T$=U6$,T6$=U2$; GOSUB 3050; GOSUB 7000
3255 IF U0$(2,1)="Y" THEN GOSUB 6000
3260 U2$=U9$(V5,V2)
3280 RETURN 
3300 REM "Next to lowest order break"
3301 GOTO 3320
3310 IF V3=0 THEN RETURN ELSE IF U3$=U9$(V6,V3) THEN GOSUB 3400; RETURN 
3320 GOSUB 3420
3330 IF U3$="" THEN GOTO 3360
3350 T=3,T$=U7$,T6$=U3$; GOSUB 3050; GOSUB 7000
3355 IF U0$(3,1)="Y" THEN GOSUB 6000
3360 U3$=U9$(V6,V3)
3380 RETURN 
3480 RETURN 
4500 REM "Load X$ with desc of units
4505 X$=""
4508 IF A$(221,1)<>"Y" THEN GOTO 4550
4515 IF POS(" "<>A$(121,4))=0 THEN GOTO 4525
4520 IF A[4]>1 THEN X$=X$+FNS$(A$(121,4))+"s of " ELSE X$=X$+FNS$(A$(121,4))+" of "
4525 IF A[2]=0 OR POS(" "<>A$(125,4))=0 THEN GOTO 4540
4530 X$=X$+FNR$(STR(A[2]:Z2$))+" "
4535 IF A[2]>1 THEN X$=X$+FNS$(A$(125,4))+"s of " ELSE X$=X$+FNS$(A$(125,4))+" of "
4540 X$=X$+FNR$(STR(A[3]:Z2$))
4545 RETURN 
4550 REM "Unit of measure for non lot item
4555 IF A[2]=0 THEN A[2]=1
4565 X$=X$+FNS$(A$(121,4))+"s of "
4570 X$=X$+FNR$(STR(A[2]:Z2$))
4595 RETURN 
4600 REM "Print alt units, U0=1 is first alt u/m, U0=2 is 2nd alt u/m
4605 IF A$(223+U0*4,4)="    " THEN RETURN 
4607 IF F$(4,4)<>A$(223+U0*4,4) THEN READ (Z[13],KEY="U/M"+A$(223+U0*4,4),DOM=4645)IOL=0395
4610 X$=FNS$(A$(223+U0*4,4))
4615 IF A[7+2*U0]=0 THEN A[7+2*U0]=1
4620 X$=X$+"s of "
4625 X$=X$+FNR$(STR(A[7+2*U0]:Z2$))
4630 Y5$(71-LEN(X$))=X$
4631 X$=""
4634 IF A[7+2*U0]=0 THEN A[7+2*U0]=1
4635 IF F$(20,1)<>"Y" THEN N0=A[8+2*U0]/A[7+2*U0] ELSE N0=A[8+2*U0]
4640 Y5$(73)=STR(N0:Z1$),Y5$(88)=STR(A[8+2*U0]:Z1$)
4641 GOSUB 7300
4645 RETURN 
4700 REM "Added original operator info
4710 IF STP(A$(259,3),1)<>"" THEN Y5$(114)=A$(259,3)+" "+FNY$(FND$(A$(262,6)))+" "+A$(268,2)+":"+A$(270,2)
4745 RETURN 
5000 REM "End of Print
5020 IF W8=0 THEN GOTO 5290
5030 T0$="END"
5040 IF V1>0 THEN GOSUB 3120
5050 T=0,T$="Report"; GOSUB 7000
5200 REM "
5290 GOTO 9900
6000 REM "Page header
6035 IF T0$="END" THEN W0$=""
6040 CALL "ZZHEAD",X0$,X1$,X2$,X3$,W0$,W1$,W2$,W3$,W3,W,W9,W8,W0,W5,W2,W8$,W5$; IF T0$="END" THEN GOTO 6060 ELSE ON W5 GOTO 6041,9910 ! %GUI
6045 ON W5 GOTO 6046,9900
6050 GOSUB 6200
6055 GOSUB 6100
6070 J$=A$(1,4)
6090 RETURN 
6100 REM "
6199 RETURN 
6200 REM "Column titles"
6230 Y5$(1)="Bin loc.",Y5$(12)="Item code",Y5$(23)="Description",Y5$(41)="** Committed",Y5$(62)="Pack",Y5$(67)="U/M",Y5$(80)="Count",Y5$(95)="SKU's",Y5$(103)="Variance"
6232 IF V0$(75,1)="Y" THEN Y5$(120)="Dollar Var"
6235 GOSUB 7300
6249 RETURN 
6300 REM "Location header
6310 DIM C$(LEN(C$)); FIND (Z[3],KEY="D"+S$(1,10)+U1$,DOM=6311)IOL=0330
6320 W0$=A$(21,4)+" - "+FNS$(C$(16,35)); IF POS(" "<>C$(111,16))<>0 THEN W0$=W0$+" - "+FNS$(C$(111,16))+", "+C$(127,2)
6390 RETURN 
6900 REM "SORT
6905 IF S9$="X" THEN GOTO 6990 ELSE S0=Z[1],S1=Z[2]
6940 CALL "ZZSORT",X3$,"",V1$,S9$,"","",0,0,0,S0,S1,X9
6990 RETURN 
7000 REM "Totals logic
7001 IF T<>T0 THEN GOTO 7100
7002 IF T[T,0]<2 THEN GOTO 7050
7005 IF W+3>W0 THEN GOSUB 6000
7007 Y5$(88)=T1$(1,13)
7010 GOSUB 7300
7020 Y5$(59)="Item total:",Y5$(88)=STR(T[T,1]:Z1$)
7040 GOSUB 7300
7050 REM "Print computer totals
7060 I1=99,I$=A$(36,4); GOSUB 4000
7070 IF T=3 THEN O1$="Computer count: "+O$ ELSE O1$="Computer count: "
7075 Y5$(71-LEN(O1$))=O1$
7077 IF O0<>0 THEN Y5$(73)=STR(O0:Z1$)
7078 Y5$(88)=STR(O1:Z1$); IF T[T,1]-O1<>0 THEN Y5$(103)=STR(T[T,1]-O1:Z1$)
7079 IF V0$(75,1)="Y" THEN Y5$(117)=STR(E9:Z1$)
7080 GOSUB 7300
7085 O$="",O0=0,O1=0,O2$="",O2=0,O3=0,O3$="",E9=0
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7205 GOSUB 7300; Y5$(1)=Q1$+": "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 T4$=STR(INT(T2):"##0")
7230 T3=INT(FPT(T2)*60)
7240 T3=T3/60
7250 T4$=T4$+":"+STR(T3:"00")
7260 Y5$(1)=Q3$+": "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7310 IF POS("V"=W8$)>0 THEN CALL "ZZVIEW",X3$,0,0,W3,W9,W,W9$,Y5$; GOTO 7390
7320 W=W+1; IF POS(" "<>Y5$)=0 THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; Y5$(1)=""
7330 REM 
7390 IF W>=W0 THEN GOSUB 6000
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=STP(MID(V0$,19,40)) ! %GUI         
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7525 REM "Modified stmts:
7550 REM "Added stmts:
7575 REM "Deleted stmts:
7750 REM "Build desc from Y8$
7760 Y9$=FNS$(Y8$(64,8)); IF Y9$<>"" THEN Y9$=Y9$+QUO; IF POS(" "<>Y8$(72,8))<>0 THEN Y9$=Y9$+"x"
7770 Y9$=Y9$+FNS$(Y8$(72,8)); IF Y9$<>"" THEN IF POS(" "<>Y8$(72,8))<>0 THEN Y9$=Y9$+QUO+" " ELSE Y9$=Y9$+" "
7775 IF NUM(Y8$(80,2))<>0 THEN Y9$=Y9$+Y8$(80,2)+" Ply "
7780 Y9$=Y9$+FNS$(Y8$(21,40)); Y8$=""
7790 RETURN 
7800 REM "Print inv tag number if needed
7805 IF POS(" "<>A$(235,12))=0 THEN GOTO 7845
7810 IF A$(31,2)="  " THEN Y5$(15)="Tag: "+A$(235,12) ELSE Y5$(23)="Tag: "+A$(235,12)
7845 RETURN 
7900 REM "Print variance dollar amount on report for non lotted items
7901 REM "Extend up in O2 by qty in T(T,1)-O1 with u/m O3$, O3
7904 O2=A[0],O3=D[15],O3$=D$(124,4),O4=A[8]+A[10]+A[12]-A[4]
7905 CALL "FM2EXT",Z[13],0,O3$,O3,O4,O2,E,2
7910 E9=E9+E
7925 T[T0,1]=T[T0,1]+A[8]+A[10]+A[12]
7945 RETURN 
7950 REM "Print variance dollar amount on report for lotted items
7951 REM "Take total cost O2 and total computer qty O5 and the variance O4 and use the ratio to calculate the variance cost (as opposed to going to unit cost and then back)
7953 O2=A[0],O4=A[8]+A[10]+A[12]-A[4]
7954 O5=A[4]; IF O5=0 THEN O5=A[8]+A[10]+A[12]
7955 IF O5=0 THEN E=0; GOTO 7970
7960 E=O2*O4/O5
7970 E9=E9+E
7975 IF POS(" "<>A$(125,4))<>0 THEN T[T0,1]=T[T0,1]+A[2]*A[3]*A[8] ELSE T[T0,1]=T[T0,1]+A[3]*A[8]
7995 RETURN 
8900 REM "Functions
8910 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
8920 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
8930 DEF FND$(Z9$)=Z9$(3,2)+X3$(59,1)+Z9$(5,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8940 DEF FNY$(Z9$)=Z9$(1,6)+Z9$(9)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "End program
9905 IF POS("V"=W8$)>0 THEN GOSUB 6000
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9925 IF %GUI=1 AND Y4$<>"" THEN CALL Y4$,ERR=*NEXT
9927 IF %GUI THEN EXIT 
9930 IF Y4$<>"" THEN RUN Y4$,ERR=9931
9940 RUN "ZMENU"
9999 END 
56001 REM "235373-Time stamp is not printing on the Physical Count Checklist  
56002 REM "250159-Enhancement to Physical Inventory process to allow committed
