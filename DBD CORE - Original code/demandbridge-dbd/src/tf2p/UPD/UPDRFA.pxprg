0010 ! UPDRFA - File RFA Maintenance
0035 REM "5.7 - 02/20/14 - 17.332222 - crg - SSP# 268565
0037 REM "268565-WMS spreadsheet of RFA file - UNITS_PER_UM is all zeros     
0040 REM "Copyright 2014 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! FILENO - CHANNEL OF OPEN FILE
0051 ! KEYNO  - KEY NUMBER
0052 ! SEG1-SEG5$ : KEY SEGMENTS . CAN BE NULL
0053 ! A$ - RECORD A$
0054 ! FOUND - IF RECORD FOUND, THEN 1 ELSE 0
0055 ! BUSY - IF RECORD BUSY THEN 1 ELSE 0
0056 ! OK - IF RECORD ADDED OK=1 ELSE 0
0310 IOL_RFA:IOLIST A$,A{ALL}
0500 INIT:
0505 DIM Z[255]; OPENED=0
0507 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,-1,X1,0
0510 IF POS("RFA"=PTH(FILENO))=0 THEN Z$="01O RFA...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; FILENO=Z[1],OPENED=1
0590 RETURN 
0598 ! 
0599 ! 
0600 WRAPUP:
0610 IF OPENED THEN CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0690 RETURN 
0698 ! 
0699 ! 
1000 READBYKEY:
1010 ENTER FILENO,KEYNO,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,A$,A{ALL},FOUND
1015 FOUND=0
1020 GOSUB INIT
1025 CALL "UPDRFA;CLEAR_FIELDS",A$,A{ALL}
1049 XP=PRM('XI'); SET_PARAM 'XI'
1050 IF FILENO<>0 THEN READ (FILENO,KNO=KEYNO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0310; FOUND=1
1051 SET_PARAM 'XI'=XP
1080 GOSUB WRAPUP
1090 EXIT 
1098 ! 
1099 ! 
1100 READNEXT:
1110 ENTER FILENO,A$,A{ALL},FOUND
1115 FOUND=0
1120 GOSUB INIT
1125 CALL "UPDRFA;CLEAR_FIELDS",A$,A{ALL}
1149 XP=PRM('XI'); SET_PARAM 'XI'
1150 IF FILENO<>0 THEN READ (FILENO,END=*NEXT)IOL=0310; FOUND=1
1151 SET_PARAM 'XI'=XP
1180 GOSUB WRAPUP
1190 EXIT 
1198 ! 
1199 ! 
1200 READPREV:
1210 ENTER FILENO,A$,A{ALL},FOUND
1215 FOUND=0
1220 GOSUB INIT
1225 CALL "UPDRFA;CLEAR_FIELDS",A$,A{ALL}
1249 XP=PRM('XI'); SET_PARAM 'XI'
1250 IF FILENO<>0 THEN PKEY$=KEP(FILENO,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1251 SET_PARAM 'XI'=XP
1280 GOSUB WRAPUP
1290 EXIT 
1298 ! 
1299 ! 
1300 READFIRST:
1310 ENTER FILENO,A$,A{ALL},FOUND
1315 FOUND=0
1320 GOSUB INIT
1325 CALL "UPDRFA;CLEAR_FIELDS",A$,A{ALL}
1349 XP=PRM('XI'); SET_PARAM 'XI'
1350 IF FILENO<>0 THEN PKEY$=KEF(FILENO,KNO=0,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1351 SET_PARAM 'XI'=XP
1380 GOSUB WRAPUP
1390 EXIT 
1398 ! 
1399 ! 
1400 READLAST:
1410 ENTER FILENO,A$,A{ALL},FOUND
1415 FOUND=0
1420 GOSUB INIT
1425 CALL "UPDRFA;CLEAR_FIELDS",A$,A{ALL}
1449 XP=PRM('XI'); SET_PARAM 'XI'
1450 IF FILENO<>0 THEN PKEY$=KEL(FILENO,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1451 SET_PARAM 'XI'=XP
1480 GOSUB WRAPUP
1490 EXIT 
1498 ! 
1499 ! 
1500 EXTRACTBYKEY:
1510 ENTER FILENO,KEYNO,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,A$,A{ALL},FOUND,BUSY
1515 FOUND=0,BUSY=0
1525 CALL "UPDRFA;CLEAR_FIELDS",A$,A{ALL}
1549 XP=PRM('XI'); SET_PARAM 'XI'
1550 IF POS("RFA"=PTH(FILENO))=0 THEN BUSY=1 ELSE READ (FILENO,KNO=KEYNO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0310; FOUND=1,BUSY=1,PRIMEKEY$=KEC(FILENO,KNO=0); EXTRACT (FILENO,KEY=PRIMEKEY$,KNO=0,ERR=*NEXT); BUSY=0
1551 SET_PARAM 'XI'=XP
1590 EXIT 
1598 ! 
1599 ! 
1600 INSERT:
1610 ENTER FILENO,A$,A{ALL},OK
1615 OK=0,PRIMEKEY$=A$(1,36)
1620 GOSUB INIT
1650 WRITE (FILENO,KEY=PRIMEKEY$,ERR=*NEXT)IOL=0310
1680 GOSUB WRAPUP
1690 EXIT 
1698 ! 
1699 ! 
1700 DELETE:
1710 ENTER FILENO,A$,A{ALL},FOUND,BUSY
1715 FOUND=0,BUSY=1,PRIMEKEY$=A$(1,36)
1720 GOSUB INIT
1750 REMOVE (FILENO,KEY=PRIMEKEY$,DOM=DELETE_END,ERR=*NEXT); BUSY=0
1775 DELETE_END:
1780 GOSUB WRAPUP
1790 EXIT 
1798 ! 
1799 ! 
1800 CLEAR_FIELDS:
1810 ENTER A$,A{ALL}
1820 DIM A$(1100),A[9]
1890 EXIT 
1898 ! 
1899 ! 
1900 UPDATE:
1910 ENTER FILENO,A$,A{ALL},BUSY
1915 BUSY=1,PRIMEKEY$=A$(1,36)
1920 GOSUB INIT
1950 WRITE (FILENO,KEY=PRIMEKEY$,DOM=*NEXT,ERR=*NEXT)IOL=0310; BUSY=0 ! 262497 - Don't overwrite existing records
1980 GOSUB WRAPUP
1990 EXIT 
1998 ! 
1999 ! 
2000 CLEAR_LOCK:
2010 ENTER FILENO
2020 GOSUB INIT
2050 READ (FILENO,KNO=0,KEY="",ERR=*NEXT)
2080 GOSUB WRAPUP
2090 EXIT 
2098 ! 
2099 ! 
2200 WRITELOCK:
2210 ENTER FILENO,A$,A{ALL}
2215 PRIMEKEY$=A$(1,36)
2220 GOSUB INIT
2250 WRITE LOCK (FILENO,KEY=PRIMEKEY$,ERR=*NEXT)IOL=0310
2280 GOSUB WRAPUP
2290 EXIT 
2298 ! 
2299 ! 
2500 VALIDATE:
2510 ENTER A$,A{ALL},MSG$
2520 A$=PAD(A$,1100),MSG$=""
2990 EXIT 
2998 ! 
2999 ! 
9999 END 
10000 ADD_SH:
10005 ! add shipment record 
10010 ENTER FILENO,X3$,RFS$,QTY,WRONG_SCAN,QTY_PER_UM,ERR=*NEXT
10020 DIM RFA$(1100),RFA[9] ! CALL "UPDRFA;CLEAR_FIELDS",RFA$,RFA{ALL}
10030 RFA$(1,2)="SH",RFA$(3,6)=X3$(21,6),RFA$(17,20)=RFS$(23,20)
10040 RFA$(37,4)=RFS$(81,4),RFA$(41,10)=RFS$(71,10),RFA$(51,4)=RFS$(63,4)
10050 RFA$(55,8)=RFS$(12,8),RFA$(63,8)=RFS$(1,8)
10055 RFA$(80,3)=X3$(40,3),RFA$(83,4)=RFS$(85,4)
10060 RFA$(87,15)=RFS$(117,15)
10062 IF WRONG_SCAN THEN RFA$(102,1)="Y"
10090 RFA[1]=QTY
10091 RFA[2]=QTY_PER_UM ! 268565
10200 TIM:
10210 RFA$(9,8)=STR(TIM:"00.00000")
10220 CALL "UPDRFA;UPDATE",FILENO,RFA$,RFA{ALL},BUSYRFA; IF BUSYRFA THEN GOTO TIM
10490 EXIT 
10498 ! 
10499 ! 
10500 ADD_RC:
10510 ENTER FILENO,X3$,RF1$,QTY,WRONG_SCAN,QTY_PER_UM,ERR=*NEXT
10520 DIM RFA$(1100),RFA[9] ! CALL "UPDRFA;CLEAR_FIELDS",RFA$,RFA{ALL}
10530 RFA$(1,2)="RC",RFA$(3,6)=X3$(21,6),RFA$(17,20)=RF1$(13,20)
10540 RFA$(37,4)=RF1$(56,4),RFA$(113,4)=RF1$(33,4),RFA$(41,10)=RF1$(78,10),RFA$(51,4)=RF1$(148,4) ! 248520!SSP#252617
10550 RFA$(55,8)=RF1$(140,8),RFA$(71,9)=RF1$(1,9)
10555 RFA$(80,3)=X3$(40,3),RFA$(83,4)=RF1$(88,4) ! 268565
10560 RFA$(87,15)=RF1$(176,15)
10562 IF WRONG_SCAN THEN RFA$(102,1)="Y"
10590 RFA[1]=QTY
10591 RFA[2]=QTY_PER_UM ! 268565
10600 TIM_RC:
10610 RFA$(9,8)=STR(TIM:"00.00000")
10620 CALL "UPDRFA;UPDATE",FILENO,RFA$,RFA{ALL},BUSYRFA; IF BUSYRFA THEN GOTO TIM_RC
10890 EXIT 
10898 ! 
10899 ! 
11000 ADD_PU:
11010 ENTER FILENO,X3$,RF1$,QTY,WRONG_SCAN,QTY_PER_UM,ERR=*NEXT
11020 DIM RFA$(1100),RFA[9] ! CALL "UPDRFA;CLEAR_FIELDS",RFA$,RFA{ALL}
11030 RFA$(1,2)="PU",RFA$(3,6)=X3$(21,6),RFA$(17,20)=RF1$(13,20)
11040 RFA$(37,4)=RF1$(56,4),RFA$(113,4)=RF1$(33,4),RFA$(41,10)=RF1$(78,10),RFA$(51,4)=RF1$(148,4) ! 248520 !SSP#252617
11050 RFA$(55,8)=RF1$(140,8),RFA$(71,9)=RF1$(1,9)
11055 RFA$(80,3)=X3$(40,3),RFA$(83,4)=RF1$(88,4) ! 268565
11060 RFA[1]=QTY
11061 RFA[2]=QTY_PER_UM ! 268565
11062 IF WRONG_SCAN THEN RFA$(102,1)="Y"
11560 RFA$(87,15)=RF1$(176,15)
11600 TIM_PU:
11610 RFA$(9,8)=STR(TIM:"00.00000")
11620 CALL "UPDRFA;UPDATE",FILENO,RFA$,RFA{ALL},BUSYRFA; IF BUSYRFA THEN GOTO TIM_PU
11890 EXIT 
11898 ! 
11899 ! 
12000 ADD_IN:
12010 ENTER FILENO,X3$,RF1$,QTY,WRONG_SCAN,QTY_PER_UM,ERR=*NEXT
12020 DIM RFA$(1100),RFA[9] ! CALL "UPDRFA;CLEAR_FIELDS",RFA$,RFA{ALL}
12030 RFA$(1,2)="IN",RFA$(3,6)=X3$(21,6),RFA$(17,20)=RF1$(13,20)
12040 RFA$(37,4)=RF1$(56,4),RFA$(113,4)=RF1$(33,4),RFA$(41,10)=RF1$(78,10),RFA$(51,4)=RF1$(148,4) ! 248520 !SSP#252617
12050 RFA$(55,8)=RF1$(140,8),RFA$(71,9)=RF1$(1,9)
12060 RFA[1]=QTY
12061 RFA[2]=QTY_PER_UM ! 268565
12062 IF WRONG_SCAN THEN RFA$(102,1)="Y"
12560 RFA$(87,15)=RF1$(176,15)
12600 TIM_IN:
12610 RFA$(9,8)=STR(TIM:"00.00000")
12620 CALL "UPDRFA;UPDATE",FILENO,RFA$,RFA{ALL},BUSYRFA; IF BUSYRFA THEN GOTO TIM_IN
12890 EXIT 
12898 ! 
12899 ! 
13000 ADD_BM:
13010 ENTER FILENO,X3$,ITEM$,BUYER$,FROM_BIN$,TO_BIN$,WHS$,LOT_NUM$,QTY,WRONG_SCAN,QTY_PER_UM,ERR=*NEXT
13020 DIM RFA$(1100),RFA[9] ! CALL "UPDRFA;CLEAR_FIELDS",RFA$,RFA{ALL}
13030 RFA$(1,2)="BM",RFA$(3,6)=X3$(21,6),RFA$(17,20)=PAD(ITEM$,20)
13040 RFA$(37,4)=WHS$,RFA$(41,10)=TO_BIN$
13050 RFA$(55,8)=LOT_NUM$
13060 RFA[1]=QTY
13061 RFA[2]=QTY_PER_UM ! 268565
13062 IF WRONG_SCAN THEN RFA$(102,1)="Y"
13070 RFA$(103,10)=FROM_BIN$
13075 RFA$(87,15)=BUYER$
13600 TIM_BM:
13610 RFA$(9,8)=STR(TIM:"00.00000")
13620 CALL "UPDRFA;UPDATE",FILENO,RFA$,RFA{ALL},BUSYRFA; IF BUSYRFA THEN GOTO TIM_BM
13890 EXIT 
13898 ! 
13899 ! 
56000 REM "180032-Wireless Warehousing                                        
56002 REM "197953-WMS. Quick bin change                                       
56004 REM "180032-Wireless Warehousing                                        
56006 REM "248520-WMS RFA file showing location code 0011 for audit type RC   
56007 REM "252617-WMS:  Spreadsheet of RFA file doesn't contain the bin       
56008 REM "268565-WMS spreadsheet of RFA file - UNITS_PER_UM is all zeros     
