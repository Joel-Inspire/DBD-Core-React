0010 ! UPDPO3 - File PO3 Maintenance
0035 REM "5.7 - 04/08/24 - 15.057167 - crg - SSP# 307480
0037 REM "307480-DBD-378: Email to warehouse                                 
0040 REM "Copyright 2024 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! FILENO - CHANNEL OF OPEN FILE
0051 ! KEYNO  - KEY NUMBER
0052 ! SEG1-SEG5$ : KEY SEGMENTS . CAN BE NULL
0053 ! A$ - RECORD A$
0054 ! FOUND - IF RECORD FOUND, THEN 1 ELSE 0
0055 ! BUSY - IF RECORD BUSY THEN 1 ELSE 0
0056 ! OK - IF RECORD ADDED OK=1 ELSE 0
0310 IOLIST A$,A[0],A[1],A[2],A[3]
0500 INIT:
0505 DIM Z[255]; OPENED=0
0507 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
0510 IF POS("PO3"=PTH(FILENO))=0 THEN Z$="01O PO3...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; FILENO=Z[1],OPENED=1
0590 RETURN 
0598 ! 
0599 ! 
0600 WRAPUP:
0610 IF OPENED THEN CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0690 RETURN 
0698 ! 
0699 ! 
1000 READBYKEY:
1010 ENTER FILENO,KEYNO,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,A$,A{ALL},FOUND
1015 FOUND=0
1020 GOSUB INIT
1025 CALL "UPDPO3;CLEAR_FIELDS",A$,A{ALL}
1049 XP=PRM('XI'); SET_PARAM 'XI'
1050 READ (FILENO,KNO=KEYNO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0310; FOUND=1
1051 SET_PARAM 'XI'=XP
1080 GOSUB WRAPUP
1090 EXIT 
1098 ! 
1099 ! 
1100 READNEXT:
1110 ENTER FILENO,A$,A{ALL},FOUND
1115 FOUND=0
1120 GOSUB INIT
1125 CALL "UPDPO3;CLEAR_FIELDS",A$,A{ALL}
1149 XP=PRM('XI'); SET_PARAM 'XI'
1150 READ (FILENO,END=*NEXT)IOL=0310; FOUND=1
1151 SET_PARAM 'XI'=XP
1180 GOSUB WRAPUP
1190 EXIT 
1198 ! 
1199 ! 
1200 READPREV:
1210 ENTER FILENO,A$,A{ALL},FOUND
1215 FOUND=0
1220 GOSUB INIT
1225 CALL "UPDPO3;CLEAR_FIELDS",A$,A{ALL}
1249 XP=PRM('XI'); SET_PARAM 'XI'
1250 PKEY$=KEP(FILENO,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1251 SET_PARAM 'XI'=XP
1280 GOSUB WRAPUP
1290 EXIT 
1298 ! 
1299 ! 
1300 READFIRST:
1310 ENTER FILENO,A$,A{ALL},FOUND
1315 FOUND=0
1320 GOSUB INIT
1325 CALL "UPDPO3;CLEAR_FIELDS",A$,A{ALL}
1349 XP=PRM('XI'); SET_PARAM 'XI'
1350 PKEY$=KEF(FILENO,KNO=0,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1351 SET_PARAM 'XI'=XP
1380 GOSUB WRAPUP
1390 EXIT 
1398 ! 
1399 ! 
1400 READLAST:
1410 ENTER FILENO,A$,A{ALL},FOUND
1415 FOUND=0
1420 GOSUB INIT
1425 CALL "UPDPO3;CLEAR_FIELDS",A$,A{ALL}
1449 XP=PRM('XI'); SET_PARAM 'XI'
1450 PKEY$=KEL(FILENO,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1451 SET_PARAM 'XI'=XP
1480 GOSUB WRAPUP
1490 EXIT 
1498 ! 
1499 ! 
1500 EXTRACTBYKEY:
1510 ENTER FILENO,KEYNO,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,A$,A{ALL},FOUND,BUSY
1515 FOUND=0,BUSY=0
1520 GOSUB INIT
1549 XP=PRM('XI'); SET_PARAM 'XI'
1550 IF POS("PO3"=PTH(FILENO))=0 THEN BUSY=1 ELSE READ (FILENO,KNO=KEYNO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0310; FOUND=1,BUSY=1,PRIMEKEY$=KEC(FILENO,KNO=0); EXTRACT (FILENO,KEY=PRIMEKEY$,KNO=0,ERR=*NEXT); BUSY=0
1551 SET_PARAM 'XI'=XP
1590 EXIT 
1598 ! 
1599 ! 
1600 INSERT:! Add new record
1610 ENTER FILENO,KEYNO,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,A$,A{ALL},OK
1615 OK=0
1620 GOSUB INIT
1650 WRITE (FILENO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0310; OK=1
1680 GOSUB WRAPUP
1690 EXIT 
1698 ! 
1699 ! 
1700 DELETE:
1710 ENTER FILENO,A$,A{ALL},FOUND,BUSY
1715 FOUND=0,BUSY=1,PRIMEKEY$=A$(1,15)
1720 GOSUB INIT
1750 IF FILENO<>0 THEN REMOVE (FILENO,KEY=PRIMEKEY$,DOM=DELETE_END,ERR=*NEXT); BUSY=0
1775 DELETE_END:
1780 GOSUB WRAPUP
1790 EXIT 
1798 ! 
1799 ! 
1800 CLEAR_FIELDS:
1810 ENTER A$,A{ALL}
1820 DIM A$(429),A[3]
1890 EXIT 
1898 ! 
1899 ! 
1900 UPDATE:
1910 ENTER FILENO,A$,A{ALL},BUSY
1915 BUSY=1,PRIMEKEY$=A$(1,17)
1920 GOSUB INIT
1950 WRITE (FILENO,KEY=PRIMEKEY$,ERR=*NEXT)IOL=0310; BUSY=0
1980 GOSUB WRAPUP
1990 EXIT 
1998 ! 
1999 ! 
2000 CLEAR_LOCK:
2010 ENTER FILENO
2020 GOSUB INIT
2050 READ (FILENO,KNO=0,KEY="",ERR=*NEXT)
2080 GOSUB WRAPUP
2090 EXIT 
2098 ! 
2099 ! 
2500 VALIDATE:
2510 ENTER A$,A{ALL},MSG$
2520 A$=PAD(A$,429),MSG$=""
2990 EXIT 
2998 ! 
2999 ! 
9999 END 
10000 CHECK_WMS_RECV:
10010 ENTER FILENO,ORD_NUM$,LINE$,LINEOK
10012 LINEOK=0
10013 IF LEN(ORD_NUM$)=8 THEN LINEOK=1; GOTO 10090 ! ssp206649 always receive stock po
10015 ! LINEOK=1; CALL "UPDPO3;READBYKEY",FILENO,0,ORD_NUM$,DIM(3),DIM(1),SEG4$,SEG5$,PO3$,PO3{ALL},FOUNDPO3; IF FOUNDPO3 THEN IF PO3$(11,1)="D" OR PO3$(11,1)="C" AND PO3$(3,4)<>DIM(4) THEN LINEOK=1
10020 CALL "UPDPO3;READBYKEY",FILENO,0,ORD_NUM$,DIM(1),LINE$,DIM(1),SEG5$,PO3$,PO3{ALL},FOUNDPO3
10030 CALL "UPDPO3;READNEXT",FILENO,PO3$,PO3{ALL},FOUNDPO3; IF FOUNDPO3 THEN IF PO3$(166,8)+PO3$(7,3)<>ORD_NUM$+LINE$ THEN FOUNDPO3=0
10050 WHILE FOUNDPO3
10060 IF PO3$(11,1)="D" OR (PO3$(11,1)="C" AND PO3$(3,4)<>DIM(4)) THEN LINEOK=1
10070 IF LINEOK THEN FOUNDPO3=0 ELSE CALL "UPDPO3;READNEXT",FILENO,PO3$,PO3{ALL},FOUNDPO3; IF FOUNDPO3 THEN IF PO3$(166,8)+PO3$(7,3)<>ORD_NUM$+LINE$ THEN FOUNDPO3=0
10080 WEND 
10090 EXIT 
10098 ! 
10099 ! 
10500 CHECK_WMS_WHS:
10510 ENTER FILENO,ORD_NUM$,PO_OK
10515 PO_OK=0
10520 CALL "UPDPO3;READBYKEY",FILENO,0,ORD_NUM$,SEG2$,SEG3$,SEG4$,SEG5$,PO3$,PO3{ALL},FOUNDPO3
10530 CALL "UPDPO3;READNEXT",FILENO,PO3$,PO3{ALL},FOUNDPO3; IF FOUNDPO3 THEN IF PO3$(166,8)<>ORD_NUM$ THEN FOUNDPO3=0
10535 IF FOUNDPO3 THEN IF PO3$(11,1)="D" OR (PO3$(11,1)="C" AND PO3$(3,4)<>DIM(4)) THEN PO_OK=1 ! general shiping
10600 IF FOUNDPO3 THEN {
10610 CALL "UPDPO3;READNEXT",FILENO,PO3$,PO3{ALL},FOUNDPO3B; IF FOUNDPO3B THEN IF PO3$(166,8)<>ORD_NUM$ THEN FOUNDPO3B=0
10620 WHILE FOUNDPO3B
10630 IF PO3$(11,1)="D" OR (PO3$(11,1)="C" AND PO3$(3,4)<>DIM(4)) THEN PO_OK=1
10650 CALL "UPDPO3;READNEXT",FILENO,PO3$,PO3{ALL},FOUNDPO3B; IF FOUNDPO3B THEN IF PO3$(166,8)<>ORD_NUM$ THEN FOUNDPO3B=0
10670 WEND 
10690  }
10990 EXIT 
10998 ! 
10999 ! 
11000 DUPL_1ST_SPEC_SHIP:! duplicates 1st special shipping location record
11010 ENTER FILENO,PO3_B,ORDER$,FIRST_LINE$,CUR_LINE$
11020 CALL "UPDPO3;READBYKEY",FILENO,0,ORDER$," ",FIRST_LINE$,SEG4$,SEG5$,PO3$,PO3{ALL},FOUNDPO3
11030 CALL "UPDPO3;READNEXT",FILENO,PO3$,PO3{ALL},FOUNDPO3; IF FOUNDPO3 THEN IF PO3$(166,8)<>ORDER$ OR PO3$(7,3)<>FIRST_LINE$ OR PO3$(10,1)=DIM(1) THEN FOUNDPO3=0
11100 WHILE FOUNDPO3
11150 PO3$(7,3)=CUR_LINE$
11160 CALL "UPDPO3;INSERT",PO3_B,0,PO3$(166,8),DIM(1),PO3$(7,3),PO3$(10,1),SEG5$,PO3$,PO3{ALL},OK
11280 CALL "UPDPO3;READNEXT",FILENO,PO3$,PO3{ALL},FOUNDPO3; IF FOUNDPO3 THEN IF PO3$(166,8)<>ORDER$ OR PO3$(7,3)<>FIRST_LINE$ OR PO3$(10,1)=DIM(1) THEN FOUNDPO3=0
11300 WEND 
11390 EXIT 
11398 ! 
11399 ! 
11500 HAS_SPEC_SHIP:
11510 ENTER FILENO,ORDER_DIV$,ORDER_NUM$,CUR_LINE$,HAS_SPEC_SHIP
11520 HAS_SPEC_SHIP=0
11525 ORDER$=ORDER_DIV$+ORDER_NUM$
11530 CALL "UPDPO3;READBYKEY",FILENO,0,ORDER$," ",CUR_LINE$,DIM(1),SEG5$,PO3$,PO3{ALL},FOUNDPO3
11540 CALL "UPDPO3;READNEXT",FILENO,PO3$,PO3{ALL},FOUNDPO3
11550 IF FOUNDPO3 THEN IF PO3$(166,8)=ORDER$ AND PO3$(7,3)=CUR_LINE$ THEN HAS_SPEC_SHIP=1
11590 EXIT 
11598 ! 
11599 ! 
11800 ORD_HAS_SPEC_SHIP:
11810 ENTER FILENO,ORDER_DIV$,ORDER_NUM$,HAS_SPEC_SHIP
11820 HAS_SPEC_SHIP=0
11825 ORDER$=ORDER_DIV$+ORDER_NUM$
11830 CALL "UPDPO3;READBYKEY",FILENO,0,ORDER$(1,8)," ",DIM(3),DIM(1),SEG5$,PO3$,PO3{ALL},FOUNDPO3
11840 CALL "UPDPO3;READNEXT",FILENO,PO3$,PO3{ALL},FOUNDPO3; IF FOUNDPO3 THEN IF PO3$(166,8)<>ORDER$(1,8) THEN FOUNDPO3=0
11850 WHILE FOUNDPO3
11860 IF PO3$(10,1)<>" " THEN HAS_SPEC_SHIP=1
11870 IF HAS_SPEC_SHIP THEN FOUNDPO3=0 ELSE CALL "UPDPO3;READNEXT",FILENO,PO3$,PO3{ALL},FOUNDPO3; IF FOUNDPO3 THEN IF PO3$(166,8)<>ORDER$(1,8) THEN FOUNDPO3=0
11880 WEND 
11890 EXIT 
11999 ! 
12000 GET_ORDER_SHIPLOC_LIST:
12010 ENTER ORDER_NUM$,ORDER_LOC_TYPE$,ORDER_LOC_LIST$
12020 ORDER_LOC_LIST$=""
12025 IF NUL(ORDER_NUM$) THEN GOTO 12090
12030 SELECT RECORD PO3$ FROM "PO3"+%C$ BEGIN ORDER_NUM$ END ORDER_NUM$+$FF$
12031 LOC_TYPE$=MID(PO3$,11,1),LOC_CODE$=MID(PO3$,12,4)
12035 ! PRINT LOC_TYPE$,"|",LOC_CODE$,"|" 
12040 IF NUL(ORDER_LOC_TYPE$) OR LOC_TYPE$=ORDER_LOC_TYPE$ THEN IF POS(LOC_TYPE$+LOC_CODE$=ORDER_LOC_LIST$,5)=0 THEN ORDER_LOC_LIST$+=LOC_TYPE$+LOC_CODE$
12050 NEXT RECORD 
12095 EXIT 
12099 ! 
12100 GET_PO_SHIPLOC_LIST:
12110 ENTER PO_NUMBER$,SHIP_LOC_TYPE$,SHIP_LOC_LIST$
12115 SHIP_LOC_LIST$=""
12117 IF NUL(PO_NUMBER$) THEN GOTO 12190
12120 SELECT RECORD PO2$ FROM "PO2"+%C$ BEGIN PO_NUMBER$ END PO_NUMBER$+$FF$
12122 PO_LINE_NUM$=MID(PO2$,7,3),SPECIAL_SHIP$=MID(PO2$,14,1)
12130 SELECT RECORD PO3$ FROM "PO3"+%C$ BEGIN MID(PO_NUMBER$,1,8) END MID(PO_NUMBER$,1,8)+$FF$ WHERE (SPECIAL_SHIP$<>"Y" AND NUL(MID(PO3$,7,3))) OR (SPECIAL_SHIP$="Y" AND MID(PO3$,7,3)=PO_LINE_NUM$)
12131 LOC_TYPE$=MID(PO3$,11,1),LOC_CODE$=MID(PO3$,12,4)
12135 ! PRINT PO_LINE_NUM$,"|",LOC_TYPE$,"|",LOC_CODE$,"|"
12140 IF NUL(SHIP_LOC_TYPE$) OR LOC_TYPE$=SHIP_LOC_TYPE$ THEN IF POS(LOC_TYPE$+LOC_CODE$=SHIP_LOC_LIST$,5)=0 THEN SHIP_LOC_LIST$+=LOC_TYPE$+LOC_CODE$
12150 NEXT RECORD 
12160 NEXT RECORD 
12195 EXIT 
12199 ! 
56000 REM "186852-Email Order Shipping Confirmations                          
56002 REM "191846-add call to zzcomp in all upd pgms                          
56004 REM "180032-Wireless Warehousing                                        
56006 REM "206117-WMS - Order setup wrong, says shipto C-0001, inventory comes
56008 REM "206649-WMS Recv. - Says Nothing to Recv. In                        
56010 REM "208671-Order Entry - GUI Order Lines. Redesign based upon a        
56011 REM "307480-DBD-378: Email to warehouse                                 
