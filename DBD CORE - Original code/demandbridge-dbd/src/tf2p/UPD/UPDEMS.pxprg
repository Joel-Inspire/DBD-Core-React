0010 ! UPDEMS - File EMS Maintenance
0035 REM "5.6 - 04/04/08 - 17.414166 - lms - SSP# 191992
0037 REM "191992-Generate welcome email during order entry and flag items    
0040 REM "Copyright 2008 DemandBridge, Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! FILENO - CHANNEL OF OPEN FILE
0051 ! KEYNO  - KEY NUMBER
0052 ! SEG1-SEG5$ : KEY SEGMENTS . CAN BE NULL
0053 ! A$ - RECORD A$
0054 ! FOUND - IF RECORD FOUND, THEN 1 ELSE 0
0055 ! BUSY - IF RECORD BUSY THEN 1 ELSE 0
0056 ! OK - IF RECORD ADDED OK=1 ELSE 0
0310 IOLIST A$
0500 INIT:
0505 DIM Z[255]; OPENED=0
0507 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
0510 IF POS("EMS"=PTH(FILENO))=0 THEN Z$="01O EMS...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; FILENO=Z[1],OPENED=1
0590 RETURN 
0599 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0600 WRAPUP:
0610 IF OPENED THEN CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0690 RETURN 
0699 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1000 READ_BY_KEY:
1010 ENTER FILENO,KEYNO,KEY$,A$,A{ALL},FOUND
1015 FOUND=0
1020 GOSUB INIT
1025 CALL "UPDEMS;CLEAR_FIELDS",A$,A{ALL}
1049 XP=PRM('XI'); SET_PARAM 'XI'
1050 IF FILENO<>0 THEN READ (FILENO,KNO=KEYNO,KEY=KEY$,DOM=*NEXT)IOL=0310; FOUND=1
1051 SET_PARAM 'XI'=XP
1080 GOSUB WRAPUP
1090 EXIT 
1099 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1100 READ_NEXT:
1110 ENTER FILENO,KEYNO,A$,A{ALL},FOUND
1115 FOUND=0
1120 GOSUB INIT
1125 CALL "UPDEMS;CLEAR_FIELDS",A$,A{ALL}
1149 XP=PRM('XI'); SET_PARAM 'XI'
1150 READ (FILENO,KNO=KEYNO,END=*NEXT)IOL=0310; FOUND=1
1151 SET_PARAM 'XI'=XP
1180 GOSUB WRAPUP
1190 EXIT 
1199 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1200 READ_PREV:
1210 ENTER FILENO,KEYNO,A$,A{ALL},FOUND
1215 FOUND=0
1220 GOSUB INIT
1225 CALL "UPDEMS;CLEAR_FIELDS",A$,A{ALL}
1249 XP=PRM('XI'); SET_PARAM 'XI'
1250 PKEY$=KEP(FILENO,KNO=KEYNO,ERR=*NEXT); READ (FILENO,KNO=KEYNO,KEY=PKEY$)IOL=0310; FOUND=1
1251 SET_PARAM 'XI'=XP
1280 GOSUB WRAPUP
1290 EXIT 
1299 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1300 READ_FIRST:
1310 ENTER FILENO,KEYNO,A$,A{ALL},FOUND
1315 FOUND=0
1320 GOSUB INIT
1325 CALL "UPDEMS;CLEAR_FIELDS",A$,A{ALL}
1349 XP=PRM('XI'); SET_PARAM 'XI'
1350 FKEY$=KEF(FILENO,KNO=KEYNO,ERR=*NEXT); READ (FILENO,KNO=KEYNO,KEY=FKEY$)IOL=0310; FOUND=1
1351 SET_PARAM 'XI'=XP
1380 GOSUB WRAPUP
1390 EXIT 
1399 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1400 READ_LAST:
1410 ENTER FILENO,KEYNO,A$,A{ALL},FOUND
1415 FOUND=0
1420 GOSUB INIT
1425 CALL "UPDEMS;CLEAR_FIELDS",A$,A{ALL}
1449 XP=PRM('XI'); SET_PARAM 'XI'
1450 LKEY$=KEL(FILENO,KNO=KEYNO,ERR=*NEXT); READ (FILENO,KNO=KEYNO,KEY=LKEY$)IOL=0310; FOUND=1
1451 SET_PARAM 'XI'=XP
1480 GOSUB WRAPUP
1490 EXIT 
1499 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1500 EXTRACT_BY_KEY:
1510 ENTER FILENO,KEYNO,KEY$,A$,A{ALL},FOUND,BUSY
1515 FOUND=0,BUSY=0
1525 CALL "UPDEMS;CLEAR_FIELDS",A$,A{ALL}
1549 XP=PRM('XI'); SET_PARAM 'XI'
1550 IF POS("EMS"=PTH(FILENO))=0 THEN BUSY=1 ELSE READ (FILENO,KNO=KEYNO,KEY=KEY$,DOM=*NEXT)IOL=0310; FOUND=1,BUSY=1,PRIMEKEY$=KEC(FILENO,KNO=0); EXTRACT (FILENO,KEY=PRIMEKEY$,KNO=0,ERR=*NEXT); BUSY=0
1551 SET_PARAM 'XI'=XP
1590 EXIT 
1599 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1600 WRITE:! Write record, KEY$="" means insert new
1610 ENTER FILENO,KEYNO,KEY$,A$,A{ALL},OK
1615 OK=0
1620 GOSUB INIT
1625 IF NUL(KEY$) THEN {
1630 DIM KEY$(10,$00$); KEY$=KEL(FILENO,KNO=0,ERR=*NEXT)
1635 KEY$=FN%NEXT_SEQ$(KEY$,0); A$(1,10)=KEY$; WRITE (FILENO,KEY=KEY$,DOM=*SAME)IOL=0310; OK=1
1640  } ELSE {
1650 WRITE (FILENO,KEY=KEY$)IOL=0310; OK=1
1655  }
1680 GOSUB WRAPUP
1690 EXIT 
1699 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1700 DELETE:
1710 ENTER FILENO,KEY$,FOUND,BUSY
1715 FOUND=0,BUSY=1
1720 GOSUB INIT
1750 REMOVE (FILENO,KEY=KEY$,DOM=DELETE_END,ERR=*NEXT); BUSY=0
1775 DELETE_END:
1780 GOSUB WRAPUP
1790 EXIT 
1799 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1800 CLEAR_FIELDS:
1810 ENTER A$
1820 DIM A$(255)
1890 EXIT 
1899 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2000 CLEAR_LOCK:
2010 ENTER FILENO
2020 GOSUB INIT
2050 READ (FILENO,KNO=0,KEY="",ERR=*NEXT)
2080 GOSUB WRAPUP
2090 EXIT 
2099 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
2500 VALIDATE:
2510 ENTER A$,MSG$
2520 A$=PAD(A$,255),MSG$=""
2990 EXIT 
2999 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
3000 FIND_PRIMARY_KEY:! Given KEYNO and Partial key, find PRIMARY KEY
3010 ENTER FILENO,KEYNO,SEARCHKEY$,PRIMARYKEY$,FOUND
3015 PRIMARYKEY$="",FOUND=0; IF SEARCHKEY$="" THEN GOTO FPK_DONE
3020 GOSUB INIT
3030 READ (FILENO,KNO=KEYNO,KEY=SEARCHKEY$,DOM=*NEXT)
3035 FKEY$=KEY(FILENO,KNO=KEYNO,END=FPK_DONE)
3040 IF MID(FKEY$,1,LEN(SEARCHKEY$))<>SEARCHKEY$ THEN GOTO FPK_DONE
3045 PRIMARYKEY$=MID(FKEY$,-10),FOUND=1
3085 FPK_DONE:GOSUB WRAPUP
3090 EXIT 
3095 EXIT 
3099 ! ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
9999 END 
56000 REM "191992-Automatic Email Reorder Notice
