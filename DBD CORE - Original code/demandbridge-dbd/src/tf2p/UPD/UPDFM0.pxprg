0010 ! UPDFM0 - File FM0 Maintenance
0035 REM "5.7 - 02/10/21 - 13.674526 - jvv - SSP# 307333
0037 REM "307333-WMS issues                                                  
0040 REM "Copyright 2021 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! FILENO - CHANNEL OF OPEN FILE
0051 ! KEYNO  - KEY NUMBER
0052 ! SEG1-SEG5$ : KEY SEGMENTS . CAN BE NULL
0053 ! A$ - RECORD A$
0054 ! FOUND - IF RECORD FOUND, THEN 1 ELSE 0
0055 ! BUSY - IF RECORD BUSY THEN 1 ELSE 0
0056 ! OK - IF RECORD ADDED OK=1 ELSE 0
0310 IOLIST A$
0315 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5]
0500 INIT:
0505 DIM Z[255]; OPENED=0
0507 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
0510 IF POS("FM0"=PTH(FILENO))=0 THEN Z$="01O FM0...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; FILENO=Z[1],OPENED=1
0590 RETURN 
0598 ! 
0599 ! 
0600 WRAPUP:
0610 IF OPENED THEN CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0690 RETURN 
0698 ! 
0699 ! 
1700 DELETE:
1710 ENTER FILENO,A$,A{ALL},PRIMEKEY$,FOUND,BUSY
1715 FOUND=0,BUSY=1
1720 GOSUB INIT
1750 REMOVE (FILENO,KEY=PRIMEKEY$,DOM=DELETE_END,ERR=*NEXT); BUSY=0
1785 DELETE_END:
1787 GOSUB WRAPUP
1790 EXIT 
1798 ! 
1799 ! 
2000 CLEAR_LOCK:
2010 ENTER FILENO
2020 GOSUB INIT
2050 READ (FILENO,KNO=0,KEY="",ERR=*NEXT)
2080 GOSUB WRAPUP
2090 EXIT 
2098 ! 
2099 ! 
2100 READBYKEY:
2110 ENTER FILENO,KEYNO,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,A$,A{ALL},FOUND
2115 FOUND=0
2120 GOSUB INIT
2149 XP=PRM('XI'); SET_PARAM 'XI'
2200 SWITCH SEG1$
2205 CASE "D"
2210 DIM A[5]
2215 READ (FILENO,KNO=KEYNO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0315; FOUND=1
2219 BREAK
2220 CASE "C"
2225 READ (FILENO,KNO=KEYNO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0310; FOUND=1
2229 BREAK
2390 DEFAULT 
2398 BREAK
2400 END SWITCH 
2451 SET_PARAM 'XI'=XP
2480 GOSUB WRAPUP
2490 EXIT 
2498 ! 
2499 ! 
3100 READNEXT:
3110 ENTER FILENO,A$,A{ALL},FOUND
3115 FOUND=0
3149 XP=PRM('XI'); SET_PARAM 'XI'
3150 KY$=KEY(FILENO,END=*NEXT)
3200 SWITCH MID(KY$,1,1) ! SSP 307333
3210 CASE "D"
3211 DIM A[5]
3215 READ (FILENO,KEY=KY$,DOM=*NEXT)IOL=0315; FOUND=1
3219 BREAK
3220 CASE "C"
3225 READ (FILENO,KEY=KY$,DOM=*NEXT)IOL=0310; FOUND=1
3229 BREAK
3450 DEFAULT 
3455 READ (FILENO,KEY=KY$,DOM=*NEXT)IOL=0310; FOUND=1
3460 BREAK
3470 END SWITCH 
3475 SET_PARAM 'XI'=XP
3480 GOSUB WRAPUP
3490 EXIT 
3498 ! 
3499 ! 
9999 END 
10000 GETWMSLIST:
10010 ENTER FILENO,BUYER$,WHSLIST$,DROPLIST$
10020 DROPLIST$=""
10030 CALL "UPDFM0;READBYKEY",FILENO,0,"D",DIM(10),SEG3$,SEG4$,SEG5$,FM0$,RF2{ALL},FOUNDRF2
10040 CALL "UPDFM0;READNEXT",FILENO,FM0$,FM0{ALL},FOUNDFM0; IF FOUNDFM0 THEN IF FM0$(1,11)<>"D"+DIM(10) THEN FOUNDFM0=0
10100 WHILE FOUNDFM0
10130 IF STP(WHSLIST$,3," ")="" THEN DROPLIST$=DROPLIST$+FM0$(12,4) ELSE IF POS(FM0$(12,4)=WHSLIST$,4)<>0 THEN DROPLIST$=DROPLIST$+FM0$(12,4)
10180 CALL "UPDFM0;READNEXT",FILENO,FM0$,FM0{ALL},FOUNDFM0; IF FOUNDFM0 THEN IF FM0$(1,11)<>"D"+DIM(10) THEN FOUNDFM0=0
10190 WEND 
10200 EXIT 
10298 ! 
10299 ! 
20000 GET_BIN_MASK:! SSP 217136
20010 ENTER FILENO,WAREHOUSE$,BIN_LOC$,BIN_DISP$
20020 DIM BIN_MASK$(15)
20030 CALL "UPDFM0;READBYKEY",FILENO,0,"D",DIM(10),WAREHOUSE$,SEG4$,SEG5$,FM0$,FM0{ALL},FOUNDFM0
20040 IF FOUNDFM0 THEN IF FM0$(1,11)<>"D"+DIM(10) THEN FOUNDFM0=0 ELSE BIN_MASK$=FM0$(603,15)
20230 CALL "UPDRFB;READBYKEY",RFB,0,BIN_LOC$,WAREHOUSE$,SEG3$,SEG4$,SEG5$,RFB$,RFB{ALL},FOUNDRFB
20240 IF FOUNDRFB THEN {
20250 IF RFB$(69,15)<>DIM(15) THEN BIN_MASK$=RFB$(69,15)
20270  }
20280 TMP_BIN_MASK$=PAD(STP(BIN_MASK$),15,1,"X")
20290 BIN_DISP$=STR(BIN_LOC$:TMP_BIN_MASK$)
20500 EXIT 
56000 REM "188067-New Pricing changes. Standard GP Percentage for a           
56002 REM "180032-Wireless Warehousing                                        
56004 REM "217136-Ability to print the Bin location with the mask in WMS on   
56005 REM "307333-WMS issues                                                  
