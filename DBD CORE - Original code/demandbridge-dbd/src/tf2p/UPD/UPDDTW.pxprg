0010 REM "Output Director - Customer Inventory Snapshot <UPDDTW>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 09/09/13 - 13.560833 - crg - SSP# 265084
0037 REM "265084-Daily processes to be triggered by cron schedule
0040 REM "Copyright 2013 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0110 X0$="UPDDTW",X1$="Customer Inventory Snapshot"
0120 X0=-1
0199 ! 
0200 REM "Get command line args
0201 REM " DT0_KEY= Specify the key prefix to narrow down the range of Inv Snapshot entries processed,see 1000s
0202 REM " ENV_ID= Specify the "TFE" record code used to grab environment for the current session
0210 FOR I=0 TO NAR
0215 TMP$=ARG(I)
0220 IF MSK(UCS(TMP$),"DT0_KEY=") THEN DT0_KEY_PFX$=MID(TMP$,MSL+1); CONTINUE ! Set DT0 key prefix (optional)
0225 IF MSK(UCS(TMP$),"ENV_ID=") THEN ENV_ID$=PAD(MID(TMP$,MSL+1),8); CONTINUE ! Set ENV_ID (required, eg: EC3SRV or OUTDIR)
0245 NEXT I
0299 ! 
0300 REM "IOLISTS
0500 REM "FILES
0503 CLOSE (14); OPEN (14)"ZZPARM"; READ (14,KEY="TFE"+ENV_ID$)X3$,*,X4$; X3$(1,8)=FID(0)+DIM(6),X3$(169,3)=FID(0)
0504 WRITE (14,KEY=X3$(1,8))X3$,"",X4$; %X3$=X3$,%X4$=X4$,%X3_SET=1
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O DT0...  02O DTW...  03O FM0...  04O IC0...  05O IC1...  06O DT6...  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO *NEXT,9900
0599 ! 
0600 REM "Initialize
0610 OUTPUT_TYPE$=PAD("CUST_WHS_INV_STAT",20),DT0_KEY_PFX$=""
0699 ! 
1000 REM "Begin main process
1005 READ (Z[1],KEY=OUTPUT_TYPE$+DT0_KEY_PFX$,DOM=*NEXT)
1010 DT0_KEY$=KEY(Z[1],END=5000); READ (Z[1],KEY=DT0_KEY$)DT0$
1020 IF MID(DT0_KEY$,1,LEN(OUTPUT_TYPE$+DT0_KEY_PFX$))<>(OUTPUT_TYPE$+DT0_KEY_PFX$) THEN GOTO 5000
1100 CALL "UPDDTW;CREATE_CUST_WHS_INV_STAT",Z[2],Z[3],Z[4],Z[5],Z[6],Z[13],X3$,DT0$(23,10),DT0$(43,4) ! invoke job for specified customer, whse
1995 GOTO 1010
4999 ! 
5000 REM "EOJ
5010 GOTO 9900
5099 ! 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 ! IF BKG THEN RELEASE 
9930 SETERR 9940; Q1$=A1$; RELEASE 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
10000 CREATE_CUST_WHS_INV_STAT:
10010 ENTER DTW,FM0,IC0,IC1,DT6,ZZPARM,X3$,CUST$,WHS$
10011 TOD_OUTPUT_TYPE$=PAD("CUST_WHS_INV_STAT",20)
10012 IF TCB(29)<7100000 THEN GOTO 10390 ! version 7.1
10015 TOD_SEQ=0
10020 CALL "UPDDT0;GET_NEXT_TRANS_NUM",ZZPARM,X3$,TOD_TRANS$
10050 CALL "UPDIC0;READBYKEY",IC0,0,CUST$,SEG2$,SEG3$,SEG4$,SEG5$,IC0$,IC0{ALL},FOUNDIC0
10060 CALL "UPDIC0;READNEXT",IC0,IC0$,IC0{ALL},FOUNDIC0; IF FOUNDIC0 THEN IF IC0$(1,10)<>CUST$ THEN FOUNDIC0=0
10080 WHILE FOUNDIC0
10090 CALL "UPDIC1;READBYKEY",IC1,0,IC0$(1,20),WHS$,SEG3$,SEG4$,SEG5$,IC1$,IC1{ALL},FOUNDIC1
10100 IF FOUNDIC1 THEN {! 10360
10160 DIM DTW$(1075),DTW[4]
10170 DTW$(1,20)=TOD_OUTPUT_TYPE$,DTW$(21,10)=TOD_TRANS$
10180 TOD_SEQ=TOD_SEQ+1; DTW$(31,5)=STR(TOD_SEQ:"00000")
10190 DTW$(39,10)=IC1$(1,10),DTW$(49,4)=IC1$(21,4),DTW$(53,10)=IC1$(11,10)
10200 DTW$(73,4)=IC0$(124,4)
10240 CALL "UPDFM0;READBYKEY",FM0,0,"D",DIM(10),WHS$,SEG4$,SEG5$,FM0$,FM0{ALL},FOUNDFM0
10250 DTW$(63,10)=MID(FM0$,568,10)
10300 DTW[0]=IC1[3]+IC1[4]-IC1[5]+IC1[6]
10305 DTW[1]=IC1[7],DTW[2]=IC0[14]; IF DTW[2]=0 THEN DTW[2]=1
10350 WRITE (DTW,KEY=DTW$(1,35))DTW$,DTW{ALL}
10360  } ! 10100
10375 CALL "UPDIC0;READNEXT",IC0,IC0$,IC0{ALL},FOUNDIC0; IF FOUNDIC0 THEN IF IC0$(1,10)<>CUST$ THEN FOUNDIC0=0
10380 WEND 
10385 IF TOD_SEQ>0 THEN CALL "UPDDT6;CLEAR_FIELDS",DT6$,DT6{ALL}; DT6$(1,10)=TOD_TRANS$,DT6$(11,20)=TOD_OUTPUT_TYPE$; CALL "UPDDT6;UPDATE",DT6,DT6$,DT6{ALL},BUSY
10390 EXIT 
10398 ! 
10399 ! 
56000 REM "198612-TopForm Output director
56002 REM "208028-Output Directory - Inventory Snapshot
56003 REM "265084-Daily processes to be triggered by cron schedule
