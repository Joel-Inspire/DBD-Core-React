0010 ! UPDDTY - File DTY Maintenance
0035 REM "5.5 - 09/26/07 - 15.072222 - jme - SSP# 212097
0037 REM "212097-TOD Purchase Order Printing
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! FILENO - CHANNEL OF OPEN FILE
0051 ! KEYNO  - KEY NUMBER
0052 ! SEG1-SEG5$ : KEY SEGMENTS . CAN BE NULL
0053 ! A$ - RECORD A$
0054 ! FOUND - IF RECORD FOUND, THEN 1 ELSE 0
0055 ! BUSY - IF RECORD BUSY THEN 1 ELSE 0
0056 ! OK - IF RECORD ADDED OK=1 ELSE 0
0310 IOLIST A$
0500 INIT:
0505 DIM Z[255]; OPENED=0
0507 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
0510 IF FILENO=0 THEN Z$="01S DTY...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; FILENO=Z[1],OPENED=1 ELSE IF POS("DTY"=PTH(FILENO))=0 THEN Z$="01S DTY...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; FILENO=Z[1],OPENED=1
0590 RETURN 
0598 ! 
0599 ! 
0600 WRAPUP:
0610 IF OPENED THEN CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0690 RETURN 
0698 ! 
0699 ! 
1000 READBYKEY:
1010 ENTER FILENO,KEYNO,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,A$,A{ALL},FOUND
1015 FOUND=0
1020 GOSUB INIT
1025 CALL "UPDDTY;CLEAR_FIELDS",A$,A{ALL}
1049 XP=PRM('XI'); SET_PARAM 'XI'
1050 READ (FILENO,KNO=KEYNO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0310; FOUND=1
1051 SET_PARAM 'XI'=XP
1080 GOSUB WRAPUP
1090 EXIT 
1098 ! 
1099 ! 
1100 READNEXT:
1110 ENTER FILENO,A$,A{ALL},FOUND
1115 FOUND=0
1120 GOSUB INIT
1125 CALL "UPDDTY;CLEAR_FIELDS",A$,A{ALL}
1149 XP=PRM('XI'); SET_PARAM 'XI'
1150 READ (FILENO,END=*NEXT)IOL=0310; FOUND=1
1151 SET_PARAM 'XI'=XP
1180 GOSUB WRAPUP
1190 EXIT 
1198 ! 
1199 ! 
1200 READPREV:
1210 ENTER FILENO,A$,A{ALL},FOUND
1215 FOUND=0
1220 GOSUB INIT
1225 CALL "UPDDTY;CLEAR_FIELDS",A$,A{ALL}
1249 XP=PRM('XI'); SET_PARAM 'XI'
1250 PKEY$=KEP(FILENO,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1251 SET_PARAM 'XI'=XP
1280 GOSUB WRAPUP
1290 EXIT 
1298 ! 
1299 ! 
1300 READFIRST:
1310 ENTER FILENO,A$,A{ALL},FOUND
1315 FOUND=0
1320 GOSUB INIT
1325 CALL "UPDDTY;CLEAR_FIELDS",A$,A{ALL}
1349 XP=PRM('XI'); SET_PARAM 'XI'
1350 PKEY$=KEF(FILENO,KNO=0,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1351 SET_PARAM 'XI'=XP
1380 GOSUB WRAPUP
1390 EXIT 
1398 ! 
1399 ! 
1400 READLAST:
1410 ENTER FILENO,A$,A{ALL},FOUND
1415 FOUND=0
1420 GOSUB INIT
1425 CALL "UPDDTY;CLEAR_FIELDS",A$,A{ALL}
1449 XP=PRM('XI'); SET_PARAM 'XI'
1450 PKEY$=KEL(FILENO,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1451 SET_PARAM 'XI'=XP
1480 GOSUB WRAPUP
1490 EXIT 
1498 ! 
1499 ! 
1500 EXTRACTBYKEY:
1510 ENTER FILENO,KEYNO,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,A$,A{ALL},FOUND,BUSY
1515 FOUND=0,BUSY=0
1525 CALL "UPDDTY;CLEAR_FIELDS",A$,A{ALL}
1549 XP=PRM('XI'); SET_PARAM 'XI'
1550 IF POS("DTY"=PTH(FILENO))=0 THEN BUSY=1 ELSE READ (FILENO,KNO=KEYNO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0310; FOUND=1,BUSY=1,PRIMEKEY$=KEC(FILENO,KNO=0); EXTRACT (FILENO,KEY=PRIMEKEY$,KNO=0,ERR=*NEXT); BUSY=0
1551 SET_PARAM 'XI'=XP
1590 EXIT 
1598 ! 
1599 ! 
1600 INSERT:
1610 ENTER FILENO,A$,A{ALL},OK
1615 OK=0,PRIMEKEY$=A$(1,37)
1620 GOSUB INIT
1650 WRITE (FILENO,KEY=PRIMEKEY$,ERR=*NEXT)IOL=0310; OK=1
1680 GOSUB WRAPUP
1690 EXIT 
1698 ! 
1699 ! 
1700 DELETE:
1710 ENTER FILENO,A$,A{ALL},FOUND,BUSY
1715 FOUND=0,BUSY=1,PRIMEKEY$=A$(1,37)
1720 GOSUB INIT
1750 REMOVE (FILENO,KEY=PRIMEKEY$,DOM=DELETE_END,ERR=*NEXT); BUSY=0; FOUND=1
1785 DELETE_END:
1787 GOSUB WRAPUP
1790 EXIT 
1798 ! 
1799 ! 
1800 CLEAR_FIELDS:
1810 ENTER A$,A{ALL}
1820 DIM A$(2991),A[13]
1890 EXIT 
1898 ! 
1899 ! 
1900 UPDATE:
1910 ENTER FILENO,A$,A{ALL},BUSY
1915 BUSY=1,PRIMEKEY$=A$(1,37)
1920 GOSUB INIT
1950 WRITE (FILENO,KEY=PRIMEKEY$,ERR=*NEXT)IOL=0310; BUSY=0
1980 GOSUB WRAPUP
1990 EXIT 
1998 ! 
1999 ! 
2000 CLEAR_LOCK:
2010 ENTER FILENO
2020 GOSUB INIT
2050 READ (FILENO,KNO=0,KEY="",ERR=*NEXT)
2080 GOSUB WRAPUP
2090 EXIT 
2098 ! 
2099 ! 
2500 VALIDATE:
2510 ENTER A$,A{ALL},MSG$
2520 A$=PAD(A$,2991),MSG$=""
2990 EXIT 
2998 ! 
2999 ! 
9999 END 
11000 UPDATE_LINE:
11010 ENTER FILENO,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F5,SUB_F5,F5$,PLY_SEQUENCE$,TOD_OK,DTY_ITEM_CODE$,DTY_ITEM_DESCR$
11015 IOLIST DTY$
11017 OUTPUT_TYPE$=TOD_OUTPUT_TYPE$
11018 Y_DATA=1; IF F5$=DIM(LEN(F5$)) THEN Y_DATA=0
11020 IF Y_DATA AND TOD_OK AND F5>0 THEN {! 19980
11030 CALL "UPDDTY;CLEAR_FIELDS",DTY$,DTY{ALL}
11040 CALL "UPDDTY;READBYKEY",FILENO,0,OUTPUT_TYPE$,TOD_TRANS$,STR(TOD_SEQ:"00000"),PLY_SEQUENCE$,SEG5$,DTY$,DTY{ALL},FOUNDDTY
11050 DTY$(1,20)=TOD_OUTPUT_TYPE$,DTY$(21,10)=TOD_TRANS$,DTY$(31,5)=STR(TOD_SEQ:"00000"),DTY$(36,2)=PLY_SEQUENCE$ ! tod_seq=po line #
11060 READ DATA FROM REC(IOL=11015) TO IOL=IOL(FILENO)
11090 IF FOUNDDTY THEN UPD=1
11220 IF F5=4 THEN CUSTOMER_PO$=F5$
11230 IF F5=5 THEN F5$=PAD(F5$,9); PO_DIV$=F5$(1,2),PO_NUM$=F5$(3)
11240 IF F5=6 THEN DATE_REQUIRED$=F5$
11250 IF F5=7 THEN ORDER_DATE$=F5$
11260 IF F5=31 THEN PO_LINE$=F5$
11270 ITEM_NUMBER$=DTY_ITEM_CODE$,ITEM_DESCRIPTION$=DTY_ITEM_DESCR$
11280 IF F5=18 THEN ITEM_DESCRIPTION$=F5$
11290 IF F5=32 THEN PLY_NUMBER$=F5$,UPD=1
11300 IF F5=33 THEN COLOR$=F5$,UPD=1
11305 IF F5=34 THEN WT$=F5$,UPD=1
11310 IF F5=35 THEN PAPER_GRADE$=F5$,UPD=1
11315 IF F5=36 THEN LEFT_RIGHT$=F5$,UPD=1
11320 IF F5=37 THEN TOP_BOTTOM$=F5$,UPD=1
11325 IF F5=38 AND SUB_F5=1 THEN INK_COLOR_1$=F5$,UPD=1
11330 IF F5=38 AND SUB_F5=2 THEN INK_COLOR_2$=F5$,UPD=1
11335 IF F5=38 AND SUB_F5=3 THEN INK_COLOR_3$=F5$,UPD=1
11337 IF F5=38 AND SUB_F5=4 THEN BACKER$=F5$,UPD=1
11340 IF F5=39 THEN PERFS_CONT_SNAPOUT$=F5$,UPD=1
11342 IF F5=116 THEN EXTRA_PERFS$=F5$,UPD=1
11344 IF F5=40 THEN COPY_CHANGE_CODE$=F5$,UPD=1
11348 IF F5=41 AND SUB_F5=1 THEN COPY_CHANGE_FRONT$=F5$,UPD=1
11349 IF F5=41 AND SUB_F5=2 THEN COPY_CHANGE_BACK$=F5$,UPD=1
11350 IF F5=42 THEN MARGINAL_WORDS$=F5$,UPD=1
11355 IF F5=43 THEN MARGINAL_WORDS_POS$=F5$,UPD=1
11357 IF F5=44 THEN PLANT_TO_SET_COPY$=F5$,UPD=1
11360 IF F5=45 THEN CR_COPY$=F5$,UPD=1
11362 IF F5=46 THEN NEGATIVES_ATTACHED$=F5$,UPD=1
11365 IF F5=47 THEN ARTWORK$=F5$,UPD=1
11370 IF F5=48 THEN PLANT_TO_SET_SCREENS$=F5$,UPD=1
11375 IF F5=49 THEN PLANT_TO_MAKE_ADJ$=F5$,UPD=1
11380 IF F5=50 THEN RETURN_ART$=F5$,UPD=1
11385 IF F5=51 THEN RETURN_NEGS$=F5$,UPD=1
11390 IF F5=52 THEN RETURN_CR_COPY$=F5$,UPD=1
11395 IF F5=53 THEN DESTROY_OLD_COPY$=F5$,UPD=1
11398 IF F5=54 THEN PROOF_REQUIRED$=F5$,UPD=1
11399 IF F5=55 THEN IMPRINT_REQUIRED$=F5$,UPD=1
11400 IF F5=56 THEN CARBON_DUMMY$=F5$,UPD=1
11405 IF F5=57 THEN SAMPLES$=F5$,UPD=1
11410 IF F5=59 THEN TF_MOD$=F5$,UPD=1
11420 IF F5=60 THEN NUM_OF_POS$=F5$,UPD=1
11425 IF F5=61 THEN NUM_COLOR$=F5$,UPD=1
11430 IF F5=62 THEN ARABIC$=F5$,UPD=1
11435 IF F5=63 THEN PRESS$=F5$,UPD=1
11440 IF F5=64 THEN TF_COLLATE$=F5$,UPD=1
11445 IF F5=65 THEN GUARANTEED_NUM$=F5$,UPD=1
11447 IF F5=66 THEN NUM_LIST$=F5$,UPD=1
11450 IF F5=67 THEN MICR$=F5$,UPD=1
11455 IF F5=68 THEN TF_STATIC$=F5$,UPD=1
11460 IF F5=69 THEN CONSECUTIVE$=F5$,UPD=1
11465 IF F5=70 THEN OTHERS$=F5$,UPD=1
11467 IF F5=71 THEN QTY_PER_CARTON_71$=F5$,UPD=1
11470 IF F5=72 THEN GLUE_LEFT$=F5$,UPD=1
11475 IF F5=73 THEN GLUE_RIGHT$=F5$,UPD=1
11480 IF F5=74 THEN CRIMP_LEFT$=F5$,UPD=1
11485 IF F5=75 THEN CRIMP_RIGHT$=F5$,UPD=1
11490 IF F5=76 THEN OTHERS_1$=F5$,UPD=1
11495 IF F5=77 THEN PLYS$=F5$,UPD=1
11500 IF F5=78 THEN TF_POSITION$=F5$,UPD=1
11505 IF F5=79 THEN TF_NUMBER$=F5$,UPD=1
11510 IF F5=80 THEN DIAMETER$=F5$,UPD=1
11515 IF F5=81 THEN CENTER_TO_CENTER$=F5$,UPD=1
11520 IF F5=82 THEN BOOKS$=F5$,UPD=1
11530 IF F5=83 THEN PADS$=F5$,UPD=1
11535 IF F5=84 THEN NUM_OF_SETS_PER$=F5$,UPD=1
11540 IF F5=85 THEN WRAP_AROUND$=F5$,UPD=1
11545 IF F5=86 THEN TRIAD$=F5$,UPD=1
11550 IF F5=87 THEN OPEN_END$=F5$,UPD=1
11555 IF F5=88 THEN PARTS_LEFT_IN_BOOK$=F5$,UPD=1
11560 IF F5=89 THEN POLYWRAP$=F5$,UPD=1
11565 IF F5=90 THEN PRINTER$=F5$,UPD=1
11570 IF F5=91 THEN DECOLLATER_TYPE$=F5$,UPD=1
11580 IF F5=92 THEN BURSTER_TYPE$=F5$,UPD=1
11590 IF F5=94 THEN CARBON_WIDTH$=F5$,UPD=1
11595 IF F5=95 THEN CARBON_COLOR$=F5$,UPD=1
11600 IF F5=119 THEN CARBON_TYPE$=F5$,UPD=1
11605 IF F5=101 AND SUB_F5=1 THEN TF_COMMENT_1$=F5$,UPD=1
11607 IF F5=101 AND SUB_F5=2 THEN TF_COMMENT_2$=F5$,UPD=1
11609 IF F5=101 AND SUB_F5=3 THEN TF_COMMENT_3$=F5$,UPD=1
11610 IF F5=101 AND SUB_F5=4 THEN TF_COMMENT_4$=F5$,UPD=1
11612 IF F5=101 AND SUB_F5=5 THEN TF_COMMENT_5$=F5$,UPD=1
11614 IF F5=101 AND SUB_F5=6 THEN TF_COMMENT_6$=F5$,UPD=1
11616 IF F5=101 AND SUB_F5=7 THEN TF_COMMENT_7$=F5$,UPD=1
11618 IF F5=101 AND SUB_F5=8 THEN TF_COMMENT_8$=F5$,UPD=1
11619 IF F5=101 AND SUB_F5=9 THEN TF_COMMENT_9$=F5$,UPD=1
11650 IF F5=120 THEN SUBPACK_UM$=F5$,UPD=1
11655 IF F5=121 THEN SUBPACK_QTY_PER$=F5$,UPD=1
19890 READ DATA FROM REC(IOL(FILENO)) TO IOL=11015
19895 DTY$(1,20)=TOD_OUTPUT_TYPE$,DTY$(21,10)=TOD_TRANS$,DTY$(31,5)=STR(TOD_SEQ:"00000"),DTY$(36,2)=PLY_SEQUENCE$ ! tod_seq=po line #
19900 IF UPD THEN CALL "UPDDTY;UPDATE",FILENO,DTY$,DTY{ALL},BUSY
19980  } ! 11020
19990 EXIT 
19998 ! 
19999 ! 
21000 UPDATE_HDR_INFO:
21010 ENTER FILENO,DTO,OUTPUT_TYPE$,TOD_TRANS$,MEM_FL
21020 READ (MEM_FL,KEY="",ERR=*NEXT)
21100 READ (MEM_FL,END=21990)MEM_KEY$,TRANS$,TOD_SEQ
21150 CALL "UPDDTO;READBYKEY",DTO,0,OUTPUT_TYPE$,TRANS$,"00000",SEG4$,SEG5$,DTOHDR$,DTOHDR{ALL},FOUNDDTOHDR
21180 CALL "UPDDTY;READBYKEY",FILENO,0,OUTPUT_TYPE$,TRANS$,"00000",SEG4$,SEG5$,DTY$,DTY{ALL},FOUNDDTY
21190 CALL "UPDDTY;READNEXT",FILENO,DTY$,DTY{ALL},FOUNDDTY; IF FOUNDDTY THEN IF DTY$(1,30)<>OUTPUT_TYPE$+TRANS$ THEN FOUNDDTY=0
21200 WHILE FOUNDDTY
21210 FOR J=39 TO 643
21220 IF DTOHDR$(J-2,1)<>" " THEN DTY$(J,1)=DTOHDR$(J-2,1)
21240 NEXT J
21242 DTY$(654,35)=DTOHDR$(2032,35)
21244 DTY$(689,35)=DTOHDR$(3743,35)
21246 DTY$(724,35)=DTOHDR$(3778,35)
21250 CALL "UPDDTY;UPDATE",FILENO,DTY$,DTY{ALL},BUSY
21280 CALL "UPDDTY;READNEXT",FILENO,DTY$,DTY{ALL},FOUNDDTY; IF FOUNDDTY THEN IF DTY$(1,30)<>OUTPUT_TYPE$+TRANS$ THEN FOUNDDTY=0
21290 WEND 
21500 GOTO 21100
21990 EXIT 
21998 ! 
21999 ! 
56000 REM "198612-TopForm Output director
56002 REM "212091-TOD Purchase Order - Output Director control maintenance
