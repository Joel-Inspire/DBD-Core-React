0010 ! UPDFS1 - File FS1 Maintenance
0035 REM "5.7 - 12/12/12 - 14.890833 - dmm - SSP# 259411
0037 REM "259411-EC error msg 000-EC3WS1-8463 on two DBE orders.             
0040 REM "Copyright 2012 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! FILENO - CHANNEL OF OPEN FILE
0051 ! KEYNO  - KEY NUMBER
0052 ! SEG1-SEG5$ : KEY SEGMENTS . CAN BE NULL
0053 ! A$ - RECORD A$
0054 ! FOUND - IF RECORD FOUND, THEN 1 ELSE 0
0055 ! BUSY - IF RECORD BUSY THEN 1 ELSE 0
0056 ! OK - IF RECORD ADDED OK=1 ELSE 0
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13]
0500 INIT:
0505 DIM Z[255]; OPENED=0
0507 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
0510 IF FILENO=-99 THEN Z$="01S FS1...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; FILENO=Z[1],OPENED=1 ELSE IF POS("FS1"=PTH(FILENO))=0 THEN Z$="01S FS1...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; FILENO=Z[1],OPENED=1
0590 RETURN 
0598 ! 
0599 ! 
0600 WRAPUP:
0610 IF OPENED THEN CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0690 RETURN 
0698 ! 
0699 ! 
1000 READBYKEY:
1010 ENTER FILENO,KEYNO,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,A$,A{ALL},FOUND
1015 FOUND=0
1020 GOSUB INIT
1025 CALL "UPDFS1;CLEAR_FIELDS",A$,A{ALL}
1049 XP=PRM('XI'); SET_PARAM 'XI'
1050 READ (FILENO,KNO=KEYNO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0310; FOUND=1
1051 SET_PARAM 'XI'=XP
1080 GOSUB WRAPUP
1090 EXIT 
1098 ! 
1099 ! 
1100 READNEXT:
1110 ENTER FILENO,A$,A{ALL},FOUND
1115 FOUND=0
1120 GOSUB INIT
1125 CALL "UPDFS1;CLEAR_FIELDS",A$,A{ALL}
1149 XP=PRM('XI'); SET_PARAM 'XI'
1150 READ (FILENO,END=*NEXT)IOL=0310; FOUND=1
1151 SET_PARAM 'XI'=XP
1180 GOSUB WRAPUP
1190 EXIT 
1198 ! 
1199 ! 
1200 READPREV:
1210 ENTER FILENO,A$,A{ALL},FOUND
1215 FOUND=0
1220 GOSUB INIT
1225 CALL "UPDFS1;CLEAR_FIELDS",A$,A{ALL}
1249 XP=PRM('XI'); SET_PARAM 'XI'
1250 PKEY$=KEP(FILENO,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1251 SET_PARAM 'XI'=XP
1280 GOSUB WRAPUP
1290 EXIT 
1298 ! 
1299 ! 
1300 READFIRST:
1310 ENTER FILENO,A$,A{ALL},FOUND
1315 FOUND=0
1320 GOSUB INIT
1325 CALL "UPDFS1;CLEAR_FIELDS",A$,A{ALL}
1349 XP=PRM('XI'); SET_PARAM 'XI'
1350 PKEY$=KEF(FILENO,KNO=0,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1351 SET_PARAM 'XI'=XP
1380 GOSUB WRAPUP
1390 EXIT 
1398 ! 
1399 ! 
1400 READLAST:
1410 ENTER FILENO,A$,A{ALL},FOUND
1415 FOUND=0
1420 GOSUB INIT
1425 CALL "UPDFS1;CLEAR_FIELDS",A$,A{ALL}
1449 XP=PRM('XI'); SET_PARAM 'XI'
1450 PKEY$=KEL(FILENO,ERR=*NEXT); READ (FILENO,KEY=PKEY$)IOL=0310; FOUND=1
1451 SET_PARAM 'XI'=XP
1480 GOSUB WRAPUP
1490 EXIT 
1498 ! 
1499 ! 
1500 EXTRACTBYKEY:
1510 ENTER FILENO,KEYNO,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,A$,A{ALL},FOUND,BUSY
1515 FOUND=0,BUSY=0
1525 CALL "UPDFS1;CLEAR_FIELDS",A$,A{ALL}
1549 XP=PRM('XI'); SET_PARAM 'XI'
1550 IF POS("FS1"=PTH(FILENO))=0 THEN BUSY=1 ELSE READ (FILENO,KNO=KEYNO,KEY=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$,DOM=*NEXT)IOL=0310; FOUND=1,BUSY=1,PRIMEKEY$=KEC(FILENO,KNO=0); EXTRACT (FILENO,KEY=PRIMEKEY$,KNO=0,ERR=*NEXT); BUSY=0
1551 SET_PARAM 'XI'=XP
1590 EXIT 
1598 ! 
1599 ! 
1600 INSERT:
1610 ENTER FILENO,A$,A{ALL},OK
1615 OK=0,PRIMEKEY$=A$(118,8)
1620 GOSUB INIT
1650 WRITE (FILENO,KEY=PRIMEKEY$,ERR=*NEXT)IOL=0310; OK=1
1680 GOSUB WRAPUP
1690 EXIT 
1698 ! 
1699 ! 
1700 DELETE:
1710 ENTER FILENO,A$,A{ALL},FOUND,BUSY
1715 FOUND=0,BUSY=1,PRIMEKEY$=A$(118,8)
1720 GOSUB INIT
1750 REMOVE (FILENO,KEY=PRIMEKEY$,DOM=DELETE_END,ERR=*NEXT); BUSY=0
1785 DELETE_END:
1787 GOSUB WRAPUP
1790 EXIT 
1798 ! 
1799 ! 
1800 CLEAR_FIELDS:
1810 ENTER A$,A{ALL}
1820 DIM A$(606),A[13] ! WO212768, expand FS1 string to 606
1890 EXIT 
1898 ! 
1899 ! 
1900 UPDATE:
1910 ENTER FILENO,A$,A{ALL},BUSY
1915 BUSY=1,PRIMEKEY$=A$(118,8)
1920 GOSUB INIT
1950 WRITE (FILENO,KEY=PRIMEKEY$,ERR=*NEXT)IOL=0310; BUSY=0
1980 GOSUB WRAPUP
1990 EXIT 
1998 ! 
1999 ! 
2000 CLEAR_LOCK:
2010 ENTER FILENO
2020 GOSUB INIT
2050 READ (FILENO,KNO=0,KEY="",ERR=*NEXT)
2080 GOSUB WRAPUP
2090 EXIT 
2098 ! 
2099 ! 
2500 VALIDATE:
2510 ENTER A$,A{ALL},MSG$
2520 A$=PAD(A$,351),MSG$=""
2990 EXIT 
2998 ! 
2999 ! 
9999 END 
10000 QTY_BY_ORD_DT:
10010 ENTER FILENO,ORD_DT$,QTY
10015 QTY=0
10020 CALL "UPDFS1;READBYKEY",FILENO,3,ORD_DT$,SEG2$,SEG3$,SEG4$,SEG5$,FS1$,FS1{ALL},FOUNDFS1
10030 CALL "UPDFS1;READNEXT",FILENO,FS1$,FS1{ALL},FOUNDFS1; IF FOUNDFS1 THEN IF ORD_DT$=FS1$(16,6) THEN QTY=QTY+1; GOTO *SAME
10090 EXIT 
10098 ! 
10099 ! 
10200 GET_PICK_ORD:
10210 ENTER FILENO,QTY
10215 QTY=0
10220 CALL "UPDFS1;READBYKEY",FILENO,6,"S",SEG2$,SEG3$,SEG4$,SEG5$,FS1$,FS1{ALL},FOUNDFS1
10230 CALL "UPDFS1;READNEXT",FILENO,FS1$,FS1{ALL},FOUNDFS1; IF FOUNDFS1 THEN IF FS1$(63,1)="S" THEN QTY=QTY+1; GOTO *SAME
10290 EXIT 
10298 ! 
10299 ! 
10300 QTY_BY_ORD_DT_UNPICKED:
10310 ENTER FILENO,ORD_DT$,QTY
10315 QTY=0
10320 CALL "UPDFS1;READBYKEY",FILENO,6," ",SEG2$,SEG3$,SEG4$,SEG5$,FS1$,FS1{ALL},FOUNDFS1
10330 CALL "UPDFS1;READNEXT",FILENO,FS1$,FS1{ALL},FOUNDFS1; IF FOUNDFS1 THEN IF POS(FS1$(63,1)="SY")<>0 THEN FOUNDFS1=0 ELSE IF FS1$(16,6)<ORD_DT$ THEN QTY=QTY+1; GOTO *SAME ELSE GOTO *SAME
10390 EXIT 
10398 ! 
10399 ! 
10400 CHECK_SUMM_BILL:! Check for customer default SB and order type WO 255959
10410 ENTER FM_CHL,CUST_CODE$,ORDER_TYPE1$,ORDER_TYPE3$,SUMM_BILL$
10420 SUMM_BILL$="N",Z=0
10445 XP=PRM('XI'); SET_PARAM 'XI' ! SSP259411
10450 DIM CD$(171); FIND (FM_CHL,KEY="D"+CUST_CODE$,DOM=SUMM_BILL_EXIT)CD$(1)
10452 ORD_TYPE$="",Z=0
10455 IF ORDER_TYPE1$="R" THEN ORD_TYPE$="R"
10460 IF ORDER_TYPE1$="W" THEN ORD_TYPE$="W"
10465 IF ORDER_TYPE1$=" " THEN IF ORDER_TYPE3$=" " THEN ORD_TYPE$="I"
10470 IF ORD_TYPE$<>"" THEN Z=POS(ORD_TYPE$=CD$(113,4))
10480 IF Z>0 THEN SUMM_BILL$="Y"
10490 SUMM_BILL_EXIT:
10491 SET_PARAM 'XI'=XP ! SSP259411
10495 EXIT 
10499 ! 
10500 GET_HOLD_ORD:
10510 ENTER FILENO,QTY
10515 QTY=0
10520 CALL "UPDFS1;READBYKEY",FILENO,6,"P",SEG2$,SEG3$,SEG4$,SEG5$,FS1$,FS1{ALL},FOUNDFS1
10530 CALL "UPDFS1;READNEXT",FILENO,FS1$,FS1{ALL},FOUNDFS1; IF FOUNDFS1 THEN IF FS1$(63,1)="P" THEN QTY=QTY+1; GOTO *SAME
10590 EXIT 
10598 ! 
10599 ! 
10600 CLEAR_PICK_HOLD:
10610 ENTER FILENO,FS2,ORDER$,OK$
10615 OK$=""
10620 CALL "UPDFS1;EXTRACTBYKEY",FILENO,0,ORDER$,SEG2$,SEG3$,SEG4$,SEG5$,FS1$,FS1{ALL},FOUNDFS1,BUSYFS1; IF BUSYFS1 THEN OK$="NO"; GOTO 10690
10630 IF FOUNDFS1 THEN FS1$(63,1)="S"; CALL "UPDFS1;UPDATE",FILENO,FS1$,FS1{ALL},BUSY
10640 CALL "UPDFS2;READBYKEY",FS2,0,ORDER$,SEG2$,SEG3$,SEG4$,SEG5$,FS2$,FS2{ALL},FOUNDFS2
10650 CALL "UPDFS2;READNEXT",FS2,FS2$,FS2{ALL},FOUNDFS2; IF FS2$(147,8)<>ORDER$ THEN FOUNDFS2=0
10660 WHILE FOUNDFS2
10665 FS2$(238,1)=" "; CALL "UPDFS2;UPDATE",FS2,FS2$,FS2{ALL},BUSYFS2
10670 CALL "UPDFS2;READNEXT",FS2,FS2$,FS2{ALL},FOUNDFS2; IF FS2$(147,8)<>ORDER$ THEN FOUNDFS2=0
10680 WEND 
10690 EXIT 
10698 ! 
10699 ! 
56000 REM "188067-New Pricing changes. Standard GP Percentage for a           
56002 REM "192797-Customer Invoicing Gateway parameter, Don't invoice         
56004 REM "197947-WMS Manager Information Console                             
56006 REM "197945-WMS picking.  if zero pick or qty<ord                       
56008 REM "212768-Add Blanket PO feature to work with the Contract feature.
56009 REM "255959-Field in Order Header for Summary Bill Y/N which will carry 
56010 REM "259411-EC error msg 000-EC3WS1-8463 on two DBE orders.             
