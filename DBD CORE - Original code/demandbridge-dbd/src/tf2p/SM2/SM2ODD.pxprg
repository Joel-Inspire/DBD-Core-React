0010 REM "Order Entry Special Shipping Receiving <SM2ODD>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 05/23/14 - 13.314444 - tma - SSP# 269404
0037 REM "269404-Issue with Invoice 1583957 - vendor invoice came thru CIG+  
0040 REM "Copyright 2014 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0042 REM "KMc - 12/15/87
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0110 X0$="SM2ODD",X1$="CIG Plus Order Special Shipping",K9$="",K9=0
0120 DIM Z0$(80,"-"),C0$(12),S9$(40)
0130 K0=6,K1=1
0135 C9=-1
0140 M0$="##,###,###.00-",M1$="##,##0"
0175 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0180 DEF FNN(Z9)=Z9/M
0185 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
0200 REM "
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)),Z1$(LEN(M0$),X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE'),Z1$=MNM('GS')+Z1$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A2$
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21]
0330 IOLIST C$,C[0],C[1],C[2],C[3]
0340 IOLIST D$
0350 IOLIST E$
0370 IOLIST W$,W[0],W[1],W[2],W[3],W[4],W[5],W[6],W[7],W[8],W[9]
0372 IOLIST S$,S[0],S[1],S[2],S[3],S[4],S[5],S[6],S[7],S[8],S[9]
0390 IOLIST P$,P[0],P[1],P[2],P[3]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01X FS1...  02O FS2...  03O PO3...  05O FM0...  06O ZZPARM  07O FS3...  08O AR1...  09O PO7...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
1000 REM "
1030 DIM B$(227),B[22],C$(171),C[3],D$(397),D[15],E$(53),E[1],W[9],S[9]
1035 DIM A$(30)
1110 A$(1)=Q1$
1120 READ (Z[1],KEY=A$(9,8),DOM=9900)IOL=0310 ! If order doesn't exist exit
1130 DIM W$(30); Q$=A$(9,8),W$(1)=A$
1140 READ (Z[2],KEY=A$(9,8)+A$(17,3),DOM=9900)IOL=0320 ! If order line doesn't exist exit
1150 READ (Z[7],KEY=A$(1,19)+" ",DOM=*NEXT)IOL=0370
1160 GOSUB 7700; GOSUB 7750
1500 REM "Read PO3 records and set values from FS3 records if avail. then display
1510 Y=7,L$="",L=0,E0=0; DIM L[20]
1520 A1$=A$(9,8)+" "+A$(17,3)
1530 READ (Z[3],KEY=A1$,DOM=1531)
1550 READ (Z[3],END=1800)IOL=0330
1555 IF LEN(C$)>=259 AND C$(225,35)<>S9$(1,35) THEN C0$=C$(225,28)
1560 IF C$(166,9)+C$(7,3)<>A1$ THEN GOTO 1800
1600 REM 
1610 C[3]=0
1615 DIM P[3]; FIND (Z[9],KEY=A$(9,8)+B$(9,1)+I5$+B$(6,3)+C$(10,1),DOM=1616)IOL=0390; C[3]=P[0]; GOTO 1631
1620 READ (Z[7],KEY=A$(1,19)+C$(10,1),DOM=1630)IOL=0372
1625 C[3]=S[0]
1630 IF C[3]=0 AND C[2]<>0 THEN C[3]=C[2] ! SSP#213465
1635 IF B$(9,1)<>DIM(1) AND C[3]>C[0] THEN DIM AR1$(599); READ (Z[8],KEY=A2$(6,10),DOM=*NEXT)AR1$(1); IF AR1$(526,1)="Y" THEN C[3]=C[0] ! WO263619, don't invoice overruns
1640 IF C[3]=0 AND B[10]<>0 THEN C[3]=C[0]*W[0]/B[10] ! SSP#213465
1700 REM "Display
1720 L$=L$+A$(1,19)+C$(10,1)+C$(12,4),L=L+1,T=T+C[3],L[L]=C[3]
1740 IF L[L]<>0 THEN X0=L; GOSUB 7850
1790 GOTO 1550
1800 REM "Input values for a page
1810 GOSUB 7800
1900 REM "End
1950 REM "If not eof then continue with record
1990 GOTO 9900
6450 REM "DISPLAY KEYS
6455 IF C9<0 THEN GOTO 6445
6460 CALL "ZZDISP","A",A$(1,8),"AR6",X3$,"","",17,3,X4$
6490 RETURN 
6600 REM "ALT KEY DATA READS
6690 RETURN 
6700 REM "ADD ENTRY
6790 GOTO 1630
7300 REM 
7310 ON FPT(C0)*10 GOTO 7390,7325,7330,7390
7325 IF V8$="" THEN X0=X0+1; GOTO 7390 ELSE X0=NUM(V8$(POS(STR(X0:"00")<=V8$,2),2)); GOTO 7390
7330 IF V8$="" THEN X0=X0-2; GOTO 7335 ELSE X0=POS(STR(X0-1:"00")<=V8$,2)-2; IF X0<0 THEN X0=0; GOTO 7390 ELSE X0=NUM(V8$(X0,2)); GOTO 7390
7335 IF X0<0 THEN X0=0; GOTO 7390
7390 C0=3; RETURN 
7700 REM "Set U/M divisor M
7705 DIM M$(21),M[1]
7710 READ (Z[13],KEY="U/M"+B$(124,4),DOM=7711)M$,M[0],M[1]
7715 IF M$(20,1)="Y" THEN M=M[1] ELSE M=B[5]
7720 IF M=0 THEN M=1
7740 RETURN 
7760 H9$=FNS$(B$(32,8)); IF H9$<>"" THEN H9$=H9$+QUO; IF POS(" "<>B$(40,8))<>0 THEN H9$=H9$+"x"
7770 H9$=H9$+FNS$(B$(40,8)); IF H9$<>"" THEN IF POS(" "<>B$(40,8))<>0 THEN H9$=H9$+QUO+" " ELSE H9$=H9$+" "
7775 IF NUM(B$(48,2))<>0 THEN H9$=H9$+B$(48,2)+" Ply "
7780 H9$=H9$+FNS$(B$(50,40))
7790 RETURN 
7840 RETURN 
7850 REM "Write amount out to FS3 file
7854 S1$=L$((X0-1)*24+1,24)
7855 DIM S[9]; S$=W$,S$(1,20)=S1$(1,20),S$(21,6)=A$(21,6),S$(27,4)=S1$(21,4),S[0]=L[X0],S[1]=W[1],S[6]=W[6]; GOSUB 7950
7860 IF S$(20,1)=" " THEN GOTO 7890
7865 IF S[0]<>0 THEN GOTO 7870
7866 REMOVE (Z[7],KEY=S$(1,20),DOM=7867)
7868 GOTO 7890
7870 WRITE (Z[7],KEY=S$(1,20))IOL=0372
7890 RETURN 
7950 REM "Figure extension S(2)
7955 IF M$(21,1)<>"Y" THEN GOTO 7975
7960 PRECISION 14
7965 IF W[0]=0 THEN S[2]=0,S[4]=0 ELSE S[2]=W[2]*L[X0]/W[0],S[4]=W[4]*L[X0]/W[0]
7970 PRECISION 2; S[2]=S[2]+0,S[4]=S[4]+0; GOTO 7990
7975 IF M=0 THEN S[2]=0,S[4]=0 ELSE S[2]=S[0]/M*S[1],S[4]=S[0]/M*S[6]; IF M[0]<>0 THEN S[2]=S[2]/M[0],S[4]=S[4]/M[0]
7990 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 REM "269404-Issue with Invoice 1583957 - vendor invoice came thru CIG+  , If line special ship and previously rec not coming into ART
