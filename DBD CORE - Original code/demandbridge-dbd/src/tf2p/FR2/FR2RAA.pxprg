0010 REM "Financial Statement Printing <FR2RAA>
0025 REM "(C) Copyright 1987 - All Rights Reserved
0035 REM "5.7 - 07/17/15 - 16.766944 - tma - SSP# 278621
0037 REM "278621-FRAN - F/R Financial report does not exist in GUI           
0040 REM "Copyright 2015 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0100 SETERR 9000; SETESC 9300
0101 SETERR 0000
0110 X0$="FR2RAA",X1$="Financial Statement Printing"
0120 DIM A$(128),A[30],B[2],D[2],S$(50),G$(300)
0210 T=1,T0=1,T1=1
0220 W3=190; REM "REFER TO 4000-4199
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0300 REM "I/O lists
0305 REM "IOLIST FOR FRP - Financial Statement Print File
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24],A[25],A[26],A[27],A[28],A[29],A[30]
0330 IOLIST C$,C[0],C[1],C[2]
0340 IOLIST D$,S[0,P0],S[1,P0],Q
0360 IOLIST F$
0370 IOLIST G$
0390 IOLIST H$,Q
0400 IOLIST J$
0420 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01O FRP...  03O FR2...  04O FR3...  05O FR4...  06O FR1...  07O FR6...  08O ZY2  09O FR5... 10O FRE... "; IF V1$(1,3)<>Y$(5,3) THEN Y$=Y$+"02O "+V1$+" "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0590 F9$="G/L"
0700 REM "Open Printer
0710 IF V0$(79,3)<>"   " THEN GOSUB 7500
0720 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0721,9900
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[1]; U=4,U0=1,U[0]=0,U[1]=4,T0=0,U0$="    ",T5$="   "; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0912 V9$=V2$
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
0995 IF J9=1 THEN GOTO 3200
1000 REM "Read next record
1005 U$=KEY(U1,END=5000)
1006 IF J9=1 THEN GOTO 1100
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])<V2$(U3,U[U9]) THEN READ (U1,END=5000); EXITTO 1000
1030 IF U$(U2,U[U9])>V2$(U3+U[U9],U[U9]) THEN IF U=1 THEN EXITTO 5000 ELSE READ (U1,END=5000); EXITTO 1000
1040 NEXT U9
1100 REM "Get record"
1110 U9$=U$
1120 ON V0 GOTO 1150,1150,1130,1140
1150 READ (Z[1],KEY=U$,DOM=1000)IOL=0310
1300 REM "Read other data
1305 IF A$(1,4)<>G$(1,4) THEN IF J9>0 THEN GOTO 3200 ELSE GOSUB 3100
1310 REM IF A$(9,1)="C" THEN GOSUB 04000; GOTO 01000
1315 H$=G$(230,4)+U$(5,16)
1320 Q3=0; READ (Z[9],KEY=H$,DOM=1321)IOL=0390; GOTO 1330
1325 IF H$(9)=S$(1,12) THEN GOTO 1000 ELSE H$(9,12)=""; GOTO 1320
1390 S1$=FNS$(H$(190,12)); IF S1$="PX" THEN GOTO 1000 ELSE IF POS("PR"=S1$)=0 THEN S1$=S1$+"PR"
1392 IF A$(21,1)="H" THEN A[30]=1; REM "FIX FOR OLDER TEMPLATES
1395 IF POS("Z"=G$(267,10))>0 THEN Q=0; FOR X=0 TO 30; Q=Q+ABS(A[X]); NEXT X; IF Q=0 THEN GOTO 1000
1400 REM "PRINT FUNCTIONS
1420 T9$=S1$(1,2)
1430 IF T9$(1,1)="L" THEN GOSUB 4900; GOTO 1900
1435 IF T9$="PB" THEN GOSUB 6000; GOTO 1900
1500 REM "Print Data
1510 IF W+1>W0 THEN GOSUB 6000
1520 FOR X=0 TO P0
1522 Q0=1+S[1,X],Q1=S[0,X]
1524 IF Q3<>0 AND X=0 THEN Q0=Q0+Q3
1525 Q$=S0$(X*P1+1,P1)
1530 IF Q$(4,8)="TITLE   " AND T9$="PR" THEN X$=A$(31,50); GOTO 1600 ELSE IF H$(21,1)="H" THEN GOTO 1680
1550 REM "NUMBER
1560 M=4+POS(Q$(12,4)=M0$); IF M<>M9 THEN M9=M,M$=M0$(M,POS("!"=M0$(M))-1)
1580 IF T9$="PR" THEN X$=STR(A[X+1]:M$); SUM_X=SUM_X+ABS(A[X+1]) ELSE IF T9$(1,1)="U" THEN IF X=0 THEN X$="" ELSE DIM X$(LEN(M$),T9$(2)) ! SSP244400 jdf
1600 REM 
1605 REM IF T9$<>"PR" AND POS(Q$(1,1)="FDU")=0 THEN GOTO 01650
1608 IF Q$(12,4)="0000" THEN GOTO 1680
1610 REM LET X$=FNT$(X$)
1615 P=Q0+Q1-LEN(X$); IF Q$(15,1)="L" THEN P=Q0 ELSE IF Q$(15,1)="C" THEN P=Q0+INT(Q1/2)
1620 IF P<1 THEN P=1
1625 Y5$(P)=X$
1650 REM 
1680 NEXT X
1700 IF POS("Z"=G$(267,10))>0 THEN IF SUM_X=0 AND H$(21,1)="D" THEN DIM Y5$(W3); GOTO 1821 ! SSP244400 jdf
1800 REM 
1820 GOSUB 7300
1825 SUM_X=0 ! SSP244400 jdf
1900 REM "NEXT FUNCTION
1910 S1$=S1$(3); IF S1$>"" THEN GOTO 1400
1990 GOTO 1000
3100 REM "REPORT CHANGE
3120 READ (Z[7],KEY=A$(1,4))IOL=0370
3125 GOSUB 4000
3130 X1$=FNS$(G$(35,65)),W0$=FNS$(G$(100,65)),W1$=FNS$(G$(165,65))
3140 CALL "FR2RAZ",X3$,X4$,Z[8],V0$(77,2),G2$,X1$; X1$=X1$+" ("+G$(1,4)+")"
3145 CALL "FR2RAZ",X3$,X4$,Z[8],V0$(77,2),G2$,W0$
3146 CALL "FR2RAZ",X3$,X4$,Z[8],V0$(77,2),G2$,W1$
3150 W1=W,W=W0+1; REM "Set W to > W0 to force item feed at next check, however save current value in W1 so that we can pass it to ZZHEAD so it can FF correclty for odd page sizes
3155 REM (234,4)=COLUMN CONTROL
3160 IF FID(W9)<>FID(0) THEN PRINT @(12,10),"Report: ",A$(1,4),"  ",G$(5,30)
3190 RETURN 
3200 REM "Using report group, next report
3210 IF R0$(5,3)="000" THEN R0$=R0$(8) ELSE R0$(5,3)=STR(NUM(R0$(5,3))-1:"000")
3215 IF R0$="" THEN GOTO 5020
3220 READ (U1,KEY=R0$(1,4),DOM=3221)
3225 A$(1,4)=R0$(1,4); GOSUB 3100
3226 U$=KEY(U1)
3290 GOTO 1000
4000 REM "Column Change
4005 S0$="",P0=0,Q0=0,Q1=0,Q2=0,W3=190,C9=0
4008 DIM C[3]
4010 READ (Z[3],KEY=G$(234,5))IOL=0330
4015 IF LEN(C$)>36 THEN IF NUM(C$(36,3))>0 THEN W3=NUM(C$(36,3))
4020 DIM S[1,30]; P0=0,P1=0; READ (Z[4],KEY=C$(1,5),DOM=4021)
4030 READ (Z[4],END=4100)IOL=0340; IF D$(1,5)<>C$(1,5) THEN GOTO 4100 ELSE IF Q>0 THEN C9=Q
4035 S0$=S0$+D$(6),P0=P0+1; IF P1=0 THEN P1=LEN(D$)-5
4090 GOTO 4030
4100 REM "GET MASKS AND HEADINGS
4102 REM "IF C9>0 THEN LET W3=C9
4105 DIM S9$(W3*3),M$(0)
4110 FOR X=1 TO LEN(S0$) STEP P1
4115 P0=INT(X/P1)
4120 FIND (Z[6],KEY=F9$+S0$(X+3,8))IOL=0360
4125 IF F$(42,1)="T" THEN DIM M$(NUM(S0$(X+12,3))); GOTO 4135
4128 Q$=S0$(X+11,4)
4130 M=POS(Q$=M0$); CALL "ZZMASK",Q$(2),M$; IF M=0 THEN M0$=M0$+Q$+M$+"!"; GOTO 4130
4135 Q0=LEN(M$)+S[0,P0]+1,Q2=Q2+Q0,S[1,P0+1]=Q2,Q1=S[1,P0],S[0,P0]=Q0
4140 GOSUB 4200
4145 REM LET S0$(X,2)=F$(42,1)
4180 NEXT X
4190 RETURN 
4200 REM "JUSTIFY HEADINGS
4210 FOR Y=0 TO 2
4215 X$=FNS$(FNT$(F$(129+Y*12,12)))
4220 P=Q0+Q1-LEN(X$); IF S0$(X+16,1)="C" THEN P=Q1+INT(Q0/2) ELSE IF S0$(X+16,1)="L" THEN P=1
4225 IF X$>"" THEN S9$(Y*W3+P,Q0)=X$
4250 NEXT Y
4290 RETURN 
4900 REM "LINE FEED
4905 IF T9$="LP" THEN W1=W,W=W0+1; GOTO 4980; REM "Save off old value of W into W1 before setting to W0+1 to force item feed at next page check, This is so we can know where we are before doing FF on odd size paper
4910 T9=NUM(T9$(2))
4915 IF T9>0 THEN Y5$(1)=""; GOSUB 7300; T9=T9-1
4990 RETURN 
5000 REM "End of Print
5010 IF J9=1 THEN GOTO 3200
5020 IF W8=0 THEN GOTO 5290
5030 T0$="END"
5040 IF V1>0 THEN GOSUB 3120
5050 T=0,T$="Report"; GOSUB 7000
5200 REM "
5500 REM "Update Allocations?
5510 IF V0$(72,1)<>"Y" THEN GOTO 9900
5520 CALL "ZZPROM",".Y",X3$,S3,"Do you wish to update the allocating entries?","","",0; ON S3 GOTO 9900,5521
5590 GOTO 9900
6000 REM "Page header
6005 Q4=W3; IF Q4<40 THEN Q4=80
6010 IF V0$(93,1)="N" THEN W4$="S" ELSE W4$=""; REM "WAS 'S'
6035 IF W1<>0 THEN W=W1,W1=0; REM "W1 was saved current position on page, when W was manipulated to force a item feed. We must reset W prior to calling ZZHEAD or it will not do odd page lengths correctly
6040 CALL "ZZHEAD",X0$,X1$,X2$,X3$,W0$,W1$,W2$,W3$,Q4,W,W9,W8,W0,W5,W2,W4$,W5$
6045 ON W5 GOTO 6046,9900
6050 IF V0$(72,1)="Y" THEN Y5$(1)="** Allocation run **"; GOSUB 7300
6060 GOSUB 6100
6070 GOSUB 7300
6090 RETURN 
6100 REM "
6110 IF S9$="" THEN GOTO 6140
6125 FOR Y=0 TO 2
6130 Y5$=S9$(Y*W3+1,W3); GOSUB 7300
6135 NEXT Y
6199 RETURN 
6900 REM "SORT
6905 IF S9$="X" THEN GOTO 6990 ELSE S0=Z[1],S1=Z[2]
6940 CALL "ZZSORT",X3$,"",V1$,S9$,"","",0,0,0,S0,S1,X9
6990 RETURN 
7000 REM "Totals logic
7001 IF T=T0 THEN IF T[T0,0]<2 THEN GOSUB 7300; GOTO 7100
7002 IF W+3>W0 THEN GOSUB 6000
7010 Y5$(1)=T3$(1,T0+1-T)+" "
7015 IF T$<>"" THEN Y5$(T0+2-T)=""+Q2$+" ("+STR(T[T,0]:"0")+"):"
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7200; GOTO 7190
7095 GOSUB 7300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7205 GOSUB 7300; Y5$(1)=Q1$+": "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 T4$=STR(INT(T2):"##0")
7230 T3=INT(FPT(T2)*3600)
7240 T3=T3/60
7250 T4$=T4$+":"+STR(T3:"00")
7260 Y5$(1)=Q3$+": "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7330 IF Y5$=Y6$ THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; DIM Y5$(W3)
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7455 FIND (Z[13],KEY=X3$(9,3)+"G/LYE"+V0$(73,4))G2$
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"   ")-1)
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 RETURN 
7500 REM "Get list of reports if this is report group
7510 R0$=""; READ (Z[10],KEY=V0$(79,3),DOM=7511)
7520 READ (Z[10],END=7540)IOL=0400
7525 IF J$(1,3)<>V0$(79,3) THEN GOTO 7539
7530 R0$=R0$+J$(7,7)
7535 GOTO 7520
7540 IF R0$="" THEN GOTO 9900 ELSE J9=1
7545 RETURN 
8900 REM "Function Statements
8905 DEF FNS$(Z$)=Z$(1,POS(S$=Z$+S$)-1)
8910 DEF FNT$(Z$)=Z$(POS(" "<>Z$+"X"))
9000 REM "ERROR PROCESSING
9001 ESCAPE 
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9300 ESCAPE 
9900 REM "End program
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 IF Y4$<>"" THEN RUN Y4$,ERR=9931
9940 IF %GUI THEN EXIT ELSE RUN "ZMENU" ! SSP#278621!SSP#278621
9999 END 
56000 REM "244400-Issue with FRAN report printing out zero's when it should   
