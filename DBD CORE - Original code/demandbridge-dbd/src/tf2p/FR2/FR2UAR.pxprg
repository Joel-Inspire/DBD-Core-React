0010 REM " Financial Statement Update <FR2UAR>
0090 CLEAR 
0100 SETERR 9000; SETESC 9300
0110 X0$="FR2UAR",X1$=" Financial Statement Update"
0120 DIM Z0$(80,"-"),S$(100),T[30],F[2],H[14],Y[4,13]
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0290 F9$="A/R"
0300 REM "IOLISTS
0310 IOLIST A$
0320 IOLIST B$,B[0],B[1]
0330 IOLIST C$,C[0],C[1]
0340 IOLIST D$,D[0],D[1]
0350 IOLIST E$,E[0],E[1]
0360 IOLIST F$,F[0],F[1],F[2]
0370 IOLIST G$,G[0],G[1]
0380 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13],H[14]
0381 IOLIST H$
0390 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14]
0400 IOLIST J$,J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8],J[9],J[10],J[11],J[12],J[13],J[14],J[15],J[16],J[17],J[18],J[19],J[20],J[21],J[22],J[23],J[24],J[25],J[26],J[27],J[28],J[29],J[30]
0410 IOLIST K$
0420 IOLIST L$,L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15],L[16],L[17],L[18],L[19],L[20],L[21],L[22],L[23],L[24],L[25],L[26],L[27],L[28],L[29],L[30]
0500 REM "FILES
0505 Z=NUM(X3$(60,3)); DIM Z[Z]
0510 Z$="01L FR6...  02O FR1...  03O FR2...  04O FR3...  05O FR4...  06O FR5...  07O FR6...  08O FRI...  09O AR9...  10O ZZP...  11O AR1...  12O FRT...  "
0515 Z$=Z$+"13O ZZPARM  "
0520 GOSUB 8850; ON Z0 GOTO 0521,9900
0530 READ (Z[10],KEY=X3$(1,8))*,*,*,*,*,G0$
0535 READ (Z[13],KEY=X3$(9,3)+"G/LYE"+G0$(74,4),DOM=9900)G1$
0540 G0=NUM(G0$(78,2))
0545 Z$="10CU        10L AR-...  "; GOSUB 8850
0585 CALL "ZZDROP"
0590 ADDR "ZZPACK",ERR=0591
0591 ADDR "ZZFLTR"
0595 ADDR "FR2UZA",ERR=0596
0596 ADDR "ZZ2MDZ"
0600 REM "
0620 GOSUB 8800
0695 CALL "ZZPROM","U6",X3$,0,U9$,"","",0
0730 DIM A$(250),A[1]
0800 REM "CHECK FOR ROOM?
0805 CALL "ZZPROM","U1",X3$,0,"","","",0
0810 DIM X[Z,1],X$(0)
0815 FOR X=1 TO Z
0820 CALL "ZZINFO",X,0,X3$,A,B,0,0,0,0,0,""; X[X-1,0]=A,X[X-1,1]=B
0825 NEXT X
0830 PRINT @(0,22),'CL',
0835 IF X[Z[1]-1,0]=0 THEN CALL "ZZPROM","U2",X3$,S3,"","","",0; GOTO 9900
0840 GOTO 0900
0880 REM "PROMPT OUT OF ROOM
0890 CALL "ZZPROM","U3",X3$,S3,"","","",0; GOTO 9900
1000 REM "GET NEXT REPORT
1020 K0$=KEY(Z[1],END=5000)
1025 READ (Z[1],KEY="09",DOM=1026)
1026 K0$=KEY(Z[1])
1030 READ (Z[1])IOL=0310
1090 PRINT @(7,12),U9$," ",K0$,
1100 REM "READ TEMPLATE HEADER
1120 GOSUB 2900
1130 GOSUB 3000
1150 REM "
1300 REM "
1390 READ (Z[6],KEY=E$(1,4),DOM=1391)
1400 REM "READ NEXT TEMPLATE LINE
1410 R0$=""
1420 READ (Z[6],END=1990)IOL=0360
1430 IF F$(1,4)<>E$(1,4) THEN GOTO 1990
1440 IF F$(9,1)="D" THEN IF F$(10,1)>="A" AND F$(10,1)<="Z" THEN GOTO 2700 ELSE ON Y9 GOTO 1500,2500
1450 IF F$(9,1)="T" THEN GOTO 4200
1460 IF F$(9,1)="H" THEN GOTO 4300
1470 IF F$(9,1)="C" THEN Q$=F$(64,5); GOSUB 3400
1490 GOTO 1400
1500 REM "DATA LINE
1502 IF F$(10,1)>="A" THEN GOSUB 2700; GOTO 1578
1505 T0$=F$(154,6),T1$=F$(160,1); IF F$(9,1)="D" THEN M0$=F$(142,10),M1$=A$(239,10) ELSE M0$="",M1$=""
1510 R0$=F$(118,10),R9$=F$(130,10); IF F$(11,1)="S" THEN R1$=R9$; GOTO 1530 ELSE R1$=""; EXTRACT (Z[11],KEY=R0$,DOM=1511)
1520 I$=KEY(Z[11],END=1700); IF I$(1,LEN(R9$))>R9$ THEN GOTO 1700 ELSE R0$=I$(1,LEN(R0$)),R1$=""; READ (Z[11])
1525 IF M0$>"" THEN CALL "ZZFLTR",X3$,M0$,M1$,R0$,Q,0; ON Q GOTO 1520,1526
1530 GOSUB 4400
1540 P0=1; FOR X=1 TO LEN(C2$) STEP 11
1542 PRINT @(12,14),R0$," ",C2$(X,11),
1545 C5=POS(C2$(X,11)=C3$,11); IF C5>0 THEN C5=INT(C5/11); GOSUB 7100; GOTO 1580
1565 IF B$(1,11)<>C2$(X,11) THEN READ (Z[2],KEY=C2$(X,11))IOL=0320
1570 GOSUB 2400
1575 P0=POS(C2$(X,11)=C6$),P0=INT(P0/11)+1
1578 J[P0]=R0
1580 REM 
1590 NEXT X
1600 REM "WRITE LINE
1640 WRITE (Z[10],KEY=J$(1,21))IOL=0400
1650 GOSUB 4000
1680 IF F$(11,1)<>"1" THEN GOTO 1520
1695 GOTO 1900
1700 REM "F/S DETAIL
1800 REM 
1950 GOTO 1400
1990 GOSUB 4900
1995 GOTO 1000
2000 REM 
2010 GOSUB 7700
2015 ESCAPE 
2020 RUN "FR2RAA"
2040 ESCAPE 
2300 REM "Update Columnar Control Masterfile
2310 IF C$>"" THEN IF Q$=C$(1,5) THEN GOTO 2390
2320 DIM C$(47),C[1]
2325 C$(1,5)=Q$
2340 FIND (Z[3],KEY=C$(1,5))IOL=0330
2360 GOSUB 2600
2390 RETURN 
2400 REM "GET FINANCIAL DATA
2415 IF F$(63,1)="R" THEN GOTO 2700
2420 Q$=G0$(74,4)
2440 CALL "FR2UZA",X3$,G0,B$,Q$,G0$(78,2),R0,R0$,R1$,M0$,M1$,X9$,Y{ALL}
2445 RETURN 
2480 ESCAPE 
2495 RETURN 
2500 REM "CONSOLIDATED REPORT DATA LINE
2505 Q$=A$(1,4)+F$(5,4)
2510 READ (Z[10],KEY=Q$,DOM=2511)
2520 READ (Z[10],END=2590)IOL=0400
2525 IF Q$<>J$(1,LEN(Q$)) THEN GOTO 2590
2530 GOSUB 4000
2580 GOTO 2520
2595 GOTO 1400
2600 REM "New column control code
2605 GOSUB 4400; J$(22)=C$
2610 WRITE (Z[10],KEY=J$(1,21))IOL=0400
2620 DIM D$(72),D[1],C6$(11*30)
2625 DELETE 7101,7189
2630 C0$="",C1$="",C2$="",C3$="",C4$="",C5$="",C5=0,C1=0
2640 READ (Z[4],KEY=C$(1,5),DOM=2641)
2650 READ (Z[4],END=2800)IOL=0340
2655 IF D$(1,5)<>C$(1,5) THEN GOTO 2800
2670 C0$=C0$+" "+D$(8,8)
2690 GOTO 2650
2700 REM "GET VALUE FOR SPECIFIC TOTAL ELEMENT
2705 Q$=FNS$(F$(64,20)),T0$=Q$(1,POS("."=Q$+".")-1),Q$=Q$(1+POS("."=Q$)),T0$=T0$+S$(1,6-LEN(T0$))+F$(114,4),Q$=" "+Q$+S$(1,8-LEN(Q$))
2710 FIND (Z[12],KEY=T0$)IOL=0420
2715 L0=ASC(F$(10,1))-64,L1=POS(Q$=L$(11),9),R0=0; IF L1>0 THEN L1=INT(L1/9),R0=L[L1+1]
2720 J[L0+1]=R0,K$=KEY(Z[6],END=2740); IF K$(1,8)=F$(1,8) THEN READ (Z[6])IOL=0360; GOTO 2705
2740 Q$=F$(5,4)+"D ",Q$=Q$+S$(1,21-LEN(Q$))
2745 J$(5,LEN(Q$))=Q$
2760 GOTO 1600
2790 RETURN 
2800 REM "DETRERMINE DATA TYPES
2805 DIM B[2]
2810 FOR X9=1 TO LEN(C0$) STEP 9
2815 READ (Z[2],KEY=F9$+C0$(X9+1,8))IOL=0320
2820 FOR Y=0 TO 5; Q$=B$(43+Y,1); IF Q$<>" " THEN IF POS(Q$=C4$)=0 THEN C4$=C4$+Q$
2825 NEXT Y
2828 C6$(11*INT(X9/9)+1,11)=B$(1,11)
2830 IF POS(B$(42,1)="FP")>0 THEN GOSUB 8000 ELSE C2$=C2$+B$(1,11)
2840 NEXT X9
2860 REM "CONTROL FOR COL CALCS
2865 IF C5=0 THEN GOTO 2890 ELSE Q0$="7105R0=0;SETERR7195;ONC5+1GOTO7110,"; FOR X=1 TO C5; Q0$=Q0$+STR(7105+X*5)+","; NEXT X; Q0$=Q0$+"7195"
2870 EXECUTE Q0$
2890 RETURN 
2900 REM "Update report template master
2910 DIM E$(60),E[1]
2940 READ (Z[5],KEY=A$(230,4))IOL=0350
2990 RETURN 
3000 REM "Get consolidation reports
3005 Y9$="",Y9=0
3010 Z$="08C FRI...  08O FRC...  "; GOSUB 8850; ON Z0 GOTO 3011,9900
3030 READ (Z[8],KEY=A$(251,4),DOM=3031)IOL=0381
3040 READ (Z[8],END=3090)IOL=0381
3045 IF H$(1,4)<>A$(251,4) THEN GOTO 3090
3050 Y9$=Y9$+H$(5,8)
3055 GOTO 3040
3090 Z$="08C FRC...  "; IF Y9$="" THEN Z$=Z$+"08O FRI...  " ELSE Z$=Z$+"08OSFRP...  "
3095 GOSUB 8850; IF Y9$="" THEN GOTO 3300 ELSE Y9=LEN(Y9$)
3100 REM "ACCUMULATE CONSOLIDATIONS
3105 M0$=A$(239,10),M1$=""; GOSUB 3900
3120 FOR X=1 TO LEN(Y9$) STEP 8
3125 Q$=Y9$(X+3,4)
3130 REM "COMPANY CHANGE LOGIC NEEDED HERE ....*****
3150 READ (Z[10],KEY=Q$,DOM=3151)
3160 READ (Z[10],END=3200)IOL=0400
3165 IF J$(1,LEN(Q$))<>Q$ THEN GOTO 3200 ELSE IF J$(9,1)<>"D" THEN GOTO 3160
3170 J$(15,1)="?"
3175 DIM L[30]; L$=J$; L$(1,LEN(Q$))=A$(1,LEN(Q$)),J$=L$
3180 FIND (Z[8],KEY=L$(1,21),DOM=3190)IOL=0420
3185 FOR X=0 TO 30; J[X]=J[X]+L[X]; NEXT X
3190 WRITE (Z[8],KEY=J$(1,21))IOL=0400
3195 GOTO 3160
3200 REM 
3240 NEXT X
3280 Z$="08C FRP...  08O FRI...  "; GOSUB 8850
3300 REM "
3390 RETURN 
3400 REM 
3410 IF A$(234,5)<>"     " THEN Q$=A$(234,5)
3420 GOSUB 2300
3490 RETURN 
3900 REM 
3905 Q8$=""
3910 FOR X=1 TO LEN(M0$); IF M0$(X,1)="?" THEN Q8$=Q8$+",J$("+STR(9+X)+",1)="+$22$+"?"+$22$
3920 NEXT X; IF Q8$="" THEN Q8$="3170REM" ELSE Q8$="3170"+Q8$(2)
3930 EXECUTE Q8$
3935 Q8$=""
3940 RETURN 
4000 REM "Accumulate to totals
4010 FOR X=0 TO 4
4015 T0$=F$(154+X*7,6),T1$=F$(160+X*7,1)
4020 IF POS(" "<>T0$)>0 THEN GOSUB 4100
4040 NEXT X
4090 RETURN 
4100 REM "Flush total 
4110 IF L$>"" THEN IF L$(1,6)=T0$ THEN GOTO 4160
4115 S0=1; IF T1$="-" THEN S0=-1
4117 IF F[0]<>0 THEN S0=S0*F[0]
4120 DIM L[30],L$(10)
4130 L$=T0$+A$(1,4)+C0$
4140 FIND (Z[12],KEY=L$(1,10),DOM=4141)IOL=0420
4160 FOR Q=0 TO 30; IF J[Q]=0 THEN GOTO 4170 ELSE T9$=FNS$(C6$((Q-1)*11+4,8)); IF T9$>"" THEN T9$=FNS$(T0$)+"."+T9$,T9=POS(T9$=C5$,16); IF T9>0 THEN T9=1+INT(T9/16)
4165 L[Q]=L[Q]+J[Q]; IF T9>0 THEN T[T9]=L[Q],T9=0
4170 NEXT Q
4175 C5=-1; GOSUB 7100
4180 WRITE (Z[12],KEY=L$(1,10))IOL=0420
4190 RETURN 
4200 REM "SET LINE TOTAL
4210 GOSUB 4400
4220 L$="",T0$=F$(64,6),T1$="+"; GOSUB 4100
4240 FOR X=0 TO 30; J[X]=L[X]; NEXT X
4245 C5=-1; GOSUB 7100
4250 WRITE (Z[10],KEY=J$(1,21))IOL=0400
4260 GOSUB 4000
4290 GOTO 1400
4300 REM "HEADER LINE
4310 GOSUB 4400
4330 WRITE (Z[10],KEY=J$(1,21))IOL=0400
4390 GOTO 1400
4400 REM "SETUP F/S PRINT FILE
4420 DIM J$(128),J[30]
4425 J$(81,10)=F$(190,10)
4430 J$(1,9)=A$(1,4)+F$(5,5),J$(10,10)=""; IF F$(11,1)<>"1" THEN J$(10,10)=R0$
4440 IF F$(11,1)<>"S" THEN FIND (Z[11],KEY=R0$,DOM=4441)Q$; IF F$(62,1)<>"1" THEN J$(31,50)=Q$(11,40)
4450 IF F$(9,1)<>"D" OR F$(62,1)="1" THEN J$(31,50)=F$(12,50)
4490 RETURN 
4690 RETURN 
4900 REM "END OUT OLD REPORT
4910 GOSUB 7700
4990 RETURN 
5000 REM "END OF UPDATE
5100 REM "
5200 REM 
5240 PRINT 'CF'
5250 RUN "AR2SAA"
5400 REM 
5450 GOTO 9900
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6020 CALL "ZZPROM","U9",X3$,0,"","","",4
6025 CALL "ZZPROM","U8",X3$,0,"+ "+V0$(22,4)+"."+V0$(26,2),"","",7
6030 PRINT V0$(22,4),".",V0$(26,2),
6165 PRINT (0,ERR=6066)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6225 GOSUB 6450
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6410 GOSUB 6000
6430 IF C9>0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6490 RETURN 
7000 REM "CREATE COLUMN CALCULATION FUNCTION FROM D$
7005 E0$="J("+STR(INT(X9/9)+1)+")"
7010 Q0$=STR(C5*5+7110)+"SETERR"+STR(C5*5+7111)+";"+E0$+"=0,"+E0$+"=",Q9$="*"+STR(C5),C5=C5+1
7015 FOR X=1 TO LEN(Q8$); IF Q8$(X,1)="{" THEN Q0$=Q0$+"J(" ELSE IF Q8$(X,1)="}" THEN Q0$=Q0$+")" ELSE Q0$=Q0$+Q8$(X,1)
7020 NEXT X
7030 EXECUTE Q0$
7040 EXECUTE STR(C5*5+7106)+"IFC5>=0RETURN"
7095 RETURN 
7100 REM "Calculations: Program code changes varying on Column Setings
7105 R0=0; SETERR 7195; ON C5+1 GOTO 7110,7110,7115,7195
7110 SETERR 7111; J[4]=0,J[4]=J[2]-J[3]
7111 IF C5>=0 THEN RETURN 
7115 SETERR 7116; J[7]=0,J[7]=J[5]-J[6]
7116 IF C5>=0 THEN RETURN 
7295 C5=-1; SETERR 9000; RETURN 
7700 REM "CALC TOTALS FOR REPORT A$(1,4)
7710 REM "GOSUB 7800
7720 READ (Z[10],KEY=A$(1,4),DOM=7721)
7730 K$=KEY(Z[10],END=7770); READ (Z[10],END=7770)IOL=0400
7735 IF J$(1,4)<>A$(1,4) THEN GOTO 7770
7740 IF POS(J$(9,1)="DT")=0 THEN GOTO 7730
7750 C5=-1; GOSUB 7100
7760 WRITE (Z[10],KEY=K$)IOL=0400
7765 GOTO 7730
7790 RETURN 
7800 REM "GET TOTAL VALUES
7805 T9=0
7810 FOR X=1 TO LEN(C5$) STEP 16; T9=T9+1
7815 Q$=C5$(X,16),Q=POS("."=C5$)-1; T0$=Q$(1,Q)+S$(1,6-Q)
7816 ESCAPE 
7880 NEXT X
7890 RETURN 
8000 REM "CALCULATED DATA TYPE
8005 F8$=" +-/*()}.0123456789",F8=POS("0"=F8$)-1,C3$=C3$+B$(1,11),Q$=FNS$(B$(64,65)),Q8$=""
8010 Q0=0,Q0$="",Q1$=""
8015 IF Q$="" THEN GOTO 8045 ELSE X$=Q$(1,1),Q$=Q$(2); IF X$="{" THEN GOTO 8300
8018 IF Q0=1 THEN IF POS(X$=F8$(1,F8))>0 THEN Q1$=Q0$; GOSUB 8100 ELSE Q0$=Q0$+X$
8020 IF Q0=0 THEN IF POS(X$=F8$)=0 THEN Q0=1,Q0$=Q0$+X$ ELSE Q8$=Q8$+X$
8025 IF X$="{" THEN GOSUB 8300
8040 GOTO 8015
8050 IF Q0=1 THEN Q1$=Q0$; GOSUB 8100
8060 REM "SET THIS COLUMN
8080 C2$=C2$+C3$(LEN(C3$)-10,11)
8085 GOSUB 7000
8090 RETURN 
8100 REM "GOT DATA NAME
8110 Q1$=F9$+Q1$+S$(1,8-LEN(Q0$))
8115 P=POS(Q1$=C6$,11); IF P>0 THEN P=1+INT(P/11); GOTO 8180
8120 REM "DATA ELEMENT NOT IN C6$
8130 GOSUB 8200; GOTO 8115
8180 Q8$=Q8$+"{"+STR(P)+"}"
8190 Q0$="",Q0=0,Q1$=""
8195 RETURN 
8200 REM "ADD DATA ELEMENT TO C6$
8210 Q=LEN(C6$)-10
8215 IF C6$(Q,1)<>" " THEN Q=Q-11; GOTO 8215
8220 FIND (Z[2],KEY=Q1$)IOL=0320
8230 IF B$(42,1)<>"F" THEN C6$(Q,11)=Q1$,C2$=C2$+Q1$; GOTO 8290
8240 REM "FORMULA!
8250 Q$=X$+Q$,X$="("+FNS$(B$(64,65))+")",Q$=X$+Q$
8260 EXITTO 8261
8261 EXITTO 8010
8295 RETURN 
8300 REM "TOTAL INVOLVED IN CALCULATION
8305 Q=POS("}"=Q$); Q1$=Q$(1,Q-1),Q$=Q$(Q+1)
8310 Q1$=Q1$+S$(1,16-LEN(Q1$)),Q=POS(Q1$=C5$,16)
8315 IF Q=0 THEN C5$=C5$+Q1$; GOTO 8310 ELSE Q=INT(Q/16)+1,Q8$=Q8$+"T("+STR(Q)+")"
8390 GOTO 8010
8700 REM "RUN THROUGH MASKING
8701 ESCAPE 
8705 ESCAPE 
8800 REM "CLEAR FILES
8810 Q$=STR(Z[10]:"00")+STR(Z[12]:"00")
8820 CALL "ZZINIT",Q$
8840 RETURN 
8850 REM "OPEN FILES
8860 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
8890 RETURN 
8910 DEF FNS$(Z$)=Z$(1,POS("  "=Z$+"  ")-1)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,1
9045 REM 
9050 ON Y7 GOTO 9060,9100,9190,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOSUB 6600; GOTO 9900
9260 EXITTO 8190
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9900 REM "END PROGRAM
9901 ESCAPE 
9905 CALL "ZZDROP"; CALL "ZZADDR"
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 BEGIN ; SETESC 9350
9950 RUN "ZMENU"
9999 END 
