0010 REM " Financial Statement Update <FR2UAA>
0035 REM "5.7 - 07/20/15 - 8.955 - tma - SSP# 278621
0037 REM "278621-FRAN - F/R Financial report does not exist in GUI           
0040 REM "Copyright 2015 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 IF %GUI=0 THEN BEGIN ! SSP#278621
0110 X0$="FR2UAA",X1$=" Financial Statement Update"
0120 DIM Z0$(80,"-"),S$(100),T[30],F[2],H[14],Y[4,13]
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,-1,X1,X2; IF X1>0 THEN GOTO 9920 ! SSP#278621
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0290 F9$="G/L"
0300 REM "IOLISTS
0310 IOLIST A$
0320 IOLIST B$,B[0],B[1]
0330 IOLIST C$,C[0],C[1]
0340 IOLIST D$,D[0],D[1]
0350 IOLIST E$,E[0],E[1]
0360 IOLIST F$,F[0],F[1],F[2]
0370 IOLIST G$,A0
0380 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13],H[14]
0381 IOLIST H$
0390 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14]
0400 IOLIST J$,J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8],J[9],J[10],J[11],J[12],J[13],J[14],J[15],J[16],J[17],J[18],J[19],J[20],J[21],J[22],J[23],J[24],J[25],J[26],J[27],J[28],J[29],J[30]
0405 IOLIST X$,J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8],J[9],J[10],J[11],J[12],J[13],J[14],J[15],J[16],J[17],J[18],J[19],J[20],J[21],J[22],J[23],J[24],J[25],J[26],J[27],J[28],J[29],J[30]
0410 IOLIST K$
0420 IOLIST L$,L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15],L[16],L[17],L[18],L[19],L[20],L[21],L[22],L[23],L[24],L[25],L[26],L[27],L[28],L[29],L[30]
0430 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0440 IOLIST M$,M[0],M[1],M[2],M[3],M[4],M[5],M[6],M[7],M[8],M[9],M[10],M[11],M[12],M[13],M[14],M[15],M[16],M[17],M[18],M[19],M[20],M[21],M[22],M[23],M[24],M[25],M[26],M[27],M[28],M[29],M[30]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Z$="12CU 01O FR6...  02O FR1...  03O FR2...  04O FR3...  05O FR4...  06O FR5...  07O FR7...  08O FRC...  09O GL3...  10L FRP...  11O GL1...  12O FRT...  "
0515 Z$=Z$+"13O ZZPARM  "
0520 GOSUB 8850; ON Z0 GOTO 0521,9900
0530 READ (Z[13],KEY="F/R"+FID(0),DOM=9900)G0$
0532 READ (Z[13],KEY=X3$(9,3)+"G/L")G2$
0535 READ (Z[13],KEY=X3$(9,3)+"G/LYE"+G0$(73,4),DOM=9900)G1$
0540 G0=NUM(G1$(13,2))
0585 CALL "ZZDROP"
0590 ADDR "ZZPACK",ERR=0591
0591 ADDR "ZZFLTR"
0595 ADDR "FR2UZA",ERR=0596
0596 ADDR "ZZ2MDZ"
0600 REM "
0620 GOSUB 8700
0695 CALL "ZZPROM","U6",X3$,0,U9$,"","",0
0730 DIM A$(250),A[1]
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[1]; U=4,U0=1,U[0]=0,U[1]=4,T0=0,U0$="    ",T5$="   "; GOTO 0850
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0875 REM "SET START POSTION FOR COMP NUMBER
0880 CMPST=277; REM "Starting Position in the Report File
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0912 V9$=V2$
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (Z[1],KEY=V4$,DOM=0991)
1000 REM "GET NEXT REPORT
1020 K0$=KEY(Z[1],END=5000)
1030 READ (Z[1])IOL=0310
1032 IF A$(277,3)<>"   " THEN MCOMP$="Y"; REM "ASSUMES FIRST COMPANY NOT BLANK
1035 Q$=A$(234,5); GOSUB 3400
1040 IF K0$<V2$(1,4) THEN GOTO 1000 ELSE IF K0$>V2$(5,4) THEN GOTO 5000
1090 PRINT @(13,5),"Report: ",K0$," - ",A$(5,30)
1100 REM "READ TEMPLATE HEADER
1120 GOSUB 2900
1130 GOSUB 3000
1150 REM "
1300 REM "
1390 READ (Z[6],KEY=E$(1,4),DOM=1391)
1400 REM "READ NEXT TEMPLATE LINE
1410 R0$="",R1$=""
1420 READ (Z[6],END=1900)IOL=0360
1422 IF F$(1,4)<>E$(1,4) THEN GOTO 1900
1423 IF F$(142,12)=S$(1,12) THEN F$(142,12)=A$(255,12)
1425 REM Q=POS("?"=F$(118,12)); IF Q>0 THEN LET Q0=Q,Q1=POS("?"<>F$(118+Q)),Q0=Q0-1,F$(118+Q0,Q1)=A$(255+Q0,Q1); IF F$(130,12)<>S$(1,12) THEN LET F$(130+Q0,Q1)=A$(255+Q0,Q1)
1430 PRINT @(6,7),"Template line: ",F$(5,4),"-",F$(9,12)," ",F$(22,40),'CE'
1435 IF POS(F$(21,1)="DS")>0 THEN ON Y9 GOTO 1500,2500
1450 IF F$(21,1)="T" THEN GOTO 4200
1460 IF F$(21,1)="H" THEN GOTO 4300
1490 GOTO 1400
1500 REM "DATA LINE
1501 IF F$(21,1)="S" THEN J$=""
1502 IF F$(63,1)="R" THEN GOTO 3500
1505 T0$=F$(154,6),T1$=F$(160,1); IF F$(21,1)="D" THEN M0$=FNS$(F$(142,12)),M1$="" ELSE M0$="",M1$=""
1510 R0$=F$(118,12),R9$=F$(130,12); IF F$(11,1)="S" THEN R1$=R9$; GOTO 1530 ELSE R1$=""; EXTRACT (Z[11],KEY=R0$,DOM=1511)
1512 IF R9$=S$(1,LEN(R9$)) THEN R9$=R1$
1515 REM "Get next applicable G/L account
1520 I$=KEY(Z[11],END=1700); IF I$(1,LEN(FNS$(R9$)))>R9$ THEN GOTO 1700 ELSE R0$=I$(1,LEN(R0$)),R1$=""; READ (Z[11])
1521 PRINT ".",
1524 IF F$(142,12)<>S$(1,12) THEN CALL "ZZFLTR",X3$,F$(142,12),"",R0$,Q,0; ON Q GOTO 1515,1525
1530 IF F$(21,1)<>"S" THEN GOSUB 4400 ELSE IF J$="" THEN GOSUB 4400
1540 P0=1; FOR X=1 TO LEN(C2$) STEP 11
1542 REM PRINT @(12,14),R0$," ",C2$(X,11),
1545 C5=POS(C2$(X,11)=C3$,11); IF C5>0 THEN C5=INT(C5/11); GOSUB 7100; GOTO 1580
1565 IF B$(1,11)<>C2$(X,11) THEN READ (Z[2],KEY=C2$(X,11))IOL=0320
1570 GOSUB 2400
1571 IF F$(21,1)="D" THEN J$(9,12)=I$
1575 P0=POS(C2$(X,11)=C6$),P0=INT(P0/11)+1
1578 J[P0]=J[P0]+R0; IF J[P0]<>0 THEN Q4=1
1580 REM 
1590 NEXT X
1600 REM "WRITE LINE
1603 IF F$(21,1)="S" THEN READ (Z[11],KEY=I$); GOTO 1520
1605 GOSUB 4000
1610 IF F$(21,1)="D" THEN J$(9,12)=I$(1,12); READ (Z[11],KEY=I$)
1620 REM IF F$(11,1)="D" AND E$(41,1)="0" THEN IF Q4<>1 THEN GOTO 01641
1630 DIM M$(128),M[30]; IF MCOMP$<>"Y" THEN GOTO 1640
1632 READ (Z[10],KEY=J$(1,21),DOM=1640)IOL=0440
1634 FOR I=0 TO 30; J[I]=J[I]+M[I]; NEXT I
1640 WRITE (Z[10],KEY=J$(1,21))IOL=0400
1660 IF R9$>"" THEN IF R1$<R9$ THEN GOTO 1520
1695 GOTO 1400
1700 REM "Write Summary line
1705 IF F$(21,1)<>"S" OR J$="" THEN GOTO 1800
1710 J$(9,12)=F$(9,12)
1720 GOSUB 4000
1730 DIM M$(128),M[30]; IF MCOMP$<>"Y" THEN GOTO 1740
1732 READ (Z[10],KEY=J$(11,21),DOM=1740)IOL=0440
1734 FOR I=0 TO 30; J[I]=J[I]+M[I]; NEXT I
1740 WRITE (Z[10],KEY=J$(1,21))IOL=0400
1790 GOTO 1400
1800 REM 
1850 GOTO 1400
1900 REM "END OF TEMPLATE DETAIL LINES
1920 GOSUB 4900
1930 IF A$(239,16)<>S$(1,16) THEN GOSUB 2000
1995 GOTO 1000
2000 REM "If this report consolidates, update those reports
2010 FOR X=0 TO 3
2015 Q$=A$(239+X*4,4); IF Q$<>S$(1,4) THEN Q$=Q$+A$(1,4); WRITE (Z[8],KEY=Q$)Q$
2080 NEXT X
2090 RETURN 
2300 REM "Update Columnar Control Masterfile
2310 IF C$>"" THEN IF Q$=C$(1,5) THEN GOTO 2390
2320 DIM C$(47),C[1]
2325 C$(1,5)=Q$
2340 FIND (Z[3],KEY=C$(1,5))IOL=0330
2360 GOSUB 2600
2390 RETURN 
2400 REM "GET DATA FROM G/L
2415 REM F$(63,1)="R" THEN GOTO 02700
2420 Q$=G0$(73,4)
2425 IF M1$>"" AND M0$="" THEN M0$="*"
2426 IF FNS$(R1$)="" THEN R1$=R0$
2440 CALL "FR2UZA",X3$,G0,B$,Q$,G0$(77,2),R0,R0$,R1$,M0$,M1$,X9$,Y{ALL},G2$
2442 IF F[1]<>0 THEN R0=R0*F[1]/100
2444 REM "Allocations
2445 IF V0$(72,1)<>"Y" THEN RETURN 
2447 REM "Can only allocate from PTD or YTD numbers
2448 IF POS(B$(4,8)="PTD     YTD     ",8)=0 THEN RETURN 
2450 REM "Get any allocation amount and add to data
2455 Z$="07C FR7... 07O FR9... "; GOSUB 8850; ON Z0 GOTO 2456,9900
2458 READ (Z[7],KEY=R0$(1,12),DOM=2459)
2460 READ (Z[7],END=2470)Q$,*,*,A8
2465 IF Q$(1,12)=R0$(1,12) THEN R0=R0+A8; GOTO 2460
2480 Z$="07C FR9... 07O FR7... "; GOSUB 8850; ON Z0 GOTO 2481,9900
2495 RETURN 
2500 REM "CONSOLIDATED REPORT DATA LINE
2505 Q$=A$(1,4)+F$(5,4)
2510 READ (Z[10],KEY=Q$,DOM=2511)
2520 READ (Z[10],END=2590)IOL=0400
2525 IF Q$<>J$(1,LEN(Q$)) THEN GOTO 2590
2530 GOSUB 4000
2580 GOTO 2520
2595 GOTO 1400
2600 REM "New column control code
2605 REM GOSUB 04400; LET J$(22)=C$
2610 REM WRITE (Z(10),KEY=J$(1,21)) IOL=00400
2620 DIM D$(72),D[1],C6$(11*30)
2622 REM "The statements in this range are created using the EXECUTE command
2623 REM "like percentages, etc.  When the column heading change, so do the
2624 REM "potential calculations.
2625 DELETE 7101,7189
2630 C0$="",C1$="",C2$="",C3$="",C4$="",C5$="",C5=0,C1=0
2640 READ (Z[4],KEY=C$(1,5),DOM=2641)
2650 READ (Z[4],END=2800)IOL=0340
2655 IF D$(1,5)<>C$(1,5) THEN GOTO 2800
2670 C0$=C0$+" "+D$(9,8)
2690 GOTO 2650
2700 REM "GET VALUE FOR SPECIFIC TOTAL ELEMENT
2701 REM "Logiv not being used at this time
2702 ESCAPE 
2705 Q$=FNS$(F$(64,50)),T0$=Q$(1,POS("."=Q$+".")-1),Q$=Q$(1+POS("."=Q$)),T0$=T0$+S$(1,6-LEN(T0$))+F$(114,4),Q$=" "+Q$+S$(1,8-LEN(Q$))
2710 FIND (Z[12],KEY=T0$,DOM=2790)IOL=0420
2715 L0=ASC(F$(10,1))-64,L1=POS(Q$=L$(11),9),R0=0; IF L1>0 THEN L1=INT(L1/9),R0=L[L1+1]
2720 J[L0+1]=R0,K$=KEY(Z[6],END=2740); IF K$(1,8)=F$(1,8) THEN READ (Z[6])IOL=0360; GOTO 2705
2740 Q$=F$(5,4)+"D ",Q$=Q$+S$(1,21-LEN(Q$))
2745 J$(5,LEN(Q$))=Q$
2760 GOTO 1600
2790 RETURN 
2800 REM "DETRERMINE DATA TYPES
2805 DIM B[2]
2808 IF C0$="" THEN GOTO 2890
2810 FOR X9=1 TO LEN(C0$) STEP 9
2815 READ (Z[2],KEY=F9$+C0$(X9+1,8))IOL=0320
2820 FOR Y=0 TO 5; Q$=B$(43+Y,1); IF Q$<>" " THEN IF POS(Q$=C4$)=0 THEN C4$=C4$+Q$
2825 NEXT Y
2828 C6$(11*INT(X9/9)+1,11)=B$(1,11)
2830 IF POS(B$(42,1)="FP")>0 THEN GOSUB 8000 ELSE C2$=C2$+B$(1,11)
2840 NEXT X9
2860 REM "CONTROL FOR COL CALCS
2865 IF C5=0 THEN GOTO 2890 ELSE Q0$="7105 R0=0; SETERR 7195; ON C5+1 GOTO 7110,"; FOR X=1 TO C5; Q0$=Q0$+STR(7105+X*5)+","; NEXT X; Q0$=Q0$+"7195"
2870 EXECUTE Q0$
2890 RETURN 
2900 REM "Get report template master
2910 DIM E$(60),E[1]
2940 READ (Z[5],KEY=A$(230,4))IOL=0350
2990 RETURN 
3000 REM "Get consolidation reports
3001 REM "FRC contains file of consolidate into reports (To report + From report)
3005 Y9$="",Y9=0
3030 READ (Z[8],KEY=A$(1,4),DOM=3031)IOL=0381
3040 READ (Z[8],END=3090)IOL=0381
3045 IF H$(1,4)<>A$(1,4) THEN GOTO 3090
3050 Y9$=Y9$+H$(5,4)
3055 GOTO 3040
3095 IF Y9$="" THEN GOTO 3300 ELSE Y9=LEN(Y9$)
3100 REM "ACCUMULATE CONSOLIDATIONS
3105 M0$=A$(239,16),M1$=""; GOSUB 3900
3110 Z$="08C FRC...  08OSFRP... "; GOSUB 8850
3115 Q0=0,Q1=0; Q=POS("*"=A$(255,12)); IF Q>0 THEN Q0=Q,Q1=POS("*"<>A$(255+Q)),Q0=Q0-1,C9$=A$(255,Q1)
3120 FOR Y=1 TO LEN(Y9$) STEP 4
3125 Q$=Y9$(Y,4)
3150 READ (Z[10],KEY=Q$,DOM=3151)
3160 READ (Z[10],END=3200)IOL=0400
3165 IF J$(1,LEN(Q$))<>Q$ THEN GOTO 3200 ELSE REM IF POS(PJ$(21,1)<>"D" THEN GOTO 03160
3168 IF POS(J$(21,1)="SD")>0 THEN GOSUB 4000
3175 DIM L[30]; L$=J$,L$(1,LEN(Q$))=A$(1,4)
3178 IF Q1>0 THEN L$(9+Q0,Q1)=C9$
3180 FIND (Z[8],KEY=L$(1,21),DOM=3181)IOL=0420
3185 FOR X=0 TO 30; L[X]=L[X]+J[X],J[X]=L[X]; NEXT X
3194 GOSUB 7100
3195 J$=L$
3196 WRITE (Z[8],KEY=L$(1,21))IOL=0400
3198 GOTO 3160
3200 REM 
3240 NEXT Y
3260 Z$="08CUFRP...  08O FRC... "; GOSUB 8850
3300 REM "
3390 RETURN 
3400 REM "COLUMN CONTROL
3410 IF A$(234,5)<>"     " THEN Q$=A$(234,5)
3420 GOSUB 2300
3490 RETURN 
3500 REM "Get data from financial report line
3502 GOSUB 4400
3505 DIM L[30]; Q$=F$(114,4)+FNS$(F$(118,4))
3510 READ (Z[10],KEY=Q$,DOM=3511)IOL=0420
3520 READ (Z[10],END=3521)IOL=0420; IF L$(1,LEN(Q$))<>Q$ THEN GOTO 3550
3530 FOR X=0 TO 30; J[X]=J[X]+L[X]; NEXT X
3540 GOTO 3520
3590 GOTO 1600
3600 REM "Allocation
3602 IF V0$(72,1)<>"Y" THEN RETURN 
3605 A0=0
3610 DIM G[2]; G$=A$(1,4)+F$(5,16); EXTRACT (Z[7],KEY=G$,DOM=3790)IOL=0370
3620 Z$="07C FR7... 07O FR8... 08C FRC... 08O FR9...  "; GOSUB 8850; ON Z0 GOTO 3621,9900
3625 Q$=G$(59,6)+A$(1,4)
3630 READ (Z[12],KEY=Q$)IOL=0405
3635 Q=POS(" "+G$(51,8)=X$(11),9); IF Q<>0 THEN Q=INT(Q/9)+1,A9=J[Q] ELSE CALL "ZZPROM",".4",X3$,0,"You are allocating "+G$(51,8)+" which is not printed.","","",0; GOTO 3700
3650 REM "Distribute amount  (Decided 9/28/94 to detail post)
3655 IF A0<=0 THEN GOTO 3700 ELSE READ (Z[7],IND=A0)A0,A0$,*,*,*,A1
3660 REM LET Q=0; READ (Z(8),KEY=A0$(7,12),DOM=03661) *,Q
3662 DIM Q$(85); Q$(1)=A0$(7,12)+"000",J0=0,Q=A9*A1/100
3663 Q$(16,30)="Report: "+F$(1,4)+" "+F$(5,16),Q$(46,30)=G$(21,30),Q$(76,6)=V0$(73,6)
3668 Q$(13,3)=STR(J0:"000"),J0=J0+1
3670 WRITE (Z[8],KEY=Q$(1,15),DOM=3668)Q$,A9,A1,Q
3680 GOTO 3655
3700 REM 
3710 Z$="07C FR8... 07O FR7... 08C FR9... 08O FRC... "; GOSUB 8850
3795 RETURN 
3900 REM 
3905 Q8$=""
3910 FOR X=1 TO LEN(M0$); IF M0$(X,1)="?" THEN Q8$=Q8$+",J$("+STR(9+X)+",1)="+$22$+"?"+$22$
3920 NEXT X; IF Q8$="" THEN Q8$="3170REM" ELSE Q8$="3170"+Q8$(2)
3930 EXECUTE Q8$
3935 Q8$=""
3940 RETURN 
4000 REM "Accumulate to totals
4010 FOR X=0 TO 4
4015 T0$=F$(154+X*7,6),T1$=F$(160+X*7,1)
4020 IF POS(" "<>T0$)>0 AND T1$<>" " THEN GOSUB 4100
4040 NEXT X
4090 RETURN 
4100 REM "Flush total
4105 S0=1; IF T1$="-" THEN S0=-1
4108 DIM L[30]
4110 REM IF L$>"" THEN IF L$(1,6)=T0$ THEN GOTO 04160
4120 DIM L[30],L$(10)
4130 L$=T0$+A$(1,4)+C0$
4134 REM "If report code
4135 IF F$(114,4)<>"    " THEN FIND (Z[12],KEY=T0$+F$(114,4),DOM=4136)IOL=0405
4140 FIND (Z[12],KEY=L$(1,10),DOM=4141)IOL=0420
4160 FOR Q=0 TO 30; IF J[Q]=0 THEN GOTO 4170 ELSE T9$=FNS$(C6$((Q-1)*11+4,8)); IF T9$>"" THEN T9$=FNS$(T0$)+"."+T9$,T9=POS(T9$=C5$,16); IF T9>0 THEN T9=1+INT(T9/16)
4165 L[Q]=L[Q]+J[Q]*S0; IF T9>0 THEN T[T9]=L[Q],T9=0
4170 NEXT Q
4175 C5=-1; GOSUB 7100
4180 WRITE (Z[12],KEY=L$(1,10))IOL=0420
4190 RETURN 
4200 REM "Total line
4210 GOSUB 4400
4215 IF F$(63,1)="R" THEN GOSUB 8600; GOTO 4245
4220 L$="",T0$=F$(154,6),T1$="+"; GOSUB 4100
4240 FOR X=0 TO 30; J[X]=L[X]; NEXT X
4245 C5=-1; GOSUB 7100
4247 IF F[1]<>0 THEN FOR X=0 TO 30; L[X]=L[X]*F[1]/100; NEXT X; FOR X=0 TO 30; J[X]=L[X]; NEXT X ELSE GOTO 4249
4250 WRITE (Z[10],KEY=J$(1,21))IOL=0400
4260 GOSUB 4000
4265 IF F$(21,1)="T" THEN GOSUB 3600
4290 GOTO 1400
4300 REM "HEADER LINE
4310 GOSUB 4400
4330 WRITE (Z[10],KEY=J$(1,21),DOM=4331)IOL=0400
4390 GOTO 1400
4400 REM "Setup F/S print file data
4420 DIM J$(128),J[30]; Q4=0
4425 J$(1,20)=A$(1,4)+F$(5,4)+F$(9,12),J$(31+F[0],50)=F$(22,40)
4430 J$(21,1)=F$(21,1)
4440 IF F$(21,1)="D" THEN FIND (Z[11],KEY=R0$,DOM=4441)Q$; IF F$(62,1)<>"Y" THEN J$(31+F[0],50)=Q$(13,35)
4445 IF POS("G"=A$(267,10))>0 THEN IF F$(21,1)="D" THEN CALL "ZZDISP","AX",R0$,"G/L",X3$,X$,"",0,0,X4$; IF F$(21,1)<>"S" THEN J$(31+F[0],50)=X$+" "+Q$(13,35)
4450 REM ************* IF F$(21,1)<>"D" OR F$(62,1)="1" THEN LET J$(31,50)=F$(12,50)
4490 RETURN 
4690 RETURN 
4900 REM "END OUT OLD REPORT
4910 GOSUB 7700
4915 IF MCOMP$<>"Y" THEN GOTO 4990
4920 COMP$=A$(CMPST,3); IF COMP$="   " THEN MCOMP$=" "; GOTO 4950
4925 Z$="05C  05O FR4"+COMP$+" 06C  06O FR5"+COMP$+" 09C  09O GL3"+COMP$+" 11C  11O GL1"+COMP$
4930 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
4935 CMPST=CMPST+3
4940 GOTO 1100
4945 REM "Reopen Original Files
4950 Z$="05C  05O FR4"+X3$(9,3)+" 06C  06O FR5"+X3$(9,3)+" 09C  09O GL3"+X3$(9,3)+" 11C  11O GL1"+X3$(9,3)
4955 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
4990 RETURN 
5000 REM "END OF UPDATE
5020 GOSUB 4900
5100 REM "
5200 REM "
5250 RUN "FR2RAA"
5400 REM 
5450 GOTO 9900
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6020 CALL "ZZPROM","U9",X3$,0,"","","",4
6025 CALL "ZZPROM","U8",X3$,0,"+ "+V0$(22,4)+"."+V0$(26,2),"","",7
6030 PRINT V0$(22,4),".",V0$(26,2),
6165 PRINT (0,ERR=6066)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6225 GOSUB 6450
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6410 GOSUB 6000
6430 IF C9>0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6490 RETURN 
7000 REM "CREATE COLUMN CALCULATION FUNCTION FROM D$
7005 E0$="J("+STR(INT(X9/9)+1)+")"
7010 Q0$=STR(C5*5+7110)+"SETERR "+STR(C5*5+7111)+"; "+E0$+"=0,"+E0$+"=",Q9$="*"+STR(C5),C5=C5+1
7015 FOR X=1 TO LEN(Q8$); IF Q8$(X,1)="{" THEN Q0$=Q0$+"J(" ELSE IF Q8$(X,1)="}" THEN Q0$=Q0$+")" ELSE Q0$=Q0$+Q8$(X,1)
7020 NEXT X
7030 EXECUTE Q0$
7040 EXECUTE STR(C5*5+7106)+"IF C5>=0 SETERR 9000; RETURN"
7095 RETURN 
7100 REM "Calculations: Program code changes varying on Column Setings
7295 C5=-1; SETERR 9000; RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0430
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"   ")-1)
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 RETURN 
7700 REM "At this point, % values must be calculated, since we would not
7701 REM "have known the total during the update.
7710 REM "GOSUB 7800
7720 READ (Z[10],KEY=A$(1,4),DOM=7721)
7730 K$=KEY(Z[10],END=7770); READ (Z[10],END=7770)IOL=0400
7735 IF J$(1,4)<>A$(1,4) THEN GOTO 7770
7740 IF POS(J$(21,1)="DT")=0 THEN GOTO 7730
7750 C5=-1; GOSUB 7100
7760 WRITE (Z[10],KEY=K$)IOL=0400
7765 GOTO 7730
7790 RETURN 
7800 REM "GET TOTAL VALUES
7805 T9=0
7810 FOR X=1 TO LEN(C5$) STEP 16; T9=T9+1
7815 Q$=C5$(X,16),Q=POS("."=C5$)-1; T0$=Q$(1,Q)+S$(1,6-Q)
7816 ESCAPE 
7880 NEXT X
7890 RETURN 
8000 REM "CALCULATED DATA TYPE
8005 F8$=" +-/*()}.0123456789",F8=POS("0"=F8$)-1,C3$=C3$+B$(1,11),Q$=FNS$(B$(64,65)),Q8$=""
8010 Q0=0,Q0$="",Q1$=""
8015 IF Q$="" THEN GOTO 8045 ELSE X$=Q$(1,1),Q$=Q$(2); IF X$="{" THEN GOTO 8300
8018 IF Q0=1 THEN IF POS(X$=F8$(1,F8))>0 THEN Q1$=Q0$; GOSUB 8100 ELSE Q0$=Q0$+X$
8020 IF Q0=0 THEN IF POS(X$=F8$)=0 THEN Q0=1,Q0$=Q0$+X$ ELSE Q8$=Q8$+X$
8025 IF X$="{" THEN GOSUB 8300
8040 GOTO 8015
8050 IF Q0=1 THEN Q1$=Q0$; GOSUB 8100
8060 REM "SET THIS COLUMN
8080 C2$=C2$+C3$(LEN(C3$)-10,11)
8085 GOSUB 7000
8090 RETURN 
8100 REM "GOT DATA NAME
8110 Q1$=F9$+Q1$+S$(1,8-LEN(Q0$))
8115 P=POS(Q1$=C6$,11); IF P>0 THEN P=1+INT(P/11); GOTO 8180
8120 REM "DATA ELEMENT NOT IN C6$
8130 GOSUB 8200; GOTO 8115
8180 Q8$=Q8$+"{"+STR(P)+"}"
8190 Q0$="",Q0=0,Q1$=""
8195 RETURN 
8200 REM "ADD DATA ELEMENT TO C6$
8210 Q=LEN(C6$)-10
8215 IF C6$(Q,1)<>" " THEN Q=Q-11; GOTO 8215
8220 FIND (Z[2],KEY=Q1$)IOL=0320
8230 IF B$(42,1)<>"F" THEN C6$(Q,11)=Q1$,C2$=C2$+Q1$; GOTO 8290
8240 REM "FORMULA!
8250 Q$=X$+Q$,X$="("+FNS$(B$(64,65))+")",Q$=X$+Q$
8260 EXITTO 8261
8261 EXITTO 8010
8295 RETURN 
8300 REM "TOTAL INVOLVED IN CALCULATION
8305 Q=POS("}"=Q$); Q1$=Q$(1,Q-1),Q$=Q$(Q+1)
8310 Q1$=Q1$+S$(1,16-LEN(Q1$)),Q=POS(Q1$=C5$,16)
8315 IF Q=0 THEN C5$=C5$+Q1$; GOTO 8310 ELSE Q=INT(Q/16)+1,Q8$=Q8$+"T("+STR(Q)+")"
8390 GOTO 8010
8600 REM "Get total data from another report
8620 D0=LEN(C0$)/9
8630 Q$=F$(118,6)+F$(114,4)
8635 READ (Z[12],KEY=Q$,DOM=8636)IOL=0420; GOTO 8640
8637 Q$="Report: "+FNS$(F$(1,4))+" section "+F$(5,4)+" pulls report total name which is non-existent. ("+FNS$(F$(118,6))+")"
8638 CALL "ZZPROM",".5",X3$,Q,Q$,"","",0; ON Q GOTO 8690,9900
8640 FOR X=1 TO D0
8645 Q$=C0$((X-1)*9+1,9)
8650 Q=POS(Q$=L$(11),9)
8655 IF Q=0 THEN GOTO 8680 ELSE Q=INT(Q/9)+1
8660 J[X]=L[Q]
8680 NEXT X
8690 RETURN 
8695 GOTO 1640
8700 REM "Ask if re-update data
8702 READ (Z[10],KEY="",DOM=8715)S0$,*,*,*,S4$
8704 IF V0$(73,6)<>S4$ OR V0$(72,1)="Y" THEN GOTO 8715
8705 CALL "ZZDISP","DX",S0$(1,6),"",X3$,Q2$,"",0,0,X4$
8706 Q$=""; IF LEN(S0$)=10 THEN Q$="Last resort: "+Q2$+"  "+FNT$(S0$(7,4))
8710 CALL "ZZPROM","Y",X3$,S3,"Do you wish to recalc the data? "+Q$,"","",0; IF S3=1 THEN GOTO 5200
8715 Q$=STR(Z[10]:"00")+STR(Z[12]:"00"); CALL "ZZINIT",Q$
8720 WRITE (Z[10],KEY="")X3$(21,6)+STR(TIM*100:"0000"),D0$,D1$,R0$,V0$(73,6)
8730 Z$="10C FRP... 10O FR9... "; GOSUB 8850; Q$=STR(Z[10]:"00"); CALL "ZZINIT",Q$
8735 Z$="10C FR9... 10O FRP... "; GOSUB 8850
8745 RETURN 
8800 REM "CLEAR FILES
8810 Q$=STR(Z[10]:"00")+STR(Z[12]:"00")
8820 CALL "ZZINIT",Q$
8840 RETURN 
8850 REM "OPEN FILES
8860 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
8890 RETURN 
8910 DEF FNS$(Z9$)=Z9$(1,POS(S$=Z9$+S$)-1)
8930 DEF FND$(Z9$)=Z9$(3,2)+"/"+Z9$(5,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8935 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,1
9045 REM 
9050 ON Y7 GOTO 9060,9100,9190,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOSUB 6600; GOTO 9900
9260 EXITTO 8190
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9900 REM "END PROGRAM
9905 CALL "ZZDROP"; CALL "ZZADDR"
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 IF %GUI=0 THEN BEGIN ; SETESC 9350 ! SSP#278621
9950 RUN "ZMENU"
9999 END 
44450 REM IF POS("G"=A$(267,10))>0  CALL "ZZDISP","AX",Q$(1,12),"G/L",X3$,X$,"",0,0,X4$;IF F$(21,1)<>"S" J$(31+F(0),50)=X$+" "+Q$(13,35)
