0010 REM "Remote Location AR Invoice Update <CM2UBB>
0020 SETESC 9300; SETERR 9000
0035 REM "3.8 - 07/08/94 - 10.82
0040 REM "Copyright 1994 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 BEGIN 
0100 SETERR 9000
0110 X0$="CM2UBB",X1$="RL Invoice Update"
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0300 REM "IOLISTS
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20]
0320 IOLIST K0,B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20]
0331 IOLIST C$,C[0],STR(C[1]),STR(C[2]),C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20]
0390 IOLIST J$,J[0],J[1]
0400 IOLIST P$,P[0],P[1]
0405 IOLIST K$,K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],K[8],K[9],K[10]
0410 IOLIST S$,S[0],S[1],S[2],S[3],S[4],S[5]
0420 IOLIST S0$
0500 REM "FILES
0505 Z=NUM(X3$(60,3)); DIM Z[Z]
0510 Z$="01L CM3...  05O AR9...  06O ARA...  07O ARB...  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 0521,9900
0550 REM "Read in stat info"
0555 READ (Z[13],KEY="STATARX")S4$
0560 READ (Z[13],KEY="STATI/C")S5$
0565 READ (Z[13],KEY="STATARW")S6$
0575 READ (Z[13],KEY="STATA/R")S7$
0580 READ (Z[13],KEY="STATAR3")S8$
0600 REM "Read parameters
0610 DIM P[8],P0$(90),P1$(32)
0620 FIND (Z[13],KEY=X3$(9,3)+"A/R",DOM=9800)P0$,P[0],P[1],P[2],P[3],P[4],P[5],P[6],P[7],P[8]
0630 FIND (Z[13],KEY=X3$(9,3)+"AR1",DOM=9800)P1$
0640 FIND (Z[13],KEY=X3$(9,3)+"I/C")P2$
0695 CALL "ZZPROM","U6",X3$,0,U9$,"","",0
0730 DIM A$(162),A[20]
0740 DIM B$(54),B[10]
0915 GOSUB 6000
0990 READ (Z[1],KEY="",DOM=0991)
1000 REM "READ NEXT RECORD
1020 K0$=KEY(Z[1],END=5000)
1030 READ (Z[1],KEY=K0$)IOL=0310
1090 PRINT @(7,12),U9$," ",K0$,
1100 REM "
1105 IF POS(" "<>A$(92,8))<>0 THEN O0=O0+1
1110 F9$=""; IF A$(343,1)<>"R" THEN GOTO 1200
1120 FOR X=1 TO 11; IF A[X]<>0 THEN EXITTO 1200
1125 NEXT X
1130 F9$="*"
1200 GOSUB 3200
1800 REM "WRITE OUT TO ARB & THEN REMOVE FROM CM3
1805 REM LET A$(64,1)="P"; REM "Mark invoice as printed
1810 REM WRITE (Z(7),KEY=K0$) IOL=00310
1820 REMOVE (Z[1],KEY=K0$)
1950 GOTO 1000
2000 REM "UPDATE A LINE 
2020 IF B$(1,1)="M" THEN RETURN 
2030 F9$=""; IF B$(1,1)="C" AND B$(89,1)="9" AND B[4]=0 AND B[5]=0 THEN F9$="*"
2040 IF POS(B$(1,1)="IC")=0 THEN GOTO 2180
2060 IF POS(B$(89,4)="    DS  ",4)>0 THEN GOTO 2180
2100 REM "
2110 GOSUB 2900
2120 GOSUB 2800
2130 GOSUB 4000
2180 GOSUB 3000
2195 RETURN 
2800 REM "LOCATION DATA
2810 DIM C$(58),C[20]
2812 Q$=B$(89,4)
2815 C$(1,20)=B$(55,20),C$(21,4)=Q$
2820 EXTRACT (Z[3],KEY=C$(1,24),DOM=2821)IOL=0330
2830 C[5]=C[5]+B[1]
2860 WRITE (Z[3],KEY=C$(1,24))IOL=0331
2870 EXTRACT RECORD (Z[12],KEY=C$(1,20),DOM=2890)I$
2875 IF A$(86,6)>I$(96,6) THEN I$(96,6)=A$(86,6)
2880 WRITE RECORD (Z[12],KEY=C$(1,20))I$
2890 RETURN 
2900 REM "Statistics data
2905 F0=Z[4],S9$=S5$; Q$=B$(89,4)
2910 Q1$=B$(55,20)+Q$+A$(1,4),Q1=NUM(A$(5,2))
2920 Q0$="S",Q0=B[4]; GOSUB 7000
2925 Q1$=B$(55,20)+Q$+A$(1,4),Q1=NUM(A$(5,2))
2930 Q0$="U",Q0=B[1]
2940 GOSUB 7000
2945 Q1$=B$(55,20)+Q$+A$(1,4),Q1=NUM(A$(5,2))
2950 Q0$="P",Q0=B[4]-B[5]
2955 GOSUB 7000
2995 RETURN 
3000 REM "Product by div, salesperson, category
3005 T0=POS("    "=A$(133,20)+"    "); IF T0=1 THEN T0=0 ELSE T0=INT(T0/5)
3010 F0=Z[8],S9$=S4$
3015 IF T0>NUM(P1$(8,1)) THEN T0=NUM(P1$(8,1))
3020 DIM H$(9),H[14],T[30]
3025 DIM S[5]; FOR I0=1 TO 5; S[I0]=A[I0+11]; NEXT I0
3028 IF P1$(62,1)="Y" THEN B[5]=B[5]-B[9]
3030 CALL "AR2XAA",X3$,B{ALL},1,5,T{ALL},S{ALL},1,5
3032 IF P1$(62,1)="Y" THEN B[5]=B[5]+B[9]
3035 FOR I=9 TO POS(" "=P1$(9,10)+" ")+7
3040 FOR J=0 TO T0
3045 J0=J*5,Q1$=A$(15,2)+A$(133+J*4,4)+A$(153,9)+B$(3,3)+B$(111,1)+" "+A$(1,4),Q1=NUM(A$(5,2)),Q0$=P1$(I,1)
3046 Q1$(7,9)=""; REM "ELIMINTATE CUST CAT 7/10/89
3050 ON POS(Q0$="SPCN") GOTO 3091,3055,3060,3065,3070
3055 Q0=T[J0+3]; GOTO 3090
3060 Q0=T[J0+3]-T[J0+4]; GOTO 3090
3065 GOTO 3100
3070 Q0=1; GOTO 3090
3090 IF F9$<>"*" THEN GOSUB 7000
3100 NEXT J
3110 NEXT I
3185 DIM T[0]
3190 RETURN 
3200 REM "Update Customer Statistics
3201 REM "Update stats to invoice customer not bill-to customer
3205 S9$=S7$,F0=Z[5]
3210 FOR I=21 TO POS(" "=P0$(21,10)+" ")+19
3220 Q1$=A$(15,10)+A$(1,4),Q1=NUM(A$(5,2))
3240 Q0$=P0$(I,1)
3250 ON POS(Q0$="SPN") GOTO 3301,3260,3265,3280
3260 Q0=A[1]; GOTO 3300
3265 Q0=A[1]-A[11]; GOTO 3300
3280 Q0=1; GOTO 3300
3300 IF F9$<>"*" THEN GOSUB 7000
3480 NEXT I
3500 REM "Update Salesperson Statistics
3505 T0=POS("    "=A$(133,20)+"    "); IF T0=1 THEN T0=0 ELSE T0=INT(T0/5)
3507 F0=Z[6],S9$=S8$
3508 IF T0>NUM(P1$(8,1)) THEN T0=NUM(P1$(8,1))
3510 DIM H$(9),H[14],T[100]
3515 DIM S[5]; FOR I0=1 TO 5; S[I0]=A[I0+11]; NEXT I0
3519 IF P1$(62,1)="Y" THEN A[11]=A[11]-A[19]
3520 CALL "AR2XAA",X3$,A{ALL},1,20,T{ALL},S{ALL},1,5
3521 IF P1$(62,1)="Y" THEN A[11]=A[11]+A[19]
3525 FOR I=9 TO POS(" "=P1$(9,10)+" ")+7
3550 FOR J=0 TO T0
3600 J0=J*20,Q1$=A$(133+J*4,4)+A$(1,4),Q1=NUM(A$(5,2)),Q0$=P1$(I,1)
3610 ON POS(Q0$="SPCN") GOTO 3701,3630,3640,3650,3680
3630 Q0=T[J0]; GOTO 3700
3640 Q0=T[J0]-T[J0+10]; GOTO 3700
3650 Q0=T[J0+17]; GOTO 3700
3680 Q0=1; GOTO 3700
3700 IF F9$<>"*" THEN GOSUB 7000
3775 NEXT J
3780 NEXT I
3785 DIM T[0]
3810 RETURN 
3900 REM "EXTERNAL CHARGES
3905 READ (Z[10],KEY=A$(92,8)+B$(65,10)+B$(47,3),DOM=3906)IOL=0405; GOTO 3911
3910 READ (Z[10],KEY=A$(92,8)+B$(65,10)+"   ",DOM=3980)IOL=0405
3915 K[3]=K[3]+B[5],K[4]=K[4]+B[4]
3920 K$(117,8)=A$(7,8),K$(111,6)=A$(86,6)
3940 WRITE (Z[10],KEY=K$(1,21))IOL=0405
3995 RETURN 
4000 REM "Update I/C detail transactions
4005 DIM J$(73),J[2]
4007 J1$="Inv#: "+A$(7,7); IF A$(14,1)<>" " THEN J1$=J1$+"-"+A$(14,1)
4010 J$(1,20)=B$(55,20),J$(21,4)=B$(89,4),J$(25,4)=A$(1,4),J$(29,2)=A$(5,2),J$(31,6)=A$(86,6),J$(39,1)="S",J$(40,10)=A$(15,10),J$(50,15)=J1$,J$(65,2)="SJ",J$(67,6)=V0$(22,6),J[0]=-B[1],J[1]=-B[5]
4011 IF B$(89,1)="9" THEN J$(39,1)="I"
4025 WRITE (Z[9],KEY=J$(1,38),DOM=4026)IOL=0390; GOTO 4040
4030 K=FND(J$(37,2)),J$(37,2)=FNC$(K+1); GOTO 4025
4040 RETURN 
5000 REM "END OF UPDATE
5090 GOTO 9900
5100 REM "
5400 REM 
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6165 PRINT (0,ERR=6066)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6225 GOSUB 6450
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6410 GOSUB 6000
6430 IF C9>0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6490 RETURN 
6600 REM "RESTART LOGIG
6610 REM WRITE (Z(1),IND=I1) V0$,K0$,K1$,K0,K1
6690 RETURN 
6700 REM "Increment Audit Control No.
6705 F9=Z[13]
6710 A2$=X3$(146,6)+"  000100",A0$=X3$(9,3)+"AUDIT",A1$=""; EXTRACT (F9,KEY=A0$,DOM=6716)A0$,A1$
6715 A0=POS(A2$(1,6)=A1$,14); IF A0=0 THEN A1$=A1$+A2$; GOTO 6715 ELSE A2=NUM(A1$(A0+8,4))+1,A2$(9,4)=STR(A2:"0000"),A1$(A0,14)=A2$
6720 WRITE (F9,KEY=A0$)A0$,A1$
6740 RETURN 
7000 REM "Update stats q0$ in period q1 with data q0
7005 IF Q0=0 THEN GOTO 7090
7010 DIM K[14]; P9$=Q1$+Q0$
7020 GOSUB 7100
7040 K[Q1]=K[Q1]+Q0
7060 GOSUB 7150
7090 RETURN 
7100 REM "Read stats (Packed/Unpacked)
7105 Q=POS(Q0$=S9$(49),17); IF Q=0 THEN EXITTO 7090 ELSE M0$=S9$(Q+48,17)
7110 CALL "ZZPACK",X3$,"E",M0$(3,2),"",0,0,K{ALL},F0,Q0$,Q1$,S9$
7135 GOTO 7190
7150 REM "Write stats
7160 CALL "ZZPACK",X3$,"W",M0$(3,2),"",0,0,K{ALL},F0,Q0$,Q1$,S9$
7190 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
8930 DEF FNC$(C)=CHR(32+INT((C+32)/95))+CHR(32+MOD(C,95))
8935 DEF FND(Z9$)=(ASC(Z9$(1,1))-32)*95+ASC(Z9$(2,1))-32
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,1
9045 REM 
9050 ON Y7 GOTO 9060,9100,9190,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOSUB 6600; GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 BEGIN ; SETESC 9350
9945 CALL "ZZDAPP",X3$,"IPL"
9950 RUN "ZMENU"
9999 END 
