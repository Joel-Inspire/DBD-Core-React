0010 REM "UTILITY TO WRITE MISSING AUDIT RECORDS (TEMPORARY) <CM2UXA>
0035 REM "3.8 - 03/22/95 - 17.39 - JTB
0040 REM "Copyright 1994 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 BEGIN ; SETERR 9000
0110 X0$="CM2UXA",X1$="Write missing audit records"
0145 DIM R6$(78)
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0260 IF X3$(330,1)="1" THEN CALL "ZZPROM",".4",X3$,0,"Must be run by Master Location company","","",0; GOTO 9900
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="13O ZZPARM"; F0$="CMZ"
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; IF Z0=1 THEN GOTO 9900
0600 REM 
0640 GOSUB 6000; CALL "ZZPROM",".Y",X3$,S3,"Proceed?","","",0; ON S3 GOTO 0641,9900
0650 GOTO 7400
6000 REM 
6020 PRINT @(0,3),'CE',"This program will process data from the remote location and write the Audit Records for each file.  This process is temporary until all R/L's have been upgraded!"
6025 Q$=X3$(21,6); CALL "ZZ2FYP",X3$,Q$,P0$
6030 PRINT @(0,6),Z0$,@(12,7),"Will be updated with a Fiscal year/ Period of: ",P0$(1,4),"/",P0$(5,2),
6090 RETURN 
7400 REM "ASK FOR COMPANY NUMBER TO CORRECT
7410 GOSUB 8800
7440 PRINT @(0,3),'CF',@(12,8),"Processing for ",C9$(4,3)
7487 DIM J4$(100); FIND (Z[13],KEY="R/L"+C9$(4,3),DOM=7488)J4$
7490 IF J4$(10,1)="2" THEN J9$=F9$; GOSUB 7500; F9$=J9$
7495 GOTO 7400
7500 REM "Accumulate files into the inbox
7510 F9$="CM1"+C9$(4,3),F9=Z[1]; GOSUB 7550
7545 RETURN 
7550 REM "Given TopForm name of YYY### format, get list of files from inbox intoF2$, and for each copy to TMP+FID(0) then load records into YYY### and then erase temp file and corresponding inbox file.
7551 REM "TopForm name is in F9$ and file isopen on F9
7554 J9=0
7555 CALL "CM2TRN",X3$,3,F9$+"*","",F2$,""
7556 IF J9=0 AND F2$="" THEN J9=1; GOTO 7555
7560 P=POS("|"=F2$); IF P=0 THEN GOTO 7595
7565 F1$="TMP"+FID(0),F$=F2$(1,P-1); IF P=LEN(F2$) THEN F2$="" ELSE F2$=F2$(P+1)
7567 IF F$(1,3)="CMZ" THEN GOTO 7590
7569 ERASE F1$,ERR=7570
7570 CALL "CM2TRN",X3$,1,F1$,F$,"",""
7572 CLOSE (14,ERR=7573)
7573 OPEN (14,ERR=7575)F1$; CLOSE (14)
7575 Z$="10O "+F1$+" "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; IF Z1<>0 THEN GOTO 7590
7577 IF F$(1,3)="CM1" THEN GOSUB 7700; IF O$="N" THEN GOTO 7590; REM "VERIFY AUDIT RECORDS
7585 Z$="10CU"+F1$+" "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
7587 CALL "CM2TRN",X3$,5,F1$,F$,"",""; REM MOVE FILE BACK TO INBOX
7588 ERASE F1$; WAIT 1
7590 GOTO 7560
7595 RETURN 
7700 REM "WRITE AUDIT RECORDS
7705 READ (Z[10],KEY="",DOM=7710)
7720 CALL "CM2ATA",X3$,X4$,Z[10],0,O$,"","",0
7730 REM CALL "CM2RAA",F1$,F$(4,3)
7750 RETURN 
8800 REM "Manual entry of company
8810 INPUT @(12,10),"Enter the source company code: ",C8$
8815 IF C8$="e" OR C8$="E" THEN GOTO 9900
8820 IF C8$="" THEN GOTO 8700 ELSE IF LEN(C8$)>3 THEN GOTO 8800 ELSE READ (Z[13],KEY="CMP"+STR(NUM(C8$,ERR=8800):"000"),DOM=8800)C9$
8825 IF C9$(195,1)<>"1" THEN CALL "ZZPROM",".4",X3$,0,"This is not a remote location company","","",0; GOTO 8810
8850 RETURN 
8980 DEF FNZ$(Z9$)=Z9$(1,POS(Z0$=Z9$+Z0$)-1)
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9700 REM "PROG FLOW
9705 IF X9>0 THEN GOTO 9900
9710 IF U1$="" THEN REMOVE (Z[13],KEY=U0$,DOM=9900); GOTO 9900
9720 WRITE (Z[13],KEY=U0$)U0$,U1$
9730 RUN U1$(1,6)
9800 REM 
9810 Q$="+ ("+F0$+")"
9820 CALL "ZZPROM",".4",X3$,0,"Problem accessing files!"+Q$,"","",0
9845 GOTO 9900
9850 REM "Write message file, skip record
9890 GOTO 1500
9900 REM "END PROGRAM
9910 REM CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z(ALL),0,0
9940 RUN "ZMENU"
9999 END 
