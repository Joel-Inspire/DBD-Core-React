0010 REM "Accumulate to transfer file data <CM2AAA>
0035 REM "3.9 - 05/31/96 - 16.69 - dmm
0040 REM "Copyright 1996 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0900 REM "This is reads & writes version 2.0 records
1010 REM " K0$ IS KEY, F0 IS SOURCE FILE NUMBER
1011 REM "T0=0 TRANSFER FROM RL, T0=1 TRANSFER TO ALL RLS, T0=2=TRANS TO RL,
1012 REM "T0=2 SUPPLIES COMPANY CODE IN FIRST PART OF K0$
1013 REM "T0=3 TRANS TO RL FILE USING K1$ AS THE DATA, SO SOURCE DATA FILE
1014 REM "POINTER WON'T BE CHANGED,
1015 REM "T0=4 RL TO ML SAME AS T0=3 BUT IN REVERSE
1017 REM 
1018 REM "I9 IS LINK TO 1ST INDEX IF INXEDED FILE
1019 REM 
1020 ENTER X3$,F0,T0,K0$,K1$,I9
1025 DIM Z[NUM(X3$(60,3))]
1040 SETERR 9000
1060 IF T0=2 OR T0=3 THEN C0$=K0$(1,3),K0$=K0$(4)
1100 REM "
1110 X0$="CM2AAA"
1120 DIM Z$(20,$00$)
1200 REM "Get data from file
1205 IF F0=0 THEN P=POS("|"=K0$),F0$=K0$(1,P-1),K0$=K0$(P+1),T9=2; GOTO 1211; REM "Used to pass summary bill no from R/L to M/L, CMH file, see 5600 in AR2REA
1210 F0$=FID(F0); T9=ASC(F0$(10,1)),F0$=F0$(4,6)+F0$(21,2)
1220 IF POS(F0$(1,3)="APHAPW",3)<>0 THEN F0$(1,3)="CM2"
1221 IF F0$(1,3)="ARB" THEN F0$(1,3)="CM3"
1240 IF T9=0 THEN GOTO 3000
1250 IF T0=3 OR T0=4 THEN A0$=K1$; GOTO 1300
1280 READ RECORD (F0,KEY=K0$)A0$
1285 IF F0$(1,3)="CM2" THEN A0$(1,3)=C0$,K0$(1,3)=C0$; REM "if doin a/p check print header, replace the company code with the company code, Fix the key also
1290 A0$=FNZ$(A0$)
1400 REM 
1900 REM 
1920 GOSUB 2000
1990 GOTO 9900
2000 REM "Standard processing
2005 REM "T0$ IS DATE / TIME / OPERATOR STAMP
2010 T0$=X3$(21,6)+STR(100*TIM:"0000")+X3$(40,3)+"2.0"; REM "2.0 is version number
2020 K9$=F0$(1,8)+K0$+"00"; REM "00 is unique part of key
2040 Q$="CM1"+X3$(9,3); IF T0=1 THEN Q$="CM0" ELSE IF T0=2 OR T0=3 THEN Q$="CM0"+C0$
2053 REM "Notice after call, Z0 is not checked - this will generate an error 17
2054 REM "if the file could not be openned.
2055 Z$="01O "+Q$+" "; GOSUB 9750; F1=Z[1]; REM ON Z0 GOTO 02056,09900
2060 WRITE (F1,KEY=K9$,DOM=2400)K9$,T0$,"","",A0$
2200 REM 
2290 RETURN 
2400 REM "Increment unique part of key
2405 U$=K9$(LEN(K9$)-1,2); IF U$(2,1)<"z" THEN U$(2,1)=CHR(ASC(U$(2,1))+1) ELSE IF U$(1,1)="z" THEN EXIT 999 ELSE U$=CHR(ASC(U$(1,1))+1)+"0"
2410 K9$(LEN(K9$)-1,2)=U$
2445 GOTO 2060
3000 REM "Linked list file (INDEXED)
3010 A0=I9
3020 IF A0<=0 THEN GOTO 3090 ELSE READ RECORD (F0,IND=A0)X$
3025 K0$=STR(A0:"000000"),A0$=X$
3030 GOSUB 2000
3035 P=POS($8A$=X$); A0=NUM(X$(1,P-1))
3060 GOTO 3020
3095 GOTO 9900
8910 DEF FNZ$(Z9$)=Z9$(1,POS(Z$=Z9$+Z$)-1)
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9940 EXIT 
9999 END 
