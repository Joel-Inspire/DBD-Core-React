0010 REM "<CM2PRA> Interim Frachise Program runner
0020 SETESC 9300; SETERR 9000
0035 REM "3.9 - 10/13/95 - 17.12
0040 REM "Copyright 1995 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0110 X0$="CM2PRA",X1$="Run Franchise Updates"
0120 DIM Z0$(80,"-")
0130 K0=20,K1=1
0135 C9=-1
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21],B[22],B[23],B[24],B[25],B[26],B[27]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20],C[21],C[22],C[23],C[24],C[25],C[26],C[27]
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14]
0350 IOLIST E$,E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14]
0360 IOLIST F$
0370 IOLIST G$,G[0],G[1],G[2],G[3],G[4],G[5],G[6],G[7],G[8],G[9],G[10],G[11],G[12],G[13],G[14],G[15],G[16],G[17],G[18],G[19],G[20],G[21],G[22],G[23],G[24],G[25],G[26],G[27]
0380 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13]
0390 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15],I[16],I[17],I[18],I[19],I[20]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="13O ZZPARM "
0511 REM "APH is open for use by CM2AAA as a reference.
0512 REM "ARP is open for use by CM2AAA as a reference.
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0600 REM "
0605 PRINT @(22,6),'SB',"Master Company: ",'SF',X3$(9,3),
0610 GOSUB 6000
0620 IF Q1$="" THEN GOSUB 6800
0640 IF Q1$="" THEN CALL "ZZPROM",".Y",X3$,Z,"Proceed?","","",0; ON Z GOTO 0641,9900
0900 REM 
1000 REM "Setup run
1010 GOTO 5900
5900 REM "Setup new order sequence
5905 REM "String to CM2PRB  1,3=master comp, 4,3=first comp, 7,3= last company, 10,3=selection screen to use
5906 J$=X3$(9,3)+J$; REM "J$ set in 6800's
5910 U0$=X3$(1,6)+"PF"
5920 U1$="CM2PRB"+STR(LEN(J$):"00")+J$
5930 WRITE (Z[13],KEY=U0$)U0$,U1$
5980 REM CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z(ALL),0,0
5990 SETERR 5995; RUN U1$(1,6)
5995 CALL "ZZPROM",".4",X3$,0,"Could not find CM2PRB, TERMINATING!","","",0; GOTO 9900
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6020 PRINT @(10,3),"This utility will create transacations to put the ",@(10,4),"master company and franchies in balance.",
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6800 REM "Enter process to use
6806 J$="   "+$7E7E7E$+"AUTOUPDATE  "; GOSUB 6850
6810 CALL "ZZENTR","ZU>",A{ALL},J$,X4$,X3$,38,8,1,3,C0,"","","CMP","CM2PRA00","ZZ2CAA","",""; IF ABS(C0)>4 THEN GOSUB 6000; GOSUB 6850; C0=ABS(C0)-5; ON C0 GOTO 6810,6811
6820 CALL "ZZENTR","ZU<",A{ALL},J$,X4$,X3$,38,10,4,3,C0,"","","CMP","CM2PRA02","ZZ2CAA","",""; IF ABS(C0)>4 THEN GOSUB 6000; GOSUB 6850; C0=ABS(C0)-5; ON C0 GOTO 6820,6821
6822 IF ABS(C0)=2 THEN GOTO 6810
6825 CALL "ZZENTR","SU",A{ALL},J$,X4$,X3$,38,12,7,12,C0,"","","","CM2PRA04","","",""; IF ABS(C0)>4 THEN GOSUB 6000; GOSUB 6850; C0=ABS(C0)-5; ON C0 GOTO 6825,6826
6826 IF ABS(C0)=2 THEN GOTO 6820
6835 GOSUB 6900
6837 M$="There are "+STR(T)+" companies to process, proceed?"
6840 CALL "ZZPROM",".Y",X3$,Z,M$,"","",0; ON Z GOTO 6841,6805
6845 RETURN 
6850 REM "Display companies
6855 PRINT @(0,8),'CE','SB',@(18,8),"Starting Franchise:",@(20,10),"Ending Franchise:",@(13,12),"Report Selection to use:",'SF',
6860 CALL "ZZDISP","S>",J$(1,3),"",X3$,"","",38,8,X4$
6865 CALL "ZZDISP","S<",J$(4,3),"",X3$,"","",38,10,X4$
6870 PRINT @(38,12),J$(7,12),
6895 RETURN 
6900 REM "Count the number of franchises to do
6905 PRINT @(20,22),"Counting the companies to process...",
6910 T=0
6915 READ (Z[13],KEY="CMP",DOM=6916)
6920 K$=KEY(Z[13],END=6940); IF K$(4,3)<J$(1,3) THEN READ (Z[13]); GOTO 6920 ELSE IF K$(1,3)<>"CMP" OR K$(4,3)>J$(4,3) THEN GOTO 6940
6925 READ (Z[13],KEY=K$)J1$; IF J1$(195,1)="1" THEN T=T+1
6935 GOTO 6920
6940 T0=INT(T*.02); IF T0<=1 THEN T0=2
6942 PRINT @(0,22),'CE',
6945 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
