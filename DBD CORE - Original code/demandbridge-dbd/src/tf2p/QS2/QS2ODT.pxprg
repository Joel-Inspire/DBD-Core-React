0010 REM "Repeat RFQ - Summary Screen <QS2ODT>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 06/22/09 - 18.189444 - dmm - SSP# 229740
0037 REM "229740-Create RFQ Working Days field, collect online from vendors, 
0040 REM "Copyright 2009 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 REM "Copied from FM2ODT, 8/18/98, WO100042
0051 REM "We will pass in a repeat order number from RFQ entry (QS2DAA), read through the repeat order lines file (FT4) and build a string of RFQ numbers, read each RFQ in and display info about it, ask them to choose which RFQ's they want to repeat and if they want to quote all the original vendors or just the selected vendor (the vendor that did the job on the repeat order).
0089 REM "Q0$=New RFQ number, Q1$=Repeat order number
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0095 CALLED$="Y"
0100 SETERR 9000
0110 X0$="QS2ODT",X1$="Repeat RFQ Summary Screen",K9$="",K9=0
0130 K0=9,K1=2,V1=5,V2=17
0135 C9=-1
0140 M0$="#,###,##0.00",M1$="###.00%"
0150 DEF FNQ$(Z8,Z9$)=STR(Z8:Z9$(1,POS(".00"=STR(Z8:Z9$)+".00")-1))
0155 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
0160 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0200 REM "
0230 X2=-1; PRINT @(0,5),'CE',
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0296 DIM L0$(LEN(M0$),X3$(235,1)),L1$(LEN(M1$),X3$(235,1)); L0$=MNM('GS')+L0$+MNM('GE'),L1$=MNM('GS')+L1$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24],A[25],A[26],A[27],A[28],A[29]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21],B[22],B[23],B[24]
0330 IOLIST C$,C0$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20],C[21],C[22],C[23],C[24],C[25],C[26],C[27],C[28],C[29],C[30],C[31],C[32],C[33],C[34],C[35],C[36]
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15],D[16],D[17],D[18],D[19],D[20],D[21],D[22],D[23],D[24],D[25],D[26],D[27],D[28],D[29],D[30],D[31],D[32],D[33],D[34],D[35] ! WO229740
0350 IOLIST E$,E[0],E[1],E[2]
0370 IOLIST G$
0390 IOLIST M$,M[0],M[1]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0506 REM "Slot 16 will be used to open and close files for writes
0510 Z$="01X FT4...  02ORFT3...  03O QSC...  04O QSD...  05O QSA...  06O ZZPARM  07O QSB...  08O AP4...  09O QSE...  10O QS1...  11O QS2...  12O QSS...  13O QSU...  14O QSV...  15O QSF...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0530 DIM B$(159),AP4$(100)
0535 DIM A$(228),A[29]
0575 REM "Get list of RFQ's for this repeat order number
0580 DIM RFQ$[100],RFQ[100,2]; COUNT=0,RFQ_LIST$=""; REM "We'll read thru and find any lines on this order with an RFQ number, keep RFQ number, Vendor code, sell unit in RFQ$ array, keep Qty ordered and Qty per sell unit in RFQ array
0590 READ (Z[1],KEY=Q1$,DOM=0591)
0600 READ (Z[1],END=0650)IOL=0310
0605 IF A$(147,8)<>Q1$ THEN GOTO 0650 ELSE IF STP(A$(221,8),3," ")="" THEN GOTO 0600
0610 IF POS(A$(221,8)=RFQ_LIST$)>0 THEN GOTO 0600 ELSE RFQ_LIST$=RFQ_LIST$+A$(221,8); REM "We only want each RFQ one time, we will assume the first one will correspond to line 001 on the RFQ
0630 COUNT=COUNT+1,RFQ$[COUNT]=A$(221,8)+A$(94,10)+A$(124,4)+"YY",RFQ[COUNT,0]=A[0],RFQ[COUNT,1]=A[5]
0635 GOTO 0600
0650 IF COUNT=0 THEN CALL "ZZPROM",".4",X3$,0,"No RFQ's found for this repeat order number","","",0; Q0$="None"; GOTO 9900
0680 GOSUB 6000
0800 REM 
0810 IF CALLED$<>"Y" THEN GOSUB 8950
1000 REM "
1010 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
1045 REM "LET A$(1,6)=K9$+A1$
1050 IF Q1$<>"" THEN GOTO 1500
1055 GOTO 1500
1500 REM "Display lines"
1600 REM "Initialize
1605 T0=0,T1=0
1610 GOSUB 2150
1620 FOR X=1 TO COUNT
1630 READ (Z[5],KEY=RFQ_LIST$(1,8),DOM=1631); GOTO 1700
1635 REM "Got the DOM, this RFQ is not on file anymore
1640 DIM B$(159)
1645 B$(41,40)="RFQ no longer on file",RFQ$[X](23,2)="NN"
1650 GOTO 1730
1700 REM "Read first line of quote
1710 DIM B$(159),B[24]; READ (Z[7],KEY=RFQ$[X](1,8)+"001",DOM=1711)IOL=0320; GOTO 1730
1715 B$(41,40)="RFQ line 001 info no longer on file",RFQ$[X](23,2)="NN"
1730 IF L>V2 THEN GOSUB 2100
1735 L=L+1
1737 PRINT @(0,L),STR(X:"000"),
1740 CALL "ZZDISP","A",RFQ$[X](1,8),"O/P",X3$,"","",6,L,X4$
1745 PRINT @(24,L),RFQ$[X](23,1),"/",RFQ$[X](24,1),@(33,L),B$(41,40),
1750 RFQ[X,2]=L; REM "Will need line number for modify of Repeat/All
1755 DIM AP4$(100); READ (Z[8],KEY=RFQ$[X](9,10),DOM=1756)AP4$; GOTO 1760
1756 AP4$(11,35)="Vendor no longer on file"
1760 GOSUB 3200; REM "Get unit/qty info ready
1770 L=L+1
1780 PRINT @(0,L),"Selected Vendor/Qty: ",@(21,L),AP4$(11,30),@(54,L),FNQ$(RFQ[X,0]/J,M0$)," ",E3$,
1785 L=L+1
1795 NEXT X
1800 GOTO 2200
2100 REM "new page
2105 RET_CODE=2100
2110 CALL "ZZPROM","X0PO2MAT",X3$,Z,"","","V",X0
2120 ON Z GOTO 2110,2130,2400,2221,2300
2140 PRINT @(0,V1+1),'CE',
2150 L=V1,K0$=""
2190 RETURN 
2200 REM "End routinge
2205 RET_CODE=2200
2218 CALL "ZZPROM","X0PO2MAT",X3$,Z,"","","V",0
2220 ON Z GOTO 2221,2221,2400,2221,2300
2221 GOTO 7500
2250 PRINT @(0,V1+1),'CE',
2260 IF CALLED$="Y" THEN GOTO 9900
2290 IF Q1$<>"" THEN GOTO 9700 ELSE GOTO 1000
2300 REM "Handle input of a line number"
2310 DIM LINE$(3); PRINT @(30,22),"Line number:",; CALL "ZZENTR","ZX",A{ALL},LINE$,X4$,X3$,42,22,1,3,C0,"","","","PO2MAT10","","",""
2315 IF C0<0 THEN GOTO 2400
2320 LINE=NUM(LINE$)
2325 X$="Y=Repeat this RFQ, N=Don't repeat this RFQ",TMP=RFQ[LINE,2]; TMP$=RFQ$[LINE](23,1)
2330 CALL "ZZENTR","Y",A{ALL},TMP$,X4$,X3$,24,TMP,1,1,C0,"","{3"+X$,"","QS2ODT02","","",""; RFQ$[LINE](23,1)=TMP$(1,1)
2335 IF RFQ$[LINE](23,1)<>"Y" THEN RFQ$[LINE](23,2)="NN"; GOTO 2360 ELSE C0=0,X$="Y=Repeat for all original vendors/qtys, N=Selected vendor/qty only",TMP$=RFQ$[LINE](24,1)
2340 CALL "ZZENTR","Y",A{ALL},TMP$,X4$,X3$,26,TMP,1,1,C0,"","{3"+X$,"","QS2ODT04","","",""; RFQ$[LINE](24,1)=TMP$(1,1)
2360 IF RET_CODE=2100 THEN GOTO 2100 ELSE IF RET_CODE=2200 THEN GOTO 2200
2390 REM "PRINT @(0,3+V0),'CE',; GOSUB 06000
2400 REM "Redisplay logic
2410 GOSUB 2140
2420 GOTO 1500
3200 REM "Set J based on u/m
3205 IF RFQ$[X](19,4)=MID(M$,4,4) THEN GOTO 3220
3210 DIM M$(20),M[1]
3215 READ (Z[6],KEY="U/M"+RFQ$[X](19,4),DOM=3216)IOL=0390
3220 IF M$(20,1)<>"Y" THEN J=RFQ[X,1],J0=RFQ[X,1] ELSE J=M[1]; IF M[0]<>0 THEN J0=M[0] ELSE J0=M[1]
3225 IF J=0 THEN J=1
3230 E3$=FNS$(RFQ$[X](19,4))+"/"+FNR$(STR(J0:"##,##0"))
3240 RETURN 
3300 REM "Run lines program
3305 IF CALLED$="Y" THEN GOTO 9900
3310 U0$=X3$(1,6)+"PF",Q$=STR(LEN(A1$):"00")+A1$
3320 U1$="FM2ODB"+STR(LEN(Q2$):"00")+Q2$+X0$+Q$+U1$
3330 WRITE (Z[6],KEY=U0$)U0$,U1$
3350 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
3390 RUN "FM2ODB"
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6070 PRINT @(7,V1),"RFQ No",@(20,V1),"Repeat/All",@(40,V1),"Line 001 Description",
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6215 GOSUB 6450
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>=0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6455 IF C9<0 OR CALLED$="Y" THEN GOTO 6445
6460 CALL "ZZDISP","A",A$(1,8),"O/P",X3$,"","",10,3,X4$
6462 GOSUB 7600
6490 RETURN 
6500 REM "DELETE
6510 REMOVE (Z[1],KEY=A1$,DOM=6511)
6590 GOTO 1630
6600 REM "ALT KEY DATA READS
6605 FIND (Z[2],KEY=A$(1,8),DOM=6606)IOL=0320
6690 RETURN 
6700 REM "ADD ENTRY
6705 IF Z9=0 THEN GOTO 6790
6710 WRITE (Z[1],KEY=A1$)IOL=0310
6790 GOTO 1630
6800 REM "NEXT ENTRY IN FILE
6805 ON 10*FPT(C0)+2 GOTO 6850,6806
6810 A1$=KEY(Z[1],END=6895)
6815 GOSUB 6600
6820 IF A1$(1,LEN(K9$))<>K9$ THEN GOTO 6895
6825 A$(1,LEN(A1$))=A1$
6830 GOSUB 6600
6835 GOSUB 6450
6840 GOTO 1515
6850 REM PRIOR ENTRY
6855 CALL "ZZKEYP",ERR=6856,Z[1],A1$; GOTO 6820
6860 CALL "ZZKEYL",ERR=6861,Z[1],A1$; GOTO 6820
6870 GOTO 6895
6890 GOTO 1515
6895 PRINT 'RB',; READ (Z[1],KEY=K9$,DOM=1140); GOTO 1140
6902 V9$="1203  6104  7404  1806  6106  0009  1109  3909  1711  1713  1715  5511  6311  5513  5515  "
7500 REM "Check array for at least one with Y to repeat, if any found then create the RFQ's else return to QS2DAA
7510 FOR X=1 TO COUNT
7515 IF RFQ$[X](23,1)="Y" THEN EXITTO 8000
7520 NEXT X
7525 REM "If we're here then we didn't find any with Y to repeat
7530 Q0$="None"; GOTO 9900
7600 REM "Print S/O stuff
7605 IF CALLED$="Y" THEN GOTO 7640
7610 CALL "ZZDISP","A",B$(6,10),"A/R",X3$,"","",31,3,X4$
7615 IF G$(1,10)<>B$(6,10) THEN DIM G$(100); FIND (Z[8],KEY=B$(6,10),DOM=7616)IOL=0037
7620 PRINT @(44,3),G$(11,35),
7640 RETURN 
8000 REM "Using Q0$ (A1$ from QS2DAA) create repeat RFQ's as needed with A, then B and so on
8010 PRINT @(0,22),'CE',@(26,22),"Creating repeat order RFQ's",
8015 LETTER$=CHR(64),FIRST_ONE$="Y",FILE$=""; REM "Will use this to increment RFQ number, A then B then C and so on
8020 FOR X=1 TO COUNT
8030 IF RFQ$[X](23,1)<>"Y" THEN GOTO 8490; REM "We are not repeating this one
8035 IF RFQ$[X](24,1)="Y" THEN ALL_VENDORS$="Y" ELSE ALL_VENDORS$="N"
8040 LETTER$=CHR(ASC(LETTER$)+1),RFQ_NUM$=Q0$(1,2)+Q0$(4,5)+LETTER$
8045 IF RFQ_NUM$(3,1)="0" THEN RFQ_NUM$=PAD(RFQ_NUM$(1,2)+RFQ_NUM$(4),8); GOTO 8045; REM "Strip out 0's so RFQ number is left justified
8050 IF FIRST_ONE$="Y" THEN FIRST_ONE$="N",FIRST_RFQ$=RFQ_NUM$
8060 DIM QSA$(480); READ (Z[5],KEY=RFQ$[X](1,8),DOM=8080)QSA$
8065 QSA$(178,6)=X3$(21,6),QSA$(184,1)="Y",QSA$(187,1)=" ",QSA$(373,6)=X3$(21,6),QSA$(385,6)=DIM(6),QSA$(412,8)=RFQ_NUM$,QSA$(434,6)=DIM(6),QSA$(455,20)=DIM(20)
8070 IF POS(" "<>QSA$(373,6))<>0 THEN CALL "ZZDATE",X3$,"",QSA$(373,6),QE$,30,0,0,0,0,0,0,"","",""; QSA$(379,6)=QE$
8075 WRITE (Z[5],KEY=QSA$(412,8))QSA$
8080 READ (Z[7],KEY=RFQ$[X](1,8),DOM=8081)
8085 DIM B$(157),B[24]; K$=KEY(Z[7],END=8120); READ (Z[7],KEY=K$)IOL=0320
8090 IF K$(1,8)<>RFQ$[X](1,8) THEN GOTO 8120
8100 B$(81,14)=DIM(14),B$(102,38)=DIM(38),B$(150,8)=RFQ_NUM$,B[1]=0
8105 IF ALL_VENDORS$="N" THEN B[2]=RFQ[X,0],B[3]=0,B[4]=0,B[5]=0,B[6]=0
8110 FOR Y=7 TO 23; B[Y]=0; NEXT Y
8115 WRITE (Z[7],KEY=B$(150,8)+B$(6,3))IOL=0320; READ (Z[7],KEY=K$,DOM=8120); GOTO 8085
8120 READ (Z[3],KEY=RFQ$[X](1,8),DOM=8121)
8125 DIM C$(120),C[36]; C0$=""; K$=KEY(Z[3],END=8150); READ (Z[3],KEY=K$)IOL=0330
8130 IF K$(1,8)<>RFQ$[X](1,8) THEN GOTO 8150
8135 C1$=K$,C1$(1,8)=RFQ_NUM$
8140 FOR Y=1 TO 36; C[Y]=0; NEXT Y
8145 WRITE (Z[3],KEY=C1$)IOL=0330; READ (Z[3],KEY=K$,DOM=8150); GOTO 8125
8150 READ (Z[4],KEY=RFQ$[X](1,8),DOM=8151)
8155 DIM D$(288),D[35]; K$=KEY(Z[4],END=8200); READ (Z[4],KEY=K$)IOL=0340 ! WO229740
8160 IF D$(1,8)<>RFQ$[X](1,8) THEN GOTO 8200
8165 IF ALL_VENDORS$="N" THEN IF D$(12,10)<>RFQ$[X](9,10) THEN GOTO 8155
8170 D$(1,8)=RFQ_NUM$,D$(22,10)=DIM(10),D$(67,1)="Y"; IF ALL_VENDORS$="N" THEN D$(68,2)="01"
8175 FOR Y=0 TO 26; D[Y]=0; NEXT Y
8180 WRITE (Z[4],KEY=D$(1,11)+D$(68,2))IOL=0340
8185 WRITE (Z[9],KEY=D$(66,1)+D$(1,11)+D$(12,10)+D$(68,2))
8190 WRITE (Z[9],KEY=LCS(D$(66,1))+D$(1,8)); READ (Z[4],KEY=K$,DOM=8200); GOTO 8155
8200 READ (Z[15],KEY=RFQ$[X](1,8),DOM=8201)
8205 K$=KEY(Z[15],END=8225); READ RECORD (Z[15],KEY=K$)QSF$
8210 IF QSF$(1,8)<>RFQ$[X](1,8) THEN GOTO 8225
8215 QSF$(1,8)=RFQ_NUM$
8220 WRITE RECORD (Z[15],KEY=QSF$(1,11))QSF$; READ (Z[15],KEY=K$,DOM=8225); GOTO 8205
8225 READ (Z[12],KEY=RFQ$[X](1,8),DOM=8226)
8230 K$=KEY(Z[12],END=8250); READ RECORD (Z[12],KEY=K$)QSS$
8235 IF QSS$(1,8)<>RFQ$[X](1,8) THEN GOTO 8250
8240 QSS$(1,8)=RFQ_NUM$
8245 WRITE RECORD (Z[12],KEY=QSS$(1,11))QSS$; READ (Z[12],KEY=K$,DOM=8250); GOTO 8230
8250 READ (Z[13],KEY=RFQ$[X](1,8),DOM=8251)
8255 K$=KEY(Z[13],END=8275); READ RECORD (Z[13],KEY=K$)QSU$
8260 IF QSU$(1,8)<>RFQ$[X](1,8) THEN GOTO 8275
8265 QSU$(1,8)=RFQ_NUM$
8270 WRITE RECORD (Z[13],KEY=QSU$(1,34))QSU$; READ (Z[13],KEY=K$,DOM=8275); GOTO 8255
8275 READ (Z[14],KEY=RFQ$[X](1,8),DOM=8276)
8280 K$=KEY(Z[14],END=8300); READ RECORD (Z[14],KEY=K$)QSV$
8285 IF QSV$(1,8)<>RFQ$[X](1,8) THEN GOTO 8300
8290 QSV$(1,8)=RFQ_NUM$
8295 WRITE RECORD (Z[14],KEY=QSV$(1,34))QSV$; READ (Z[14],KEY=K$,DOM=8300); GOTO 8280
8300 READ (Z[10],KEY=RFQ$[X](1,8),DOM=8301)
8305 K$=KEY(Z[10],END=8330); READ RECORD (Z[10],KEY=K$)QS1$
8310 IF QS1$(1,8)<>RFQ$[X](1,8) THEN GOTO 8330
8315 QS1$(1,8)=RFQ_NUM$
8320 WRITE RECORD (Z[10],KEY=QS1$(1,11))QS1$
8325 WRITE (Z[11],KEY=QS1$(21,21)+QS1$(1,11)); READ (Z[10],KEY=K$,DOM=8330); GOTO 8305
8490 NEXT X
8495 Q0$=FIRST_RFQ$; GOTO 9900
8950 REM "Program flow logic
8960 U0$=X3$(1,6)+"PF"
8970 FIND (Z[6],KEY=U0$,DOM=8990)U0$,U1$
8975 IF U1$="" THEN Q1$=""; GOTO 8990
8980 Q1=NUM(U1$(7,2)),Q1$=U1$(9,Q1),U1$=U1$(Q1+9)
8990 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9700 REM "PROG FLOW
9710 IF U1$="" THEN REMOVE (Z[6],KEY=U0$,DOM=9900); GOTO 9900
9720 WRITE (Z[6],KEY=U0$)U0$,U1$
9730 RUN U1$(1,6)
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 REM "229740-Create RFQ Working Days field, collect online from vendors
