0010 REM "  RFQ detail entry <QS2DAB>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 10/27/14 - 12.7425 - jvv - SSP# 273055
0037 REM "273055-Expand IC2 for 6 additional cost breaks, allow entry in GUI 
0040 REM "Copyright 2014 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0079 IF L2=0 THEN GOTO 0080 ELSE L2=0; GOSUB 6240; GOTO 2020
0080 IF L0<>0 THEN L1=L0,L0=0; ON L1 GOTO 0081,7110,3230,7050,2840,7400,7050
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0110 X0$="QS2DAB",X1$="  RFQ Detail",K9$="",K9=0
0120 DIM Z0$(80,"-")
0130 K0=8,K1=2
0135 C9=-1
0140 M0$="##,##0-",M1$="###.00-",M2$="###,##0-",M3$="###,###.00-",M4$="##,###,###.00-",M5$="####,###.00"; REM "Change in QS2DB1 also
0145 GOSUB 8950
0200 REM "
0230 IF Q1$<>"" THEN X2=-1; PRINT @(0,3),'CE',
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$(1,LEN(A$)),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24]
0320 IOLIST B$
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20],C[21],C[22],C[23],C[24],C[25],C[26],C[27],C[28],C[29],C[30],C[31]
0331 IOLIST C1$,R[0],R[1],R[2]
0340 IOLIST D$,D[0],D[1],D[2]
0350 IOLIST E$,E0$,E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15],E[16],E[17],E[18],E[19],E[20],E[21],E[22],E[23],E[24],E[25],E[26],E[27],E[28],E[29],E[30],E[31],E[32],E[33],E[34],E[35],E[36]
0360 IOLIST E2$
0370 IOLIST G$,G0$
0380 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12]
0410 IOLIST S$,S[0],S[1]
0420 IOLIST U$,U[0],U[1]
0430 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15],I[16],I[17],I[18],I[19]
0440 IOLIST L$,L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15],L[16],L[17],L[18],L[19],L[20],L[21],L[22],L[23],L[24],L[25],L[26],L[27],L[28],L[29],L[30]
0450 IOLIST J9$,J[0],J[1],J[2],J[3],J[4]
0460 IOLIST M$,M[0],M[1],M[2],M[3],M[4],M[5],M[6],M[7],M[8],M[9],M[10],M[11],M[12],M[13],M[14],M[15],M[16],M[17],M[18],M[19],M[20],M[21],M[22],M[23],M[24],M[25],M[26],M[27],M[28],M[29],M[30],M[31],M[32],M[33],M[34],M[35] ! WO229740
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01X QSB...  02O QSA...  03O FMP...  04O AP4...  05O QSC...  06O FM0...  07O QS1...  08O AR1...  09O QS2...  10O IC0...  11O IC2...  12O FM1...  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0530 READ (Z[13],KEY=X3$(9,3)+"RFQ",DOM=0531)P8$
0540 READ (Z[13],KEY=X3$(9,3)+"F/M")FMS_PARM$
0590 READ (Z[1],KEY=K9$,DOM=0591)
0600 REM "
0620 GOSUB 6000
0690 IF Q1$(LEN(Q1$),1)<>"*" THEN READ (Z[1],KEY=Q1$,DOM=0691)
1000 REM "
1005 C5=0
1010 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
1030 N1$="",R0$="",R1$="",G0$="",E0$="",S0=1,S1=1,U0=1,U1=1; DIM B$(391),C2$(100),D$(227),D[2],S$(21),S[1],U$(21),U[1],E2$(130),E$(120),E[36],C1$(61),G$(34),H$(483),H[12],R[3],I$(100),I[19],L$(50),L[16],C[31],C$(325)
1035 DIM A$(157),A[24]
1037 IF Q1$(LEN(Q1$),1)="*" THEN GOTO 8500
1045 A$(150,8)=K9$+A1$,A2$=""
1060 PRINT (0,ERR=1070)'CF',; GOSUB 6450; GOTO 1100
1070 GOSUB 6000; GOSUB 6450
1100 REM "KEY SEQ
1110 X0=-1,C0=0,X1=0,C9=0,Z9=0
1120 C0=ABS(C0),X$=""; IF C0=2 AND X0>0 THEN X0=X0-1 ELSE IF C0<>2 THEN X0=X0+1; IF C0=4 THEN GOTO 9700
1140 ON X0 GOTO 1200,1250,1500
1200 REM "  RFQ number
1205 IF Q1$>"" THEN A$(150,8)=Q1$(1,8),C0=0; GOSUB 6450; GOTO 1212
1206 IF A1$>"" THEN A$(150,8)=A1$(1,8),C0=0; GOSUB 6450; GOTO 1212
1210 CALL "ZZENTR","AZXUX",A{ALL},A$,X4$,X3$,10,3,150,8,C0,"O/P","{1"+X$,"","QS2DAB00","QSA","QS2DAA",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 1210,1211
1215 IF C0<0 THEN ON INT(ABS(C0)-2) GOTO 1210,6800,9700,6970
1220 FIND (Z[2],KEY=A$(150,8),DOM=1210)IOL=0320
1225 PRINT @(31,3),B$(20,35),
1240 GOTO 1120
1250 REM "Line number
1255 IF LEN(Q8$)<>3 THEN Q8$="001",A$(6,3)=Q8$ ELSE A$(6,3)=Q8$
1259 J7$=A$(150,8)
1260 CALL "ZZENTR","ZUX",A{ALL},A$,X4$,X3$,10,4,6,3,C0,"","{2"+X$,J7$,"QS2DAB02","QSB","",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 1250,1261
1262 IF ABS(C0)=2 AND LEN(A1$)>0 THEN A1$=A1$(1,0)
1265 IF C0=-1 THEN GOTO 1267 ELSE IF C0<0 THEN ON INT(ABS(C0)-2) GOTO 1120,6800,9800,6970
1290 GOTO 1120
1500 REM "
1505 Z9=-1
1510 A1$=K9$+A$(150,8)+A$(6,3),A$(1,LEN(K9$))=K9$
1520 READ (Z[1],KEY=A1$,DOM=1600)IOL=0310
1525 Z9=0,N$="N",N0$="N"
1530 READ (Z[5],KEY=A1$,DOM=1531)IOL=0350
1590 GOTO 1700
1600 REM "
1620 IF A$(6,3)="001" THEN GOTO 1650 ELSE CALL "ZZPROM","2",X3$,Z,"","","",0; ON Z GOTO 1650,1630
1630 GOTO 1000
1650 REM 
1655 A$(101,1)="Y"; PRINT @(77,11),"Y",
1660 N$="Y",N0$="Y"
1665 N1$="*"
1690 GOTO 2000
1700 REM "
1790 GOSUB 6200
1800 REM "
1820 CALL "ZZPROM","X0QS2DAB",X3$,Z,"","","V",X0
1821 IF A$(99,1)<>"Y" AND A$(9,1)<>"N" THEN N$="N"
1825 ON Z GOTO 1850,6500,6700,3700,6700
1830 GOTO 2000
1850 REM "MODIFY
1855 C0=1,X0=X0-1; IF Z9=1 THEN GOTO 1880 ELSE IF Z9=0 THEN Z9=1
1865 C9=1
1870 GOSUB 6200
1890 IF Z<0 THEN GOTO 2035 ELSE GOTO 2000
2000 REM "DATA SEQ
2010 C0=0,X0=-1,X1=1,C9=1
2020 X$="",C0=ABS(C0),X0=X0+1; IF C0=2 THEN IF X0>0 THEN X0=X0-2
2025 IF INT(C0)=3 THEN GOSUB 7300 ELSE IF C0>3 OR X0<0 THEN GOTO 1800
2040 ON X0 GOTO 2100,2150,2800,2200,2250,2300,2350,2400,2450,2500,2550,2600,2650,2700,2750,2850,2900,3000,3050,3100,3250,1800
2100 REM "Custom?
2101 IF A$(6,3)="001" THEN A$(99,1)="Y" ELSE A$(99,1)="N"
2102 PRINT @(31,4),A$(99,1),; GOTO 2020
2105 IF A$(99,1)="Y" AND Z9<>-1 THEN GOTO 2020
2106 IF A$(6,3)="001" AND A$(99,1)=" " THEN A$(99,1)="Y"; PRINT @(31,4),A$(99,1),; GOTO 2020 ELSE IF A$(6,3)<>"001" THEN IF ABS(C0)<>2 THEN A$(99,1)="N"; PRINT @(31,4),A$(99,1); GOTO 2020 ELSE CALL "ZZPROM",".4",X3$,0,"Only line 001 may contain a custom item","","",0; C0=1; GOTO 2020
2110 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,31,4,99,1,C0,"","{3"+X$,"","QS2DAB04","","",""
2115 IF A$(99,1)=" " THEN A$(99,1)="N"
2140 GOTO 2020
2150 REM "Line type or custom item type
2155 IF A$(99,1)="Y" THEN X$="LINE TYPE: N=new, E=exact repeat, C=copy change, S=spec change, B=both changed",E9$="NECSB" ELSE X$="I=inventory, C=customer inventory, M=message, S=special charge, N=other",E9$="ICNMS",X$="S=special charge, M=message",E9$="SM"
2160 CALL "ZZENTR","SURX",A{ALL},A$,X4$,X3$,46,4,9,1,C0,"","{3"+X$,E9$+" ","QS2DAB06","","",""
2165 IF A$(9,1)=" " AND C0<>-2 THEN GOTO 2160
2190 GOTO 2020
2200 REM "Product code
2205 IF A$(99,1)<>"Y" AND POS(A$(9,1)="M")<>0 THEN GOTO 2020
2210 GOSUB 8100; CALL "ZZENTR","SZU",A{ALL},A$,X4$,X3$,12,6,20,3,C0,"","{3"+X$,"T","QS2DAB08","FMPP","FM2SAA",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2210,2211
2220 FIND (Z[3],KEY="T"+A$(20,3),DOM=2210)IOL=0330
2230 GOSUB 8125
2240 GOTO 2020
2250 REM "Left-right
2255 IF A$(99,1)<>"Y" AND POS(A$(9,1)="MS")<>0 THEN GOTO 2020
2257 GOSUB 8100
2260 GOSUB 8100; CALL "ZZENTR","S",A{ALL},A$,X4$,X3$,16,6,23,8,C0,"","{3"+X$,"","QS2DAB10","","",""; GOSUB 8125
2270 GOSUB 8125
2290 GOTO 2020
2300 REM "Top-Bottom
2305 IF A$(99,1)<>"Y" AND POS(A$(9,1)="MS")<>0 THEN GOTO 2020
2307 GOSUB 8100
2310 GOSUB 8100; CALL "ZZENTR","S",A{ALL},A$,X4$,X3$,25,6,31,8,C0,"","{3"+X$,"","QS2DAB12","","",""; GOSUB 8125
2320 GOSUB 8125
2340 GOTO 2020
2350 REM "Number of plys
2355 IF A$(99,1)<>"Y" AND POS(A$(9,1)="MS")<>0 THEN GOTO 2020
2357 GOSUB 8100
2360 GOSUB 8100; CALL "ZZENTR","Z",A{ALL},A$,X4$,X3$,35,6,39,2,C0,"","{3"+X$,"","QS2DAB14","","",""; GOSUB 8125
2370 GOSUB 8125
2390 GOTO 2020
2400 REM "Item description
2410 GOSUB 8100; CALL "ZZENTR","S",A{ALL},A$,X4$,X3$,39,6,41,40,C0,"","{3"+X$,"","QS2DAB16","","",""; GOSUB 8125
2440 GOTO 2020
2450 REM "Vendor
2451 GOTO 2020
2455 IF A$(99,1)="Y" OR POS(A$(9,1)="M")<>0 THEN GOTO 2020
2456 A9$=A$(81,10)
2458 GOSUB 8100
2460 CALL "ZZENTR","AU",A{ALL},A$,X4$,X3$,11,7,81,10,C0,"A/P","{3"+X$,"","QS2DAB18","AP4","AP2MAB",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2460,2461
2462 GOSUB 8125
2470 IF POS(" "<>A$(81,10))=0 THEN GOTO 2020 ELSE FIND (Z[4],KEY=A$(81,10),DOM=2460)IOL=0340
2472 DIM E2$(130); IF POS(" "<>A$(91,4))<>0 THEN FIND (Z[6],KEY="P"+A$(81,14),DOM=2473)IOL=0360
2475 GOSUB 8200
2480 IF A9$<>A$(81,10) THEN GOSUB 8400
2490 GOTO 2020
2500 REM "Plant
2501 GOTO 2020
2505 IF A$(99,1)="Y" OR POS(A$(9,1)="M")<>0 THEN GOTO 2020
2506 J0$="P"+A$(81,10),A9$=A$(91,4)
2510 CALL "ZZENTR","SZ",A{ALL},A$,X4$,X3$,72,7,91,4,C0,"","{3"+X$,J0$,"QS2DAB20","FM0P","FM2SKA",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2460,2461
2515 IF POS(" "<>A$(91,4))=0 OR POS("0"<>A$(91,4))=0 THEN A$(91,4)=""; DIM E2$(130); PRINT @(72,7),'CL',; GOTO 2530
2520 FIND (Z[6],KEY="P"+A$(81,14),DOM=2510)IOL=0360
2530 GOSUB 8200
2535 IF A9$<>A$(91,4) THEN GOSUB 8400
2540 GOTO 2020
2550 REM "Selling U/M
2554 IF POS(A$(9,1)="M")<>0 THEN GOTO 2020
2555 J1$=A$(95,4),J0=S0
2560 CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,7,10,95,4,C0,"","{3"+X$,"U/M","QS2DAB22","U/M","ZZ2MUA",""
2563 FIND (Z[13],KEY="U/M"+A$(95,4),DOM=2560)IOL=0410
2565 IF A$(95,4)=J1$ AND POS(" "<>J1$)<>0 THEN GOTO 2590
2575 GOSUB 7500
2590 GOTO 2020
2600 REM "Selling Qty per unit
2605 IF S$(20,1)="Y" OR POS(A$(9,1)="M")<>0 THEN GOTO 2020 ELSE J0=S0
2610 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,12,10,0,501,C0,M0$,"{3"+X$,"","QS2DAB24","","",""
2614 IF A[0]=0 THEN GOTO 2610
2615 IF J0<>A[0] THEN S0=A[0]; GOSUB 7550
2640 GOTO 2020
2650 REM "Quoted quantity
2654 IF C1$(61,1)="Y" OR A$(99,1)="Y" OR POS(A$(9,1)="M")<>0 THEN GOTO 2020
2655 DIM Q[1]; Q[1]=A[1]/S0
2660 CALL "ZZENTR","N.X",Q{ALL},A$,X4$,X3$,19,10,1,822,C0,M4$,"{3"+X$,"","QS2DAB26","","",""
2665 IF C0>0 THEN A[1]=Q[1]*S0; GOSUB 7750; GOSUB 7800; GOSUB 7700
2670 PRINT @(19,11),A[1]/U0:M4$,
2690 GOTO 2020
2700 REM "Quoted price
2705 IF POS("Y"=S$(21,1)+C1$(61,1)+A$(99,1))<>0 OR POS(A$(9,1)="M")<>0 THEN GOTO 2020
2710 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,33,10,17,621,C0,M3$,"{3"+X$,"","QS2DAB28","","",""
2715 IF C0>0 THEN GOSUB 7750
2740 GOTO 2020
2750 REM "Quoted price extension
2754 IF A$(9,1)="S" AND C1$(61,1)="Y" THEN GOTO 2756
2755 IF S$(21,1)<>"Y" AND C1$(61,1)<>"Y" OR POS(A$(9,1)="M")<>0 THEN GOTO 2020
2760 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,44,10,18,822,C0,M4$,"{3"+X$,"","QS2DAB30","","",""
2765 IF C0>0 THEN GOSUB 7700
2790 GOTO 2020
2800 REM "Item code
2805 IF POS(A$(9,1)="M")<>0 THEN GOTO 2020
2807 IF A$(99,1)<>"Y" AND POS(A$(9,1)="SICN")<>0 THEN RUN "QS2DAH"
2808 X$="F1-F1 Lookup will show Custom Item Masters for this Customer"
2810 GOSUB 8100; CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,1,6,10,10,C0,"","{3"+X$,B$(10,10),"QS2DAB32","FM1","",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2810,2811
2812 GOSUB 8125
2814 IF ABS(C0)=4 THEN Q8$=""; IF POS(" "<>A$(10,10))=0 THEN GOTO 6500 ELSE GOTO 2020
2816 IF POS(" "<>A$(10,10))=0 THEN GOTO 2810
2820 IF A$(99,1)="Y" THEN GOSUB 5000
2840 GOTO 2020
2850 REM "Cost U/M
2854 IF POS(A$(9,1)="M")<>0 THEN GOTO 2020
2855 J1$=E$(9,4),J0=U0,J5=E[0]
2860 CALL "ZZENTR","SUX",E{ALL},E$,X4$,X3$,7,11,9,4,C0,"","{3"+X$,"U/M","QS2DAB34","U/M","ZZ2MUA",""
2863 FIND (Z[13],KEY="U/M"+E$(9,4),DOM=2860)IOL=0420
2865 IF E$(9,4)=J1$ AND POS(" "<>J1$)<>0 THEN GOTO 2890
2875 GOSUB 7600
2880 IF J5<>E[0] THEN GOSUB 8600
2890 GOTO 2020
2900 REM "Cost Qty per unit
2905 IF U$(20,1)="Y" OR POS(A$(9,1)="M")<>0 THEN GOTO 2020 ELSE J0=U0,J5=E[0]
2910 CALL "ZZENTR","N",E{ALL},A$,X4$,X3$,12,11,0,501,C0,M0$,"{3"+X$,"","QS2DAB36","","",""
2914 IF E[0]=0 THEN GOTO 2910
2915 IF J0<>E[0] THEN U0=E[0]; GOSUB 7650
2916 IF J5<>E[0] THEN GOSUB 8600
2940 GOTO 2020
3000 REM "Quoted cost
3005 IF POS("Y"=U$(21,1)+C1$(61,1)+A$(99,1))<>0 OR POS(A$(9,1)="M")<>0 THEN GOTO 2020
3010 CALL "ZZENTR","NX",E{ALL},A$,X4$,X3$,33,11,25,621,C0,M3$,"{3"+X$,"","QS2DAB38","","",""
3015 IF C0>0 THEN GOSUB 7800; GOSUB 7700
3040 GOTO 2020
3050 REM "Quoted cost extension
3054 IF A$(9,1)="S" AND C1$(61,1)="Y" THEN GOTO 3056
3055 IF U$(21,1)<>"Y" AND C1$(61,1)<>"Y" OR POS(A$(9,1)="M")<>0 THEN GOTO 2020
3060 CALL "ZZENTR","NX",E{ALL},A$,X4$,X3$,44,11,26,822,C0,M4$,"{3"+X$,"","QS2DAB40","","",""
3065 IF C0>0 THEN GOSUB 7700
3090 GOTO 2020
3100 REM "Fixed price?
3105 IF POS(A$(9,1)="M")<>0 THEN GOTO 2020
3110 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,77,11,101,1,C0,"","{3"+X$,"","QS2DAB42","","",""
3140 GOTO 2020
3200 REM "Estimate worksheet - NOT CURRENTLY USED
3204 IF A$(99,1)<>"Y" AND A$(9,1)<>"N" THEN GOTO 3210
3205 IF N$="Y" THEN GOTO 2020
3210 IF POS(A$(9,1)="MS")=0 THEN L0=2; RUN "QS2DAK"
3225 REM "Return from QS2DAK
3240 GOTO 2020
3250 REM "Carton pack
3255 IF A$(99,1)<>"Y" AND POS(A$(9,1)="MS")<>0 THEN GOTO 2020
3260 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,12,12,24,500,C0,M0$,"{3"+X$,"","QS2DAB36","","",""
3290 GOTO 2020
3700 REM "Job Notes SSP 185579
3705 RFQ_NO$=MID(A1$,1,8)
3710 CALL "ZZGMBA",X3$,X4$,"R",RFQ_NO$
3795 GOTO 1800
3799 ! ******************************************************
5000 REM "Do forms modify/setup
5002 IF FMS_PARM$(283,1)="Y" THEN CALL "FS2DAN",X3$,B$(10,10)+A$(10,10),14
5005 DIM C[31],C$(325)
5010 FIND (Z[7],KEY=A1$,DOM=5040)IOL=0330; C$=C$(12)
5020 GOSUB 8000
5023 CALL "ZZPROM","10",X3$,Z,"Modify RFQ item master before proceeding?","","",0; ON Z GOTO 5050,5024
5030 RETURN 
5040 CALL "ZZPROM","Y",X3$,Z,"Do you wish to set up this RFQ item?","","",0
5045 ON Z GOTO 5048,5047
5047 EXITTO 2810
5048 GOSUB 5200
5050 REM "Run forms setup
5060 U1$=X0$+STR(LEN(A1$)+1:"00")+A1$+"*"+U1$
5062 IF POS(" "<>A$(41,40))=0 THEN Q4$=B$(10,10)+A$(10,10)+A$(10,10)+" - "+C$(42,40) ELSE Q4$=B$(10,10)+A$(10,10)+A$(10,10)+" - "+A$(41,40)
5063 U1$="FM2OB6"+STR(LEN(Q4$)+LEN(A1$)+1:"00")+"*"+A1$+Q4$+U1$
5070 U1$="FM2IAA"+STR(LEN(A1$)+21:"00")+"*"+A1$+B$(10,10)+A$(10,10)+U1$
5090 Q2$=U1$(1,6)
5092 WRITE (Z[1],KEY=A1$)IOL=0310
5093 WRITE (Z[5],KEY=A1$)IOL=0350
5094 PRINT @(0,3),'CE',; GOSUB 9700
5200 REM "Transfer from another customer?"
5204 DIM N$(20),N0$(100),C$(325),C[31]
5205 GOSUB 5390
5206 REM "Customer Code
5207 C7=1,N0=1,X$="Press spacebar then enter key to bypass copy feature"
5208 IF ABS(C0)<>2 THEN N$(1,10)=B$(10,10)
5209 %PORC_FLG$=B$(391,1) ! SSP204915 jdf
5210 IF B$(391,1)="T" THEN CALL "ZZENTR","UX",A{ALL},N$,X4$,X3$,30,12,1,10,C0,"A/R","{3"+X$,"","FM2ODB03","AR1","","" ELSE CALL "ZZENTR","AXU",A{ALL},N$,X4$,X3$,30,12,1,10,C0,"A/R","{3"+X$,"","FM2ODB03","AR1","",""; END_IF ; IF ABS(C0)>4 THEN GOSUB 6400; GOSUB 5390; ON C0 GOTO 5210,5211 ! SSP204915 jdf        
5215 IF POS(" "<>N$(1,10))=0 THEN EXITTO 5050
5220 FIND (Z[8],KEY=N$(1,10),DOM=5210)N0$
5225 PRINT @(42,12),N0$(11,35),
5250 REM "Item code
5255 C0$=N$(1,10),C7=2,N0=1
5257 IF POS(" "<>N$(11,10))=0 THEN N$(11,10)=A$(10,10)
5260 CALL "ZZENTR","SUX",A{ALL},N$,X4$,X3$,30,13,11,10,C0,"","{3"+X$,C0$,"FM2ODB13","FM1","",""; IF ABS(C0)>4 THEN GOSUB 6400; GOSUB 5390; ON C0 GOTO 5260,5261
5265 IF C0=-2 THEN GOTO 5206 ELSE IF POS(" "<>N$(11,10))=0 THEN EXITTO 5050
5270 FIND (Z[12],KEY=N$,DOM=5260)IOL=0330
5275 PRINT @(42,13),C$(42,40),
5300 REM "Convert to new & write out
5310 C$(1,20)=B$(10,10)+A$(10,10),C[31]=0
5312 FOR I=5 TO 6; C[I]=0; NEXT I
5314 FOR I=19 TO 28; C[I]=0; NEXT I
5316 IF MID(P8$,7,1)<>"Y" THEN GOTO 5328
5318 FOR I=8 TO 17; C[I]=0; NEXT I
5320 C[29]=0,C[30]=0
5322 C$(109,6)="",C$(126,47)="",C$(185)=""
5328 C$=A1$+C$; WRITE (Z[7],KEY=A1$)IOL=0330; C$=C$(12)
5330 GOSUB 8300
5350 GOTO 5050
5380 RETURN 
5390 PRINT @(0,11),'CE',@(0,12),"Copy this item from customer:",@(24,13),"item:",
5391 CALL "ZZDISP","A",N$(1,10),"A/R",X3$,"","",30,12,X4$
5392 PRINT @(42,12),N0$(11,35),@(24,13),"item:",@(30,13),N$(11,10),@(42,13),C$(42,40),
5395 RETURN 
5800 REM "Auxiliary reads
5810 FIND (Z[2],KEY=A$(150,8),DOM=5811)IOL=0320
5820 FIND (Z[4],KEY=A$(81,10),DOM=5821)IOL=0340
5830 DIM E2$(130); FIND (Z[6],KEY="P"+A$(81,14),DOM=5831)IOL=0360
5835 FIND (Z[7],KEY=A$(150,8)+A$(6,3),DOM=5836)IOL=0330; C$=C$(12)
5845 RETURN 
6000 REM "BACKGROUND
6010 CALL "QS2DB1",X3$,X4$,0,Z0$,A$,A{ALL},B$,E2$,D$,S0,S1,U0,U1,E$,E{ALL},N$
6190 RETURN 
6200 REM "DISPLAY DATA
6210 CALL "QS2DB1",X3$,X4$,1,Z0$,A$,A{ALL},B$,E2$,D$,S0,S1,U0,U1,E$,E{ALL},N$
6220 RETURN 
6240 CALL "QS2DB1",X3$,X4$,4,Z0$,A$,A{ALL},B$,E2$,D$,S0,S1,U0,U1,E$,E{ALL},N$
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>=0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6455 IF C9<0 THEN GOTO 6445
6460 CALL "QS2DB1",X3$,X4$,2,Z0$,A$,A{ALL},B$,E2$,D$,S0,S1,U0,U1,E$,E{ALL},N$
6490 RETURN 
6500 REM "DELETE
6520 CALL "QS2DEL",X3$,X4$,A1$
6590 GOTO 1630
6600 REM "ALT KEY DATA READS
6690 RETURN 
6700 REM "ADD ENTRY
6705 Q8$=STR(NUM(A$(6,3),ERR=6706)+1:"000"); GOTO 6707
6706 Q8$="001"
6708 IF A$(99,1)="Y" THEN GOTO 7000
6710 WRITE (Z[1],KEY=A1$)IOL=0310
6715 E$(13,8)=A1$(1,8),E$(6,3)=A1$(9,3); REM "SSP148039
6720 WRITE (Z[5],KEY=A1$)IOL=0350
6790 GOTO 1630
6800 REM "NEXT ENTRY IN FILE
6805 ON 10*FPT(C0)+2 GOTO 6850,6806
6810 A1$=KEY(Z[1],END=6895)
6820 IF A1$(1,LEN(Q1$))<>Q1$ THEN GOTO 6895
6825 A$(1,LEN(A1$))=A1$
6830 GOSUB 6600
6835 GOSUB 6450
6840 GOTO 1515
6850 REM PRIOR ENTRY
6855 CALL "ZZKEYP",ERR=6856,Z[1],A1$; GOTO 6820
6860 CALL "ZZKEYL",ERR=6861,Z[1],A1$; GOTO 6820
6870 GOTO 6895
6890 GOTO 1515
6895 PRINT 'RB',; READ (Z[1],KEY=Q1$,DOM=1140); GOTO 1140
7000 REM "Vendor/Cost info
7010 PRINT @(0,3),'CE',
7015 WRITE (Z[1],KEY=A1$)IOL=0310
7017 E$(13,8)=A1$(1,8),E$(6,3)=A1$(9,3); REM "SSP148039
7018 WRITE (Z[5],KEY=A1$)IOL=0350
7020 CALL "QS2DAK",X3$,X4$,"",A$(150,8)+A$(6,3)
7025 PRINT @(0,3),'CE',
7027 READ (Z[1],KEY=A1$)IOL=0310
7028 READ (Z[5],KEY=A1$,DOM=7029)IOL=0350
7040 GOSUB 6000
7045 GOTO 1000
7199 ESCAPE 
7300 REM 
7310 ON FPT(C0)*10 GOTO 7390,7325,7330,7390
7325 IF V8$="" THEN X0=X0+4; GOTO 7390 ELSE X0=NUM(V8$(POS(STR(X0:"00")<=V8$,2),2)); GOTO 7390
7330 IF V8$="" THEN X0=X0-6; GOTO 7335 ELSE X0=POS(STR(X0-1:"00")<=V8$,2)-2; IF X0<0 THEN X0=0; GOTO 7390 ELSE X0=NUM(V8$(X0,2)); GOTO 7390
7335 IF X0<0 THEN X0=0; GOTO 7390
7390 C0=3; RETURN 
7400 REM "Return from Est Cost for non custom forms
7405 N0$="N",R3$="*"
7410 GOTO 7050
7500 REM "Set S0,S1 based on Selling U/M, check for recalc of breaks and price
7501 REM "S0 is qty / and S1 is ext. /
7505 S1=S[0]; IF S$(20,1)<>"Y" THEN S0=A[0] ELSE S0=S[1]; IF S[0]<>0 THEN A[0]=S[0] ELSE A[0]=S[1]
7515 IF S0=0 THEN S0=1
7520 IF S1=0 THEN S1=1
7526 IF A[0]=0 THEN A[0]=1
7527 PRINT @(12,10),A[0]:M0$,
7530 IF A$(99,1)<>"Y" AND S0<>J0 THEN GOSUB 7550
7540 RETURN 
7550 REM "Recalc Selling price based on new U/M
7560 IF A[1]<>0 THEN A[17]=A[18]*S1/(A[1]/S0)
7570 PRINT @(19,10),A[1]/S0:M4$,@(33),A[17]:M3$,
7590 RETURN 
7600 REM "Set U0,U1 based on Cost U/M, check for recalc of breaks and price
7601 REM "U0 is qty / and U1 is ext. /
7605 U1=U[0]; IF U$(20,1)<>"Y" THEN U0=E[0] ELSE U0=U[1]; IF U[0]<>0 THEN E[0]=U[0] ELSE E[0]=U[1]
7615 IF U0=0 THEN U0=1
7620 IF U1=0 THEN U1=1
7626 IF E[0]=0 THEN E[0]=1
7627 PRINT @(12,11),E[0]:M0$
7630 IF A$(99,1)<>"Y" AND U0<>J0 THEN GOSUB 7650
7640 RETURN 
7650 REM "Recalc Cost  based on new U/M
7660 IF A[1]<>0 THEN E[25]=E[26]*U1/(A[1]/U0)
7670 PRINT @(19,11),A[1]/U0:M4$,@(33),E[25]:M3$,
7690 RETURN 
7700 REM "Calc & display gross profit
7701 REM "Code also in QS2DB1
7705 IF A[18]=0 THEN PRINT @(59,10),'CL',; GOTO 7740
7710 G0=A[18]-E[26]
7715 G1=G0*100/A[18]
7720 PRINT @(59,10),G0:M3$,@(70),G1:"-###.00%",
7740 RETURN 
7750 REM "Figure selling ext
7760 IF S$(21,1)<>"Y" THEN A[18]=A[1]/S0*A[17]/S1
7765 PRINT @(44,10),A[18]:M4$,
7790 RETURN 
7800 REM "Figure cost ext
7810 IF U$(21,1)<>"Y" THEN E[26]=A[1]/S0*E[25]/S1
7815 PRINT @(44,11),E[26]:M4$,
7840 RETURN 
8000 REM "Default custom forms
8020 A$(20,61)=C$(21,61),A[24]=C[0]
8022 IF A$(95,4)="    " THEN A$(95,4)=C$(100,4),A[0]=C[4]
8023 IF E$(9,4)="    " THEN E$(9,4)=C$(96,4),E[0]=C[2]
8027 GOSUB 6200; X0=X0+7
8040 RETURN 
8050 REM "SYNC QSB and QS1 AND QS2 for custom forms
8055 IF A$(99,1)<>"Y" OR POS(" "<>A2$)=0 THEN GOTO 8090
8057 READ (Z[7],DOM=8090,KEY=A1$)IOL=0330; C$=C$(12)
8060 C$(11,71)=A$(10,71),C[0]=A[24]
8065 C$=A1$+C$; WRITE (Z[7],KEY=A1$)IOL=0330
8070 IF A2$(21,19)+A2$(40,2)=A$(21,19)+A$(40,2) THEN GOTO 8090
8075 REMOVE (Z[9],KEY=A2$(21,19)+A2$(40,2)+A1$,DOM=8076)
8080 WRITE (Z[9],KEY=A$(21,19)+A$(40,2)+A1$)
8090 RETURN 
8100 REM SET EXISTING INFO
8110 A2$=A$(10,71)
8120 RETURN 
8125 REM CHECK FOR CHANGES
8130 IF A2$<>A$(10,71) THEN GOSUB 8050
8140 RETURN 
8200 REM "Display Vendor, Plant name
8210 CALL "QS2DB1",X3$,X4$,3,Z0$,A$,A{ALL},B$,E2$,D$,S0,S1,U0,U1,E$,E{ALL},N$
8240 RETURN 
8300 REM "Copy records for item copy, keep Z(1) open to write out stuff
8310 Z$="02C QSA...  03C FMP...  04C AP4...  05C QSC...  06C FM0...  09C FE1...  10C IC0...  11C IC2...  12C FM1...  02O FMS...  03O FMU...  04O FMV...  05O FSF...  06O QS2...  09O QSS...  10O QSU...  11O QSV...  12O QSF...  "
8315 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 8316,9900
8319 REM "Write out to QS2 file
8320 WRITE (Z[6],KEY=C$(21,3)+C$(24,16)+C$(40,2)+A1$)
8325 FOR I=2 TO 5
8327 J=I+7
8330 GOSUB 8350
8335 NEXT I
8340 RETURN 
8350 REM "Transfer records with key N$ in file Z(I) to file Z(J) with a key of A1$
8355 EXTRACT (Z[I],KEY=N$,DOM=8356)
8357 K$=KEY(Z[I],END=8380)
8358 IF MID(K$,1,LEN(N$))<>N$ THEN GOTO 8380
8360 READ RECORD (Z[I],END=8380)A8$
8365 A8$(1,20)=B$(10,10)+A$(10,10)
8370 A8$=A1$+A8$; IF J=9 OR J=12 THEN WRITE RECORD (Z[J],KEY=A1$)A8$ ELSE WRITE RECORD (Z[J],KEY=A8$(1,34))A8$
8373 READ (Z[I],KEY=K$,END=8380)
8375 GOTO 8357
8390 RETURN 
8400 REM "Vendor/Plant changed on inventory item
8405 IF POS(A$(9,1)="IC")=0 THEN RETURN 
8407 IF A$(9,1)="C" THEN J7$=B$(10,10) ELSE DIM J7$(10)
8409 DIM I[19]; FIND (Z[10],KEY=J7$+A$(10,10),DOM=8410)IOL=0430
8410 DIM L$(115),L[30]; FIND (Z[11],KEY=J7$+A$(10,10)+A$(81,14),DOM=8411)IOL=0440 ! WO273055
8411 E$(9,4)=L$(55,4),E[0]=L[14]
8412 FIND (Z[13],KEY="U/M"+E$(9,4),DOM=8413)IOL=0420
8413 GOSUB 7600
8415 CALL "QS2DAI",A{ALL},E{ALL},I{ALL},L{ALL},S0*S1,U0*U1,"C"
8420 GOSUB 6200
8440 RETURN 
8500 REM "Return from item setup, set Q1$ right, position properly
8505 Q1$=Q1$(1,LEN(Q1$)-1)
8507 A1$=Q1$
8510 READ (Z[1],KEY=Q1$,DOM=1038)IOL=0310
8511 READ (Z[5],KEY=Q1$,DOM=8512)IOL=0350
8512 Q1$=Q1$(1,LEN(Q1$)-3)
8515 GOSUB 5800
8530 GOSUB 8000
8540 C0=0,X0=10,Z9=0
8545 GOTO 2040
8600 REM "Adjust QSD values if cost U/M changed
8605 Z$="10C IC0...  10O QSD...  "
8610 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 8611,8695
8615 DIM M$(288),M[35] ! WO229740
8620 READ (Z[10],KEY=A$(150,8)+A$(6,3),DOM=8621)
8625 K$=KEY(Z[10],END=8680)
8630 IF K$(1,11)<>A$(150,8)+A$(6,3) THEN GOTO 8680
8635 READ (Z[10],KEY=K$,DOM=8625)IOL=0460
8640 FOR I=1 TO 5
8645 IF M[I]<>0 THEN M[I]=M[I]*E[0]/J5
8650 NEXT I
8660 WRITE (Z[10],KEY=K$)IOL=0460
8670 GOTO 8625
8685 Z$="10C QSD...  10O IC0...  "
8690 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
8695 RETURN 
8900 REM "
8910 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
8950 REM "Program flow logic
8960 DIM U0$(6); U0$(1)=FID(0); U0$=U0$+"PF"
8970 CLOSE (14); OPEN (14)"ZZPARM"; FIND (14,KEY=U0$,DOM=8990)U0$,U1$
8980 Q1=NUM(U1$(7,2)),Q1$=U1$(9,Q1),U1$=U1$(Q1+9)
8990 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9600 REM "RUN ESTIMATE PROGRAM
9700 REM "PROG FLOW
9710 IF U1$="" THEN REMOVE (Z[13],KEY=U0$,DOM=9900); GOTO 9900
9720 WRITE (Z[13],KEY=U0$)U0$,U1$
9730 RUN U1$(1,6)
9800 REM "EXIT PROGRAM
9810 IF U0$>"" THEN GOTO 9700
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 REM "204915-RFQ - setting up a new form and customer code is not        
56002 REM "229740-Create RFQ Working Days field, collect online from vendors
56003 REM "273055-Expand IC2 for 6 additional cost breaks, allow entry in GUI 
