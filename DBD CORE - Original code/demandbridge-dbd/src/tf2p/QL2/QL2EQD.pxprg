0010 ! QL2EQD - XML Full Replacement Data upload from DBD to EQD for QNET customers
0035 REM "5.7 - 06/05/23 - 15.630505 - jvv - SSP# 307387
0037 REM "307387-EQLink DBD Bridge to Qnet                                   
0040 REM "Copyright 2023 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! BEGIN 
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,CUSTLIST$,CNS_FLG$,VIA_FLG$,TAX_FLG$,CAT_FLG$,GEN_STK_FLG$
0100 SETERR 9000
0102 GOSUB SET_READONLY
0110 X0$="QL2EQD",X1$="XML upload to EQD"
0120 %GUI=1
0130 ! PRINT 'CS',@(0,3),"Creating XML files "
0140 GOTO 0300
0163 X2=-1; X0=-1
0165 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2
0300 ! IO list
0310 DIM AR1[15],FS1[13],FS2[29]
0315 DIM FMPD$(300),FMPD[6]
0320 DIM FMPM$(241),FMPM[11]
0325 ! iolist for customer information
0330 AR1_IOL:IOLIST AR1$,AR1[0],AR1[1],AR1[2],AR1[3],AR1[4],AR1[5],AR1[6],AR1[7],AR1[8],AR1[9],AR1[10],AR1[11],AR1[12],AR1[13],AR1[14],AR1[15]
0335 ! iolist for Order
0340 IOLIST FS1$,FS1[0],FS1[1],FS1[2],FS1[3],FS1[4],FS1[5],FS1[6],FS1[7],FS1[8],FS1[9],FS1[10],FS1[11],FS1[12],FS1[13]
0345 IOLIST FS2$,FS2[0],FS2[1],FS2[2],FS2[3],FS2[4],FS2[5],FS2[6],FS2[7],FS2[8],FS2[9],FS2[10],FS2[11],FS2[12],FS2[13],FS2[14],FS2[15],FS2[16],FS2[17],FS2[18],FS2[19],FS2[20],FS2[21],FS2[22],FS2[23],FS2[24],FS2[25],FS2[26],FS2[27],FS2[28],FS2[29]
0350 IOLIST FM0$(1)
0355 FMPD_IOL:IOLIST FMPD$(1),FMPD{ALL}
0360 FMPM_IOL:IOLIST FMPM$(1),FMPM{ALL} ! Freight Markup
0365 IC0_IOL:IOLIST IC0$,IC0{ALL}
0370 FM1_IOL:IOLIST FM1$,FM1{ALL}
0372 FM1U_IOL:IOLIST FM1U$,FM1U{ALL}
0375 IC1_IOL:IOLIST IC1$,IC1{ALL}
0380 FSW_IOL:IOLIST FSW$,FSW{ALL}
0385 FM5_IOL:IOLIST FM5$,FM5{ALL}
0390 FM3_IOL:IOLIST FM3$,FM3{ALL}
0395 FM4_IOL:IOLIST FM4$,FM4{ALL}
0400 KT0_IOL:IOLIST KT0$,KT0{ALL}
0500 REM "Open files
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O AR1...  02O FM0...  03O IC1...  040 FS1...  05O FM1...  06O FS2...  13O ZZPARM  07O IC0...  08O FMP...  09O PO1...  10O FM5...  11O ASW...  12O FSW...  14O FM3...  15O FM4...  16O AR3...  17O PO3...  18O AR5...  19O KT0...  20O CD0...  21O ECR...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0550 FM1_CHL=UNT; OPEN (FM1_CHL,IOL=*)"FM1"+%C$
0555 FM3_CHL=UNT; OPEN (FM3_CHL,IOL=*)"FM3"+%C$
0700 ! Set Variable
0710 XHDG$="EQLINK"
0720 RPLC$="Y"
0730 OTHF$="N"
0800 ! Determine User Defined Fields for QNET - No longer being used
0820 QLPARAM$=""; FIND (Z[13],KEY=%C$+"Q/L",DOM=*NEXT)QLPARAM$
0830 OSPARAM$=""; FIND (Z[13],KEY=%C$+"OSP",DOM=*NEXT)OSPARMS$
0835 PRINT @(0,19),'CL'
0840 READ (Z[13],KEY="STAT"+"F/M")F9$,F0
0900 IF STP(CUSTLIST$,2)="" THEN GOSUB OTHER_FILES; GOTO 9900
1000 ! Routine to read data FROM panel for selected QNET CUSTOMERS
1010 ! Process panel and get CUSTLIST$ with only QNET customers
1022 ZZ=LEN(CUSTLIST$)/10
1025 RPLC$="Y" ! If RPLC$="Y" then send ALL record, If RPLC$="N",only send changes
1030 FOR CX=1 TO ZZ
1040 CUST$=CUSTLIST$(CX*10-9,10)
1100 READ (Z[1],KEY=CUST$,DOM=1280)IOL=AR1_IOL
1130 CUSTID$=CUST$
1135 ECUST$=MID(AR1$,564,6)
1140 READ (Z[8],KEY="M"+FMPD$(50,2),DOM=*NEXT)IOL=FMPM_IOL ! SSP 206525
1160 HEADER$="",TF_VALUE$="",CCNT=0,CHDR$="",CDTL$="",SHDR$="",SDTL$=""
1180 XDIV$=MID(CUST$,1,2)
1200 XFILE$=STP(ECUST$,2),XFTYPE$="_FullReplace"; GOSUB CREATE_XML_FILE ! File created per customer selected"
1205 PRINT @(20,19),"Processing Customer: ",ECUST$
1210 RPLC$="Y"; GOSUB XML_ALL_DATA
1230 GOSUB END_XML_FILE
1280 NEXT CX
1285 GOSUB OTHER_FILES
1290 GOTO 9900
1299 ! 
1400 OTHER_FILES:
1402 PRINT @(0,19),'CL'
1405 ! CNS_FLG$="Y",VIA_FLG$="Y",TAX_FLG$="N"
1410 OSTR$=CNS_FLG$+VIA_FLG$+TAX_FLG$+GEN_STK_FLG$
1420 IF POS("Y"=OSTR$)=0 THEN RETURN 
1430 XFILE$="OTHER",XFTYPE$=""; OTHF$="Y"; GOSUB CREATE_XML_FILE; OTHF$="N" ! XML file for tables
1440 PRINT @(20,19),"Processing Master Files"
1450 IF CNS_FLG$="Y" THEN GOSUB CNS_XML
1460 IF VIA_FLG$="Y" THEN GOSUB SHIPVIA_XML
1470 IF TAX_FLG$="Y" THEN GOSUB TAX_XML
1475 IF GEN_STK_FLG$="Y" THEN GOSUB GITEM_XML
1480 GOSUB END_XML_FILE
1485 PRINT @(0,19),'CL'
1500 RETURN 
1599 ! 
2000 XML_ALL_DATA:! Create XML DATA
2030 GOSUB CUST_XML ! 10000
2040 GOSUB SHIPTO_XML ! 11000
2050 GOSUB ITEM_XML ! 12000
2060 GOSUB CC_USAGE_XML ! 1500
2065 FIRSTOO=0; GOSUB OPEN_ORDER_XML
2068 ! GOSUB TRACKING_XML- Now done through Flowpoint
2070 IF CAT_FLG$="Y" THEN GOSUB SUPPLY_CATALOG_XML
2080 RETURN 
2099 ! 
3000 CREATE_XML_FILE:
3005 ! Create New XML document 
3010 DTS$=DTE(0:"%Yl%Mz%Dz%Hz%mz%s") ! add date/time
3015 QDIR$=STP(MID(QLPARAM$,1,30),2)
3020 IF QDIR$="" THEN QDIR$="/tmp"
3022 ! All general files are stored in main directory. Customer files are by division
3025 IF OTHF$<>"Y" THEN QDIR$=QDIR$+"/"+XDIV$
3030 TMP$=QDIR$+"/"+XFILE$+"_"+DTS$+XFTYPE$+".xml"
3040 SERIAL TMP$,ERR=*NEXT; GOTO OPEN_XML_FILE
3050 IF ERR=12 AND UCS(MID(TMP$,1,5))<>"[WDX]" THEN INVOKE "mkdir -p "+QDIR$+" >/dev/null"; SERIAL TMP$,ERR=*NEXT ! try to create needed directories
3060 OPEN_XML_FILE:
3065 TMP=HFN; OPEN LOCK (TMP)TMP$
3070 PRINT (TMP)"<?xml version="+QUO+"1.0"+QUO+" standalone="+QUO+"yes"+QUO+"?>"
3080 PRINT (TMP)"<"+XHDG$+">"
3090 RETURN 
3099 ! 
3100 END_XML_FILE:
3110 PRINT (TMP)"</"+XHDG$+">"
3120 CLOSE (TMP)
3140 RETURN 
3190 ! 
3599 ! 
3700 CHECK_VALID_ITEM:
3705 VI=0
3710 FM1KY$=CUST$+OOITEM$
3715 CIC_ITEM$=""
3720 FIND (FM1_CHL,KEY=FM1KY$,DOM=END_VALID_ITEM)FM11$
3725 CIC_ITEM$=STP(MID(FM11$,350,20),2)
3730 ! IF POS(MID(FM11$,198,1)="Y")=0 THEN GOTO END_VALID_ITEM
3750 VI=1
3760 END_VALID_ITEM:RETURN 
3769 ! 
5000 XML:
5020 HTML_TO_FLD$=HEADER$
5030 TF_VALUE$=TF_VALUE$+$09$
5090 XX=POS($09$=TF_VALUE$,-1),TF_VALUE$=TF_VALUE$(1,XX-1),XX=POS($09$=TF_VALUE$,-1),REC_KEY$=TF_VALUE$(XX+1),TF_VALUE$=TF_VALUE$(1,XX)
5100 REC_KEY$=SUB(SUB(SUB(SUB(SUB(REC_KEY$,"<","&lt;"),">","&gt;"),"&","&amp;"),"'","&apos;"),QUO,"&quot;")
5110 YES=0
5120 XX=POS(CHR(127)<=REC_KEY$); IF XX<>0 THEN YES=1,TC$=REC_KEY$(XX,1); REC_KEY$=SUB(REC_KEY$,TC$,"&#"+STR(ASC(TC$))+";"); GOTO *SAME
5140 B_HEADER$=HEADER$,B_HTML_TO_FLD$=HTML_TO_FLD$
5150 NXT_FLD: VAL1=POS($09$=TF_VALUE$); IF VAL1=0 THEN GOTO END_REC ELSE VAL1$=TF_VALUE$(1,VAL1-1),TF_VALUE$=TF_VALUE$(VAL1+1)
5160 VAL1=POS($09$=HTML_TO_FLD$); IF VAL1=0 THEN CONTINUE ELSE VAL2$=HTML_TO_FLD$(1,VAL1-1),HTML_TO_FLD$=HTML_TO_FLD$(VAL1+1)
5170 VAL1=POS($09$=HEADER$); IF VAL1=0 THEN CONTINUE ELSE VAL3$=HEADER$(1,VAL1-1),HEADER$=HEADER$(VAL1+1)
5180 VAL3$=SUB(SUB(SUB(SUB(SUB(VAL3$,"<","&lt;"),">","&gt;"),"&","&amp;"),"'","&apos;"),QUO,"&quot;")
5185 IF TP=1 OR TP=2 THEN GOTO 5205
5190 VAL1$=SUB(SUB(SUB(SUB(SUB(VAL1$,"<","&lt;"),">","&gt;"),"&","&amp;"),"'","&apos;"),QUO,"&quot;")
5200 IF YES THEN XX=POS(CHR(127)<=VAL1$); IF XX<>0 THEN YES=1,TC$=VAL1$(XX,1); VAL1$=SUB(VAL1$,TC$,"&#"+STR(ASC(TC$))+";"); GOTO *SAME
5205 IF TP=1 THEN PRINT (TMP)DIM(GL)+"<"+VAL2$+DIM(1)+VAL1$+">"; GOTO NXT_FLD
5208 IF TP=2 THEN PRINT (TMP)DIM(GL)+"<"+VAL2$+DIM(1)+VAL1$+"/>"; GOTO NXT_FLD
5210 PRINT (TMP)DIM(GL)+"<"+VAL2$+">"+STP(VAL1$)+"</"+VAL2$+">"
5220 GOTO NXT_FLD
5230 END_REC:
5250 HEADER$="",HTML_TO_FLD$="",TP=0
5260 RETURN 
5290 ! 
5300 START_XML_SECTION:
5310 PRINT (TMP)DIM(3)+"<"+SECTION$+">"
5315 RETURN 
5318 ! 
5320 END_XML_SECTION:
5330 PRINT (TMP)DIM(3)+"</"+SECTION$+">"
5335 RETURN 
5339 ! 
5350 END_GROUP:
5360 PRINT (TMP)DIM(GP)+"</"+GHDG$+">"
5365 RETURN 
5370 ! 
5500 START_GRP:
5510 PRINT (TMP)DIM(GP)+"<"+GHDG$+">"
5550 RETURN 
5559 ! 
7151 FNX:
7152 DEF FNX$(LOCAL X$)
7165 TRANSLATE X$,"&"+$05$+"&amp;"+"<"+$04$+"&lt;"+">"+$04$+"&gt;"+QUO+$06$+"&quot;"+"'"+$06$+"&apos;" ! SSP247374, fix for apostrophe
7170 RETURN X$
7195 END DEF
7199 ! 
8500 SET_READONLY:REM "Set the PRM READONLY to on
8510 SAVE_XI=PRM('XI'); SET_PARAM 'XI' ! Ignore exclusive locks, save previous setting
8525 SET_READONLY_END:RETURN 
8530 CLEAR_READONLY:REM "Restore previous setting
8535 SET_PARAM 'XI'=SAVE_XI ! restore previous setting
8545 CLEAR_READONLY_END:RETURN 
8910 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8999 ! 
9000 REM "errors
9005 PRINT @(0,20),'CL',"ERR=",ERR," LINE=",TCB(5),; INPUT *
9010 EXIT ERR
9900 REM "END PROGRAM
9905 SETERR 9910; GOSUB CLEAR_READONLY
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9915 CLOSE (FM1_CHL,ERR=*NEXT)
9918 CLOSE (FM3_CHL,ERR=*NEXT)
9930 EXIT 
9999 END 
10000 CUST_XML:
10010 ! Create XML for Customer Data
10020 ALPHA$=AR1$(155,10),CUST_NAME$=AR1$(11,35),ADDR1$=AR1$(56,30),ADDR2$=AR1$(86,30),CITY$=AR1$(116,16),STATE$=AR1$(132,2),COUNTRY$="US"
10025 PHONE$=AR1$(205,14),ZIP$=AR1$(134,9)
10030 PARENTID$=""
10035 CNS$=AR1$(278,4)
10038 FK$="D"+CUST$; FIND (Z[8],KEY=FK$,DOM=*NEXT)FMPD$
10040 FY$=FMPD$(52,4),ACCTPD$=FMPD$(56,2)
10042 BEGINMTH$=""; SP$="E"+CUST$+FY$; FIND (Z[8],KEY=SP$,DOM=*NEXT)FISCYR$; BEGINMTH$=FISCYR$(26,2) ! Month of starting fisal perios
10045 DUNS$="" ! From XP4 if we have it
10048 READ (Z[8],KEY="M"+FMPD$(50,2),DOM=*NEXT)IOL=FMPM_IOL ! SSP 206525
10050 TAX$=AR1$(245,1)
10052 CSTATUS$=AR1$(219,1) ! A=Active, S=RetainData/Delete I=ClearData/Delete
10055 DELCUST$="N"; IF CSTATUS$="S" OR CSTATUS$="I" THEN CINACTIVE$="Y" ELSE CINACTIVE$="N"
10060 FRT_AMT$=STR(FMPM[9]),FRT_PCT$=STR(FMPM[0]) ! Use FMPM MIN_AMOUNT_TO_MARKUP
10070 COUNTRY$="US"
10135 CHDR$=CHDR$+"NAME"+$09$,CDTL$=CDTL$+CUST_NAME$+$09$
10140 CHDR$=CHDR$+"ADDR_1"+$09$,CDTL$=CDTL$+ADDR1$+$09$
10145 CHDR$=CHDR$+"ADDR_2"+$09$,CDTL$=CDTL$+ADDR2$+$09$
10150 CHDR$=CHDR$+"CITY"+$09$,CDTL$=CDTL$+CITY$+$09$
10155 CHDR$=CHDR$+"STATE"+$09$,CDTL$=CDTL$+STATE$+$09$
10160 CHDR$=CHDR$+"ZIP"+$09$,CDTL$=CDTL$+ZIP$+$09$
10165 CHDR$=CHDR$+"COUNTRY"+$09$,CDTL$=CDTL$+COUNTRY$+$09$
10170 CHDR$=CHDR$+"PHONE"+$09$,CDTL$=CDTL$+PHONE$+$09$
10175 IF CINACTIVE$="Y" THEN CHDR$=CHDR$+"INACTIVE"+$09$,CDTL$=CDTL$+CINACTIVE$+$09$
10180 ! HEADER$=HEADER$+"PARENT ID"+$09$,TF_VALUE$=TF_VALUE$+PARENTID$+$09$
10205 ! CHDR$=CHDR$+"DUNS"+$09$,TF_VALUE$=TF_VALUE$+DUNS$+$09$
10210 ! HEADER$=HEADER$+"FREIGHT MARKUP"+$09$,TF_VALUE$=TF_VALUE$+FRT_AMT$+$09$
10215 IF AR1$(254,1)="Y" THEN HEADER$=HEADER$+"TAXEXEMPT"+$09$,CDTL$=CDTL$+AR1$(245,1)+$09$; GOSUB XML
10235 ! HEADER$=HEADER$+"SUPPLY_CAT_PLANS"+$09$,TF_VALUE$=TF_VALUE$+SUPPLY_CAT$+$09$
10299 ! 
10300 PRINT_CUST_XML:
10310 HEADER$="CLIENT_SECTION"+$09$,TF_VALUE$="Replace="+QUO+"N"+QUO+$09$; TP=1,GL=3; GOSUB XML
10320 HEADER$="CLIENT"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(ECUST$,2))+QUO+" Alpha="+QUO+FNX$(STP(ALPHA$,2))+QUO+" Delete="+QUO+FNX$(STP(DELCUST$,2))+QUO+$09$; TP=1,GL=5; GOSUB XML
10330 HEADER$=CHDR$,HTML_TO_FLD$=HEADER$; TF_VALUE$=CDTL$,XCOUNT=1; GL=7; GOSUB XML
10335 HEADER$="CNS"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(CNS$,2))+QUO+$09$; TP=2,GL=7; GOSUB XML
10340 HEADER$="FISCAL"+$09$; TF_VALUE$="Year="+QUO+FNX$(STP(FY$,2))+QUO+" Period="+QUO+FNX$(STP(ACCTPD$,2))+QUO+" BeginMonth="+QUO+FNX$(STP(BEGINMTH$,2))+QUO+$09$; TP=2,GL=7; GOSUB XML
10350 HEADER$="FREIGHT_MARKUP"+$09$,TF_VALUE$="FlatAmount="+QUO+FNX$(STP(FRT_AMT$,2))+QUO+" Percent="+QUO+FNX$(STP(FRT_PCT$,2))+QUO+" PercentIsMargin="+QUO+FNX$(STP("0",2))+QUO+$09$; TP=2; GL=7; GOSUB XML
10352 IF TAX$="Y" THEN HEADER$="TAX_EXEMPT"+$09$,TF_VALUE$=""+$09$; TP=2; GL=7; GOSUB XML ! Only print if customer is tax exempt
10360 HEADER$="PAYVIA"+$09$,TF_VALUE$="Invoice="+QUO+"Y"+QUO+" Mc="+QUO+"Y"+QUO+" Amex="+QUO+"Y"+QUO+" Visa="+QUO+"Y"+QUO+" Discover="+QUO+"Y"+QUO+$09$; TP=2; GL=7; GOSUB XML
10362 HEADER$="SHIPVIA"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(FMPD$(45,1),2))+QUO+$09$; TP=2,GL=7; GOSUB XML
10364 IF AR1$(484,10)=DIM(10) THEN GOTO *NEXT ELSE FIND (Z[20],KEY=AR1$(484,10),DOM=*NEXT)CD0$; HEADER$="MERCHANT"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(AR1$(484,10),2))+QUO+" Type="+QUO+FNX$(STP(CD0$(41,10),2))+QUO+$09$; TP=2,GL=7; GOSUB XML
10365 HEADER$="COUNTRIES"+$09$; TF_VALUE$="Default="+QUO+"US"+QUO+$09$; TP=1,GL=7; GOSUB XML
10368 HEADER$="CO"+$09$; TF_VALUE$="US"+$09$; GL=9; GOSUB XML
10369 GHDG$="COUNTRIES"; GP=7; GOSUB END_GROUP
10370 GHDG$="CLIENT"; GP=5; GOSUB END_GROUP
10380 SECTION$="CLIENT_SECTION"; GOSUB END_XML_SECTION
10390 RETURN 
10399 ! 
11000 SHIPTO_XML:
11002 ! Add customer Ship To information
11005 FIRST=0,SSCNT=0
11010 READ (Z[2],KEY="C"+CUST$+"",ERR=*NEXT)
11015 NEXT_FM0:
11018 HEADER$="",TF_VALUE$="",SCNT=0
11020 KS$=KEY(Z[2],END=EXIT_SHIPTO); READ (Z[2],KEY=KS$)FM0$
11030 IF KS$(2,10)<>CUST$ THEN GOTO EXIT_SHIPTO
11035 IF FIRST=0 THEN GOTO *NEXT ELSE GOTO PRINT_SHIPTO
11038 SECTION$="SHIPTO_SECTION"; GOSUB START_XML_SECTION
11040 GRP$="SHIPTOS"; HEADER$="SHIPTOS"+$09$,TF_VALUE$="ClientId="+QUO+FNX$(STP(ECUST$,2))+QUO+" Replace="+QUO+RPLC$+QUO+$09$; TP=1,GL=5; GOSUB XML
11042 FIRST=1
11044 PRINT_SHIPTO:
11045 SHP_DEL$="N"; GOSUB SHIPTO_DATA
11046 HEADER$="",TF_VALUE$="",CCNT=0,CHDR$="",CDTL$="",SHDR$="",SDTL$=""
11048 GOTO NEXT_FM0
11049 ! 
11055 SHIPTO_DATA:
11058 SHPT$=STP(MID(FM0$,382,20),2); IF SHPT$="" THEN SHIPTO$=FM0$(12,4) ELSE SHIPTO$=SHPT$
11060 CUST$=FM0$(2,10),SHIP_NAME$=FM0$(16,35),ADDR1$=FM0$(51,30),ADDR2$=FM0$(81,30),CITY$=FM0$(111,16),STATE$=FM0$(127,2)
11062 COUNTRY$=STP(MID(FM0$,380,2),2); IF COUNTRY$="" THEN COUNTRY$="US"
11065 PHONE$=FM0$(200,14),ZIP$=FM0$(129,9)
11075 CONTACT$=FM0$(160,20),EMAIL$=FM0$(522,40)
11078 DFLTS$=FM0$(305,1)
11080 PAYVIA$=""
11082 TAX$="",ALTTAX$=""; IF MID(FM0$,283,1)="Y" THEN ALTTAX$=FM0$(224,10) ELSE TAX$=FM0$(224,10) ! Set alt tax if Tax Exempt flag ="Y"
11085 RESIDENTIAL$=""
11088 SINACTIVE$="N"
11135 SHDR$=SHDR$+"NAME"+$09$,SDTL$=SDTL$+SHIP_NAME$+$09$
11140 SHDR$=SHDR$+"ADDR_1"+$09$,SDTL$=SDTL$+ADDR1$+$09$
11145 SHDR$=SHDR$+"ADDR_2"+$09$,SDTL$=SDTL$+ADDR2$+$09$
11150 SHDR$=SHDR$+"CITY"+$09$,SDTL$=SDTL$+CITY$+$09$
11155 SHDR$=SHDR$+"STATE"+$09$,SDTL$=SDTL$+STATE$+$09$
11160 SHDR$=SHDR$+"ZIP"+$09$,SDTL$=SDTL$+ZIP$+$09$
11165 SHDR$=SHDR$+"COUNTRY"+$09$,SDTL$=SDTL$+COUNTRY$+$09$
11170 SHDR$=SHDR$+"PHONE"+$09$,SDTL$=SDTL$+PHONE$+$09$
11175 IF SINACTIVE$="Y" THEN SHDR$=SHDR$+"INACTIVE"+$09$,SDTL$=SDTL$+SINACTIVE$+$09$ ! Open print if inactive
11180 SHDR$=SHDR$+"CONTACT"+$09$,SDTL$=SDTL$+CONTACT$+$09$
11185 SHDR$=SHDR$+"EMAIL"+$09$,SDTL$=SDTL$+EMAIL$+$09$
11190 ! SHDR$=SHDR$+"DEF_SHIP_VIA"+$09$,SDTL$=SDTL$+DFLTS$+$09$
11195 SHDR$=SHDR$+"ALIAS"+$09$,SDTL$=SDTL$+FM0$(12,4)+$09$
11210 ! SHDR$=SHDR$+"RESIDENTIAL"+$09$,SDTL$=SDTL$+RESIDENTIAL$+$09$
11215 SHIPTO_PRINT:
11310 GRP$="SHIPTO"; HEADER$="SHIPTO"+$09$,TF_VALUE$="Id="+QUO+FNX$(STP(SHIPTO$,2))+QUO+" Delete="+QUO+SHP_DEL$+QUO+$09$; TP=1,GL=7; GOSUB XML
11320 IF SHP_DEL$="Y" THEN GOTO 11345
11335 HEADER$=SHDR$,HTML_TO_FLD$=HEADER$; TF_VALUE$=SDTL$; GL=9; GOSUB XML
11338 HEADER$="DEF_SHIP_VIA"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(DFLTS$,2))+QUO+$09$; TP=2,GL=9; GOSUB XML
11340 ! SHDR$=SHDR$+"DEF_SHIP_VIA"+$09$,SDTL$=SDTL$+DFLTS$+$09$
11342 HEADER$="TAX"+$09$,TF_VALUE$="Id="+QUO+FNX$(STP(TAX$,2))+QUO+" Alternate="+QUO+FNX$(STP(ALTTAX$,2))+QUO+" UseTax="+QUO+"N"+QUO+$09$; TP=2; GL=9; GOSUB XML
11343 HEADER$="PAYVIA"+$09$,TF_VALUE$="Invoice="+QUO+"Y"+QUO+" Mc="+QUO+"Y"+QUO+" Amex="+QUO+"Y"+QUO+" Visa="+QUO+"Y"+QUO+" Discover="+QUO+"Y"+QUO+$09$; TP=2; GL=9; GOSUB XML
11345 GHDG$="SHIPTO"; GP=7; GOSUB END_GROUP
11346 RETURN 
11470 ! 
11480 EXIT_SHIPTO:
11482 IF FIRST=0 THEN RETURN 
11485 GHDG$="SHIPTOS"; GP=5; GOSUB END_GROUP
11488 SECTION$="SHIPTO_SECTION"; GOSUB END_XML_SECTION
11490 RETURN 
11499 ! 
11999 ! 
12000 ITEM_XML:
12005 ! All Eqlink Items to upload for the customer
12010 DIM IC0$(128),IC0[33],FM1[31],IC1$(58),IC1[20],P[2]
12020 SECTION$="ITEM_SECTION"; GOSUB START_XML_SECTION
12025 GRP$="ITEMS"; HEADER$="ITEMS"+$09$,TF_VALUE$="ClientId="+QUO+FNX$(STP(ECUST$,2))+QUO+" Replace="+QUO+RPLC$+QUO+$09$; TP=1,GL=5; GOSUB XML
12030 READ (Z[5],KEY=CUST$+"",ERR=*NEXT)
12040 NEXT_FM1:
12045 IHDR$="",IDTL$="",ICNT=0
12050 KS$=KEY(Z[5],END=EXIT_ITEM); READ (Z[5],KEY=KS$)IOL=FM1_IOL
12060 IF KS$(1,10)<>CUST$ THEN GOTO EXIT_ITEM
12065 OOITEM$=FM1$(11,10); VI=0; GOSUB CHECK_VALID_ITEM; IF VI=0 THEN GOTO NEXT_FM1
12067 ITM_DEL$="N"
12070 GOSUB ITEM_DATA
12080 GOTO NEXT_FM1
12085 ! 
12090 ITEM_DATA:
12095 STKI=0; FIND (Z[7],KEY=KS$,DOM=*NEXT)IOL=IC0_IOL; STKI=1; GOSUB POD_ITEM
12100 FIND (Z[13],KEY="U/M"+FM1$(100,4),DOM=*NEXT)P$,P[0],P[1]
12110 IF MID(P$,20,1)<>"Y" THEN SELL_QTY_PER=FM1[4] ELSE SELL_QTY_PER=P[1] ! (SELL_QTY_PER)
12120 IF SELL_QTY_PER=0 THEN SELL_QTY_PER=1
12125 ITEM$=FM1$(11,10),QITEM$=CIC_ITEM$; IF QITEM$="" THEN QITEM$=ITEM$
12130 CUST$=FM1$(1,10),DESC1$=FM1$(42,40),DESC2$=MID(IC0$,128,40),SELL_UNIT$=FM1$(100,4),SELL_QTY_PER$=STR(FM1[4]),CATALOG$=MID(IC0$,118,1)
12132 ! CUST$=FM1$(1,10),ITEM$=FM1$(11,10),DESC1$=FM1$(42,40),DESC2$=MID(IC0$,128,40),SELL_UNIT$=FM1$(100,4),SELL_QTY_PER$=STR(FM1[4]),CATALOG$=MID(IC0$,118,1)
12135 REVISION$=MID(FM1$,167,6)
12140 RO_QTY$=STR(RO_QTY),RO_WKS$=STR(RO_WKS),RO_DATE$=FM1$(109,6),RO_SUPPRESS$="N",SUGG_QTY$=STR(SUGG_QTY),CONTACT$="",EMAIL$=""
12150 STATUS$=FM1$(195,1) ! Active status
12160 DFLTS$=MID(FM0$,305,1),NEVER_BO$=MID(IC0$,117,1)
12170 UNIT_SELL_PRICE$=STR(FM1[3]),LIST$=STR(IC0[0])
12172 ALTUM$=MID(FM1$,250,4); IF STP(ALTUM$,2)="" THEN GOTO 12175
12173 HLD_PRECSION=PRECISION; PRECISION 5
12174 SELL_UNIT$=ALTUM$,SELL_QTY_PER$=STR(FM1[28]); IF NUM(UNIT_SELL_PRICE$)<>0 THEN UNIT_SELL_PRICE$=STR(NUM(UNIT_SELL_PRICE$)/FM1[4]),LIST$=UNIT_SELL_PRICE$; END_IF ; PRECISION HLD_PRECISION
12175 ITM_TAX$=MID(FM1$,387,1); IF STKI THEN ITM_TAX$=MID(IC0$,119,1)
12180 ! IF MID(FM0$,283,1)="Y" THEN ALTTAX$=FM0$(224,10) ELSE TAX$=FM0$(224,1) ! Set alt tax if Tax Exempt flag ="Y"
12190 MIN_QTY$=STR(IC0[33])
12200 ! 
12205 ITEM_DATA1:
12210 HEADER$="",TF_VALUE$=""
12242 HEADER$="ITEM"+$09$,TF_VALUE$="Id="+QUO+FNX$(STP(QITEM$,2))+QUO+"  Delete="+QUO+ITM_DEL$+QUO+" Upload="+QUO+FM1$(198,1)+QUO+$09$; TP=1,GL=7; GOSUB XML
12250 IF ITM_DEL$="Y" THEN GOTO END_OF_ITEM
12280 HEADER$=HEADER$+"DESC1"+$09$,TF_VALUE$=TF_VALUE$+DESC1$+$09$
12290 ! HEADER$=HEADER$+"DESC2"+$09$,TF_VALUE$=TF_VALUE$+DESC2$+$09$
12292 GL=9; GOSUB XML
12300 HEADER$="UNIT"+$09$,TF_VALUE$="Desc="+QUO+FNX$(STP(SELL_UNIT$,2))+QUO+" Uom="+QUO+FNX$(STP(SELL_QTY_PER$,2))+QUO+$09$; TP=2,GL=9; GOSUB XML
12320 IF STKI THEN GOSUB STOCK_ITEM
12325 GL=9; GOSUB XML
12360 HEADER$=HEADER$+"INACTIVE"+$09$,TF_VALUE$=TF_VALUE$+STATUS$+$09$
12370 IF MID(IC0$,118,1)="1" THEN HEADER$="SUPPLY_CATALOG "+$09$,TF_VALUE$="Type="+QUO+"1"+QUO+$09$; TP=2,GL=9; GOSUB XML ! Check in IC0 if a Tops Item
12390 GOSUB ITEM_REORDER
12400 IF STATUS$="I" THEN HEADER$=HEADER$+"OBSOLETE"+$09$,TF_VALUE$=TF_VALUE$+"N"+$09$,TP=2; GL=9; GOSUB XML ! Only print if obsolete/inactive
12415 ! HEADER$=HEADER$+"ALLOW_ATTACHMENT"+$09$,TF_VALUE$=TF_VALUE$+""+$09$
12420 ! HEADER$=HEADER$+"SECURE"+$09$,TF_VALUE$=TF_VALUE$+""+$09$
12430 IF NEVER_BO$="Y" THEN HEADER$=HEADER$+"NO_BACKORDERS"+$09$,TF_VALUE$=TF_VALUE$+""+$09$
12432 GL=9; GOSUB XML
12435 IF ITM_TAX$="E" THEN HEADER$=HEADER$+"ALTERNATE_TAX"+$09$,TF_VALUE$=TF_VALUE$+""+$09$,TP=2; GL=9; GOSUB XML ! Only print if Item is tax exempt
12440 GOSUB UNIT_SELL
12450 GOTO 12510
12460 HEADER$=HEADER$+"MIN_QTY"+$09$,TF_VALUE$=TF_VALUE$+EMAIL$+$09$
12470 HEADER$=HEADER$+"MAX_QTY"+$09$,TF_VALUE$=TF_VALUE$+EMAIL$+$09$
12480 HEADER$=HEADER$+"EXTRA_FREIGHT"+$09$,TF_VALUE$=TF_VALUE$+EMAIL$+$09$
12490 IF STP(REVISION$,2)<>"" THEN HEADER$=HEADER$+"REVISION"+$09$,TF_VALUE$=TF_VALUE$+""+$09$
12500 HEADER$=HEADER$+"FREIGHT_EXEMPT"+$09$,TF_VALUE$=TF_VALUE$+EMAIL$+$09$
12510 GL=9; GOSUB XML ! GOSUB GRPEND
12640 ! 
12650 ITEM_USAGE:
12660 UKY$=CUST$+ITEM$+FY$
12670 DIM FSW$(120),FSW[14]
12680 FIND (Z[12],KEY=UKY$+"U",DOM=END_USAGE)IOL=FSW_IOL
12695 PRIOR_YR$=STR(NUM(FY$)-1:"0000")
12700 DIM FSW[33],FSWP[33]; TEMP$=UKY$(1,24); CALL "ZZPACK",X3$,"R","","",0,0,FSW{ALL},Z[12],"U",TEMP$,F9$; REM "load FM3$ for single location 
12705 DIM FSW_PRIORYR(14); TEMP$=UKY$(1,20)+PRIOR_YR$; CALL "ZZPACK",X3$,"R","","",0,0,FSW_PRIORYR{ALL},Z[12],"U",TEMP$,F9$; REM "load in prior year usage figures -
12710 CURR_USAGE=FSW[NUM(ACCTPD$)]
12715 FOR XX=1 TO 13; FSWP[XX]=FSW[13-XX]; NEXT XX
12720 FOR XXX=1 TO 13; FSWP[XXX+13]=FSW_PRIORYR(13-XXX); NEXT XXX; REM "put prior year figures into FM3. fROM cURRENT GOING DOWN 
12730 HEADER$="ITEM_USAGE"+$09$,TF_VALUE$="Current="+QUO+STR(CURR_USAGE)+QUO+" Avg="+QUO+STR(FM1[24])+QUO+$09$; TP=1; GL=9; GOSUB XML
12740 FOR X=13-(NUM(ACCTPD$)) TO 24
12750 HEADER$="PREV"+$09$,TF_VALUE$=STR(FSWP[X])+$09$; GL=11; GOSUB XML
12760 NEXT X
12770 GHDG$="ITEM_USAGE"; GP=9; GOSUB END_GROUP
12780 END_USAGE:
12790 ! 
12800 KIT_XML:
12805 KCNT=0,FIRST=0; DIM KT0[4]
12810 KTKEY$=CUST$+ITEM$
12820 READ (Z[19],KEY=KTKEY$+"",DOM=*NEXT)
12830 NEXT_KT0:
12840 KK$=KEY(Z[19],END=END_KIT_XML); READ (Z[19],KEY=KK$)IOL=KT0_IOL
12850 IF KK$(1,LEN(KTKEY$))<>KTKEY$ THEN GOTO END_KIT_XML
12860 KIT_PRINT_XML:
12865 IF FIRST=1 THEN GOTO SUB_KIT
12870 FIRST=1; HEADER$="KIT"+$09$,TF_VALUE$="Static="+QUO+"Y"+QUO+$09$; TP=1,GL=9; GOSUB XML
12875 HEADER$="ASSEMBLIES"+$09$,TF_VALUE$=""+$09$; TP=1,GL=11; GOSUB XML
12880 SUB_KIT:
12882 SUBCL$=ECUST$ ! if STP(mid(kt0$,21,10),2)<>"" THEN SUBCL$=KT0$(21,10)
12885 OOITEM$=KT0$(31,10); SUBITM$=STP(OOITEM$,2),VI=0; GOSUB CHECK_VALID_ITEM; IF VI=0 THEN GOTO NEXT_KT0
12890 IF STP(CIC_ITEM$,2)<>"" THEN SUBITM$=STP(CIC_ITEM$,2)
12892 HEADER$="SUB_ITEM"+$09$,TF_VALUE$="ClientId="+QUO+SUBCL$+QUO+" Id="+QUO+SUBITM$+QUO+$09$; TP=1,GL=13; GOSUB XML
12898 HEADER$="SUB_UNIT"+$09$,TF_VALUE$="Desc="+QUO+STP(MID(KT0$,41,4),2)+QUO+" Qty="+QUO+STR(KT0[0])+QUO+$09$; TP=2,GL=15; GOSUB XML
12900 HEADER$="QTY_PER_KIT"+$09$,TF_VALUE$=STR(KT0[1])+$09$; GL=15; GOSUB XML
12910 GHDG$="SUB_ITEM"; GP=13; GOSUB END_GROUP
12915 KCNT++
12920 GOTO NEXT_KT0
12930 END_KIT_XML:
12935 IF KCNT=0 THEN GOTO END_OF_ITEM
12940 GHDG$="ASSEMBLIES"; GP=11; GOSUB END_GROUP
12945 GHDG$="KIT"; GP=9; GOSUB END_GROUP
12959 ! 
13200 END_OF_ITEM: GHDG$="ITEM"; GP=7; GOSUB END_GROUP
13210 RETURN 
13240 ! 
13250 EXIT_ITEM:
13260 GHDG$="ITEMS"; GP=5; GOSUB END_GROUP
13270 SECTION$="ITEM_SECTION"; GOSUB END_XML_SECTION
13280 RETURN 
13299 ! 
14099 ! 
14100 STOCK_ITEM:
14110 KIC$=CUST$+ITEM$,QOH=0,BO=0,ONORD=0
14120 READ (Z[3],KEY=KIC$+"",ERR=*NEXT)
14122 HLD_PRECSION=PRECISION; PRECISION 5
14125 NEXT_IC1:
14130 KK$=KEY(Z[3],END=END_STOCK); READ (Z[3],KEY=KK$)IOL=IC1_IOL
14135 IF KK$(1,LEN(KIC$))<>KIC$ THEN GOTO END_STOCK
14138 READ (Z[13],KEY="U/M"+IC0$(120,4),DOM=*NEXT)I$,I0,I1; IF I$(20,1)<>"Y" THEN INV_QTY_PER=IC0[14] ELSE INV_QTY_PER=I1 ! SSP#280689 In terms of SELL UOM
14140 QOH=QOH+(IC1[3]+IC1[4]-IC1[5]+IC1[6]-IC1[7])/INV_QTY_PER
14145 QBO=QBO+(IC1[11]/INV_QTY_PER),ONORD=ONORD+(IC1[8]/INV_QTY_PER)
14148 ! IF I0<>0 THEN QOH=QOH/I0,QBO=QBO/I0,ONORD=ONORD/I0
14150 GOTO NEXT_IC1
14160 END_STOCK:
14161 CUOM$=STP(IC0$(120,4),2)
14162 IF POS(CUOM$="MT")<>0 THEN QOH=QOH/1000,QBO=QBO/1000,ONORD=ONORD/1000
14165 IF STP(ALTUM$,2)<>"" THEN QOH=((QOH*FM1[4])/FM1[28]),QBO=((QBO*FM1[4])/FM1[28]),ONORD=((ONORD*FM1[4])/FM1[28])
14170 HEADER$="STOCK_ITEM "+$09$,TF_VALUE$="OnHand="+QUO+STR(QOH)+QUO+" BO="+QUO+STR(QBO)+QUO+" OnOrder="+QUO+STR(ONORD)+QUO+$09$; TP=2,GL=9; GOSUB XML
14180 PRECISION HLD_PRECISION
14190 RETURN 
14199 ! 
14200 ITEM_REORDER:
14208 RO_DATE$=MID(FM1$,109,6); IF STP(RO_DATE$,2)<>"" THEN RO_DATE$=FN%FMT_TFDATE$(RO_DATE$,"YYYYMMDD")
14210 HEADER$="REORDER "+$09$,TF_VALUE$="Qty="+QUO+STR(FM1[23])+QUO+" Weeks="+QUO+STR(FM1[22]/7)+QUO+" Date="+QUO+RO_DATE$+QUO+$09$; TP=1,GL=9; GOSUB XML
14220 HEADER$=HEADER$+"SUGGESTED_QTY"+$09$,TF_VALUE$=TF_VALUE$+STR(FM1[21])+$09$ ! Use FM2 stock level as suggested RO qty
14222 DIM B1$(208); B1$(45)=AR1$(56,163),B1$(15,30)=AR1$(11,30); READ (Z[8],KEY="a"+FMPD$(2,10)+FMPD$(109,3),DOM=*NEXT)B1$(1)
14225 X7$=""; FIND (Z[8],KEY="a"+FMPD$(2,10)+FM1$(209,3),DOM=*NEXT)X7$; B1$(1)=X7$
14226 ! IF POS(" "<>B1$(75,79))=0 THEN B1$(45,109)=E$(56,109); !Address
14230 IF STP(B1$(154,20),2)="" THEN B1$(154,20)=AR1$(165,20) ! Purchasing Agent
14232 ! IF FNS$(B1$(15,30))="" OR POS(X3$(9,3)="055",3)>0 THEN B1$(15,30)=E$(11,30) ! Cust Name
14240 HEADER$=HEADER$+"CONTACT"+$09$,TF_VALUE$=TF_VALUE$+B1$(154,20)+$09$
14280 HEADER$=HEADER$+"EMAIL"+$09$,TF_VALUE$=TF_VALUE$+EMAIL$+$09$
14285 GL=11; GOSUB XML
14290 GHDG$="REORDER"; GP=9; GOSUB END_GROUP; RETURN 
14299 ! 
14400 UNIT_SELL:
14440 HEADER$=HEADER$+"UNIT_SELL "+$09$,TF_VALUE$="Price="+QUO+FNX$(STP(UNIT_SELL_PRICE$,2))+QUO+$09$; TP=1,GL=9; GOSUB XML
14450 HEADER$=HEADER$+"LIST"+$09$,TF_VALUE$=TF_VALUE$+LIST$+$09$; GL=11; GOSUB XML
14530 GHDG$="PRICE_BREAKS"; GP=11; GOSUB START_GRP
14535 HEADER$="BREAK"+$09$,TF_VALUE$="Client="+QUO+FNX$(STP(ECUST$,2))+QUO+$09$; GL=13; TP=1; GOSUB XML
14538 HLD_PRECSION=PRECISION; PRECISION 5
14540 DIM Q[35],P[2]
14550 FIND (Z[13],KEY="U/M"+FM1$(100,4),DOM=*NEXT)P$,P[0],P[1]
14555 IF MID(P$,20,1)<>"Y" THEN SELL_QTY_PER=FM1[4] ELSE SELL_QTY_PER=P[1] ! (SELL_QTY_PER)
14556 IF SELL_QTY_PER=0 THEN SELL_QTY_PER=1
14560 FOR X=0 TO 5; Q[X]=IC0[X*2+1]/SELL_QTY_PER,Q[X+24]=IC0[X*2+21]/SELL_QTY_PER,Q[X+6]=IC0[X*2+2],Q[X+30]=IC0[X*2+22]; NEXT X
14562 BUOM$=STP(FM1$(100,4),2)
14564 FOR X=0 TO 5
14565 IF Q[X]<>0 THEN IF POS(BUOM$="MT")<>0 THEN Q[X]=Q[X]/1000
14566 IF Q[X+24]<>0 THEN IF POS(BUOM$="MT")<>0 THEN Q[X+24]=Q[X+24]/1000
14568 NEXT X
14570 FOR X=0 TO 5; IF Q[X]=0 THEN CONTINUE
14572 IF STP(ALTUM$,2)<>"" THEN Q[X]=((Q[X]*FM1[4])/FM1[28]),Q[X+6]=((Q[X+6]/FM1[4])*FM1[28])
14580 HEADER$="Q"+$09$,TF_VALUE$="Qty="+QUO+STR(Q[X])+QUO+" Sell="+QUO+STR(Q(X+6))+QUO+$09$; TP=2; GL=15; GOSUB XML
14590 NEXT X
14600 FOR X=0 TO 5; IF Q[X+24]=0 THEN CONTINUE
14605 IF STP(ALTUM$,2)<>"" THEN Q[X+24]=((Q[X+24]*FM1[4])/FM1[28]),Q[X+30]=((Q[X+30]/FM1[4])*FM1[28])
14610 HEADER$="Q"+$09$,TF_VALUE$="Qty="+QUO+STR(Q[X+24])+QUO+" Sell="+QUO+STR(Q[X+30])+QUO+$09$; TP=2; GL=15; GOSUB XML
14620 NEXT X
14625 PRECISION HLD_PRECISION
14630 GHDG$="BREAK"; GP=13; GOSUB END_GROUP
14640 GHDG$="PRICE_BREAKS"; GP=11; GOSUB END_GROUP
14650 GHDG$="UNIT_SELL"; GP=9; GOSUB END_GROUP
14690 RETURN 
14699 ! 
14800 CC_USAGE_XML:
14802 ! Cost Center/Location Usage
14805 DIM FM3$(57),FM3[14],FM4[16]
14808 FIRST=0
14810 KY$=CUST$; DIM HLD_K$(30); FIRST=0
14815 FK$="D"+CUST$; FIND (Z[8],KEY=FK$,DOM=*NEXT)FMPD$
14820 FY$=FMPD$(52,4),ACCTPD$=FMPD$(56,2)
14825 F3K$=KY$,F3U$=FY$+"U"
14830 READ (Z[14],KEY=KY$,DOM=*NEXT)
14835 NEXT_FM3:
14840 K$=KEY(Z[14],END=END_CC_USAGE); READ (Z[14],KEY=K$)IOL=FM3_IOL
14845 IF K$(1,LEN(KY$))<>KY$ THEN GOTO END_CC_USAGE ! End of Customer
14860 OOITEM$=K$(11,10); VI=0; GOSUB CHECK_VALID_ITEM; IF VI=0 THEN GOTO NEXT_FM3
14870 ITEM$=K$(11,10),QITEM$=CIC_ITEM$; IF QITEM$="" THEN QITEM$=ITEM$
14875 ! IF K$(25,5)<>F3U$ THEN GOTO NEXT_FM3 ! Check for current fiscal year 
14876 IF K$(29,1)<>"U" THEN GOTO NEXT_FM3 ! Check for current fiscal year 
14880 IF HLD_K$=DIM(30) THEN GOTO *NEXT ELSE GOTO CC_ITEM
14885 SECTION$="CC_USAGE_SECTION"; GOSUB START_XML_SECTION
14890 HLD_K$(1,10)=K$(1,10)
14895 FIRST=1
14900 CC_CUST:
14905 IF HLD_K$(1,10)<>K$(1,10) THEN GOSUB END_CC_CUST
14910 HEADER$="ITEM_CLIENT"+$09$,TF_VALUE$="ClientId="+QUO+FNX$(STP(ECUST$,2))+QUO+$09$; GL=5; TP=1; GOSUB XML
14915 HLD_K$(1,10)=K$(1,10)
14920 CC_ITEM:
14925 IF HLD_K$(11,10)<>K$(11,10) THEN GOTO *NEXT ELSE GOTO CC_LOC
14930 IF HLD_K$(11,10)<>DIM(10) THEN GOSUB END_CC_ITEM
14935 HEADER$="CC_USAGE"+$09$,TF_VALUE$="ItemId="+QUO+FNX$(STP(QITEM$,2))+QUO+$09$; GL=7; TP=1; GOSUB XML
14940 ! HLD_K$(11,10)=K$(11,10)
14950 CC_LOC:
14955 IF HLD_K$(1,24)<>K$(1,24) THEN GOTO *NEXT ELSE HLD_K$=K$; GOTO NEXT_FM3
14980 USG_LOC:
14985 PRIOR_YR$=STR(NUM(FY$)-1:"0000")
14990 DIM FM3P[33],FM3[33]; TEMP$=K$(1,24)+FY$; CALL "ZZPACK",X3$,"R","","",0,0,FM3{ALL},Z[14],"U",TEMP$,F9$; REM "load FM3$ for single location 
14995 DIM FM3_PRIORYR$(50),FM3_PRIORYR(14); TEMP$=K$(1,24)+PRIOR_YR$; CALL "ZZPACK",X3$,"R","","",0,0,FM3_PRIORYR{ALL},FM3_CHL,"U",TEMP$,F9$; REM "load in prior year usage figures - 
15000 CURR_USAGE=FM3[NUM(ACCTPD$)]
15010 FOR XX=1 TO 13; FM3P[XX]=FM3[13-XX]; NEXT XX
15020 FOR XXX=1 TO 13; FM3P[XXX+13]=FM3_PRIORYR(13-XXX); NEXT XXX; REM "put prior year figures into FM3. fROM cURRENT GOING DOWN 
15030 DIM FM4$(200),FM4[16]; READ (Z[15],KEY=K$(1,24),DOM=*NEXT)IOL=FM4_IOL
15040 IF FM4$(26,1)<>"Y" THEN FM4[3]=0
15050 FM4_AVG_MOS_USAGE=FM4[1]
15052 RCKEY$="C"+K$(1,10)+K$(21,4); CC_LOC$=MID(FM3$,21,4); FIND (Z[2],KEY=RCKEY$,DOM=*NEXT)FM0CC$; CC_LOC$=STP(MID(FM0CC$,382,20)); IF CC_LOC$="" THEN CC_LOC$=FM3$(21,4)
15060 HEADER$="CC "+$09$,TF_VALUE$="Id="+QUO+FNX$(STP(CC_LOC$,2))+QUO+" Current="+QUO+STR(CURR_USAGE)+QUO+" Avg="+QUO+STR(FM4_AVG_MOS_USAGE)+QUO+$09$; TP=1,GL=9; GOSUB XML
15062 ! EADER$="CC "+$09$,TF_VALUE$="Id="+QUO+FNX$(STP(FM3$(21,4),2))+QUO+" Current="+QUO+STR(CURR_USAGE)+QUO+" Avg="+QUO+STR(FM4_AVG_MOS_USAGE)+QUO+$09$; TP=1,GL=9; GOSUB XML
15070 FOR X=14-(NUM(ACCTPD$)) TO 24
15075 ! F FM3P[X]=0 THEN CONTINUE
15080 HEADER$="PREV"+$09$,TF_VALUE$=STR(FM3P[X])+$09$; GL=11; GOSUB XML
15085 NEXT X
15090 GHDG$="CC"; GP=9; GOSUB END_GROUP
15092 IF QFRM$="QCHG" THEN RETURN 
15095 HLD_K$=K$; GOTO NEXT_FM3
15100 END_CC_ITEM:
15120 GHDG$="CC_USAGE"; GP=7; GOSUB END_GROUP; RETURN 
15130 END_CC_CUST:
15140 GHDG$="ITEM_CLIENT"; GP=5; GOSUB END_GROUP
15150 RETURN 
15180 END_CC_USAGE:
15182 IF FIRST=0 THEN RETURN 
15183 IF QFRM$="QCHG" AND UCNT=0 THEN RETURN 
15185 GOSUB END_CC_ITEM; GOSUB END_CC_CUST; GOSUB END_XML_SECTION
15190 RETURN 
15199 ! 
15200 OPEN_ORDER_XML:
15205 OHDR=0,POCNT=0
15206 ! IRST=0,OHDR=0,POCNT=0
15210 READ (Z[4],KNO=1,KEY=CUST$,DOM=*NEXT)
15215 NEXT_FS1:
15220 KEY_4$=KEY(Z[4],END=END_OPEN_ORDER); SET_PARAM 'XI'; READ (Z[4])IOL=0340; SET_PARAM 'XI'=0 ! SSP249849  jdf   
15230 IF KEY_4$(1,10)<>CUST$ THEN GOTO END_OPEN_ORDER
15235 ! IF POCNT>5 THEN GOTO END_ORDER
15240 DIM SHIP_INFO$(299); READ (Z[17],KEY=FS1$(118,8)+DIM(5),DOM=*NEXT)SHIP_INFO$
15245 IF FIRSTOO=0 THEN FIRSTOO=1; HEADER$="OPEN_PO_SECTION"+$09$,TF_VALUE$=""+$09$; TP=1,GL=3; GOSUB XML
15250 OORDER$=KEY_4$(11,8),OOCUST$=ECUST$,OOCNS$=FS1$(93,4),OOVIA$=SHIP_INFO$(150,1),OOFROM$=CUST$
15255 OOPO$=FS1$(28,15) ! Cust PO
15280 ! Set start of Open Orders
15300 K6$=OORDER$
15310 READ (Z[6],KEY=K6$+"",DOM=*NEXT)
15320 NEXT_FS2:
15330 KEY_6$=KEY(Z[6],END=END_ORDER); READ (Z[6],KEY=KEY_6$)IOL=0345
15340 IF KEY_6$(1,LEN(K6$))<>K6$ THEN GOTO END_ORDER
15350 OOITEM$=FS2$(19,10); VI=0; GOSUB CHECK_VALID_ITEM; IF VI=0 THEN GOTO NEXT_FS2
15355 IF OHDR=0 THEN OHDR=1,HEADER$="PO"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(OORDER$,2))+QUO+" ClientId="+QUO+FNX$(STP(OOCUST$,2))+QUO+" CnsId="+QUO+FNX$(STP(OOCNS$,2))+QUO+$09$; TP=1,GL=5; GOSUB XML
15360 OODESC$=FS2$(50,40),OOUNIT$=FS2$(124,4),OOUOM$=STR(FS2[5])
15365 OOLINE$=FS2$(6,3)
15370 OOQTY=FN%QTY_IN_UM(FS2(10),FS2$(124,4),FS2(5))
15380 HEADER$="PO_LINE"+$09$,TF_VALUE$="LineNumber="+QUO+OOLINE$+QUO+" FromClientId="+QUO+FNX$(STP(OOCUST$,2))+QUO+" ItemId="+QUO+FNX$(STP(OOITEM$,2))+QUO+$09$; TP=1; GL=9; GOSUB XML
15400 HEADER$=HEADER$+"DESC"+$09$,TF_VALUE$=TF_VALUE$+OODESC$+$09$
15410 HEADER$=HEADER$+"CLIENT_PO"+$09$,TF_VALUE$=TF_VALUE$+OOPO$+$09$
15430 GL=11; GOSUB XML
15440 HEADER$="UNIT"+$09$,TF_VALUE$="Desc="+QUO+FNX$(STP(OOUNIT$,2))+QUO+" Uom="+QUO+FNX$(STP(OOUOM$,2))+QUO+$09$; TP=2; GL=11; GOSUB XML
15450 HEADER$="SHIP_VIA"+$09$,TF_VALUE$="Id="+QUO+FNX$(STP(OOVIA$,2))+QUO+$09$; TP=2; GL=11; GOSUB XML
15460 HEADER$=HEADER$+"SHIP_DATE"+$09$,TF_VALUE$=TF_VALUE$+""+$09$
15470 HEADER$=HEADER$+"QTY"+$09$,TF_VALUE$=TF_VALUE$+STR(OOQTY)+$09$
15480 GL=11; GOSUB XML
15490 GHDG$="PO_LINE"; GP=9; GOSUB END_GROUP
15492 POCNT=POCNT+1
15500 GOTO NEXT_FS2
15505 END_ORDER:
15508 IF OHDR=0 THEN GOTO NEXT_FS1
15510 GHDG$="PO"; GP=5; GOSUB END_GROUP
15515 OHDR=0
15520 GOTO NEXT_FS1
15850 END_OPEN_ORDER:
15855 READ (Z(4),KEY="",KNO=0,DOM=*NEXT) ! SSP#269603
15856 IF QFRM$="QORD" THEN RETURN 
15860 IF FIRSTOO THEN GHDG$="OPEN_PO_SECTION"; GP=3; GOSUB END_GROUP
15900 RETURN 
15999 ! 
16000 CNS_XML:
16002 ! Consultant XML 
16005 FIRST=0,CCNT=0
16006 CNS_DEL$="N"
16010 READ (Z[16],KEY="",DOM=*NEXT)
16015 NEXT_CNS:
16020 KC$=KEY(Z[16],END=END_CNS); READ (Z[16],KEY=KC$)AR3$
16028 CNS_PRINT_XML:
16030 IF FIRST=0 THEN FIRST=1; HEADER$="CNS_SECTION"+$09$,TF_VALUE$="Replace="+QUO+RPLC$+QUO+$09$; TP=1,GL=3; GOSUB XML
16032 IF CNS_DEL$="Y" THEN SLS$=STP(CNSCD$,2); IF LEN(SLS$)=4 THEN SLS$=SLS$(2,3)
16035 IF CNS_DEL$="Y" THEN HEADER$="CNS"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(SLS$))+QUO+" Delete="+QUO+CNS_DEL$+QUO+$09$; TP=1,GL=5; GOSUB XML; GOTO END_CNS_GRP
16038 SLS$=STP(AR3$(1,4),2); IF LEN(SLS$)=4 THEN SLS$=SLS$(2,3)
16040 HEADER$="CNS"+$09$; TF_VALUE$="Id="+QUO+FNX$(SLS$)+QUO+" Delete="+QUO+CNS_DEL$+QUO+$09$; TP=1,GL=5; GOSUB XML
16050 HEADER$=HEADER$+"NAME"+$09$,TF_VALUE$=TF_VALUE$+AR3$(5,35)+$09$
16060 HEADER$=HEADER$+"ADDR_1"+$09$,TF_VALUE$=TF_VALUE$+AR3$(40,30)+$09$
16065 HEADER$=HEADER$+"ADDR_2"+$09$,TF_VALUE$=TF_VALUE$+AR3$(70,30)+$09$
16070 HEADER$=HEADER$+"CITY"+$09$,TF_VALUE$=TF_VALUE$+AR3$(100,16)+$09$
16080 HEADER$=HEADER$+"STATE"+$09$,TF_VALUE$=TF_VALUE$+AR3$(116,2)+$09$
16090 HEADER$=HEADER$+"ZIP"+$09$,TF_VALUE$=TF_VALUE$+AR3$(118,9)+$09$
16100 COUNTRY$="US"; HEADER$=HEADER$+"COUNTRY"+$09$,TF_VALUE$=TF_VALUE$+COUNTRY$+$09$
16110 HEADER$=HEADER$+"EMAIL"+$09$,TF_VALUE$=TF_VALUE$+""+$09$
16120 GL=7; GOSUB XML
16125 END_CNS_GRP:
16130 GHDG$="CNS"; GP=5; GOSUB END_GROUP
16132 CCNT=CCNT+1
16133 IF CCO THEN CCO=0; RETURN 
16135 GOTO NEXT_CNS
16140 END_CNS:
16150 SECTION$="CNS_SECTION"; GOSUB END_XML_SECTION
16160 RETURN 
16199 ! 
17000 SHIPVIA_XML:
17005 ! Master Ship Via XML
17010 KS$="S",SCNT=0,FIRST=0
17015 READ (Z[8],KEY=KS$+"",DOM=*NEXT)
17018 VIA_DEL$="N"
17020 NEXT_FMPS:
17030 K$=KEY(Z[8],END=END_SHIPVIA); READ (Z[8],KEY=K$)FMPS$
17040 IF K$(1,1)<>KS$ THEN GOTO END_SHIPVIA
17045 SHIPVIA_PRINT_XML:
17050 IF FIRST=0 THEN FIRST=1; HEADER$="SHIPVIA_SECTION"+$09$,TF_VALUE$="Replace="+QUO+RPLC$+QUO+$09$; TP=1,GL=3; GOSUB XML
17055 IF VIA_DEL$="Y" THEN HEADER$="VIA"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(VIACD$))+QUO+" Delete="+QUO+VIA_DEL$+QUO+$09$; TP=1,GL=5; GOSUB XML; GOTO END_VIA_GRP
17060 HEADER$="VIA"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(FMPS$(2,1),2))+QUO+" Delete="+QUO+VIA_DEL$+QUO+$09$; TP=1,GL=5; GOSUB XML
17070 HEADER$=HEADER$+"NAME"+$09$,TF_VALUE$=TF_VALUE$+FMPS$(3,15)+$09$
17080 GL=7; GOSUB XML
17082 END_VIA_GRP:
17085 GHDG$="VIA"; GP=5; GOSUB END_GROUP
17088 IF CCO THEN CCO=0; RETURN 
17090 GOTO NEXT_FMPS
17100 END_SHIPVIA:
17110 IF FIRST=0 THEN RETURN 
17140 SECTION$="SHIPVIA_SECTION"; GOSUB END_XML_SECTION
17900 RETURN 
17999 ! 
18000 TAX_XML:
18005 ! Master Tax XML
18010 SCNT=0,FIRST=0,KS$="" ! KS$="GA30092"
18012 TAX_DEL$="N"
18013 DIM AR5[15]
18015 READ (Z[18],KEY=KS$+"",DOM=*NEXT)
18020 NEXT_AR5:
18030 K$=KEY(Z[18],END=END_TAX); READ (Z[18],KEY=K$)AR5$,AR5{ALL}
18040 ! F K$(1,LEN(KS$))<>KS$ THEN GOTO END_TAX
18045 TAX_PRINT_XML:
18050 IF FIRST=0 THEN FIRST=1; HEADER$="TAX_SECTION"+$09$,TF_VALUE$="Replace="+QUO+RPLC$+QUO+$09$; TP=1,GL=3; GOSUB XML
18055 IF TAX_DEL$="Y" THEN HEADER$="TAX"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(TXCD$))+QUO+" Delete="+QUO+TAX_DEL$+QUO+$09$; TP=1,GL=5; GOSUB XML; GOTO END_TAX_GRP
18060 HEADER$="TAX"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(AR5$(1,10),2))+QUO+" TaxFreight="+QUO+(STP(AR5$(36,1),2))+QUO+" BasedOnTotal="+QUO+"Y"+QUO+" Tax="+QUO+STR(AR5[7])+QUO+" UseTax="+QUO+""+QUO+" Delete="+QUO+TAX_DEL$+QUO+$09$; TP=1,GL=5; GOSUB XML
18062 ! HEADER$="TAX"+$09$; TF_VALUE$="Id="+QUO+FNX$(STP(AR5$(1,10),2))+QUO+" TaxFreight="+QUO+(STP(AR5$(36,1),2))+QUO+" BasedOnTotal="+QUO+(STP(AR5$(36,1),2))+QUO+" Tax="+QUO+(STP(AR5$(183,7),2))+QUO+" UseTax="+QUO+(STP(AR5$(183,7),2))+QUO+" Delete="+QUO+TAX_DEL$+QUO+$09$; TP=1,GL=5; GOSUB XML
18070 HEADER$=HEADER$+"NAME"+$09$,TF_VALUE$=TF_VALUE$+AR5$(11,25)+$09$
18075 HEADER$=HEADER$+"STATE"+$09$,TF_VALUE$=TF_VALUE$+AR5$(119,2)+$09$
18080 HEADER$=HEADER$+"COUNTY"+$09$,TF_VALUE$=TF_VALUE$+AR5$(121,25)+$09$
18085 HEADER$=HEADER$+"CITY"+$09$,TF_VALUE$=TF_VALUE$+AR5$(79,25)+$09$
18090 HEADER$=HEADER$+"ZIP"+$09$,TF_VALUE$=TF_VALUE$+AR5$(109,10)+$09$
18095 COUNTRY$="US"; HEADER$=HEADER$+"COUNTRY"+$09$,TF_VALUE$=TF_VALUE$+"US"+$09$
18100 GL=7; GOSUB XML
18105 END_TAX_GRP:
18110 GHDG$="TAX"; GP=5; GOSUB END_GROUP
18115 IF CCO THEN CCO=0; RETURN 
18120 GOTO NEXT_AR5
18130 END_TAX:
18140 IF FIRST=0 THEN RETURN 
18150 SECTION$="TAX_SECTION"; GOSUB END_XML_SECTION
18160 RETURN 
18900 RETURN 
18999 ! 
19000 SUPPLY_CATALOG_XML:
19005 USING_CAT=0
19010 CALL "ZZ2PRP","OS",RESULT$,TF_DATE$; IF RESULT$="Y" THEN USING_CAT=1 ELSE RETURN 
19020 DIM OSP_PARMS$(512); FIND (Z[13],KEY=%X3$(9,3)+"OSP")OSP_PARMS$
19025 PTYPE$=OSP_PARMS$(219,1)
19030 IF NOT(FN%ISOPENFILE(_OS6,"OS6")) THEN _OS6=GFN; OPEN (_OS6,ERR=END_SUPPLY_CATALOG)"OS6"+%C$
19031 ! _OS6=HFN; OPEN (_OS6)"OS6"+%C$
19040 IF NOT(FN%ISOPENFILE(_OS0,"OS0")) THEN _OS0=GFN; OPEN (_OS0,ERR=END_SUPPLY_CATALOG)"OS0"+%C$
19041 ! _OS0=HFN; OPEN (_0S0)"OS0"+%C$
19050 FIND (_OS6,KEY=CUST$,DOM=*NEXT)OS6$
19060 IF LEN(OS6$)<>0 THEN PTYPE$=OS6$(11,1) ELSE GOTO END_SUPPLY_CATALOG ! READ_NEXT_CUST
19065 DD$=""; CALL "ZZWDTE;TF_TODAY",DD$
19068 IF QFRM$="QCHG" THEN RETURN 
19069 OS0_FOUND=0
19070 GOSUB CATALOG_XML
19100 END_SUPPLY_CATALOG:
19110 CLOSE (_OS6,ERR=*NEXT)
19120 CLOSE (_0S0,ERR=*NEXT)
19150 RETURN 
19199 ! 
19200 CATALOG_XML:
19205 ! OS0_FOUND=0
19210 SECTION$="SUPPLY_CATALOG_SECTION"; GOSUB START_XML_SECTION
19220 READ (_OS0,KEY="",ERR=*NEXT)
19225 CNT=0
19230 NEXT_OS0:
19240 KS$=KEY(_OS0,END=EXIT_CAT_XML); READ (_OS0,KEY=KS$)OS0$
19250 IF POS(MID(OS0$,124,1)="DI")<>0 THEN GOTO NEXT_OS0 ! Ignore deleted/inactive
19255 IF CNT>=100 THEN GOTO EXIT_CAT_XML
19260 GOTO 19280
19265 FIND (Y[35],KEY=KS$,DOM=*NEXT)IOL=FM1_IOL
19270 ! Check if QNET ITEMS AND IS TOPS
19280 CUST_PLANS:
19290 READ (_OS6,KEY=CUST$,DOM=*NEXT)OS6$
19300 IF LEN(OS6$)<>0 THEN PTYPE$=OS6$(11,1)
19310 IF PTYPE$="B" THEN PRICING_TYPE$="Best/Flyers/no Mat" ELSE IF PTYPE$="O" THEN PRICING_TYPE$="List Order" ELSE IF PTYPE$="C" THEN PRICING_TYPE$="Cust Best no Flyer" ELSE IF PTYPE$="L" THEN PRICING_TYPE$="List" ELSE IF PTYPE$="P" THEN PRICING_TYPE$="Cust Best/Flyer" ELSE IF PTYPE$="V" THEN PRICING_TYPE$="Very Best-Matrix/Flyers"; REM ssp 220569
19320 DIM I[20]
19325 ! DIM B$(100); B$(1,10)=A$(1,10); B$(16,6)=X3$(21,6)
19330 PROGRAM$="OS2TAA"
19335 ITEM$=OS0$(1,10)
19350 NEW_COST=0,NEW_PRICE=0; DIM I[40]; CALL "OS2OBC",%X3$,%X4$,ITEM$,I{ALL},CUST$+DIM(5)+DD$,PROGRAM$,NEW_PRICE,PTYPE$,NEW_COST,1; ASELL=NEW_PRICE,PLAN$=PROGRAM$
19355 ! IF ASELL=0 THEN GOTO NEXT_OS0
19360 IF PRICING_TYPE$="List" THEN PLAN$="LIST"
19365 IF PLAN$="" THEN PLAN$="LIST"
19370 IF PLAN$="LIST" THEN GOTO NEXT_OS0
19380 IF OS0_FOUND=0 THEN OS0_FOUND=1; GOTO *NEXT ELSE GOTO OS0_ITEM
19400 HEADER$="",TF_VALUE$=""
19410 ITEM$=OS0$(1,10)
19415 ESSITEM$=STP(OS0$(548,20),2)
19420 HEADER$="SUPPLY_CATALOG"+$09$,TF_VALUE$="Client="+QUO+STP(ECUST$,2)+QUO+" Type="+QUO+"1"+QUO+$09$; TP=1,GL=3; GOSUB XML
19425 ! CALL program OS2OBC FOR Tops items TO CALCULATE BEST PRICE based on price plans and priorities etc
19430 OS0_ITEM:
19435 ITEM$=OS0$(1,10)
19440 ESSITEM$=STP(OS0$(548,20),2)
19445 HEADER$="P"+$09$,TF_VALUE$="Item="+QUO+ESSITEM$+QUO+" Sell="+QUO+STR(ASELL)+QUO+$09$; TP=2,GL=5; GOSUB XML
19450 CNT=CNT+1
19455 GOTO NEXT_OS0
19500 EXIT_CAT_XML:
19502 GHDG$="SUPPLY_CATALOG"; GP=5; GOSUB END_GROUP
19505 SECTION$="SUPPLY_CATALOG_SECTION"; GOSUB END_XML_SECTION
19510 RETURN 
19999 RETURN 
20000 POD_ITEM:
20010 FIND (Z[21],KEY=KS$,DOM=EXIT_POD)ECR$
20020 IF MID(ECR$,255,1)="Y" THEN STKI=0
20030 EXIT_POD:
20050 RETURN 
22000 GITEM_XML:
22003 IF UID="jvv" THEN ESCAPE 
22005 ! All Eqlink Items to upload for the customer
22010 DIM IC0$(228),IC0[33],FM1[31],IC1$(58),IC1[20],P[2]
22020 SECTION$="ITEM_SECTION"; GOSUB START_XML_SECTION
22025 GRP$="ITEMS"; HEADER$="ITEMS"+$09$,TF_VALUE$="ClientId="+QUO+""+QUO+" Replace="+QUO+RPLC$+QUO+$09$; TP=1,GL=5; GOSUB XML
22030 READ (Z[7],KEY="",ERR=*NEXT)
22040 NEXT_GIC0:
22045 IHDR$="",IDTL$="",ICNT=0
22050 KS$=KEY(Z[7],END=EXIT_GITEM); READ (Z[7],KEY=KS$)IOL=IC0_IOL
22060 IF STP(KS$(1,10),2)<>"" THEN GOTO EXIT_GITEM
22062 IF POS(IC0$(118,1)="USC")<>0 THEN GOTO NEXT_GIC0 ! Do not send up Office Supply items
22065 OOITEM$=IC0$(11,10); VI=1 ! OSUB CHECK_VALID_ITEM; IF VI=0 THEN GOTO NEXT_GIC0
22067 ITM_DEL$="N"; CUST$=DIM(10)
22070 GOSUB GITEM_DATA
22078 IF QFRM$="QCHG" THEN RETURN ! JJ
22080 GOTO NEXT_GIC0
22085 ! 
22090 GITEM_DATA:
22095 STKI=0; FIND (Z[7],KEY=KS$,DOM=*NEXT)IOL=IC0_IOL; STKI=1 ! GOSUB POD_ITEM
22100 FIND (Z[13],KEY="U/M"+IC0$(120,4),DOM=*NEXT)P$,P[0],P[1]
22110 IF MID(P$,20,1)<>"Y" THEN SELL_QTY_PER=IC0[14] ELSE SELL_QTY_PER=P[1] ! (SELL_QTY_PER)
22140 ! O_QTY$=STR(RO_QTY),RO_WKS$=STR(RO_WKS),RO_DATE$=FM1$(109,6),RO_SUPPRESS$="N",SUGG_QTY$=STR(SUGG_QTY),CONTACT$="",EMAIL$=""
22150 STATUS$=IC0$(108,1) ! Active status
22160 ! DFLTS$=MID(FM0$,305,1),NEVER_BO$=MID(IC0$,117,1)
22170 UNIT_SELL_PRICE$=STR(IC0[0]),LIST$=STR(IC0[0])
22172 GOTO 22175
22173 HLD_PRECSION=PRECISION; PRECISION 5
22174 SELL_UNIT$=ALTUM$,SELL_QTY_PER$=STR(FM1[28]); IF NUM(UNIT_SELL_PRICE$)<>0 THEN UNIT_SELL_PRICE$=STR(NUM(UNIT_SELL_PRICE$)/FM1[4]),LIST$=UNIT_SELL_PRICE$; END_IF ; PRECISION HLD_PRECISION
22175 IF STKI THEN ITM_TAX$=MID(IC0$,119,1)
22180 ! IF MID(FM0$,283,1)="Y" THEN ALTTAX$=FM0$(224,10) ELSE TAX$=FM0$(224,1) ! Set alt tax if Tax Exempt flag ="Y"
22190 MIN_QTY$=STR(IC0[33])
22200 ! 
22205 GITEM_DATA1:
22210 HEADER$="",TF_VALUE$=""
22220 IF SELL_QTY_PER=0 THEN SELL_QTY_PER=1
22225 ITEM$=IC0$(11,10); QITEM$=ITEM$
22230 CUST$="",DESC1$=IC0$(21,40),DESC2$=MID(IC0$,228,40),SELL_UNIT$=IC0$(120,4),SELL_QTY_PER$=STR(IC0[14]),CATALOG$=MID(IC0$,118,1)
22232 ! CUST$=FM1$(1,10),ITEM$=FM1$(11,10),DESC1$=FM1$(42,40),DESC2$=MID(IC0$,228,40),SELL_UNIT$=FM1$(100,4),SELL_QTY_PER$=STR(FM1[14]),CATALOG$=MID(IC0$,118,1)
22235 ! REVISION$=MID(FM1$,167,6)
22242 HEADER$="ITEM"+$09$,TF_VALUE$="Id="+QUO+FNX$(STP(QITEM$,2))+QUO+"  Delete="+QUO+ITM_DEL$+QUO+" Upload="+QUO+"Y"+QUO+$09$; TP=1,GL=7; GOSUB XML
22250 IF ITM_DEL$="Y" THEN GOTO END_OF_ITEM
22280 HEADER$=HEADER$+"DESC1"+$09$,TF_VALUE$=TF_VALUE$+DESC1$+$09$
22290 ! HEADER$=HEADER$+"DESC2"+$09$,TF_VALUE$=TF_VALUE$+DESC2$+$09$
22292 GL=9; GOSUB XML
22300 HEADER$="UNIT"+$09$,TF_VALUE$="Desc="+QUO+FNX$(STP(SELL_UNIT$,2))+QUO+" Uom="+QUO+FNX$(STP(SELL_QTY_PER$,2))+QUO+$09$; TP=2,GL=9; GOSUB XML
22320 IF STKI THEN GOSUB STOCK_ITEM
22325 GL=9; GOSUB XML
22360 ! HEADER$=HEADER$+"INACTIVE"+$09$,TF_VALUE$=TF_VALUE$+STATUS$+$09$
22370 IF MID(IC0$,118,1)="1" THEN HEADER$="SUPPLY_CATALOG "+$09$,TF_VALUE$="Type="+QUO+"1"+QUO+$09$; TP=2,GL=9; GOSUB XML ! Check in IC0 if a Tops Item
22390 ! OSUB ITEM_REORDER
22400 IF STATUS$="I" THEN HEADER$=HEADER$+"OBSOLETE"+$09$,TF_VALUE$=TF_VALUE$+"N"+$09$,TP=2; GL=9; GOSUB XML ! Only print if obsolete/inactive
22415 ! HEADER$=HEADER$+"ALLOW_ATTACHMENT"+$09$,TF_VALUE$=TF_VALUE$+""+$09$
22420 ! HEADER$=HEADER$+"SECURE"+$09$,TF_VALUE$=TF_VALUE$+""+$09$
22430 IF NEVER_BO$="Y" THEN HEADER$=HEADER$+"NO_BACKORDERS"+$09$,TF_VALUE$=TF_VALUE$+""+$09$
22432 GL=9; GOSUB XML
22435 IF ITM_TAX$="E" THEN HEADER$=HEADER$+"ALTERNATE_TAX"+$09$,TF_VALUE$=TF_VALUE$+""+$09$,TP=2; GL=9; GOSUB XML ! Only print if Item is tax exempt
22440 DIM FM1$(200); FM1$(100,4)=IC0$(120,4); GOSUB UNIT_SELL
22450 GOTO 22510
22460 HEADER$=HEADER$+"MIN_QTY"+$09$,TF_VALUE$=TF_VALUE$+EMAIL$+$09$
22470 HEADER$=HEADER$+"MAX_QTY"+$09$,TF_VALUE$=TF_VALUE$+EMAIL$+$09$
22480 HEADER$=HEADER$+"EXTRA_FREIGHT"+$09$,TF_VALUE$=TF_VALUE$+EMAIL$+$09$
22490 IF STP(REVISION$,2)<>"" THEN HEADER$=HEADER$+"REVISION"+$09$,TF_VALUE$=TF_VALUE$+""+$09$
22500 HEADER$=HEADER$+"FREIGHT_EXEMPT"+$09$,TF_VALUE$=TF_VALUE$+EMAIL$+$09$
22510 GL=9; GOSUB XML ! GOSUB GRPEND
22520 GOTO END_OF_GITEM
22640 ! 
22959 ! 
23200 END_OF_GITEM: GHDG$="ITEM"; GP=7; GOSUB END_GROUP
23210 RETURN 
23240 ! 
23250 EXIT_GITEM:
23260 GHDG$="ITEMS"; GP=5; GOSUB END_GROUP
23270 SECTION$="ITEM_SECTION"; GOSUB END_XML_SECTION
23280 RETURN 
23299 ! 
56000 REM "307387-EQLink DBD Bridge to Qnet                                   
