0010 REM "Create Reorder Notice Record for Customer <FM2UZC>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 11/17/10 - 9.804166 - dmm - SSP# 241487
0036 REM "MOD FOR SUGG REORDER QTY, FORM NOTES
0037 REM "241487-Calculate suggested order qty for RON based on accumulated  
0040 REM "Copyright 2010 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR 
0110 REM "A0$=CUSTOMER/FORM, A1$=SPARE, A1= (1=FROM MANUAL MAINT)
0115 REM "A1=1 MEANS MAINTENANCE, A1=0 MEANS FM2RRA
0116 REM "A1=5 MEANS CALLED BY FM2SSB, DO NOT UPDATE FM5
0118 SETERR 0121
0120 ENTER X3$,A0$,A1$,A1,L$,L{ALL}; GOTO 0125
0121 IF ERR<>36 THEN EXIT ERR ELSE IF A1=5 THEN EXIT ERR
0125 SETERR 9000
0130 DIM S$(20)
0135 REM "A3$ IS THE REASON THE NOTICE WAS GENERATED
0140 Q=POS("\"=A1$); IF Q>0 THEN A3$=A1$(Q+1),A1$=A1$(1,Q-1)
0270 DEF FNS$(Z9$)=Z9$(1,POS("  "=Z9$+"  ")-1)
0300 REM "IOLISTS
0305 IOLIST AR1$,AR1[0],AR1[1],AR1[2],AR1[3],AR1[4],AR1[5],AR1[6],AR1[7],AR1[8],AR1[9],AR1[10],AR1[11],AR1[12],AR1[13],AR1[14],AR1[15]
0310 IOLIST A$
0320 IOLIST B$,B0$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20],C[21],C[22],C[23],C[24],C[25],C[26],C[27],C[28],C[29],C[30],C[31]
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8]
0380 IOLIST H$
0390 IOLIST I$,I[0],I[1],I[2],I[3],I[4]
0410 IOLIST L$,L[0],L[1],L[2],STR(L[3]:"000"),L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15],L[16],L[17],L[18],L[19],L[20]
0420 IOLIST L$,L[0],L[1],L[2],L[3],L[4],L[5],L[6]
0450 DIM A$(60),A[14],B$(45),B[5],C$(195),C[20],M[24],N[24],K[14]
0459 ! [202990]-Added the IOLIST for XPE at line 460
0460 IOLIST XPE$
0465 DIM XPE[1]
0500 REM "FILES
0505 Z=NUM(X3$(60,3)); DIM Z[Z]
0510 Z$="01O FM1...  02O FSW...  03O FM5... 04O FMP... 05O FM4...  06O IC1... 07O FMG... 08O FM0... 09O FMI... 10O FS0...  11O AR1...  "
0515 Z$=Z$+"13O ZZPARM  "
0517 Z$=Z$+"14O XPE...  " ! [202990] open XPE
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 0521,9900
0550 DIM S9$(60),S[3]; READ (Z[13],KEY=X3$(9,3)+"FMS")S9$(1),S[0],S[1],S[2]
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0600 REM "
0610 FIND (Z[13],KEY=X3$(9,3)+"F/M")P$
0620 READ (Z[13],KEY="STAT"+"F/M")F9$,F0
0630 Q9$=FNS$(F9$(8,20))
0700 FOR X=0 TO 9; F8$=F8$+F9$(49+X*17,5); NEXT X
1000 REM "GET FORM MASTERFILE RECORD
1020 DIM C[31]; READ (Z[1],KEY=A0$,DOM=9900)IOL=0330
1030 DIM G$(120); READ (Z[10],KEY=A0$,DOM=1031)G$
1050 REM "GET CUSTOMER DEFAULTS
1060 DIM I4$(300); READ (Z[4],KEY="D"+A0$(1,10))I4$(1)
1070 IF POS(I4$(61,1)="CP")>0 THEN S9$(13,1)=I4$(61,1)
1080 REM "READ CUSTOMER MASTER FOR RON NUMBER OF MONTHS SSP 166931
1090 DIM AR1[15]; READ (Z[11],KEY=A0$(1,10),DOM=*NEXT)IOL=0305
1200 REM 
1210 GOSUB 5000; IF A2$="" THEN A2$=A0$
1215 DIM C[31]; READ (Z[1],KEY=A0$)IOL=0330; Y0=Y0+C[24]
1220 GOSUB 8800
1240 GOSUB 8600
1250 GOSUB 8700
1890 GOTO 9900
5000 REM "GATHER OTHER CUSTOMER CODES
5005 A2$=A0$
5010 READ (Z[7],KEY=A0$(1,20),DOM=5011)
5020 X$=KEY(Z[7],END=5090); IF MID(X$,1,20)<>A0$ THEN GOTO 5090 ELSE READ (Z[7])
5030 IF A2$(1,10)<>X$(21,10) AND X$(21,10)<>"          " THEN A2$=A2$+X$(21,10)+X$(11,10); DIM C[31]; READ (Z[1],KEY=X$(21,10)+X$(11,10),DOM=5031)IOL=0330; Y0=Y0+C[24]
5040 GOTO 5020
5095 RETURN 
7700 REM "CREATE FMI RECORD
7702 MULTIPLIER=0
7710 DIM I$(250),I[4]
7711 I$(1)=A0$
7712 I[0]=C[21]; REM "IF I4$(196,1)="1" OR X3$(9,3)="055" THEN LET I[0]=C[21]
7713 IF P$(307,2)<>DIM(2) THEN MULTIPLIER=NUM(P$(307,2)); REM " SSP# 166931
7716 IF AR1$(434,2)<>DIM(2) THEN MULTIPLIER=NUM(AR1$(434,2)); REM " SSP# 166931
7717 IF C$(196,2)<>DIM(2) THEN MULTIPLIER=NUM(C$(196,2)); REM " SSP# 166931
7724 AMU=C[24]; IF P$(331,1)="Y" THEN AMU=Y0 ! WO241487, average monthly usage for calculation of RON suggested order quantity, if parm set use accumulated amt
7725 IF P$(253,1)="M" AND MULTIPLIER>0 AND C[21]=0 THEN I[0]=MULTIPLIER*AMU; REM " SSP #160722, WO241487-replace C[24] with AMU
7726 IF C[21]=0 THEN IF P$(253,1)="Y" THEN IF C[22]>0 THEN I[0]=C[22]/30*AMU; REM "ssp#79776, WO241487-replace C[24] with AMU
7728 I[3]=MULTIPLIER*30; REM "SSP# 168558
7740 I$(25,1)="1",I$(26,60)=G$(21,60)
7750 IF LEN(I4$)>135 THEN I$(86,60)=I4$(135,60)
7755 IF I4$(130,3)="   " THEN GOTO 7770 ELSE FIND (Z[4],KEY="g"+I4$(130,3),DOM=7770)Q$
7760 I$(146,60)=Q$(40,60)
7790 WRITE (Z[9],KEY=I$(1,24))IOL=0390
7795 RETURN 
7900 REM "CALC DYS SUPPLY ON HAND
7910 Q$=L$(51,6),Q=0; CALL "YDYSBT",ERR=7911,X3$,L$(27,6),Q$,Q
7915 IF Q>0 THEN L[3]=Q
7945 RETURN 
8100 REM "SET USAGE HIST FOR GRAPH (I.E. LAST P0 PERIODS)
8102 IF I4$(24,1)<>"Y" THEN GOTO 8190
8105 IF S9$(13,1)="C" THEN FOR X=1 TO 13; L[6+X]=J[X]; NEXT X; GOTO 8180
8110 READ (Z[4],KEY="E"+A0$(1,10)+I4$(52,4),DOM=9400)P1$; P0=NUM(P1$(16,2))
8115 P2=NUM(I4$(56,2)),P1=P2+13
8120 FOR X=P0 TO 1 STEP -1
8125 L[6+X]=J[P1],P1=P1-1,P2=P2-1
8130 IF P2=0 THEN P1=P0
8140 NEXT X
8190 RETURN 
8200 REM "GET INVENTORY QTY
8210 READ (Z[6],KEY=A0$(1,20),DOM=8211)
8220 DIM F[8]; READ (Z[6],END=8280)IOL=0360; IF F$(1,20)<>A0$(1,20) THEN GOTO 8280
8225 READ (Z[8],KEY="D"+S$(1,10)+F$(21,4),DOM=8220)IOL=0380; IF H$(234,1)="Y" THEN GOTO 8220
8230 Y1=Y1+F[3]+F[4]-F[5]+F[6]-F[7]*NUM(I4$(133,1))
8240 GOTO 8220
8295 RETURN 
8500 REM "UPDATE LOW STOCK NOTICE
8502 GOTO 8590
8505 IF I4$(112,1)=" " THEN GOTO 8590
8510 DIM L[20]; L$="L"+I4$(112,1)
8520 L$=L$+B$(1,24)+X3$(21,6)+S$(1,12)+B$(83,6)
8530 L[1]=B[0],L[2]=B[3]+B[4]
8540 L[4]=B[1],L[5]=B[2]
8585 WRITE (Z[11],KEY=L$(1,26))IOL=0410
8590 IF B$(27,1)="R" THEN GOSUB 8100
8595 RETURN 
8600 REM "UPDATE REORDER NOTICE
8602 DIM L[20],L$(80); GOTO 8606
8605 IF S9$(12,1)<>"Y" OR I4$(108,1)=" " THEN GOTO 8690 ELSE DIM L[20]
8620 L$(1)="R"+I4$(108,1)+C$(1,10)+"    "+C$(11,10)+X3$(21,6)+S$(1,12)+C$(126,6)+C$(109,6)+I4$(52,6)
8621 L$(64,17)=A3$; IF A1$>"" THEN L$(51,6)=A1$(1,6),Y0=NUM(A1$(7))
8622 GOSUB 8200
8625 L[0]=C[16]
8630 L[1]=Y0,L[2]=Y1
8635 IF Y0<>0 THEN L[3]=INT(L[2]*30/Y0); IF L[3]>999 THEN L[3]=999 ELSE IF L[3]<0 THEN L[3]=0
8640 L[4]=C[22],L[5]=C[23]
8650 GOSUB 8100
8652 IF A1<>1 THEN GOSUB 7700
8653 IF A1=0 THEN GOSUB 7900
8680 L$(63,1)=STR(A1:"0")
8685 IF A1<>5 THEN WRITE (Z[3],KEY=L$(1,26))IOL=0410
8690 RETURN 
8700 REM "UPDATE FORM WITH AVG USAGE
8710 EXTRACT (Z[1],KEY=A0$(1,20))IOL=0330
8720 Q0=L[2],Y0=L[1]; REM "ON HAND
8730 Q9=0; IF C[22]>0 AND Y0<>0 THEN IF C[22]>=Q0/(Y0/30) THEN GOTO 8780
8735 Q9=1; IF C[23]>0 THEN IF Q0<=C[23] THEN GOTO 8780
8740 Q9=2; IF C$(109,6)<>"      " THEN IF C$(109,6)<X3$(15,6) THEN GOTO 8780
8750 Q9=3
8780 REM "REORDER NOTICA
8785 C$(254,7)="3"+X3$(21,6); IF Q9=0 THEN C$(261,30)="Reorder pt in days" ELSE IF Q9=1 THEN C$(261,30)="Reorder Pt in Qty" ELSE IF Q9=2 THEN C$(261,30)="Manual Reorder Date" ELSE C$(261,30)="Manual Selection"
8790 WRITE (Z[1],KEY=A0$(1,20))IOL=0330; IF RT_PARM$<>"" THEN CUST$=A0$(1,10); CALL "RT2WOC",ERR=8791,X3$,X4$,CUST$,"FM1...","U",A0$(1,20)
8795 RETURN 
8800 REM "CALCULATE AVG USAGE FOR FORM TOTAL
8805 Y1=0; DIM J[28]
8808 IF A2$="" THEN GOTO 8890 ELSE X$=A2$(1,20),A2$=A2$(21)
8809 B$=X$; GOSUB 8900
8810 READ (Z[5],KEY=X$,DOM=8811)
8815 DIM B[8]; READ (Z[5],END=8808)IOL=0320; IF B$(1,20)<>X$ THEN GOTO 8808
8825 IF B$(26,1)="Y" THEN Y1=Y1+B[3]+B[4]
8840 GOTO 8815
8860 GOTO 8810
8890 Y0=INT(Y0),Y1=INT(Y1)
8895 RETURN 
8900 REM "GET USAGE STATS FOR THIS CUSTOMER AND LOCATION
8902 IF S9$(13,1)="C" THEN GOTO 8950
8904 REM "PRIOR X MONTHS METHOD
8905 FOR Z=0 TO 1
8910 F2$=B$(1,20)+STR(NUM(I4$(52,4))-Z:"0000")
8920 DIM K[14]; CALL "ZZPACK",X3$,"R","","",0,0,K{ALL},Z[2],"U",F2$,F9$
8925 FOR X=1 TO 13; J[13+X-Z*13]=J[13+X-Z*13]+K[X]; NEXT X
8930 NEXT Z
8945 RETURN 
8950 REM "CURRENT YEAR METHOD GRAPH
8960 F2$=B$(1,20)+I4$(52,4)
8965 DIM K[14]; CALL "ZZPACK",X3$,"R","","",0,0,K{ALL},Z[2],"U",F2$,F9$
8970 FOR X=1 TO 13; J[X]=J[X]+K[X]; NEXT X
8995 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,"FM2UZC",Y7$,X3$,Y5,Y6,Y7,Y8,1
9045 REM 
9050 ON Y7 GOTO 9060,9100,9190,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOSUB 6600; GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9400 COUNT=0,PCOUNT=0,PYEAR=NUM(I4$(52,4)); REM "MISSING FYE RECORD
9401 PYEAR=PYEAR-1,CYEAR=NUM(I4$(52,4)); PCOUNT=PCOUNT+1; IF PCOUNT=2 THEN GOTO 9418
9402 READ (Z[4],KEY="E"+A0$(1,10)+STR(PYEAR):"0000",DOM=9401)PRIORYR$
9403 PEREND$=PRIORYR$(NUM(PRIORYR$(11+5,2))*6+18,6),Y=NUM(PRIORYR$(11+1,4))+1,NEWYR$=PRIORYR$
9404 NEWYR$(11+7,LEN(PEREND$))=PEREND$,NEWYR$(11+1,4)=STR(PYEAR+1)
9405 CALL "FM2UBZ",X3$,"",NEWYR$,11
9406 WRITE (Z[4],KEY=NEWYR$(1,15),DOM=9407)NEWYR$; GOSUB CUSTOMER_FISCAL_YEAR ! [202990] update XPE
9407 READ (Z[4],KEY="E"+A0$(1,10)+STR(PYEAR),DOM=9408)PRIORYR$; P0=NUM(PRIORYR$(16,2)); REM " RETURN 
9409 IF PRIORYR$(12,4)=I4$(52,4) THEN GOTO 9417
9411 PYEAR=PYEAR+1
9412 COUNT=COUNT+1; IF COUNT=2 THEN GOTO 9419
9413 GOTO 9402
9417 RETURN 
9418 IF %IN_WEBEC$="Y" THEN %REORDER_TYPE=0; GOTO 9900
9419 Q$="Missing calendar for cust:"+A0$(1,10)+" yr "+I4$(52,4)+". Setup on another terminal!"
9420 CALL "ZZPROM","5",X3$,Q,Q$,"","",0; IF Q=0 THEN GOTO 8110
9440 EXIT 11
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
9790 RETURN 
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9940 EXIT 
9999 END 
10000 REM + Begin Customer Fiscal Year (XPE)
10001 CUSTOMER_FISCAL_YEAR:
10020 XPE$=NEWYR$
10040 CALL "UPDFMP;DUPLICATE_XPE",Z[14],XPE$,XPE{ALL},"U"
10095 RETURN 
10099 REM + End Customer Fiscal Year (XPE)
56000 REM + Modification History
56001 REM "5.5 - 12/14/06 - 14.415833 - mhe - SSP# 202990
56002 REM "202990-Modify FM2UZC to also call UPDFMP to update XPE after       
56004 REM "241487-Calculate suggested order qty for RON based on accumulated  
