0010 REM "Re-construct prior order data from FS6  <FM2UT7>
0015 REM "Prog Type: I -2.9     
0020 SETESC 9300; SETERR 9000
0035 REM "4.1 - 02/14/97 - 16.02 - kmc
0040 REM "Copyright 1997 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000; SETESC 9300
0101 SETESC 0000
0110 X0$="FM2UT7",X1$="Fix Prior Order Data"
0120 DIM S$(20)
0130 K0=9,K1=1
0135 C9=-1,V9=-2
0140 M0$="#####,##0-"
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(65,1)>"2" THEN PRECISION NUM(X3$(65,1),ERR=0246)
0300 REM "IOLISTS
0309 REM "Update IOL 330 in FM2IAU also
0310 IOLIST A$(1,LEN(A$)),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],IOL=0312
0312 IOLIST A[21],A[22],A[23],A[24],A[25],A[26],A[27],A[28],A[29],A[30],A[31]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7]
0330 IOLIST C$
0340 IOLIST D$,D[0],D[1],D[2]
0341 IOLIST D1$
0350 IOLIST E$
0360 IOLIST F$,F[0],F[1]
0390 IOLIST I$,I0$,I[0],I[1],I[2],I[3],I[4],I[5],I[6]
0411 IOLIST K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],K[8],K[9],K[10],K[11],K[12],K[13]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O FM1...  02O FS6... "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0600 REM "
0620 GOSUB 6000
0640 CALL "ZZPROM","Y",X3$,S3,"Do you wish to proceed with the re-build?","","",0; ON S3 GOTO 0641,9900
0800 REM 
1000 REM "GET NEXT FORM CODE
1010 DIM A[31],A$(325)
1020 READ (Z[1],END=5000)IOL=0310
1040 PRINT @(12,12),"Checking: ",A$(1,10),"...",A$(11,10),
1200 REM "CHECK FOR PRIOR ORDER
1210 DIM B[7]
1220 K1$=A$(1,10)+"B"+A$(11,10),B1$=""
1230 READ (Z[2],KEY=K1$,DOM=1231)
1240 READ (Z[2],END=1400)IOL=0320
1250 IF B$(1,21)<>K1$ THEN GOTO 1400
1255 IF B$(48,6)="      " THEN GOTO 1240
1260 IF B1$="" THEN B1$=B$; GOTO 1240
1270 IF B$(34,6)>B1$(34,6) THEN B1$=B$; GOTO 1240
1280 GOTO 1240
1400 REM 
1410 IF B1$="" THEN GOTO 1000
1500 REM "GET OLDEST RECORD
1510 READ (Z[2],KEY=B1$(1,30))IOL=0320
1520 IF B$(22,8)=A$(132,8) THEN GOTO 1000
1550 EXTRACT (Z[1],KEY=A$(1,20))IOL=0310
1600 REM "SET VALUES
1620 A$(96,8)=B$(101,4)+B$(101,4)
1630 A$(126,6)=B$(34,6)
1635 A$(132,8)=B$(22,8)
1640 REM "NUMBERING NOT KNOWN
1645 A$(149,12)=B$(69,12)
1650 IF B$(69,12)<>S$(1,12) THEN A$(161,6)=B$(34,6); REM "PLUG JOB DATE AS ORDER DATE
1660 A[1]=B[4]
1665 A[2]=B[2]
1670 A[3]=B[1]
1675 A[4]=B[2]
1680 A[16]=B[0]
1685 A[17]=B[3]
1700 REM 
1720 WRITE (Z[1],KEY=A$(1,20))IOL=0310; IF RT_PARM$<>"" THEN CUST$=A$(1,10); CALL "RT2WOC",ERR=1721,X3$,X4$,CUST$,"FM1...","U",A$(1,20)
1790 GOTO 1000
4100 REM "GET STAT RECORD  FOR PERIOD P$
4105 P=POS(U0$=F9$(49),17),F8$=F9$(50+P,3)
4110 F2$=K$(1,28)
4130 DIM K[24]
4140 CALL "ZZPACK",X3$,"R",F8$+"","",0,0,K{ALL},F1,U0$,F2$,F9$
4195 RETURN 
5020 GOTO 9900
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6060 PRINT @(0,5),"This program will rebuild the previous order data in"
6061 PRINT "the Item Masterfile with the information in the order history"
6062 PRINT "file (FS6).  BE SURE TO BACKUP PRIOR TO PROCEEDING!"
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
9000 REM "ERROR PROCESSING
9001 ESCAPE 
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9940 RUN "ZMENU"
9999 END 
