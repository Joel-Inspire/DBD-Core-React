0010 REM "Remove Order History Detail <FM2ROD>
0015 REM "Prog Type: IR-2.5     
0020 SETESC 9300; SETERR 9000
0035 REM "4.1 - 02/09/98 - 17.77 - dmm - SSP# 089903
0040 REM "Copyright 1997 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000; SETESC 9300
0110 X0$="FM2ROD",X1$="Remove Order History Detail"
0120 DIM Z0$(80,"-")
0130 K0=18,K1=1
0135 C9=-1
0140 M0$="#0"
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0250 X2=2
0298 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0330 IOLIST C$
0350 IOLIST E$
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O ARU...  02O FS6...  03OSFS6...  05O ASJ...  07O FS7...  08O FS8...  09O FS9...  10L FS1... 11O FSY...  13O ZZPARM  "
0520 GOSUB 9750; ON Z0 GOTO 0521,9900
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0600 REM 
0610 GOSUB 6000
1000 REM "
1010 Y8=1; CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
1035 DIM A$(40),A[1]; A$(5,4)="~~~~",A$(19,10)="~~~~~~~~~~",A$(29,4)="YYYY",A$(39,1)="Y"
1090 GOSUB 6200
1100 REM 
1110 GOTO 2000
1800 REM "
1820 CALL "ZZPROM","0",X3$,Z,"","","V",X0
1825 ON Z+1 GOTO 1850,3000,9900,2000
1850 REM "MODIFY
1855 X0=X0-1
2000 REM "DATA SEQ
2010 C0=0,X0=-1,X1=1,C9=1
2020 SETERR 9000; X$="",Q$="",C0=ABS(C0),X0=X0+1; IF C0=2 THEN IF X0>0 THEN X0=X0-2
2025 IF INT(C0)=3 THEN GOSUB 7300 ELSE IF C0>3 OR X0<0 THEN GOTO 1800
2038 IF X0<LEN(V7$) THEN V7$(X0+1,1)=""
2040 ON X0 GOTO 2100,2150,2200,2250,2350,2400,2650,2450,2500,2600,2300,2550,1800
2110 CALL "ZZENTR","SUF>",A{ALL},A$,X4$,X3$,26,4,1,4,C0,"","{5"+X$,"","FM2ROD00","AR3","",""; IF ABS(C0)>4 THEN GOTO 9900
2140 GOTO 2020
2160 CALL "ZZENTR","SUF<",A{ALL},A$,X4$,X3$,42,4,5,4,C0,"","{5"+X$,"","FM2ROD02","AR3","",""; IF ABS(C0)>4 THEN GOTO 9900
2190 GOTO 2020
2210 CALL "ZZENTR","AUF>",A{ALL},A$,X4$,X3$,26,5,9,10,C0,"A/R","{5"+X$,"","FM2ROD04","AR1","",""; IF ABS(C0)>4 THEN GOTO 9900
2240 GOTO 2020
2260 CALL "ZZENTR","AUF<",A{ALL},A$,X4$,X3$,42,5,19,10,C0,"A/R","{5"+X$,"","FM2ROD06","AR1","",""; IF ABS(C0)>4 THEN GOTO 9900
2290 GOTO 2020
2300 REM "REMOVE ORDERS BEFORE
2310 CALL "ZZENTR","D",A{ALL},A$,X4$,X3$,60,11,33,6,C0,"","{3"+X$,"","FM2ROD08","","",""
2340 GOTO 2020
2350 REM "Custom forms?
2360 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,37,8,29,1,C0,"","{3"+X$,"","FM2ROD10","","",""
2390 GOTO 2020
2400 REM "Inventory?
2410 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,37,9,30,1,C0,"","{3"+X$,"","FM2ROD12","","",""
2440 GOTO 2020
2450 REM "Customer inventory?
2460 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,60,8,31,1,C0,"","{3"+X$,"","FM2ROD14","","",""
2490 GOTO 2020
2500 REM "NONSTOCK?
2510 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,60,9,32,1,C0,"","{3"+X$,"","FM2ROD16","","",""
2540 GOTO 2020
2550 REM "MINIMUM # ORDERS TO KEEP
2560 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,36,12,0,200,C0,M0$,"{3"+X$,"","FM2ROD18","","",""
2590 GOTO 2020
2600 REM "OTHER
2610 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,60,10,39,1,C0,"","{3"+X$,"","FM2ROD17","","",""
2640 GOTO 2020
2650 REM "Message types
2660 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,37,10,40,1,C0,"","{3"+X$,"","FM2ROD20","","",""
2690 GOTO 2020
3000 REM "REMOVE DETAIL
3002 CALL "ZZPROM",".9",X3$,Z,"","","",0; ON Z GOTO 3003,9900
3005 EXTRACT (Z[1],KEY=A$(1,4),DOM=3006)
3010 K$=KEY(Z[1],END=3090); READ (Z[1])
3020 REM "CHECK TO SEE IF IN SALESPERSON RANGE
3025 IF K$(1,4)>A$(5,4) THEN GOTO 3090
3026 PRINT @(26,16),K$(1,4),"   --   ",
3030 REM "CHECK CUSTOMER TO SEE IF IN CUSTOMER RANGE
3035 IF K$(5,10)<A$(9,10) THEN EXTRACT (Z[1],KEY=K$(1,4)+A$(9,10),DOM=3010); GOTO 3010
3040 IF K$(5,10)>A$(19,10) THEN READ (Z[1],KEY=K$(1,4)+"~~~~~~~~~~",DOM=3010); GOTO 3010
3045 CALL "ZZDISP","AU",K$(5,10),"A/R",X3$,"","",38,16,X4$
3050 GOSUB 3100
3060 GOTO 3010
3090 REM "FINISHED
3095 GOTO 9900
3100 REM "REMOVE DETAIL FOR 1 CUSTOMER: K$(5,10)
3105 REM "PROCESS CUSTOMER FOR EACH TYPE IN THE STRING A5$
3110 GOSUB 3200
3115 FOR I=1 TO LEN(A5$)
3120 READ (Z[2],KEY=K$(5,10)+A5$(I,1),DOM=3125)
3125 REM "GO THRU UNTIL FORM TYPE ENDS, PROCESSING ON EACH FORM CODE BREAK
3130 B0$="",B1$="",B0=0
3140 K0$=KEY(Z[2],END=3180); READ (Z[2])D0$
3145 IF K0$(1,10)<>K$(5,10) THEN GOTO 3180
3150 IF K0$(11,1)<>A5$(I,1) THEN GOTO 3180
3160 IF K0$(12,10)<>B0$ THEN GOSUB 3300
3162 FIND (Z[10],KEY=K0$(22,8),DOM=3163); GOTO 3140
3165 B0=B0+1; GOSUB 7500
3170 CALL "ZZDISP","AU",K0$(22,8),"O/P",X3$,"","",38,18,X4$
3175 GOTO 3140
3180 GOSUB 3300; REM " TO CLEAR FINAL TOTALS
3185 NEXT I
3190 RETURN 
3200 REM "Create type string A5$ from info in A$
3205 A5$=""
3210 IF A$(29,1)="Y" THEN A5$=A5$+"B"
3215 IF A$(30,1)="Y" THEN A5$=A5$+"F"
3220 IF A$(31,1)="Y" THEN A5$=A5$+"D"
3225 IF A$(32,1)="Y" THEN A5$=A5$+"H"
3230 IF A$(39,1)="Y" THEN A5$=A5$+"J"
3235 IF A$(40,1)="Y" THEN A5$=A5$+"M"
3240 RETURN 
3300 REM "PROCESS A FORM, GIVEN B1$ KEY OF STRINGS AND B0 COUNT
3305 IF B0$="" THEN GOTO 3380
3310 REM "IF B0 COUNT < MINIMUM THEN NONE TO REMOVE
3315 IF B0<=A[0] THEN GOTO 3380
3320 REM "SET B1 TO # TO REMOVE
3325 B1=B0-A[0]
3330 REM "REMOVE B1 RECORDS, READ EACH KEY AND THEN COMPARE DATE TO DATE TO REMOVE
3331 REM "IF LESS THAN OR EQUAL TO REMOVE DATE, REMOVE AND DECREMENT B1
3332 REM "DO UNTIL B1 IS ZERO. DEVICE Z(3) IS USED SO THE ORDER ON Z(2) IS NOT DISTURBED
3335 IF B1=0 OR B1$(1,5)="~~~~~" THEN GOTO 3370
3340 K1$=B1$(1,30),B1$=B1$(31),D2$=D1$(1,6),D1$=D1$(7)
3350 REM "CHECK DATE
3355 IF D2$<A$(33,6) THEN GOSUB 3400; B1=B1-1
3360 GOTO 3335
3380 B0$=K0$(12,10),B0=0; DIM D1$(6,"~"),B1$(30,"~")
3385 B9$=FNS$(B0$); PRINT @(20,18),'CL',@(30-LEN(B9$),18),B9$,"   --   ",
3390 RETURN 
3400 REM "REMOVE THE C$ RECORD FROM THE FILE ON Z(3)
3410 REM " REMOVE FS6 (FROM Z(3)),FS7, FS8, FSY RECORDS
3412 READ (Z[3],KEY=K1$)C$
3420 REMOVE (Z[7],KEY=C$(31,3)+C$(11,1)+C$(12,10)+C$(1,10)+C$(22,8)+C$(30,1),DOM=3421)
3425 REMOVE (Z[8],KEY=C$(1,10)+C$(22,8)+C$(11,1)+C$(12,10)+C$(30,1),DOM=3426)
3427 CALL "FM2ODS",X3$,C$,"D"
3430 IF POS(A5$(I,1)="HM")>0 THEN REMOVE (Z[9],KEY=C$(22,8)+C$(12,10)+C$(30,1),DOM=3431)
3435 GOSUB 7650
3480 REMOVE (Z[3],KEY=C$(1,30),DOM=3481)
3481 IF RT_PARM$<>"" THEN CUST$=C$(1,10); CALL "RT2WOC",ERR=3482,X3$,X4$,CUST$,"FS6...","D",C$(1,30)
3485 GOSUB 3600
3490 RETURN 
3600 REM "Remove ASJ - Order Shipment History Records
3620 X$=C$(1,10)+C$(22,9)
3640 READ (Z[5],KEY=X$,DOM=3641)
3650 READ (Z[5],END=3690)IOL=0350
3660 IF E$(1,LEN(X$))<>X$ THEN GOTO 3690
3670 REMOVE (Z[5],KEY=E$(1,28),DOM=3671)
3680 GOTO 3650
3690 RETURN 
4910 IF R0$>"" THEN R0$(1,7)="IT",R0$(8,1)="N" ELSE DIM R0$(30); R0$(1,2)="IT",R0$(8,1)="N",R0$(8,9)="NNN    66"; GOSUB 6700
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6025 PRINT @(26,3),"Starting",@(42,3),"Ending",
6030 PRINT @(9,4),"Salesperson:",@(5,5),"Customer number:",@(0,6),Z0$,
6040 PRINT @(0,8),"Item types to remove:",@(23,8),"Custom forms?",@(40,8),"Customer inventory?",@(26,9),"Inventory?",@(27,10),"Messages?",@(49,9),"Non-Stock?",@(53,10),"Other?",
6050 PRINT @(9,11),"Remove closed orders with order date on or before:",
6060 PRINT @(9,12),"BUT always retain at least     closed orders.",
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6220 CALL "ZZDISP","SU> ",A$(1,4),"",X3$,"","",26,4,X4$
6222 CALL "ZZDISP","SU< ",A$(5,4),"",X3$,"","",42,4,X4$
6224 CALL "ZZDISP","AU> ",A$(9,10),"A/R",X3$,"","",26,5,X4$
6226 CALL "ZZDISP","AU< ",A$(19,10),"A/R",X3$,"","",42,5,X4$
6250 PRINT @(37,8),A$(29,1),@(37,9),A$(30,1),@(37,10),A$(40,1),@(60,8),A$(31,1),@(60,9),A$(32,1),@(60,10),A$(39,1),
6260 CALL "ZZDISP","D",A$(33,6),"",X3$,"","",60,11,X4$
6270 PRINT @(36,12),STR(A[0]:M0$),
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>=0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6455 IF C9<0 THEN GOTO 6445
6490 RETURN 
6500 REM "DELETE
6510 REMOVE (Z[1],KEY=A1$,DOM=6511)
6590 GOTO 1630
6700 REM "ADD ENTRY
6705 IF Z9=0 THEN GOTO 6790 ELSE IF V7$>"" THEN X0=POS(" "<>V7$); IF X0>0 THEN X0=X0-1; GOTO 2038
6708 IF R0$="" THEN CALL "ZZRPTO",X3$,X4$,Y0$,R0$,R{ALL},4,C0,X0
6710 WRITE (Z[1],KEY=A1$)IOL=0310,IOL=0490
6790 Z9=2; RETURN 
6800 REM "NEXT ENTRY IN FILE
6805 ON 10*FPT(C0)+2 GOTO 6850,6806
6810 A1$=KEY(Z[1],END=6895)
6820 IF A1$="" THEN GOTO 6800 ELSE IF A1$(1,LEN(K9$))<>K9$ THEN GOTO 6895
6825 A$(1,LEN(A1$))=A1$
6830 GOSUB 6600
6835 GOSUB 6450
6840 GOTO 1515
6850 REM "PRIOR ENTRY
6855 CALL "ZZKEYP",ERR=6856,Z[1],A1$; GOTO 6820
6860 CALL "ZZKEYL",ERR=6861,Z[1],A1$; GOTO 6820
6870 GOTO 6895
6890 GOTO 1515
6895 PRINT 'RB',; READ (Z[1],KEY=K9$,DOM=1140); GOTO 1140
6900 REM "
6905 IF T0$<>"" THEN DROP T0$,ERR=6906; GOTO 6905
6910 T0=NUM(A$(65+K9,1))
6915 T0$=L0$((T0-1)*6+1,6),T0$="ZZX"+T0$(1,3),T1$=L1$((T0-1)*20+1,20)
6920 IF Z9<>0 THEN W$=""
6925 ADDR T0$,ERR=6926
6930 PRINT @(0,6),'CE',; GOSUB 6020; GOSUB 6200
6940 RETURN 
7200 REM "Error in read
7210 IF ERR<>0 THEN GOTO 9000
7220 IF ERR<>0 THEN GOTO 9000 ELSE CALL "ZZPROM","E0A",X3$,0,"","","",0; GOTO 1630
7230 GOSUB 6200
7240 CALL "ZZPROM","E0",X3$,0,"","","",0; GOTO 7290
7250 CALL "ZZPROM","E0A",X3$,0,"","","",0; GOTO 7290
7290 GOTO 1630
7300 REM 
7310 ON FPT(C0)*10 GOTO 7390,7325,7330,7390
7325 IF V8$="" THEN X0=X0+4; GOTO 7390 ELSE X0=NUM(V8$(POS(STR(X0:"00")<=V8$,2),2)); GOTO 7390
7330 IF V8$="" THEN X0=X0-6; GOTO 7335 ELSE X0=POS(STR(X0-1:"00")<=V8$,2)-2; IF X0<0 THEN X0=0; GOTO 7390 ELSE X0=NUM(V8$(X0,2)); GOTO 7390
7335 IF X0<0 THEN X0=0; GOTO 7390
7390 IF X0>0 THEN X0=X0-0
7395 C0=3; RETURN 
7400 REM "EXTRACT
7410 EXTRACT (Z[1],ERR=7200,KEY=A1$,DOM=7440)IOL=0310
7420 C9=1,Z9=1; GOSUB 5800
7440 RETURN 
7450 REM "EXTRACT NEW ENTRY
7460 WRITE (Z[1],KEY=A1$,DOM=7250)IOL=0310; GOTO 7400
7490 RETURN 
7500 REM "PUT IN DATE ORDER
7505 IF LEN(B1$)+LEN(K0$)>65000 THEN GOTO 7540; REM "13541
7510 P0=POS(D0$(34,6)<D1$,6),P1=(P0-1)*5+1
7520 D1$=D1$(1,P0-1)+D0$(34,6)+D1$(P0)
7530 B1$=B1$(1,P1-1)+K0$+B1$(P1)
7540 RETURN 
7650 REM "REMOVE OLD INVOICE DATE
7652 F9$=C$(48,6)
7665 CALL "ZZDATE",X3$,"","G10101",F9$,D0,1,0,0,0,0,0,"","",""
7670 Q$=C$(1,10)+F9$+C$(12,10)+C$(11,1)+C$(22,8)+C$(30,1)
7675 Q$(11,6)=STR(100000-D0:"000000")
7680 REMOVE (Z[11],KEY=Q$,DOM=7681)
7695 RETURN 
8905 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
8910 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
8920 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9740 RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "
9820 K9$="ZMENU"
9900 REM "END PROGRAM
9905 IF T0$<>"" THEN DROP T0$,ERR=9906; GOTO 9905
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 IF K9$>"" THEN RUN K9$
9925 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 BEGIN ; SETESC 9350
9950 RUN "ZMENU"
9999 END 
