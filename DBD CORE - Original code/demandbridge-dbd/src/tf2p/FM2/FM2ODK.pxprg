0010 REM "Change commission codes for an order  <FM2ODK>
0020 REM "SETESC 09300; SETERR 09000
0035 REM "5.7 - 06/02/17 - 9.389444 - tma - SSP# 292399
0037 REM "292399-DB: 291503 Commission by product code by salesperson.       
0040 REM "Copyright 2017 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,A$
0100 SETERR 9000
0110 X0$="FM2ODK"
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21],B[22],B[23],B[24],B[25],B[26],B[27],B[28],B[29]
0350 IOLIST PO3$,PO3[0],PO3[1],PO3[2],PO3[3]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O FS1...  02O FS2...  03O AR3...  04O FMP...  05O PO3... 06O AR4... 13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0530 DIM A[13],B[29]
0535 DIM AR1_PARMS$(100); FIND (Z[13],KEY=X3$(9,3)+"AR1")AR1_PARMS$
1000 REM "Check for W/O 109017 Direct ship commission code change
1005 IF STP(AR1_PARMS$(70,5),3," ")="" THEN GOTO 1100
1006 REM "Check all PO3 records, for D types, if none found, we're done, else add the line to LINE_LIST$. At end if any lines, then go change them
1010 LINE_LIST$=""; READ (Z[5],KEY=A$(118,8),DOM=1011)
1015 K5$=KEY(Z[5],END=1050); IF K5$(1,8)<>A$(118,8) THEN GOTO 1050 ELSE IF STP(K5$(10,3),3," ")="" THEN READ (Z[5]); GOTO 1015
1020 DIM PO3$(299),PO3[3]; READ (Z[5],KEY=K5$,DOM=1015)IOL=0350
1025 IF PO3$(11,1)="D" THEN IF POS(PO3$(7,3)=LINE_LIST$)=0 THEN LINE_LIST$=LINE_LIST$+PO3$(7,3)
1045 GOTO 1015
1050 REM "Process LINE_LIST$
1051 IF LINE_LIST$="" THEN GOTO 1090
1055 LINE$=LINE_LIST$(1,3); IF LEN(LINE_LIST$)=3 THEN LINE_LIST$="" ELSE LINE_LIST$=LINE_LIST$(4)
1060 DIM B$(356),B[29]; EXTRACT (Z[2],KEY=A$(118,8)+LINE$,DOM=1085)IOL=0320
1069 C3$="! "+X3$(9,3)+B$(128,5),CM3$=C3$ ! SSP 225300
1076 CALL "AR2COM","DEFAULT",C3$,A{ALL},Z[13],0,0; B$(128,5)=C3$ ! SSP 225300
1078 IF %MSLC THEN CMKEY$="O"+B$(147,8)+A$(6,10)+B$(6,3); CALL "AR2MCM","DEFAULT",CM3$,A{ALL},Z[13],0,0,CMKEY$,0 ! SSP 225300
1080 WRITE (Z[2],KEY=A$(118,8)+LINE$)IOL=0320
1085 GOTO 1050
1095 REM "END of w/o 109017 part
2000 REM "Read Header
2020 ! IF POS(X3$(9,3)="118500",3)=0 THEN GOTO 9900; REM "Check Product Class / Salesperson - W/O 105787!SSP#292399 Open for all
2030 DIM DFLT$(245); GOSUB SET_READONLY; READ (Z[4],KEY="D"+A$(6,10),DOM=*NEXT)DFLT$ ! SSP259411, to avoid error 0
2031 GOSUB CLEAR_READONLY ! SSP259411
2035 IF LEN(DFLT$)<233 THEN GOTO 9900
2040 IF DFLT$(227,3)="   " OR DFLT$(230,4)="    " THEN GOTO 9900
2050 DIM ORDLINE$(230); READ (Z[2],KEY=A$(118,8)+"001",DOM=9900)ORDLINE$
2060 IF DFLT$(227,3)<>ORDLINE$(29,3) THEN GOTO 9900
2070 DIM SLSM$(256); READ (Z[3],KEY=DFLT$(230,4),DOM=9900)SLSM$
2100 REM "UPDATE HEADER
2110 EXTRACT (Z[1],KEY=A$(118,8),ERR=9000)IOL=0310
2120 A$(93,4)=SLSM$(1,4),A$(97,5)=SLSM$(219,5)
2190 WRITE (Z[1],KEY=A$(118,8))IOL=0310
2200 REM "UPDATE LINES
2210 READ (Z[2],KEY=A$(118,8),DOM=2220)
2220 K$=KEY(Z[2],END=9900)
2230 IF K$(1,8)<>A$(118,8) THEN GOTO 9900
2240 EXTRACT (Z[2],KEY=K$,ERR=9000)IOL=0320
2250 B$(128,5)=SLSM$(219,5)
2260 WRITE (Z[2],KEY=K$)IOL=0320
2290 GOTO 2220
2990 GOTO 9900
7400 SET_READONLY:! SSP259411
7410 SET_PARAM 'XI'
7420 SET_READONLY_END:RETURN 
7430 CLEAR_READONLY:! SSP259411
7435 SET_PARAM -'XI'
7440 CLEAR_READONLY_END:RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 9900,9900
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 REM "259411-EC error msg 000-EC3WS1-8463 on two DBE orders.             
56001 REM "292399-DB: 291503 Commission by product code by salesperson.       
