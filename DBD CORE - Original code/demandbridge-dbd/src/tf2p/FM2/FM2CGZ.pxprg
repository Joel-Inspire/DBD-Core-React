0010 REM "Create TEMP Item Trans by Lot Sort File <FM2CGZ>
0035 REM "5.7 - 12/28/10 - 15.2425 - jvv - SSP# 240570
0036 REM "Corrected Physical Inventory transactions, adjusting wrong way
0037 REM "240570-GUI Printing - Support for queueing and scheduling reports. 
0040 REM "Copyright 2010 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0110 X0$="FM2CGZ"
0300 REM 
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20]
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14]
1015 REM "F1=ICF, F2=FMZ, F3=ICM (TEMP SUMMARY BY PO NUMBER), F4=IC0
1016 REM "D0$=STARTING DATE FOR PERIOD, D1$=ENDING DATE
1017 REM "R0$ CAN BE FUTURE RANGE ENTRY (I.E. CUSTOMER )
1018 REM "If R0$(1,1)='!' then it is stripped off, and if the lot sale price is 0 it will be left at 0 (see line 2095 & 2170)
1020 ENTER X3$,X4$,R0$,F1,F2,F3,F4,F5,D0$,D1$,V$; REM " 156917
1025 IF R0$>"" THEN IF R0$(1,1)="!" THEN S9$="!"; IF LEN(R0$)=1 THEN R0$="" ELSE R0$=R0$(2)
1030 SETERR 9000
1040 READ (F3,KEY="",DOM=1060)S0$
1045 Q$=""; IF LEN(S0$)=10 THEN Q$="Last resort: "+FND$(S0$(1,6))+"  "+FNT$(S0$(7,4))
1048 IF %MULT_RPT_DRV_MODE OR %TOD THEN GOTO 1051 ! SSP 240570
1050 CALL "ZZPROM","Y",X3$,S3,"Do you wish to resort the data? "+Q$,"","",0; ON S3 GOTO 1051,9900
1060 CALL "ZZINIT",STR(F3:"00")
1065 WRITE (F3,KEY="")X3$(21,6)+STR(TIM*100:"0000"),D0$,D1$,R0$
1490 DIM A[6],S$(200),B[13],D[30]
1500 REM "PROCESS ITEM MASTERFILE
1501 REM :LATER PASS
1900 REM "POSITION READS
1910 READ (F1,KEY=R0$,DOM=1911)
1990 IF NOT(%GUI) THEN PRINT @(0,22),'CL',"Now processing inventory for balances:",
2000 REM "Build Current Balances FROM ICF
2040 READ (F1,END=3000)IOL=0310
2045 IF R0$>"" THEN IF A$(1,10)<>R0$ THEN GOTO 3000
2048 IF D1$<>S$(1,6) THEN IF A$(25,6)>D1$ THEN GOTO 2040
2050 DIM D[20]; READ (F4,KEY=A$(1,20),DOM=2051)IOL=0340
2055 IF A$(129,4)="    " THEN A$(129,4)="M"
2056 IF A$(41,9)=S$(1,9) THEN A$(41,9)=A$(56,12)
2080 C$=A$(1,20)+A$(41,9)+A$(21,4)+S$(1,5)+D0$+D1$+A$(56,12)+A$(215,6)+A$(129,4)
2085 DIM C[20]; FIND (F3,KEY=C$(1,38),DOM=2090)IOL=0330
2088 R0=R0+1; IF MOD(R0,50)=0 AND NOT(%GUI) THEN PRINT @(40,22),"Record: ",R0:"###,##0"," ",C$(1,20),
2089 REM "A0=QTY, A1=VALUE AT SELL, A2=QTY PER UNIT/SELL
2090 A0=A[3]*A[4]; IF A[2]<>0 THEN A0=A0*A[2]
2095 A1=A[5],A2=A[6]; IF S9$<>"!" THEN IF A1=0 THEN A1=C[8],A2=C[9]; IF A1=0 THEN A1=D[0],A2=D[14]
2096 IF A$(1,10)=S$(1,10) OR A$(41,8)=S$(1,8) THEN GOTO 2100 ELSE CALL "FM2UZE",X3$,F5,0,A$(1,20),A$(41,8),"",C0$,C0,C1
2099 IF C0<>0 AND C0<>A1 THEN A1=C0
2118 REM "0=QTY ON HAND, 1=EXT SELL, 2=COST, 3=FREIGHT
2120 C[0]=C[0]+A0,C[1]=A1 ! SSP#195810
2140 IF C[8]=0 THEN C[8]=A[5],C[9]=A[6],A$(69,4)=A$(129,4)
2145 IF C[19]=0 THEN C[19]=A[3]
2170 IF S9$<>"!" THEN IF C[8]=0 THEN C[8]=D[0],C[9]=D[14],A$(69,4)=D$(120,4)
2174 IF A2=0 THEN A2=1000
2175 C[20]=C[20]+A0*A1/A2
2180 WRITE (F3,KEY=C$(1,38))IOL=0330
2190 GOTO 2040
3000 REM "Build detail of transactions during this period
3002 R0=0
3005 IF NOT(%GUI) THEN PRINT @(0,22),'CL',"Now processing activity for detail:",
3020 READ (F2,KEY=R0$,DOM=3021)
3040 READ (F2,END=4000)IOL=0320
3041 IF R0$>"" THEN IF B$(1,LEN(R0$))<>R0$ THEN GOTO 4000
3042 IF B$(11,1)="C" THEN B$(11,5)=B$(92,5); IF B$(11,5)=S$(1,5) THEN GOTO 3040
3043 IF B[0]=0 THEN B[0]=1
3045 R0=R0+1; IF MOD(R0,50)=0 AND NOT(%GUI) THEN PRINT @(35,22),"Record: ",R0:"###,##0"," ",B$(1,32),
3046 IF B$(231,9)=S$(1,9) THEN B$(231,9)=B$(246,12)
3048 IF B$(35,1)="D" AND B$(11,1)="D" THEN GOTO 3040
3050 DIM D[30]; FIND (F4,KEY=B$(1,10)+B$(16,10),DOM=3051)IOL=0340
3055 REM IF B(4)=0 THEN LET B(4)=D(3),B(0)=D(4)
3056 REM IF B$(231,8)<>S$(1,8) THEN CALL "FM2UZE",X3$,F5,0,C$(1,20),B$(231,8),"",C0$,C0,C1; IF C0<>0 THEN LET B(4)=C0,B(0)=C1
3060 IF LEN(B$)<335 THEN B$=B$+S$
3065 IF B$(35,1)="R" THEN B$(231,9)=B$(113,9)
3089 REM "IF ACT DATE < START OF PERIOD, QTY IS REFLECTD IN LOT INVENT.
3090 IF B$(26,6)<D0$ THEN GOTO 3040
3095 IF B$(26,6)<=D1$ THEN GOTO 3200
3100 REM "Adjust on-hand values by this activity
3101 REM "SINCE END BAL IS AFFECTED BY ACTIVITY
3120 C$=B$(1,10)+B$(16,10)+B$(231,9)+B$(12,4)+S$(1,5)+D0$+D1$+B$(246,12)+B$(86,6)+B$(180,4)+B$(231,9)
3122 DIM C[20]; C[8]=B[4],C[9]=B[0]
3125 READ (F3,KEY=C$(1,38),DOM=3195)IOL=0330
3140 A0=B[1],A1=B[5]
3142 A1=A0*B[4]; IF B[0]<>0 THEN A1=A1/B[0]
3145 IF B$(35,1)="A" THEN A0=-A0,A1=-A1
3150 IF B$(35,1)="R" THEN A0=-A0,A1=-A1
3170 C[0]=C[0]+A0,C[1]=C[1]+A1,C[20]=C[20]+A1
3175 IF C[8]=0 OR C$(69,4)="    " THEN C$(69,4)=B$(180,4),C[8]=B[4],C[9]=B[0]
3190 WRITE (F3,KEY=C$(1,38))IOL=0330
3195 GOTO 3040
3200 REM "Activity date falls in period
3220 C$=B$(1,10)+B$(16,10)+B$(231,9)+B$(12,4)+S$(1,5)+D0$+D1$+B$(246,12)+B$(86,6)+B$(180,4)+B$(231,9)
3225 DIM C[20]; C[8]=B[4],C[9]=B[0]; READ (F3,KEY=C$(1,38),DOM=3226)IOL=0330
3240 P=POS(B$(35,1)="RIATDS"); IF P=0 THEN P=1
3241 ! IF B$(137,2)="IT" OR B$(137,2)="PO" THEN C[0]=C[0]+B[1],C[1]=C[1]+B[5],C[20]=C[20]+B[5] ! SSP#195810
3242 IF B[4]=0 THEN B[4]=C[8],B[0]=C[9]
3243 ! IF B$(137,2)="SJ" AND B$(26,6)>D0$ AND B$(35,1)="I" THEN C(0)=C(0)-B(1) ! SSP#232828!SSP#232828
3245 A0=B[1],A1=A0*B[4]; IF B[0]<>0 THEN A1=A1/B[0]
3246 REM IF B$(35,1)="A" THEN LET A0=-A0,A1=-A1; IF B$(137,2)="PI" THEN LET A0=-A0,A1=-A1
3250 C[1+P]=C[1+P]+A0
3255 C[10+P]=C[10+P]+A1
3290 GOTO 3175
4000 REM "END OF FILE
4010 IF POS(X3$(9,3)="047",3)=0 AND POS("I"=V$(59,12))=0 THEN GOTO 9900; REM 156917
4020 OPEN (100)"IC1"+X3$(9,3)
4030 READ (100,KEY=R0$,DOM=4040)
4040 READ (100,END=4190)IC1$
4045 IF R0$<>"" THEN IF IC1$(1,10)<>R0$(1,10) THEN GOTO 4190
4050 READ (F3,KEY=IC1$(1,20),DOM=4060)
4060 READ (F3,END=4070)ICM$
4070 IF ICM$(1,20)=IC1$(1,20) THEN GOTO 4040
4080 DIM C[20]; C$(1)=IC1$(1,20)+S$(1,9)+IC1$(21,4)
4090 WRITE (F3,KEY=C$(1,38))C$
4100 GOTO 4040
4190 GOTO 9900
8910 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 IF Y5=68 THEN RETRY ELSE ON C9 GOTO 1140,2040
9920 SETERR 0000
9940 EXIT 
9999 END 
56000 ! "228228-Ability to split a report into multiple PDFs based on sales 
56002 REM "240570-GUI Printing - Support for queueing and scheduling reports. 
