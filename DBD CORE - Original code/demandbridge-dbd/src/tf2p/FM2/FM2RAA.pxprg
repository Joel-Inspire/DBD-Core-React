0010 REM "Thank You Letter Printing <FM2RAA>
0035 REM "5.7 - 04/05/13 - 12.797777 - tma - SSP# 262397
0037 REM "262397-Proactive change, validate all form printing programs for   
0040 REM "Copyright 2013 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0045 REM "Special fax logic at delete routine not needed, since if this
0046 REM "program is run for fax output, only fax entries will get "PRINTED"
0047 REM "and have the print flag set in PO6.  ALSO, the reset logic which
0048 REM "was at 1000s was moved to 1900s after the letter was printed.
0090 IF %GUI THEN SETERR 9000 ELSE BEGIN ; SETERR 9000; REM SSP 190384
0095 PRECISION 14; T2=TIM; PRECISION 2
0100 SETERR 9000; SETESC 9300
0110 X0$="FM2RAA",X1$="Thank You Letter Printing"
0120 DIM A$(397),A[15],I[16],S$(30)
0125 COUNTER=0; REM SSP 190384
0140 Z0$="-###,###.00",Z1$="##,##0",Z2$="-#,###,##0"
0165 DEF FNC$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FND$(Z9$)=STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0175 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0180 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
0210 T=1,T0=1,T1=1
0220 W3=79
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0300 REM "I/O lists
0305 REM "IOLIST FOR AR1 - Customer Masterfile
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15]
0320 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7]
0350 IOLIST E$(1)
0380 IOLIST C1$,C[0],C[1]
0420 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01O PO6...  02O FS1...  03O ZY3...  04O ZY4...  05O AR1...  06O ZY2     07O PO6...  08O FS2...  09O IC0...  10O AR3...  11O PO3...  25O FM0...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0560 DIM O[1]; O[0]=NUM(V0$(59,2),ERR=0561),O[1]=NUM(V0$(61,2),ERR=0561)
0565 IF O[0]>0 THEN O[0]=O[0]-1 ELSE O[0]=7
0700 REM "Open Printer
0720 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0721,9920
0725 REM "added JETFORM mode check, SP[120381]
0730 PMODE=0,X$=V3$,F_CODE$="THANKYOU  "+V0$(79,1); CALL "EF2PRM",ERR=0746,X3$,X4$,X$,P6$,F6$,F_CODE$,FORM_PARM$; IF P6$(144,2)="JF" THEN JETFORM_MODE=1,JETFORM_DEV=W9,PMODE=JETFORM_MODE ELSE IF P6$(144,2)="UF" THEN UNFORM_MODE=2,UNFORM_DEV=W9,PMODE=UNFORM_MODE; REM "IF JETFORM_MODE THEN GOTO 0756;REM SSP 190384 SSP 241023
0750 IF POS("F"=FID(W9))>0 THEN CALL "FX2SBC",X3$,Z[13],C9$,Q; ON Q GOTO 9900,0770 ELSE GOTO 0770
0755 CALL "ZZPROM",".4",X3$,0,"You are not configured for the Fax output option!","","",0; GOTO 9900
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[1]; U=8,U0=1,U[0]=0,U[1]=8,T0=0,U0$="    ",T5$="                "; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY="S"+V4$,DOM=0991)
1000 REM "Read next record
1005 U$=KEY(U1,END=5000); READ (U1)
1010 IF U$(1,1)<>"S" THEN GOTO 5000
1015 IF U$(2,8)>V2$(9,8) THEN GOTO 5000
1017 IF U$(2,8)<V2$(1,8) THEN GOTO 1000
1100 REM "Write print flag
1110 U9$=U$
1300 REM "Read other data
1310 DIM C$(128),C[7]; READ (Z[2],KEY=U9$(2,8),DOM=1000)IOL=0330
1320 READ (Z[5],KEY=C$(6,10),DOM=1321)IOL=0310
1330 DIM E$(259); FIND (Z[11],DOM=1331,KEY=C$(118,8)+"     ")IOL=0350
1331 DIM FM0$(640); FIND (Z[25],DOM=1332,KEY=E$(11,1)+A$(1,10)+E$(12,4))FM0$; REM " SSP# 151247
1335 IF POS("F"=FID(W9))=1 THEN IF A$(143,10)=S$(1,10) THEN GOTO 1000
1350 IF JETFORM_MODE=0 THEN GOSUB 7500; REM " SP#[120381]
1400 REM "Get letter date
1410 READ (Z[6],KEY=" "+C$(18,2))D0$
1420 P0=POS(" "=D0$(52,15))
1430 D0$=D0$(52,P0-1)+" "+C$(20,2)+", "+FND$(C$(16,2))
1490 T=0
1500 REM "Print Data
1501 IF JETFORM_MODE THEN GOSUB IMAGE_LIBRARY_SETUP; CALL "EF2JET",X3$,X4$,P6$,"N",JETFORM_DEV,FORM_PARM$,JOB_MODIFIER$,RET$; GOTO 1700; REM "SP[120381]
1502 IF UNFORM_MODE THEN GOSUB IMAGE_LIBRARY_SETUP; CALL "EF2UNF",X3$,X4$,P6$,"N",UNFORM_DEV,FORM_PARM$,JOB_MODIFIER$,RET$ ! SSP 241023
1503 GOSUB 6000
1504 GOSUB 6200
1505 Y5$(P8+O[1])=D0$; GOSUB 7300; REM SSP 190384
1506 IF NUM(V0$(78,1))=0 THEN V0$(78,1)="4"
1507 FOR I=1 TO NUM(V0$(78,1)); GOSUB 7300; NEXT I
1508 IF LEN(C$)>128 THEN IF C$(129,20)<>S$(1,20) THEN A$(165,20)=C$(129,20)
1509 IF LEN(C$)>128 THEN IF C$(149,20)<>S$(1,20) THEN A$(185,20)=C$(149,20)
1510 IF V0$(82,1)="Y" THEN Y5$(P8)=E$(16,30) ELSE Y5$(P8)=A$(165,20)
1511 IF C$(61,1)>"W" THEN Y5$(P8+40)=E$(16,30)
1512 GOSUB 7300
1515 IF V0$(82,1)="Y" THEN Y5$(P8)=E$(225,35) ELSE Y5$(P8)=A$(11,35)
1516 IF C$(61,1)>"W" THEN Y5$(P8+40)=E$(225,35)
1520 GOSUB 7300
1525 IF V0$(82,1)="Y" THEN Y5$(P8)=E$(46,30) ELSE Y5$(P8)=A$(56,30)
1526 IF C$(61,1)>"W" THEN Y5$(P8+40)=E$(46,30)
1530 IF POS(" "<>Y5$)>0 THEN GOSUB 7300
1536 IF V0$(82,1)="Y" AND POS(" "<>E$(76,30))>0 THEN Y5$(P8)=E$(76,30) ELSE IF POS(" "<>E$(86,30))>0 THEN Y5$(P8)=A$(86,30)
1537 IF C$(61,1)>"W" THEN Y5$(P8+40)=E$(76,30)
1538 IF POS(" "<>Y5$)>0 THEN GOSUB 7300
1540 CALL "ZZDISP","AX",A$(134,9),"ZIP",X3$,X$,"",0,0,X4$
1545 Y5$(P8)=FNS$(A$(116,16))+",  "+A$(132,2)+"     "+X$
1546 IF C$(61,1)<="W" THEN GOTO 1550
1547 CALL "ZZDISP","AX",E$(124,9),"ZIP",X3$,X$,"",0,0,X4$
1548 Y5$(P8+40)=FNS$(E$(106,16))+", "+E$(122,2)+"    "+X$
1550 GOSUB 7300
1555 GOSUB 7300
1556 IF A$(185,20)=S$(1,20) THEN Y5$(P8)="Gentlemen:"; GOTO 1565
1557 P0=POS("   "=A$(185,20)+"  ")
1560 Y5$(P8)="Dear",Y5$(P8+5)=A$(185,P0-1)+":"
1565 IF POS(X3$(9,3)="498",3)<>0 AND A$(185,20)=S$(1,20) THEN Y5$(P8)="Valued Customer:"
1570 GOSUB 7300
1600 REM "Body of letter
1610 P0=POS("~"=L8$)
1615 IF LEN(L8$)=0 THEN GOTO 1995
1620 IF L8$(1,2)="02" THEN GOSUB 7700
1630 IF L8$(1,1)="0" THEN GOSUB 7300
1635 P9=POS(" "=L8$(2)); IF P9=0 THEN GOTO 1650 ELSE P9=P9+2
1640 L6$=L8$(P9,P0-P9)
1643 GOSUB 8200
1645 Y5$(P8)=L6$
1650 GOSUB 7300
1665 L1=0
1670 L8$=L8$(P0+1)
1680 IF L8$="" THEN GOTO 1900
1690 GOTO 1610
1700 REM "Print letter heading to JETFORM file, SP[120381]
1702 CALL "ZZDISP","AX",C$(118,8),"O/P",X3$,C5$,"",0,0,X4$; ORDER$=C5$
1703 CALL "ZZDISP","AX",C$(6,10),"A/R",X3$,F5$,"",0,0,X4$; CUST$=F5$; REM SSP  190384
1704 PRINT (W9)"^field "+"PDF"+'LF'+"PDFFILE:"+X3$(9,3)+DLM+"TK"+DLM+X3$(40,3)+DLM+ORDER$+'LF',; REM SSP 190384
1705 PRINT (W9)"^field "+"HEADDATE"+'LF'+D0$+'LF',
1706 IF LEN(C$)>128 THEN IF C$(129,20)<>S$(1,20) THEN A$(165,40)=C$(129,40)
1708 PRINT (W9)"^field "+"PUR_AGENT"+'LF'+A$(165,20)+'LF',
1710 PRINT (W9)"^field "+"ATTENTION"+'LF'+E$(16,30)+'LF',
1712 PRINT (W9)"^field "+"CUST_NAME"+'LF'+A$(11,35)+'LF',
1715 PRINT (W9)"^field "+"SHIPTO_NAME"+'LF'+E$(225,35)+'LF',
1720 PRINT (W9)"^field "+"CUST_ADD1"+'LF'+A$(56,30)+'LF',
1725 PRINT (W9)"^field "+"SHIPTO_ADD1"+'LF'+E$(46,30)+'LF',
1730 PRINT (W9)"^field "+"CUST_ADD2"+'LF'+A$(86,30)+'LF',
1736 PRINT (W9)"^field "+"SHIPTO_ADD2"+'LF'+E$(76,30)+'LF',
1742 CALL "ZZDISP","AX",A$(134,9),"ZIP",X3$,X$,"",0,0,X4$
1744 PRINT (W9)"^field "+"CUST_CITYSTZIP"+'LF'+FNS$(A$(116,16))+", "+A$(132,2)+"  "+X$+'LF',
1745 IF LEN(FM0$)=0 THEN FAX$=A$(143,10); GOTO 1747
1746 DIM FAX$(10); IF (V0$(82,1)="Y" AND FM0$(138,10)<>DIM(10)) THEN FAX$=FM0$(138,10) ELSE FAX$=A$(143,10); REM "50501247                                
1747 PRINT (W9)"^field "+"FAX_NUMBER"+'LF'+FAX$+'LF',; REM " SSP# 161210        
1748 CALL "ZZDISP","AX",E$(124,9),"ZIP",X3$,X$,"",0,0,X4$
1750 PRINT (W9)"^field "+"SHIPTO_CITYSTZIP"+'LF'+FNS$(E$(106,16))+", "+E$(122,2)+"  "+X$+'LF',
1756 IF A$(185,20)=S$(1,20) THEN GREET$="Gentlemen:"; GOTO 1765
1757 P0=POS("   "=A$(185,20)+"   ")
1760 GREET$="Dear "+A$(185,P0-1)+":"
1765 IF POS(X3$(9,3)="498",3)<>0 AND A$(185,20)=S$(1,20) THEN GREET$="Valued Customer:"
1766 PRINT (W9)"^field "+"GREETING"+'LF'+GREET$+'LF',
1770 GOSUB 7700
1900 REM "Accumulate Totals"
1905 IF POS("F"=FID(W9))=1 THEN PRINT (W9)DIM(512)
1910 IF POS("F"=FID(W9))=1 THEN T0$="Order: "+U9$(2,8),T1$=E$(11,14),X$=FID(W9); CALL "FX2SBB",X3$,W9,T0$,T1$,"",T2$,"",X9; OPEN (W9)X$
1920 REMOVE (Z[1],KEY=U$,ERR=*NEXT); REM SSP 190384
1930 DIM U$(10); U$(1)=U9$,U$(10)="P"
1960 WRITE (Z[1],KEY=U$,DOM=1000)
1990 T[T0,0]=T[T0,0]+1
1992 ORDER_END$="YES"; GOSUB 5000; ORDER_END$=""
1995 GOTO 1000
3100 REM "Subtotal logic goes here, see -ZREPS
3180 RETURN 
4700 REM "Print letter heading to JETFORM file, SP[120381] second page 164228
4704 REM "PRINT (W9)"^field "+"PDF"+'LF'+"PDFFILE:"+X3$(9,3)+DLM+"TK"+DLM+X3$(40,3)+DLM+ORDER$+'LF',; REM SSP 190384
4705 PRINT (W9)"^field "+"HEADDATE"+'LF'+D0$+'LF',
4706 IF LEN(C$)>128 THEN IF C$(129,20)<>S$(1,20) THEN A$(165,40)=C$(129,40)
4708 PRINT (W9)"^field "+"PUR_AGENT"+'LF'+A$(165,20)+'LF',
4710 PRINT (W9)"^field "+"ATTENTION"+'LF'+E$(16,30)+'LF',
4712 PRINT (W9)"^field "+"CUST_NAME"+'LF'+A$(11,35)+'LF',
4715 PRINT (W9)"^field "+"SHIPTO_NAME"+'LF'+E$(225,35)+'LF',
4720 PRINT (W9)"^field "+"CUST_ADD1"+'LF'+A$(56,30)+'LF',
4725 PRINT (W9)"^field "+"SHIPTO_ADD1"+'LF'+E$(46,30)+'LF',
4730 PRINT (W9)"^field "+"CUST_ADD2"+'LF'+A$(86,30)+'LF',
4736 PRINT (W9)"^field "+"SHIPTO_ADD2"+'LF'+E$(76,30)+'LF',
4742 CALL "ZZDISP","AX",A$(134,9),"ZIP",X3$,X$,"",0,0,X4$
4744 PRINT (W9)"^field "+"CUST_CITYSTZIP"+'LF'+FNS$(A$(116,16))+", "+A$(132,2)+"  "+X$+'LF',
4745 IF LEN(FM0$)=0 THEN FAX$=A$(143,10); GOTO 4747
4746 DIM FAX$(10); IF (V0$(82,1)="Y" AND FM0$(138,10)<>DIM(10)) THEN FAX$=FM0$(138,10) ELSE FAX$=A$(143,10); REM "50501247                                
4747 PRINT (W9)"^field "+"FAX_NUMBER"+'LF'+FAX$+'LF',; REM " SSP# 161210        
4748 CALL "ZZDISP","AX",E$(124,9),"ZIP",X3$,X$,"",0,0,X4$
4750 PRINT (W9)"^field "+"SHIPTO_CITYSTZIP"+'LF'+FNS$(E$(106,16))+", "+E$(122,2)+"  "+X$+'LF',
4756 IF A$(185,20)=S$(1,20) THEN GREET$="Gentlemen:"; GOTO 4765
4757 P0=POS("   "=A$(185,20)+"   ")
4760 GREET$="Dear "+A$(185,P0-1)+":"
4765 IF POS(X3$(9,3)="498",3)<>0 AND A$(185,20)=S$(1,20) THEN GREET$="Valued Customer:"
4766 PRINT (W9)"^field "+"GREETING"+'LF'+GREET$+'LF',
4770 GOSUB 8495
4771 RETURN 
5000 REM " END OF PRINT
5001 IF ORDER_END$="" THEN GOTO 5010
5002 CALL "ZZDISP","AX",A$(1,10),"A/R",X3$,X$,"",0,0,X4$; CUST$=X$; REM SSP 190384
5003 IF LEN(FM0$)=0 THEN FAX$=A$(143,10); GOTO 5006
5004 DIM FAX$(10); IF (V0$(82,1)="Y" AND FM0$(138,10)<>DIM(10)) THEN FAX$=FM0$(138,10) ELSE FAX$=A$(143,10); REM "50501247
5005 DIM FAX_TYPE$(1); IF V0$(82,1)="Y" THEN FAX_TYPE$="U" ELSE FAX_TYPE$="Y"; REM " SSP# 151247 type Y is Thank you Customer, Type U is Thank you Customer Ship to SSP 190384
5006 DIM EM$(21*6); IF FAX_TYPE$="Y" THEN EM$(1,21)=FAX_TYPE$+A$(1,10) ELSE IF FAX_TYPE$="U" THEN EM$(1,21)=FAX_TYPE$+A$(1,10)+E$(12,4); REM SSP 190384
5007 TAG$="Order:"+ORDER$; REM Changed to show order number on email SSP 190384
5008 IF JETFORM_MODE OR UNFORM_MODE THEN DIM X$(1*51); X$(1,1)=FAX_TYPE$; X$(2,25)=FAX$; X$(27,25)=TAG$; T$="THANKU  "+"CUST:"+CUST$+" "+EM$(12,4); CALL "EF2FAX",X3$,X4$,P6$,F6$,W9,X$,T$,PMODE,EM$; REM SSP 190384 SSP 241023
5009 IF ORDER_END$="YES" THEN RETURN 
5010 GOTO 9900
5020 IF V8$="A" THEN GOTO 5040
5025 CALL "ZZPROM","Y",X3$,S3,"Did all of the Sales Orders Thank You letters print correctly?","","",0; REM SSP 190384
5030 ON S3 GOTO 5040,9916
5200 GOSUB 5300
5290 GOTO 9916
5300 REM "Remove
5310 READ (Z[1],KEY="S",DOM=5311)
5320 U$=KEY(Z[1],END=5390); READ (Z[1]); IF U$(1,1)<>"S" THEN GOTO 5390 ELSE REM "READ (Z(2),KEY=U$(2,8)) IOL=00320
5325 REM IF POS("F"=V3$(2,2))=1 THEN READ (Z(5),KEY=I$(6,10),DOM=05320) IOL=00310; IF A$(143,10)=S$(1,10) THEN GOTO 05320
5340 IF LEN(U$)<>10 THEN GOTO 5370
5350 IF U$(10,1)="P" THEN GOSUB 5400; REMOVE (Z[1],KEY=U$)
5370 GOTO 5320
5390 RETURN 
5400 REM "Set print flag in header
5410 DIM C$(128),C[7]; EXTRACT RECORD (Z[2],KEY=U$(2,8),DOM=5440)C$
5415 C$(126,1)="Y"
5420 WRITE RECORD (Z[2],KEY=U$(2,8))C$
5440 RETURN 
6000 REM "Page header
6010 IF JETFORM_MODE THEN RETURN ; REM "SP[120381]
6040 CALL "ZZHEAD",X0$,X1$,X2$,X3$,W0$,W1$,W2$,W3$,W3,W,W9,W8,W0,W5,W2,"X",W5$
6045 ON W5 GOTO 6046,9900
6060 GOSUB 6100
6090 RETURN 
6100 REM "
6199 RETURN 
6200 REM "COMPANY ADDRESS (FAX ONLY) OR TOP BLANK LINES
6201 IF LEN(FM0$)=0 THEN FAX$=A$(143,10); GOTO 6203
6202 IF (V0$(82,1)="Y" AND FM0$(138,10)<>DIM(10)) THEN FAX$=FM0$(138,10) ELSE FAX$=A$(143,10); REM " SSP# 151247
6203 IF JETFORM_MODE THEN RETURN ; REM "SP[120381]
6205 IF POS("F"=FID(W9))<>1 THEN GOTO 6300
6215 CALL "FX2SBA",X3$,X4$,FAX$,C9$,N9$,X9; IF X9=1 THEN EXITTO 9900
6218 PRINT (W9)N9$
6220 FOR X=0 TO 5
6230 Q$=FNS$(C9$(23+X*78,78)); IF POS("//"=Q$)<>1 THEN Y5$(INT(W3/2-LEN(Q$)/2))=Q$ ELSE Y5$(1)=Q$
6235 GOSUB 7300
6260 NEXT X
6290 RETURN 
6300 REM "NOT FAX
6310 IF O[0]=0 THEN GOTO 6340
6320 FOR I=1 TO O[0]; GOSUB 7300; NEXT I
6340 RETURN 
6900 REM "SORT
6905 IF S9$="X" THEN GOTO 6990 ELSE S0=Z[1],S1=Z[2]
6940 CALL "ZZSORT",X3$,"",V1$,S9$,"","",0,0,0,S0,S1,X9
6990 RETURN 
7000 REM "Totals logic
7003 GOTO 7190
7005 IF T=T0 THEN IF T[T0,0]<2 THEN GOSUB 7300; GOTO 7100
7007 IF W+3>W0 THEN GOSUB 6000
7010 Y5$(1)=T3$(1,T0+1-T)+" "
7015 IF T$<>"" THEN Y5$(T0+2-T)=T$+" "+Q2$+" ("+STR(T[T,0]:"0")+"):"
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7200; GOTO 7190
7095 GOSUB 7300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7205 GOSUB 7300; Y5$(1)=Q1$+": "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 T4$=STR(INT(T2):"##0")
7230 T3=INT(FPT(T2)*3600),T4=MOD(T3,60),T3=INT(T3/60)
7240 T3=T3/60
7250 T4$=T4$+":"+STR(T3:"00")+":"+STR(T4:"00")
7260 Y5$(1)=Q3$+": "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7330 IF Y5$=Y6$ THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; DIM Y5$(W3)
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"  ")-1)
7482 IF V1$(1,3)="???" THEN V8$="A",V7$=V1$(4,2); IF V0$(71,1)="1" THEN V1$="PO6   "
7485 FOR U7=1 TO LEN(V1$); IF V1$(U7,1)=" " THEN V1$(U7,1)="."; NEXT U7 ELSE NEXT U7 ! SSP#262397
7490 RETURN 
7500 REM "Build letter text
7505 REM "Message on screen building text
7530 READ (Z[3],KEY="ORDER       "+C$(61,1),DOM=7531)
7540 READ (Z[3],END=7690)L0$,L0
7541 IF L0$(1,13)<>"ORDER       "+C$(61,1) THEN GOTO 7690
7543 P8=INT((80-NUM(L0$(56,2)))/2)
7544 IF POS(X3$(9,3)="087",3)<>0 THEN P8=3
7545 W3=79; IF NUM(L0$(56,2))+10<W3 THEN W3=NUM(L0$(56,2))+10; REM "LET W3=NUM(L0$(56,2))+10
7546 IF POS(X3$(9,3)="322")<>0 THEN W3=NUM(L0$(56,2))+10
7547 DIM Y9$(NUM(L0$(56,2)))
7550 IF L0$(1,13)<>"ORDER       "+C$(61,1) THEN GOTO 7690
7600 REM "Index line detail
7605 L1=0
7610 READ (Z[4],IND=L0)L0,L7$
7615 IF L7$(1,W3-10)=Y9$ THEN L8$=L8$+STR(L1)+L0$(14,1)+" ~"; GOTO 7630
7616 IF L0$(58,1)="Y" THEN L8$=L8$+STR(L1)+L0$(14,1)+" "+L7$+"~"; GOTO 7630
7620 L8$=L8$+STR(L1)+L0$(14,1)+" "+L7$(1,W3-10)+"~"
7630 IF L0=-1 THEN GOTO 7540
7640 L1=L1+1
7650 GOTO 7610
7693 L1=0
7695 RETURN 
7700 REM "Order Information
7710 IF JETFORM_MODE=0 THEN GOSUB 7300 ELSE GOSUB 8495; GOTO 7800; REM " SP#[120381]
7715 IF V0$(74,1)="Y" THEN GOSUB 8300; GOTO 7745
7720 J9=P8+4; GOSUB 8550; IF POS(" "<>C$(28,15))<>0 THEN Y5$(J9)="Your Order Number: "+C$(28,15)
7724 CALL "ZZDISP","AX",C$(118,8),"O/P",X3$,C5$,"",0,0,X4$
7725 IF POS(X3$(9,3)="050",3)>0 THEN Y5$(P8+44)="SigForms Order Number: "+C5$ ELSE IF POS(X3$(9,3)="087088",3)<>0 THEN Y5$(P8+44)="Our Order Number: "+C5$ ELSE Y5$(P8+46-(80-W3))="Our Order Number: "+C5$
7730 GOSUB 7300
7735 IF V0$(72,1)="Y" THEN IF POS(" "<>C$(55,6))>0 THEN IF POS(X3$(9,3)="050",3)>0 THEN Y5$(P8+9)="Scheduled Ship Date: "+FNC$(C$(55,6)); GOSUB 7300 ELSE J9=P8+2; GOSUB 8550; Y5$(J9)="Requested Ship Date: "+FNC$(C$(55,6)); GOSUB 7300
7740 IF V0$(73,1)="Y" AND FNS$(E$(210,15))>"" THEN J9=P8+13; GOSUB 8550; Y5$(J9)="Ship Via: "+E$(210,15); GOSUB 7300
7745 GOSUB 7300
7750 Y5$(46+P8)="QUANTITY",Y5$(61+P8)="PRICE"; IF V0$(74,1)<>"Y" THEN X$="DESCRIPTION",Y5$(8+P8,LEN(X$))=X$
7755 IF X3$(9,3)="310" THEN Y5$(61+P8,5)=""
7760 GOSUB 7300
7770 GOSUB 7300
7800 REM "Order detail
7810 READ (Z[8],KEY=C$(118,8),DOM=7811)
7820 READ (Z[8],END=7900)IOL=0320
7830 IF I$(147,8)<>C$(118,8) THEN GOTO 7900
7831 IF I$(147,8)<>C$(118,8) AND COUNTER=0 THEN GOSUB 4700; REM TEST TEST
7835 IF POS("S"=I$(156,5))=0 THEN GOTO 7820
7840 H8$=I$
7850 GOSUB 8000
7851 DIM C1$(21),C[1]
7852 FIND (Z[13],KEY="U/M"+I$(124,4),DOM=7853)IOL=0380
7853 C0$=FNS$(I$(124,4)); IF C1$(20,1)<>"Y" AND V0$(74,1)<>"Y" THEN C0$=C0$+"/"+FNR$(STR(I[5]:Z1$))
7855 IF C1$(20,1)<>"Y" THEN I0=I[5] ELSE I0=C[1]
7856 IF I0=0 THEN I0=1; REM "TO CORRECT ERROR 40 ON MESSAGE LINES
7857 IF I0<>0 THEN I[0]=I[0]/I0
7858 IF JETFORM_MODE THEN GOTO 7876; REM "  SP#[120381]
7859 IF V0$(74,1)="Y" AND POS(" "<>I$(19,10))>0 THEN Y5$(P8)="Item No.: "+I$(19,10); GOSUB 7300
7860 J9=P8+4; GOSUB 8550; Y5$(J9)=I$(50,40)
7863 IF I[4]=0 AND I[6]<>0 THEN I[4]=I[6]
7865 REM IF I$(155,1)="S" THEN LET I(4)=I(6)
7866 IF FPT(I[0])<>0 THEN MASK2$="-##,###.00" ELSE MASK2$=Z2$
7867 IF I[0]<>0 THEN Y5$(P8+44)=FNQ$(I[0],MASK2$)
7868 IF I[4]<>0 THEN Y5$(P8+54)=FNQ$(I[4],Z0$)
7869 IF FNS$(I$(124,4))<>"" AND I[4]<>0 THEN Y5$(P8+65)="/"+C0$
7870 GOSUB 7300
7871 IF I$(155,1)="M" THEN GOTO 7874
7872 IF V0$(80,1)="Y" AND I[8]/I0<>0 THEN Y5$(P8+22)="Backordered Quantity: "+FNQ$(I[8]/I0,Z2$); GOSUB 7300; J9=P8+1
7873 IF V0$(81,1)="Y" THEN Y5$(27+P8)="Unit of Measure:       "+I$(124,4); GOSUB 7300; J9=P8+1
7874 IF V0$(74,1)<>"Y" AND H9$<>"" THEN J9=P8+4; GOSUB 8550; Y5$(J9)=H9$; GOSUB 7300
7875 IF JETFORM_MODE=0 THEN GOTO 7890
7876 IF ORDER_END$="YES" THEN GOTO 7900
7877 PRINT (W9)"^field "+"ITEM"+'LF'+I$(19,10)+'LF',; PRINT (W9)"^field "+"ITEM_DESC"+'LF'+I$(50,40)+'LF',
7878 IF I[4]=0 AND I[6]<>0 THEN I[4]=I[6]; REM PRINT (W9) "^field "+"COST"+'LF'+STR(I[0]:Z2$)+'LF',
7879 PRINT (W9)"^field "+"UOM"+'LF'+I$(124,4)
7880 PRICE$=FNQ$(I[4],Z0$); IF FNS$(I$(124,4))<>"" AND I[4]<>0 THEN PRICE$=PRICE$+"-"+C0$
7881 IF I$(155,1)="M" THEN GOSUB 8100; GOTO 7890
7883 PRINT (W9)"^field "+"BO_QTY"+'LF'+FNQ$(I[8]/I0,Z2$)
7884 PRINT (W9)"^field "+"PRICE"+'LF'+PRICE$+'LF',
7885 PRINT (W9)"^field "+"QTY"+'LF'+FNQ$(I[0],Z2$)+'LF',
7886 COUNTER=COUNTER+1; REM IF COUNTER<3 THEN GOTO 7889; REM SSP 190384
7887 REM IF COUNTER=3 AND JETFORM_MODE THEN GOSUB IMAGE_LIBRARY_SETUP; CALL "EF2JET",X3$,X4$,P6$,"E",JETFORM_DEV,FORM_PARM$,JOB_MODIFIER$,RET$; COUNTER=0; REM GOSUB 4700; REM SSP 190384
7888 REM IF COUNTER=6 AND JETFORM_MODE THEN GOSUB IMAGE_LIBRARY_SETUP; CALL "EF2JET",X3$,X4$,P6$,"E",IL_DEVICE,FORM_PARM$,JOB_MODIFIER$,RET$; GOSUB 4700; REM SSP 190384
7889 REM COUNTER=COUNTER+1; REM "SSP 164228 SSP 190384
7890 GOTO 7820
7900 IF JETFORM_MODE=0 THEN GOSUB 7300
7910 RETURN 
8000 REM "Build desc from H8$
8010 H9$=FNS$(H8$(32,8)); IF H9$<>"" AND V0$(75,1)<>"Y" THEN H9$=H9$+QUO
8015 IF POS(" "<>H8$(40,8))<>0 THEN H9$=H9$+"x"
8020 H9$=H9$+FNS$(H8$(40,8)); IF H9$<>"" THEN IF POS(" "<>H8$(40,8))<>0 AND V0$(75,1)<>"Y" THEN H9$=H9$+QUO+" " ELSE H9$=H9$+" "
8030 IF NUM(H8$(48,2))<>0 THEN H9$=H9$+H8$(48,2)+" Ply "
8045 H8$=""
8050 RETURN 
8100 REM "FILL THE MESSAGE LINE FIELDS WITH BLANKS
8112 PRINT (W9)"^field "+"BO_QTY"+'LF'+"          "
8114 PRINT (W9)"^field "+"PRICE"+'LF'+"          "+'LF',
8115 PRINT (W9)"^field "+"QTY"+'LF'+"          "+'LF',
8199 RETURN 
8200 REM "Look for field names in L6$ and replace if necessary
8210 P=POS("^SALESPERSON_NAME"=L6$)
8215 IF P=0 THEN GOTO 8230
8220 DIM S9$(50); READ (Z[10],KEY=C$(93,4),DOM=8221)S9$
8225 IF P=1 THEN L6$=FNS$(S9$(5,35))+L6$(18) ELSE L6$=L6$(1,P-1)+FNS$(S9$(5,35))+L6$(P+17)
8290 RETURN 
8300 REM "GBF Ribbon area
8305 IF JETFORM_MODE THEN GOTO 8495; REM "  SP#[120381]
8310 DIM P$(W3*5); X=P8
8320 X$="Your Order Number: "+C$(28,15); IF POS(" "<>C$(28,15))<>0 THEN J9=4; GOSUB 8600; P$(J9,LEN(X$))=X$
8330 X$="Ship To Address:"; P$(39+X,LEN(X$))=X$
8340 X=X+W3
8345 CALL "ZZDISP","AX",C$(118,8),"O/P",X3$,C5$,"",0,0,X4$
8350 X$="Our Order Number: "+C5$,J9=5; GOSUB 8600; P$(J9,LEN(X$))=X$
8360 P$(39+X,35)=E$(225,35),X=X+W3
8365 CALL "ZZDISP","AX",E$(124,9),"ZIP",X3$,C5$,"",0,0,X4$
8370 C5$=FNS$(E$(106,16))+", "+E$(122,2)+"    "+C5$
8375 C3$=E$(46,30),C4$=E$(76,30)
8380 IF POS(" "<>C3$)=0 THEN C3$=C4$,C4$=C5$,C5$="" ELSE IF POS(" "<>C4$)=0 THEN C4$=C5$,C5$=""
8390 IF V0$(72,1)="Y" AND FNS$(C$(55,6))>"" THEN X$="Requested Ship Date: "+FNC$(C$(55,6)),J9=2; GOSUB 8600; P$(J9,LEN(X$))=X$
8400 P$(39+X,LEN(C3$))=C3$,X=X+W3
8410 IF V0$(73,1)="Y" AND FNS$(E$(210,15))>"" THEN X$="Ship Via: "+E$(210,15),J9=13; GOSUB 8600; P$(13+X,LEN(X$))=X$
8430 P$(39+X,LEN(C4$))=C4$,X=X+W3
8440 IF C5$>"" THEN P$(39+X,LEN(C5$))=C5$
8450 FOR X=0 TO 4
8460 IF POS(" "<>P$(1+X*W3,W3))>0 THEN Y5$(1)=P$(1+X*W3,W3); GOSUB 7300
8470 NEXT X
8490 RETURN 
8495 REM "Print for JETFORM SP#[120381]
8498 PRINT (W9)"^field "+"CUSTPO"+'LF'+C$(28,15)+'LF',
8500 CALL "ZZDISP","AX",C$(118,8),"O/P",X3$,C5$,"",0,0,X4$
8505 PRINT (W9)"^field "+"OURPO"+'LF'+C5$+'LF',
8508 IF V0$(74,1)<>"Y" THEN GOTO 8530
8510 PRINT (W9)"^field "+"SHIPTO_NAME"+'LF'+E$(225,35)+'LF',
8515 PRINT (W9)"^field "+"SHIPTO_ADD1"+'LF'+E$(46,30)+'LF',; PRINT (W9)"^field "+"SHIPTO_ADD2"+'LF'+E$(76,30)+'LF',
8520 CALL "ZZDISP","AX",E$(124,9),"ZIP",X3$,C5$,"",0,0,X4$
8525 PRINT (W9)"^field "+"SHIPTO_CITYSTZIP"+'LF'+FNS$(E$(106,16))+", "+E$(122,2)+"  "+C5$+'LF',
8530 PRINT (W9)"^field "+"REQSHIPDATE"+'LF'+FNC$(C$(55,6))+'LF',
8535 PRINT (W9)"^field "+"SHIPVIA_DESC"+'LF'+E$(210,15)+'LF',
8540 RETURN 
8550 REM "SET J9
8560 IF V0$(75,1)="Y" THEN J9=P8
8570 RETURN 
8600 REM 
8610 IF V0$(75,1)="Y" THEN J9=P8+X ELSE J9=J9+X
8615 J9=J9-2
8620 RETURN 
8950 DEF FNQ$(Z9,Z9$)=STR(Z9:Z9$)
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "End program
9909 IF V8$="A" THEN V3$(2,6)="AUTO"+V7$
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9915 IF Y4$<>X0$ AND V3$(2,1)<>"T" THEN GOTO 5020
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 IF NOT(NUL(Y4$)) THEN IF %GUI THEN CALL Y4$,ERR=*NEXT ELSE RUN Y4$,ERR=9931; REM SSP 190384
9940 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
11000 IMAGE_LIBRARY_SETUP:! If needed, setup parameters to add image library i nfo to Jetform call                                                        SSP 190384
11005 IF %HAS_IMAGE_LIB THEN {; REM SSP 190384
11020 %IL_ADD_DOC_TYPE$="RD"; REM SSP 190384
11025 %IL_ADD_TF1$=C$(118,8) ! Order number  SSP 190384
11040 %IL_ADD_IMAGE_PATH$=STP(FN%ZZDISP$(MID(C$,118,8),"O/P")); REM +"_"+STR(P2) ! SS P# 185008  190384
11045 %IL_FORMAT$=V0$(79,1) ! 186095
11075  } ELSE {
11080 %IL_ADD_DOC_TYPE$="",%IL_ADD_TF1$="",%IL_ADD_TF2$="",%IL_ADD_IMAGE_PATH$="",%IL_FORMAT$="" ! 186095
11085  }
11095 RETURN 
11099 ! ****************************************************************  SSP 190384
56000 REM "SSP 190384 add PDF and image library to Thank You letters
56002 REM "241023-Modify printing programs to use Unform                      
56003 REM "262397-Proactive change, validate all form printing programs for   
