0010 REM "F/M Usage correct proration for y2k Feb <FM2UBX>
0020 SETESC 9300; SETERR 9000
0035 REM "5.5 - 03/06/07 - 9.664444 - mhe - SSP# 205703
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 BEGIN 
0100 SETERR 9000
0110 X0$="FM2UBX",X1$="Correct Feb 2000 usage"
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0260 DEF FND$(Z9$)=STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0400 REM "SET VALUES FOR TESTING
0410 REM "F9$ = STATF/M from ZZAPRM, F0=FMP,F0$="E"+CUSTOMER CODE,F1=FM3,F2=FSW,F1$=CUSTOMER +FORM +LOCATION,D0$=SHIP DATE,D1$= DATE, U0$="U",U0=USAGE,U1=0,U2=0,U3=0
0411 REM "ENTER X3$,F9$,F0,F0$,F1,F2,F1$,D0$,D1$,U0$,U9,U1,U2,U3
0415 D0$="K00201",D1$="K00201",U0$="U",U1$="U"
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O FM3...  02O FMP...  03O FSW...  04O FM0...  05O FM4...  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 0521,8810
0530 F0=Z[2],F1=Z[1],F2=Z[3]
0620 FIND (Z[13],KEY="STAT"+"F/M")F9$
0640 CALL "ZZPROM",".Y",X3$,Z,"Proceed?","","",0; ON Z GOTO 0641,9900
0900 READ (Z[1],KEY="",DOM=0910)
1000 F1$=KEY(Z[5],END=9900); READ (Z[5])
1010 PRINT @(10,10),F1$
1020 FIND (Z[4],KEY="C"+F1$(1,10)+F1$(21,4),DOM=1000)A$
1030 REM "IF A$(223,1)<>"I" THEN GOTO 01000
1190 F3$=F1$(1,20),F0$="E"+F1$(1,10)
1200 REM "FIND STARTING DATE RECORD
1210 Q0=LEN(F0$); READ (F0,KEY=F0$,DOM=1211)
1215 READ (F0,END=1300)Q$
1220 IF Q$(1,LEN(F0$))<>F0$ THEN GOTO 1000 ELSE P1$=Q$
1224 REM "Q$ IS LAST DATE
1225 P0=NUM(P1$(Q0+5,2)),Q$=P1$(Q0+7+P0*6,6)
1250 IF Q$<D0$ THEN GOTO 1215
1400 REM 
1420 D$=D0$
2000 REM "GET CORRECT STAT RECORD FOR BASE DATE D$
2020 IF P1$(Q0+7+P0*6,6)<D$ THEN GOSUB 4000
2030 IF F2$="" THEN GOSUB 4100
2100 REM "DETERMINE PERIOD P1 FROM DATE D$
2120 P=POS(D$<=P1$(24),6),P2$=P1$(23+P,6)
2125 P2=INT(P/6)+1
2130 K[P2]=K[P2]+K[P2+1],K[P2+1]=0
2400 REM "DONE WITH USAGE
2410 GOSUB 4000
2440 GOTO 1000
4000 REM "FLUSH CURRECT STAT RECORD
4005 Z9$=FN%FID$(F1),Z9$=Z9$(4,6) ! [205703]-changed FID() to FN%FID$()
4020 CALL "ZZPACK",X3$,"W",F8$,"",0,0,K{ALL},F1,U0$,F2$,F9$
4030 CALL "ZZPACK",X3$,"W",F8$,"",0,0,L{ALL},F2,U0$,F3$+P$,F9$
4090 F2$=""
4095 RETURN 
4100 REM "GET STAT RECORD  FOR PERIOD P$
4105 P=POS(U0$=F9$(49),17),F8$=F9$(50+P,3),P$=P1$(12,4),F2$=F1$+P$
4130 DIM K[24]
4140 CALL "ZZPACK",X3$,"R",F8$+"","",0,0,K{ALL},F1,U0$,F2$,F9$
4150 DIM L[24]; CALL "ZZPACK",X3$,"R",F8$+"","",0,0,L{ALL},F2,U0$,F3$+P$,F9$
4195 RETURN 
7090 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,1
9045 REM 
9050 ON Y7 GOTO 9060,9100,9190,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOSUB 6600; GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9700 REM "FILES
9740 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 0521,9900
9790 RETURN 
9900 REM "END PROGRAM
9940 RUN "ZMENU"
9999 END 
56000 REM + Modification History
56002 REM "205703-Oracle - FID and FIB calls, replace with FN%FID$ and FN%FIB$
