0010 REM "OBSOLETE*Rebuild open S/O and open P/O files <FM2UT3>
0035 REM "3.3 - 09/08/90 - 11.55
0040 REM "Copyright 1990 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 BEGIN 
0105 RUN "ZMENU"
0110 X0$="FM2UT3",X1$="Rebuild S/O and P/O open information"
0120 DIM Z0$(80,"-")
0130 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2
0200 REM 
0205 PRINT @(10,8),"Current company is ",X3$(9,3),
0210 REM PRINT 'CS',@(25,1),"Rebuild open S/O and P/O files",@(0,2),Z0$,
0220 INPUT @(8,10),"Company number to rebuild? ",C0$,
0222 IF C0$="" THEN GOTO 9950
0225 C0$=STR(NUM(C0$):"000"); PRINT @(35,10),'CL',C0$,
0230 OPEN (1,ERR=0220)"PO7"+C0$
0235 K$=KEY(1,END=0240); E$="P/O Receiving in progress"; GOTO 8900
0240 CLOSE (1); OPEN (1)"FS3"+C0$
0245 K$=KEY(1,END=0246); E$="Invoicing in progress"; GOTO 8900
0246 GOSUB 7500
0250 CLOSE (1)
0275 OPEN (1)"FS1"+C0$
0276 LOCK (1,ERR=8900)
0280 OPEN (2)"FS2"+C0$
0281 LOCK (2,ERR=9800)
0285 OPEN (3)"PO1"+C0$
0286 LOCK (3,ERR=9800)
0290 OPEN (4)"PO2"+C0$
0291 LOCK (4,ERR=9800)
0295 INPUT (0,ERR=0295)@(10,20),"Are you sure that you wish to rebuild these files? ",A$:("Y"=0296,"y"=0296,"N"=9930,"n"=9930)
0296 PRINT @(0,20),'CE',
0300 REM 
0310 PRINT @(0,10),'CE',@(23,10),"Clearing sort files",
0320 F$="FS4"+C0$; GOSUB 7000
0325 F$="FS5"+C0$; GOSUB 7000
0330 F$="PO4"+C0$; GOSUB 7000
0335 F$="PO5"+C0$; GOSUB 7000
0340 F$="FSO"+C0$; GOSUB 7000
0400 REM 
0405 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15]
0410 PRINT @(0,10),'CE',@(22,10),"Reseting customer open order amounts",
0420 CLOSE (5)
0425 OPEN (5)"AR1"+C0$
0430 K$=KEY(5,END=0490)
0433 PRINT @(32,12),K$,
0434 C$=""; DIM C[15]
0435 EXTRACT (5,KEY=K$)IOL=0405
0445 C[13]=0
0450 WRITE (5,KEY=K$)IOL=0405
0455 GOTO 0430
0500 REM 
0505 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15],I[16],I[17],I[18],I[19],I[20]
0506 IOLIST I$,I[0],STR(I[1]),STR(I[2]),I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15],I[16],I[17],I[18],I[19],I[20]
0510 PRINT @(0,10),'CE',@(23,10),"Reseting inventory amounts",
0515 CLOSE (5)
0520 OPEN (5)"IC1"+C0$
0530 K$=KEY(5,END=0590)
0533 PRINT @(25,12),K$(1,10)," ",K$(11,10),
0534 I$=""; DIM I[20]
0535 EXTRACT (5,KEY=K$)IOL=0505
0545 I[7]=0,I[8]=0,I[11]=0
0550 WRITE (5,KEY=K$)IOL=0506
0555 GOTO 0530
0600 REM 
0610 GOSUB 7100
1000 REM 
1005 IOLIST S$,S[0],S[1],S[2],S[3],S[4],S[5],S[6],S[7]
1010 PRINT @(0,10),'CE',@(20,10),"Rebuilding sales order information",
1020 K1$=KEY(1,END=1090)
1025 S$=""; DIM S[7]
1030 READ (1,KEY=K1$)IOL=1005
1035 PRINT @(30,12),K1$,
1040 GOSUB 3000
1050 GOSUB 3100
1055 GOSUB 3300
1060 GOTO 1020
1105 IOLIST P$
1110 PRINT @(0,10),'CE',@(20,10),"Rebuilding purchase order information",
1120 K3$=KEY(3,END=1190)
1125 P$=""
1130 READ (3,KEY=K3$)IOL=1105
1135 PRINT @(30,12),K3$,
1140 GOSUB 3200
1160 GOTO 1120
1200 REM "Remove PO3 records that are missing orders or P/Os.
1201 REM "ROUTINE LOOKS UNRELIABLE
1202 GOTO 9900
1204 PRINT @(0,10),'CE',@(23,10),"Fixing shipping instructions",
1205 CLOSE (5); OPEN (5)"PO3"+C0$
1210 K$=KEY(5,END=1290); READ (5)
1215 PRINT @(25,12),K$(1,9),"  ",K$(10,3),"  ",K$(13,1),
1220 FIND (1,KEY=K$(1,8),DOM=1221); F0$="S"; GOTO 1250
1225 FIND (3,KEY=K$(1,9),DOM=1270); F0$="P"; GOTO 1250
1249 REM "if line # blank then these are general inst. and ok 
1250 IF K$(10,3)="   " THEN GOTO 1210
1255 REM "If now see if line is found, if so continue reading
1260 IF F0$="S" THEN FIND (2,KEY=K$(1,8)+K$(10,3),DOM=1270); GOTO 1210 ELSE FIND (4,KEY=K$(1,9)+K$(10,3),DOM=1270); GOTO 1210
1270 REM "If here then delete
1275 REMOVE (5,KEY=K$,DOM=1210); GOTO 1210
1290 GOTO 9900
3000 REM "Update based on order header
3005 REM "Update FS4
3010 WRITE (8,KEY=S$(6,10)+S$(118,8))
3090 RETURN 
3100 REM "Update order lines
3105 IOLIST L$,L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15],L[16],L[17],L[18],L[19],L[20],L[21]
3110 READ (2,KEY=K1$,DOM=3111)
3120 K2$=KEY(2,END=3190)
3125 IF K2$(1,LEN(K1$))<>K1$ THEN GOTO 3190
3127 L$=""; DIM L[21]
3130 READ (2,KEY=K2$)IOL=3105
3135 PRINT @(39,12),K2$(9,3),
3140 GOSUB 4000
3145 GOSUB 4050
3180 GOTO 3120
3190 RETURN 
3200 REM "Update PO header
3210 WRITE (10,KEY=P$(7,14)+P$(297,9))
3220 CALL "PO2MAH",X3$,P$(173,1),K3$,"1"
3290 RETURN 
3300 REM "Update FSO file
3310 WRITE (13,KEY=S$(6,10)+S$(28,15)+S$(118,8))
3395 RETURN 
4000 REM "Update AR1
4005 C$=""; DIM C[15]
4010 EXTRACT (6,KEY=S$(6,10),DOM=4040)IOL=0405
4020 C[13]=C[13]+L[6]
4025 IF C[13]<0 THEN C[13]=0
4030 WRITE (6,KEY=S$(6,10))IOL=0405
4040 RETURN 
4050 REM "Update FS5
4055 IF POS(L$(155,1)="IC")<>0 THEN GOTO 4065
4056 REM "if not inv check to see if custom item that is also customer inv.
4057 IF L$(14,1)<>"Y" THEN GOTO 4090
4059 L$(161,10)=S$(6,10)
4060 READ (12,KEY=L$(161,10)+L$(19,10),DOM=4090)
4065 IF L$(155,1)="I" THEN DIM L0$(20); L0$(11,10)=L$(19,10) ELSE L0$=L$(161,10)+L$(19,10)
4070 L0$=L0$+L$(10,4)+L$(147,8)+L$(6,3)
4075 WRITE (9,KEY=L0$)
4080 GOSUB 4100
4090 RETURN 
4100 REM "Update IC1
4102 IF L$(9,1)<>" " OR POS(L$(155,1)="IC")=0 OR POS(L$(10,4)="    DS  ",4)>0 THEN GOTO 4140
4105 EXTRACT (7,KEY=L0$(1,24),DOM=4140)IOL=0505
4110 I[7]=I[7]+L[0],I[11]=I[11]+L[8]
4135 WRITE (7,KEY=L0$(1,24))IOL=0506
4138 IF S$(43,1)="Y" THEN GOSUB 4200
4140 RETURN 
4200 REM "Do work order committing if necessary
4205 IOLIST W$,W[0],W[1],W[2]
4210 DIM W[3],W$(50)
4215 IF L$(155,1)="I" THEN W$(1)=S$(6,10)+"          "+L$(19,10)+S$(118,8) ELSE W$(1)=S$(6,10)+L$(161,10)+L$(19,10)+S$(118,8)
4220 READ (14,KEY=W$(1,38),DOM=4245)IOL=4205
4225 IF LEN(W$)<317 THEN W0$=W$(11,20) ELSE W0$=W$(11,20)+W$(317,80)
4245 RETURN 
7000 REM "Erase and redefine a file
7004 PRINT @(30,12),'CE',F$,
7005 CLOSE (5); OPEN (5)F$
7010 F0$=FID(5); CLOSE (5)
7015 ERASE F0$(4,6),ERR=7016; GOTO 7015
7020 FILE F0$
7040 RETURN 
7100 REM "Open other files
7105 OPEN (6)"AR1"+C0$
7110 OPEN (7)"IC1"+C0$
7115 OPEN (8)"FS4"+C0$
7120 OPEN (9)"FS5"+C0$
7125 OPEN (10)"PO4"+C0$
7130 OPEN (11)"PO5"+C0$
7135 OPEN (12)"IC0"+C0$
7140 CLOSE (13); OPEN (13)"FSO"+C0$
7142 CLOSE (14); OPEN (14)"FW0"+C0$
7145 RETURN 
7500 F$="AR1FS1FS2IC0IC1"
7510 E$="Required Files cannot be locked"
7520 FOR I=1 TO LEN(F$) STEP 3
7530 CLOSE (1); OPEN (1,ERR=8900)F$(I,3)+C0$; LOCK (1,ERR=8900)
7540 NEXT I
7550 RETURN 
8900 REM "Error messages
8910 PRINT @(0,20),'CE',@(20,20),E$," ",
8920 INPUT *
8930 GOTO 9950
9900 REM 
9910 PRINT @(20,10),'CE',
9920 INPUT @(20,10),"Process complete - <Return> to continue ",*
9950 RUN "ZMENU"
9999 END 
