0010 REM "Sales Order Entry I - Menu <FM2ODM>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 02/15/23 - 17.260131 - dmm - SSP# 307430
0037 REM "307430-DBD-333;Add 101 to some of 288's company specfic code       
0040 REM "Copyright 2023 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0074 X0$="FM2ODM"
0075 IF L0=2 THEN L0=0; GOSUB 6400; IF L3=1 THEN CREDIT_DELETE$="Y"; GOTO 6500 ELSE CALL "FM2ODH",X3$,-1,A$,A{ALL}; GOTO 6510; REM "Added L3=1, SSP116915
0080 IF H1=2 THEN H1=0; PRINT @(0,3),'CE',; GOSUB 6400; GOTO 6707 ELSE IF H1=1 THEN H1=0; GOTO 6710
0090 BEGIN ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0110 X0$="FM2ODM",X1$="Sales Order Entry - Submenu",K9$="",K9=0
0120 DIM Z0$(80,"-"),B[20]
0130 K0=5,K1=1
0135 C9=-1
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$(1,LEN(A$)),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13]
0330 IOLIST C$,C0
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15],D[16],D[17],D[18],D[19],D[20],D[21],D[22],D[23],D[24],D[25],D[26],D[27],D[28],D[29]
0341 IOLIST J$,J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7]
0400 IOLIST J$,J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01X FS1...  02ORAR1...  03O FS2...  04O FSA...  07O FSH...  08O FMN...  09O POE...  10O PO1...  13O ZZPARM  15O ZY9     16O FTO...  17O AR2...  18O EDD...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0530 DIM SEC$(255); READ (Z[13],KEY="osec"+X3$(40,3),DOM=0531)SEC$
0580 READ (Z[13],KEY=X3$(9,3)+"F/M")P7$
0582 MFF_PARM=0; IF MID(P7$,337,1)="Y" THEN MFF_PARM=1 ! SSP 276772
0585 GB$=""; READ (Z[13],KEY=X3$(9,3)+"G/B",DOM=0586)GB$
0590 READ (Z[1],KEY=K9$,DOM=0591)
0600 REM "
0605 ! GOSUB 7400 Don't need this logic in this program SSP159448
0610 DIM D4$(20); FIND (Z[13],KEY=X3$(1,6)+"FD",DOM=0611)D4$
0620 GOSUB 6000
0690 READ (Z[1],KEY=K9$,DOM=0691)
0800 REM 
0810 GOSUB 8950
1000 REM "
1010 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
1030 DIM B$(397)
1035 DIM A$(606),A[13],D[29] ! WO212768, increase FS1 from 350 to 606
1045 A$(1,0)=K9$+A1$,P$="FM2ODB"
1060 PRINT (0,ERR=1070)'CF',; GOSUB 6450; GOTO 1100
1070 GOSUB 6000; GOSUB 6450
1100 REM "KEY SEQ
1110 X0=-1,C0=0,X1=0,C9=0,Z9=0
1120 C0=ABS(C0),X$=""; IF C0=2 AND X0>0 THEN X0=X0-1 ELSE IF C0<>2 THEN X0=X0+1; IF C0=4 THEN GOTO 9900
1140 ON X0 GOTO 1200,1500
1200 REM "Order no
1202 IF Q1$<>"" AND Q3$="DELETE" THEN READ (Z(1),KEY=Q1$,DOM=*NEXT)IOL=0310 ! SSP#266567
1205 IF Q1$<>"" THEN A$(118,8)=Q1$,A1$=Q1$,Q1$=""; GOSUB 6460; IF Q3$="DELETE" THEN Q3$=""; GOTO 6507 ELSE GOTO 1120 ! SSP#222639 If Q3$="DELETE" then already deleted on header screen goto 6508 had been changed to 6500 This was causing prob seen on 218413
1206 X$="Enter "+QUO+"A"+QUO+" to automatically assign the next order number",Q1=0
1210 CALL "ZZENTR","AUX",A{ALL},A$,X4$,X3$,10,3,118,8,C0,"O/P","{1"+X$,P6$,"FM2ODM00","FS1","",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 1210,1211
1215 IF C0<0 THEN ON INT(ABS(C0)-2) GOTO 1210,6800,9700,6970
1218 X$=""; IF A$(118,1)="A" AND POS(A$(119,1)=" 123456789")>0 AND (STP(A$(120,6))="" OR A$(120,6)="000000") THEN X$=A$(118,2) ELSE IF A$(120,1)="A" AND POS(A$(121,1)=" 123456789")>0 AND STP(A$(122,4))="" THEN X$=A$(120,2) ! SSP#223123
1219 IF X$>"" THEN GOSUB 3600; A$(118,2)=D4$(9,2); GOSUB 3500
1220 IF A$(118,2)<>"00" THEN READ (Z[7],KEY=A$(118,2),DOM=1225); GOTO 1230 ELSE GOTO 1230
1225 CALL "ZZPROM",".4",X3$,X3,"Division "+A$(118,2)+" is not on file","","",0; GOTO 1200
1229 REM "Check that 1st 2 digits are numeric - except if this is a remote location
1230 IF X3$(330,1)<>"1" THEN A=NUM(A$(118,2),ERR=1210)
1240 GOTO 1120
1500 REM "
1505 Z9=-1
1510 A1$=A$(118,8),A$(1,LEN(K9$))=K9$
1520 EXTRACT (Z[1],KEY=A1$,DOM=1600)IOL=0310
1521 IF POS(A$(63,1)="SP")<>0 THEN CALL "ZZPROM",".4",X3$,0,"Access denied! Order is being picked","","",0; READ (Z[1],ERR=1000); GOTO 1000
1522 IF POS(A$(63,1)="Y")<>0 THEN CALL "ZZPROM","X0FM2ODM",X3$,Z,"","","",0; IF Z=0 THEN GOTO 1000 ELSE IF POS(X3$(9,3)="543491434475321338363364365366020",3)<>0 THEN INPUT @(0,21),'CL',"Password: ",IN$,; PRINT @(0,21),'CL',; IF IN$<>"COKE" THEN GOTO 1000 END_IF END_IF ; EXTRACT RECORD (Z[1],KEY=A1$)X$; X$(63,1)=""; WRITE RECORD (Z[1])X$; X$=""
1523 CALL "UPDFTO;CHECK_PO_LOCK",X3$,X4$,"M",NEW_FTO$,A1$,FTO_REC$,BATCH_EXISTS$,"Y"; IF BATCH_EXISTS$="W" THEN GOTO 1000 ! SSP 262321 
1525 Z9=0
1526 REM "GOSUB 8200; REM "133130,137789 
1530 FIND (Z[2],KEY=A$(6,10),DOM=1531)IOL=0320
1535 GOSUB VALIDATE_REP; IF NOT(VAL_REP) THEN CALL "ZZPROM",".4",X3$,0,"Access denied! You may not view this customer","","",0; GOTO 1000
1549 REM "This prevents going to reverse logic if coming from menu selection 01/23/90
1550 IF Q1>0 THEN GOTO 1590
1580 CALL "FM2ODH",X3$,-1,A$,A{ALL}
1585 IF P7$(276,1)="Y" THEN READ (Z[8],KEY=A1$,DOM=1586); X$=A1$; CALL "FM2NPA",X3$,X4$,"D1",X$; PRINT @(0,3),'CE',; GOSUB 6000; REM "WO106523, if entering existing order number and there is an existing order notepad, display it and allow modification
1590 GOTO 1700
1600 REM "
1620 CALL "ZZPROM","2",X3$,Z,"","","",0; ON Z GOTO 1650,1630
1630 IF Q1$>"" THEN GOTO 9700 ELSE GOTO 1000
1680 DIM J$(48),J[7]; WRITE (Z[4],KEY=FID(0)+A$(118,8))IOL=0341
1690 Q$="FM2ODA"; GOTO 5900
1700 REM "
1740 GOSUB 6200
1741 IF MID(P7$,315,1)<>"Y" THEN GOTO 1800; REM SSP 187465, 194878
1751 FIND (Z[17],KEY=A$(87,2),DOM=1800)AR2$; REM "SSP 187465
1761 IF AR2$(57,1)<>"Y" THEN GOTO 1800; REM SSP 187465
1765 HAS_CCV_MOD=0; IF FN%HAS_MODULE("CV") THEN HAS_CCV_MOD=1 ! SSP 229993
1771 READ (Z[18],KEY=A$(118,8),DOM=1775)
1772 DIM EDD_KEY$(11," "); REM SSP
1775 EDD_KEY$=KEY(Z[18],END=*NEXT); IF EDD_KEY$(1,8)<>A$(118,8) THEN Q$="You Must Complete the Credit Card Information Before Continuing"; CALL "ZZPROM",".4",X3$,0,Q$,"","",0
1776 HLD_CUST$=%CUSTOMER$,%CUSTOMER$=MID(A$,6,10) ! SSP 279964
1777 IF MID(EDD_KEY$,1,8)<>A$(118,8) THEN IF NOT(HAS_CCV_MOD) THEN CALL "EC3MAD",X3$,X4$,A$(118,8)+A$(285,4),"FM2ODM",ERR=1800 ELSE ORDER$=A$(118,8); IF TCB(88)=0 THEN MSGBOX MSG("WARN_WINDX"),MSG("ERROR"),"OK"; GOTO 1800 ELSE PROCESS "CVGMAD","../CVG/CV.EN",ORDER$ ! SSP 229993
1780 READ (Z[18],KEY=EDD_KEY$)EDD$
1785 IF MID(EDD$,16,20)=DIM(20) OR LEN(EDD$)<100 THEN Q$="You Must Complete the Credit Card Information Before Continuing"; CALL "ZZPROM",".4",X3$,0,Q$,"","",0
1787 IF MID(EDD$,16,20)=DIM(20) OR LEN(EDD$)<100 THEN IF NOT(HAS_CCV_MOD) THEN CALL "EC3MAD",X3$,X4$,A$(118,8)+A$(285,4),"FM2ODM",ERR=1790 ELSE ORDER$=A$(118,8); IF TCB(88)=0 THEN MSGBOX MSG("WARN_WINDX"),MSG("ERROR"),"OK"; GOTO 1790 ELSE PROCESS "CVGMAD","../CVG/CV.EN",ORDER$ ! SSP 229993
1790 GOSUB 6400
1792 %CUSTOMER$=HLD_CUST$ ! SSP 279964
1800 REM "
1850 REM "MODIFY
1855 X0=X0-1; IF Z9=1 THEN GOTO 1880 ELSE IF Z9=0 THEN Z9=1
1860 READ (Z[1],KEY=A1$,DOM=1870)IOL=0310
1865 C9=1
1870 GOSUB 6200
1890 GOTO 2000
2010 P0=17,P1=5,P=0,P$="",P9$=""
2020 PRINT @(0,P1),'CE',
2030 Q$="Order header data",P$="RFM2ODA"; GOSUB 3000
2035 Q$="Line data",P$="RFM2ODB"; GOSUB 3000
2040 Q$="Purchase order data",P$="RPO2MAA"; GOSUB 3000
2045 Q$="Item specification",P$="RFM2IAZ"; GOSUB 3000
2050 Q$="Shipping instructions",P$="RFM2ODG"; GOSUB 3000
2055 Q$="Special shipping instructions",P$="RFM2ODC"; GOSUB 3000
2060 Q$="Order summary data",P$="RFM2ODT"; GOSUB 3000
2065 Q$="Order notepad",P$="RFM2NPA"; GOSUB 3000
2070 Q$="Delete this sales order",P$=" DELETE"; GOSUB 3000
2075 Q$="Job Notes",P$=" ZZGMBA"; GOSUB 3000; REM " SSP 185579
2100 REM "
2120 CALL "ZZPROM","M0",X3$,Z,"","","",20
2122 DIM Q$(2)
2123 X$=""
2125 CALL "ZZENTR","ZX",A{ALL},Q$,X4$,X3$,59,20,1,2,C0,"",X$,"","AR2MAA10","","",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2125,2126
2127 Q0=NUM(Q$,ERR=2125); PRINT @(18,20),'CL',
2130 IF C0<0 THEN Q1$=""; GOTO 6700
2134 IF Q0<1 OR Q0>P THEN GOTO 2120
2136 IF Q0=2 OR Q0=6 THEN GOSUB 8200; IF NEW_FTO$="Y" THEN GOTO 2100
2165 Q$=P0$((Q0-1)*6+1,6)
2215 IF Q$(1,2)="NA" THEN CALL "ZZPROM","4",X3$,Q1,"Option "+STR(Q0)+" is not currently available","","",0; GOTO 2120
2240 PRINT @(0,P1),'CE',
2241 IF Q$="ZZGMBA" THEN GOSUB 3700; GOTO 2000 ! " SSP 185579
2245 IF Q$="DELETE" THEN GOTO 6500
2265 IF P9$(Q0,1)="R" THEN GOTO 3100
2275 CALL Q$,ERR=2280,X3$,X4$,Q0$,A1$
2285 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,-1
2290 GOTO 2000
3000 REM "print menu line
3020 P=P+1,P0$=P0$+P$(2),P9$=P9$+P$(1,1)
3040 PRINT @(P0,P1+P),P:"##.#",Q$
3090 RETURN 
3100 REM "SETUP RUN SEQUENCE
3105 P$=Q$
3110 U0$=X3$(1,6)+"PF"
3120 Q$=STR(LEN(A1$):"00")+A1$
3123 IF LEN(U1$)<5 THEN U1$="" ELSE IF U1$(1,6)=X0$ THEN U1$=""
3125 IF P$="FM2IAZ" THEN U1$=P$+"11"+A$(6,10)+"!"+X0$+Q$+U1$ ELSE U1$=P$+Q$+X0$+Q$+U1$
3130 WRITE (Z[13],KEY=U0$)U0$,U1$
3150 REM CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z(ALL),0,0
3190 SETERR 3195; RUN P$
3195 SETERR 9000
3500 REM "277659 - Get next order number; support for alphanumeric sequences
3510 ! EXTRACT RECORD (Z[7],KEY=A$(118,2),DOM=3540)N$
3515 ! Z=0; IF X$(2,1)<>" " THEN Z=138+(NUM(X$(2,1))-1)*6,A$(120,6)=N$(Z,6); GOTO 3522 ELSE A$(120,6)=N$(5,6)
3522 ! P0=NUM(A$(120,6)),P0=P0+1; IF P0>999999 THEN P0=1 ELSE IF P0=1 THEN A$(120,6)="000001"; GOTO 3522
3524 ! IF Z>0 THEN N$(Z,6)=STR(P0:"000000") ELSE N$(5,6)=STR(P0:"000000")
3526 ! WRITE RECORD (Z[7])N$
3528 ERRMSG$="",NEXT_ORDER$=""; CALL "FMGMPB;GET_NEXT_ORDERNUM",Z[7],A$(118,2),X$(2,1),"",NEXT_ORDER$,ERRMSG$
3529 A$(118,8)=NEXT_ORDER$
3530 FIND (Z[1],KEY=A$(118,8),DOM=*NEXT); GOTO 3528
3535 CALL "ZZDISP","A",A$(118,8),"O/P",X3$,"","",10,3,X4$
3540 RETURN 
3600 REM "Temporary Change division
3610 FIND (Z[7],KEY=A$(118,2),DOM=3640)
3620 D4$(9,2)=A$(118,2)
3640 RETURN 
3700 REM "Job Notes SSP 185579
3710 CALL Q$,X3$,X4$,"O",A1$
3795 GOTO 2000
3799 ! ******************************************************
5900 REM "Setup new order sequence
5910 U0$=X3$(1,6)+"PF"
5920 Q$=STR(LEN(A1$):"00")+A1$,Q0$=STR(LEN(A1$):"00")+A1$,U1$="FM2ODA"+Q$+"FM2ODB"+Q0$+"FM2ODG"+Q$+"FM2ODT"+Q$+X0$+Q$+U1$
5930 WRITE (Z[13],KEY=U0$)U0$,U1$
5980 REM CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z(ALL),0,0
5990 SETERR 5995; RUN U1$(1,6)
5995 GOTO 0001
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6006)'SB',
6060 PRINT @(0,3),"Order no:",@(21,3),"Customer:",@(0,4),Z0$,
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6215 GOSUB 6450
6220 CALL "ZZDISP","A",A$(6,10),"A/R",X3$,"","",31,3,X4$
6224 PRINT @(44,3),B$(11,35),
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>=0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6455 IF C9<0 THEN GOTO 6445
6460 CALL "ZZDISP","A",A$(118,8),"O/P",X3$,"","",10,3,X4$
6490 RETURN 
6500 REM "DELETE
6501 READ (Z(1),KEY=A1$,DOM=6502)IOL=0310
6502 IF A$(241,1)="Y" THEN CALL "ZZPROM",".4",X3$,0,"Access Denied!  This B type order has product received. May not be deleted.","","",0; IF CREDIT_DELETE$="Y" THEN GOTO 7500 ELSE GOTO 1820; REM "WO111482, SSP 138623
6503 IF SEC$(67,1)="Y" THEN GOSUB 7800; IF POCF$(189,1)="P" THEN CALL "ZZPROM",".4",X3$,0,"Access Denied!  Purchase Order previously printed. May not be deleted.","","",0; GOTO 1820; REM "W/O 105690/ssp 197007
6504 IF CREDIT_DELETE$<>"Y" THEN IF GB$<>"" THEN DIM Q$(6); PRINT @(20,21),"Delete password: ",; CALL "ZZENTR","SP",A{ALL},Q$,X4$,X3$,37,21,1,6,C0,"","","","FM2ODM15","","",""; PRINT @(0,21),'CE',; IF Q$<>"VOLS#1" THEN CALL "ZZPROM",".4",X3$,0,"Access Denied!","","",0; GOTO 1820
6505 IF A$(1,1)<>" " AND SEC$(54,1)="Y" THEN CALL "ZZPROM",".4",X3$,0,"Access Denied!  Packing List previously printed. May not be deleted.","","",0; IF CREDIT_DELETE$="Y" THEN GOTO 7500 ELSE GOTO 1820; REM "SSP138623
6506 IF CREDIT_DELETE$<>"Y" THEN CALL "ZZPROM",".Y",X3$,Z,"|Verify you wish to delete","","",0; IF Z=1 THEN GOTO 2000 ! SSP218413 jdf!SSP#222639 - line was rem'd on 218413 if rem'd no longer verifys deletes
6507 IF A$(54,1)="B" AND A$(240,1)="Y" THEN DATA$="",TYPE$="D"+A$(237,3); CALL "FM2ICB",X3$,X4$,"FM2ODM",A1$,TYPE$,DATA$; IF DATA$="PENDING" THEN CALL "ZZPROM",".4",X3$,0,"Access Denied! This B type order has pending inventory costing transactions.","","",0; IF CREDIT_DELETE$="Y" THEN GOTO 7500 ELSE GOTO 1820 END_IF ELSE IF DATA$="INVOICED" THEN CALL "ZZPROM",".Y",X3$,Z,"This B type order has invoiced costs, continue with delete?","","",0; ON Z GOTO 7850,1820; REM "SSP138623
6509 CALL "UPDFTO;CHECK_PO_LOCK",X3$,X4$,"D",NEW_FTO$,A$(118,8),FTO_REC$,BATCH_EXISTS$,"Y"; IF BATCH_EXISTS$="Y" THEN IF CREDITDELETE$="Y" THEN GOTO 7500 ELSE GOTO 1820 ! SSP 262321 
6512 X$=""; GOSUB 7750; IF X$="Y" THEN CALL "ZZPROM",".A1",X3$,Z,"This order has unbilled costs and cannot be deleted","","",0; IF CREDIT_DELETE$="Y" THEN GOTO 7500 ELSE ON Z GOTO 2000,6513; REM "SSP138623  SSP 262321
6513 IF X$="Y" AND POS(X3$(9,3)="491321020101288500828",3)<>0 THEN INPUT @(0,22),'CL',"Password: ",IN$,; PRINT @(0,22),'CL',; IF IN$<>"DONN" THEN GOTO 2000; REM " SSP# 146941!SSP#2504788 SSP 262321 SSP307430-DBD-333-DBSPT-149880
6514 IF X$="Y" AND POS(X3$(9,3)="080568589",3)<>0 THEN INPUT @(0,22),'CL',"Password: ",IN$,; PRINT @(0,22),'CL',; IF IN$<>"4MONKEY" THEN GOTO 2000; REM " SSP# 196818  !SSP#245964 SSP 262321
6515 PRINT @(27,21),"Deleting order information", ! SSP 262321
6530 CALL "FM2ODH",X3$,-2,A$,A{ALL}
6535 IF FN%HAS_MODULE("EC") AND P7$(322,1)<>"Y" THEN CALL "FM2OBE",X3$,X4$,A1$,"",3; REM " SSP 180100. SSP234938, this is a full delete of all EDW records, now have a parm that says don't delete EDW record when deleting FS2 records, honor this here.  May have a situation where the order will be reentered and we need to keep EDW in tact.  If no reentry, then there will be EDW records with no match in FS2/FT4.
6540 GOSUB 7600
6545 IF %MSLC THEN CKEY$="O"+A$(118,8)+A$(6,10); CALL "ARGSCM;DELETE_ALL",CKEY$ ! SSP 225300            
6548 IF MFF_PARM THEN CALL "FMGFV5;DELETE_FINDER_FEE_LINES",A$(118,8) ! SSP 276772
6550 REMOVE (Z(4),KEY=FID(0)+A1$,DOM=*NEXT)
6570 REMOVE (Z[1],KEY=A1$,DOM=6571)
6575 REMOVE (Z[8],KEY=A1$,DOM=6576)
6580 PRINT @(0,21),'CL',
6590 GOTO 1630
6600 REM "ALT KEY DATA READS
6690 RETURN 
6700 REM "ADD ENTRY
6704 H1$="FM2ODM"
6705 FIND (Z[2],KEY=A$(6,10),DOM=6706)IOL=0320; REM "MUST re-read since open credit may have changed
6706 GOSUB 8300; REM "Calculate order total for credit check
6707 IF B[5]<>0 AND B[6]+B[13]<=B[5] AND B[6]+B[13]+ORDER_TOTAL>B[5] THEN H0=1,L3=0,CREDIT_DELETE$="N"; RUN "FM2OA1"; REM "If amount before order was also > credit limit don't show here
6710 CALL "FM2ODH",X3$,1,A$,A{ALL}
6712 IF P7$(240,1)="Y" THEN CALL "FS2DAH",X3$,A$(118,8),0,0
6785 Q1$=""
6790 IF U1$<>"" THEN GOTO 9700 ELSE GOTO 1000
6800 REM "NEXT ENTRY IN FILE
6805 ON 10*FPT(C0)+2 GOTO 6850,6806
6810 A1$=KEY(Z[1],END=6895)
6820 IF A1$(1,LEN(K9$))<>K9$ THEN GOTO 6895
6825 A$(1,LEN(A1$))=A1$,A$(118,8)=A1$
6826 GOSUB 8200; REM "133130
6830 GOSUB 6600
6835 GOSUB 6450
6840 GOTO 1515
6850 REM PRIOR ENTRY
6855 CALL "ZZKEYP",ERR=6856,Z[1],A1$; GOTO 6820
6860 CALL "ZZKEYL",ERR=6861,Z[1],A1$; GOTO 6820
6870 GOTO 6895
6890 GOTO 1515
6895 PRINT 'RB',; READ (Z[1],KEY=K9$,DOM=1140); GOTO 1140
7173 IF P0$(266,1)="Y" AND POS(E$(9,1)=P0$(267,5))>0 THEN GOTO 7160; REM "SSP#098664
7400 REM "Audit already run
7410 FIND (Z[1],KEY="",DOM=7490)V0$,K0$
7420 IF K0$>"" THEN CALL "ZZPROM","4",X3$,S3,"The update has already been initiated. Press |Return>","","",0; GOTO 9900
7430 EXTRACT (Z[1],KEY="",ERR=9800)
7440 Q$="Audit report "+V0$(22,4)+"."+V0$(26,2)+" has already been printed for this data entry."
7445 PRINT @(6,23),Q$,; CALL "ZZPROM","1",X3$,S3,"","","",0; ON S3 GOTO 9800,7446
7450 REMOVE (Z[1],KEY="")
7490 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7505 REM "SSP138623, when coming back from credit check, if delete is chosen we need to check the other things that would disallow a delete and if they apply then don't do the delete, as these other things would be more important than being over the credit limit or past due.  This should only come into play on existing orders, new orders should just fall through to the delete anyway.
7510 H1=0,CREDIT_DELETE$="N"
7515 GOTO 6710
7600 REM "Remove lines & P/O's
7605 GOSUB 7700
7610 READ (Z[3],KEY=A$(118,8),DOM=7611)
7615 K0$=KEY(Z[3],END=7690)
7620 IF K0$(1,8)<>A$(118,8) THEN GOTO 7690
7625 DIM D$(160),D[29]
7630 READ (Z[3],KEY=K0$)IOL=0340
7635 REMOVE (Z[3],KEY=K0$,DOM=7636)
7640 IF D$(9,1)<>" " THEN CALL "FM2ODP",X3$,D$
7670 GOTO 7610; REM "Must reposition
7690 RETURN 
7700 REM "Remove POE comments
7705 READ (Z[9],KEY=A$(118,8),DOM=7706)
7710 K$=KEY(Z[9],END=7740)
7715 IF K$(1,8)<>A$(118,8) THEN GOTO 7740
7720 REMOVE (Z[9],KEY=K$)
7730 GOTO 7710
7740 RETURN 
7750 REM "Check for unbilled costs
7760 READ (Z[3],KEY=A$(118,8),DOM=7761)
7770 READ (Z[3],END=7790)IOL=0340
7775 IF D$(147,8)<>A$(118,8) THEN GOTO 7790
7780 IF D[19]<>0 THEN X$="Y"; GOTO 7790
7785 GOTO 7770
7790 RETURN 
7800 REM "Check to see if PO is printed - W/O 105690
7810 DIM POCF$(512)
7820 READ (Z[10],KEY=A$(118,8)+" ",DOM=7821)POCF$; GOTO 7840
7830 KKPO$=KEY(Z[10],END=7840); IF KKPO$(1,8)=A$(118,8) THEN READ (Z[10],KEY=KKPO$)POCF$
7840 RETURN 
7850 REM "User is deleting a B type order with invoiced costs, need to create transaction(s) to move cost to unallocated
7860 DATA$="",TYPE$="T"+A$(237,3); CALL "FM2ICB",X3$,X4$,"FM2ODM",A1$,TYPE$,DATA$
7890 GOTO 6508
8200 REM "For batch processing, a record is written to FTO file when a PO is being recieved, if another user attempts to recieve in another batch they will recieve a message and will not be allowed to access, do not allow any changes to an order that is in PO Receiving
8202 CALL "UPDFTO;CHECK_PO_LOCK",X3$,X4$,"R",NEW_FTO$,A$(118,8),FTO_REC$,BATCH_EXISTS$,"Y" ! SSP 262321
8295 RETURN 
8300 REM "Calculate order total to test if over credit limit, used to be done after call to FM2ODH but forms already sent to print and if delete option chosen there were problems, SSP116915
8305 ORDER_TOTAL=0; READ (Z[3],KEY=A$(118,8),DOM=8306)
8310 K1$=KEY(Z[3],END=8345)
8315 IF K1$(1,8)<>A$(118,8) THEN GOTO 8345
8320 DIM D[29]
8325 READ (Z[3],KEY=K1$)IOL=0340
8330 ORDER_TOTAL=ORDER_TOTAL+D[6]
8340 GOTO 8310
8345 RETURN 
8950 REM "Program flow logic
8951 REM "Mod to 8977 by cwj 3/5/98 SSP# 087750
8960 U0$=X3$(1,6)+"PF"
8970 FIND (Z[13],KEY=U0$,DOM=8990)U0$,U1$
8975 IF U1$="" THEN RETURN ELSE IF U1$(1,6)="AR2MAA" THEN RETURN 
8977 IF LEN(U1$)>=36 THEN IF (U1$(1,6)="FS2DAX" OR U1$(1,6)="FM2ODX") AND U1$(19,6)="AR2MAA" THEN U1$=U1$(19); GOTO 8990
8980 Q1=NUM(U1$(7,2)),Q1$=U1$(9,Q1),U1$=U1$(Q1+9)
8982 IF Q1>8 AND Q1$(9)="DELETE" THEN Q1$=Q1$(1,8),Q3$="DELETE"
8985 IF Q1<>8 THEN GOTO 8975
8987 IF LEN(U1$)>6 THEN IF U1$(1,6)="FM2ODI" AND U1$(20,1)="-" THEN U1$(20,1)=" ",Q1=0
8990 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9700 REM "PROG FLOW
9710 IF U1$="" THEN REMOVE (Z[13],KEY=U0$,DOM=9900); GOTO 9900
9720 WRITE (Z[13],KEY=U0$)U0$,U1$
9725 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9730 RUN U1$(1,6)
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$(K9+1); EXIT 
9940 SETESC 9350
9945 WRITE (Z[13],KEY=X3$(1,6)+"PF")X3$(1,6)+"PF"
9950 RUN "ZMENU"
9999 END 
20000 VALIDATE_REP:
20010 VAL_REP=0,CUST$=PAD(B$,350)
20020 IF CUST$(278,4)<>DIM(4) THEN CALL "UPDSYO;VAL_REP",ERR=*NEXT,X3$,CUST$(278,4),OK; IF OK THEN VAL_REP=1; GOTO *RETURN
20030 IF CUST$(282,4)<>DIM(4) THEN CALL "UPDSYO;VAL_REP",ERR=*NEXT,X3$,CUST$(282,4),OK; IF OK THEN VAL_REP=1; GOTO *RETURN
20040 IF CUST$(286,4)<>DIM(4) THEN CALL "UPDSYO;VAL_REP",ERR=*NEXT,X3$,CUST$(286,4),OK; IF OK THEN VAL_REP=1; GOTO *RETURN
20050 IF CUST$(290,4)<>DIM(4) THEN CALL "UPDSYO;VAL_REP",ERR=*NEXT,X3$,CUST$(290,4),OK; IF OK THEN VAL_REP=1; GOTO *RETURN
20060 IF CUST$(294,4)<>DIM(4) THEN CALL "UPDSYO;VAL_REP",ERR=*NEXT,X3$,CUST$(294,4),OK; IF OK THEN VAL_REP=1; GOTO *RETURN
20070 IF CUST$(278,20)=DIM(20) THEN VAL_REP=1
20090 RETURN 
56000 REM "191822-Work order to allow sales reps to only see their own        
56002 REM "193416-Can't get in the order                                      
56010 REM "194878-PE(047, FM2ODM-1741) when in O/E.
56012 REM "197937-Order Entry should say "order is being picked" not invoiced 
56014 REM "197945-WMS picking.  if zero pick or qty<ord                       
56016 REM "209390-Recurring issue with invoices being able to be billed out - added password for Bradley
56018 REM "212768-Add Blanket PO feature to work with the Contract feature.
56020 REM "234938-ShipNotice counts on EDW records containing the external 
56021 REM "245964-Need to change the password on the override key for deleting
56022 REM "262321-WMS:  While in WMS PO receiving - able to delete po  - stock
56023 REM "229993-PCI/PA-DSS New CC Module                                    
56024 REM "277659-Modify Division Next Order# sequence logic, allow for alpha 
56025 REM "276772-Multiple Finder's Fees per Customer/Item/Order Line.        
56026 REM "279964-Since release, the CSR's are having an issue with credit    
56028 REM "307430-DBD-333;Add 101 to some of 288's company specfic code       
