0010 REM "Kramer Style Forms Usage Report <FM2KRA>
0015 REM "Prog Type: O -3.0A
0020 SETESC 9300; SETERR 9000
0035 REM "4.1 - 02/19/98 - 14.57 - tma - SSP# 095308
0036 REM "10/14/91; LINE 1340 ADDED TO ALLOW SKIP OF NON-FMS FORMS
0040 REM "Copyright 1997 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0110 X0$="FM2KRA",X1$="Forms Usage Report"
0115 M0$="##.###",M1$="##0-",M2$="##0",M3$="##.0-",M4$="#,##0"
0120 DIM A$(33),A[75],A0$(33),A0[75],C$(387),C[28],S$(40),D$(397),J[36]
0130 MONTH_HEADER$="JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDECJANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC"
0210 T=1,T0=1,T1=15
0220 W3=230
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3),W[4],J5$(W3)
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0300 REM "I/O lists
0305 REM "IOLIST FOR FMD - Forms Mgt Report Info
0310 IOLIST A0$,A0[0],A0[1],A0[2],A0[3],A0[4],A0[5],A0[6],A0[7],A0[8],A0[9],A0[10],A0[11],A0[12],A0[13],A0[14],A0[15],A0[16],A0[17],A0[18],A0[19],A0[20],A0[21],A0[22],A0[23],A0[24],A0[25],A0[26],A0[27],A0[28],A0[29],A0[30],A0[31],A0[32],A0[33],A0[34],A0[35],A0[36],A0[37],A0[38],A0[39],A0[40],A0[41],A0[42],A0[43],A0[44],A0[45],A0[46],A0[47],A0[48],A0[49],A0[50],A0[51],A0[52],A0[53],A0[54],A0[55],A0[56],A0[57],A0[58],A0[59],A0[60],A0[61],A0[62],A0[63],A0[64],A0[65],A0[66],A0[67],A0[68],A0[69],A0[70],A0[71],A0[72],A0[73],A0[74],A0[75]
0313 IOLIST A0$(1),A0[0],A0[1],A0[2],A0[3],X$
0315 IOLIST X[0],Y9[0],X[1],Y9[1],X[2],Y9[2],X[3],Y9[3],X[4],Y9[4],X[5],Y9[5],X[6],Y9[6],X[7],Y9[7],X[8],Y9[8],X[9],Y9[9],X[10],Y9[10],X[11],Y9[11],X[12],Y9[12],X[13],Y9[13],X[14],Y9[14],X[15],Y9[15],X[16],Y9[16],X[17],Y9[17],X[18],Y9[18],X[19],Y9[19],X[20],Y9[20],X[21],Y9[21],X[22],Y9[22],X[23],Y9[23],X[24],Y9[24],X[25],Y9[25],X[26],Y9[26],X[27],Y9[27],X[28],Y9[28],X[29],Y9[29],X[30],Y9[30],X[31],Y9[31],X[32],Y9[32],X[33],Y9[33],X[34],Y9[34],X[35],Y9[35],X[36],Y9[36],X[37],Y9[37],X[38],Y9[38],X[39],Y9[39],X[40],Y9[40],X[41],Y9[41],X[42],Y9[42],X[43],Y9[43],X[44],Y9[44],X[45],Y9[45],X[46],Y9[46],X[47],Y9[47],X[48],Y9[48],X[49],Y9[49],X[50],Y9[50],X[51],Y9[51],X[52],Y9[52],X[53],Y9[53],X[54],Y9[54],X[55],Y9[55],X[56],Y9[56],X[57],Y9[57],X[58],Y9[58],X[59],Y9[59],X[60],Y9[60],X[61],Y9[61],X[62],Y9[62],X[63],Y9[63],X[64],Y9[64],X[65],Y9[65],X[66],Y9[66],X[67],Y9[67],X[68],Y9[68],X[69],Y9[69],X[70],Y9[70],X[71],Y9[71],X[72],Y9[72],X[73],Y9[73],X[74],Y9[74],X[75],Y9[75],X[76],Y9[76],X[77],Y9[77],X[78],Y9[78],X[79],Y9[79],X[80],Y9[80],X[81],Y9[81],X[82],Y9[82],X[83],Y9[83],X[84],Y9[84],X[85],Y9[85],X[86],Y9[86],X[87],Y9[87],X[88],Y9[88],X[89],Y9[89],X[90],Y9[90],X[91],Y9[91],X[92],Y9[92],X[93],Y9[93],X[94],Y9[94],X[95],Y9[95],X[96],Y9[96],X[97],Y9[97],X[98],Y9[98],X[99],Y9[99],X[100],Y9[100]
0325 REM "IOLIST FOR FM1 - Customer Job Master
0330 IOLIST C$(1),C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20],C[21],C[22],C[23],C[24],C[25],C[26],C[27],C[28]
0340 IOLIST D$(1)
0350 IOLIST E$
0370 IOLIST G$
0420 IOLIST X3$,X4$,V1$,V3$,V2$,IOL=0425
0425 IOLIST V$,V[0],V[1]
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0508 IF V$(72,1)="0" THEN Q$="FMC" ELSE Q$="FMD"
0509 IF V$(71,2)="10" THEN Q$="FMC" ELSE Q$="FMD"
0510 Y$="01X "+Q$+"...  03O FM1... 04O AR1... 05O FMP... 06O ZY2    07O FM0...  08O FM3...  "; IF V1$(1,3)<>Y$(5,3) THEN Y$=Y$+"02X "+V1$+"  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0560 READ (Z[13],KEY="STATF/M")F9$
0565 FOR X=0 TO 9; F1$=F1$+F9$(49+X*17,5); NEXT X
0800 REM "Alternate Sort Info & total dim"
0810 DIM U[10,2],U0$(10),Y[5,1]
0815 IF V0=1 THEN V1$="FMD..."
0820 CALL "ZZRSEQ",X3$,X0$,V1$,U,U0,U1,U{ALL},Y{ALL},T0,V0,U0$,T5$,U5$,S9$,X9; ON X9 GOTO 0821,9920
0825 IF V0>1 THEN GOSUB 6950
0850 DIM T[T0,T1]; U5$(1,20)=Q4$
0890 REM "Open Printer
0895 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W8$,W9$,W0,W9,W2,W3,W4; ON W4 GOTO 0896,9920
0896 W8$=W8$+"X"
0900 REM 
0910 GOSUB 8600; REM "to set print positions and spacing factors
0920 F0=0; REM "f0=0 haven't printed any yet, f0=1->nowprinting, f0=2->finishing up the last one.
0950 REM " Position read"
0970 DIM V4$(U); U9=1; FOR X=1 TO U0; V4$(U[X,0],U[X,1])=V2$(U9,U[X,1]); U9=U9+2*U[X,1]; NEXT X
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
0995 GOTO 8300
1000 REM "Read next record and check range
1005 U$=KEY(U1,END=5000)
1010 FOR X=1 TO U0; U2=U[X,0],U3=U[X,0]*2-1,U4=U[X,1]
1020 IF U$(U2,U4)<V2$(U3,U4) THEN READ (U1); EXITTO 1000
1030 IF U$(U2,U4)>V2$(U3+U4,U4) THEN IF X=1 THEN EXITTO 5000 ELSE READ (U1); EXITTO 1000
1040 NEXT X
1100 REM "Get record"
1110 U9$=U$; IF V0<2 THEN GOTO 1150 ELSE U$="",X=0
1120 IF Y[X,0]>0 THEN U$=U$+U9$(Y[X,0],Y[X,1]),X=X+1; GOTO 1120
1130 READ (U1)
1150 REM " It takes care of this during FM2RUA IF U$(21,1)="D" AND U$(22,1)<>"9" THEN READ (Z[1]) ; GOTO 01000; REM "SKIP DISTRIBUTER INVENTORY NOT OWNED BY CUSTOMER
1155 READ (Z[1],KEY=U$,DOM=1000)IOL=0310
1156 IF A0$(89,1)="I" THEN A0[72]=0
1159 U8$=A$(1,20)
1160 IF A0$(1,20)=A$(1,20) THEN GOSUB 7700; FOR I=0 TO 75; A[I]=A[I]+A0[I]; NEXT I; GOTO 1000
1165 IF F0=0 THEN F0=1; GOTO 1950
1200 REM "Additional Reads
1210 IF D$(1,10)<>A$(1,10) THEN GOSUB 8200
1220 IF D$(1,10)+A$(21,5)<>G$(2,10)+G$(1,1)+G$(12,4) THEN READ (Z[7],KEY=A$(21,1)+D$(1,10)+A$(22,4),DOM=1221)IOL=0370
1330 DIM C$(LEN(C$)); FIND (Z[3],DOM=1331,KEY=A$(1,20))IOL=0330
1340 IF POS("F"=V$(60,11))>0 THEN IF C$(108,1)<>"Y" THEN GOTO 1960
1400 REM "Subtotals"
1410 IF U2$="" THEN GOTO 1490 ELSE FOR T=1 TO U0; IF U8$(U[T,0],U[T,1])<>U2$(U[T,0],U[T,1]) THEN EXITTO 1420 ELSE NEXT T; GOTO 1480
1425 GOSUB 3100
1490 T=0,U2$=U8$
1500 REM "PRINT DATA
1510 IF W-1>W0 THEN GOSUB 6000
1515 IF X[1]<>0 THEN Y5$(X[1])=C$(345,5)
1520 Y5$(X[2])=A$(11,10),Y5$(X[3])=C$(42,40)
1530 Y5$(X[4])=" ",Y5$(X[5])=" "+C$(100,2),Y5$(X[6])=STR(C[4]:"####")
1532 IF POS("C"=V$(60,11))<>0 AND C[0]<>0 THEN Y5$(X[5])=" CT",Y5$(X[6])=STR(C[0]:"####"); REM "X(5) was " CA", changed to " CT" per Cyndi 2/6/96
1535 N=A[71],N0=X[27]; GOSUB 2000; REM "Opening inv - whse
1536 REM "IF G$(223,1)="I" THEN LET A[72]=0; REM "0 OUT YOUR SITE IF ISSUE BASED LOCATION
1540 N=A[72],N0=X[28]; GOSUB 2000; REM " Opening inv - your site
1545 N=A[74],N0=X[29]; GOSUB 2000; REM " Recv'd whse
1550 N=A[47]+A[46],N0=X[30]; GOSUB 2000; REM " Drawn - your site
1560 N=A[3],N0=X[31]; GOSUB 2000; REM " Ending inv - whse
1565 N=A[4],N0=X[32]; GOSUB 2000; REM " Ending inv - your site
1570 N=A[3]+A[4],N0=X[33]; GOSUB 2000; REM " Ending inv - total
1575 N=A[8],N0=X[34]; GOSUB 2000; REM " Qty on order
1580 I0=1; GOSUB 2200
1590 FOR I2=1 TO 3
1591 IF Q9=1 THEN L0=99.9 ELSE IF C[4]=0 THEN L0=L[I2] ELSE L0=L[I2]/C[4]
1593 IF FPT(L0)=0 THEN Y5$(X[46+I2])=STR(L0:M2$) ELSE Y5$(X[46+I2])=STR(L0:M3$)
1595 NEXT I2
1600 REM 
1610 IF C[4]=0 THEN N9=C[23],N8=C[16] ELSE N9=C[23]/C[4],N8=C[16]/C[4]
1613 IF Q9=1 THEN N9=99.9
1615 IF FPT(N9)=0 THEN Y5$(X[8])=STR(N9:M2$) ELSE Y5$(X[8])=STR(N9:M3$)
1619 IF Q9=1 THEN N7=99.9 ELSE N7=C[22]/30
1620 IF FPT(N7)=0 THEN Y5$(X[9])=STR(N7:M2$) ELSE Y5$(X[9])=STR(N7:M3$)
1621 REM "GOSUB 04000
1623 IF Q9=1 THEN N8=99.9
1625 IF FPT(N8)=0 THEN Y5$(X[10])=STR(N8:"##") ELSE Y5$(X[10])=STR(N8:"##.#")
1630 GOSUB 4000; REM " IF POS(" "<>C$(126,6))<>0 THEN LET J$=FND$(C$(126,6)), Y5$(X[11])=J$(1,3)+J$(9,2)
1680 GOSUB 7300
1700 REM "LINE 2
1709 IF X[12]<>0 THEN Y5$(X[12])=A$(48,8)
1710 IF X[13]<>0 THEN Y5$(X[13])=A$(56,8)
1711 IF X[14]<>0 THEN Y5$(X[14])=A$(64,2)
1715 IF X[15]<>0 THEN Y5$(X[15])=C$(238,2); IF POS(" "<>C$(238,4))<>0 AND X[16]<>0 THEN Y5$(X[16])=STR(C[25]:"####")
1719 REM "Watch - X(17) may need changing depending on other values ESP - X(27)
1720 IF X[17]<>0 THEN Y5$(X[17])=J5$(X[17]),J5$(1)=""; REM " J5$ SET IN 2000'S
1725 IF POS(" "<>A$(26,6))=0 THEN Y5$(X[18])="" ELSE J$=FND$(A$(26,6)),Y5$(X[18])=J$(1,3)+J$(9,2)
1750 I0=2; GOSUB 2200
1755 FOR I2=1 TO 3
1756 IF Q9=1 THEN Y5$(X[49+I2])="99.9"; GOTO 1760 ELSE IF L[I2]=0 OR A[3]+A[4]=0 THEN L0=0 ELSE L0=(A[3]+A[4])/L[I2]
1757 IF L0>99 THEN Y5$(X[49+I2])=">99"; GOTO 1760
1758 IF FPT(L0)=0 THEN Y5$(X[49+I2])=STR(L0:M2$) ELSE Y5$(X[49+I2])=STR(L0:M3$)
1760 NEXT I2
1795 GOSUB 7300
1800 REM "Line 3
1805 I0=3; GOSUB 2200
1806 REM "GOTO 01890
1854 REM "Days on hand
1855 FOR I2=1 TO 3
1856 IF Q9=1 THEN L0=9999; GOTO 1858 ELSE IF L[I2]=0 OR A[3]+A[4]=0 THEN L0=0 ELSE L0=(A[3]+A[4])*30/L[I2]
1857 IF L0>3000 AND X[52+I2]<>0 THEN Y5$(X[52+I2])=">3000"; GOTO 1860
1858 IF X[52+I2]<>0 THEN Y5$(X[52+I2])=STR(L0:M4$)
1860 NEXT I2
1890 GOSUB 7300; IF W<W0+4 THEN GOSUB 7300
1900 REM "Accumulate Totals"
1910 T[T0,0]=T[T0,0]+1
1920 FOR X=0 TO 8; T[T0,X+1]=T[T0,X+1]+A[X]; NEXT X
1922 REM LET T(T0,6)=A(22),T(T0,7)=A(23)
1950 REM "Load A from A0 for next one, unless this was the last one (F0=2)
1960 IF F0=2 THEN GOTO 5010 ELSE IF Q9<>1 THEN A$=A0$,J1$=""; DIM J[36]; GOSUB 7700; FOR I=0 TO 75; A[I]=A0[I]; NEXT I
1995 IF Q9=1 THEN RETURN ELSE GOTO 1000
2000 REM "Format an print a number, N=number, N0=col #,
2001 REM "Also calc div by second pack and put into J5$
2005 IF N0=0 THEN RETURN 
2010 IF C[4]=0 THEN N5=N ELSE N5=N/C[4]
2018 IF Q9=1 THEN N5=99.999
2020 IF FPT(N5)=0 THEN Y5$(N0)=STR(N5:"##") ELSE Y5$(N0)=STR(N5:"##.###")
2030 IF POS(" "<>C$(238,4))=0 OR C[25]=0 OR X[17]=0 THEN GOTO 2045 ELSE N6=N/C[25]
2033 IF Q9=1 THEN N6=99.999
2035 IF FPT(N6)=0 THEN J5$(N0)=STR(N6:"##") ELSE J5$(N0)=STR(N6:"##.###")
2045 RETURN 
2200 REM "Given I0(1,2,or 3) print appropiate J() entries and J1$ data
2202 Q=0; FOR I2=1 TO 12; Q=Q+J[I2+(I0-1)*12]; NEXT I2
2203 IF Q9=1 THEN Y5$(X[20])="99"; GOTO 2205 ELSE IF Q=0 THEN GOTO 2245; REM "Don't print anything if no usage for the year
2204 Y5$(X[20])=J1$(I0*2-1,2)
2205 FOR I1=1 TO 12
2210 IF C[4]=0 THEN N5=J[I1+(I0-1)*12] ELSE N5=J[I1+(I0-1)*12]/C[4]
2212 IF POS("M"=V$(60,11))<>0 THEN N5=J[I1+(I0-1)*12]/1000; REM "Done for Cindy they require everything in 1000's not u/m (Usage)
2214 IF Q9=1 THEN N5=99.9
2215 REM IF FPT(N5)<>0 THEN LET Y5$(X(21)+(I1-1)*S(3))=STR(N5:M3$) ELSE IF N5<100 THEN LET Y5$(X(21)+(I1-1)*S(3))=STR(N5:M2$) ELSE LET Y5$(X(21)+(I1-1)*S(3)+1)=STR(N5:M2$)
2216 IF X[59]=1 AND FPT(N5)=0 THEN Y5$(X[34+I1])=STR(N5:M2$) ELSE Y5$(X[34+I1])=STR(N5:M3$)
2220 NEXT I1
2245 RETURN 
3000 REM "Subtotaling Routines"
3050 REM "Add to T$ for total title, T & T5 should be set
3060 IF T7$(1,1)=" " THEN RETURN 
3070 IF T7$(1,1)<>"S" THEN CALL "ZZDISP",T7$(1,1)+"X",T6$,T7$(2,3),X3$,T6$,"",0,0,X4$
3080 IF T$="" THEN T$=T6$ ELSE T$=T$+" "+T6$
3090 RETURN 
3100 REM "Subtotal Logic
3110 FOR T=U0 TO T STEP -1
3130 T$=FNS$(U5$(T*20+1,20)),T6$=U2$(U[T,0],U[T,1]),T7$=T5$(T*4+1,4); GOSUB 3050; IF POS(U0$(T+1,1)="23")>0 THEN GOSUB 7000 ELSE GOSUB 7100
3150 IF POS(U0$(T+1,1)="13")>0 THEN GOSUB 6000
3180 NEXT T
3195 RETURN 
3280 RETURN 
3380 RETURN 
3480 RETURN 
4000 REM " GET LAST ORDER DATE FROM ORDER HISTORY
4010 DIM O[20]; O$=""
4030 CALL "FM2UZD",X3$,X4$,A$(1,20),O$,O{ALL},O4$,O2$,O0,O1,O2,H0$,H1$,""; O=LEN(O$)/23
4040 IF O<>0 THEN J$=FND$(O$((O-1)*23+9,6)),Y5$(X[11])=J$(1,3)+J$(9,2)
4050 REM "LET N8=O[0-1]/C[14]
4090 RETURN 
5000 REM "End of Print
5005 IF F0=1 THEN F0=2; GOTO 1170; REM "FINISH UP LAST ONE IF NEEDED
5010 GOTO 5090
5020 IF W8=0 THEN GOTO 5290
5030 T0$="END"
5050 T=0; GOSUB 3100
5200 REM "
5295 GOTO 9900
6000 REM "Page header
6040 CALL "ZZHEAD",X0$,X1$,X2$,X3$,W0$,W1$,W2$,W9$,W3,W,W9,W8,W0,W5,W2,W8$,W5$; IF T0$="END" THEN GOTO 6090 ELSE ON W5 GOTO 6041,9910
6041 REM "IF X3$(9,3)="322" THEN PRINT (W9) 'FF'; REM "FORM FEED ON LASER PRINTER
6060 GOSUB 6200
6065 GOSUB 6100
6070 GOSUB 7300
6090 RETURN 
6100 REM "
6195 IF FID(W9)=FID(0) THEN PRINT 'SF',
6199 RETURN 
6200 REM "CUSTOMER HEADERS
6205 FOR L9=1 TO 6; GOSUB 7300; NEXT L9
6210 Y5$(X[22])=FNS$(D$(11,35)),Y5$(X[23])=D1$
6215 Y5$(X[24])=FND$(X3$(21,6))
6225 Y5$(X[25])=FND$(D8$),Y5$(X[26])=FND$(D9$)
6227 IF X[57]<>0 THEN Y5$(X[57])=STR(W8:M2$)
6230 GOSUB 7300
6235 FOR L9=1 TO 5; GOSUB 7300; NEXT L9
6237 GOSUB MONTH_HEADERS
6238 GOSUB 7300
6240 REM "IF X3$(9,3)="322" THEN GOSUB 07300; REM "ADD EXTRA LINE FEED IN HEADER
6295 RETURN 
6900 REM "SORT
6990 RETURN 
7000 REM "Totals logic
7002 IF V0=2 AND T$(1,8)="Division" AND P1$(13,1)<>"Y" THEN GOTO 7100
7003 IF W+3>W0 THEN GOSUB 6000
7005 Y5$(49)=T1$(1,13),Y5$(62)=T1$(1,13),Y5$(75)=T1$(1,12),Y5$(110)=T1$(1,12); IF V0$(74,1)="Y" THEN Y5$(62,48)=""
7006 GOSUB 7300
7010 Y5$(1)=T3$(1,T0+1-T)+" "
7015 IF T$<>"" THEN Y5$(T0+2-T)=T$+" Total ("+STR(T[T,0]:"0")+"):"
7020 Y5$(49)=STR(T[T,1]:Z0$),Y5$(62)=STR(T[T,2]:Z0$),Y5$(75)=STR(T[T,3]:Z1$),Y5$(110)=STR(T[T,4]:Z0$); IF V0$(74,1)="Y" THEN Y5$(62,48)=""
7030 GOSUB 7300
7065 IF T$="END" THEN Y5$(49)=T2$(1,13),Y5$(62)=T2$(1,13),Y5$(75)=T2$(1,12),Y5$(110)=T2$(1,12); IF V0$(74,1)="Y" THEN Y5$(62,48)=""
7066 GOSUB 7300
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7200; GOTO 7190
7095 GOSUB 7300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7205 GOSUB 7300; Y5$(1)="Number of items printed: "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 IF INT(T2)>0 THEN T4$=STR(INT(T2))+" Hours " ELSE T4$=""
7230 T3=INT(FPT(T2)*3600)
7240 T3=T3/60
7250 T4$=T4$+STR(T3:"##.##")+" Minutes"
7260 Y5$(1)="Elapsed time: "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7310 IF POS("V"=W8$)>0 THEN CALL "ZZVIEW",X3$,0,0,W3,W9,W,W9$,Y5$; GOTO 7390
7320 W=W+1
7330 PRINT (W9)STP(Y5$,1); DIM Y5$(W3)
7390 IF W-4>W0 THEN GOSUB 6000
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     13O ZZPARM  "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7435 DIM V[1]
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7480 X3$(178,7)=Y4$,V0=NUM(V$(71,1)),W3$=V$(19,POS("   "=V$(19,40)+"  ")-1)
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 RETURN 
7500 REM "Customer Change (This routine is not used???)
7510 READ (Z[6],KEY=U$(1,10))IOL=0360
7515 READ (Z[7],KEY="D"+F$(1,10))IOL=0370
7525 REM "Modified stmts:
7540 D0$=G$(52,4)
7545 P0$=G$(52,4),P1$=G$(56,2),P0=NUM(P1$)
7550 CALL "GL2RZA",X3$,"E"+U$(1,10),P0$,P1$,W2$,Z[8],Z[7]
7575 REM "Deleted stmts:
7590 RETURN 
7600 REM "Prior year periods
7610 IF NUM(FNE$(A1$(41,2)))<NUM(D1$) THEN F2=12; GOTO 7630 ELSE IF NUM(FNE$(A1$(41,2)))>NUM(D1$) THEN F2=0; GOTO 7630
7620 P0=POS(A1$(43,2)=H7$,2); F2=P0/2+.5
7640 RETURN 
7650 REM "Current year periods
7660 IF NUM(FNE$(A1$(41,2)))<NUM(D0$) THEN F1=12; GOTO 7680 ELSE IF NUM(FNE$(A1$(41,2)))>NUM(D0$) THEN F1=0; GOTO 7680
7670 P0=POS(A1$(43,2)=H7$,2); F1=P0/2+.5
7680 P0=POS(V0$(78,2)=H7$,2); F3=P0/2-.5
7685 F4=F1-F3
7695 RETURN 
7700 REM "Read current year usage
7707 READ (Z[5],KEY="D"+A0$(1,10),DOM=7708)IOL=0350; GOTO 7710
7708 EXITTO 1000
7710 X9=POS("U"=F1$,5),Q$="R",X$="U",J$=A0$(1,20)+A0$(22,4),D7$=E$(52,4)
7715 FIND (Z[8],KEY=J$+D7$+X$,DOM=7740); GOTO 7720; REM "See if the stats are there if not then skip
7720 DIM G[14]; CALL "ZZPACK",X3$,Q$,F1$(X9+2,3),"",0,0,G{ALL},Z[8],X$,J$+D7$,F9$
7725 FOR I0=1 TO 12; J[I0]=J[I0]+G[I0]; NEXT I0
7740 REM "Read previous year
7745 D7$=STR(NUM(E$(52,4))-1:"0000")
7750 FIND (Z[8],KEY=J$+D7$+X$,DOM=7765); GOTO 7755; REM "See if the stats are there, if not then skip them
7755 DIM G[14]; CALL "ZZPACK",X3$,Q$,F1$(X9+2,3),P9$,0,0,G{ALL},Z[8],X$,J$+D7$,F9$
7760 FOR I0=1 TO 12; J[I0+12]=J[I0+12]+G[I0]; NEXT I0
7765 D7$=STR(NUM(E$(52,4))-2:"0000")
7768 FIND (Z[8],KEY=J$+D7$+X$,DOM=7790); GOTO 7770; REM "See if the stats are there, if not then skip them
7770 DIM G[14]; CALL "ZZPACK",X3$,Q$,F1$(X9+2,3),P9$,0,0,G{ALL},Z[8],X$,J$+D7$,F9$
7775 FOR I0=1 TO 12; J[I0+24]=J[I0+24]+G[I0]; NEXT I0
7790 GOSUB 7800
7795 RETURN 
7800 REM "Calculate avg monthly usage(GIVEN CURRENT VALUES IN J()) for last 4, L(1), last 8, L(2), and last 12, L(3), months
7801 REM "We know that we will start somewhere in the first year (j(1)-j(12))
7802 REM "L0 is total usage so far, L1 is # of months done so far
7805 DIM L[3]; L0=0,L1=0,I0=NUM(E$(56,2)); REM "Read in 7700's
7810 L0=L0+J[I0],L1=L1+1
7814 REM "if proper months back save off, after dividing the total usage by the number of months so far
7815 IF L1=4 THEN L[1]=L0/4 ELSE IF L1=X[58] THEN L[2]=L0/X[58] ELSE IF L1=12 THEN L[3]=L0/12; GOTO 7840
7829 REM "If at jan of a year adjust to start dec of previous year,else just subtract 1
7830 IF I0=1 THEN I0=24 ELSE IF I0=13 THEN I0=36 ELSE I0=I0-1
7835 GOTO 7810
7845 RETURN 
7900 REM "CONVERT VALUES FOR PUBLIC CONSUMPTION
7910 FOR X=0 TO 5
7915 Q[X]=Q[X]/I0
7920 NEXT X
7990 RETURN 
8000 REM "FROM CUSTOMER CODE
8040 RETURN 
8100 REM "RETURN STATUS IN S9$
8105 S9$=""
8110 IF A[5]>0 AND A[6]>0 THEN IF A[5]<A[6] THEN S9$="^ BELOW MINIMUM ^"; GOTO 8180
8180 CALL "FM2MAZ",X3$,C$,S8$
8185 P=POS(C$(42,40)=S8$+S$); IF P>0 THEN S8$=S8$(1,P-1)
8190 RETURN 
8200 REM "Customer Change
8210 READ (Z[4],KEY=A$(1,10),DOM=8211)IOL=0340; GOTO 8215
8215 READ (Z[5],KEY="D"+D$(1,10))IOL=0350
8220 READ (Z[5],KEY="E"+D$(1,10)+E$(52,4))E0$
8223 D9$=E0$(18+6*NUM(E$(56,2)),6)
8224 D8$=E0$(12+6*NUM(E$(56,2)),6); CALL "ZZDATE",X3$,"",D8$,"",1,0,0,0,0,0,0,"","",""; REM "Prev period end date + 1
8235 Q$=D$(1,10); GOSUB 8500; D1$=X$
8279 REM "RESET PAGE NUMBER FOR EACH CUSTOMER ADDED 4/30/93
8280 IF W8<>0 THEN W8=.1
8290 RETURN 
8300 REM "TEST PATTERN
8304 DIM A$(33),A[75],A0$(33),A0[75],C$(387),C[28],S$(40),D$(397),J[36],J1$(10),E0$(161)
8305 CALL "ZZPROM","R4",X3$,Z,"","","",0
8310 ON Z GOTO 1000,8311,5000
8320 DIM D$(397,"X"),D1$(10,"X"),C$(387,"X"),A$(65,"X")
8325 D8$="J59999",D9$="J59999",E0$(26,2)="01"
8330 GOSUB 6000
8335 Q9=1,C[4]=9999,C$(126,6)="J59999",C[25]=9999,A$(26,6)="J59999"
8340 FOR I4=1 TO 3
8345 GOSUB 1500
8350 NEXT I4
8353 FOR X=W+2 TO W0+8; PRINT (W9)'LF',; NEXT X
8355 Q9=0,W=999,U2$=""
8390 GOTO 8300
8500 REM "RETUR  CUST CODE FROM Q$ IN X$
8510 CALL "ZZDISP","AX",Q$,"A/R",X3$,X$,"",0,0,X4$
8520 FIND (Z[4],KEY=Q$,DOM=8521)Q$; Q$=FNS$(Q$(11,35))
8540 RETURN 
8600 REM "Set up column arrays, X()=xpositions, S()=spacing factors
8605 DIM X[100],Y9[100]
8610 READ (Z[13],DOM=8611,KEY="FORMAT"+"UR"+V$(59,1))IOL=0313,IOL=0315; GOTO 8613
8612 CALL "ZZPROM",".4",X3$,0,"Invalid Flexible Format Code: "+V$(59,1),"","",0; GOTO 9900
8620 IF X[60]=2 THEN M2$="###",M3$="##.#-",M4$="#,###"
8680 REM "Standard values (orig for Hart (comp#111)
8685 REM "LET S(1)=5,S(2)=5,S(3)=5,X(1)=4,X(2)=10,X(3)=31,X(4)=54,X(5)=56,X(6)=60,X(7)=183,X(8)=203,X(9)=208,X(10)=213,X(11)=218,X(12)=31,X(13)=41,X(14)=50,X(15)=56,X(16)=60,X(17)=65,X(18)=112,X(19)=183,X(20)=124
8686 REM "IF X3$(9,3)="111" THEN LET X(5)=56,X(6)=60
8687 REM "LET X(21)=122,X(22)=4,X(23)=57,X(24)=71,X(25)=94,X(26)=113,X(27)=65,X(28)=70,X(29)=77,X(30)=83,X(31)=93,X(32)=100,X(33)=106,X(34)=118
8688 REM "FOR I=1 TO 34; LET X(I)=X(I)+1; NEXT I; REM "SHIFT WHOLE FORM OVER
8689 REM "IF POS(X3$(9,3)="289500",3)<>0 THEN LET X(27)=63,X(28)=69,X(29)=75,X(30)=82,X(5)=53,X(15)=53,X(3)=29
8690 FOR I=1 TO 100
8691 IF X<>56 THEN X[I]=X[I]+X[56]
8692 NEXT I; REM "SHIFT WHOLE FORM OVER
8695 RETURN 
8700 MONTH_HEADERS:REM "Print column headings for period's 1 thru 12
8710 Y=NUM(E0$(26,2),ERR=8795); REM "Set Y to month of first period of customer's fiscal year
8715 X=Y*3-2; REM "Get starting point for month string
8720 FIELD=61
8725 FOR LOOP=1 TO 12
8730 IF X[FIELD]<>0 THEN Y5$(X[FIELD])=MONTH_HEADER$(X,3)
8735 FIELD=FIELD+1,X=X+3
8740 NEXT LOOP
8745 GOSUB 7300
8795 END_MONTH_HEADERS:RETURN 
8905 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
8910 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
8920 DEF FNB$(Z9$)=X3$(214-6*NUM(Z9$),1)
8940 DEF FNS$(Z$)=Z$(1,POS("   "=Z$+"   ")-1)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 IF Y5=68 THEN RETRY ELSE ON C9 GOTO 1140,2040
9900 REM "End program
9905 IF POS("V"=W8$)>0 THEN GOSUB 6000; REM "ELSE IF X3$(9,3)="322" THEN PRINT 'FF'; REM "@PROGRADE, DO FF FOR LASER PRINTER
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 IF Y4$<>"" THEN RUN Y4$,ERR=9931
9940 RUN "ZMENU"
9999 END 
