0010 REM "Close out IC data (FMS) <FM2PZC>
0015 REM "Prog Type: I -3.0A
0020 SETESC 9300; SETERR 9000
0035 REM "4.4 - 05/02/00 - 10.7 - tma - SSP# 126021
0040 REM "Copyright 2000 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 ENTER X3$,O$
0110 X0$="FM2PZC",X1$="Close out IC data (FMS)",K9$="",K9=0
0130 K0=10,K1=1
0135 C9=-1
0200 REM "
0300 REM "IOLISTS
0310 IOLIST A$(1)
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14],F[15],F[16],F[17],F[18],F[19],F[20]
0361 IOLIST F$,F[0],STR(F[1]),STR(F[2]),F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14],F[15],F[16],F[17],F[18],F[19],F[20]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O AR1...  06O IC1... 07L ICG... 13O ZZPARM  "
0520 GOSUB 9750; ON Z0 GOTO 0521,9900
0590 READ (Z[1],KEY=K9$,DOM=0591)
0600 REM "
1000 REM "O$ IS THE CUSTOMER TO CLEAR
1400 REM "CLEAR FMZ FILE
1401 REM "Has been disconnected for some time. FMS customers get cleared in F/M-P1
1402 GOTO 1500
1405 PRINT @(12,15),"Clearing monthly detail file...",
1410 FOR X=2 TO 2
1420 READ (Z[X],KEY=O$,DOM=1421)
1440 K$=KEY(Z[X],END=1490); IF K$(1,10)<>O$(1,10) THEN GOTO 1490
1450 REMOVE (Z[X],KEY=K$)
1455 PRINT @(12,16),"Clearing detail: ",K$,
1460 GOTO 1440
1495 NEXT X
1600 REM "CLEAR I/C FILE
1602 PRINT @(0,15),'CE',@(12),"Processing Inventory Data..."
1605 DIM F[20]
1610 FOR X=6 TO 6
1620 READ (Z[X],KEY=O$,DOM=1621)
1630 K$=KEY(Z[X],END=1690); READ (Z[X],KEY=K$)IOL=0360
1635 IF F$(1,10)<>O$ THEN GOTO 1690
1637 REM "GOSUB 02500
1640 READ (Z[X],KEY=K$)IOL=0360
1645 F[3]=F[3]+F[4]-F[5]+F[6],F[4]=0,F[5]=0,F[6]=0
1650 F$(53,6)=X3$(21,6)
1655 PRINT @(12,16),"Item / Warehouse: ",K$
1657 GOSUB 2500
1670 WRITE (Z[X],KEY=K$)IOL=0361
1680 GOTO 1630
1690 NEXT X
2000 REM 
2090 GOTO 9900
2500 REM "Get average usage for stock item
2510 F[12]=0,Q$=F$(21,4)
2520 CALL "IC2MAY",ERR=2521,X3$,"",F$(1,20),Q$,X{ALL},Q; F[12]=X[5]
2590 RETURN 
7390 IF X0>0 THEN X0=X0-0
7400 REM "EXTRACT
7410 EXTRACT (Z[1],ERR=7200,KEY=A1$,DOM=7440)IOL=0310
7420 C9=1,Z9=1; GOSUB 5800
7440 RETURN 
7450 REM "EXTRACT NEW ENTRY
7460 WRITE (Z[1],KEY=A1$,DOM=7250)IOL=0310; GOTO 7400
7490 RETURN 
8905 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
8910 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
8920 DEF FNB$(Z9$)=X3$(214-6*NUM(Z9$),1)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9740 RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 Y8=2
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 EXIT 
9999 END 
