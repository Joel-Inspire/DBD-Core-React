0010 REM "Packing List Printing <FM2RBB>
0020 REM "FOR FormsPlus
0035 REM "5.3 - 03/08/05 - 11.012777 - dff - SSP# 181920
0040 REM "Copyright 2005 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 IF %GUI THEN SETERR 9000 ELSE BEGIN ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="FM2RBB",X1$="Packing List Printing"
0120 DIM A$(0),B$(82),B[21],C$(297),L$(20),L[1],S1$(40),E[1],A[7],S$(40),I[6]
0140 Z0$="-###,###.00",Z1$="##,##0",Z2$="###,###,##0-",M4$="-00000000.00",M4=LEN(M4$)
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0180 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0190 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
0210 T=1,T0=1,T1=1
0220 W3=79,P0=1
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0300 REM "I/O lists
0305 REM "IOLIST FOR FS1 - Sales order header
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7]
0316 REM "IOLIST FOR FS2 - Sales order lines
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21]
0335 REM "IOLIST FOR AR1 - Customer Masterfile
0340 IOLIST D$
0345 REM "IOLIST FOR FM0 - Location Masterfile
0350 IOLIST E$,E[0],E[1]
0370 IOLIST G$
0371 IOLIST G2$
0372 IOLIST G1$
0375 REM "IOLISTS FOR AR3 - Salesperson Masterfile
0380 IOLIST C1$,C[0],C[1]
0382 IOLIST H0$
0390 IOLIST R$
0420 IOLIST L$,L[0],L[1]
0490 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01O PO6...  02O FS1...  03O FS2...  04O AR1...  06O PO3...  07O FM0...  08O PO6...  10O AR3...  11O FMP...  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0530 DIM G9$(200); READ (Z[7],KEY="D"+S$(1,10)+"0001",DOM=0531)G9$
0700 REM "Open Printer
0720 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0721,9920
0750 GOSUB 8100
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[3]; U=13,U0=3,U[0]=0,U[1]=1,U[2]=4,U[3]=8,T0=0,U0$="    ",T5$="                "; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0920 V2$=V2$(1,26)
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
0995 IF Q5=0 THEN GOSUB 6000
1000 REM 
1005 U$=KEY(U1,END=5000)
1007 IF U$(1,1)<>"L" THEN GOTO 5000
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])<V2$(U3,U[U9]) THEN READ (U1,END=5000); EXITTO 1000
1030 IF U$(U2,U[U9])>V2$(U3+U[U9],U[U9]) THEN IF U=1 THEN EXITTO 5000 ELSE READ (U1,END=5000); EXITTO 1000
1040 NEXT U9
1041 READ (U1)
1043 IF Q5=1 THEN IF MID(U$,17,1)<>"P" THEN GOTO 1000 ELSE GOSUB 8200
1044 IF Q5=1 AND U$(17,1)="P" THEN REMOVE (Z[1],KEY=U$); GOTO 1000
1045 REM "IF U9$="" THEN LET U9$=U$
1050 IF U$(2,12)<>MID(U9$,2,12) THEN GOTO 1100
1060 DIM U1$(17); U1$(1,16)=U$; U1$(17,1)="P"; REMOVE (Z[1],KEY=U$); WRITE (Z[1],KEY=U1$)
1070 GOSUB 7500
1080 U9$=U$
1090 GOTO 1000
1100 REM "Get record"
1110 IF U9$="" THEN GOTO 1910
1120 ON V0 GOTO 1150,1150,1130,1140
1150 READ (Z[2],KEY=U9$(6,8),DOM=1080)IOL=0310
1300 REM "Read other data
1330 DIM D$(200); FIND (Z[4],KEY=A$(6,10),DOM=1331)IOL=0340
1500 REM "Print Data
1515 P1=1
1520 IF P1>P0 THEN GOTO 1700
1530 GOSUB 5400
1540 GOSUB 5500
1560 GOSUB 2000
1565 GOSUB 2400
1567 L0=0
1570 GOSUB 2500
1580 P1=P1+1
1590 GOTO 1520
1900 P0$="",P1$="",P2$="",P0=1
1910 U9$=U$
1995 IF E8$="END" THEN GOTO 5010 ELSE GOTO 1060
2000 REM "Print 'header' section
2005 W=0,L0=1; GOSUB 7300
2007 IF A$(48,1)="Y" THEN Y5$(30)="*BACK ORDER*"
2010 CALL "ZZDISP","AX",A$(118,8),"O/P",X3$,X$,"",0,0,X4$
2015 Y5$(61)=X$
2020 GOSUB 7600
2030 GOSUB 7300; REM IF A$(46,1)=" " THEN GOSUB 7300 ELSE LET Y5$(61)="Revision "+A$(46,1); GOSUB 7300
2035 IF NOT(%GUI) THEN CALL "ZZDISP","DXS",A$(16,6),"",X3$,Y5$,"",61,0,X4$
2040 GOSUB 7300; GOSUB 7300
2044 G0$=G9$
2045 IF A1<>1 THEN READ (Z[7],KEY="D"+S$(1,10)+U9$(2,4),DOM=2046)G0$
2050 GOSUB 2100
2060 GOSUB 2200
2070 GOSUB 2300
2090 RETURN 
2100 REM "Print phone #'s, From address and rush message
2105 IF POS(A$(8,1)="8")<>0 THEN Y5$(45)=D$(11,35) ELSE Y5$(28)="(800) 241-2319",Y5$(45)=G0$(16,35)
2110 GOSUB 7600
2115 IF MID(I$,18,1)="Y" THEN Y5$(1)="*Split Shipment*"
2120 Y5$(28)="(770) 271-7573",Y5$(45)=G0$(51,30)
2125 GOSUB 7300
2130 A5$=G0$(111,27); GOSUB 8400
2135 IF POS(" "<>G0$(81,30))=0 THEN A3$=A6$,A4$="" ELSE A3$=G0$(81,30),A4$=A6$
2140 Y5$(45)=A3$
2145 GOSUB 7300
2150 IF MID(I$,134,1)="Y" THEN Y5$(1)="** RUSH ** RUSH ** RUSH **"
2155 Y5$(45)=A4$
2160 GOSUB 7300; GOSUB 7300
2190 RETURN 
2200 REM "Print Sold to and Shipto Addresses
2204 REM "Setup soldto
2205 DIM L0$(141)
2210 IF POS(A$(8,1)="8")<>0 THEN GOTO 2240
2220 L0$(1,35)=D$(11,35),L0$(36,35)=D$(56,30)
2225 A5$=D$(116,27); GOSUB 8400
2230 IF POS(" "<>D$(86,30))=0 THEN L0$(71,35)=A6$ ELSE L0$(71,35)=D$(86,30),L0$(106,35)=A6$
2240 REM "Setup Ship to
2243 GOSUB 5600
2245 DIM L1$(175); L1=0
2250 L1$(L1*35+1,35)=E$(225,35),L1=L1+1
2255 IF POS(" "<>E$(16,30))<>0 THEN L1$(L1*35+1,35)="Attn: "+E$(16,30),L1=L1+1
2260 L1$(L1*35+1,35)=E$(46,30),L1=L1+1
2265 IF POS(" "<>E$(76,30))<>0 THEN L1$(L1*35+1,35)=E$(76,30),L1=L1+1
2270 A5$=E$(106,27); GOSUB 8400; L1$(L1*35+1,35)=A6$
2275 FOR L9=0 TO 3
2280 Y5$(1)=L0$(L9*35+1,35),Y5$(45)=L1$(L9*35+1,35); GOSUB 7300
2281 NEXT L9
2285 Y5$(45)=L1$(141,35); GOSUB 7300
2287 CALL "ZZDISP","AXS",A$(6,10),"A/R",X3$,Y5$,"",11,0,X4$
2288 X$=A$(28,15); IF A$(8,1)<>"8" THEN Y5$(54)=X$ ELSE I=POS("/"=X$); IF I>0 THEN Y5$(54)=X$(I+1)
2290 GOSUB 7300
2292 GOSUB 7300; GOSUB 7300
2295 RETURN 
2300 REM "Print Ribbon Line
2310 IF POS(A$(8,1)="8")<>0 THEN Y5$(5)=A$(93,4); GOTO 2320
2315 DIM R$(170); FIND (Z[10],KEY=A$(93,4),DOM=2316)IOL=0390
2317 IF A1<>0 THEN Y5$(1)="XXXXXXXXXX" ELSE Y5$(1)=R$(149,10)
2320 REM 
2325 DIM X$(30); X$(3,15)=E$(210,15)
2330 IF A1<>0 THEN Y5$(28)="XXXXXXXXXXXXXX" ELSE Y5$(28)=X$(3,15)
2335 DIM X$(30); FIND (Z[11],KEY="H"+E$(134,1),DOM=2336)X$
2340 IF A1<>0 THEN Y5$(46)="XXXXXXXXXXXXXX" ELSE Y5$(46)=X$(3,15)
2345 IF NOT(%GUI) THEN CALL "ZZDISP","DXS",A$(55,6),"",X3$,Y5$,"",66,0,X4$
2380 GOSUB 7300
2385 GOSUB 7300; GOSUB 7300
2390 RETURN 
2400 REM "Print line information
2404 IF A1=1 THEN FOR I3=1 TO 2; GOSUB 7700; NEXT I3
2405 I0=1120,I1=0,S0$="",B1=0
2406 IF C1>2 THEN GOTO 2450
2410 READ (Z[3],KEY=A$(118,8),DOM=2411)
2420 READ (Z[3],END=2490)IOL=0320; I1=I1+1
2425 IF B$(147,8)<>A$(118,8) THEN GOTO 2490
2430 IF C1=2 THEN GOSUB 7850 ELSE B1=0
2437 IF B1=0 THEN GOTO 2445
2440 GOSUB 7700
2445 GOTO 2420
2450 REM "Print lines from P2$ for spec instr."
2455 P4$=P2$(1,5)
2460 READ (Z[6],KEY=A$(118,8)+" "+P2$(6,4),DOM=2490)IOL=0350
2465 READ (Z[3],KEY=E$(166,8)+E$(7,3),DOM=2485)IOL=0320
2470 B1=E[0]; GOSUB 7700
2475 READ (Z[3],KEY=E$(166,8)+STR(NUM(E$(7,3))+1:"000"),DOM=2476)IOL=0320
2480 REM IF B$(155,1)<>"M" THEN GOTO 2485
2485 P2$=P2$(10); IF P2$<>"" THEN IF P2$(1,5)=P4$ THEN GOTO 2460
2490 RETURN 
2500 REM "Finish up the bottom half
2504 REM "If P0 =1 (on the first page) then print spec part, else just go totop of the next page
2510 IF W<37 THEN GOSUB 7300; GOTO 2510
2515 Y5$(38)=V0$(81,40); GOSUB 7300
2520 Y5$(38)=V0$(121,40); GOSUB 7300
2525 Y5$(38)=V0$(161,40); GOSUB 7300
2535 IF L0>5 THEN Y5$(32)="*** Continued ***"; GOSUB 7300
2560 IF W<42 THEN GOSUB 7300; GOTO 2560
2580 P0=P0+1
2590 RETURN 
3100 REM "Subtotal logic goes here, see -ZREPS
3180 RETURN 
3280 RETURN 
3380 RETURN 
3480 RETURN 
5000 REM "End of Print
5005 IF E8$<>"END" THEN E8$="END"; GOTO 1100
5010 IF Q5=1 THEN GOTO 9920
5020 IF W8=0 THEN GOTO 5200
5030 T0$="END"
5040 IF V1>0 THEN GOSUB 3120
5050 T=0,T$="Report"; GOSUB 7000
5200 REM "
5270 Y$="09C AR3...  10C FMS...  11C FMU...  "
5280 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
5291 GOTO 9900
5300 REM "Remove printed P/S's
5304 IF V8$="A" THEN GOTO 5330
5305 IF V3$(2,2)="A " THEN PRINT 'EA',
5310 CALL "ZZPROM",".Y",X3$,Z,"Did all of the packing lists print correctly?","","",0
5320 ON Z GOTO 5330,5340
5330 GOSUB 5350; GOTO 5345
5345 RETURN 
5350 REM "Do remove
5354 PRINT @(0,19),'CE',
5360 Q5=1; GOTO 0900
5390 RETURN 
5400 REM "Set code C1 for type of P/O
5410 IF P0=1 THEN C1=0
5412 IF P1=1 THEN P1=P1+1
5414 REM "P0 is > 1
5415 ON P1 GOTO 5445,5416,5430,5440
5416 IF P0$<>"" THEN C1=2; GOTO 5445
5420 C1=1; GOTO 5445
5425 REM "if general inst needed C1=2 else drop through to C1=3
5430 IF P0$<>"" THEN C1=2; GOTO 5445
5440 C1=3
5445 RETURN 
5500 REM "Get proper address, C1=1 taken care of in 2300's
5505 DIM E$(260)
5510 ON C1 GOTO 5520,5590,5520,5550
5530 READ (Z[6],KEY=A$(118,8)+"     ",DOM=5540)IOL=0350; GOTO 5590
5535 REM "If no general inst., use customer address
5540 E$(16,30)=D$(165,20),E$(46,87)=D$(56,87); GOTO 5590
5550 REM "Read in special shipping record
5555 IF LEN(P2$)=0 THEN GOTO 5580
5560 READ (Z[6],KEY=A$(118,8)+" "+P2$(6,4),DOM=5580)IOL=0350
5570 GOTO 5590
5580 REM "Error"
5585 EXITTO 1580
5590 RETURN 
5600 REM "Get name to print on shipto
5610 IF LEN(E$)>=259 AND POS(" "<>E$(259))<>0 THEN E0$=E$(225,35); GOTO 5645 ELSE E0$=D$(11,35)
5615 ON POS(E$(11,1)="CPD") GOTO 5645,5620,5625,5630
5620 FIND (Z[7],KEY=E$(11,1)+D$(1,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5625 FIND (Z[7],KEY=E$(11,1)+A$(7,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5630 FIND (Z[7],KEY=E$(11,1)+Y6$(1,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5635 E0$=E1$(16,35)
5645 RETURN 
6000 REM "Print alignment pattern?
6004 REM "A1 <> 0 means doing an alignment pattern
6005 A1=0
6009 IF V8$="A" THEN GOTO 6090
6010 IF V3$(2,2)="A " THEN PRINT 'EA',
6015 CALL "ZZPROM","R4",X3$,Z,"","","",X0
6017 IF Z<2 AND V3$(2,2)="A " THEN PRINT 'BA',
6020 ON Z GOTO 6080,6021,9920
6030 GOSUB 6100
6040 GOSUB 6200
6050 GOTO 6010
6080 A1=0
6090 RETURN 
6100 REM "Setup test data"
6104 A1=1
6105 C=9,C0=1
6108 DIM X$(40,"X")
6110 DIM A$(169); A$(118,8)="99999999",A$(16,6)="J90101",A$(28,15)="999999999999999",A$(6,10)="9999999999",A$(93,4)="9999",A$(55,6)="U90101"
6115 DIM D$(397); D$(11,35)=X$,D$(56,30)=X$,D$(86,30)=X$,D$(116,18)=X$,D$(134,9)="999999999"
6125 DIM B$(205); B$(50,40)=X$,B1=999999999
6127 I0$=B$
6130 DIM E$(260); E$(16,90)=X$+X$+X$,E$(106,18)=X$,E$(124,9)="999999999",E$(210,15)=X$,E$(225,35)=X$
6135 DIM D0$(186); D0$(29,2)="99"
6190 RETURN 
6200 REM " Print align. pattern
6205 L0=1
6210 GOSUB 2000
6215 GOSUB 2400
6240 P0=1,L0=1; GOSUB 2500
6290 RETURN 
7000 REM "Totals logic
7001 IF T=T0 THEN IF T[T0,0]<2 THEN GOSUB 7300; GOTO 7100
7002 IF W+3>W0 THEN GOSUB 6000
7010 Y5$(1)=T3$(1,T0+1-T)+" "
7015 IF T$<>"" THEN Y5$(T0+2-T)=""+Q2$+" ("+STR(T[T,0]:"0")+"):"
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7200; GOTO 7190
7095 GOSUB 7300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7205 GOSUB 7300; Y5$(1)=Q1$+": "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 T4$=STR(INT(T2):"##0")
7230 T3=INT(FPT(T2)*3600),T4=MOD(T3,60),T3=INT(T3/60)
7240 T3=T3/60
7250 T4$=T4$+":"+STR(T3:"00")+":"+STR(T4:"00")
7260 Y5$(1)=Q3$+": "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7330 IF Y5$=Y6$ THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; DIM Y5$(W3)
7395 RETURN 
7400 REM "Read report selection parameters"
7405 CLOSE (13); OPEN (13)"ZZP"; Z[12]=13; GOTO 7430
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0490
7460 V2$="LL"+V2$
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"  ")-1)
7482 IF V1$(1,3)="???" THEN V8$="A",V7$=V1$(4,2); IF V0$(71,1)="1" THEN V1$="PO6   "
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7486 CLOSE (14)
7490 RETURN 
7500 REM "Run lines count quantity, then run special instr subtracting quantity
7501 REM "P0=# of P/O's to print, at least 1. Line # in P0$, quantitys in P1$., keys to recs in P2$
7510 READ (Z[3],KEY=U$(6,11),DOM=7590)IOL=0320
7515 IF B$(155,1)="M" THEN B[0]=100
7517 IF B$(155,1)="S" AND B[0]=0 AND (B[3]<>0 OR B[6]<>0) THEN B[0]=1
7520 N0=B[0],N$=B$(6,3); GOSUB 7800
7530 REM "Now subtract special inst. off
7535 DIM E$(20),E[1]; READ (Z[6],KEY=U$(6,8)+" "+U$(14,3),DOM=7536)
7537 K$=KEY(Z[6],END=7580)
7540 READ (Z[6])IOL=0350
7545 IF K$(1,8)+K$(10,3)<>U$(6,11) THEN GOTO 7580
7548 IF E$(155,1)="M" THEN E[0]=1
7550 N$=E$(7,3),N0=-E[0]; GOSUB 7800; GOSUB 7900
7560 GOTO 7537
7575 REM " if P0$='' no need for general inst., if P0>1 add 1 for all page"
7580 GOSUB 7950
7583 IF P0$="" THEN P0=P0-1
7585 IF P0>1 THEN P0=P0+1
7590 RETURN 
7600 REM "Print one line double high, in place of calling 7300
7610 IF D2$="" THEN GOSUB 7300; W=W-1 ELSE GOSUB 8350
7620 GOSUB 7300
7630 GOSUB 8300
7635 W=W+1; REM "Increment W one more, because we are double height
7640 RETURN 
7700 REM "Order detail
7710 IF L0>6 THEN GOSUB 2500; GOSUB 2000
7730 IF B$(155,1)<>"S" THEN CALL "ZZDISP","AXS",B$(19,10),"ICE",X3$,Y5$,"",1,0,X4$
7751 DIM C1$(21),C[1]
7752 FIND (Z[13],KEY="U/M"+B$(124,4),DOM=7753)IOL=0380
7755 IF C1$(20,1)<>"Y" THEN B0=B[5] ELSE B0=C[1]
7757 IF B0<>0 THEN B1=B1/B0
7763 IF B[4]=0 AND B[6]<>0 THEN B[4]=B[6]
7765 REM IF B$(155,1)="S" THEN LET B(4)=B(6)
7766 IF B$(155,1)="M" THEN GOTO 7769
7767 IF B1<>0 THEN Y5$(12)=FNQ$(B1,Z2$)
7768 IF C1$(20,1)<>"Y" AND B[5]<>0 THEN Y5$(13+LEN(Z2$))=FNS$(B$(124,4))+"/"+FNR$(STR(B[5]:"##,##0"))
7769 Y5$(39)=B$(50,40)
7770 GOSUB 7300
7775 L0=L0+1
7790 RETURN 
7800 REM "Add an amount(N0=amount,N$=line #) from P0$ and P1$
7801 REM "if amount left is 0 remove line from P0$ and P1$
7805 IF N0=0 THEN GOTO 7840
7810 N1=POS(N$=P0$,3)
7815 IF N1=0 THEN P0$=P0$+N$,P1$=P1$+STR(N0:M4$); GOTO 7840
7820 N2=INT((N1-1)/3)*M4+1,N3=N0+NUM(P1$(N2,M4))
7825 IF N3<>0 THEN P1$(N2,M4)=STR(N3:M4$); GOTO 7840
7830 ON N1 GOTO 7831,7831,7836
7831 IF LEN(P0$)=3 THEN P0$="",P1$="" ELSE P0$=P0$(4),P1$=P1$(M4+1)
7832 GOTO 7840
7836 P0$=P0$(1,N1-1)+P0$(N1+3),P1$=P1$(1,N2-1)+P1$(N2+M4)
7840 RETURN 
7850 REM "Return B1 with value of line or 0
7860 N1=POS(B$(6,3)=P0$,3)
7865 IF N1=0 THEN B1=0; GOTO 7890
7870 B1=NUM(P1$(INT((N1-1)/3)*M4+1,M4))
7890 RETURN 
7900 REM "Sort E$(7,4) into P2$ based on E$(11,5) and inc P0 count if neccessary
7905 P3$=E$(11,5)+E$(7,4)
7910 IF P2$="" THEN P2$=P3$; GOTO 7945
7915 N4=POS(E$(11,5)=P2$,9); IF N4=0 THEN N4=1
7920 IF P2$(N4,9)>P3$ THEN IF N4=1 THEN P2$=P3$+P2$; GOTO 7945 ELSE P2$=P2$(1,N4-1)+P3$+P2$(N4); GOTO 7945
7930 N4=N4+9; IF N4<LEN(P2$) THEN GOTO 7920 ELSE P2$=P2$+P3$; GOTO 7945
7945 RETURN 
7950 REM "Calculate # of special PO'S
7960 P6$="",N4=1
7965 IF N4>LEN(P2$) THEN GOTO 7990
7970 IF P2$(N4,5)<>P6$ THEN P0=P0+1,P6$=P2$(N4,5)
7975 N4=N4+9; GOTO 7965
7990 RETURN 
8000 REM "Build desc from H8$
8005 IF POS("XXXXX"=H9$)<>0 THEN GOTO 8050
8010 H9$=FNS$(H8$(32,8)); IF H9$<>"" THEN H9$=H9$+QUO; IF POS(" "<>H8$(40,8))<>0 THEN H9$=H9$+"x"
8020 H9$=H9$+FNS$(H8$(40,8)); IF H9$<>"" THEN IF POS(" "<>H8$(40,8))<>0 THEN H9$=H9$+QUO+" " ELSE H9$=H9$+" "
8030 IF NUM(H8$(48,2))<>0 THEN H9$=H9$+H8$(48,2)+" Ply "
8040 H9$=H9$+FNS$(H8$(50,40)); H8$=""
8050 RETURN 
8100 REM "Set D1$=normal, D2$=double high printing FOR 8300 AND 8350 ROUTINES, GOSUB HERE ONLY ONCE
8101 REM "GOSUB 8350 to turn double high on, GOSUB 8300 to return to normal
8105 REM "Assumes special mode 5 is double & special mode six is un-double
8110 REM "This program assumes that double high is on until turned off, changes will be needed if double high goes off auto. at end of a line
8115 D1$="",D2$=""
8120 CLOSE (14); OPEN (14)"ZZPARM"
8125 READ (14,KEY="PRINTERS",DOM=8155)D1$,D2$
8130 P=POS(FID(W9)=D2$,2); IF P=0 THEN D1$="",D2$=""; GOTO 8155
8135 READ (14,KEY="ptr"+D1$(INT(P/2)*8+9,8),DOM=8140)D3$; GOTO 8145
8140 D1$="",D2$=""; GOTO 8155
8145 D1$=D3$(282,16),D2$=D3$(266,16)
8150 D1$=FNS$(D1$),D2$=FNS$(D2$)
8155 RETURN 
8200 REM "Set print flag in s/o header
8210 EXTRACT RECORD (Z[2],KEY=U$(6,8),DOM=8240)A$
8215 A$(128,1)="Y"
8220 WRITE RECORD (Z[2])A$
8240 RETURN 
8300 REM "Return to normal
8305 IF D1$="" THEN GOTO *RETURN
8310 IF %C$<>"335" THEN PRINT (W9)'BO',D1$,'EO',
8325 RETURN 
8350 REM "Goto double high
8355 IF D2$="" THEN GOTO *RETURN
8360 IF %C$<>"335" THEN PRINT (W9)'BO',D2$,'EO',
8375 RETURN 
8400 REM "Take city,st,zip in A5$ in std format, and format into A6$
8410 IF POS(" "<>A5$(1,16))=0 THEN DIM A6$(30); GOTO 8440
8415 A6$=FNS$(A5$(1,16))+", "+A5$(17,2)+" "
8420 CALL "ZZDISP","AX",A5$(19,9),"ZIP",X3$,X$,"",0,0,X4$
8425 A6$=A6$+X$
8445 RETURN 
8950 DEF FNQ$(Z9,Z9$)=STR(Z9:Z9$)
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "End program
9909 IF V8$="A" THEN V3$(2,6)="AUTO"+V7$
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9915 IF Y4$<>X0$ AND V3$(2,1)<>"T" THEN GOSUB 5300
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 IF NOT(NUL(Y4$)) THEN IF %GUI THEN CALL Y4$,ERR=9931 ELSE RUN Y4$,ERR=9931
9940 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
