0010 REM "Sales Order Entry I - Header - Ovrly 0 <FM2OA0>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 08/25/17 - 14.0675 - dmm - SSP# 293239
0037 REM "293239-CC Vault; ARZ add billing address, use with default logic to
0040 REM "Copyright 2017 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 X0$="FM2OA0"
0100 SETERR 9000
0105 MSLC_CHG=0 ! SSP 225300
0120 IF H1=2 THEN PRINT @(0,3),'CE',; GOSUB 6000; GOSUB 6200; GOTO 8600 ELSE IF H1=1 THEN H1=0; GOTO 2137
0181 DIM FTS[9] ! [SSP-200893]
0182 FTS_LFN=Z[18] ! [SSP-200893]
0183 FTS_IOLIST:IOLIST FTS$,FTS[0],FTS[1],FTS[2],FTS[3],FTS[4],FTS[5],FTS[6],FTS[7],FTS[8] ! [SSP-200893]
0188 %NEW_OE_FLAG$="",CONTRACT_DATE$="" ! [SSP-200893]
0200 REM 
0205 GOTO 7500
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$(1,LEN(A$)),A[0],A[1],A[2],A[3],A[4],A[5],A[6]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15]
0330 IOLIST C$,C[0],C[1],C[2],C[3]
0340 IOLIST D$,D[0],D[1],D[2],D[3]
0350 IOLIST E$
0351 IOLIST E0$
0352 IOLIST E1$
0353 IOLIST E2$
0370 IOLIST G$
0380 IOLIST H$(1),H9
0385 IOLIST H9$
0390 IOLIST I$
0392 IOLIST CC_TYPE$
0597 READ (Z[13],KEY=X3$(9,3)+"A/R")AR_PARMS$; REM " SSP# 146930  
0600 HLD_CONTRACT$=A$(315,20) ! [SSP-200893]
1890 IF Z<0 THEN GOTO 2035 ELSE GOTO 2000
2000 REM "DATA SEQ
2010 C0=0,X0=-1,X1=1,C9=1
2020 X$="",C0=ABS(C0),X0=X0+1; IF C0=2 THEN IF X0>0 THEN X0=X0-2
2025 IF INT(C0)=3 THEN GOSUB 7300 ELSE IF C0>3 OR X0<0 THEN GOTO 9900
2040 ON X0 GOTO 2100,2150,3200,2250,2300,2350,2400,3400,2450,2500,3800,4100,2600,2650,2700,3250,2550,2750,2800,2850,3700,3300,3350,3600,4150,2900,2950,3000,3100,3150,3500,3550,3050,3650,9900 ! [SSP-200893]-added 3800 for Contract Number, WO212768 WO255959
2100 REM "Customer Code
2102 IF C9<>1 THEN GOTO 2138
2105 IF POS(" "<>A$(6,10))<>0 THEN FIND (Z[2],KEY=A$(6,10),DOM=2106)IOL=0320; GOTO 2138
2107 TEMP=POS("AR2MAA"=U1$); IF TEMP>0 THEN A$(6,10)=U1$(TEMP+8,10); GOTO 2116
2108 X$="F8 retrieves by Invoice, F9 for ZipCode Lookup, F10 retrieves by Phone No."
2110 CALL "ZZENTR","AXUF",A{ALL},A$,X4$,X3$,31,3,6,10,C0,"A/R","{3"+X$,"","FM2ODA02","AR1","X",""; IF ABS(C0)=102 THEN J9=1,Q1$=A$(6,10),Z8$="AR2MAB",Z7$="AR2MAC"; RUN "ZZ2STP" ELSE IF C0<>-7 AND C0<>-17 AND C0<>-18 THEN IF C0<-10 THEN GOTO 2108 ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2110,2111
2111 IF C0=-17 THEN C0=1; CALL "AR2INV",X3$,X4$,A$,6,X$; IF X$="" THEN GOTO 2108
2112 IF C0=-7 THEN C0=1; CALL "ZZ2PLU",X3$,A$,6,X$; IF X$="" THEN GOTO 2108
2114 IF C0=-18 THEN C0=1; CALL "AR2LST",X3$,X4$,A$,6,X$; IF X$="" THEN GOSUB 6400; GOTO 2108 ELSE GOSUB 6400
2116 CALL "ZZDISP","A",A$(6,10),"A/R",X3$,"","",31,3,X4$; IF POS(" "<>A$(6,10))=0 THEN GOTO 2108
2118 IF A$(6,2)<>A$(118,2) THEN CALL "ZZPROM",".4",X3$,0,"The customer and order must be in the same division","","",0; A$(6,10)=""; GOTO 2108 ! SSP#248027
2120 FIND (Z[2],KEY=A$(6,10),DOM=2108)IOL=0320
2122 GOSUB VALIDATE_REP; IF NOT(VAL_REP) THEN CALL "ZZPROM",".4",X3$,0,"Access denied! You may not view this customer","","",0; GOTO 2108
2125 IF C0<0 THEN GOTO 2020
2128 X$=A$(6,10)+A$(118,8); CALL "FM2OA7",X3$,X$,Z; X$=""; IF Z=0 THEN L0=2; RUN "FM2ODA"
2130 REM CALL "ZY2AAA",X3$,X4$,38,5,"B","",1,B$(56,163),"",1,0,0
2135 GOSUB 7600; CALL "AR2MAG",X3$,X4$,A$(6,10),15,1,X; IF X>0 THEN GOSUB 6400
2136 CREDIT_CHECK_YN$="Y"; GOSUB 8600; REM ssp 189962
2137 IF P7$(273,1)="Y" THEN GOSUB 8700; REM "WO100041, Repeat Order?
2138 IF P1$(64,1)="Y" THEN X$=A$(118,8)+A$(6,10)+B$(11,35)+B$(56,87)+B$(205,14); CALL "FM2OA4",X3$,X4$,X$,"OA"; X$="",C0=0 ELSE CALL "ZY2AAA",X3$,X4$,38,5,"B","",1,B$(56,163),"",1,0,0
2139 IF (CREDIT_CHECK_YN$<>"Y" AND A$(314,1)="Y") OR A$(314,1)="U" THEN CREDIT_CHECK_YN$="Y"; GOSUB 8600; REM ssp 189962
2140 GOSUB 6400; GOTO 2020 ! [SSP-207285]-added 6400 to repaint the screen
2150 REM "Order type 1/26/96 - do not change x0 values
2151 FIRST_TIME$="Y"
2152 IF P7$(226,1)<>"Y" THEN GOTO 2180 ELSE EXTRACT (Z[1],KEY=A1$,DOM=2153)X$; IF POS(" "<>X$(6,10))>0 THEN X$="",FIRST_TIME$="N"; GOTO 2179; REM "Make sure this is first time
2155 X$="B=bill as shipped p/o, blank=sales order to customer"
2160 CALL "ZZENTR","SUR",A{ALL},A$,X4$,X3$,4,5,54,1,C0,"","{3"+X$,"B ","FM2ODA03","","",""
2162 IF A$(54,1)="B" AND MID(S5$,88,1)="Y" AND P7$(280,1)="Y" THEN PRINT @(61,13),'SB',"Job Cst: ",'SF',@(70,13),A$(313,1) ELSE PRINT @(61,13),'CL',
2165 IF A$(54,1)="S" THEN CALL "ZZPROM",".4",X3$,0,"SORRY! 'S' types not presently supported","","",0; GOTO 2155
2168 IF CHK_SB$="Y" THEN SBILL$=""; CALL "UPDFS1;CHECK_SUMM_BILL",Z[8],A$(6,10),A$(47,1),A$(54,1),SBILL$; A$(373,1)=SBILL$; PRINT @(78,19),A$(373,1) ! WO 255959
2179 REM "Order date
2180 CALL "ZZENTR","D",A{ALL},A$,X4$,X3$,19,5,16,6,C0,"","{3"+X$,"","FM2ODA04","","",""
2185 IF LEN(STP(A$(16,6),3))<6 THEN GOTO 2180 ! SSP245048 jdf
2190 GOTO 2020
2250 REM "Master quote
2252 J7$=A$(23,5)+A$(3,3),Z$="FE5"
2254 IF POS(" "<>J7$)>0 THEN GOTO 2020
2255 IF P7$(265,1)="Y" THEN GOTO 4000; REM "SSP98716, more than 1 RFQ
2256 IF P7$(159,1)="Y" THEN Z$="QSA" ELSE Z$="FE5"
2260 CALL "ZZENTR","A",A{ALL},J7$,X4$,X3$,19,7,1,8,C0,"O/P","{3"+X$,"","FM2ODA08",Z$,"",""; IF ABS(C0)>4 THEN GOSUB 6400; CALL "ZZDISP","A",J7$,"O/P",X3$,"","",19,7,X4$; ON C0 GOTO 2260,2261
2262 IF POS(" "<>J7$)=0 OR J7$=A$(23,5)+A$(3,3) THEN GOTO 2270
2263 IF P7$(159,1)="Y" AND A$(52,1)<>"Y" THEN CALL "ZZPROM",".Y",X3$,Z,"Is the quote an  RFQ?","","",0; IF Z=0 THEN A$(52,1)="Y"; Z$="09C FE5...  09O QSA...  "; GOSUB 9750; Z$="QSA"
2265 FIND (Z[9],KEY=J7$,DOM=2260)IOL=0390; GOSUB 8200
2267 A$(87,2)=I$(176,2),A$(89,4)=I$(188,4),A$(93,4)=I$(6,4)
2268 V9=1; DIM C$(LEN(C$)),D$(LEN(D$)),E$(LEN(E$)),E0$(LEN(E0$))
2269 GOSUB 7650; GOSUB 6252
2270 A$(23,5)=J7$(1,5),A$(3,3)=J7$(6)
2290 GOTO 2020
2300 REM "Customer PO no
2305 IF H$(25,1)="Y" THEN X$="Customer P/O required by this customer"; IF POS(" "<>A$(28,15))=0 THEN PRINT (0,ERR=2306)'RB',
2310 CALL "ZZENTR","SX",A{ALL},A$,X4$,X3$,19,8,28,15,C0,"","{3"+X$,"","FM2ODA10","","",""
2315 IF C0=-2 THEN GOTO 2020
2319 IF H$(25,1)="Y" THEN IF POS(" "<>A$(28,15))=0 THEN GOTO 2305
2320 IF C0<0 THEN GOTO 2326
2321 REM "if unique cust p/o req, check ASC, then either change or delete,106471
2322 IF H$(23,1)<>"Y" AND POS(X3$(9,3)="498",3)=0 THEN GOTO 2327 ELSE READ (Z[17],KEY=A$(6,10)+A$(28,15),DOM=2323)
2323 KEY_17$=KEY(Z[17],END=2326); IF KEY_17$(37,8)=A$(118,8) OR KEY_17$(1,25)<>A$(6,10)+A$(28,15) THEN GOTO 2326 ELSE CALL "ZZDISP","AX",KEY_17$(37,8),"O/P",X3$,TMP$,"",0,0,X4$; TMP$="This Customer P/O used on order "+TMP$
2324 CALL "ZZPROM","X0FS2DAA",X3$,Z,TMP$,"","",0; ON Z GOTO 6500,2325
2325 A$(28,15)=""; GOTO 2300; REM "clear field before going back
2326 GOSUB 8500
2328 REM "End of duplicate checking logicc
2340 GOTO 2020
2350 REM "Ordered by
2360 CALL "ZZENTR","S",A{ALL},A$,X4$,X3$,19,9,129,20,C0,"","{3"+X$,"","FM2ODA12","","",""
2361 IF H$(63,1)="Y" AND A$(129,20)=DIM(20) THEN X$="Ordered By required by this customer"; PRINT 'RB'; GOTO 2360; REM SSP 189628
2369 REM "Greeting - added 9/88 did not want to mess with a new X0 value
2370 CALL "ZZENTR","S",A{ALL},A$,X4$,X3$,47,9,149,20,C0,"","{3"+X$,"","FM2ODA13","","",""
2379 DUP_CHECK=0
2390 GOTO 2020
2400 REM "Date Requested
2410 CALL "ZZENTR","D",A{ALL},A$,X4$,X3$,19,10,55,6,C0,"","{3"+X$,"","FM2ODA14","","",""
2415 IF A$(55,6)<A$(16,6) THEN IF P7$(170,1)<>"Y" OR POS(" "<>A$(55,6))>0 THEN CALL "ZZPROM",".4",X3$,Z,"The date requested must be on or after the order date","","",0; GOTO 2410
2417 IF ABS(C0)<>2 AND POS(X3$(9,3)="002",3)>0 THEN X0=11; REM "For Data Formation"
2420 IF P9$<>"Y" THEN GOTO 2020 ELSE IF LEN(U1$)>5 THEN IF U1$(1,6)="FM2ODB" THEN GOTO 2430
2421 GOTO 2432
2430 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,47,10,43,1,C0,"","{3"+X$,"","FM2ODA15","","",""
2432 IF A$(43,1)<>"Y" THEN A$(44,1)=""; PRINT @(61,10)," ",; GOTO 2020 ELSE X$="Y=enter unit cost, N=use standard cost"
2435 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,61,10,44,1,C0,"","{3"+X$,"YN","FM2ODA15","","",""
2440 GOTO 2020
2450 REM "Print sales order?
2451 IF P7$(247,1)="Y" THEN GOTO 2020
2455 X$="Enter thank you letter type or blank to not send"
2460 CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,19,11,61,1,C0,"","{3"+X$,"ORDER","FM2ODA16","-ZY3","",""
2465 IF C0>4 THEN C0=0
2470 IF A$(61,1)<>" " THEN GOTO 8100
2490 GOTO 2020
2500 REM "Acknowledgement
2501 IF P7$(248,1)="Y" THEN GOTO 2020
2510 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,19,12,62,1,C0,"","{3"+X$,"","FM2ODA18","","","" ! [SSP-200893]
2540 GOTO 2020
2550 REM "Turn Off Inventory Job Costing Feature                               
2552 IF FIRST_TIME$<>"Y" THEN GOTO 2020
2555 IF P7$(226,1)<>"Y" OR P7$(280,1)<>"Y" OR A$(54,1)<>"B" OR MID(S5$,88,1)<>"Y" THEN A$(313,1)=" "; GOTO 2020
2556 IF A$(313,1)=" " THEN A$(313,1)="N"
2557 X$="Turn Off Inventory Job Costing Feature?"
2560 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,70,13,313,1,C0,"","{3"+X$,"","FM2ODA54","","",""
2565 IF A$(313,1)="Y" THEN A$(240,1)=" " ELSE A$(240,1)="Y"
2590 GOTO 2020
2600 REM "Deposit check no
2610 CALL "ZZENTR","SZ",A{ALL},A$,X4$,X3$,58,11,64,6,C0,"","{3"+X$,"","FM2ODA22","","",""
2620 IF POS("0"<>A$(64,6))=0 OR POS(" "<>A$(64,6))=0 THEN A$(64,12)="",A[0]=0; PRINT @(58,11),'CL',@(54,12),'CL',
2640 GOTO 2020
2650 REM "Deposit check date
2655 IF POS(" "<>A$(64,6))=0 THEN GOTO 2020
2660 CALL "ZZENTR","D",A{ALL},A$,X4$,X3$,66,11,70,6,C0,"","{3"+X$,"","FM2ODA24","","",""
2690 GOTO 2020
2700 REM "Deposit amount
2705 IF POS(" "<>A$(64,6))=0 THEN GOTO 2020
2710 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,54,12,0,621,C0,M0$,"{3"+X$,"","FM2ODA26","","",""
2740 GOTO 2020
2750 REM "Sales tax code
2760 CALL "ZZENTR","AU",A{ALL},A$,X4$,X3$,18,15,76,10,C0,"AR5","{3"+X$,"","FM2ODA28","AR5","X",""; IF ABS(C0)=102 THEN J9=3,Q1$=A$(76,10),Z8$="AR2MEA"; RUN "ZZ2STP" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2760,2761
2770 FIND (Z[3],KEY=A$(76,10),DOM=2760)IOL=0330
2775 PRINT @(31,15),C[0]+C[2]+C[3]:"##.00%",@(38,15),C$(11,25),
2790 GOTO 2020
2800 REM "Taxable?
2810 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,73,15,86,1,C0,"","{3"+X$,"","FM2ODA30","","",""
2840 GOTO 2020
2850 REM "Terms code
2853 IF S5$(65,1)="Y" THEN GOTO 2020
2855 J8$="AR2",J9$="X"; IF P7$(197,1)="Y" THEN J8$="",J9$=""
2860 CALL "ZZENTR","SZ",A{ALL},A$,X4$,X3$,18,16,87,2,C0,"","{3"+X$,"","FM2ODA32",J8$,J9$,""; IF ABS(C0)=102 THEN J9=4,Q1$=A$(87,2),Z8$="AR2MCA"; RUN "ZZ2STP" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2860,2861
2870 FIND (Z[4],KEY=A$(87,2),DOM=2860)IOL=0340
2875 IF P7$(197,1)<>"Y" THEN PRINT @(22,16),D$(3,19),; REM " SSP 146930
2890 GOTO 2020
2900 REM "Cust service rep
2910 CALL "ZZENTR","SZU",A{ALL},A$,X4$,X3$,18,17,89,4,C0,"","{3"+X$,"","FM2ODA34","AR3","X",""; IF ABS(C0)=102 THEN J9=5,Q1$="",Z8$="AR2MBB"; RUN "ZZ2STP" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2910,2911
2920 FIND (Z[5],KEY=A$(89,4),DOM=2910)IOL=0352
2925 PRINT @(25,17),E1$(5,25),
2940 GOTO 2020
2950 REM "Salesperson code
2955 IF P1$(7,1)="N" OR S5$(33,1)="Y" OR RESTRICT_SLSP THEN GOTO 2020 ! WO 274987
2956 S9$=A$(93,4)
2960 CALL "ZZENTR","SZU",A{ALL},A$,X4$,X3$,18,18,93,4,C0,"","{3"+X$,"","FM2ODA36","AR3","X",""; IF ABS(C0)=102 THEN J9=6,Q1$="",Z8$="AR2MBB"; RUN "ZZ2STP" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2960,2961
2965 IF POS(" "<>A$(93,4))=0 THEN GOTO 2960 ELSE IF A$(93,4)=S9$ THEN GOTO 2990
2970 FIND (Z[5],KEY=A$(93,4),DOM=2960)IOL=0350
2975 GOSUB 7730
2980 A$(97,5)=E$(219,5); FIND (Z[7],KEY=A$(97,5),DOM=2981)IOL=0370
2981 PRINT @(18,21),'CL',A$(97,5),@(25,21),G$(6,25)
2985 IF %MSLC THEN DET_MOD$="Y"; GOSUB DEFAULT_HEADER_SETUP; PRINT @(25,21),"** MULTI COMM **      " ! SSP 225300
2990 GOTO 2020
3000 REM "1st salesman % of sale
3004 IF P1$(7,1)="N" OR S5$(33,1)="Y" OR RESTRICT_SLSP THEN GOTO 2020 ! SSP 225300  WO274987      
3005 HOLD_CM=A[1] ! SSP 225300
3006 IF P1$(8,1)<"2" OR POS(" "<>A$(102,4))=0 THEN A[1]=100; IF %MSLC THEN GOTO 3020 ELSE GOTO 2020 ! SSP 225300
3010 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,24,18,1,320,C0,M1$,"{3"+X$,"","FM2ODA38","","",""
3012 IF A[1]>100 THEN GOTO 3010
3015 IF C0>0 THEN GOSUB 7800
3018 IF %MSLC THEN IF HOLD_CM<>A[1] THEN DET_MOD$="Y"; GOSUB DEFAULT_HEADER_SETUP ! SSP 225300
3040 GOTO 2020
3050 REM "Commission code
3055 IF P1$(7,1)="N" OR MID(S5$,33,1)="Y" OR RESTRICT_SLSP THEN GOTO 2020; REM " SPLIT OUT RESTRICTION FOR SALESPERSON CODE AND COMMISSION CODES ENTRY - SSP# 150788 WO274987
3056 IF MID(S5$,84,1)="Y" THEN GOTO 2020; REM " SPLIT OUT RESTRICTION FOR SALESPERSON CODE AND COMMISSION CODES ENTRY - SSP# 150788
3057 X$="Blank means set commission code based upon line type"
3058 IF %MSLC THEN IF TCB(88)=0 THEN GOTO 2020 ELSE GOTO 3092 ! SSP 225300
3060 CALL "ZZENTR","SZU",A{ALL},A$,X4$,X3$,18,21,97,5,C0,"","{3"+X$,"","FM2ODA40","AR4","X",""; IF ABS(C0)=5 THEN GOTO 3092 ELSE IF ABS(C0)=102 THEN J9=7,Q1$=A$(97,5),Z8$="AR2MDA"; RUN "ZZ2STP" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3060,3061
3070 DIM G$(31); IF POS(" "<>A$(97,5))>0 THEN FIND (Z[7],KEY=A$(97,5),DOM=3060)IOL=0370
3075 PRINT @(25,21),G$(6,25),
3090 GOTO 2020
3092 CALL "ZZPROM","MS",X3$,Z,"","","",0; ON Z GOTO 2020,3093
3093 GOSUB MULTI_COMM_KEY ! SSP 225300
3094 CALL "ARGSCM",X3$,X4$,SC_KEY$,DF_COMM$; A$(97,5)=DF_COMM$; IF SC_KEY$="MOD" THEN DET_MOD$="Y" ! SSP 225300
3095 GOTO 2020 ! SSP 225300
3100 REM "Other Salesmen
3105 IF P1$(7,1)="N" OR P1$(8,1)<"2" OR S5$(33,1)="Y" OR RESTRICT_SLSP THEN GOTO 2020 ! WO 274987
3108 HOLD_SLP$=A$(102,4) ! SSP 225300
3110 CALL "ZZENTR","SZU",A{ALL},A$,X4$,X3$,18,19,102,4,C0,"","{3"+X$,"","FM2ODA42","AR3","AR2MBB",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3110,3111
3115 IF POS(" "<>A$(102,4))=0 THEN PRINT @(18,19),DIM(50),@(18,20),'CL',; GOSUB 7730; A$(102,16)=DIM(16),A[2]=0,A[3]=0,A[4]=0,A[5]=0,A[1]=100; IF %MSLC THEN FPCNT=1; GOTO 3118 ELSE GOTO 2020 ! SSP 225300
3118 IF %MSLC THEN IF HOLD_SLP$<>A$(102,4) OR FPCNT=1 THEN DET_MOD$="Y"; GOSUB DEFAULT_HEADER_SETUP; IF FPCNT=1 THEN FPCTN=0; GOTO 2020 ELSE GOTO 2020 ! SSP 225300         
3120 FIND (Z[5],KEY=A$(102,4),DOM=3110)IOL=0351
3125 GOSUB 7730
3130 GOSUB 7760
3140 GOTO 2020
3150 REM "Alt slsperson % sale
3152 IF RESTRICT_SLSP THEN GOTO 2020 ! WO 274987
3155 HOLD_CM=A[2] ! SSP 225300
3160 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,24,19,2,320,C0,M1$,"{3"+X$,"","FM2ODA44","","",""
3165 IF C0>0 THEN GOSUB 7800
3168 IF %MSLC THEN IF HOLD_CM<>A[2] THEN DET_MOD$="Y"; GOSUB DEFAULT_HEADER_SETUP ! SSP 225300
3190 GOTO 2020
3200 REM "Promotional code
3205 IF P8$<>"Y" THEN GOTO 2020
3210 CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,19,6,49,2,C0,"","{3"+X$,"Q","FM2ODA50","FMP5","FS2MDA",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3210,3211
3225 IF A$(49,2)="  " THEN PRINT @(22,6),"               ",; GOTO 3240
3230 FIND (Z[8],KEY="Q"+A$(49,2),DOM=3210)IOL=0385
3235 PRINT @(22,6),H9$(44,15),
3240 GOTO 2020
3250 REM "Line Item Discount%"
3255 IF P7$(155,1)<>"Y" THEN GOTO 2020
3260 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,54,13,9,320,C0,M1$,"{3"+X$,"","FM2ODA49","","",""
3290 GOTO 2020
3300 REM "Save as repeat order?
3302 X$="Y=Yes, N=No, O=Notepad Only" ! ssp# 210352
3305 IF P7$(273,1)<>"Y" THEN GOTO 2020
3307 RO$=A$(184,1); REM "If it's set to Y and they change to N we need to delete all the repeat order related files
3308 IF P7$(274,1)="O" THEN A$(184,1)="O"; REM "Default to O, allow override ssp# 210352
3309 IF P7$(274,1)="A" THEN A$(184,1)="Y"; GOTO 3311; REM "Default to Y, do not allow override
3310 CALL "ZZENTR","SUR",A{ALL},A$,X4$,X3$,73,16,184,1,C0,"","{3"+X$,"YNO","FM2OA004","","","" ! SSP#210352
3312 IF RO$="Y" AND (A$(184,1)="N" OR A$(184,1)="O") THEN PRINT @(26,22),"Removing repeat order records",; CALL "FM2ODE",X3$,-2,A$,A{ALL},X4$; PRINT @(0,22),'CL', ! SSP# 210352
3314 IF A$(184,1)<>"Y" THEN GOTO 3340
3315 DIM FT7$(120); EXTRACT (Z[12],KEY=A$(6,10)+A$(118,8),DOM=3316)FT7$
3320 PRINT @(0,15),'CE',@(10,17),"Repeat order comment:",@(32,17),FT7$(34,35),
3325 CALL "ZZENTR","S",A{ALL},FT7$,X4$,X3$,32,17,34,35,C0,"","{3"+X$,"","FM2OA008","","",""
3330 FT7$(1,10)=A$(6,10),FT7$(11,8)=A$(118,8),FT7$(19,15)=A$(28,15)
3335 WRITE (Z[12],KEY=FT7$(1,18))FT7$; IF NEW_ORD$="Y" THEN RETURN 
3337 GOSUB 6400
3340 GOTO 2020
3350 REM "Order on hold?
3353 IF POS(X3$(9,3)="498487377",3)=0 AND A$(194,1)="Y" THEN GOTO 2020
3355 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,73,17,194,1,C0,"","{3"+X$,"","FM2OA010","","",""
3390 GOTO 2020
3400 REM "GB-Sure date?
3405 IF GB$="" OR STP(A$(55,6),3," ")="" THEN A$(226,1)=" "; PRINT @(37,10),A$(226,1),; GOTO 2020
3410 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,37,10,226,1,C0,"","{3"+X$,"","FM2OA012","","",""
3440 GOTO 2020
3500 REM "Third salesperson
3505 IF P1$(7,1)="N" OR P1$(8,1)<"3" OR S5$(33,1)="Y" OR RESTRICT_SLSP THEN GOTO 2020 ! WO274987
3508 HOLD_SLP$=A$(106,4) ! SSP 225300
3510 CALL "ZZENTR","SZU",A{ALL},A$,X4$,X3$,18,20,106,4,C0,"","{3"+X$,"","FM2ODA42","AR3","AR2MBB",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3510,3511
3515 IF POS(" "<>A$(106,4))=0 THEN PRINT @(18,20),'CL',; GOSUB 7770; A[1]=A[1]+A[3],A[3]=0; GOTO 2020
3520 FIND (Z[5],KEY=A$(106,4),DOM=3510)IOL=0353
3525 GOSUB 7770
3530 GOSUB 7760
3535 IF %MSLC THEN IF HOLD_SLP$<>A$(106,4) THEN DET_MOD$="Y"; GOSUB DEFAULT_HEADER_SETUP ! SSP 225300
3540 GOTO 2020
3550 REM "Third Slsperson % of Sale
3551 IF RESTRICT_SLSP THEN GOTO 2020 ! WO 274987
3552 HOLD_CM=A[3] ! SSP 225300
3560 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,24,20,3,320,C0,M1$,"{3"+X$,"","FM2ODA44","","",""
3565 IF C0>0 THEN GOSUB 7800
3568 IF %MSLC THEN IF HOLD_CM<>A[3] THEN DET_MOD$="Y"; GOSUB DEFAULT_HEADER_SETUP ! SSP 225300
3590 GOTO 2020
3600 REM "SMP? SSP144414       
3604 IF CIG_PLUS$<>"Y" THEN GOTO 2020
3605 X$="For CIG Plus only, if some lines not complete then don't create AR invoice?"
3610 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,73,18,243,1,C0,"","{3"+X$,"","FM2ODA46","","",""
3640 GOTO 2020
3650 REM " Freight markup table - ssp# 147448
3655 IF P7$(299,1)<>"Y" THEN GOTO 2020
3657 READ (Z[8],KEY="D"+A$(6,10),DOM=3660)CUST_DEFAULTS$
3658 IF Z9<>1 THEN IF CUST_DEFAULTS$(50,2)<>DIM(2) AND A$(244,2)=DIM(2) THEN A$(244,2)=CUST_DEFAULTS$(50,2); GOTO 3660
3659 IF Z9<>1 THEN IF CUST_DEFAULTS$(93,2)<>DIM(2) AND A$(244,2)=DIM(2) THEN A$(244,2)=CUST_DEFAULTS$(93,2)
3660 CALL "ZZENTR","SUZ",A{ALL},A$,X4$,X3$,74,21,244,2,C0,"","{3"+X$,"M","FM2SHA55","FMPM","FM2MPH",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3660,3661
3670 IF STP(A$(244,2))<>"" THEN FIND (Z[8],KEY="M"+A$(244,2),DOM=3660) ! SSP#282394
3690 GOTO 2020
3700 REM " Credit Card type if Terms code is CC - SSP# 146930
3701 IF MID(AR_PARMS$,130,1)<>"Y" THEN GOTO 2020
3702 IF MID(D$,57,1)<>"Y" THEN A$(285,4)=DIM(4)
3703 IF MID(D$,57,1)<>"Y" THEN GOTO 2020; REM " DON'T STOP HERE IF NOT CC
3705 J8$="ASP",J9$="X"; IF P7$(197,1)="Y" THEN J8$="",J9$=""
3710 CALL "ZZENTR","SUZ",A{ALL},A$,X4$,X3$,51,16,285,4,C0,"","{3"+X$,"","FM2ODA34",J8$,J9$,""; IF ABS(C0)=102 THEN J9=4,Q1$=A$(285,4),Z8$="AR2MAW"; RUN "ZZ2STP" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2860,2861 ! SSP293239, uppercase
3720 FIND (Z[25],KEY=A$(285,4),DOM=3710)IOL=0392
3730 PRINT @(51,16),A$(285,4); REM " ,
3740 GOTO 2020
3800 REM "Contract Number              ! [SSP-200893]-added routine
3805 IF POS(H$(129,1)="YR")=0 THEN GOTO 2020
3811 X$=""; C0=0
3812 IF H$(129,1)="Y" THEN X$="200893 A contract number entry is optional. "
3814 IF H$(129,1)="R" THEN X$="200893 A valid contract number is required. "
3820 %FTS_QRY_CONTRACT_DATE$="",%FTS_QRY_CONTRACT$="",%FTS_QRY_CUST$=A$(6,10); CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,14,13,315,20,C0,"","{3"+X$,"","","FTS","",""; IF C0=6 THEN GOSUB 6400; C0=1
3825 IF H$(129,1)="Y" THEN TMP_CONTRACT$=A$(315,20),TMP_CONTRACT_DATE$=DIM(6)
3830 IF H$(129,1)="R" THEN {! 3994
3940 REQ_CONTRACT$=H$(129,1),CONTRACT_NUM$=A$(315,20),CUST_DIV$=B$(1,2),CUST_CODE$=B$(3,8),FTS_LFN=Z[18]
3944 CONTRACT_DATE$=DIM(6)
3945 IF %FTS_VAL$<>"" THEN %FTS_VAL$=PAD(%FTS_VAL$,36); CONTRACT_DATE$=%FTS_VAL$(31,6); %FTS_VAL$=""
3950 GOSUB VALIDATE_CONTRACT_NUM
3955 IF VALID_CONTRACT<>0 THEN A$(315,20)=PAD(HLD_CONTRACT$,20); GOTO 3820
3960 A$(315,20)=TMP_CONTRACT$; IF STP(TMP_CONTRACT_DATE$)<>"" THEN A$(335,6)=TMP_CONTRACT_DATE$
3980 PRINT @(14,13),A$(315,20)
3992 GOSUB 6400
3994  } ! 3830
3995 GOTO 2020
4000 REM "Come here from 2250's if allowing more than one RFQ per order
4010 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,19,7,183,1,C0,"","{3"+X$,"","FM2ODA52","","",""
4015 IF A$(183,1)="Y" AND P7$(159,1)="Y" AND A$(52,1)<>"Y" THEN CALL "ZZPROM",".Y",X3$,Z,"Is the quote an RFQ?","","",0; IF Z=0 THEN A$(52,1)="Y"
4040 GOTO 2020
4100 ! WO212768, blanket PO
4103 IF POS(H$(129,1)="YR")=0 THEN GOTO 4140
4105 X$="Blanket PO must be valid for entered contract number.",J$=A$(6,10),%CONTRACT$=A$(315,20)
4110 CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,14,14,341,20,C0,"","{3"+X$,J$,"FM2OA020","FTU","",""; %CONTRACT$=""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 4110,4111
4115 IF A$(341,20)=DIM(20) THEN A$(361,6)=DIM(6); GOTO 4140
4119 CUSTOMER$=A$(6,10),BLANKET_PO$=A$(341,20),BLANKET_PO_DATE$=A$(361,6),CONTRACT$=A$(315,20)
4120 CALL "FM2CON;VALIDATE_BLANKET_PO",X3$,X4$,Z[19],CUSTOMER$,BLANKET_PO$,BLANKET_PO_DATE$,CONTRACT$,MSG_TEXT$,VALID_BLANKET_PO
4125 IF VALID_BLANKET_PO<>0 THEN CALL "ZZPROM",".4",X3$,0,MSG_TEXT$,"","",0; A$(341,26)=DIM(26); GOTO 4105 ELSE A$(341,20)=BLANKET_PO$,A$(361,6)=BLANKET_PO_DATE$; IF A$(28,15)=DIM(15) THEN A$(28,15)=A$(341,15); PRINT @(19,8),A$(28,15),
4140 GOTO 2020
4145 ! 
4150 REM "Allow entry of Summary Bill flag WO 255959
4155 IF CHK_SB$<>"Y" THEN GOTO 2020
4157 IF CHK_SB$="Y" AND A$(373,1)=" " THEN CALL "UPDFS1;CHECK_SUMM_BILL",Z(8),A$(6,10),A$(47,1),A$(54,1),SBILL$; A$(373,1)=SBILL$ ! SSP#273933
4160 X$="Summary Bill this order?"
4165 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,78,19,373,1,C0,"","{3"+X$,"","FM2ODA46","","",""
4170 GOTO 2020
5900 REM "Go back to menu after delete
5920 Q$=STR(LEN(A1$):"00")+A1$,U1$="FM2ODM"+Q$
5930 WRITE (Z[13],KEY=U0$)U0$,U1$
5980 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
5990 SETERR 5995; RUN "FM2ODM"
5995 GOTO 0001
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6006)'SB',
6060 PRINT @(0,3),"Order no:",@(21,3),"Customer:",@(0,4),Z0$,
6070 PRINT @(7,5),"Order date:",@(38,5),"Address:",@(5,7),"Master quote:",@(41,7),"City:",@(64,7),"State:",@(3,8),"Customer PO no:",@(42,8),"Zip:",@(7,9),"Ordered by:",@(41,9),"Dear:",@(3,10),"Date Requested:",@(40,11),"Deposit check no:",
6071 IF P7$(265,1)="Y" THEN PRINT @(3,7),"Using quote(s)?"
6072 IF GB$<>"" THEN PRINT @(31,10),"Sure?",
6075 PRINT @(38,12),"Deposit amount:",@(0,14),Z0$,
6080 PRINT @(2,15),"Sales tax code:",@(64,15),"Taxable?",@(6,16),"Terms code:",@(0,17),"Cust service rep:",
6081 IF MID(AR_PARMS$,130,1)="Y" THEN PRINT @(42,16),"CC Type:",; REM " SSP# 146930
6082 IF P7$(273,1)="Y" THEN PRINT @(57,16),"Save as repeat?",
6083 PRINT @(62,17),"Exception?",
6084 IF CIG_PLUS$="Y" THEN PRINT @(68,18),"SMP?",; REM "SSP144414
6085 IF P1$(7,1)<>"N" THEN PRINT @(0,18),"Salesperson code:", ! WO274987
6086 IF NOT(RESTRICT_SLSP) THEN PRINT @(0,18),"Salesperson code:", ! WO274987
6090 IF P9$="Y" THEN PRINT 'SB',@(35,10),"Work order?",@(52,10),"Special?",
6095 IF P8$="Y" THEN PRINT 'SB',@(1,6),"Promotional code:",
6100 IF P7$(155,1)="Y" THEN PRINT 'SB',@(37,13),"Line Item Disc%:",
6105 IF P7$(226,1)="Y" THEN PRINT @(0,5),'SB',"Tp:",
6110 IF P7$(247,1)<>"Y" THEN PRINT 'SB',@(1,11),"Send Letter type:",
6115 IF P7$(248,1)<>"Y" THEN PRINT 'SB',@(2,12),"Print ship ack?:", ! [SSP-200893]
6117 IF POS(H$(129,1)="YR") THEN PRINT @(1,13),"Contract No: " ! [SSP-200893]
6118 IF POS(H$(129,1)="YR") THEN PRINT @(2,14),"Blanket PO: "+DIM(20), ! WO212768
6120 IF P7$(299,1)="Y" THEN PRINT @(51,21),"Freight Markup Table:",; REM " SSP# 147448                                                          
6125 IF CHK_SB$="Y" THEN PRINT @(68,19),"Summ Bill?", ! WO 255959
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6215 GOSUB 6450
6216 IF A$(314,1)="Y" THEN PRINT @(36,14),"** ORDER SUSPENDED **",; REM SSP 189962, WO212768
6220 CALL "ZZDISP","A",A$(6,10),"A/R",X3$,"","",31,3,X4$
6224 PRINT @(44,3),B$(11,35),; IF P8$="Y" THEN PRINT @(19,6),A$(49,2),@(22),H9$(44,15),
6226 IF P7$(226,1)="Y" THEN PRINT @(4,5),A$(54,1),; IF A$(54,1)="B" AND MID(S5$,88,1)="Y" AND P7$(280,1)="Y" THEN PRINT @(61,13),'SB',"Job Cst:",'SF',@(70,13),A$(313,1), ELSE PRINT @(61,13),'CL',
6228 CALL "ZZDISP","D",A$(16,6),"",X3$,"","",19,5,X4$
6230 IF P7$(265,1)="Y" AND STP(A$(23,5)+A$(3,3),3," ")="" THEN PRINT @(19,7),A$(183,1),; GOTO 6232
6231 J6$=A$(23,5)+A$(3,3); CALL "ZZDISP","A",J6$,"O/P",X3$,"","",19,7,X4$
6232 PRINT @(19,8),A$(28,15),@(19,9),A$(129,20),@(47,9),A$(149,20),
6234 IF P1$(64,1)="Y" THEN X$=A$(118,8)+A$(6,10)+B$(11,35)+B$(56,87)+B$(205,14); CALL "FM2OA4",X3$,X4$,X$,"OD"; X$="" ELSE CALL "ZY2AAA",X3$,X4$,38,5,"B","",1,B$(56,163),"",1,0,0
6236 CALL "ZZDISP","D",A$(55,6),"",X3$,"","",19,10,X4$
6237 IF GB$<>"" THEN PRINT @(37,10),A$(226,1),
6238 IF P9$="Y" THEN PRINT @(47,10),A$(43,1),@(61,10),A$(44,1),
6239 PRINT @(58,11),A$(64,6),
6240 IF P7$(247,1)<>"Y" THEN PRINT @(19,11),A$(61,1),
6241 IF P7$(248,1)<>"Y" THEN PRINT @(19,12),A$(62,1), ! SSP#230437
6242 IF POS(" "<>A$(64,6))=0 THEN GOTO 6250
6244 CALL "ZZDISP","D",A$(70,6),"",X3$,"","",66,11,X4$
6248 PRINT @(54,12),A[0]:M0$,
6252 CALL "ZZDISP","A",A$(76,10),"AR5",X3$,"","",18,15,X4$
6256 PRINT @(31,15),C[0]+C[2]+C[3]:"##.00%",@(38,15),C$(11,25),@(73,15),A$(86,1),@(18,16),A$(87,2),@(18,17),A$(89,4),@(25,17),E1$(5,35),
6257 IF P7$(273,1)="Y" THEN PRINT @(73,16),A$(184,1),
6258 IF P7$(197,1)<>"Y" THEN PRINT @(22,16),D$(3,19),; REM " SSP 146930
6259 PRINT @(73,17),A$(194,1),@(73,18),A$(243,1),; REM "Order on hold?, SMP  - Don't create AR Invoice if not all received, SSP144414              
6260 GOSUB 7700
6261 IF MID(AR_PARMS$,130,1)="Y" AND A$(285,4)<>DIM(4) THEN PRINT @(42,16),"CC Type:",@(51,16),A$(285,4),; REM " SSP# 146930
6270 IF POS(H$(129,1)="YR") THEN PRINT @(14,13),A$(315,20),@(14,14),A$(341,20), ! [SSP-200893],WO212768
6280 IF P1$(7,1)="Y" THEN PRINT @(18,21),A$(97,5),@(25,21),G$(6,25),; IF %MSLC THEN PRINT @(25,21),"** MULTI COMM **     ", ! SSP 225300 WO274987
6283 IF P7$(299,1)<>"Y" THEN GOTO 6290
6284 READ (Z[8],KEY="D"+A$(6,10),DOM=6289)CUST_DEFAULTS$
6285 REM "IF CUST_DEFAULTS$(50,2)<>DIM(2) AND A$(244,2)=DIM(2) THEN A$(244,2)=CUST_DEFAULTS$(50,2); GOTO 6289
6286 REM "IF CUST_DEFAULTS$(93,2)<>DIM(2) AND A$(244,2)=DIM(2) THEN A$(244,2)=CUST_DEFAULTS$(93,2)
6289 IF P7$(299,1)="Y" THEN PRINT @(74,21),A$(244,2),; REM " SSP# 147448
6290 IF P7$(155,1)="Y" THEN PRINT @(54,13),A[9]:M1$,
6295 IF CHK_SB$="Y" THEN PRINT @(78,19),A$(373,1) ! WO 255959
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>=0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6455 IF C9<0 THEN GOTO 6445
6460 CALL "ZZDISP","A",A$(118,8),"O/P",X3$,"","",10,3,X4$
6490 RETURN 
6500 REM "Access to delete logic added for 106471
6505 L0=2; GOTO 9950
7300 REM 
7310 ON FPT(C0)*10 GOTO 7390,7325,7330,7390
7325 IF V8$="" THEN X0=X0+4; GOTO 7390 ELSE X0=NUM(V8$(POS(STR(X0:"00")<=V8$,2),2)); GOTO 7390
7330 IF V8$="" THEN X0=X0-6; GOTO 7335 ELSE X0=POS(STR(X0-1:"00")<=V8$,2)-2; IF X0<0 THEN X0=0; GOTO 7390 ELSE X0=NUM(V8$(X0,2)); GOTO 7390
7335 IF X0<0 THEN X0=0; GOTO 7390
7390 C0=3; RETURN 
7500 REM "Handle returns from setups
7505 J8=J9,J9=0,C0=0; ON J8 GOTO 0206,7510,7515,7520,7525,7530,7535,7540
7510 REM "Customer
7512 IF Q1$<>"" THEN A$(6,10)=Q1$; GOSUB 6400; GOTO 2111 ELSE GOSUB 6400; GOTO 2110
7515 REM "Quote
7517 IF Q1$<>"" THEN J7$=Q1$; GOSUB 6400; GOTO 2261 ELSE GOSUB 6400; GOTO 2260
7520 REM "Sales tax
7522 IF Q1$<>"" THEN A$(76,10)=Q1$; GOSUB 6400; GOTO 2761 ELSE GOSUB 6400; GOTO 2760
7525 REM "Terms code
7527 IF Q1$<>"" THEN A$(87,2)=Q1$; GOSUB 6400; GOTO 2861 ELSE GOSUB 6400; GOTO 2860
7530 REM "Cust serv rep
7532 IF Q1$<>"" THEN A$(89,4)=Q1$; GOSUB 6400; GOTO 2911 ELSE GOSUB 6400; GOTO 2910
7535 REM "Salesperson
7537 IF Q1$<>"" THEN A$(93,4)=Q1$; GOSUB 6400; GOTO 2961 ELSE GOSUB 6400; GOTO 2960
7540 REM "Commission code
7542 IF Q1$<>"" THEN A$(97,5)=Q1$; GOSUB 6400; GOTO 3061 ELSE GOSUB 6400; GOTO 3060
7600 REM "Set defaults from customer & display
7610 PRINT @(44,3),B$(11,35),
7615 IF CHK_SB$="Y" THEN SBILL$=""; CALL "UPDFS1;CHECK_SUMM_BILL",Z[8],A$(6,10),A$(47,1),A$(54,1),SBILL$; A$(373,1)=SBILL$; PRINT @(78,19),A$(373,1) ! WO 255959
7620 A$(76,10)=B$(235,10),A$(87,2)=B$(359,2),A$(93,4)=B$(278,4),A$(102,16)=B$(282,16),A[1]=B[0],A[2]=B[1],A[3]=B[2],A[4]=B[3],A[5]=B[4]
7621 IF B$(245,1)="Y" THEN A$(86,1)="N" ELSE A$(86,1)="Y"
7623 IF P7$(155,1)="Y" AND NUM(B$(398,3),ERR=7624)<=100 THEN A[9]=NUM(B$(398,3))
7625 IF POS(" "<>A$(89,4))=0 THEN A$(89,4)=A$(93,4)
7626 IF P7$(273,1)="Y" THEN IF POS(P7$(274,1)="YA")>0 THEN A$(184,1)="Y" ELSE A$(184,1)="N"; REM "Set save as repeat to 'Y' as default if parm set
7627 IF P7$(273,1)="Y" THEN IF POS(P7$(274,1)="O")>0 THEN A$(184,1)="O"; REM "Set save as repeat to 'O' as default if parm set to 'O' (Notebook only); REM "SSP#210352
7629 V9=1
7630 GOSUB 7650; GOSUB 7900
7632 A$(129,40)=B$(165,40)
7633 IF %MSLC THEN GOSUB DEFAULT_HEADER_SETUP ! SSP 225300
7635 GOSUB 6232
7640 RETURN 
7650 REM "Read in Salesperson, commission data
7652 FIND (Z[3],KEY=A$(76,10),DOM=7653)IOL=0330
7653 FIND (Z[4],KEY=A$(87,2),DOM=7654)IOL=0340
7655 FIND (Z[5],KEY=A$(93,4),DOM=7656)IOL=0350
7656 FIND (Z[5],KEY=A$(102,4),DOM=7657)IOL=0351
7657 IF V9=1 THEN V9=0,A$(97,5)=E$(219,5); IF P1$(68,1)="Y" AND POS(" "<>B$(262,5))>0 THEN A$(97,5)=B$(262,5)
7660 FIND (Z[7],KEY=A$(97,5),DOM=7661)IOL=0370
7665 FIND (Z[5],KEY=A$(89,4),DOM=7666)IOL=0352
7678 FIND (Z[5],KEY=A$(106,4),DOM=7679)IOL=0353
7690 RETURN 
7700 REM "Salespersons display"
7710 IF NOT(RESTRICT_SLSP) THEN IF P1$(7,1)="Y" THEN GOSUB 7725; GOSUB 7750; GOSUB 7770 ! WO274987
7715 RETURN 
7725 PRINT @(18,18),A$(93,4),
7730 IF P1$(8,1)>="2" AND POS(" "<>A$(102,4))<>0 THEN PRINT @(24,18),A[1]:M1$,@(32,18),E$(5,35), ELSE PRINT @(25,18),E$(5,35),; REM 'CL',
7740 RETURN 
7750 IF P1$(8,1)<"2" OR POS(" "<>A$(102,4))=0 THEN RETURN ELSE PRINT @(18,19),A$(102,4),
7760 PRINT @(24,19),A[2]:M1$,@(32,19),E0$(5,35),
7762 IF P1$(8,1)>="3" AND A[3]<>0 THEN PRINT @(18,20),A$(106,4),@(24,20),A[3]:M1$,@(32,20),E2$(5,35),
7765 RETURN 
7770 IF P1$(8,1)>="3" AND POS(" "<>A$(106,4))<>0 THEN PRINT @(18,20),A$(106,4),@(24,20),A[3]:M1$,@(32,20),E2$(5,35),'CL',
7790 RETURN 
7800 REM "Balance Saleperson % to 100
7805 COM_PER=0,SLS=0; FOR X=1 TO 4; IF A$(98+X*4,4)<>" " THEN COM_PER=COM_PER+A[X+1],SLS=X ELSE A[X+1]=0
7808 COM_PER=COM_PER+A[1]-A[X+1]; A[X+1]=100-COM_PER; IF A[X+1]<0 THEN A[X+1]=0
7809 NEXT X
7810 ! COM_PER=COM_PER+A[1]-A[X]; A[X]=100-COM_PER
7819 REM "LETA[2]=100-A[1]
7820 PRINT @(24,19),A[2]:M1$,
7830 IF P1$(8,1)>"2" AND POS(" "<>A$(106,4))<>0 THEN PRINT @(24,20),A[3]:M1$
7845 RETURN 
7900 REM "Set customer defaults"
7905 DIM H$(243)
7910 FIND (Z[8],KEY="D"+A$(6+K9,10),DOM=7935)IOL=0380
7920 IF POS(H$(129,1)="YR") THEN PRINT @(1,13),"Contract No: " ! [SSP-200893]
7925 %NEW_OE_FLAG$="Y"
7930 IF P7$(248,1)<>"Y" THEN IF A$(62,1)<>"Y" AND H$(27,1)="Y" THEN A$(62,1)="Y"; PRINT @(19,13),A$(62,1),
7935 IF P7$(160,1)="A" OR (P7$(160,1)="S" AND H$(66,1)="Y") THEN A$(53,1)="Y"
7938 A$(61,1)=H$(26,1)
7940 REM SET FREIGHT MARKUP TABLE SSP 200110
7942 IF MID(H$,50,2)<>DIM(2) AND A$(244,2)=DIM(2) THEN A$(244,2)=MID(H$,50,2); REM SSP 200110
7943 ! IF H$(50,2)<>DIM(2) THEN GOTO 7999; REM SSP 200110 if there's something  in 50,2, use that and don't check the order types   ssp#225507 - Always re place if other fields are not blank                                        
7944 IF MID(H$,93,2)<>DIM(2) THEN A$(244,2)=MID(H$,93,2); REM SSP 200110 !SSP#225507
7999 RETURN ; REM SSP 200110
8045 RETURN 
8100 REM "Validate sales order type
8110 DIM O9$(12); O9$(1)="ORDER",O9$=O9$+A$(61,1)
8120 READ (Z[11],KEY=O9$,DOM=8121)
8125 K$=KEY(Z[11],END=8135)
8130 IF K$(1,13)=O9$ THEN GOTO 2490
8135 GOTO 2460
8200 REM "Check customer code on a quote
8205 IF A$(6,10)=I$(10,10) OR I$(391,1)="P" THEN GOTO 8220
8207 CALL "ZZDISP","AX",I$(10,10),"A/R",X3$,J8$,"",0,0,X4$
8210 J9$="Customer ("+J8$+") on the quote doesn't match customer you entered"
8215 CALL "ZZPROM",".4",X3$,0,J9$,"","",0
8220 IF POS(" "<>I$(455,8))=0 THEN GOTO 8240
8225 CALL "ZZDISP","AX",I$(455,8),"O/P",X3$,J8$,"",0,0,X4$
8230 J9$="NOTE: Ordered previously on order# "+J8$+" on "+FND$(I$(463,6))
8235 CALL "ZZPROM",".4",X3$,0,J9$,"","",0
8240 RETURN 
8500 REM "Check FSO for Duplicate PO number
8505 DUP_CHECK=0
8508 IF H$(23,1)<>"Y" THEN RETURN 
8510 Z$="17C ASC...  17O FSO... "; GOSUB 9750; ON Z0 GOTO 8511,9900
8520 READ (Z[17],KEY=A$(6,10)+A$(28,15),DOM=8521)
8530 KEY_17$=KEY(Z[17],END=8570); IF KEY_17$(26,8)=A$(118,8) OR KEY_17$(1,25)<>A$(6,10)+A$(28,15) THEN GOTO 8570 ELSE DUP_CHECK=1; CALL "ZZDISP","AX",KEY_17$(26,8),"O/P",X3$,TMP$,"",0,0,X4$; TMP$="ThisCustomer P/O used on order "+TMP$
8570 Z$="17C FSO...  17O ASC... "; GOSUB 9750; ON Z0 GOTO 8571,9900
8580 IF DUP_CHECK=1 THEN EXITTO 2324 ELSE RETURN 
8600 REM "Check customer credit status
8605 H1$="FM2OA0"
8606 A$(314,1)="N"; REM SSP 189962
8615 IF POS(B$(361,1)="YHM")>0 THEN H0=2; RUN "FM2OA1"
8620 IF B[5]<>0 AND B[6]+B[13]>B[5] THEN H0=1; RUN "FM2OA1"
8630 IF POS("P"=P7$(161,5))=0 THEN GOTO 8640
8632 Z=NUM(P0$(99,1)); IF Z=0 THEN Z=3
8634 FOR H0=Z TO 5; IF B[H0+7]>0 THEN EXITTO 8638
8636 NEXT H0; GOTO 8640
8638 H0=3; RUN "FM2OA1"
8640 IF POS(X3$(9,3)="011")=0 AND POS("A"=P7$(161,5))=0 THEN GOTO 8690
8650 CALL "FM2OA2",X3$,X4$,B$(1,10),H0
8660 IF H0>=60 THEN RUN "FM2OA1"
8690 IF H1=2 THEN GOTO 2137 ELSE RETURN 
8700 REM "Repeat Order?
8705 PRINT @(0,4),"Repeat order no:",'CL',
8707 X$="Lookup by Order No or F8 by Invoice or F10 by Customer PO"
8708 DIM TMP[1],RPT_ORD$(8)
8710 CALL "ZZENTR","AUXF",TMP{ALL},RPT_ORD$,X4$,X3$,17,4,1,8,C0,"O/P","{3"+X$,A$(6,10),"FM2OA002","FT7","",""; IF C0=-17 OR C0=-7 THEN GOTO 8711 ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 8710,8711
8711 IF C0=-17 THEN C0=1,CUST$=A$(6,10); CALL "FM2INV",X3$,X4$,CUST$,RPT_ORD$,X$; IF X$="" THEN GOTO 8708; REM "Lookup by invoice number
8712 IF C0=-7 THEN C0=1,CUST$=A$(6,10); CALL "FM2CPO",X3$,X4$,CUST$,RPT_ORD$,X$; IF X$="" THEN GOTO 8708; REM "Lookup by customer PO
8715 IF STP(RPT_ORD$,3," ")="" THEN PRINT @(0,4),Z0$,; GOTO 8750
8720 DIM FT3$(100); READ (Z[15],KEY=RPT_ORD$,DOM=8708)FT3$; IF FT3$(6,10)<>A$(6,10) THEN CALL "ZZPROM",".4",X3$,0,"Repeat order customer code does not match order customer code","","",0; GOTO 8708
8725 Q0$="R"; CALL "FM2ODT",X3$,X4$,Q0$,RPT_ORD$
8730 IF Q0$="N" THEN GOSUB 6400; GOTO 8705
8733 ORDERS$=RPT_ORD$+A$(118,8)+"N",NEW_ORD$="N"
8734 IF P7$(274,1)="A" THEN ORDERS$(17,1)="Y",NEW_ORD$="Y",X$=""; GOSUB 3315; GOTO 8736; REM "If save all option, don't ask, just save as repeat
8735 CALL "ZZPROM",".Y",X3$,Z,"Do you wish to save this new order as a repeat order?","","",0; IF Z=0 THEN ORDERS$(17,1)="Y",NEW_ORD$="Y",X$=""; GOSUB 3315
8739 ORDERS$=ORDERS$+A$(314,1); REM "Credit suspended flag - Y=Suspended
8740 CALL "FM2ODE",X3$,2,ORDERS$,TMP{ALL},X4$
8741 IF ORDERS$="NOF" THEN GOSUB 6400; GOTO 8705; REM "Validation issue when copying repeat to new order, SSP102815
8745 GOTO 5900
8750 RETURN 
8900 REM "Functions
8915 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8940 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9505 C9=1
9510 SETERR 9000; GOSUB 6400
9520 GOTO 2040
9710 GOTO 9900
9750 REM 
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 9761,9900
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 IF %MSLC THEN IF DET_MOD$="Y" THEN CCKEY$="O"+A$(118,8)+A$(6,2)+A$(8,8),CMMSG$=""; CALL "ARGSCM;UPDATE_DETAIL_RECS",CCKEY$,CMMSG$; DET_MOD$=""; IF CMMSG$="Y" THEN MSGBOX "Existing Detail Lines have been modified to Default Commission Codes - Please Review!",MSG("WARNING") ! SSP 225300
9910 IF H$(25,1)="Y" THEN IF POS(" "<>A$(28,15))=0 THEN X0=3,C0=0; GOTO 2040
9920 IF A$(55,6)<A$(16,6) THEN IF P7$(170,1)<>"Y" OR POS(" "<>A$(55,6))>0 THEN X0=6,C0=0; GOTO 2040
9930 IF H$(63,1)="Y" AND A$(129,20)=DIM(20) THEN X$="Ordered By required by this customer"; PRINT 'RB'; X0=5,C0=0; GOTO 2040; REM SSP #189628
9932 IF H$(129,1)="R" AND %NEW_OE_FLAG$="Y" THEN GOSUB TEST_CONTRACT; IF VALID_CONTRACT<>0 THEN C0=0,X0=10; GOTO 3800 ! [SSP-200893]
9935 %NEW_OE_FLAG$="" ! [SSP-200893]
9940 SETESC 9350
9945 L0=1
9946 C9=0
9950 RUN "FM2ODA"
9999 END 
20000 VALIDATE_REP:
20010 VAL_REP=0,CUST$=PAD(B$,600)
20020 IF CUST$(278,4)<>DIM(4) THEN CALL "UPDSYO;VAL_REP",ERR=*NEXT,X3$,CUST$(278,4),OK; IF OK THEN VAL_REP=1; GOTO *RETURN
20030 IF CUST$(282,4)<>DIM(4) THEN CALL "UPDSYO;VAL_REP",ERR=*NEXT,X3$,CUST$(282,4),OK; IF OK THEN VAL_REP=1; GOTO *RETURN
20040 IF CUST$(286,4)<>DIM(4) THEN CALL "UPDSYO;VAL_REP",ERR=*NEXT,X3$,CUST$(286,4),OK; IF OK THEN VAL_REP=1; GOTO *RETURN
20050 IF CUST$(290,4)<>DIM(4) THEN CALL "UPDSYO;VAL_REP",ERR=*NEXT,X3$,CUST$(290,4),OK; IF OK THEN VAL_REP=1; GOTO *RETURN
20060 IF CUST$(294,4)<>DIM(4) THEN CALL "UPDSYO;VAL_REP",ERR=*NEXT,X3$,CUST$(294,4),OK; IF OK THEN VAL_REP=1; GOTO *RETURN
20080 IF CUST$(278,20)=DIM(20) THEN VAL_REP=1
20090 RETURN 
20800 INVALID_CONTRACT_NUM:
20850 CALL "ZZPROM",".4",X3$,0,MSG_TEXT$,"","",0
20895 RETURN 
20898 ! 
20899 ! 
21000 QUERY_FTS:
21010 HLD_X0=X0
21020 L1$="FTS"
21022 %FTS_QRY_CUST$=A$(6,10)
21025 Y9$=""
21030 Y2$=""
21035 VAL$=""
21040 X0=1
21045 X2=0
21050 Y8=20
21055 X5$="SUX"
21060 X2$=""
21065 X3=0
21070 X7$=""
21080 %FTS_QRY_CONTRACT$=A$(315,20)
21120 CALL "ZZLIST",X3$,X4$,L1$,Y9$,Y2$,VAL$,X0,X2,Y8,X5$,X2$,X3,X7$
21140 IF LEN(%FTS_VAL$)=36 THEN VAL$=%FTS_VAL$(11)
21145 GOSUB 6400
21150 X0=HLD_X0
21195 RETURN 
21200 TEST_CONTRACT:! [SSP-200893]-added routine
21210 TMP_CUSTOMER$=A$(6,10),TMP_CONTRACT$=A$(315,20),TMP_CONTRACT_DATE$=A$(335,6)
21220 REQ_CONTRACT$=H$(129,1),CONTRACT_NUM$=A$(315,20),CUST_DIV$=A$(6,2),CUST_CODE$=A$(8,8),CONTRACT_DATE$=A$(335,6)
21230 GOSUB VALIDATE_CONTRACT_NUM
21280 IF VALID_CONTRACT<>0 THEN GOSUB INVALID_CONTRACT_NUM
21295 RETURN 
25000 VALIDATE_CONTRACT_NUM:! [200893]-added routine
25010 CONTRACT_NUM$=PAD(CONTRACT_NUM$,20)
25050 IF REQ_CONTRACT$="R" THEN {! 25300
25080 TMP_CUSTOMER$=CUST_DIV$+CUST_CODE$,TMP_CONTRACT$=PAD(CONTRACT_NUM$,20); TMP_CONTRACT_DATE$=PAD(CONTRACT_DATE$,6)
25085 NEW_OE_FLAG$=%NEW_RE_FLAG$
25100 CALL "FM2CON;VALIDATE_CONTRACT_NUM",FTS_LFN,TMP_CUSTOMER$,TMP_CONTRACT$,TMP_CONTRACT_DATE$,HLD_CONTRACT$,NEW_OE_FLAG$,MSG_TEXT$,X3$(21,6),VALID_CONTRACT ! [SSP-215144]-changed CONTRC to FM2CON
25102 IF VALID_CONTRACT<0 THEN GOSUB INVALID_CONTRACT_NUM; IF NEW_OE_FLAG$="Y" THEN CONTRACT_NUM$=HLD_CONTRACT$ ELSE CONTRACT_NUM$=""
25110 IF VALID_CONTRACT>0 THEN {! duplicate contracts
25120 GOSUB QUERY_FTS; GOSUB 6400
25130 IF LEN(STP(VAL$))<>26 THEN {! 3899
25140 VALID_CONTRACT=-1
25150  } ELSE {! 3860
25160 TMP_CUSTOMER$=CUST_DIV$+CUST_CODE$,TMP_CONTRACT$=VAL$(1,20),TMP_CONTRACT_DATE$=VAL$(21,6)
25180 CALL "FM2CON;VALIDATE_CONTRACT_NUM",FTS_LFN,TMP_CUSTOMER$,TMP_CONTRACT$,TMP_CONTRACT_DATE$,HLD_CONTRACT$,NEW_OE_FLAG$,MSG_TEXT$,%X3$(21,6),VALID_CONTRACT ! [SSP-215144]-changed CONTRC to FM2CON
25190 IF VALID_CONTRACT<0 THEN GOSUB INVALID_CONTRACT_NUM; IF NEW_OE_FLAG$="Y" THEN CONTRACT_NUM$=HLD_CONTRACT$ ELSE CONTRACT_NUM$=""
25195  }
25197  } ! 25110
25200 VAL_CONTRACT_DET:
25205 IF VALID_CONTRACT=0 THEN {! contract on file - now verify date, user
25210 CALL "FM2CON;VALIDATE_CONTRACT_DATE",FTS_LFN,TMP_CUSTOMER$,TMP_CONTRACT$,TMP_CONTRACT_DATE$,%X3$(21,6),VALID_CONTRACT,MSG_TEXT$ ! [SSP-215144]-changed CONTRC to FM2CON
25215 IF VALID_CONTRACT<0 THEN GOSUB INVALID_CONTRACT_NUM; IF NEW_OE_FLAG$="Y" THEN CONTRACT_NUM$=HLD_CONTRACT$ ELSE CONTRACT_NUM$=""
25216 IF VALID_CONTRACT<0 THEN GOTO *RETURN ! [SSP-212325]
25220 IF VALID_CONTRACT=0 THEN CALL "FM2CON;VALIDATE_CONTRACT_USER",FTS_LFN,TMP_CUSTOMER$,TMP_CONTRACT$,TMP_CONTRACT_DATE$,%X3$(40,3),VALID_CONTRACT,MSG_TEXT$ ! [SSP-215144]-changed CONTRC to FM2CON
25225 IF VALID_CONTRACT<0 THEN GOSUB INVALID_CONTRACT_NUM; IF NEW_OE_FLAG$="Y" THEN CONTRACT_NUM$=HLD_CONTRACT$ ELSE CONTRACT_NUM$=""
25230 IF VALID_CONTRACT=0 THEN CONTRACT_NUM$=TMP_CONTRACT$,CONTRACT_DATE$=TMP_CONTRACT_DATE$,HLD_CONTRACT$=TMP_CONTRACT$
25285  } ! 25200
25300  } ! 25050
25390 RETURN 
25398 ! 
25399 ! 
38000 MULTI_COMM_KEY:! SSP 225300
38005 ORDER$=A$(118,8),CUST_DIV$=A$(6,2),CUST_CODE$=A$(8,8)
38010 SC_TYPE$="O",SC_KEY1$=ORDER$,SC_KEY2$=CUST_DIV$+CUST_CODE$,SC_LINE$="000"
38011 SC_KEY$=SC_TYPE$+SC_KEY1$+SC_KEY2$+SC_LINE$ ! SSP 225300
38012 RETURN ! RETURN
38015 MULTI_COMM_SETUP:! SSP 225300
38020 DIM MCCDE$[5]; DIM MCSPLT[5],MCOMM$[10](5," ") ! SALESMAN CODES  SALESMAN SPLIT !SSP 225300
38022 IF STP(A$(93,4),2)<>"" AND A[1]=100 THEN MCCDE$[1]=A$(93,4),MCSPLT[1]=A[1]; GOTO 38050 ! SSP 225300
38030 MCCDE$[1]=A$(93,4),MCCDE$[2]=A$(102,4),MCCDE$[3]=A$(106,4),MCCDE$[4]=A$(110,4),MCCDE$[5]=A$(114,4)
38040 MCSPLT[1]=A[1],MCSPLT[2]=A[2],MCSPLT[3]=A[3],MCSPLT[4]=A[4],MCSPLT[5]=A[5]
38050 FOR SLP=1 TO 5; IF STP(MCCDE$[SLP],2)<>"" AND MCSPLT[SLP]>0 THEN MCOMM$[SLP]=A$(97,5); END_IF ; NEXT SLP
38100 RETURN 
39000 DEFAULT_HEADER_SETUP:! SSP 225300
39020 GOSUB MULTI_COMM_KEY; GOSUB MULTI_COMM_SETUP ! SSP 225300
39030 DETC$=""; CALL "ARGSCM;DEFAULT_HEADER_SETUP",SC_TYPE$,SC_KEY1$,SC_KEY2$,SC_LINE$,MCCDE${ALL},MCSPLT{ALL},MCOMM${ALL},SC_KEY2$,DETC$,"","" ! SSP 225300
39040 IF DETC$="Y" THEN MSGBOX "Existing Detail Lines have been modified for default Commission Codes - please review!",MSG("WARNING") ! SSP 225300
39050 RETURN 
56000 REM "191822-Work order to allow sales reps to only see their own        
56002 REM "193458-Customers not printing ONACCTS on the open invoice          
56003 REM "197884-Problem in pulling repeat orders. URGENT!                   
56004 REM " 200110-System is not pulling the correct frt markup table
56005 REM "210352-Notepad disappears in order history
56006 REM "200893-Create New Contract number field in order processing        
56008 REM "212325-follow up issues to contract work order for vanguard        
56010 REM "215144-program CONTRC from ssp 212325 needs to be renamed to an    
56012 REM "212768-Add Blanket PO feature to work with the Contract feature.
56014 REM "245048-Order entry allows for the entry of an invalid date, this   
56015 REM "248027-I am able to create an order number in 1 division for a     
56016 REM "255959-Field in Order Header for Summary Bill Y/N which will carry 
56017 REM "273933-Ref: 273918 Summary Bill question not working properly if   
56018 REM "274987-Appl Security by Operator; Restrict display/access to sls   
56019 REM "282394-FMGODA - Order header will allow entry of a lower case      
56020 REM "293239-CC Vault; ARZ needs expansion, add billing address, change  
