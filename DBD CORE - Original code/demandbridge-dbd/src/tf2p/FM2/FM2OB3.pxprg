0010 REM "Sales lines 3200-3899 <FM2OB3>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 02/01/18 - 13.641388 - jvv - SSP# 289210
0037 REM "289210-MultiFinders Fee feature is not looking at the Product Code 
0040 REM "Copyright 2018 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 X0$="FM2OB3"
0100 SETERR 9000
0105 GOSUB CHECK_MFF ! SSP 276772
0110 IF L0=1 THEN L0=0; GOTO 5000
0300 REM "IOLISTS
0351 IOLIST E1$
0370 IOLIST G$
0390 IOLIST I$,I[0],I[1],I[2]
0410 IOLIST S5$,S[0],S[1]
0420 IOLIST T5$,T[0],T[1]
1500 IF X0>=39 THEN X0=99
1700 REM 
1710 GOTO 2040
2000 REM "DATA SEQ
2020 X$="",C0=ABS(C0),X0=X0+1; IF C0=2 THEN IF X0>0 THEN X0=X0-2
2025 IF INT(C0)=3 THEN GOSUB 7300 ELSE IF C0>3 OR X0<0 THEN X0=999; GOTO 9900
2030 IF MFF_PARM THEN IF X0<=24 THEN GOTO 9900 ELSE ON X0-25 GOTO 2100,3250,3850,3500,3900,3950,2250,4300,3400,3750,4500,4200,4250,9800 ! SSP 276772
2040 IF X0<=24 THEN GOTO 9900 ELSE ON X0-25 GOTO 2100,3250,3850,3500,3900,3950,2250,4300,3400,3750,3650,3700,3800,4200,4250,9800
2100 REM "Fixed price?
2105 J$="YN",X$="N=keep same Gross Profit %"
2106 IF MID(P3$,149,1)="Y" AND POS(" "<>MID(C$,291,20))<>0 THEN J$=J$+"R",X$=X$+" R=Recompute with Feature Driven Pricing"
2110 CALL "ZZENTR","SRU",A{ALL},A$,X4$,X3$,77,14,4,1,C0,"","{3"+X$,J$,"FM2ODB58","","",""
2140 GOTO 2020
2250 REM "Special shipping?
2255 IF A[0]=0 THEN GOTO 2020
2256 IF RESULT$="Y" AND POS(MID(I$,118,1)="USC")<>0 THEN GOTO 2020; REM " IF OFFICE SUPPLY SYSTEM AND UNITED STATIONERS ITEM, DON'T ALLOW SPECIAL SHIPPING
2260 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,77,15,18,1,C0,"","{3"+X$,"","FM2ODB10","","",""
2270 IF MID(A$,18,1)<>"Y" THEN IF POS(MID(B$,54,1)="BS")>0 AND POS(MID(A$,155,1)="IC ")>0 THEN CALL "ZZPROM",".4",X3$,0,"Line requires special shipping for Order Type: "+B$(54,1),"","",0; A$(18,1)="Y"; GOTO 2260
2290 GOTO 2020
2528 CLOSE (14); OPEN (14,ERR=3531)"ZF5"+X3$(9,3)
3250 REM "Selling extension
3255 GOTO 2020
3260 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,44,15,6,822,C0,M0$,"{3"+X$,"","FM2ODB50","","",""
3290 GOTO 2020
3400 REM "Commission code
3405 IF MID(S6$,33,1)="Y" THEN GOTO 2020; REM "security - SSP# 150788
3406 IF MID(S6$,84,1)="Y" THEN GOTO 2020; REM "security - SSP# 150788
3408 IF %MSLC THEN IF TCB(88)=0 THEN GOTO 2020 ELSE GOTO 3442 ! SSP 225300
3410 CALL "ZZENTR","SZU",A{ALL},A$,X4$,X3$,17,17,128,5,C0,"","{3"+X$,"","FM2ODB56","AR4","AR2MDA",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3410,3411 ! SSP#232303
3415 IF POS(" "<>MID(A$,128,5))=0 THEN GOTO 3440
3420 FIND (Z[7],KEY=A$(128,5),DOM=3410)IOL=0370
3440 GOTO 2020
3442 CALL "ZZPROM","MS",X3$,Z,"","","",0; ON Z GOTO 2020,3444
3444 PERFORM "FM2ODB;MULTI_COMM_KEY" ! SSP 225300
3446 CALL "ARGSCM",X3$,X4$,SC_KEY$,DF_COMM$; A$(128,5)=DF_COMM$ ! SSP225300
3448 GOTO 2020 ! SSP 225300
3500 REM "Number of labels
3505 IF MID(D$,22,1)="N" THEN GOTO 2020
3506 X9$="FORMATCL"
3507 IF MID(A$,155,1)="S" AND C0<>2 THEN GOTO 3540
3510 PRINT @(31,15),A$(1,1); CALL "ZZENTR","N&",A{ALL},A$,X4$,X3$,27,15,9,300,C0,"##0","{3"+X$,"","FM2ODB60","","",""
3515 IF MID(P3$,169,1)<>"Y" OR A[9]=0 THEN GOTO 3535
3517 B9=0; REM "CALL "BC2VER",ERR=03518,"","",""; LET B9=1; REM "B9=1 MEANS USE EXTENDED BARCODES
3518 IF B9=1 THEN B9$="ZF5",X9$=X9$+"  " ELSE B9$="FFA"
3520 X$="Enter the carton label flexible format code to use"
3525 CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,31,15,1,1,C0,"","{3"+X$,X9$,"FM2ODB90",B9$,"",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3525,3526
3526 IF B9=0 THEN GOTO 3530
3527 CLOSE (14); OPEN (14,ERR=3528)"ZF5"+X3$(9,3); GOTO 3530
3528 CLOSE (14); OPEN (14,ERR=3529)"ZF5"; GOTO 3530
3530 IF MID(A$,1,1)<>" " THEN IF B9=1 THEN FIND (14,KEY=X9$+A$(1,1),DOM=3525) ELSE FIND (Z[13],KEY=X9$+A$(1,1),DOM=3525)
3535 A0=A[0]; REM 'RESET A0 SO # OF CARTON LABELS NOT CHANGED UNTIL QTY CHANGES
3540 GOTO 4000
3650 REM "IF A$(135,1)="A" THEN GOTO 2020; REM SSP# 132459
3655 X$="Finder's fee: S=sales, G=gross profit, C=cost, F=fixed amt, Blank=none, A=Adjusted GP"; REM : SSP# 141602 - ALLOW ENTRY
3660 CALL "ZZENTR","SURX",A{ALL},A$,X4$,X3$,56,17,135,1,C0,"","{3"+X$," SGCFA","FM2ODB66","","",""; REM " SSP# 141602 - ALLOW ENTRY
3665 IF C0<0 THEN GOTO 2020
3670 REM "add DISPLAY
3690 GOTO 2020
3700 REM "Finder's fee rate
3705 REM "IF MID(A$,135,1)=" " OR MID(A$,135,1)="A" THEN GOTO 2020; REM " SSP# 132459
3710 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,66,17,11,420,C0,M5$(2),"{3"+X$,"","FM2ODB68","","",""
3740 GOTO 2020
3750 REM "Is line taxable?
3758 X$="For non-exempt customers, Y=yes, N=no, C=yes, but at 1/2 rate"
3760 CALL "ZZENTR","SRU",A{ALL},A$,X4$,X3$,42,17,136,1,C0,"","{3"+X$," YNC","FM2ODB70","","",""
3790 GOTO 2020
3800 REM "Finder's vendor code
3805 IF POS(MID(A$,135,1)=" A")>0 THEN GOTO 2020; REM " SSP# 132459
3810 CALL "ZZENTR","AXU",A{ALL},A$,X4$,X3$,56,18,137,10,C0,"A/P","{3"+X$,"","FM2ODB72","AP4","AP2MAB",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3810,3811
3820 FIND (Z[5],KEY=A$(137,10),DOM=3810)IOL=0351
3825 PRINT @(67,18),E1$(11,13),
3827 IF MID(E1$,246,1)="I" THEN CALL "ZZPROM",".4",X3$,0,"This vendor is inactive, please use another vendor.","","",0; GOTO 3810
3840 GOTO 2020
3850 REM "Carton pack
3855 IF MID(A$,155,1)="S" AND C0<>2 THEN GOTO 3840
3860 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,12,15,12,501,C0,M2$,"{3"+X$,"","FM2ODB66","","",""
3870 IF C0>0 THEN CALL "FM2OB4",A{ALL},S{ALL},T{ALL},M0$,M6$,M2$,M3$,S5$,T5$,D$(22,1),A$,I$
3890 GOTO 2020
3900 REM "List Price
3902 IF MID(P3$,155,1)<>"Y" OR MID(A$,10,1)="9" THEN GOTO 2020
3906 X$="List Price"
3910 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,33,15,22,M6[0],C0,M6$,"{3"+X$,"","FM2OB302","","",""
3920 IF C0>0 THEN GOSUB 7900
3940 GOTO 2020
3950 REM "Line item Disc%
3952 IF MID(P3$,155,1)<>"Y" OR MID(A$,10,1)="9" THEN GOTO 2020
3956 X$="Line Item Disc% that applies to List Price"
3960 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,51,15,23,320,C0,M3$,"{3"+X$,"","FM2ODB68","","",""
3970 IF C0>0 THEN GOSUB 7900
3990 GOTO 2020
4000 REM "2ND set of carton labels
4001 REM "3525,3530,4060 cwj 2/19/98 SSP#085719 - all lines here were modified to place two blanks after the 'F1' prefix code in 'ZZENTR' calls.  This change made the 'F1' begin working.
4002 IF MID(P3$,252,1)<>"Y" THEN GOTO 4090
4005 X$="Enter number of labels for 2nd Carton Label"; PRINT @(31,15),A$(220,1),
4010 CALL "ZZENTR","N&",A{ALL},A$,X4$,X3$,27,15,24,300,C0,"##0","{3"+X$,"","FM2ODB70","","",""
4020 IF A[24]=0 THEN GOTO 4090
4055 X$="Enter the 2nd carton label flexible format code to use"
4060 CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,31,15,220,1,C0,"","{3"+X$,X9$,"FM2ODB72",B9$,"",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 4060,4061
4070 IF MID(A$,220,1)<>" " THEN IF B9=1 THEN FIND (14,KEY=X9$+A$(220,1),DOM=4060) ELSE FIND (Z[13],KEY=X9$+A$(220,1),DOM=4060)
4090 GOTO 2020
4200 REM "Cost code
4205 IF MID(P3$,182,1)<>"Y" THEN GOTO 2020
4207 FIND (Z[4],KEY="D"+B$(6,10),DOM=2020)O2$; IF LEN(O2$)<235 OR MID(O2$,235,1)=" " THEN GOTO 2020
4210 CALL "ZZENTR","AXU",A{ALL},A$,X4$,X3$,17,18,205,9,C0,"FM"+O2$(235,1),"{3"+X$,"","FM2ODB84","","",""
4240 GOTO 2020
4250 IF P3$(310,1)<>"Y" THEN GOTO 4290; REM " RC Number ssp 180100   
4251 IF FN%HAS_MODULE("EC")<>1 THEN GOTO 4290; REM OR POS(A$(155,1)="SM")<>0 THEN GOTO 4290
4252 FIND (Z[4],KEY="D"+B$(6,10),DOM=2020)O2$; REM "IF O2$(62,1)<>"Y" THEN GOTO 4290
4253 DIM RC$(20); CLOSE (14); OPEN (14,ERR=4290)"EDW"+X3$(9,3)
4254 READ (14,KEY=A$(147,8)+A$(6,3),DOM=4255)EDW$; RC$(1,20)=EDW$(12,20)
4255 X$="This is a required entry for this customer"
4260 CALL "ZZENTR","S",A{ALL},RC$,X4$,X3$,28,18,1,20,C0,"","{3"+X$,"","EC3M3E02","","",""
4270 IF RC$(1,20)=DIM(20) AND O2$(62,1)="Y" THEN GOTO 4255
4290 GOTO 2020
4300 ! Number Storage Month
4305 IF A$(9,1)=" " THEN GOTO 4340
4310 CALL "ZZENTR","N&",A{ALL},A$,X4$,X3$,36,16,26,200,C0,"##","{3"+X$,"","FM2ODB60","","",""
4340 GOTO 2020
4500 REM "Multiple Finders Fee Routine ; !SSP 276772
4510 CALL "ZZPROM","MF",X3$,Z,"","","",0; ON Z GOTO 2020,4520
4525 MF_KEY$=A$(147,8)+A$(6,3)
4530 CALL "FMGFV5",X3$,X4$,MF_KEY$ ! SSP 225300
4540 GOTO 2020 ! SSP 225300
4550 ! 
5000 REM "Input special charge or non-stock type
5004 IF MID(A$,155,1)="N" THEN GOTO 5100
5005 A9$=A$(19,10)
5010 CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,1,7,19,10,C0,"","{3"+X$,"X","FM2ODB53","FMPX","FS2MCA",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 5010,5011
5020 IF MID(A$,19,10)=A9$ AND POS(" "<>A9$)<>0 OR (C0<=-2 AND POS(" "<>MID(A$,19,10))=0) THEN GOTO 5090
5030 FIND (Z[4],KEY="X"+A$(19,10),DOM=5010)IOL=0390
5035 A$(50,40)=I$(12,40),A$(29,3)=I$(52,3),A$(120,8)=I$(55,4)+I$(55,4),A[5]=I[0],A[2]=I[0],A[22]=I[1],A[4]=A[22]-A[22]*A[23]*.01,A[1]=I[2]; IF MID(I$,61,1)="Y" THEN A[6]=A[4],A[3]=A[1],A[4]=0,A[1]=0
5036 GOSUB 7700
5038 IF MFF_PARM THEN XX$=B$(6,10)+A$(29,3)+A$(161,10)+A$(19,10); CALL "FS2MFF",X3$,X4$,XX$,XX,A$(147,8)+A$(6,3) ! SSP 276772 SSP 289210
5040 CALL "FM2OB1",X3$,X4$,6200,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
5045 IF MID(ARS$,122,1)="Y" THEN FIND (Z[14],KEY=B$(93,4)+A$(29,3),DOM=5046)ASQ$; A$(128,5)=ASQ$(8,5); PRINT @(17,17),A$(128,5),; REM "WO89451
5046 DIM RC$(20); CLOSE (14); OPEN (14,ERR=5050)"EDW"+X3$(9,3)
5047 DIM RC$(20); READ (14,KEY=A$(147,8)+A$(6,3),DOM=5049)EDW$; RC$(1,20)=EDW$(12,20)
5049 PRINT @(28,18),RC$,; REM " SSP 180100
5050 C0=1
5090 L0=5; RUN "FM2OB0"
5100 REM "Input non-stock type
5105 IF MID(B$,43,1)="Y" THEN IF POS(" "<>MID(A$,19,10))>0 THEN GOTO 5036
5110 CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,1,7,19,10,C0,"","{3"+X$,"","FM2ODB55","","",""
5114 IF ABS(C0)=2 THEN GOTO 5090
5115 IF ABS(C0)>1 THEN GOTO 5036
5120 IF MID(B$,43,1)="Y" THEN IF POS(" "<>MID(A$,19,10))=0 THEN GOTO 5110 ELSE GOTO 5600
5130 IF MID(A$,120,4)="    " THEN IF MID(B$,43,1)="Y" THEN A$(120,4)="M" ELSE IF MID(P3$,260,1)="Y" THEN A$(120,4)="M" ELSE A$(120,4)="EACH"
5131 IF MID(A$,124,4)="    " THEN IF MID(B$,43,1)="Y" THEN A$(124,4)="M" ELSE IF MID(P3$,260,1)="Y" THEN A$(124,4)="M" ELSE A$(124,4)="EACH"
5140 GOTO 5036
5600 REM "CHECK FW0
5610 CLOSE (14); OPEN (14)"FW0"+X3$(9,3)
5620 Q3$=""; FIND (14,DOM=5645,KEY=B$(6,10)+A$(161,10)+A$(19,10)+A$(147,8))Q3$
5630 Q3$=Q3$(96,3); IF Q3$=MID(A$,6,3) OR Q3$="   " THEN GOTO 5645
5635 CALL "ZZPROM",".4",X3$,0,"Item is already on this order, line "+Q3$,"","",0; CLOSE (14); GOTO 5110
5645 CLOSE (14); GOTO 5121
6215 DIM C0$(50)
6220 IF MID(A$,155,1)="C" THEN FIND (Z[8],KEY=A$(161,10),DOM=6221)C0$ ELSE GOTO 6230
6221 PRINT @(0,5),'CL','SB',"Cust. no:",@(25,5),"Name:",'SF',
6222 CALL "ZZDISP","A",A$(161,10),"A/R",X3$,"","",10,5,X4$
6223 PRINT @(31,5),C0$(11,35),
6230 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 CALL "FM2OB1",X3$,X4$,6400,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
6425 GOSUB 6200
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6460 CALL "FM2OB1",X3$,X4$,6450,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
6490 RETURN 
7300 REM 
7310 ON FPT(C0)*10 GOTO 7390,7325,7330,7390
7325 IF V8$="" THEN X0=X0+4; GOTO 7390 ELSE X0=NUM(V8$(POS(STR(X0:"00")<=V8$,2),2)); GOTO 7390
7330 IF V8$="" THEN X0=X0-6; GOTO 7335 ELSE X0=POS(STR(X0-1:"00")<=V8$,2)-2; IF X0<0 THEN X0=0; GOTO 7390 ELSE X0=NUM(V8$(X0,2)); GOTO 7390
7335 IF X0<0 THEN X0=0; GOTO 7390
7390 C0=3; RETURN 
7700 REM "Set U/M defaults
7722 FIND (Z[13],KEY="U/M"+A$(124,4),DOM=7723)IOL=0410
7723 IF MID(S5$,20,1)<>"Y" THEN S[2]=A[5] ELSE S[2]=S[1]
7724 FIND (Z[13],KEY="U/M"+A$(120,4),DOM=7725)IOL=0420
7725 IF MID(T5$,20,1)<>"Y" THEN T[2]=A[2] ELSE T[2]=T[1]
7726 IF S[2]=0 THEN S[2]=1
7727 IF T[2]=0 THEN T[2]=1
7740 RETURN 
7900 REM 
7905 IF MID(A$,155,1)="S" AND MID(I$,61,1)="Y" THEN A[6]=A[22]-A[22]*A[23]*.01 ELSE A[4]=A[22]-A[22]*A[23]*.01
7910 CALL "FM2OB4",A{ALL},S{ALL},T{ALL},M0$,M6$,M2$,M3$,S5$,T5$,D$(22,1),A$,I$
7945 RETURN 
8900 REM "FNS
8915 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF MID(X3$,47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9515 IF C8=2 THEN IF MID(A$,155,1)="N" THEN GOTO 5110 ELSE GOTO 5010
9520 ON C9 GOTO 1140,2040
9700 REM 
9710 GOTO 9900
9800 REM "TOP END
9820 X0=999
9900 REM "END PROGRAM
9940 SETESC 9350
9945 L0=2
9950 RUN "FM2OB0"
9999 END 
10000 CHECK_MFF:! SSP 276772
10005 MFF_PARM=0
10010 CHL=UNT; OPEN (CHL,ERR=END_CHECK_MFF)"ZZPARM"
10020 FIND (CHL,KEY=X3$(9,3)+"F/M")OPPARM$
10030 MFF_PARM=0; IF MID(OPPARM$,337,1)="Y" THEN MFF_PARM=1 ! SSP 276772
10050 END_CHECK_MFF:
10060 CLOSE (CHL,ERR=*NEXT)
10070 RETURN 
10090 ! 
56000 REM "189995-Trying to enter an order with receiving department informati 
56001 ! "200130-Storage Expiration Date (SED) needs to be entered at the    
56002 REM "203458-Addition of S.P. Richards to TOPS module                    
56003 REM "276772-Multiple Finder's Fees per Customer/Item/Order Line.        
56004 REM "289210-MultiFinders Fee feature is not looking at the Product Code 
