0010 REM "Sales Order Entry II - Lines Ovrly 0 <FM2OB0>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 03/20/17 - 8.385 - tma - SSP# 285794
0037 REM "285794-Issue with Companion item set to sell as zero.  One item    
0040 REM "Copyright 2017 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0085 SETERR 9000
0090 X0$="FM2OB0"; GOSUB 6500
0095 L1=L0,L0=0; ON L1 GOTO 0100,2380,3280,2020,2040,2330
0125 IF A$(155,1)="M" THEN V8$="00031199" ELSE V8$="0006121825293799"
0295 DIM Z0$(80,X3$(235,1)),Q[47]; Z0$=MNM('GS')+Z0$+MNM('GE') ! WO273055
0298 FROM$="FM2OB0"
0299 CALL "ZZ2PRP","OS",RESULT$,DATE$
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20],C[21],C[22],C[23],C[24],C[25],C[26],C[27],C[28],C[29],C[30],C[31]
0340 IOLIST D$
0350 IOLIST E$,E[0],E[1],E[2]
0352 IOLIST E2$
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14],F[15],F[16],F[17],F[18],F[19],F[20],F[21],F[22],F[23],F[24]
0361 IOLIST L$,L0$,L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15],L[16],L[17],L[18],L[19],L[20],L[21],L[22],L[23],L[24],L[25],L[26],L[27],L[28],L[29],L[30],L[31],L[32],L[33],L[34],L[35],L[36]
0380 IOLIST H$
0390 IOLIST E2$
0391 IOLIST I$,I[0],I[1],I[2]
0410 IOLIST S5$,S[0],S[1]
0420 IOLIST T5$,T[0],T[1]
0430 IOLIST QT$
0440 IOLIST REORDPT$,F1[0],F1[1],F1[2],F1[3],F1[4],F1[5],F1[6],F1[7],F1[8],F1[9],F1[10],F1[11],F1[12],F1[13],F1[14],F1[15],F1[16],F1[17],F1[18],F1[19],F1[20],F1[21],F1[22],F1[23],F1[24],F1[25],F1[26],F1[27],F1[28],F1[29],F1[30],F1[31]
0445 IF B$(313,1)="Y" THEN P3$(280,1)="N"; REM 172433; turn off job cost   
0450 READ (Z[13],KEY=X3$(9,3)+"I/C",DOM=*NEXT)ICPARMS$; REM " SSP# 156908
0510 GOTO 1890
1805 IF N0<>0 THEN PRINT @(0,17),'CE',; GOSUB 8400; GOSUB 8430
1810 GOTO 9900
1890 DONT_MOD$="N"; IF A[4]>0 THEN IF P3$(254,1)="Y" THEN DONT_MOD$="Y"
1891 IF Z<0 THEN GOTO 2035 ELSE GOTO 2000
2010 C0=0,X0=-1,X1=1,C9=1
2020 X$="",C0=ABS(C0),X0=X0+1; IF C0=2 THEN IF X0>0 THEN X0=X0-2
2025 IF INT(C0)=3 THEN GOSUB 7300 ELSE IF C0>3 OR X0<0 THEN GOTO 1800
2040 ON X0 GOTO 3900,2200,2150,2800,2100,3950,2300,2350,2350,2350,2350,2350,2350,2350,2350,2350,3150,3200,2850,3100,3350,2950,3000,2900,3050,3250,3250,3250,3250,3250,3250,3250,3250,3250,3250,3250,3250,3250,3250,3250,3250,3250,1800
2103 IF POS(" "<>A$(19,10))<>0 OR (POS(" "<>A$(50,40))<>0 AND A$(155,1)="M") THEN GOTO 2020
2104 REM "IF A$(155,1)<>"M" THEN IF POS(" "<>A$(19,10))<>0 THEN GOTO 02020
2105 IF A$(14,1)="Y" THEN GOTO 2126
2106 IF A$(155,1)=" " AND S6$(43,1)<>"Y" THEN A$(155,1)="I"; IF P3$(280,1)="Y" AND B$(54,1)="B" AND A$(6,3)<>"001" THEN A$(155,1)="S"
2108 X9$=A$(155,1),X$="I=inventory, C=customer inventory, M=message, S=special charge, N=other"; IF POS(B$(54,1)="BS")=0 AND A$(9,1)<>" " THEN X$=X$(1,12)+X$(35)
2109 IF P3$(280,1)="Y" AND B$(54,1)="B" AND A$(6,3)<>"001" THEN X$=X$(36,27),TYPES$="MS" ELSE TYPES$="ICNMS "; REM "WO111482
2110 CALL "ZZENTR","SUR",A{ALL},A$,X4$,X3$,77,4,155,1,C0,"","{3"+X$,TYPES$,"FM2ODB04","","",""; IF S6$(43,1)="Y" AND A$(155,1)="I" AND A$(9,1)<>" " THEN CALL "ZZPROM",".4",X3$,0,"Access denied!  You may not enter P/O for a stock item.","","",0; A$(155,1)=""; GOTO 2108
2111 IF A$(155,1)=" " THEN IF ABS(C0)=2 OR ABS(C0)=4 THEN GOTO 2020 ELSE GOTO 2108
2112 IF A$(9,1)=" " AND S6$(56,1)="Y" AND POS(A$(155,1)="CI")>0 THEN CALL "ZZPROM",".4",X3$,0,"Access denied. You must use O/P-D1 to release warehouse items","","",0; A$(155,1)=""; GOTO 2108
2115 IF A$(155,1)<>"C" THEN A$(161,10)=""; PRINT @(0,5),Z0$, ELSE IF A$(9,1)<>" " AND POS(B$(54,1)="BS")=0 THEN GOTO 2110
2116 IF X9$<>"S" AND A$(155,1)="S" THEN DIM I$(61),I[40] ELSE DIM I$(187),I[40] ! SSP#236153
2120 IF A$(155,1)="M" THEN V8$="00031199",A[23]=0; PRINT @(1,7),A$(19,10),
2124 GOTO 2140
2125 REM IF A$(155,1)="C" AND ABS(C0)<>2 THEN GOTO 02800 ELSE GOTO 02140
2128 X$="LINE TYPE: N=new, E=exact repeat, C=copy change, S=spec change, B=both changed"
2129 IF POS(X3$(9,3)="500449",3)<>0 THEN A$(5,1)="E"
2130 CALL "ZZENTR","SUR",A{ALL},A$,X4$,X3$,77,4,5,1,C0,"","{3"+X$,"NECSB","FM2ODB04","","",""
2140 IF C0<>2 THEN GOSUB 7700
2145 GOTO 2020
2153 IF POS(" "<>A$(19,10))<>0 OR (POS(" "<>A$(50,40))<>0 AND A$(155,1)="M") OR A$(9,1)=" " OR (F0$="*" AND PO_FLAG$<>"Y") THEN GOTO 2020
2154 IF P3$(280,1)="Y" AND B$(54,1)="B" AND A$(6,3)<>"001" THEN A$(14,1)="N"; PRINT @(42,4),A$(14,1),; GOTO 2161; REM "WO111482, Inventory Costing feature, only allow custom item on line 001
2160 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,42,4,14,1,C0,"","{3"+X$,"","FM2ODB06","","",""
2170 IF A$(14,1)<>"Y" AND A$(155,1)<>"C" THEN A$(119,1)=""; PRINT @(62,4)," ", ELSE A$(155,1)=""
2175 IF P3$(251,1)="Y" THEN IF A$(9,1)<>" " AND A$(14,1)="Y" THEN A$(18,1)="Y"; PRINT @(77,15),A$(18,1),
2190 GOTO 2020
2203 IF POS(" "<>A$(19,10))<>0 THEN GOTO 2020
2204 IF B$(183,1)="Y" THEN GOTO 4100; REM "SSP98716
2205 IF POS(" "<>B$(23,5)+B$(3,3))=0 THEN GOTO 2020 ELSE Q$=B$(23,5)+B$(3,3)
2206 CALL "ZZDISP","AX",Q$,"O/P",X3$,Q9$,"",0,0,X4$
2207 X$="From master quote "+Q9$+" use line:"
2208 Q9=51+LEN(Q9$),Z$="FE5"; IF B$(52,1)="Y" THEN Z$="QSB"
2210 CALL "ZZENTR","ZX",A{ALL},A$,X4$,X3$,Q9,22,15,3,C0,"","{3"+X$,Q$,"FM2ODB08",Z$,"",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2210,2211
2211 IF A$(15,3)="000" THEN A$(15,3)="   "; GOTO 2240
2212 IF C0<0 THEN GOTO 2240 ELSE F8$=""
2215 X$=""; GOSUB 6500; IF X$="02210" THEN X$=""; GOTO 2207
2227 IF F$(99,1)<>"Y" THEN GOTO 2230
2228 IF A$(9,1)=" " THEN CALL "ZZPROM",".4",X3$,0,"Custom forms must be on a P/O, and no P/O code is specified","","",0; A$(15,3)="",X0=X0-1,C0=1; GOTO 2020
2229 IF F0$="*" THEN CALL "ZZPROM",".4",X3$,0,"Only one custom item per P/O, and this P/O has one already","","",0; A$(15,3)="",X0=X0-1; C0=1; GOTO 2020
2230 GOSUB 8200
2240 GOTO 2020
2302 IF A$(155,1)="M" THEN GOTO 2020
2304 IF POS(" "<>A$(19,10))<>0 THEN GOTO 2020; REM " 159361
2305 IF A$(14,1)="Y" THEN GOTO 2308
2306 IF POS(A$(155,1)="IC")<>0 THEN C8=1; GOTO 5450
2307 IF A$(155,1)="S" OR A$(155,1)="N" THEN C8=2,L0=1; RUN "FM2OB3"
2320 L2=1; RUN "FM2OB5"
2330 IF A$(155,1)<>"N" THEN GOTO 2335
2331 IF A[5]=0 THEN GOSUB 8000
2332 IF A[2]=0 THEN GOSUB 8050
2340 GOTO 2020
2360 RUN "FM2OB2"
2385 IF A$(155,1)="M" THEN IF ABS(C0)<=1 OR X0>10 THEN GOTO 1800
2390 GOTO 2040
2802 IF POS(" "<>A$(15,3))<>0 AND A$(14,1)="Y" THEN GOTO 2805
2803 IF POS(" "<>A$(19,10))<>0 THEN GOTO 2020 ! OR A$(14,1)<>"Y" THEN GOTO 2020 ! WO178277, OK to have specs if not custom
2805 IF A$(14,1)="Y" AND A$(119,1)=" " THEN A$(119,1)="Y" ELSE IF A$(14,1)<>"Y" AND A$(119,1)=" " THEN A$(119,1)="N" ! WO178277, now can be here if not custom so only preset to Y if custom is Y
2806 IF DUPOK$="Y" THEN GOSUB 4300; IF NOSPEC$="Y" THEN A$(119,1)="N"; PRINT @(62,4),"N"; GOTO 2020
2807 X$="Indicate specs to print; Y=full spec, C=comments only, N=no specsto print"
2810 CALL "ZZENTR","SRU",A{ALL},A$,X4$,X3$,62,4,119,1,C0,"","{3"+X$,"YNC","FM2ODB32","","",""
2840 GOTO 2020
2852 IF A$(155,1)="S" AND I$(61,1)="Y" THEN GOTO 2020
2853 IF POS(" "<>A$(15,3))<>0 OR C8=1 THEN PRICE_CLASS$=I$(109,3); GOSUB 8700
2854 IF P2$(44,1)="Y" AND A$(9,1)=" " AND POS(A$(155,1)="IC")<>0 AND I$(112,1)="Y" THEN A$(2,1)="Y" ! SSP225489, need to explicitly set the lotted order line flag to Y if this is a lotted release type line
2855 IF A[0]>=0 AND P2$(44,1)="Y" AND A$(9,1)=" " AND POS(A$(155,1)="IC")<>0 AND (A$(2,1)="Y" OR I$(112,1)="Y") AND P2$(52,1)<>"C" THEN GOSUB 8100; IF A[0]=0 THEN GOTO 2856 ELSE IF A[0]<>K[1] THEN A[10]=A[10]+(A[0]-K[1]); GOTO 2863 ELSE GOTO 2863
2857 DIM K[2]; K[1]=A[0],K[2]=A[4]
2858 IF S[2]<>0 THEN K[0]=A[0]/S[2]
2859 IF POS(" "<>C$(291,20))<>0 AND B$(49,2)<>"  " THEN X$="Pricing based on Estimate group: "+FNS$(C$(291,10))+" Features: "+FNS$(C$(301,10))
2860 CALL "ZZENTR","NX.",K{ALL},A$,X4$,X3$,19,13,0,822,C0,M0$,"{3"+X$,"","FM2ODB34","","",""; IF K[0]<0 AND S6$(42,1)="Y" AND A$(9,1)=" " THEN GOTO 2857
2861 QUANTITY=K[0]; IF POS(A$(155,1)="MS",1)=0 THEN IF RESULT$="Y" AND POS(I$(118,1)="USC",1)<>0 AND QUANTITY<>0 THEN CALL "OS2OBC",X3$,X4$,A$(19,10),I{ALL},B$,"FM2OB0",TOPS_PRICE,"",TOPS_COST,QUANTITY; IF A[4]<>TOPS_PRICE THEN A[4]=TOPS_PRICE; REM SSP 211032
2862 IF C0>0 THEN A[0]=K[0]*S[2]; IF A[0]<>K[1] THEN A[10]=A[10]+(A[0]-K[1])
2863 IF A[0]<0 AND P2$(44,1)="Y" AND A$(9,1)=" " AND POS(A$(155,1)="IC")<>0 AND (A$(2,1)="Y" OR I$(112,1)="Y") THEN GOSUB 4500; IF A[0]=0 THEN GOTO 2864 ELSE IF A[0]<>K[1] THEN A[10]=A[10]+(A[0]-K[1]),Q8=A(1)
2864 IF C0>0 THEN IF POS(" "<>A$(15,3))<>0 OR C8=1 THEN GOSUB 8550 ELSE IF A$(14,1)="Y" THEN IF POS(" "<>C$(291,20))<>0 THEN CALL "FM2OBA",X3$,A$,C$(291,20),A{ALL},Q8,Q9,M6[1]; A[1]=Q8; IF DONT_MOD$<>"Y" THEN A[4]=Q9
2865 IF A(7)<>0 AND A(0)<>0 THEN A[8]=A[0]-A[7] ELSE IF POS(A$(155,1)="IC")<>0 AND A$(9,1)=DIM(1) AND A$(2,1)="Y" AND A[0]<>0 THEN A[8]=A[0]-A[7]; IF A[8]<0 THEN A[8]=0 ! SSP#219021 SSP 223522, SSP225489 added check for lotted type line
2866 IF C0>0 THEN IF A$(14,1)<>"Y" AND POS(A$(155,1)="SN")=0 AND DONT_MOD$<>"Y" THEN A[4]=Q9; IF A$(9,1)<>" " OR A$(155,1)<>"I" THEN A[1]=Q8
2868 IF C0>0 THEN IF POS(" "<>A$(15,3))<>0 THEN A[1]=Q8; IF DONT_MOD$<>"Y" THEN A[4]=Q9
2869 IF TOPS_COST<>0 AND POS(I$(118,1)="USC",1)<>0 THEN A[1]=TOPS_COST; REM "SSP  211032
2870 IF B$(43,1)="Y" THEN IF C0>0 AND POS(A$(155,1)="ICN")>0 THEN GOSUB 8800
2872 GOSUB 7800; IF C0>0 THEN IF A$(155,1)="S" THEN GOSUB 7900; GOTO 2875 ELSE IF POS(A$(155,1)="IC")>0 OR A[22]=0 THEN A[22]=A[4]
2873 IF C0>0 THEN A[4]=A[4]-A[4]*A[23]*.01; GOSUB 7900
2875 IF ABS(INT(C0))>1 THEN IF A$(155,1)<>"C" OR A$(10,1)<>"9" THEN IF POS(" "<>A$(15,3))<>0 OR C8=1 THEN PRINT @(0,17),'CE',; GOSUB 8400; GOSUB 8430
2878 IF B$(43,1)="Y" THEN GOTO 2020
2880 IF A[0]>=0 AND POS(A$(155,1)="CI")>0 AND ABS(C0)<>2 AND A$(9,1)=" " AND T1<A[0] THEN IF S6$(41,1)<>"Y" THEN CALL "ZZPROM",".4",X3$,0,"|WARNING - The number of items ordered is more than the number available!","","",0 ELSE CALL "ZZPROM",".4",X3$,0,"Line will be deleted since qty ordered exeeds available qty for this location!!","","",0; L1=6500; RUN "FM2ODB"
2881 IF P3$(281,1)="B" AND MID(A$,9,1)=" " THEN GOSUB 8320; REM " SSP#202393
2885 IF P3$(243,1)="A" THEN IF A[0]>=0 AND POS(A$(155,1)="CI")>0 AND ABS(C0)<>2 AND A$(9,1)=" " AND T1<A[0] THEN CALL "FS2DAJ",X3$,X4$,A$(161,10)+A$(19,10),0,17
2886 IF A$(14,1)="Y" THEN CUST_ITEM$=B$(6,10) ELSE CUST_ITEM$=A$(161,10)
2887 CALL "UPDSP0;GET_PRICE",ERR=*NEXT,0,B$(6,10),CUST_ITEM$+A$(19,10),A[4],A[1],SP0_PRICE,SP0_PRICE_TYPE$,A[2],A[5]; IF SP0_PRICE_TYPE$<>"" THEN A[4]=SP0_PRICE,A$(235,3)=SP0_PRICE_TYPE$; PRINT @(44,13),A$(235,3); GOSUB 7900 ! 188067
2890 GOTO 2020
2902 IF B$(43,2)="YY" AND POS(A$(155,1)="INC")>0 THEN X$="Enter cost for Special Work"; GOTO 2905 ELSE IF A$(155,1)="N" THEN X$="Cost override allowed for non stock items"; GOTO 2905
2904 IF POS(A$(155,1)="IC")<>0 AND A$(9,1)=" " OR (A$(155,1)="S" AND I$(61,1)="Y") THEN GOTO 2020
2905 IF T5$(21,1)="Y" THEN A[1]=0; PRINT @(33,14),A[1]:M1$,; GOTO 2020
2906 IF A$(155,1)="C" AND A$(10,1)="9" THEN GOTO 2020
2910 PRECISION M6[1]; CALL "ZZENTR","NX&",A{ALL},A$,X4$,X3$,33,14,1,M6[0],C0,M6$,"{3"+X$,"","FM2ODB36","","",""; PRECISION 2
2930 IF C0>0 THEN GOSUB 7900
2935 IF B$(43,1)="Y" THEN IF ABS(C0)<>2 AND A[1]<A[15] THEN CALL "ZZPROM",".4",X3$,0,"WARNING - Unit cost is less than material cost!","","",0
2940 GOTO 2020
2955 T[3]=T[2]
2960 CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,7,14,120,4,C0,"","{3"+X$,"U/M","FM2ODB38","U/M","ZZ2MUA",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2960,2961
2970 FIND (Z[13],KEY="U/M"+A$(120,4),DOM=2960)IOL=0420
2975 GOSUB 8060
2980 IF C0>=0 THEN GOSUB 7525
2985 IF ABS(C0)<>2 THEN IF POS(" "<>A$(15,3))<>0 OR N0=1 THEN PRINT @(0,17),'CE',; GOSUB 8400; GOSUB 8430
2990 GOTO 2020
3002 IF T5$(20,1)="Y" THEN GOTO 3040
3003 T[4]=A[2]
3010 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,12,14,2,600,C0,"#####0","{3"+X$,"","FM2ODB40","","",""
3015 IF T5$(20,1)<>"Y" THEN T[2]=A[2] ELSE T[2]=T[1]
3020 IF T[2]<>T[3] THEN GOSUB 7525
3030 IF T[4]<>A[2] THEN GOSUB 7575
3035 IF C0>0 THEN GOSUB 7900
3040 GOTO 2020
3054 IF A$(155,1)="S" AND I$(61,1)="Y" THEN GOTO 3056
3055 IF T5$(21,1)<>"Y" THEN GOTO 2020
3060 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,44,14,3,822,C0,M0$,"{3"+X$,"","FM2ODB42","","",""
3070 IF C0>0 THEN GOSUB 7900
3090 GOTO 2020
3102 IF A[23]<>0 THEN GOTO 3130
3104 IF A$(155,1)="S" AND I$(61,1)="Y" THEN GOTO 2020
3105 IF S5$(21,1)="Y" THEN A[4]=0; PRINT @(33,13),A[4]:M1$,; GOTO 2020
3106 IF A$(155,1)="C" AND A$(10,1)="9" AND B$(43,1)<>"Y" THEN GOTO 3130
3108 X$="Enter a desired gp% using F2 key - F3 key to restore previous price"
3109 COMPARE_PRICE=A[4]
3110 PRECISION M6[1]; CALL "ZZENTR","NFX&",A{ALL},A$,X4$,X3$,33,13,4,M6[0],C0,M6$,"{3"+X$,"","FM2ODB44","","",""; PRECISION 2
3112 IF C0=11 THEN IF ABS(A[4])<100 AND A[3]<>0 THEN X=A[3]*100/(100-A[4]); CALL "FM2EXT",Z[13],1,A$(124,4),A[5],A[0],I,X,M6[1]; A[4]=I,C0=1 ELSE GOTO 3110
3113 IF C0=-12 THEN A[4]=K[2],C0=1
3115 IF ABS(C0)>10 THEN GOTO 3110
3120 IF C0>0 THEN GOSUB 7900
3130 REM IF ABS(C0)<>2 THEN IF POS(" "<>A$(15,3))<>0 OR N0=1 THEN PRINT @(0,17),'CE',; GOSUB 08400; GOSUB 08430
3135 IF COMPARE_PRICE<>A[4] THEN A$(235,3)="MAN" ! manual
3140 GOTO 2020
3155 S[3]=S[2]
3160 CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,7,13,124,4,C0,"","{3"+X$,"U/M","FM2ODB46","U/M","",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3160,3161
3170 FIND (Z[13],KEY="U/M"+A$(124,4),DOM=3160)IOL=0410
3175 GOSUB 8010
3180 IF C0>0 THEN GOSUB 7900
3185 IF POS(" "<>A$(120,4))=0 THEN A$(120,4)=A$(124,4); GOSUB 8050
3190 GOTO 2020
3202 IF MID(S5$,20,1)="Y" THEN GOTO 3240
3203 S[4]=A[5]
3210 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,12,13,5,600,C0,"#####0","{3"+X$,"","FM2ODB48","","",""
3215 IF MID(S5$,20,1)<>"Y" THEN S[2]=A[5] ELSE S[2]=S[1]
3220 IF S[2]<>S[3] THEN GOSUB 7500
3230 IF S[4]<>A[5] THEN GOSUB 7550
3235 IF C0>0 THEN GOSUB 7900
3240 GOTO 2020
3260 RUN "FM2OB3"
3290 GOTO 2040
3354 IF A$(155,1)="S" AND I$(61,1)="Y" THEN IF A[23]<>0 THEN GOTO 3375 ELSE GOTO 3356
3355 IF S5$(21,1)<>"Y" THEN GOTO 2020
3360 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,44,13,6,822,C0,M0$,"{3"+X$,"","FM2ODB42","","",""
3370 IF C0>0 THEN GOSUB 7900
3375 IF ABS(C0)<>2 AND A$(155,1)="S" THEN X0=X0+1
3390 GOTO 2020
3902 IF B$(43,1)="Y" THEN GOTO 2020
3903 IF POS(" "<>A$(19,10))<>0 OR (POS(" "<>A$(50,40))<>0 AND A$(155,1)="M") THEN GOTO 2020
3904 IF P6$="*" THEN GOTO 3930
3905 X$="If an associated P/O, enter P/O code 1-9 or A-Z to issue"
3910 CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,31,4,9,1,C0,"","{3"+X$,B$(118,8),"FM2ODB71","PO1","",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3910,3911
3920 IF POS(B$(54,1)="BS")>0 THEN IF A$(9,1)=" " THEN CALL "ZZPROM",".4",X3$,0,"P/O code required for Order Type: "+B$(54,1),"","",0; GOTO 3905
3930 IF A$(9,1)=" " THEN GOSUB 3945; GOTO 3940 ELSE IF A$(14,1)<>"N" THEN A$(14,1)="Y"
3931 IF A[26]=0 THEN IF MID(H$,524,2)<>DIM(2) THEN A[26]=NUM(MID(H$,524,2),ERR=*NEXT); PRINT @(36,16),STR(A[26]:"00"), ! WO264206, default number of storage months from cust parm. Copied print statement from FM2OB1, had to fix it first
3933 FOR I=1 TO 5; IF A$(155+I,1)="P" THEN A$(155+I,6-I)=A$(156+I,5-I); PRINT @(72,6),A$(156,5),; NEXT I ELSE NEXT I
3934 F0$=""; FIND (Z[12],KEY=A$(147,8)+A$(9,1),DOM=3940)P5$
3936 GOSUB 4000; IF PO_FLAG$="N" THEN GOTO 3905
3938 F0$="*"; GOSUB 3945; A$(90,14)=P5$(17,4)+P5$(7,10); READ (Z[5],KEY=A$(94,10),DOM=3939)IOL=0350
3940 GOTO 2020
3946 A$(14,1)="",A$(119,1)=""; PRINT @(42,4)," ",@(62,4)," ",
3947 RETURN 
3952 P8$="SI",X$="S=sales order thank you letter, I=invoice"
3954 IF POS("P"=P3$(214,5))>0 OR A$(155,1)="M" OR A$(9,1)=" " OR (A$(9,1)<>" " AND ABS(C0)=2) THEN IF B$(43,1)<>"Y" THEN P8$=P8$+"P",X$="P=packing list, "+X$
3957 IF Z9<=0 AND ABS(C0)<>2 AND POS(" "<>A$(156,5))=0 THEN IF POS(" "<>P3$(214,5))>0 THEN A$(156,5)=P3$(214,5) ELSE A$(156,5)=P8$
3958 IF ABS(C0)<>2 AND POS(A$(155,1)="MS")=0 THEN PRINT @(72,6),A$(156,5),; GOTO 2020
3960 CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,72,6,156,5,C0,"","{3"+X$,"","FM2ODB73","","",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3960,3961
3965 FOR I=1 TO 5
3966 IF POS(A$(155+I,1)=P8$+" ")=0 THEN EXITTO 3960
3967 NEXT I
3990 GOTO 2020
4000 REM "Check FS2 to see if custom item exists with this P/O code
4002 DUPOK$="Y"; IF B$(54,1)="B" AND P3$(280,1)="Y" THEN DUPOK$="N"
4005 FIRST_LINE_NO$="zzz",LINE_TYPE$=""; READ (Z[1],KEY=A1$(1,8),DOM=4006)
4010 READ (Z[1],END=4050)X$
4015 IF X$(147,8)<>A1$(1,8) THEN GOTO 4050
4020 IF X$(9,1)<>A$(9,1) THEN GOTO 4010 ELSE IF FIRST_LINE_NO$="zzz" THEN FIRST_LINE_NO$=X$(6,3)
4030 IF X$(155,1)=" " THEN LINE_TYPE$="CUSTOM"; GOTO 4050
4040 GOTO 4010
4050 IF DUPOK$="N" AND LINE_TYPE$="CUSTOM" AND A1$(9,3)<FIRST_LINE_NO$ THEN CALL "ZZPROM",".4",X3$,0,"P/O line# must be higher than "+FIRST_LINE_NO$+" which contains a custom item","","",0; PO_FLAG$="N"; GOTO 4090
4060 IF DUPOK$<>"Y" AND LINE_TYPE$="CUSTOM" AND A1$(9,3)>FIRST_LINE_NO$ THEN CALL "ZZPROM",".4",X3$,0,"P/O exists with a custom item on line# "+FIRST_LINE_NO$+" (Only 1 custom item per P/O)","","",0; PO_FLAG$="C"; GOTO 4090 ! 163810
4080 IF A1$(9,3)>FIRST_LINE_NO$ THEN PO_FLAG$="I" ELSE PO_FLAG$="Y"
4082 IF A1$(9,3)>FIRST_LINE_NO$ AND DUPOK$="Y" THEN PO_FLAG$="Y"
4090 RETURN 
4100 REM "Came here from 2200's, more than one RFQ per order, SSP98716
4105 IF B$(52,1)="Y" THEN Z$="QSA" ELSE Z$="FE5"
4107 X$="Master quote:"; DIM QUOTE$(8)
4110 CALL "ZZENTR","A",A{ALL},QUOTE$,X4$,X3$,47,22,1,8,C0,"O/P","{3"+X$,"","FM2OB002",Z$,"",""; IF ABS(C0)>4 THEN GOSUB 6400; CALL "ZZDISP","A",QUOTE$,"O/P",X3$,"","",51,22,X4$; ON C0 GOTO 4110,4111
4115 IF POS(" "<>QUOTE$)=0 OR QUOTE$=A$(221,8) THEN GOTO 4190
4117 IF B$(52,1)="Y" THEN Z$="06C PO6...  06O QSA...  " ELSE Z$="06C PO6...  06O FE5...  "
4118 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
4120 READ (Z[6],KEY=QUOTE$,DOM=4110)IOL=0430
4125 IF B$(6,10)=QT$(10,10) OR QT$(391,1)="P" THEN GOTO 4140
4130 CALL "ZZDISP","AX",QT$(10,10),"A/R",X3$,J8$,"",0,0,X4$
4132 J9$="Customer ("+J8$+") on the quote doesn't match customer you entered"
4135 CALL "ZZPROM",".4",X3$,0,J9$,"","",0
4140 IF POS(" "<>MID(QT$,455,8))=0 THEN GOTO 4150
4142 CALL "ZZDISP","AX",QT$(455,8),"O/P",X3$,J8$,"",0,0,X4$
4145 J9$="NOTE: Ordered previously on order# "+J8$+" on "+FND$(QT$(463,6))
4147 CALL "ZZPROM",".4",X3$,0,J9$,"","",0
4150 REM "LET B$(87,2)=QT$(176,2), B$(89,4)=QT$(188,4), B$(93,4)=QT$(6,4),WON'T BE BRING IN THIS INFORMATION
4155 IF B$(52,1)="Y" THEN Z$="06C QSA...  06O PO6...  " ELSE Z$="06C FE5...  06O PO6...  "
4156 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
4158 X$="Quote line:",Z$="FE5"; IF B$(52,1)="Y" THEN Z$="QSB"
4160 CALL "ZZENTR","ZX",A{ALL},A$,X4$,X3$,46,22,15,3,C0,"","{3"+X$,QUOTE$,"FM2OB004",Z$,"",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 4160,4161
4161 IF A$(15,3)="000" THEN A$(15,3)="   ",A$(221,8)=""; GOTO 4190
4162 IF C0<0 THEN GOTO 4190 ELSE F8$=""
4165 X$=""; GOSUB 6500; IF X$="2210" THEN X$=""; GOTO 4158
4167 IF F$(99,1)<>"Y" THEN GOTO 4175
4170 IF A$(9,1)=" " THEN CALL "ZZPROM",".4",X3$,0,"Custom forms must be on a P/O, and no P/O code is specified","","",0; A$(15,3)="",X0=X0-1,C0=1; GOTO 2020
4172 IF F0$="*" THEN CALL "ZZPROM",".4",X3$,0,"Only one custom item per P/O, and this P/O has one already","","",0; A$(15,3)="",X0=X0-1,C0=1; GOTO 2020
4175 GOSUB 8200
4190 A$(221,8)=QUOTE$
4195 GOTO 2020
4200 REM "Set unit cost into A(1) from total cost of lots C
4205 IF A$(10,1)="9" THEN GOTO 4245
4210 CALL "FM2EXT",Z[13],1,A$(120,4),A[2],Q0,U,C,M6[1]
4215 A[1]=U
4220 REM "If S1 is set, then set the unit price to S1, and C0 to 1 to cause display to be done.
4225 IF S1<>0 THEN C0=1; IF DONT_MOD$<>"Y" THEN A[4]=S1
4245 RETURN 
4300 REM 'check specs                          
4302 NOSPEC$=""
4305 READ (Z[1],KEY=A1$(1,8),DOM=*NEXT)
4310 READ (Z[1],END=4390)X$
4315 IF X$(147,8)<>A1$(1,8) THEN GOTO 4390
4320 IF X$(9,1)<>A$(9,1) THEN GOTO 4310
4325 IF X$(6,3)=A$(6,3) THEN GOTO 4310
4330 IF X$(119,1)="N" THEN GOTO 4310
4340 NOSPEC$="Y"
4390 RETURN 
4500 REM "Handle returns
4505 Q0$="ICN"+A$(147,8)+A$(6,3)
4510 Q1$=A$(161,10)+A$(19,10)+A$(10,4)+"      "+A$(94,10)+A$(90,4)
4515 PRINT @(0,3),'CE',
4520 CALL "IC2LAB",X3$,X4$,Q0$,Q1$
4525 C=0,C=NUM(Q1$,ERR=4526),A$(2,1)="Y"
4530 Q0=0,Q0=NUM(Q0$,ERR=4531)
4535 GOSUB 4200
4540 A[0]=-Q0
4545 IF A[0]<>K[1] THEN A[10]=A[10]+(A[0]-K[1])
4550 PRINT @(0,3),'CE',; N9=N0,N0=0; GOSUB 6000; GOSUB 6200; N0=N9
4595 RETURN 
5460 L2=3; RUN "FM2OB5"
6010 CALL "FM2OB1",X3$,X4$,6000,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
6190 RETURN 
6210 CALL "FM2OB1",X3$,X4$,6200,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
6390 RETURN 
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 CALL "FM2OB1",X3$,X4$,6400,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6460 CALL "FM2OB1",X3$,X4$,6450,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
6490 RETURN 
6500 REM 
6505 IF A$(15,3)="   " THEN GOTO 6590
6510 Z$="06C PO6...  12C PO1...  "; IF B$(52,1)="Y" THEN Z$=Z$+"06O QSB...  12O QSC...  " ELSE Z$=Z$+"06O FE6...  12O FE7...  "
6520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
6525 Q$=B$(23,5)+B$(3,3); IF B$(183,1)="Y" THEN Q$=QUOTE$
6530 FIND (Z[6],KEY=Q$+A$(15,3),DOM=6531)IOL=0360; GOTO 6540
6535 X$="02210"; GOTO 6550
6540 FIND (Z[12],KEY=Q$+A$(15,3),DOM=6541)IOL=0361
6550 IF B$(52,1)="Y" THEN Z$="06C QSB...  12C QSC...  " ELSE Z$="06C FE6...  12C FE7...  "
6560 Z$=Z$+"06O PO6...  12O PO1...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
6590 RETURN 
7310 ON FPT(C0)*10 GOTO 7390,7325,7330,7390
7325 IF V8$="" THEN X0=X0+4; GOTO 7390 ELSE X0=NUM(V8$(POS(STR(X0:"00")<=V8$,2),2)); GOTO 7390
7330 IF V8$="" THEN X0=X0-6; GOTO 7335 ELSE X0=POS(STR(X0-1:"00")<=V8$,2)-2; IF X0<0 THEN X0=0; GOTO 7390 ELSE X0=NUM(V8$(X0,2)); GOTO 7390
7335 IF X0<0 THEN X0=0; GOTO 7390
7390 C0=3; RETURN 
7510 IF S[2]=0 THEN S[2]=1; GOTO 7523
7520 PRINT @(19,13),A[0]/S[2]:M0$,
7524 RETURN 
7530 IF T[2]=0 THEN T[2]=1; GOTO 7548
7540 PRINT @(19,14),A[0]/T[2]:M0$,
7549 RETURN 
7560 IF S[4]<>0 THEN PRECISION M6[1]; A[4]=A[4]*A[5]/S[4]; PRECISION 2; PRINT @(33,13),A[4]:M6$,
7574 RETURN 
7580 IF T[4]<>0 THEN PRECISION M6[1]; A[1]=A[1]*A[2]/T[4]; PRECISION 2; PRINT @(33,14),A[1]:M6$,
7599 RETURN 
7610 IF B$(6,10)<>H$(1,10) THEN DIM H$(245); FIND (Z[8],KEY=B$(6,10),DOM=7611)IOL=0380
7615 CALL "FM2OB1",X3$,X4$,7600,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
7690 RETURN 
7700 REM "New line set comm code"
7705 IF A$(155,1)="M" THEN RETURN 
7715 C3$=A$(9,1)+A$(155,1)+X3$(9,3)+B$(97,5),CM3$=C3$
7720 CALL "AR2COM","DEFAULT",C3$,A{ALL},Z[13],0,0
7725 A$(128,5)=C3$ ! SSP 225300
7730 IF %MSLC THEN CMKEY$="O"+A$(147,8)+B$(6,10)+A$(6,3); CALL "AR2MCM","DEFAULT",CM3$,A{ALL},Z[13],0,0,CMKEY$,0 ! SSP 225300
7740 RETURN 
7750 REM "Defaults based on product code info
7755 FIND (Z[4],KEY="T"+A$(29,3),DOM=7756)IOL=0340
7760 IF D$(22,1)="N" THEN A[9]=0
7765 IF B$(86,1)<>"Y" THEN A$(136,1)="N"; ELSE IF A$(136,1)=" " THEN A$(136,1)="Y"
7770 ON POS(D$(23,1)="NC") GOTO 7785,7775,7780
7775 A$(136,1)="N"; GOTO 7785
7780 IF A$(136,1)="Y" THEN A$(136,1)="C"
7785 IF P3$(186,1)="Y" THEN IF POS(" "<>D$(38,5))>0 THEN A$(128,5)=D$(38,5)
7786 IF MID(I$,119,1)=" " THEN GOTO 7787 ELSE IF MID(I$,119,1)="E" THEN A$(136,1)="N" ELSE IF MID(I$,119,1)="C" THEN A$(136,1)="C" ELSE IF MID(I$,119,1)="T" THEN A$(136,1)="Y"; REM SSP 201823     
7795 RETURN 
7800 REM "Contract Price from Item Master
7810 IF P3$(225,1)<>"Y" OR A$(10,1)="9" THEN GOTO 7840
7815 READ (Z[3],KEY=B$(6,10)+A$(19,10),DOM=7840)IOL=0330
7820 IF C$(105,1)<>"Y" OR C[3]=0 OR C[4]=0 THEN GOTO 7840
7822 IF POS(I$(118,1)="USC",1)<>0 THEN GOTO 7840 ! SSP 227338
7825 IF DONT_MOD$<>"Y" THEN A[4]=C[3]*A[5]/C[4]; IF CONTRACT$="N" THEN IF I[14]<>0 THEN A[4]=I[0]*A[5]/I[14] ! WO155894
7826 IF CONTRACT$="Y" THEN A$(4,1)="Y"
7840 RETURN 
7905 IF A0=A[0] THEN D0$="N" ELSE D0$=D$(22,1)
7910 CALL "FM2OB4",A{ALL},S{ALL},T{ALL},M0$,M6$,M2$,M3$,S5$,T5$,D0$,A$,I$
7920 IF P3$(155,1)="Y" THEN PRINT @(33,15),A[22]:M6$,@(51,15),A[23]:M3$,
7945 RETURN 
8005 FIND (Z[13],KEY="U/M"+A$(124,4),DOM=8006)IOL=0410
8010 S[4]=A[5]
8011 IF MID(S5$,21,1)="Y" THEN A[4]=0; PRINT @(33,13),A[4]:M1$,
8015 IF MID(S5$,20,1)<>"Y" THEN S[2]=A[5] ELSE S[2]=S[1]; IF S[0]<>0 THEN A[5]=S[0] ELSE A[5]=S[1]
8017 IF S[2]<>S[3] THEN GOSUB 7500
8018 IF S[4]<>A[5] THEN GOSUB 7550
8020 PRINT @(12,13),A[5]:M7$,
8040 RETURN 
8055 FIND (Z[13],KEY="U/M"+A$(120,4),DOM=8006)IOL=0420
8060 T[4]=A[2]
8061 IF T5$(21,1)="Y" THEN A[1]=0; PRINT @(33,14),A[1]:M1$,
8065 IF T5$(20,1)<>"Y" THEN T[2]=A[2] ELSE T[2]=T[1]; IF T[0]<>0 THEN A[2]=T[0] ELSE A[2]=T[1]
8067 IF T[2]<>T[3] THEN GOSUB 7525
8068 IF T[4]<>A[2] THEN GOSUB 7575
8070 PRINT @(12,14),A[2]:M7$,
8090 RETURN 
8100 REM "Lot Inventory
8105 Z$="09C FM0...  09O ICF...  "
8106 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 8107,8195
8110 X$=A$(161,10)+A$(19,10)+A$(10,4)+A$(147,8)+A$(6,3)
8115 READ (Z[9],KEY=X$(1,24),DOM=8116)
8116 K$=KEY(Z[9],END=8190); IF K$(1,24)<>X$(1,24) THEN Q0=0; GOSUB 8850; GOTO 8190
8120 S1=0; CALL "IC2LCA",X3$,X4$,"",12,X$,Q0,C,F,S1,S1$,S2,S3$,S3,S4
8121 IF P3$(261,1)="Y" AND F<>0 THEN A[17]=F; CALL "ZZPROM",".4",X3$,0,"Lot Freight Automatically added is: "+STR(F:"$####.00-"),"","",0; GOTO 8123; REM "92395
8122 IF P3$(193,1)="Y" AND F<>0 THEN CALL "ZZPROM",".4",X3$,0,"Total Freight on Lots Selected is: "+STR(F:"$####.00-"),"","",0
8140 IF Q0=-1 THEN Q0=0 ELSE A$(2,1)="Y",A[0]=Q0,A[7]=Q0; GOSUB 4200
8150 IF FNS$(S3$(9,3))>"" THEN A$(29,3)=S3$(9,3); PRINT @(12,7),A$(29,3),; GOSUB 7750
8155 IF FNS$(S3$(12,5))>"" THEN A$(128,5)=S3$(12,5); REM "Will auto re-display after lot entry
8158 IF %MSLC THEN IF FNS$(S3$(12,5))>"" THEN CMKEY$="O"+A$(147,8)+B$(6,10)+A$(6,3); CALL "ARGSCM;DEFAULT_LOT_SETUP",CMKEY$,S3$(12,5) ! SSP 225300
8160 GOSUB 4200; IF A$(10,1)<>"9" THEN Q8=A(1)
8162 CALL "UPDICF;GET_PRICE_CLASS",ERR=*NEXT,-99,Z[13],X3$,X$,LOT_PRICE_CLASS$; IF LOT_PRICE_CLASS$<>DIM(3) THEN S1=0; PRICE_CLASS$=LOT_PRICE_CLASS$; GOSUB 8700
8175 IF A$(14,1)="Y" THEN CUST_ITEM$=B$(6,10) ELSE CUST_ITEM$=A$(161,10)
8180 CALL "UPDSP0;GET_PRICE",ERR=*NEXT,0,B$(6,10),CUST_ITEM$+A$(19,10),A[4],A[1],SP0_PRICE,SP0_PRICE_TYPE$,A[2],A[5]; IF SP0_PRICE_TYPE$<>"" THEN A[4]=SP0_PRICE,A$(235,3)=SP0_PRICE_TYPE$; PRINT @(44,13),A$(235,3) ! 188067
8190 X$=""
8191 PRINT @(0,12),'CE',; N9=N0,N0=0; GOSUB 6000; GOSUB 6200; N0=N9
8193 Z$="09C ICF...  09O FM0...  "
8194 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
8195 RETURN 
8200 REM "SETUP FROM  QUOTE
8202 X$=B$(23,5)+B$(3,3)+A$(15,3); IF B$(183,1)="Y" THEN X$=QUOTE$+A$(15,3)
8203 IF B$(52,1)<>"Y" OR A$(15,3)<>"001" THEN GOTO 8205 ELSE CALL "QS2DAK",X3$,X4$,"","!"+X$; GOSUB 6400; GOSUB 6500; REM "To reread QSC record
8204 CALL "FM2OBB",X3$,X$,B$(6,10)
8205 A$(14,1)=F$(99,1),A$(19,10)=F$(10,10),A$(29,61)=F$(20,61),A$(124,4)=F$(95,4),A[5]=F[0],A$(4,1)=F$(101,1),A[12]=F[24]; IF B$(52,1)<>"Y" OR A$(15,3)="001" THEN A$(90,14)=F$(91,4)+F$(81,10)
8206 IF F$(99,1)="Y" THEN A$(5,1)=F$(9,1) ELSE A$(155,1)=F$(9,1)
8208 FIND (Z[3],KEY=B$(6,10)+A$(19,10),DOM=8209)C$
8210 A$(120,4)=L$(9,4),A[2]=L[0]
8212 IF POS(B$(54,1)="BS")>0 THEN A$(18,1)="Y"
8213 IF F[2]=0 THEN A[0]=F[1],A[10]=F[1],A[4]=F[17],A[6]=F[18],A[1]=L[25],A[3]=L[26]
8214 IF A$(155,1)="S" THEN FIND (Z[4],KEY="X"+A$(19,10),DOM=8215)IOL=0391
8215 GOSUB 8000; GOSUB 8050
8220 GOSUB 8300
8280 IF A$(14,1)="Y" THEN X0=X0+1 ELSE IF POS(A$(155,1)="IC")=0 OR A$(9,1)<>" " THEN X0=X0+12 ELSE X0=X0+12
8285 GOSUB 6200
8287 PRINT @(0,22),'CE',
8290 RETURN 
8310 FIND (Z[9],KEY="P"+A$(94,10)+A$(90,4),DOM=8311)IOL=0352
8315 FIND (Z[5],KEY=A$(94,10),DOM=8316)IOL=0350
8319 RETURN 
8320 REM "Will this qty ordered now put the item below ROP, WO105419           ,148299
8324 DIM F1[31]; READ (Z[3],KEY=B$(6,10)+A$(19,10),DOM=8505)IOL=0440
8325 IF F1[22]=0 AND F1[23]=0 THEN GOTO 8445
8330 ROP_DAYS=0; IF F1[22]>0 THEN ROP_DAYS=F1[22]/30*F1[24]; REM "ROP using ROP in days                                                                  
8335 ROP_QTY=0; IF F1[23]>0 THEN ROP_QTY=F1[23]; REM "ROP quantity             
8340 AVAILABLE=J[3]+J[4]-J[5]+J[6]-J[7]+J[8]
8345 BELOW_DAYS=0; IF ROP_DAYS>0 THEN BELOW_DAYS=ROP_DAYS-(AVAILABLE-A[0])
8350 BELOW_QTY=0; IF ROP_QTY>0 THEN BELOW_QTY=ROP_QTY-(AVAILABLE-A[0])
8355 IF BELOW_DAYS<=0 AND BELOW_QTY<=0 THEN GOTO 8445
8360 IF BELOW_DAYS>0 THEN AMOUNT=BELOW_DAYS,X$=" below ROP using ROP in days from the item master." ELSE AMOUNT=BELOW_QTY,X$=" below ROP using ROP quantity from the item master."
8365 IF BELOW_DAYS>0 AND BELOW_QTY>0 THEN IF BELOW_QTY>BELOW_DAYS THEN AMOUNT=BELOW_QTY,X$=" below ROP using ROP quantity from item master."
8370 CALL "ZZPROM",".4",X3$,0,STR(AMOUNT)+X$,"","",0
8375 RETURN 
8405 N0=0
8410 CALL "FM2OB1",X3$,X4$,8400,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
8420 RETURN 
8435 CALL "FM2OB1",X3$,X4$,8430,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
8440 RETURN 
8505 Y5=20
8506 IF A$(15,3)<>"   " OR A$(9,1)<>" " THEN GOTO 8525
8508 IF Q[25]=0 THEN PRINT @(0,19),Z0$,
8509 N0=1
8510 PRINT @(0,Y5),'CE','SB',@(7,Y5),"On hand",@(19,Y5),"Committed",@(33,Y5),"Available",@(50,Y5),"On P/O",@(62,Y5),"Possible",'SF',; Y5=Y5+1
8512 IF B$(43,1)="Y" THEN T3=J[7]*1.15 ELSE T3=J[7]
8515 T0=J[3]+J[4]-J[5]+J[6],T1=T0-T3,T2=T1+J[8]
8520 PRINT @(2,Y5),T0/S[2]:M0$,@(16,Y5),T3/S[2]:M0$,@(30,Y5),T1/S[2]:M0$,@(44,Y5),J[8]/S[2]:M0$,@(58,Y5),T2/S[2]:M0$,; Y5=Y5+1
8525 RETURN 
8530 IF Q[18]=0 THEN GOTO 8540 ELSE PRINT @(0,Y5),'CE','SB',@(2,Y5),"Qty:",@(11,Y5),"---",@(0,Y5+1)," Cost:",'SF',@(7,Y5+1),Q8:M5$,
8535 FOR X=0 TO 5; IF Q[X+18]=0 THEN EXITTO 8536 ELSE X1=X*10; PRINT @(17+X1,Y5),Q[X+18]/T[2]:M4$,@(16+X1,Y5+1),Q[X+12]:M5$,; NEXT X
8540 RETURN 
8551 IF S1<>0 AND A$(214,1)="Y" AND P3$(311,1)="Y" THEN GOTO 8553 ! 185554 If item price class and param set, don't allow S1 from lots to override
8552 IF S1<>0 THEN Q9=A[4],Q8=A[1]; GOTO 8590 ELSE IF A$(14,1)="Y" AND POS(" "<>A$(15,3))=0 THEN GOTO 8590
8553 IF B$(43,1)<>"Y" THEN IF A$(10,1)="9" THEN Q9=0,Q8=0; GOTO 8590
8554 IF POS(" "<>I$(168,20))<>0 THEN A$(94,10)=I$(82,10); CALL "FM2OBA",X3$,A$,I$(168,20),A{ALL},Q8,Q9,M6[1]; A[1]=Q8,A[4]=Q9; GOTO 8590
8555 IF Q[0]=0 OR ABS(A[0])<ABS(Q[0]) THEN GOTO 8580
8560 X=1
8570 IF X=30 OR Q[X]=0 OR ABS(A[0])<ABS(Q[X]) THEN GOTO 8571 ELSE X=X+1; IF X=6 THEN X=24; GOTO 8570 ELSE GOTO 8570
8575 IF X=24 THEN Q9=Q[11] ELSE Q9=Q[X+5]
8580 IF Q[18]=0 OR ABS(A[0])<ABS(Q[18]) THEN GOTO 8588
8584 FOR X=18 TO 23; IF Q[X]=0 OR ABS(A[0])<ABS(Q[X]) THEN EXITTO 8586 ELSE IF Q[X]<>0 THEN Q8=Q[X-6]; END_IF ; END_IF ; NEXT X ! SSP#281905
8585 FOR X=42 TO 47; IF Q[X]=0 OR ABS(A[0])<ABS(Q[X]) THEN EXITTO 8586 ELSE IF Q[X]<>0 THEN Q8=Q[X-6]; END_IF ; END_IF ; NEXT X ! SSP#281905
8587 ! Q8=Q[X-7]!SSP#281905
8588 IF B$(52,1)="Y" AND POS(" "<>A$(15,3))<>0 THEN GOSUB 8600
8590 IF POS(X3$(9,3)="049500")>0 THEN IF NUM(H$(398,3),ERR=8591)>0 THEN Q9=Q9*(100-NUM(H$(398,3)))*.01
8595 RETURN 
8600 REM "RFQ pricing
8605 Z$="06C PO6...  06O QSD...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 8606,8645
8607 IF X<19 THEN Z0=32 ELSE Z0=X+13
8608 IF B$(183,1)="Y" THEN QTE$=A$(221,8) ELSE QTE$=B$(23,5)+B$(3,3)
8609 READ (Z[6],KEY=QTE$+A$(15,3)+STR(L[Z0]:"00"),DOM=8645)J5$
8610 IF F1$="*" AND A$(94,10)<>J5$(12,10) THEN CALL "ZZPROM",".4",X3$,0,"WARNING-Qty requires Vendor that is not on existing P/O-Try deleting line","","",0; GOTO 8645
8614 REM "we have to change the vendor
8615 IF A$(94,10)=J5$(12,10) THEN GOTO 8645 ELSE A$(94,10)=J5$(12,10)
8620 FIND (Z[5],KEY=A$(94,10),DOM=8645)IOL=0350
8624 A$(90,4)=J5$(85,4)
8625 DIM E2$(200); FIND (Z[9],KEY="P"+A$(94,10)+A$(90,4),DOM=8626)IOL=0390
8630 CALL "ZZDISP","A",A$(94,10),"A/P",X3$,"","",11,9,X4$
8632 PRINT @(72,9),A$(90,4),
8635 CALL "FM2OB1",X3$,X4$,8300,N0,A$,A{ALL},B$,E$,E1$,H$,S[2],T[2],E2$,E4$,P3$
8645 Z$="06C QSD...  06O PO6...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
8646 RETURN 
8695 RETURN 
8702 PRECISION M6[1]
8703 REM "J(2) is avg cost from location, I(18) is avg cost from item
8704 IF I[14]=0 THEN I[14]=1
8705 Q9=I[0]*A[5]/I[14]; IF J[2]<>0 THEN Q8=J[2]*I[15]/A[2] ELSE Q8=I[18]*I[15]/A[2]
8706 REM "Q(), 0-5 & 24-29=Price breaks, 6-11 & 30-35=prices, 12-17=costs, 18-23=cost breaks 36-41=COSTS(7-12), 42-47=COST BREAKS (7-12); WO273055
8709 DIM Q[47] ! WO273055
8710 IF A[2]=0 THEN A[2]=1
8712 IF POS(" "<>A$(15,3))<>0 THEN GOTO 8726
8714 IF I[14]=0 THEN I[14]=1
8716 CALL "FM2OB8",X3$,Y0$,Y1$,Z{ALL},A$,A{ALL},Q8,Q{ALL},M$,M{ALL}; IF M[14]=0 THEN M[14]=1
8718 Q8=M[0]*A[2]/M[14]
8720 FOR X=0 TO 5; Q[X]=I[X*2+1],Q[X+24]=I[X*2+21],Q[X+6]=I[X*2+2]*A[5]/I[14],Q[X+30]=I[X*2+22]*A[5]/I[14],Q[X+12]=M[X*2+2]*A[2]/M[14],Q[X+18]=M[X*2+1]; Q[X+36]=M[X*2+18]*A[2]/M[14],Q[X+42]=M[X*2+17]; NEXT X ! WO273055
8725 GOTO 8745
8727 IF F[0]=0 THEN F[0]=1
8730 FOR X=0 TO 4; Q[X]=F[X+2],Q[X+6]=F[X+12]*A[5]/F[0],Q[X+12]=F[X+19]*A[2]/F[0],Q[X+18]=Q[X]; NEXT X
8735 Q9=F[12],Q8=F[19]*A[2]/F[0]
8744 IF A$(155,1)="C" AND A$(10,1)="9" THEN Q9=0,Q8=0
8745 IF A$(15,3)="   " THEN IF POS(" "<>PRICE_CLASS$+H$(398,3))>0 THEN X$=PRICE_CLASS$+H$(398,3)+I$(1,20); CALL "IC2ICF",X3$,Z[4],X$,A[5],I[15],I[14],I[0],I[18],I[17],I[20],Q{ALL}; IF X$="" THEN A$(214,1)="N" ELSE A$(214,1)="Y"
8746 IF ICPARMS$(71,1)="Y" THEN A$(214,1)="N"; REM " IF VALIDATING QBG FILE NEVER SET FLAG TO YES SSP# 156908
8747 PRECISION 2
8748 IF N0=1 THEN GOTO 8790
8749 IF P2$(44,1)="Y" AND A$(9,1)=" " AND POS(A$(155,1)="IC")<>0 AND I$(112,1)="Y" THEN GOTO 8765
8750 IF Q[0]=0 AND A[4]=0 AND A$(230,3)=DIM(3) THEN A[4]=Q9; PRINT @(33,13),A[4]:M1$,; GOTO 8765 ELSE IF Q[24]<>0 THEN GOSUB 8850; GOTO 8765 ELSE PRINT @(0,17),'CE','SB',@(2,17),"Qty:",@(11,17),"---",@(0,18),"Price:",'SF',@(6,18),Q9:M6$(2), ! SSP#285794
8760 FOR X=0 TO 5; IF Q[X]=0 THEN EXITTO 8761 ELSE X1=X*10; PRINT @(17+X1,17),FNQ$(Q[X]/S[2],M1$),@(16+X1,18),Q[X+6]:M6$(2),; NEXT X
8765 GOSUB 8500
8770 N0=1
8790 RETURN 
8800 DIM P9[5]; FIND (Z[13],KEY=X3$(9,3)+"F/M")*,*,*,P9[0],P9[1],P9[2],P9[3]
8805 IF A$(10,1)="9" OR A$(155,1)="N" THEN P9[4]=0 ELSE P9[4]=P9[0]
8810 P9[5]=P9[1]; IF ABS(A[0])<P9[3] THEN P9[4]=P9[4]+P9[2],P9[5]=0
8820 P9[5]=P9[5]+A[15]
8829 REM "BETTER PRECISION
8830 IF A[0]<>0 THEN A[1]=(A[2]*P9[4]+A[2]*P9[5]*A[0]/1000)/A[0] ELSE A[1]=A[15]
8840 RETURN 
8850 REM "More than 6 breaks
8860 PRINT @(0,16),'CE','SB',@(2,16),"Qty:",@(2,18),"Qty",@(11,16),"---",@(0,17),"Price:",@(0,19),"Price",'SF',@(6,17),Q9:M6$(2),
8870 FOR X=0 TO 5
8875 X1=X*10; PRINT @(17+X1,16),FNQ$(Q[X]/S[2],M1$),@(16+X1,17),Q[X+6]:M6$(2),
8880 IF Q[X+24]<>0 THEN PRINT @(17+X1,18),FNQ$(Q[X+24]/S[2],M1$),@(16+X1,19),Q[X+30]:M6$(2),
8885 NEXT X
8890 RETURN 
8915 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8950 DEF FNQ$(Z0,Z9$)=STR(Z0:Z9$(1,POS(".00"=STR(Z0:Z9$)+".00")-1))
8955 DEF FNS$(Z9$)=Z9$(1,POS("     "=Z9$+"     ")-1)
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9710 GOTO 9900
9940 SETESC 9350
9945 L1=1
9950 RUN "FM2ODB"
9999 END 
56000 REM "188067-New Pricing changes. Standard GP Percentage for a           
56002 REM "192451-Special Pricing module should include qty per               
56004 REM "190538-Item price class pricing by bin identifier.                 
56006 REM "198501-Exact repeat issue                                          
56007 REM "201823-Provide the ability to set the taxable flag  by Item   
56008 REM "203458-Addition of S.P. Richards to TOPS module                    
56009 REM "203458-Addition of S.P. Richards to TOPS module         
56010 REM "211032-Issue with cost extensions not being correct on order.         
56011 REM "223522-Recently, when we run the backorder status report in OPR, R9   
56012 REM "225489-When non-lotted companion item is automatically added to
56014 REM "227338-Issues with United pricing in O/S S6 and in O/P O1.         
56016 REM "264206-Customer default parameter; Number of months for lot storage
56017 REM "273055-Expand IC2 for 6 additional cost breaks, allow entry in GUI 
