0010 REM "SETUP FM1 RECORD FROM IC0 RECORD <FM2UBI>
0035 REM "5.7 - 02/15/23 - 17.268432 - dmm - SSP# 307430
0036 REM "LINE 8135 FOR FMS%
0037 REM "307430-DBD-333;Add 101 to some of 288's company specfic code       
0040 REM "Copyright 2023 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! SSP185437, could be an instance of no IC0 record, if this item is in FM1, probably using a from customer, then use that data to setup the new FM1 record.
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24],A[25],A[26],A[27],A[28],A[29],A[30]
0320 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14],F[15],F[16],F[17],F[18],F[19],F[20],F[21],F[22],F[23],F[24],F[25],F[26],F[27],F[28],F[29],F[30],F[31]
0330 IOLIST FROM_FM1$,FROM_FM1[0],FROM_FM1[1],FROM_FM1[2],FROM_FM1[3],FROM_FM1[4],FROM_FM1[5],FROM_FM1[6],FROM_FM1[7],FROM_FM1[8],FROM_FM1[9],FROM_FM1[10],FROM_FM1[11],FROM_FM1[12],FROM_FM1[13],FROM_FM1[14],FROM_FM1[15],FROM_FM1[16],FROM_FM1[17],FROM_FM1[18],FROM_FM1[19],FROM_FM1[20],FROM_FM1[21],FROM_FM1[22],FROM_FM1[23],FROM_FM1[24],FROM_FM1[25],FROM_FM1[26],FROM_FM1[27],FROM_FM1[28],FROM_FM1[29],FROM_FM1[30],FROM_FM1[31]
1010 SETERR 9000
1020 ENTER X3$,A$,C$,C1$,C2$,C3$,C3
1022 REM C1$=TYPE (C, F), C2$='FROM' CUSTOMER, C3$=FMS PARAMS FOR CUST
1025 RT_PARM$=""; CALL "RT2PRM",ERR=1026,X3$,X4$,RT_PARM$
1040 DIM S$(40),Z[NUM(X3$(60,3))],A[30],F[30],FROM_FM1[31]
1100 REM "C$ IS CUST, A$ IS ITEM MASTER STUFF
1120 Z$="01O FM1... 02O IC0...  03O FM2...  "
1125 IF C2$<>S$(1,10) THEN Z$=Z$+"04O FMG... "
1127 Z$=Z$+"05O FT1... 06O IC2... 13O ZZPARM  " ! SSP# 214645 ! WO247674 jdf
1130 GOSUB 9700
1150 FIND (Z[13],KEY=X3$(9,3)+"F/M")FM$ ! WO247674 jdf
1200 REM "
1205 PREV_C2$=C2$ ! 172187 - Save original cust_code to try
1210 IF C1$<>"C" THEN DIM C2$(10)
1215 REM " A$="ARCHECKS  "
1220 FIND (Z[2],KEY=C2$+A$,DOM=*NEXT)IOL=0310; GOTO AFTER_IC0_READ ! 172187
1225 FIND (Z[2],KEY=PREV_C2$+A$,ERR=*NEXT)IOL=0310; C2$=PREV_C2$; GOTO AFTER_IC0_READ ! 172187
1226 IF STP(PREV_C2$,1)="" THEN GOTO 1230 ELSE READ (Z[1],KEY=PREV_C2$+A$,ERR=1230)IOL=0330; C2$=PREV_C2$ ! SSP185437, from customer item may not have IC0 record, if so try to get from FM1, if found fill out IOL=310 then proceed.
1227 DIM A$(187),A[30]; A$(1,20)=FROM_FM1$(1,20),A$(21,40)=FROM_FM1$(42,40),A$(61,3)=FROM_FM1$(21,3),A$(64,18)=FROM_FM1$(24,18),A$(82,14)=FROM_FM1$(82,14),A$(120,4)=FROM_FM1$(100,4),A$(124,4)=FROM_FM1$(96,4)
1228 A[0]=FROM_FM1[3],A[14]=FROM_FM1[4],A[19]=FROM_FM1[0],A[16]=FROM_FM1[18],A[18]=FROM_FM1[1],A[15]=FROM_FM1[2]; GOTO AFTER_IC0_READ
1229 ! 
1230 IF %GUI THEN GOTO 1232 ELSE TT$="Please setup Item Master (IC0) record for customer "+FN%ZZDISP$(PREV_C2$,"A/R")+" item "+A$ ! 172187
1231 CALL "ZZPROM",".4",X3$,0,TT$,"","",0; GOTO 1220
1232 MSGBOX "Please setup Item Master (IC0) record for customer "+PREV_C2$+" item "+A$,"Not Found","STOP"; %CUSTOMER$=PREV_C2$; %ITEM_CODE$=A$; GOTO 1220
1240 AFTER_IC0_READ:! 172187
1400 GOSUB 8100
1420 F$(1,20)=C$(1,10)+A$(11,10)
1440 WRITE (Z[1],KEY=F$(1,20),DOM=1445)IOL=0320; IF RT_PARM$<>"" THEN CUST$=F$(1,10); CALL "RT2WOC",ERR=1441,X3$,X4$,CUST$,"FM1...","U",F$(1,20) ! SSP# 214645
1441 IF POS(X3$(9,3)="597",3)<>0 THEN GOSUB FIND_IC2 ! SSP# 214645
1445 IF C2$<>S$(1,10) THEN WRITE (Z[4],KEY=F$(185,10)+F$(11,10)+F$(1,10))
1450 WRITE (Z[3],KEY=F$(21,3)+F$(24,16)+F$(40,2)+F$(11,10)+F$(1,10))
1490 GOTO 9900
8105 DIM F$(448),F[31]
8110 F$(42,40)=A$(21,40),F$(21,3)=A$(61,3),F$(24,18)=A$(64,18),F$(82,14)=A$(82,14),F$(100,4)=A$(120,4),F[3]=A[0],F[4]=A[14],F[0]=A[19],F[18]=A[16]
8112 F$(108,1)="Y"
8115 F$(185,10)=C2$
8120 IF C2$=S$(1,10) THEN F$(105,1)="Y"
8125 F$(387,1)=A$(119,1); REM SSP 201823
8130 F$(96,4)=A$(124,4),F[1]=A[18],F[2]=A[15]
8134 REM "IF FMS% IS SET, RECALC THE FMS PRICE;; IF FMS% NOT SET AND FMS PRICE IS ZERO, ASSUME  THAT THIS IS A NEW ENTRY, AND SET BOTH.
8135 IF F[30]<>0 THEN F[29]=F[30]*F[3]/100 ELSE IF C3>0 AND F[29]=0 THEN F[30]=C3; GOTO 8135
8140 F$(82,14)=A$(82,14)
8145 IF POS(X3$(9,3)="598101288475497499500522524568589029",3)>0 OR (MID(FM$,333,1)="Y") THEN DIM FM1$(200); READ (Z[1],KEY=C2$+A$(11,10),DOM=8146)FM1$; F$(173,12)=FM1$(173,12); REM "SSP102342SSP#202439 SSP 211619 !SSP#240316 ! WO247674 jdf SSP307430-DBD-333-DBSPT-149880
8190 RETURN 
8200 FIND_IC2:! SSP# 214645
8210 READ (Z[6],KEY=C2$(1,10)+F$(11,10)+F$(82,10),DOM=*NEXT) ! SSP# 214645
8220 READ (Z[6],END=8299)IC2$ ! SSP# 214645       
8230 IF IC2$(1,30)<>C2$+F$(11,10)+F$(82,10) THEN GOTO 8299 ! SSP# 214645
8240 WRITE (Z[5],KEY=F$(1,10)+IC2$(35,20)+F$(11,10)) ! SSP# 214645       
8250 READ (Z[1],KEY=F$(1,20),DOM=*NEXT)IOL=0320; F$(350,20)=IC2$(35,20); WRITE (Z[1],KEY=F$(1,20))IOL=0320 ! SSP# 214645
8299 RETURN ! SSP# 214645       
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 Y8=2
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9999 END 
56000 REM "202439-They need to have the same custom change for the function   
56001 REM "201823-Provide the ability to set the taxable flag  by Item          
56002 REM "211619-Needs documentation on using the function field as billing  
56003 REM "214645-Would like a modification to the sales journal update       
56004 REM "240316-Needs a field to store a "cost center" at the item level,   
56005 REM "247674-Need to use program logic to make function field write to   
56006 REM "307430-DBD-333;Add 101 to some of 288's company specfic code       
