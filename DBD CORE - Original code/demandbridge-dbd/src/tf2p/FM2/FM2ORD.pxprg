0010 REM "Search for order in ARB files <FM2ORD>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 07/12/11 - 16.493888 - crg - SSP# 247986
0037 REM "247986-When trying to do FM2ORD in GUI, you get an error upon      
0040 REM "Copyright 2011 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0110 X0$="FM2ORD",X1$="Search for order in ARB file"
0120 DIM Z0$(80,"-")
0130 K0=20,K1=1
0135 C9=-1
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=ESC+"BG"+Z0$+ESC+"EG"
0300 REM "IOLISTS
0310 IOLIST A$
0320 IOLIST B$
0330 IOL_HDR:IOLIST "    Batch ","|","FY  "," ","PD"," ","Invoice","  ","Order  "," ","Terms","   (** indicates orphaned batch)"
0340 IOL_ORD:IOLIST ORPH$," ",F_NAME$,"|",MID(O$,1,4)," ",MID(O$,5,2)," ",MID(O$,7,8)," ",MID(O$,92,8)," ",MID(O$,65,2)
0510 OPEN (HFN)"ZY9"; ZY9=LFO
0600 REM "
0610 GOSUB 6000
0620 IF Q1$="" THEN GOSUB 6200 ELSE A$=PAD(Q0$,8)
0640 IF Q1$="" THEN CALL "ZZPROM",".Y",X3$,Z,"Proceed?","","",0; ON Z GOTO 0641,9900
1000 REM "BEGIN MAIN PROCESS
1001 L1=10,L2=20,L=L1
1010 SELECT F_NAME$ FROM %DATAPATH$ WHERE F_NAME$ LIKE "ARB*"
1020 OPEN (HFN,ERR=ERR_ARB_OPEN)F_NAME$; ARB=LFO
1025 GOSUB CHECK_BATCH
1030 K$=KEY(ARB,END=NEXT_ARB,ERR=NEXT_ARB); READ (ARB,KEY=K$)O$
1040 IF NUL(A$) OR A$=MID(O$,92,8) THEN IF NOT(HEADER) THEN PRINT @(4,8),IOL=IOL_HDR; HEADER=1; END_IF ; PRINT @(4,L++),IOL=IOL_ORD; IF L>L2 THEN PRINT @(2,22),"Press any key to continue -or- F4 to exit..."; INPUT *; L=L1; FOR J=L1 TO L2; PRINT @(0,J),'CL'; NEXT J
1045 IF CTL=4 THEN CLOSE (ARB,ERR=*PROCEED); GOTO 9900
1050 GOTO 1030
1560 CLOSE (ARB,ERR=*PROCEED); ARB=0
1570 NEXT_ARB:
1580 NEXT RECORD 
1600 ! GOTO 1000
5000 REM "EOJ
5020 IF Q1$="" THEN CALL "ZZPROM",".4",X3$,Z,"Process complete!!","","",0
5040 GOTO 9900
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6020 PRINT @(4,4),"This utility program will list all orders being invoiced. Given an ",@(4,5),"order number, it will search and provide details on a specific order",@(4,6),"and its invoice."
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6200 REM "GET ORDER
6201 PRINT @(4,8),"Enter Order: ",
6205 DIM A$(8),A[1]; CALL "ZZENTR","AUX",A{ALL},A$,X4$,X3$,18,8,1,8,C0,"O/P","{1"+X$,P6$,"FM2ODM00","FS1","",""; IF ABS(C0)>4 THEN ON C0 GOTO *SAME,*NEXT
6210 RETURN 
6300 "Check Batch"
6305 CHECK_BATCH:
6310 ORPH$="  ",BATCH$=MID(F_NAME$,4)
6320 FIND (ZY9,KEY=PAD(BATCH$,5),DOM=*NEXT); GOTO *RETURN
6330 FIND (ZY9,KEY=PAD(BATCH$,4)+"B",DOM=*NEXT); GOTO *RETURN
6340 ORPH$="**"
6350 RETURN 
8195 RETURN 
8950 DEF FNS$(Z9$)=Z9$(1,POS("     "=Z9$+"     ")-1)
8960 ERR_ARB_OPEN: MSGBOX "ERROR ON OPEN: "+F_NAME$; GOTO NEXT_ARB
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9905 CLOSE (ZY9)
9930 SETERR 9940; Q1$=A1$; IF %GUI THEN PRINT 'POP' END_IF ; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56001 REM "220538-Support enhancements-Search for invoiced order
56002 REM "247986-When trying to do FM2ORD in GUI, you get an error upon      
