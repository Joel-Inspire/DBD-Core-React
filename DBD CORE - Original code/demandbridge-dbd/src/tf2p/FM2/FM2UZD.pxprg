0010 REM "Retrieve Prior Order Data <FM2UZD>
0035 REM "5.1 - 12/31/02 - 16.382222 - lms - SSP# 154318
0036 REM "MOD 12/10/92 TO CORRECT DROPPING OFF ORDERS IF MORE THAN 20 PRIOR ORDS
0040 REM "Copyright 2002 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0400 IOLIST J$,J[0],J[1],J[2],J[3],J[4],J[5]
1000 REM 
1010 X0$="FM2UZD"
1015 REM "O0 = CUMULATIVE AVERAGE USAGE / MONTH
1016 REM "O1=LAST ORDER QTY
1017 REM "O2$=EST RO DATE, O2=EST AVG / MONTH BASED ON LAST ORDER
1018 REM "H0$(1,1)="Y" MEANS USE INVOICED QTYS IF THERE, H0$(2,1)="Y" Manually entered reorder date (order history) overrides calculated date
1019 REM "A$(1,20)=CUSTOMER + FORM CODE 
1020 SETERR 1021; ENTER X3$,X4$,A$,O$,O{ALL},O1$,O2$,O0,O1,O2,H0$,H1$,D0$; SETERR 9000; GOTO 1025
1021 IF X3$="?" THEN CALL "ZZPDOC","FM2UZD"; EXIT ELSE EXIT ERR
1040 O0=0,O1=0,O2=0,O1$="      ",O2$="      "
1045 IF H1$="" THEN H1$="B"
1215 DIM Z[NUM(X3$(60,3))]
1220 Z$="10O FS6... "
1230 GOSUB 9700; ON Z0 GOTO 1231,9900
1400 REM 
1450 GOSUB 8150
1460 GOSUB 7500
1590 GOTO 9900
7500 REM "CALCULATE 'AVERAGE' FROM DATES / QTYS
7505 O0=0,Q8=0,Q9=0; IF O$="" THEN GOTO 7590 ELSE IF LEN(O$)<2*O9 THEN X=1; GOTO 7570
7510 FOR X=1 TO LEN(O$)-O9 STEP O9
7515 Q0$=O$(X+8,6),Q1$=O$(X+O9+8,6),Q0=O[NUM(O$(X+(O9-2),2))]
7517 IF O0$="" THEN O0$=Q0$
7520 CALL "YDYSBT",X3$,Q0$,Q1$,Q1
7540 IF Q1<>0 THEN O2=INT(Q0/Q1*30)
7545 Q8=Q8+Q0,Q9=Q9+Q1
7560 NEXT X
7565 IF Q9<>0 THEN O0=INT(Q8*30/Q9)
7570 O1$=O$(X+8,12),O1=O[NUM(O$(X+(O9-2),2))]
7572 Q=0; IF O0=0 THEN GOTO 7579 ELSE Q=INT(O1/O0*30); IF Q>9999 THEN Q=9999
7575 O2$=""; CALL "ZZDATE",X3$,"",O1$(1,6),O2$,Q,0,0,0,0,0,0,"","",""
7579 Q$=""; IF O$>"" THEN Q$=O$(LEN(O$)-8,6)
7580 IF O2$="" OR O2$=S$(1,6) OR O2$<Q$ THEN O2$=Q$
7585 IF LEN(H0$)>1 AND POS(H0$(2,1)="YO")>0 AND Q$<>S$(1,6) AND Q$<>"" THEN O2$=Q$
7586 IF LEN(H0$)>1 AND H0$(2,1)="O" THEN IF Q$=S$(1,6) OR Q$="" THEN O2$=""
7590 RETURN 
7670 REM "LAST ORDER DATE
8150 REM "PRIOR ORDERS
8152 O9=23,O8=40
8155 DIM O[O8],O$(0),S$(20); Q$=A$(1,10)+H1$+A$(11,10),O=0; READ (Z[10],KEY=Q$,DOM=8156)
8160 DIM J[5]; READ (Z[10],END=8190)IOL=0400; IF J$(1,21)<>Q$ THEN GOTO 8190
8162 IF (X3$(146,6)<>"FM2IAZ" AND X3$(146,6)<>"AR2MAA") THEN IF J$(34,6)="      " OR POS(J$(105,1)="xR")>0 OR (D0$>"" AND D0$>J$(34,6)) THEN GOTO 8160
8163 P=POS(J$(22,8)=O$,O9); IF P>0 THEN P=NUM(O$(P+O9-2,2)); O[P]=O[P]+J[0]; GOTO 8160
8165 X$=J$(22,8)+J$(34,6)+J$(81,6)+J$(30,1)+STR(O:"00"),O[O]=J[0],O=O+1
8166 GOSUB 8200
8170 IF O<O8 THEN GOTO 8160
8171 IF X3$(146,6)<>"AR2DBS" AND X3$(146,6)<>"CS2ROA" THEN O$=O$(24),O=0; GOTO 8160; REM "SSP128876, added CS2ROA 
8190 REM IF O$="" THEN DIM O$(20); LET O$(1)=B$(132,8)+B$(126,6),O=1,O(0)=B(16)
8195 RETURN 
8200 REM "Date sort in memory
8208 IF O$="" THEN O$=X$; GOTO 8240
8210 P=POS(X$(9,6)<=O$(9),O9); IF P=0 THEN O$=O$+X$ ELSE O$=O$(1,P-1)+X$+O$(P)
8240 RETURN 
8290 REM "ESCAPE 
8300 REM "DISPLAY THEM FOR DEBUG PURPOSES
8310 FOR X=1 TO LEN(O$) STEP O9
8320 PRINT O$(X,8),"  ",O$(X+8,6),"  ",O$(X+14,6),"  ",O[NUM(O$(X+20,2))]
8330 NEXT X
8390 ESCAPE 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9900 REM "End program
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9940 EXIT 
9999 END 
