0010 REM "F/M Physical Inventory Setup <FM2PAA>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 02/03/11 - 12.3975 - tma - SSP# 244038
0036 REM "FOR ON PO TO CUSTOMER LOCATION BUG FPF 12/24
0037 REM "244038-Change Forms to Items Managment in FM2PAA, line 6020.  This 
0040 REM "Copyright 2011 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 IF NOT(%GUI) THEN BEGIN 
0100 SETERR 9000
0110 X0$="FM2PAA",X1$="F/M Physical Inventory Setup",K9$="",K9=0
0120 DIM Z0$(80,"-"),S$(20),B$(254)
0130 K0=24,K1=2
0135 C9=-1
0140 M0$="##,###,##0-",M1$="###,###.00-",M2$="##,###,###.00-"
0160 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0175 DEF FNR$(Z8$)=Z8$(POS(" "<>Z8$))
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$(1),A9$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15]
0320 IOLIST B$(1),B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21],B[22],B[23],B[24],B[25],B[26],B[27],B[28]
0330 IOLIST C$
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],B[25],B[26],B[27],B[28]
0370 IOLIST G$(1)
0390 IOLIST E$,E[0],E[1]
0400 IOLIST J$(1),J[0]
0420 IOLIST H$,H[0],H[1],H[2]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01X FM4...  02O FM1...  03O FM0...  04O FM6...  05S AR1...  06O FM7...  07O FM8... 08O FS2... 09O FS6... 10O FST... 11O PO3... 12O ICG...  13O ZZPARM  14O FMP...  15O FTN...  " ! SSP#229934
0520 GOSUB 9750
0550 READ (Z[13],KEY=X3$(9,3)+"FMS")S9$
0555 S9=NUM(S9$(17,1)),S7$=""; Q$=X3$(21,6); IF S9>0 THEN S9=INT(S9*30.5); CALL "ZZDATE",X3$,"",Q$,S7$,-S9,0,0,0,0,0,0,"","",""
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0600 REM "
0625 DIM A[15],B$(254),B[30],C$(53),D$(60),D[6],L$(14),E$(21),E[1],L1$(2),L2$(6)
0630 L0=8
0990 GOSUB 6000
1000 GOTO 2000
1800 REM "
1820 CALL "ZZPROM","0",X3$,Z,"","","V",X0; ON Z GOTO 2500,9900,2000
1830 GOTO 2000
2890 READ (Z[7],KEY="",DOM=2891)
2900 REM "PROCESS CYCLE RECORDS
2910 K$=KEY(Z[7],END=2950); IF G0$="" THEN G0$=K$(1,10) ELSE IF K$(1,10)<>G0$ THEN GOTO 2950
2912 DIM G$(35); READ (Z[7])IOL=0370
2915 IF G$(35,1)<>"I" THEN IF POS(G$(27,1)="0 ")=0 THEN GOTO 2900
2918 IF X3$(146,6)="FM2PZA" THEN IF G$(35,1)="I" THEN GOTO 2900
2920 C$(1)=""; READ (Z[3],KEY="C"+G$(1,14),DOM=2900)IOL=0330
2925 IF LEN(G$)<35 THEN G$=G$+" "; GOTO 2925
2930 G1$=G1$+G$(11,4)+G$(34,1)
2940 GOTO 2910
2950 IF G0$="" THEN GOTO 4100 ELSE IF G1$="" THEN GOTO 4040
3000 REM "Freeze Inventory & Build FM6"
3010 READ (Z[1],KEY=G0$,DOM=3011)
3020 DIM A$(215),A[15]; K$=KEY(Z[1],END=4000); READ (Z[1])IOL=0310
3030 IF A$(1,10)<>G0$ THEN GOTO 4000 ELSE G0=POS(A$(21,4)=G1$,5); IF G0=0 THEN GOTO 3020
3035 C0=C0+1
3040 FIND (Z[3],KEY="C"+A$(1,10)+A$(21,4))
3047 IF A$(26,1)<>"Y" THEN DIM A9$(16) ELSE GOSUB 7800
3050 PRINT @(0,12),'CL',; CALL "ZZDISP","A",A$(1,10),"A/R",X3$,"","",28,13+L0,X4$
3060 PRINT @(38,13+L0),A$(11,10),"-",A$(21,4),
3070 DIM B$(254); FIND (Z[2],KEY=A$(1,20),DOM=3020)IOL=0320
3074 REM :IS THIS A FORMS MGT FORM
3075 IF B$(108,1)<>"Y" THEN GOTO 3020
3080 FIND (Z[13],KEY="U/M"+B$(100,4),DOM=3081)IOL=0390
3090 DIM D$(85),D[6]; D$(1,14)=A$(1,10)+A$(21,4),D$(31,10)=A$(11,10),D$(41,1)=" "
3092 IF G1$(G0+4,1)<>"C" OR A$(26,1)<>"Y" THEN D$(82,1)="2"
3095 D$(50,16)=B$(238,16)
3100 IF E$(20,1)<>"Y" OR B[0]<=1 THEN D$(42,4)=B$(100,4),D[2]=B[4] ELSE D$(42,4)="CASE",D[2]=B[0]
3105 D$(46,4)=D$(42,4),D[4]=D[2]
3110 D[0]=A[3],D[1]=A[4],D[6]=A[6]
3115 D[5]=A[5]
3120 IF D[2]<=0 THEN D[2]=1
3180 FOR X=1 TO LEN(A9$) STEP 16
3185 D$(15,16)=A9$(X,16)
3188 WRITE (Z[4],KEY=D$(1,41))IOL=0340
3190 WRITE (Z[6],KEY=D$(1,14)+D$(31,10)+D$(15,16)+D$(41,1))
3193 DIM FMP$(243); FIND (Z[14],KEY="D"+D$(1,10),DOM=3194)FMP$; IF POS(" "<>FMP$(46,2))>0 THEN WRITE (Z[15],KEY=FMP$(46,2)+D$(1,14)+D$(31,10)+D$(15,16)+D$(41,1)); REM "WO113947, sort by count cycle
3200 NEXT X
3210 REM "FREEZE FM4 VALUES
3212 A[6]=A[4],A[7]=A[5],A[8]=0
3215 WRITE (Z[1],KEY=K$)IOL=0310
3216 IF RT_PARM$<>"" THEN CUST$=K$(1,10); CALL "RT2WOC",ERR=3217,X3$,X4$,CUST$,"FM4...","U",K$
3240 GOTO 3020
3500 REM 
3510 X$="Customer Location "+A$(21,4)+" Record is missing!"
3520 CALL "ZZPROM",".5",X3$,Z,X$,"","V",0; ON Z GOTO 3020,9900
3600 REM 
3610 X$="This Customer Location Record does not indicate Forms Management!"
3620 CALL "ZZPROM",".4",X3$,Z,X$,"","V",0
3630 L$(11,4)=""
3645 RETURN 
4000 REM "END OF LOCATIONS FOR CUSTOMER
4005 FOR X=1 TO LEN(G1$) STEP 5; EXTRACT (Z[7],KEY=G0$+G1$(X,4))IOL=0370
4007 IF G$(35,1)="I" AND G$(27,1)="2" THEN GOTO 4030
4010 G$(27,1)="1"; IF G$(15,6)=S$(1,6) THEN G$(15,6)=X3$(21,6)
4015 IF G$(34,1)<>"C" THEN G$(27,1)="3"
4020 WRITE (Z[7],KEY=G$(1,14))IOL=0370
4030 NEXT X
4035 GOSUB 8200
4040 READ (Z[7],KEY=G0$+$FF$,DOM=4041)
4050 G0$="",G1$=""
4090 GOTO 2900
4100 REM "End of Process
4190 GOTO 9900
5990 GOTO 0500
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6020 PRINT @(10,4),"This program will save off information required by the Items",@(10,5),"Management Reports and Customer Count Entry (if applicable.)" ! SSP#244038
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6200 REM "FOREGROUND"
6210 PRINT (0,ERR=6211)'CF',
6220 CALL "ZZDISP","A",L$(1,10),"A/R",X3$,"","",38,8+L0,X4$
6225 PRINT @(38,10+L0),L$(11,4)
6290 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 GOSUB 6200
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
7800 REM "GRAB ALL THE COUNT STOPS YOU CAN GET
7805 DIM J[1],J$(50)
7810 A9$=""; READ (Z[10],KEY=A$(1,24),DOM=7811)
7815 READ (Z[10],END=7880)IOL=0400; IF J$(1,24)<>A$(1,24) THEN GOTO 7880
7818 IF J$(44,6)<>S$(1,6) THEN IF J$(44,6)<S7$ THEN REMOVE (Z[10],KEY=J$(1,27)); GOTO 7815
7820 A9$=A9$+J$(25,16)
7840 GOTO 7815
7880 IF A9$="" THEN DIM A9$(16)
7895 RETURN 
8200 REM "GET ON-ORDER STUFF
8205 Z$="10C FST... 10O PO2...  05C AR1... 05O PO5... 08C FS2... 08O PO1... "; GOSUB 9750
8210 READ (Z[2],KEY=G0$,DOM=8211)
8220 X$=KEY(Z[2],END=8280); IF X$(1,10)<>G0$ THEN GOTO 8280 ELSE READ (Z[2])IOL=0320
8221 REM "DISTRIBUTOR STOCK ITEM (105,1)="Y"
8222 IF POS(X3$(9,3)="096")=0 AND B$(105,1)="Y" THEN GOTO 8220
8225 A1$="*"; CALL "FM2UZO",X3$,X$(1,20),A1$,Z[5],Z[8],Z[10],Z[11],A0,A1,H{ALL}
8230 IF LEN(A1$)>0 THEN GOSUB 8300
8270 GOTO 8220
8290 Z$="10C PO2... 10O FST...  05C PO5... 05S AR1... 08C PO1... 08O FS2... "; GOSUB 9750 ! SSP#229934
8295 RETURN 
8300 REM "UPDATE LOCATIONS
8310 FOR X=1 TO LEN(A1$) STEP 5
8320 Q$=A1$(X,5); IF Q$(1,1)<>"C" THEN GOTO 8360
8322 Q=INT(X/5)
8325 Q$=X$(1,20)+Q$(2); EXTRACT (Z[1],KEY=Q$,DOM=8400)IOL=0310
8330 A[8]=H[Q]
8340 WRITE (Z[1],KEY=Q$)IOL=0310
8360 NEXT X
8390 RETURN 
8400 REM "SETUP LOCATION RECORD IF NOT FOUND
8405 FIND (Z[3],KEY="C"+X$(1,10)+A1$(X+1,4),DOM=8345)IOL=0330
8410 DIM A$(215),A9$(0),A[15]
8415 A$(1,24)=X$(1,20)+A1$(X+1,4)
8420 S8$=C$(223,1); IF S8$="C" THEN A$(26,1)="Y" ELSE A$(26,1)="N"; IF S8$="E" THEN A$(26,1)="E"
8425 IF S8$="I" THEN A$(27,1)="I"
8430 A$(39,6)=X3$(21,6),A$(45,30)="FMS Cycle Processing",A$(83,6)=X3$(21,6)
8480 GOTO 8330
8490 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9700 REM "PROG FLOW
9710 IF U1$="" THEN REMOVE (Z[13],KEY=U0$,DOM=9900); GOTO 9900
9720 WRITE (Z[13],KEY=U0$)U0$,U1$
9730 RUN U1$(1,6)
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 9761,9900
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 IF X3$(146,6)="FM2PRS" OR X3$(146,6)="FMGPRS" THEN K9$="FM2PRA" ! %GUI
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 IF K9$>"" THEN IF %GUI THEN CALL K9$ ELSE RUN K9$
9940 SETESC 9350
9950 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
