0010 REM "Update promotion sales analysis <FM2OA3>
0020 SETESC 9300; SETERR 9000
0035 REM "4.1 - 02/10/97 - 16.83 - kmc
0040 REM "Copyright 1997 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,C0,A$
0100 SETERR 9000
0110 X0$="FM2OA3"
0210 PRINT @(23,22),"Updating promotion file",
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6]
0330 IOLIST C$
0340 IOLIST D$,D[0],D[1],D[2],D[3]
0350 IOLIST E$
0360 IOLIST D$,B[0],B[3],B[6]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="02O FS2...  03O AR1...  04O FSP...  05O FM1...  06O FSQ... 13O ZZPARM  "
0515 IF POS("T/M"=MID(X4$,7),12)>0 THEN Z$=Z$+"07O ZP4... ",T9=1
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0540 DIM S9$(300); READ (Z[13],KEY=X3$(9,3)+"F/M")S9$(1)
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0800 DIM B[6],C[15],D[3]
1000 REM "Check lines on this order for promotion items
1010 C1=SGN(C0)
1020 READ (Z[2],KEY=A$(118,8),DOM=1021)
1040 READ (Z[2],END=1300)IOL=0320
1045 DIM D$(23),D[3]
1050 IF A$(118,8)<>B$(147,8) THEN GOTO 1300
1055 IF B$(155,1)="S" THEN IF S9$(202,1)<>"Y" THEN GOTO 1040 ELSE D$(1)=A$(49,2),D$(3)="SPECIAL",D$(13)=B$(19,10); GOTO 1140
1060 IF S9$(201,1)="P" THEN D$(1)=A$(49,2)+B$(29,3); GOTO 1140 ELSE IF S9$(201,1)="F" THEN D$(1)=A$(49,2),D$(3,10)=B$(19,10)
1080 IF B$(155,1)<>"S" THEN FIND (Z[5],KEY=A$(6,10)+B$(19,10),DOM=1040)IOL=0350
1100 IF S9$(201,1)="G" THEN IF POS(" "<>E$(291,20))=0 THEN GOTO 1040 ELSE D$(1,22)=A$(49,2)+E$(291,20)
1140 EXTRACT (Z[4],DOM=1141,KEY=D$(1,22))IOL=0340
1150 D[3]=D[3]+C1*1
1160 D[0]=D[0]+C1*B[0]
1170 D[1]=D[1]+C1*B[3]
1180 D[2]=D[2]+C1*B[6]
1200 WRITE (Z[4],KEY=D$(1,22))IOL=0340
1210 IF S9$(203,1)<>"Y" THEN GOTO 1250
1220 D$=D$(1,22)+B$(147,8)+B$(6,3)
1240 IF C1<0 THEN REMOVE (Z[6],KEY=D$,DOM=1241) ELSE WRITE (Z[6],KEY=D$)IOL=0360
1250 REM 
1280 GOTO 1040
1300 REM "Update Customer File
1305 C9=NUM(S9$(205,2))-1,C9=C9*3
1340 EXTRACT RECORD (Z[3],KEY=A$(6,10),DOM=1500)C$
1345 IF S9$(204,1)="C" THEN GOTO 1350 ELSE READ (Z[3]); IF S9$(204,1)="T" THEN GOTO 1400 ELSE GOTO 1500
1360 IF C1<0 THEN C$(269+C9,3)=S9$(210,3) ELSE C$(269+C9,3)=S9$(207,3)
1380 WRITE RECORD (Z[3])C$; IF RT_PARM$<>"" THEN CUST$=C$(1,10); CALL "RT2WOC",ERR=1381,X3$,X4$,CUST$,"AR1...","U",C$(1,10)
1390 GOTO 1500
1400 REM "Update telemarketing
1405 IF T9=0 THEN GOTO 1500
1420 EXTRACT RECORD (Z[7],KEY=C$(401,10),DOM=1500)G$
1440 IF C1<0 THEN G$(231+C9,3)=S9$(210,3) ELSE G$(231+C9,3)=S9$(207,3)
1460 WRITE RECORD (Z[7],KEY=C$(401,10))G$
1500 REM 
1900 GOTO 9900
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "END PROGRAM
9905 PRINT @(0,22),'CL',
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
