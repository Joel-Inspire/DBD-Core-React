0010 REM "<FM2UZP> Retrieve An Open PO
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 10/09/17 - 9.2 - dmm - SSP# 295316
0037 REM "295316-WEB1.log has enormous amt of WARN msgs FM2UZP LINE 3116     
0040 REM "Copyright 2017 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0059 REM "A$=CUSTOMER & FORM, A1$=* FOR ALL OR LOCATION CODE (DXXXX OR CXXXX)
0060 REM "F2=PO5, F4=PO1, F5=PO2, F6=PO3
0061 REM "A0 RETURNS TOTAL ON PO, A(ALL) RETURNS ON-PO FOR A1$ STRING
0065 REM "This was copied from FM2UZO, added ORDER$, this routine will look for any open PO with any open qty and return that order # in ORDER$, called from FM2RTO, RS3 file, Restocking Gateway Exception Report
0090 ENTER X3$,A$,A1$,F2,F4,F5,F6,A0,A1,A{ALL},ORDER$
0100 SETERR 9000
0140 IF F2<>0 THEN GOTO 0200 ELSE Z$="01O PO5...  02O PO1...  03O PO2...  04O PO3...  "
0145 DIM Z[NUM(X3$(60,3))]; GOSUB 9750; ON Z0 GOTO 0146,9900
0150 F2=Z[1],F4=Z[2],F5=Z[3],F6=Z[4]
0155 IF %IN_WEBEC$="Y" THEN GOSUB SET_READONLY ! SSP255686
0200 REM "
0220 A8$="",A9$=""; IF A1$="*" THEN A9$="*",A1$="",A9=20; DIM A[20]
0222 IF A1$="!" THEN A9$="!",A1$="",A9=20; DIM A[20]
0300 REM "IOLISTS
0310 IOLIST A$(1),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19]
0320 IOLIST B$,B0
0330 IOLIST C$
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12]
0350 IOLIST E$,E[0],E[1]
0360 IOLIST F$,F[0],F[1],F[2],F[3]
0362 IOLIST F0$
0370 IOLIST I$,I[0],I[1]
0380 IOLIST S0$,S[0],S[1]
0390 IOLIST B1$
1940 A0=0,A1=0
1950 READ (F2,KEY=A$(1,20),DOM=1951)
2000 REM "Read PO5 (OPEN PO BY ITEM) records"
2010 B$=KEY(F2,END=5000); READ (F2)
2020 IF B$(1,20)<>A$(1,20) THEN GOTO 5000
2100 REM "LOOK FOR GENERAL SHIPPING INSTRUCTIONS (PO3)
2102 READ (F6,KEY=B$(25,8)+"     ",DOM=2000)IOL=0362
2105 DIM C$(314),D$(91),D[12]
2109 REM "READ PO HEADER (PO1)
2110 FIND (F4,KEY=B$(25,9),DOM=2010)IOL=0330
2112 REM "READ PO LINE (PO2)
2115 FIND (F5,KEY=B$(25,12),DOM=2010)IOL=0340; IF D$(14,1)="Y" AND B$(37,1)=" " THEN GOTO 2010
2116 N=N+1,N$=N$+B$(25,12),N0$="*"
2120 GOSUB 3100
2130 A0=A0+B0
2140 IF B0>0 THEN ORDER$=B$(25,9); GOTO 5000; REM "If we found an open PO with any open qty, return that order#
2190 GOTO 2000
3100 REM "GET number left to ship
3105 B0=0,B1=0
3110 DIM F[3]
3114 REM "if general shipping use amount left on line else get amount from split ship record
3115 IF B$(37,1)=" " THEN B0=D[1],B1=D[6],F9$=F0$(11,5); GOTO 3120 ELSE READ (F6,KEY=B$(25,8)+" "+B$(34,3)+B$(37,1),DOM=3116)IOL=0360; B0=F[0]-F[2],B1=F[2],F9$=F$(11,5); GOTO 3120 ! SSP286398, add GOTO 3120 ! SSP295316, if general shipping the set variables and goto 3120 else check for spec ship record and if not found and in EC then we want the WARN message
3116 IF %IN_WEBEC$="Y" THEN B0=0,B1=0,MESS$="FM2UZP LINE 3116 PO5|"+B$+"|CHECK PO3 FOR ORDER|"+B$(25,8)+"|LINE|"+B$(34,3)+"|"; MX=FN%_LOG_MESSAGE_WITH_FLUSH("WARN",MESS$); GOTO 3140 ! SSP286398
3120 IF A9$="*" THEN GOSUB 3200 ELSE IF A1$>"" THEN IF F9$<>A1$ THEN B0=0,B1=0
3140 IF B0<0 THEN B0=0
3145 RETURN 
3200 REM "RETURN LOCATIONS
3210 P=POS(F9$=A2$,5); IF P=0 THEN A2$=A2$+F9$; GOTO 3210 ELSE A2=INT(P/5)
3220 IF A2>A9 THEN A9=A2*2,A2$="",A0=0,A1=0; DIM A[A9]; EXITTO 0221
3230 A[A2]=A[A2]+B0
3290 RETURN 
3300 REM "PO INFORMATION
5000 REM 
5050 GOTO 9900
7400 SET_READONLY:! SSP255686
7410 SET_PARAM 'XI'
7420 SET_READONLY_END:RETURN 
7430 CLEAR_READONLY:! SSP255686
7435 SET_PARAM -'XI'
7440 CLEAR_READONLY_END:RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 9761,9900
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 IF %IN_WEBEC$="Y" THEN GOSUB CLEAR_READONLY ! SSP255686
9910 IF Z$>"" THEN Z$="END"; SETERR 9911; GOSUB 9750
9915 SETERR 0000
9920 IF A9$="*" THEN A1$=A2$
9950 EXIT 
9999 END 
56000 REM "255686-DBE:  RT-19186 - 00-A00RGG - Error 0, FM2UZO, line 2115 in  
56002 REM "286398-see 286245/130; EC3WS1 calls FM2UZP for On PO, gets hung.   
56004 REM "295316-WEB1.log has enormous amt of WARN msgs FM2UZP LINE 3116     
