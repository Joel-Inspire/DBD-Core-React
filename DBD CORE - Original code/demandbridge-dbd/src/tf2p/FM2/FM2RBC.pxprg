0010 REM "Packing List Printing - Format Driven <FM2RBC>
0035 REM "5.7 - 05/18/23 - 14.106927 - dmm - SSP# 307446
0037 REM "307446-DBD-380; Error 12 when EC module not present                
0040 REM "Copyright 2023 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 SETERR 0060; ENTER Q0$; CALLED$="Y"; GOTO 0090; REM "Called from FM2RBY, WO120202
0060 IF %GUI=0 THEN BEGIN 
0090 SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="FM2RBC",X1$="Packing List Printing"
0115 BSY_ORD$=""
0120 DIM A$(350),B$(82),B[21],C$(297),L$(20),L[1],S1$(40),E[3],A[13],S$(40),I[19],X9[200],Y9[200],Y8[4],M$(21),M[2],F0[31],FORM$(448),X9$(200) ! SSP242403, add X9$
0125 DIM PO3[4] ! [SSP-201588]
0140 Z0$="-###,###.00",Z1$="-##,##0",Z2$="-###,##0",M4$="-00000000.00",M4=LEN(M4$),M5$="-#####",Z3$="-###,###",Z4$="-####.00",Z5$="-#####.00",Z6$="-###.0",M0$="-###"
0150 SYMBOLS$="!?*^" ! WO214478, check for symbols in first byte of bin location, strip for bin order sort
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FNE$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+Z9$(1,2)
0180 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0190 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
0210 T=1,T0=1,T1=1
0220 W3=85,P0=1
0225 PMODE=0 ! SSP 241023
0227 CURR_ORD$=""
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0292 REM "Initialize logging - in Unattended printing mode - 257735
0294 IF %UNATTEND THEN {
0296 LOG_OPTIONS$="A",LOG_FILE$="UNATTENDED."+%UNATTEND_GROUP$+"."+FN%GET_BASENAME$(PGN)+".log"; CALL "ZZ2LOG;OPEN_LOG",ERR=*NEXT,X3$,X4$,LOG_FILE$,LOG_OPTIONS$,%LOG_CHANNEL
0297 IF NOT(%LOG_CHANNEL) THEN %LOG_CHANNEL=FN%FFN(LOG_FILE$) ! In case the file was already open in a previous call (to handle second printing scenario)
0298  }
0300 REM "I/O lists
0305 REM "IOLIST FOR FS1 - Sales order header
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13]
0314 IOLIST Y8$,Y8[0],Y8[1],Y8[2],Y8[3],X9$(1) ! SSP242403, make sure X9$ will be length of DIM in this program by adding the (1)
0315 IOLIST X9[0],Y9[0],X9[1],Y9[1],X9[2],Y9[2],X9[3],Y9[3],X9[4],Y9[4],X9[5],Y9[5],X9[6],Y9[6],X9[7],Y9[7],X9[8],Y9[8],X9[9],Y9[9],X9[10],Y9[10],X9[11],Y9[11],X9[12],Y9[12],X9[13],Y9[13],X9[14],Y9[14],X9[15],Y9[15],X9[16],Y9[16],X9[17],Y9[17],X9[18],Y9[18],X9[19],Y9[19],X9[20],Y9[20],X9[21],Y9[21],X9[22],Y9[22],X9[23],Y9[23],X9[24],Y9[24],X9[25],Y9[25],X9[26],Y9[26],X9[27],Y9[27],X9[28],Y9[28],X9[29],Y9[29],X9[30],Y9[30],X9[31],Y9[31],X9[32],Y9[32],X9[33],Y9[33],X9[34],Y9[34],X9[35],Y9[35],X9[36],Y9[36],X9[37],Y9[37],X9[38],Y9[38],X9[39],Y9[39],X9[40],Y9[40],X9[41],Y9[41],X9[42],Y9[42],X9[43],Y9[43],X9[44],Y9[44],X9[45],Y9[45],X9[46],Y9[46],X9[47],Y9[47],X9[48],Y9[48],X9[49],Y9[49],X9[50],Y9[50],X9[51],Y9[51],X9[52],Y9[52],X9[53],Y9[53],X9[54],Y9[54],X9[55],Y9[55],X9[56],Y9[56],X9[57],Y9[57],X9[58],Y9[58],X9[59],Y9[59],X9[60],Y9[60],X9[61],Y9[61],X9[62],Y9[62],X9[63],Y9[63],X9[64],Y9[64],X9[65],Y9[65],X9[66],Y9[66],X9[67],Y9[67],X9[68],Y9[68],X9[69],Y9[69],X9[70],Y9[70],X9[71],Y9[71],X9[72],Y9[72],X9[73],Y9[73],X9[74],Y9[74],X9[75],Y9[75],X9[76],Y9[76],X9[77],Y9[77],X9[78],Y9[78],X9[79],Y9[79],X9[80],Y9[80],X9[81],Y9[81],X9[82],Y9[82],X9[83],Y9[83],X9[84],Y9[84],X9[85],Y9[85],X9[86],Y9[86],X9[87],Y9[87],X9[88],Y9[88],X9[89],Y9[89],X9[90],Y9[90],X9[91],Y9[91],X9[92],Y9[92],X9[93],Y9[93],X9[94],Y9[94],X9[95],Y9[95],X9[96],Y9[96],X9[97],Y9[97],X9[98],Y9[98],X9[99],Y9[99],X9[100],Y9[100],X9[101],Y9[101],X9[102],Y9[102],X9[103],Y9[103],X9[104],Y9[104],X9[105],Y9[105],X9[106],Y9[106],X9[107],Y9[107],X9[108],Y9[108],X9[109],Y9[109],X9[110],Y9[110],X9[111],Y9[111],X9[112],Y9[112],X9[113],Y9[113],X9[114],Y9[114],X9[115],Y9[115],X9[116],Y9[116],X9[117],Y9[117],X9[118],Y9[118],X9[119],Y9[119],X9[120],Y9[120],X9[121],Y9[121],X9[122],Y9[122],X9[123],Y9[123],X9[124],Y9[124],X9[125],Y9[125],X9[126],Y9[126],X9[127],Y9[127],X9[128],Y9[128],X9[129],Y9[129],X9[130],Y9[130],X9[131],Y9[131],X9[132],Y9[132],X9[133],Y9[133],X9[134],Y9[134],X9[135],Y9[135],X9[136],Y9[136],X9[137],Y9[137],X9[138],Y9[138],X9[139],Y9[139],X9[140],Y9[140],X9[141],Y9[141],X9[142],Y9[142],X9[143],Y9[143],X9[144],Y9[144],X9[145],Y9[145],X9[146],Y9[146],X9[147],Y9[147],X9[148],Y9[148],X9[149],Y9[149],X9[150],Y9[150],X9[151],Y9[151],X9[152],Y9[152],X9[153],Y9[153],X9[154],Y9[154],X9[155],Y9[155],X9[156],Y9[156],X9[157],Y9[157],X9[158],Y9[158],X9[159],Y9[159],X9[160],Y9[160],X9[161],Y9[161],X9[162],Y9[162],X9[163],Y9[163],X9[164],Y9[164],X9[165],Y9[165]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21]
0335 REM "IOLIST FOR AR1 - Customer Masterfile
0340 IOLIST D$
0345 REM "IOLIST FOR FM0 - Location Masterfile
0350 IOLIST E$,E[0],E[1],E[2],E[3]
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10]
0365 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15],I[16],I[17],I[18],I[19]
0370 IOLIST G$
0371 IOLIST G2$
0372 IOLIST G1$
0375 REM "IOLISTS FOR AR3 - Salesperson Masterfile
0380 IOLIST C1$,C[0],C[1]
0382 IOLIST H0$
0390 IOLIST R$
0395 IOLIST R0$,R[0],R[1],R[2],R[3],R[4],R[5],R[6],R[7],R[8],R[9],R[10]
0410 IOLIST E0$,E0[0],E0[1],E0[2],E0[3],E0[4],E0[5],E0[6]
0420 IOLIST L$,L[0],L[1]
0430 IOLIST M$,M[0],M[1]
0440 IOLIST F0$,F0[0],F0[1],F0[2],F0[3],F0[4],F0[5],F0[6],F0[7],F0[8],F0[9],F0[10],F0[11],F0[12],F0[13],F0[14],F0[15],F0[16],F0[17],F0[18],F0[19],F0[20],F0[21],F0[22],F0[23],F0[24],F0[25],F0[26],F0[27],F0[28],F0[29],F0[30],F0[31]
0460 IOLIST C0$,C0[0],C0[1],C0[2],C0[3],C0[4],C0[5],C0[6],C0[7],C0[8],C0[9],C0[10],C0[11],C0[12],C0[13],C0[14],C0[15]
0490 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0495 IOLIST PO3$,PO3[0],PO3[1],PO3[2],PO3[3] ! [SSP-201588]
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0509 REM "Don't use 15,16,17, used on 4105
0510 Y$="01O PO6...  02O FS1...  03O FS2...  05O ICF...  06O PO3...  07O FM0...  09O IC1...  10O AR3...  11O FMP...  12O AR4...  13O ZZPARM  14O FM1...  18O ZY1...  19O EC8...  20O PO6...  21O ICN...  31O DT0...  32S ZZPARM  33O DT6...  34O DTP...  35O SH5...  36O FV1...  37O EDW...  38O ZZS...  39OSFS2...  " ! [SSP-201588]
0511 IF FN%HAS_MODULE("EC") THEN Y$+="50O EEG...  " ! SSP290922, if EC module installed then open EEG
0520 GOSUB 9750
0521 MMF=HFN; REM SSP 206959
0522 OPEN (MMF)"*memory*"; REM SSP 206959
0524 GOSUB SET_READONLY ! SSP233147
0525 READ (Z[13],KEY=X3$(9,3)+"I/C")P8$
0530 DIM G9$(618); READ (Z[7],KEY="D"+S$(1,10)+"0001",DOM=0531)G9$ ! WO220758, changed DIM from 200 to 618
0535 READ (Z[13],KEY=X3$(9,3)+"F/M")FM_PARM$
0538 CNTRY$="",DFLT_CNTRY$=""; IF STP(MID(FM_PARM$,344,2),2)<>"" THEN DFLT_CNTRY$=MID(FM_PARM$,344,2) ! SSP 307210
0540 READ (Z[13],KEY=X3$(9,3)+"A/R")P9$
0550 READ (Z[13],KEY=X3$(9,3)+"AR1")P5$
0551 DIM XMLOUT$(512); READ (Z[13],KEY=X3$(9,3)+"XMLOUT",DOM=*NEXT)XMLOUT$(1) ! SSP282705
0552 READ (Z[13],KEY=X3$(9,3)+"G/B",DOM=0553)GB$; GB$="Y"
0553 GOSUB CLEAR_READONLY; OOP=0; IF FM_PARM$(319,1)="Y" THEN IF TCB(29)>=7100000 THEN OOP=NEW("DTGDTP") ! [SSP-201588] WO220758, move line 523 to line 553, only do this if OPS parm set for TOD packing list. SSP233147-add clear of READONLY
0554 B9=0; CALL "BC2VER",ERR=0560,"","",""; B9=1; REM "B9=1 means use Barcode module
0555 DIM D9$(11),A0$(33),A0[10],Y8[5]; D9$(1)="856",D9$(11,1)=V0$(60,1); CALL "BC2FMZ",X3$,X4$,D9$,A0$,A0{ALL},X9{ALL},X9$,Q1$,Q{ALL},C0; IF C0=0 THEN W3=A0[2],Y8[0]=A0[0],Y8[2]=A0[4],Y8[3]=A0[5]; GOTO 0601 ELSE B9=0; GOTO 0560
0559 SAVE_XI=PRM('XI'); SET_PARAM 'XI'
0560 READ (Z[13],DOM=0561,KEY="FORMATPL"+V0$(60,1))IOL=0314,IOL=0315; SET_PARAM 'XI'=SAVE_XI; GOTO 0600
0561 SET_PARAM 'XI'=SAVE_XI
0570 CALL "ZZPROM",".4",X3$,0,"Invalid Flexible Format Code: "+V0$(60,1),"","",0; GOTO 9920
0600 W3=Y8[1]
0665 GOSUB 8980
0670 GB_FIRST_TIME=1; REM "For 498
0680 MEM_FL=HFN; OPEN (MEM_FL)"*MEMORY*" ! [SSP-201588]
0685 TOD_OUTPUT_TYPE$=PAD("WHS_PACKING_LIST",20) ! [SSP-201588]
0687 ZZPARM_FL=Z[32] ! [SSP-201588]
0688 DT0_FL=Z[31] ! [SSP-201588]
0690 PO3_FL=Z[6] ! [SSP-201588]
0692 DT6_FL=Z[33] ! [SSP-201588]
0694 DTP_FL=Z[34] ! [SSP-201588]
0695 FLEX_FORMAT_CODE$=V0$(60,1) ! [SSP-201588]
0698 TOD_UPDATE=0 ! [SSP-201588]
0700 REM "Open Printer
0720 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0721,9920
0745 X$=V3$,ITEM_CODE$="856"+DIM(7)+V0$(60,1); CALL "EF2PRM",ERR=0746,X3$,X4$,X$,E7$,E6$,ITEM_CODE$,ITEM_PARM$; IF E7$(144,2)="JF" THEN JETFORM_MODE=1,JETFORM_DEV=W9,JF_CHAN=W9,PMODE=JETFORM_MODE ELSE IF E7$(144,2)="UF" THEN UNFORM_MODE=2,UNFORM_DEV=W9,PMODE=UNFORM_MODE ! 171188,180510 SSP 241023
0746 IL_ARCHIVE=0; IF JETFORM_MODE=0 AND UNFORM_MODE=0 AND %HAS_IMAGE_LIB THEN TMP=MSK(V0$(59,12),"![^ ][^ ]"); IF TMP THEN IL_ARCHIVE=1,ILA$=""; DIM EF_PARAMS$(200); EF_PARAMS$(146,3)="J"; IL_DEVICE$=V0$(59+TMP,2); IL_DEVICE=HFN; OPEN (IL_DEVICE)IL_DEVICE$; JF_CHAN=IL_DEVICE ! 180510 SSP 241023
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[3]; U=13,U0=3,U[0]=0,U[1]=1,U[2]=4,U[3]=8,T0=0,U0$="    ",T5$="                "; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0920 V2$=V2$(1,26)
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0989 V4$=V4$(1,5)+"  "+V4$(6) ! SSP#206694
0990 READ (U1,KEY=V4$,DOM=0991)
0995 IF CALLED$<>"Y" THEN GOSUB 6000
0996 PICK_LIST$=STP(V0$(212,60)); PICK_LIST$=STP(PICK_LIST$,3,",") ! [197451]
0997 GOSUB 5700; REM write to work/sort file
0999 EOF=0,BLD$=" ",LAST$="",PL_ALT_SELECTION$=""
1000 WHILE EOF=0 ! not end of file
1010 GOSUB GET_ORDER; IF EOF=0 THEN GOSUB LOCK_ORDER; GOSUB BUILD_LIST
1050 WEND 
1055 BLD$="1"
1057 READ (Z[4],KEY=BLD$,ERR=*NEXT)
1060 GOSUB GET_ORDER; IF EOF AND LAST$="" THEN GOTO 5000
1070 IF EOF=0 THEN {
1075 IF LAST$="" THEN GOSUB 7500; LAST$=U$; GOTO 1060
1080 IF LAST$(2,12)=U$(2,12) THEN GOSUB 7500; GOTO 1060; REM if same whs & order build P0$ ( same page print)
1099  }
1100 REM "Get record"
1145 XP=PRM('XI'); SET_PARAM 'XI'
1150 READ (Z[2],KEY=LAST$(6,8),DOM=1060)IOL=0310
1152 SET_PARAM 'XI'=XP
1155 A9$="C"+A$(6,10); REM "Set A9$ for use by Ext flex format
1160 GOSUB INIT_FF_SETTINGS ! SSP257735
1300 REM "Read other data
1320 Y$="07C FM0...  12C AR4...  07O AR1...  12O FSV...  "; GOSUB 9750
1325 GOSUB SET_READONLY ! SSP#251709
1330 DIM D$(599); FIND (Z[7],KEY=A$(6,10),DOM=1331)IOL=0340; IF X9[55]>0 AND POS(" "<>D$(46,10))>0 THEN FIND (Z[7],KEY=D$(46,10),DOM=1331)IOL=0340
1335 DIM CUST_PARM$(243); READ (Z[11],KEY="D"+A$(6,10),DOM=*NEXT)CUST_PARM$,PARM0,PARM1,PARM2,PARM3,PARM4,PARM5 ! WO155872
1340 IF P5$(64,1)<>"Y" OR P9$(109,1)<>"Y" THEN GOTO 1370
1360 FIND (Z[12],KEY=A$(118,8),DOM=1361)X$; D$(56,87)=X$(54,87); IF POS(X9$(25,1)="nN")<>0 AND X$(19,35)<>DIM(35) THEN D$(11,35)=X$(19,35); REM "SSP# 182649 !ssp#238796
1370 Y$="07C AR1...  12C FSV...  07O FM0...  12O AR4...  "; GOSUB 9750
1375 GOSUB CLEAR_READONLY ! SSP#251709
1380 REM 
1385 PRINT_LINE=1
1390 IF X9[139]>0 OR X9[140]>0 THEN GOSUB CHECK_ORDER_LINES ! WO246220
1392 GOSUB BUILD_COMPANION_LIST
1395 DIM FV1$(818); READ (Z[36],KEY=A$(118,8),DOM=*NEXT)FV1$(1) ! WO249287
1500 REM "Print Data
1515 P1=1,P9=1
1520 IF P1>P0 THEN GOTO 1700
1525 IF FM_PARM$(319,1)="Y" THEN GOSUB OUTPUT_DIRECTOR_TRIGGER ! SSP248639
1530 GOSUB 5400
1540 GOSUB 5500
1560 GOSUB 2000
1565 T9=0,T8=0,T7=0; DIM T9[10]; GOSUB 2400
1567 L0=0,PL_LINE=0
1568 GOSUB 3500
1569 IF P0>1 THEN F5=115,F5$="*Continued*"; GOSUB 8300; REM "WO130135
1570 GOSUB 2900; GOSUB 8980; PL_LINE=PL_LINE+1; REM "108433
1580 P1=P1+1
1585 IF TOD_UPDATE THEN GOSUB OUTPUT_DIRECTOR_FINISH ! SSP248639
1590 GOTO 1520
1900 P0$="",P1$="",P2$="",P0=1
1940 IF POS("UR"=V0$(59,12)) AND NOT(NUL(PL_ALT_SELECTION$)) THEN A$(374,12)=""; PREV_WHSE$+="ALT"; P0$=PL_ALT_P0$; P1$=PL_ALT_P1$; GOTO 1160 ! 263161- P/L Print option "UR"- If order was printed using an alt selection in A$(374,12) then reprint same order using original selection as well - only if option "UR" specified
1950 IF EOF THEN GOTO 5000 ELSE GOSUB 7500; LAST$=U$; GOTO 1060
2000 REM "Print 'header' section
2001 JF_OPT$="N"; IF UNFORM_MODE AND A1<>1 THEN IF PREV_WHSE$<>LAST$(2,12) THEN PREV_WHSE$=LAST$(2,12) ELSE JF_OPT$="E"; REM "246611 - option to create one file for multi-page PL, works in Unform only, 251376!SSP#269203 A1=1 means test pattern
2002 IF %UNATTEND THEN CALL "ZZ2LOG;LOG_MSG",ERR=*NEXT,X3$,X4$,%LOG_CHANNEL,"INFO|"+FN%ZZDISP$(MID(LAST$,6,8),"O/P")+"|LINE|"+LAST$+"|"+TBL(NUL(MID(A$,374,12)),"ALT SEL|"+MID(A$,374,12)+"|",""),%LOG_DEBUG ! 257735
2004 DIM P$(Y8[0]*W3)
2005 W=0,L0=1,PL_LINE=1
2006 IF JETFORM_MODE THEN GOSUB IMAGE_LIBRARY_SETUP; CALL "EF2JET",X3$,X4$,E7$,"N",JETFORM_DEV,ITEM_PARM$,JOB_MODIFIER$,RET$; REM "If in jetform mode and this is the first page for this po start a new file.
2007 IF IL_ARCHIVE THEN GOSUB IMAGE_LIBRARY_SETUP; CALL "EF2JET",X3$,X4$,E7$,"N",IL_DEVICE,ITEM_PARM$,JOB_MODIFIER$,RET$; REM "180510 If in IL_ARCHIVE mode and this is the first page for this PL start a new file.
2008 IF UNFORM_MODE THEN GOSUB IMAGE_LIBRARY_SETUP; CALL "EF2UNF",X3$,X4$,E7$,JF_OPT$,UNFORM_DEV,ITEM_PARM$,JOB_MODIFIER$,RET$; REM "If in unfor mode and this is the first page for this pl start a new file. SSP 241023, 246611 - option to create one file for multi-page PL, works in Unform only
2010 IF B9=1 THEN F5=0,F5$=""; GOSUB 8300; REM "To print free item headings for this item
2043 REM "A1=1 means test pattern, add logic here to set G0$ to vendor, plant address if needed for DS warehouse printing.
2044 G0$=G9$
2045 IF A1<>1 THEN READ (Z[7],KEY="D"+S$(1,10)+LAST$(2,4),DOM=2046)G0$
2050 GOSUB 2100
2060 GOSUB 2200
2070 GOSUB 2300
2090 RETURN 
2100 REM "Print top section, incl G0$,if needed, date, order#, cus# and cus p/o #
2104 G9=0; REM "Set G9 = 1 to print G0$(dist address) in upper left corner
2106 PDF_SEQ$=A$(1,1); IF PDF_SEQ$=DIM(1) THEN PDF_SEQ$="0" ! SSP227065
2110 REM IF G9=1 THEN LET Y5$(3)=G0$(16,35)
2115 CALL "ZZDISP","DX",A$(16,6),"",X3$,F5$,"",0,0,X4$; F5=1; GOSUB 8300; F5$=F5$(1,6)+F5$(9),F5=32; GOSUB 8300; F5=33; GOSUB 8300
2117 IF X9[139]>0 THEN F5=139,F5$=MULT_WHSE$; GOSUB 8300 ! WO246220, MULTIPLE WAREHOUSES
2118 IF X9[140]>0 THEN F5=140,F5$=SLS_ORD$; GOSUB 8300 ! WO246220, SALES ORDER
2120 CALL "ZZDISP","AX",A$(118,8),"O/P",X3$,F5$,"",0,0,X4$; F5=2; GOSUB 8300; F5=35; GOSUB 8300; F5=41; GOSUB 8300
2121 CALL "ZZDISP","AX",A$(118,8),"O/P",X3$,F5$,"",0,0,X4$; IF NOT(UNFORM_MODE) OR (UNFORM_MODE AND JF_OPT$="N") THEN F5=122,F5$=STP("PDFFILE:"+X3$(9,3)+DLM+"PL"+DLM+G0$(12,4)+DLM+F5$+"+"+STR(P9),3," ")+"_"+PDF_SEQ$; GOSUB 8300 ! 166626 SSP 227065,246611 - option to create one file for multi-page PL, works in Unform only
2123 F5=159,F5$=XMLOUT$(331,40); GOSUB 8300 ! SSP282705, FlowPoint Token
2124 ARG$=""; CALL "ZZDISP","AX",D$(220,9),"ARG",X3$,ARG$,"",0,0,X4$; F5=158,F5$=ARG$; GOSUB 8300 ! WO275545, customer category
2125 CALL "ZZDISP","AX",A$(6,10),"A/R",X3$,F5$,"",0,0,X4$; F5=3; GOSUB 8300
2126 F5=105,F5$=D$(411,20); GOSUB 8300; REM "WO101127
2127 IF A$(198,1)="Y" THEN F5=106,F5$="No Overruns"; GOSUB 8300; REM "WO106348
2128 F5=90,F5$=D$(11,35); GOSUB 8300
2129 F5=107,F5$=A$(87,2); GOSUB 8300; REM "WO106581, Terms code
2130 F5=4,F5$=A$(28,15); GOSUB 8300; F5=129; GOSUB 8300; F5=130; GOSUB 8300 ! WO241665 second and third printings of customer P/O number
2131 F5=109,F5$=A$(203,20); GOSUB 8300; F5=110,F5$=A$(223,3); GOSUB 8300; REM "WO106756, GB-Imprint color and samples to distributor
2132 F5=31,F5$=STR(P9); GOSUB 8300; IF P9>1 THEN F5=29,F5$="Page: "+STR(P9); GOSUB 8300
2134 IF A$(48,1)="Y" THEN F5=30,F5$="*Backorder*"; GOSUB 8300
2135 ORDER$=A$(118,8); PERFORM "ECGM3F;GET_3P_INFO",ERR=*NEXT; IF FOUND_3PINFO THEN F5$=STP(ORDER_ID_3P$),F5=165; GOSUB 8300 ! SSP307433-DBD-332, 3rd Party Order ID DBD-380-SSP307446
2140 F5=26,F6=1,F5$=G0$(51,30); GOSUB 8450
2142 CNTRY$=MID(G0$,380,2) ! SSP 307210
2145 A5$=G0$(111,27); GOSUB 8400; IF POS(" "<>G0$(81,30))=0 THEN A3$=A6$,A4$="" ELSE A3$=G0$(81,30),A4$=A6$
2150 F5=26,F6=2,F5$=A3$; GOSUB 8450
2155 F5=26,F6=3,F5$=A4$; GOSUB 8450
2157 F5=124,F5$=G0$(568,10); GOSUB 8300 ! WO220758, warehouse business unit
2160 IF LEN(A$)<200 THEN A$=A$+" "; GOTO 2160 ELSE F5=78,F5$=A$(169,3); GOSUB 8300; F5=79,F5$=A$(172,3); GOSUB 8300; IF POS(" "<>A$(175,6))>0 THEN F5=80,F5$=FND$(A$(175,6)); GOSUB 8300
2170 IF A$(1,1)<>"1" AND A$(1,1)<>" " THEN F5=92,F5$="*REPRINT ("+STR(NUM(A$(1,1))-1)+")"; GOSUB 8300
2172 X$=DTE(0:"YYYYMMDD"),FS1_DATET$=CHR(NUM(X$(1,3))-125)+X$(4)+STR(INT(TIM):"00")+STR(100*FPT(TIM):"00"); IF POS(X3$(9,3)="568589")<>0 THEN READ (Z(2),KEY=A$(118,8),DOM=*NEXT)IOL=0310; IF POS(X3$(9,3)="568589",3)<>0 THEN A$(272,10)=FS1_DATET$; WRITE (Z(2),KEY=A$(118,8))IOL=0310
2180 F5=93,X$=STR(INT(TIM):"00")+STR(100*FPT(TIM):"00"); CALL "ZZDISP","TX",X$,"",X3$,F5$,"",0,0,X4$; X$=DAY,X$=X$(7,2)+X$(1,2)+X$(4,2); F5$=FNE$(X$)+" "+F5$; IF X9$(F5,1)="H" THEN F5$="Printed: "+F5$
2182 GOSUB 8300
2185 IF P9$(114,1)="Y" THEN CALL "AR2EBJ",X3$,X4$,2,D$(1,10),F5$; IF F5$>"" THEN F5=102; GOSUB 8300; IF UNFORM_MODE THEN IF X9[F5]<>0 THEN F5$=DIM(10),F5=13; GOSUB 8350; REM "WO99712 SSP241023
2188 IF LEN(LAST$)=0 THEN F5$=WHSE$ ELSE IF LAST$(2,1)="9" THEN F5$="0"+LAST$(3,3) ELSE F5$=LAST$(2,4); REM "WO#133821
2189 F5=116; GOSUB 8300
2190 GOSUB OUTPUT_ORDER_CUST_REF ! WO249287
2195 RETURN 
2200 REM "Print Sold to and Shipto Addresses
2205 REM "Get ship to name(5600), then compare shipto address to soldto address and decide if sold needs to be printed, S9=1 means yes to print soldto, S9=0 means no
2206 DIM L0$(141)
2207 GOSUB 5600; GOSUB 6350
2209 IF X9[42]=0 AND D$(11,35)+D$(56,87)=E9$(1,35)+E$(46,87) THEN S9=0 ELSE S9=1 ! [SSP-201588]-renumbered
2210 IF TOD_OK THEN S9=1 ! [SSP-201588]
2211 IF S9=0 THEN GOTO 2235
2212 IF X9$(5,1)<>"S" THEN F5=5,F6=-1,F5$="SHIP TO:"; GOSUB 8450
2213 IF X9$(72,1)<>"S" THEN F5=72,F6=-1,F5$="SHIP TO:"; GOSUB 8450
2214 IF POS(X9$(25,1)="Sn",1)<>0 THEN F5=25,F6=-1,F5$="SOLD TO:"; GOSUB 8450 ! SSP#238796
2215 IF X9$(97,1)<>"S" THEN F5=97,F6=-1,F5$="SHIP TO:"; GOSUB 8450
2216 IF X9$(98,1)<>"S" THEN F5=98,F6=-1,F5$="SHIP TO:"; GOSUB 8450
2219 DIM L0$(141)
2220 L0$(1,35)=D$(11,35),L0$(36,35)=D$(56,30)
2222 CNTRY$="" ! SSP 307210 AR1
2225 A5$=D$(116,27); GOSUB 8400
2226 REM LET F5=89,F5$=A8$; GOSUB 08300
2230 IF POS(" "<>D$(86,30))=0 THEN L0$(71,35)=A6$ ELSE L0$(71,35)=D$(86,30),L0$(106,35)=A6$
2231 REM "IF POS(" "<>D$(86,30))=0 AND POS(X9$(F5,1)="Zs")=0 THEN L0$(71,35)=A6$ ELSE IF POS(X9$(F5,1)="Zs")>0 OR X9$(5,1)="Z" THEN L0$(71,35)=D$(86,30),L0$(106,35)=A6$
2235 IF FNS$(A$(129,20))>"" THEN F5=69,F5$=A$(129,20); IF X9$(69,1)="A" THEN F5$="Attn: "+F5$; GOSUB 8300 ELSE GOSUB 8300
2240 REM "Setup Ship to
2245 DIM L1$(210),L1_DTP$(210); L1=0,L1_DTP=0 ! WO220758, adding L1_DTP$ and L1_DTP for call to UPDDTP
2249 IF POS(" "<>E$(225,35))=0 THEN E$(225,35)=D$(11,35)
2250 L1$(L1*35+1,35)=E$(225,35),L1_DTP$(L1_DTP*35+1,35)=E$(225,35),L1=L1+1,L1_DTP+=1 ! WO220758
2255 IF LEN(STP(E$(16,30),2))=30 THEN ATTN$="Attn:" ELSE ATTN$="Attn: " END_IF ; IF POS(" "<>FN%CVT4$(E$(16,30)))<>0 THEN L1$(L1*35+1,35)=ATTN$+E$(16,30),L1_DTP$(L1_DTP*35+1,35)=ATTN$+E$(16,30),L1=L1+1,L1_DTP+=1 ELSE IF POS(" "<>FN%CVT4$(E$(16,30)))=0 AND (MID(X9$,5,1)="Z" OR MID(X9$,F5,1)="Z") THEN L1$(L1*35+1,35)=DIM(35),L1=L1+1; IF POS(X3$(9,3)="112")>0 THEN L1$((L1-1)*35+1,35)=E$(16,30) ! WO220758!SSP#304762
2256 IF POS(" "<>FN%CVT4$(E$(16,30)))=0 AND TOD_OK THEN L1_DTP$(L1_DTP*35+1,35)=DIM(35),L1_DTP+=1 ! WO220758
2260 L1$(L1*35+1,35)=E$(46,30),L1_DTP$(L1_DTP*35+1,35)=E$(46,30),L1=L1+1,L1_DTP+=1 ! WO220758
2265 IF POS(" "<>E$(76,30))<>0 THEN L1$(L1*35+1,35)=E$(76,30),L1_DTP$(L1_DTP*35+1,35)=E$(76,30),L1=L1+1,L1_DTP+=1 ELSE IF POS(" "<>E$(76,30))=0 AND (MID(X9$,F5,1)="Z" OR MID(X9$,5,1)="Z") THEN L1$(L1*35,35)=DIM(30),L1=L1+1 ELSE IF POS(" "<>E$(76,30))=0 AND TOD_OK THEN L1_DTP$(L1_DTP*35,35)=DIM(30),L1_DTP+=1 ! WO220758
2268 CNTRY$=MID(E$,383,2) ! SSP 307210
2270 A5$=E$(106,27); GOSUB 8400; L1$(L1*35+1,35)=A6$,L1_DTP$(L1_DTP*35+1,35)=A6$ ! WO220758
2273 L1$(176,35)=E$(175,35)
2274 L1=0,L1_DTP=0; REM "Now print out the setup strings, WO220758
2275 FOR L9=0 TO 4
2276 IF A1<>0 THEN L0$=L1$
2278 IF FM_PARM$(244,1)="Y" AND L9=1 THEN GOSUB 4050
2279 DTP_MODE=1 ! WO220758
2280 F5=5,F6=L9+L1,F5$=L1$(L9*35+1,35),DTP_F5$=L1_DTP$(L9*35+1,35); GOSUB 8450; F5=72; GOSUB 8450; F5=97; GOSUB 8450; F5=98; GOSUB 8450; IF S9=1 THEN IF L9<>4 THEN F5=25,F6=L9,F5$=L0$(L9*35+1,35),DTP_F5$=L0$(L9*35+1,35); GOSUB 8450 ! WO220758, WO234689
2281 F5=43,F6=L9+L1,F5$=L1$(L9*35+1,35),DTP_F5$=L1_DTP$(L9*35+1,35); GOSUB 8450; IF L9<>4 THEN F5=42,F6=L9,F5$=L0$(L9*35+1,35),DTP_F5$=L0$(L9*35+1,35); GOSUB 8450 ! WO220758, WO234689
2282 NEXT L9
2283 REM LET F5=90,F5$=A8$; GOSUB 08300
2284 DTP_MODE=0 ! WO220758
2285 F5=6,F5$=L1$(176,35); GOSUB 8300
2286 F5=164,F5$=E$(383,2); GOSUB 8300 ! SSP307210-DBSPT-62 Ship to Country
2287 F5=101,F5$=E$(135,15); GOSUB 8300; REM "Inside delivery, WO94880
2288 F5=121,F5$=E$(151,15); GOSUB 8300; REM "Ship with, SSP146173
2289 F5=141,F5$=MID(E$,347,15); GOSUB 8300 ! WO246946, PO3 account number
2290 GOSUB 2500
2295 RETURN 
2300 REM "Print Ribbon Line
2310 CALL "ZZDISP","DX",A$(55,6),"",X3$,F5$,"",0,0,X4$; F5=7; GOSUB 8300
2315 DIM R$(170); FIND (Z[10],KEY=A$(93,4),DOM=2316)IOL=0390
2316 IF A1<>0 THEN R$(149,20)=DIM(20,"X")
2317 F5=8,F5$=R$(149,10); IF X9$(8,1)="F" THEN F5$=R$(149,20) END_IF ; GOSUB 8300; F5=34,F5$=A$(93,4); GOSUB 8300; REM "SSP108913, F=print full 20
2320 REM 
2325 DIM X$(30); FIND (Z[11],KEY="H"+E$(134,1),DOM=2326)X$
2326 IF A1<>0 THEN X$(3,15)="XXXXXXXXXXXXXXX"
2329 REM "Block only big enough to print 12x
2330 F5=9,F5$=X$(3,15); GOSUB 8300; REM " Also had F5$=F5$(1,12)
2331 F5=125,F5$=E$(134,1); GOSUB 8300 ! WO220758, how to ship code
2332 IF MID(X9$,126,1)="O" AND E$(363,20)<>DIM(20) THEN F5$=E$(363,20),F5=126; GOSUB 8300; GOTO 2334 ! SSP291991, if PO3 shipper ID not blank and field 126 has O in type field then output in field 126, bypass lookup in SH5 at line 2333.
2333 IF E$(150,1)<>DIM(1) THEN DIM SH5$(36); READ (Z[35],KEY=A$(6,10)+E$(12,4)+E$(150,1),DOM=*NEXT)SH5$; IF SH5$(16,20)<>DIM(20) THEN F5=126,F5$=SH5$(16,20); GOSUB 8300 ! WO220758, shipper ID from SH5 for this customer/shipto/shipvia
2336 DIM X$(30); IF A1<>0 THEN X$(3,15)="XXXXXXXXXXXXXX" ELSE X$(3,15)=E$(210,15)
2337 CALL "ZZDISP","AX",A$(118,8),"O/P",X3$,ORDER_NO$,"",0,0,X4$; REM "SSP110422
2338 F5=59; IF POS(X3$(9,3)="145",3)<>0 THEN F5$=B$(19,4); GOSUB 8300 ELSE F5$=E$(12,4); GOSUB 8300
2339 F5=91; IF X9$(91,1)="8" THEN F5$=A$(118,8); GOSUB 8300 ELSE IF X9$(91,1)="U" THEN F5$=ORDER_NO$+E$(10,1); GOSUB 8300 ELSE IF X9$(91,1)="S" THEN F5$=A$(118,8)+E$(10,1); GOSUB 8300 ELSE IF X9$(91,1)="9" THEN F5$=A$(118,8)+E$(7,3)+E$(10,1); GOSUB 8300 ELSE F5$=A$(118,8)+E$(12,4); GOSUB 8300; REM "order number+shipto location code for Digital Scale Management System, also SSP110422 ,also (S) ssp#113414
2340 F5=11,F5$=X$(3,15); GOSUB 8300; IF TOD_OK THEN GOSUB OUTPUT_DIRECTOR_SHIPVIA ! SSP248639
2341 IF POS(X3$(9,3)="145",3)<>0 THEN FIND (Z[7],KEY="C"+D$(1,10)+B$(19,4),DOM=2342)E2$; F5=89,F5$=E2$(16,30); GOSUB 8300
2342 F5=111; IF MID(X9$,111,1)="8" THEN F5$=A$(118,8)+A$(227,2) ELSE F5$=A$(118,8)+A$(227,2)+E$(12,4) END_IF ; IF MID(X9$,111,1)="9" THEN F5$=A$(118,8)+E$(7,3)+E$(10,1) END_IF ; GOSUB 8300; REM "109110, like field 91, using additional 2 chars for BO's
2343 F5=127; IF MID(X9$,127,1)="8" THEN F5$=A$(118,8)+A$(227,2) ELSE F5$=A$(118,8)+A$(227,2)+E$(12,4) END_IF ; IF MID(X9$,127,1)="9" THEN F5$=A$(118,8)+E$(7,3)+E$(10,1) END_IF ; GOSUB 8300 ! WO220758, second printing of field 111
2350 DIM X$(30); FIND (Z[11],KEY="F"+E$(133,1),DOM=2351)X$
2355 IF A1<>0 THEN X$(3,15)="XXXXXXXXXXXXXXX"
2360 F5=10,F5$=X$(3,15); GOSUB 8300
2370 IF POS(" "<>D$(205,14))>0 THEN CALL "ZZDISP","POX",D$(205,14),"",X3$,F5$,"",0,0,X4$; F5=56; GOSUB 8300
2380 IF POS(" "<>D$(143,12))>0 THEN CALL "ZZDISP","POX",D$(143,12),"",X3$,F5$,"",0,0,X4$; F5=57; GOSUB 8300
2390 RETURN 
2400 REM "Print line information
2403 I0=(Y8[2]-1)*W3,I1=0,L0=0,PL_LINE=0,SPLIT_SHIP_FOUND=0
2404 IF A1=1 THEN FOR I3=1 TO 2; GOSUB 7700; NEXT I3; GOTO 2490
2405 I1=0,S0$="",B1=0
2406 IF C1>2 THEN IF TOD_OK THEN TOD_SEQ=TOD_SEQ+1 END_IF ; GOTO 2450 ! SSP248639
2407 P7$=P0$
2408 IF P9$(114,1)="Y" AND X9[102]=0 THEN CALL "AR2EBJ",X3$,X4$,2,D$(1,10),F5$; IF F5$>"" THEN F5=12,I1=I1+1; SAVE_TOD_OK=TOD_OK,TOD_OK=0; GOSUB 8350; TOD_OK=SAVE_TOD_OK; IF UNFORM_MODE AND X9[F5]<>0 THEN F5$=DIM(10); F5=13; GOSUB 8350; END_IF ; L0=L0+1,I0=I0+W3*X9[47]+F4*W3,F4=0,PL_LINE=PL_LINE+1 ! SSP 241023, SSP259460, line version of customer comment, don't want TOD output so save off TOD_OK then restore.
2410 IF LEN(P7$)=0 THEN GOTO 2490
2412 READ (Z[3],KEY=A$(118,8)+P7$(11,3))IOL=0320
2415 IF NOT(NUL(B$(230,3))) AND POS(B$(155,1)="MS")>0 THEN READ (Z[39],KEY=A$(118,8)+B$(230,3),DOM=*NEXT)B_MST$; IF MID(B_MST$,18,1)="Y" THEN GOTO 2445 ! For companion message lines that are "M" or "S" lines, if the master line is special shipped, skip line output in the general shipping section, handle in the 2450-2499 special shipping section 
2420 I1=I1+1,PL_LINE=PL_LINE+1; IF JETFORM_MODE THEN FLD_16$="N"
2422 IF TOD_OK THEN TOD_SEQ=TOD_SEQ+1 ! [SSP-201588]
2424 DIM EC8$(62); FIND (Z[19],KEY=A$(118,8)+B$(6,3),DOM=2425)EC8$; F5=120,F5$=EC8$(12,10); GOSUB 8350; F5=118,F5$=EC8$(22,20); GOSUB 8350; F5=119,F5$=EC8$(42,20); GOSUB 8350; REM "128591 - add WebEC 3rd party info
2425 ! SSP283651, MOVE TO LINE 8535 F5=112,F5$=B$(6,3); GOSUB 8350
2426 DIM EDW$(200); FIND (Z[37],KEY=A$(118,8)+B$(6,3),DOM=*NEXT)EDW$(1); F5=152,F5$=EDW$(12,20); GOSUB 8350; F5=153,F5$=EDW$(38,20); GOSUB 8350; F5=154,F5$=EDW$(38,20); GOSUB 8350; REM "WO257735, RC Number, External Field 1, External Field 1 - 2nd Printing
2427 GOSUB 7650
2430 GOSUB 7850
2440 GOSUB 7700
2445 IF LEN(P7$)>13 THEN P7$=P7$(14); GOTO 2410 ELSE P7$=""; GOTO 2490
2450 REM "Print lines from P2$ for spec instr."
2455 P4$=P2$(1,125); SPLIT_SHIP_FOUND=1
2460 READ (Z[6],KEY=A$(118,8)+" "+P2$(126,4),DOM=2490)IOL=0350
2465 READ (Z[3],KEY=E$(166,8)+E$(7,3),DOM=2485)IOL=0320
2470 B1=E[0],F6$="*"; IF X9$(21,1)="O" THEN B1=E[2]; REM "SSP109324, Overrun
2471 GOSUB 7700; F6$=""
2475 ! READ (Z[3],KEY=E$(166,8)+STR(NUM(E$(7,3))+1:"000"),DOM=2476)IOL=0320
2480 IF B$(229,1)="Y" AND NOT(NUL(COMP$)) THEN {
2481 FOR COMP_I=0 TO LEN(COMP$)/6-1
2482 IF MID(COMP$,COMP_I*6+1,3)=MID(P2$,126,3) THEN READ (Z[3],KEY=E$(166,8)+MID(COMP$,COMP_I*6+4,3),DOM=*NEXT)IOL=0320; GOSUB 7700; F6$=""
2483 NEXT COMP_I
2484  }
2485 P2$=P2$(130); IF P2$<>"" THEN IF P2$(1,125)=P4$ THEN GOTO 2460
2490 RETURN 
2500 REM "Vendor Name/Address from 1st P/O matching S/O#
2510 IF X9[77]=0 THEN GOTO 2590
2520 Y$="12C AR4...  12O PO1...  "
2525 GOSUB 9750
2530 READ (Z[12],KEY=A$(118,8),DOM=2531)*
2535 READ (Z[12],END=2580)X$
2540 IF A$(118,8)<>X$(297,8) THEN GOTO 2580 ELSE IF X$(173,1)="S" THEN GOTO 2535
2545 F5=77,F6=0,F5$=X$(21,35); GOSUB 8450
2550 IF POS(" "<>X$(56,30))>0 THEN F5$=X$(56,30),F6=F6+1; GOSUB 8450
2555 IF POS(" "<>X$(86,30))>0 THEN F5$=X$(86,30),F6=F6+1; GOSUB 8450
2560 IF POS(" "<>X$(116,30))>0 THEN F5$=X$(116,30),F6=F6+1; GOSUB 8450
2562 CNTRY$=MID(X$,368,2) ! SSP 307210
2565 A5$=X$(146,27); GOSUB 8400; F5$=A6$,F6=F6+1; GOSUB 8450
2580 Y$="12C PO1...  12O AR4...  "
2585 GOSUB 9750
2590 RETURN 
2900 REM "Send P$ to printer
2902 COPIES_LEFT=1; COPIES_LEFT=COPIES_LEFT+NUM(A$(201,2)); REM "Include additional copies to print
2903 IF JETFORM_MODE AND E7$<>"" THEN GOSUB 4000; CALL "EF2FAX",X3$,X4$,E7$,E6$,W9,X$,J$,JETFORM_MODE,EM$; GOTO 2935; REM "if faxing setup tags and call SSP 241023
2904 ! F UNFORM_MODE AND E7$<>"" THEN GOSUB 4000; CALL "EF2FAX",X3$,X4$,E7$,E6$,W9,X$,J$,UNFORM_MODE,EM$; REM "if faxing setup tags and call SSP 241023
2905 IF B9=1 THEN DIM Q[1]; TMPP$=P$; CALL "BC2FMX",X3$,X4$,TMPP$,O$,W9,Z[13],A0$,A0{ALL},PTR_INFO$,Q0$,Q{ALL},Z0; IF X3$(9,3)="101" THEN PRINT (W9)'FF', END_IF ; IF Z0=1 THEN GOTO 5000 ELSE GOTO 2933; REM "Use Barcodemodule to print
2910 FOR I=0 TO INT(LEN(P$)/W3)-1
2915 IF V3$(2,2)="T " THEN IF MOD(I+1,22)=0 THEN CALL "ZZPROM",".5",X3$,Z0,"","","",0; IF Z0=1 THEN GOTO 9900
2920 Y5$=P$(I*W3+1,W3); GOSUB 7300
2930 NEXT I
2933 IF E7$>"" AND JF_OPT$="N" THEN GOSUB 4000; CALL "EF2FAX",ERR=*NEXT,X3$,X4$,E7$,E6$,W9,X$,J$,PMODE,EM$; REM "SETUP FAX #S AND TAG 2S, THEN CALL FAX ROUTINE SSP 241023 PMODE = UNFORM_MODE, 246611 - option to create one file for multi-page PL, works in Unform only
2935 COPIES_LEFT=COPIES_LEFT-1; IF COPIES_LEFT>0 THEN GOTO 2903
2936 P9=P9+1
2940 RETURN 
3100 REM "Subtotal logic goes here, see -ZREPS
3180 RETURN 
3280 RETURN 
3380 RETURN 
3500 REM "End of document routine"
3505 REM "Message of the Day
3510 F5=40,F5$=V0$(81,40),F6=0; GOSUB 8450
3520 F5=40,F5$=V0$(121,40),F6=1; GOSUB 8450
3530 F5=39,F5$=STR(T9:Z0$); GOSUB 8300
3535 F5=52,F5$=STR(T8:Z0$); GOSUB 8300
3540 J0=T9-T8,F5=50; F5$=STR(J0:Z0$); GOSUB 8300
3550 IF T9<>0 THEN F5=51; F5$=STR(J0*100/T9:Z6$); GOSUB 8300
3560 F5=54,F5$=STR(T7:Z5$); GOSUB 8300
3565 F5=67,F5$=STR(T9[0]:Z1$); GOSUB 8300
3570 F5=68,F5$=STR(T9[1]:Z1$); GOSUB 8300
3575 IF X9[108]<>0 THEN GOSUB 4100; REM "Gold Bond bill of materials
3590 RETURN 
3600 REM "Out of Stock for the Bin Location where this lot resides?
3605 IF ICF_FILE=0 THEN ICF_FILE=Z[5]
3610 DIM L9[5]; L9$=E0$(100,10)
3620 READ (ICF_FILE,KEY=K8$,DOM=3621)
3630 READ (ICF_FILE,END=3680)IOL=0410
3640 IF K$(1,LEN(K8$))<>E0$(1,LEN(K8$)) THEN GOTO 3680
3650 IF K$<>E0$(1,LEN(K$)) THEN IF E0$(100,10)<>L9$ OR POS(" "<>E0$(110,11))>0 THEN GOTO 3630
3655 IF E0[2]=0 THEN E0[2]=1
3660 L9[0]=L9[0]+E0[4]*E0[3]*E0[2]
3670 GOTO 3630
3680 READ (ICF_FILE,KEY=K$)IOL=0410
3690 L9[2]=E0[2]; IF L9[2]=0 THEN L9[2]=1
3700 L9[1]=E0[4]*E0[3]*L9[2]
3705 F5$=""; IF B[8]<>0 THEN F5$="B"
3710 IF L9[0]=L9[1] THEN F5$=F5$+"*"
3720 F5=16; GOSUB 8350
3740 RETURN 
3790 REM "Field 17
3795 IF X9$(17,1)="U" THEN F5$=F5$+" "+E0$(121,4)
3800 REM "Field 17 'cont. see 3790 for lot entry point
3810 IF POS(X9$(F5,1)="@")>0 THEN F5$=F5$+" "+X9$(F5,1)
3820 GOSUB 8350
3840 RETURN 
4000 REM "Setup Fax numbers to call
4005 DIM X$(4*51),EM$(6*21); REM " SSP 172419
4010 CALL "ZZDISP","AX",D$(1,10),"A/R",X3$,J$,"",0,0,X4$; X$(1)="C"+D$(143,12),X$(27)="C:"+J$; REM "Customer
4015 X$(52)="W"+G0$(138,12),X$(78)="W:"+G0$(12,4); REM "Distributer Whse
4016 EM$(1,21)="W"+G0$(12,4); REM " SSP 172419
4019 REM "If shipto fax number is blank then substitute customer and customer fax number
4020 IF LEN(E1$)>=150 THEN IF STP(E1$(138,12),3," ")="" THEN E1$(2,10)=D$(1,10),E1$(138,12)=D$(143,12) END_IF ; CALL "ZZDISP","AX",E1$(2,10),"A/R",X3$,J$,"",0,0,X4$; X$(154)="T"+E1$(138,12),X$(180)="T:"+J$+"-"+E1$(12,4); REM "Ship to
4021 EM$(22,21)="T"+MID(E1$,2,10)+MID(E1$,12,4); REM " SSP 172419
4025 X$(103,51)="S"+R$(127,12),X$(129,25)="S:"+A$(93,4)+"-"+R$(5,35); REM "Salesperson
4026 EM$(43,21)="S"+A$(93,4) ! SSP272180, trigger email replacement
4035 IF E7$>"" THEN IF J8=1 THEN FOR J7=0 TO 3; X$(2+J7*51,25)=E7$(150,12),EM$(2+J7*21,20)="ALIGNMENTPATTERN"; NEXT J7; REM "If alignment pattern, replace with align pat fax # from parameters
4040 CALL "ZZDISP","AX",A$(118,8),"O/P",X3$,J$,"",0,0,X4$; J$="856:"+J$; REM "Tag 1, document id for fax
4045 RETURN 
4050 REM "Print additional 4 lines of ship-to address
4052 IF A1=1 THEN DIM SHIP_TO$(522,"X"); GOTO 4060
4055 GOSUB SET_READONLY; FIND (Z[7],KEY="C"+D$(1,10)+E$(12,4),DOM=*NEXT)SHIP_TO$; GOSUB CLEAR_READONLY; GOTO 4060 ! SSP233147
4056 GOSUB CLEAR_READONLY; GOTO 4090 ! SSP233147, got the DOM, was set to DOM to 4090, changed so we can clear readonly
4060 FOR INDEX=0 TO 3
4065 IF POS(" "<>SHIP_TO$(402+INDEX*30,30))>0 THEN F5$=SHIP_TO$(402+INDEX*30,30),F5=5,F6=L9+L1; GOSUB 8450; F5=72; GOSUB 8450; F5=97; GOSUB 8450; F5=98; GOSUB 8450; F5=43; GOSUB 8450; L1=L1+1
4070 NEXT INDEX
4090 RETURN 
4100 REM "Gold Bond bill of materials printing
4105 IF GB_FIRST_TIME THEN GB_FIRST_TIME=0,Y$="15O BM1... 16O IC0... 17O ZF6... "; GOSUB 9750; X9[108]=12,Y9[108]=45; DIM KEY$(27); KEY$(1,10)="856",KEY$(11,1)=V0$(60,1),KEY$(12,4)="0108"; FIND (Z[17],KEY=KEY$,DOM=4106)*,X9[108],Y9[108]
4107 IF SPLIT_SHIP_FOUND THEN TMP$="*** SPLIT SHIPMENT *** BOM IS FOR FULL SHIPMENT",P$(X9[108]+(Y9[108]-4)*W3,LEN(TMP$))=TMP$
4108 CURR_LINE$="",GB_X=0,GB_Y=1
4109 READ (Z[15],KEY=A$(118,8),DOM=4110)
4110 DIM BM1$(35),BM1[2]; READ (Z[15],END=4140)BM1$,BM1[0],BM1[1],BM1[2]; IF BM1$(1,8)<>A$(118,8) THEN GOTO 4140 ELSE IF CURR_LINE$="" THEN CURR_LINE$=BM1$(9,3) ELSE IF BM1$(9,3)<>CURR_LINE$ THEN GOTO 4140
4112 FIND (Z[16],KEY=BM1$(15,20),DOM=4135)IC0$; REM "If not on file, item is skipped
4120 DIM OUT$(36)
4121 OUT$(1,10)=PAD(STP(BM1$(25,10),1),10,"R"); REM "Item no
4123 OUT$(12,20)=IC0$(21,20); REM "Item desc
4124 QTY_OUT$=" "+STP(STR(BM1[0]:"######"),2),OUT$(37-LEN(QTY_OUT$))=QTY_OUT$
4125 P$(X9[108]+GB_X+(Y9[108]-1+GB_Y)*W3,36)=OUT$; REM "Put into P$
4130 GB_Y=GB_Y+1; IF GB_Y>17 THEN GB_X=39,GB_Y=1 ELSE IF GB_Y>34 THEN GOTO 4140
4135 GOTO 4110
4145 RETURN 
4800 JETFORM_PRINT:REM "For jetform mode add field nominated value with F5 as the field name and F5$ as the value
4801 IF POS("D"=V0$(61,10))<>0 THEN DUP$="D" ELSE DUP$=""
4802 COUNT=0
4805 COUNT=COUNT+1
4806 ! IF WHO="crg" THEN IF F5=42 THEN PRINT "F5=",STR(F5)," F5$=",F5$; ESCAPE
4807 IF F5=115 THEN GOTO 4815 ! 286192 - Certain header variables need to be exempted from auto-ejecting fillers
4810 IF PL_LINE>P_LINE[F5]+1 AND DUP$<>"D" THEN PRINT (JF_CHAN)"^field "+STP(E7$(146,3),1)+STR(F5:"000"),'LF'; P_LINE[F5]=P_LINE[F5]+1; GOTO 4810 ! 180510 !SSP#220190
4811 IF PL_LINE>P_LINE[F5]+1 AND DUP$="D" THEN PRINT (JF_CHAN)"^field "+STP(E7$(146,3),1)+STR(F5:"000")+DUP$,'LF'; PRINT (JF_CHAN)"^field "+STP(E7$(146,3),1)+STR(F5:"000"),'LF'; P_LINE[F5]=P_LINE[F5]+1; GOTO 4811 ! 180510  !SSP#220190
4815 PRINT (JF_CHAN)"^field "+STP(E7$(146,3),1)+STR(F5:"000")+DUP$,'LF',F5$; P_LINE[F5]=P_LINE[F5]+1 ! 180510
4816 IF COUNT=1 AND POS("D"=V0$(61,10))<>0 THEN DUP$=""; GOTO 4805
4845 JETFORM_PRINT_END:RETURN 
5000 REM "End of Print
5010 GOSUB 7400 ! 261185 - Restore the original selection variables in case an alternate selection was active in the current session
5020 IF W8=0 THEN GOTO 9900
5030 T0$="END"
5050 T=0,T$="Report"; GOSUB 7000
5291 GOTO 9900
5300 REM "Remove printed P/S's
5304 IF V8$="A" OR CALLED$="Y" THEN GOTO 5350
5305 IF V3$(2,2)="A " THEN PRINT 'EA',
5310 PRINT 'CI',; WAIT 1; CALL "ZZPROM",".Y",X3$,Z,"Did all of the packing lists print correctly?","","",0
5320 ON Z GOTO 5350,5321
5325 READ (Z[20],KEY="~"+FID(0),ERR=*NEXT)
5330 KYZ20$=KEY(Z[20],END=*NEXT); IF KYZ20$(1,1)="~" THEN IF KYZ20$(2,2)=FID(0) THEN WRITE (U1,KEY="L"+KYZ20$(4)); REMOVE (Z[20],KEY=KYZ20$,ERR=*SAME); GOTO *SAME
5345 RETURN 
5350 REM "Do remove
5354 IF %GUI=0 THEN PRINT @(0,19),'CE',
5360 READ (Z[20],KEY="~"+FID(0),ERR=*NEXT)
5370 KYZ20$=KEY(Z[20],END=*NEXT); IF KYZ20$(1,1)="~" THEN IF KYZ20$(2,2)=FID(0) THEN REMOVE (Z[20],KEY=KYZ20$,ERR=*SAME); GOTO *SAME
5390 RETURN 
5400 REM "Set code C1 for type of P/O
5410 IF P0=1 THEN C1=0
5412 IF P1=1 THEN P1=P1+1
5414 REM "P0 is > 1
5415 ON P1 GOTO 5445,5416,5430,5440
5416 IF P0$<>"" THEN C1=2; GOTO 5445
5420 C1=1; GOTO 5445
5425 REM "if general inst needed C1=2 else drop through to C1=3
5430 IF P0$<>"" THEN C1=2; GOTO 5445
5440 C1=3
5445 RETURN 
5500 REM "Get proper address, C1=1 taken care of in 2300's
5505 DIM E$(260)
5510 ON C1 GOTO 5520,5590,5520,5550
5530 READ (Z[6],KEY=A$(118,8)+"     ",DOM=5540)IOL=0350; GOTO 5590
5535 REM "If no general inst., use customer address
5540 E$(16,30)=D$(165,20),E$(46,87)=D$(56,87); GOTO 5590
5550 REM "Read in special shipping record
5555 IF LEN(P2$)=0 THEN GOTO 5580
5560 READ (Z[6],KEY=A$(118,8)+" "+P2$(126,4),DOM=5580)IOL=0350
5570 GOTO 5590
5580 REM "Error"
5585 EXITTO 1580
5590 RETURN 
5600 REM "Get name to print on shipto
5605 IF E$(11,1)="C" THEN GOSUB 5650 ELSE IF A1<>0 THEN GOSUB 5662 ! SSP233147, was GOSUB 5661, changed to GOSUB 5662 as we added the clear readonly on line 5661 if we get the DOM on line 5660
5610 IF LEN(E$)>=259 AND POS(" "<>E$(259))<>0 THEN E9$=E$(225,35); GOTO 5645 ELSE E9$=D$(11,35)
5615 GOSUB SET_READONLY; ON POS(E$(11,1)="CPD") GOTO 5644,5620,5625,5630 ! SSP233147
5620 FIND (Z[7],KEY=E$(11,1)+D$(1,10)+E$(12,4),DOM=5644)E1$; GOTO 5635 ! SSP233147
5625 FIND (Z[7],KEY=E$(11,1)+A$(7,10)+E$(12,4),DOM=5644)E1$; GOTO 5635 ! SSP233147
5630 FIND (Z[7],KEY=E$(11,1)+Y6$(1,10)+E$(12,4),DOM=5644)E1$; GOTO 5635 ! SSP233147
5635 E9$=E1$(16,35); IF E$(11,1)="C" THEN SHIP_TO_ZIP$=E1$(129,9) ELSE SHIP_TO_ZIP$=""
5644 GOSUB CLEAR_READONLY ! SSP233147
5645 RETURN 
5650 REM "Fill in from FM0 Customer Record
5660 GOSUB SET_READONLY; FIND (Z[7],KEY=E$(11,1)+D$(1,10)+E$(12,4),DOM=*NEXT)FM0$; E1$=FM0$; GOSUB CLEAR_READONLY; GOTO 5665 ! SSP233147
5661 GOSUB CLEAR_READONLY; GOTO 5690 ! SSP233147, got the DOM on line 5660, was set to DOM to 5690, changed to next so we can clear readonly
5670 F5=71,F5$=FM0$(214,9); GOSUB 8300
5680 F5=95,F5$=FM0$(382,20); IF D$(504,1)="Y" THEN F5$=FM0$(214,9) END_IF ; GOSUB 8300 ! WO257917, if customer parm set then use customer location code in place of receiving department
5685 F5=99,F5$=FM0$(16,35); GOSUB 8300
5687 IF POS(" "<>FM0$(138,12))>0 THEN CALL "ZZDISP","POX",FM0$(138,12),"",X3$,F5$,"",0,0,X4$; F5=114; GOSUB 8300; REM "WO117117533
5688 IF POS(" "<>FM0$(200,14))>0 THEN CALL "ZZDISP","POX",FM0$(200,14),"",X3$,F5$,"",0,0,X4$; F5=128; GOSUB 8300 ! WO236789
5690 RETURN 
5700 REM "Setup sort file for bin order printing
5704 IF V0$(61,1)="B" THEN K1$="Bin order workfile for pick ticket printing" ELSE K1$="Sort workfile for pick ticket printing"
5705 CALL "ZZ2SRT",X3$,X4$,Z[13],Z[1],28,K1$,K0,"NN"; IF K0=2 THEN GOTO 9900
5710 Y$="04O "+K1$+" "; GOSUB 9750
5715 U$=KEY(U1,END=5750)
5720 IF U$(1,1)<>"L" THEN GOTO 5750
5722 IF LEN(PICK_LIST$)>0 THEN IF POS(U$(6,2)=PICK_LIST$,2)=0 THEN READ (U1); GOTO 5715 ! SSP197451
5725 U3=1,U2=1
5730 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
5734 IF U9=3 THEN U2=U2+2 ! [197451]
5735 IF U$(U2,U[U9])<V2$(U3,U[U9]) THEN READ (U1,END=5750); EXITTO 5715
5740 IF U$(U2,U[U9])>V2$(U3+U[U9],U[U9]) THEN IF U=1 THEN EXITTO 5750 ELSE READ (U1,END=5750); EXITTO 5715
5742 NEXT U9
5743 IF POS(U$(8,8)=BSY_ORD$,8)<>0 THEN READ (U1,END=5750); GOTO 5715 ELSE BSY=1; EXTRACT (Z[2],KEY=U$(8,8),DOM=*NEXT,BSY=*NEXT)FS1$; BSY=0; IF V0$(202,10)<>DIM(10) AND V0$(202,10)<>FS1$(6,10) THEN BSY=1 ! SSP#277774 if not right cust mark as bsy
5745 IF BSY THEN BSY_ORD$=BSY_ORD$+U$(6,8); GOSUB REMOVE_SORT; READ (U1,END=5750); GOTO 5715
5746 WRITE (Z[20],KEY="~"+FID(0)+U$(2)); REMOVE (U1,KEY=U$)
5748 IF V0$(61,1)="B" THEN U$=U$(1,5)+U$(8); GOSUB 5800 ELSE IF MID(V0$,201,1)="Y" THEN U$=U$(1,5)+U$(8); GOSUB 5900 ELSE WRITE (Z[4],KEY=" "+U$); ORD_POS=6
5749 GOTO 5715
5790 READ (Z[4],KEY="",DOM=5791)
5795 RETURN 
5801 REM "write out keys
5803 IF %GUI=0 THEN PRINT @(25,22),U$(2,4)," ",U$(6,8)," ",U$(14,3),
5805 READ (Z[3],KEY=U$(6,8)+U$(14,3),DOM=5895)IOL=0320
5810 REM IF B$(18,1)<>"Y" AND B$(2,1)="Y" THEN GOTO 5830; REM "skip to lots unless it was special shipped line and then we don't worry about bin number order on lots, because all of the lots are going to the same place.
5815 IF B$(155,1)="C" THEN K8$=B$(161,10)+B$(19,10) ELSE DIM K8$(20); K8$(11)=B$(19,10)
5817 K8$=K8$+B$(10,4)
5818 DIM R0$(50),R[10]
5820 FIND (Z[9],KEY=K8$,DOM=5821)IOL=0395
5825 K5$=R0$(35,10); IF V0$(61,2)="B*" THEN IF POS(K5$(1,1)=SYMBOLS$,1)>0 THEN K5$=K5$(2,9)+DIM(1) ! WO214478
5827 IF B$(18,1)="Y" OR B$(2,1)<>"Y" THEN GOTO 5880
5830 REM "Cruise thru lots
5832 FIRST_LOT$="Y"
5835 DIM E0$(269),E0[6]; IF B[7]<0 THEN ICF_FILE=Z[21] ELSE ICF_FILE=Z[5] ! SSP#279159
5837 K8$=B$(161,10)+B$(19,10)+B$(10,4)
5840 READ (ICF_FILE,KEY=K8$,DOM=5841) ! SSP#279159
5845 K7$=KEY(ICF_FILE,END=5880) ! SSP#279159
5850 IF K7$(1,LEN(K8$))<>K8$ THEN GOTO 5880
5855 READ (ICF_FILE,KEY=K7$)IOL=0410 ! SSP#279159
5860 IF E0$(110,11)<>B$(147,8)+B$(6,3) THEN GOTO 5845
5862 IF FIRST_LOT$="Y" THEN FIRST_LOT$="N"; K5$=E0$(100,10); IF V0$(61,2)="B*" THEN IF POS(K5$(1,1)=SYMBOLS$,1)>0 THEN K5$=K5$(2,9)+DIM(1) ! WO214478
5865 LOT_BIN$=E0$(100,10); IF V0$(61,2)="B*" AND POS(LOT_BIN$(1,1)=SYMBOLS$,1)>0 THEN LOT_BIN$=LOT_BIN$(2,9)+DIM(1) END_IF ; IF POS(LOT_BIN$=K5$,10)=0 THEN K5$=K5$+LOT_BIN$ ! WO214478
5870 GOTO 5845
5882 IF STP(K5$,3," ")="" THEN IF B$(2,1)="Y" AND (B[0]<>0 OR B[8]<>0) THEN K5$=DIM(10,"~")
5883 READ (Z[2],KEY=U$(6,8),DOM=5895)FS1$
5884 DIM CUST_PARM$(243); READ (Z[11],KEY="D"+FS1$(6,10),DOM=*NEXT)CUST_PARM$,PARM0,PARM1,PARM2,PARM3,PARM4,PARM5 ! WO155872
5885 IF STP(B$(10,4),3)="" OR B$(10,4)="DS  " THEN SORT_KEY$=U$(1,1)+U$(6,8)+B$(215,4)+K5$(1,10)+U$(14,3) ELSE SORT_KEY$=U$(1,1)+U$(6,8)+B$(10,4)+K5$(1,10)+U$(14,3) ! SSP#259339
5886 IF PARM3<>0 THEN SORT_KEY$(12,2)=STR(PARM3:"00")
5887 IF MID(FM_PARM$,285,1)<>"Y" THEN SORT_KEY$(10,1)="0"; REM SSP179849
5888 IF V0$(61,1)="B" AND MID(V0$,201,1)="Y" THEN WRITE (Z[4],KEY=" "+SORT_KEY$); ORD_POS=2 ELSE IF V0$(61,1)="B" AND MID(V0$,201,1)<>"Y" THEN WRITE (Z[4],KEY=" "+U$(1,13)+K5$(1,10)+U$(14)); ORD_POS=6 ELSE IF MID(V0$,201,1)="Y" THEN WRITE (Z[4],KEY=" "+U$(1,1)+U$(6,8)+B$(10,4)+K5$(1,10)+U$(14,3)); ORD_POS=2
5889 IF LEN(K5$)>10 THEN K5$=K5$(11); GOTO 5883
5895 RETURN 
5900 REM "Write out key if sorting by Warehouse Location
5901 READ (Z[2],KEY=U$(6,8),DOM=5925)FS1$
5902 DIM CUST_PARM$(243); READ (Z[11],KEY="D"+FS1$(6,10),DOM=*NEXT)CUST_PARM$,PARM0,PARM1,PARM2,PARM3,PARM4,PARM5 ! WO155872
5905 READ (Z[3],KEY=U$(6,8)+U$(14,3),DOM=5925)IOL=0320
5910 DIM SORT_KEY$(27)
5915 IF STP(B$(10,4),3)="" OR B$(10,4)="DS  " THEN SORT_KEY$=U$(1,1)+U$(6,8)+B$(215,4)+U$(14,3)+DIM(10) ELSE SORT_KEY$=U$(1,1)+U$(6,8)+B$(10,4)+U$(14,3)+DIM(10) ! SSP#259339
5916 IF PARM3=0 THEN GOTO 5917 ELSE SORT_KEY$(12,2)=STR(PARM3:"00")
5917 IF MID(FM_PARM$,285,1)<>"Y" THEN SORT_KEY$(10,1)="0"; REM SSP179849
5918 IF %GUI=0 THEN PRINT @(25,22),U$(6,8)," ",B$(10,4)," ",U$(14,3),
5920 WRITE (Z[4],KEY=" "+SORT_KEY$); ORD_POS=2
5925 RETURN 
6000 REM "Print alignment pattern?
6004 REM "A1 <> 0 means doing an alignment pattern
6005 A1=0
6006 IF V8$="A" THEN GOTO 6090
6010 IF V3$(2,2)="A " THEN PRINT 'EA',
6012 J8=0
6015 CALL "ZZPROM","R4",X3$,Z,"","","",X0
6017 IF Z<2 AND V3$(2,2)="A " THEN PRINT 'BA',
6020 ON Z GOTO 6080,6021,9900
6022 J8=1
6030 GOSUB 6100
6040 GOSUB 6200
6045 IF V3$(2,1)<>"T" THEN PRINTER$=FID(W9); CLOSE (W9); OPEN (W9)PRINTER$
6050 GOTO 6010
6080 A1=0
6090 RETURN 
6100 REM "Setup test data"
6104 A1=1
6105 C=9,C0=1
6108 DIM X$(40,"X"),ITEM$(448,"X")
6110 DIM A$(350); A$(118,8)="99999999",A$(16,6)="J90101",A$(28,15)="999999999999999",A$(6,10)="9999999999",A$(93,4)="9999",A$(55,6)="U90101"
6115 DIM D$(599); D$(11,35)=X$,D$(56,30)=X$,D$(86,30)=X$,D$(116,18)=X$,D$(134,9)="999999999",D$(411,20)="XXXXXXXXXXXXXXXXXXXX",D$(220,9)=X$ ! WO275545
6125 DIM B$(205); B$(50,40)=X$,B$(32,18)=X$,B1=99999999,B$(161,10)="99999999999" ! SSP305128, item's customer code
6127 I0$=B$
6128 IF P8$(44,1)="Y" THEN B$(2,1)="Y"
6130 DIM E$(428); E$(16,90)=X$+X$+X$,E$(106,18)=X$,E$(124,9)="999999999",E$(210,15)=X$,E$(225,35)=X$,E$(175,35)=X$,E$(347,15)=X$,E$(135,15)=X$,E$(151,15)=X$ ! WO246946, PO3, change E$ DIM from 260 to 428, populate inside delivery, ship with and account number fields
6131 E$(383,2)=X$ ! SSP307210-DBSPT-62 Ship to Country
6135 DIM D0$(186); D0$(29,2)="99"
6140 DIM FM0$(522,"X")
6141 DIM WHSE$(4,"9")
6145 MULT_WHSE$="MULTIPLE WAREHOUSES",SLS_ORD$="SALES ORDER" ! WO246220
6150 DIM FV1$(818,"X") ! WO249287
6155 DIM EEG$(380,"X") ! SSP290922
6190 RETURN 
6200 REM " Print align. pattern
6205 L0=1,PL_LINE=1; DIM T9[10]
6210 GOSUB 2000
6215 GOSUB 2400
6239 F5=115,F5$="*Continued*"; GOSUB 8300; REM "WO130135
6240 P0=1,L0=1,PL_LINE=1; GOSUB 2900; GOSUB 8980; PL_LINE=PL_LINE+1; REM "108433
6290 RETURN 
6300 REM "Cost Codes
6305 IF A1<>0 THEN GOTO 6340
6310 IF X9[84]>0 THEN CALL "ZZDISP","AX",B$(205,9),"FMC",X3$,F5$,"",0,0,X4$; F5=84; GOSUB 8350
6320 F5=85,F5$=B$(209,5); GOSUB 8350
6340 RETURN 
6350 REM "Field 113 - County from Ship to file
6355 IF POS(" "<>SHIP_TO_ZIP$)=0 OR FM_PARM$(284,1)<>"Y" THEN GOTO 6390
6360 READ (Z[18],KEY=SHIP_TO_ZIP$,DOM=6390)F5$
6370 F5=113; F5$=F5$(28,12); GOSUB 8300
6390 RETURN 
6400 REM " Print Supplier Item number
6405 IF JETFORM_MODE AND X9[87]<>0 AND (POS(B$(155,1)="IC")=0 OR (B$(2,1)="Y" AND LOT_VEND$="")) THEN F5=87,F5$=DIM(20); GOSUB 8350 ! SSP#238650!SSP#268703
6410 IF X9[87]=0 OR POS(B$(155,1)="IC")=0 OR (B$(2,1)="Y" AND LOT_VEND$="") THEN GOTO 6490
6415 DIM F5$(100),F8$(100); F8$(1,20)=B$(161,10)+B$(19,10),F8$(82,14)=LOT_VEND$ ! SSP#239220 !SSP#268703
6420 Y$="07C FM0...  12C AR4...  07O IC0...  12O IC2...  "; GOSUB 9750
6425 IF B$(2,1)<>"Y" THEN READ (Z[7],KEY=B$(161,10)+B$(19,10),DOM=6440)F8$ ! SSP#238650!SSP#239220
6430 READ (Z[12],KEY=F8$(1,20)+F8$(82,14),DOM=*NEXT)F5$ ! SSP#238650 SSP#239220
6440 F5$=F5$(35,20),F5=87
6450 GOSUB 8350
6460 F5$="",LOT_VEND$="" ! SSP#268703
6480 Y$="07C IC0...  12C IC2...  07O FM0...  12O AR4...  "; GOSUB 9750
6490 RETURN 
6500 REM " P/O CODE
6505 IF POS(X3$(9,3)="134")>0 THEN IF B$(155,1)<>"N" OR A$(47,1)<>" " THEN GOTO 6540
6510 F5=88; IF X9$(F5,1)<>"F" THEN F5$=B$(9,1); GOTO 6530
6520 IF B$(9,1)=" " THEN F5$="" ELSE CALL "ZZDISP","AX",A$(118,8)+B$(9,1),"P/O",X3$,F5$,"",0,0,X4$
6530 GOSUB 8350
6535 F5=137; IF X9$(F5,1)<>"F" THEN F5$=B$(9,1) ELSE IF B$(9,1)=DIM(1) THEN F5$="" ELSE F5$=FN%ZZDISP$(A$(118,8)+B$(9,1),"P/O") END_IF END_IF ; GOSUB 8350 ! WO241665, second printing of P/O code suffix or full P/O number
6536 F5=138; IF X9$(F5,1)<>"F" THEN F5$=B$(9,1) ELSE IF B$(9,1)=DIM(1) THEN F5$="" ELSE F5$=FN%ZZDISP$(A$(118,8)+B$(9,1),"P/O") END_IF END_IF ; GOSUB 8350 ! WO241665, third printing of P/O code suffix or full P/O number
6540 RETURN 
6600 REM "Print # of cartons left if needed
6610 CALL "IC2LCA",X3$,X4$,"C",0,B$(161,10)+B$(19,10)+B$(10,4),NUM_LEFT,0,0,0,"",0
6615 B_HOLD$=B$; DIM B$(LEN(B$)); B$(155,1)="M",B$(50,40)=STR(NUM_LEFT:"###,###,##0")+" Cartons left"
6620 GOSUB 7700
6625 B$=B_HOLD$
6645 RETURN 
6700 ! For field 46, if customer parameter is set and line is pulled from 9000 warehouse, then read for lots and extend sell price from lot to J0, WO155872
6710 DIM E0$(269),E0[6]; J0=0
6715 K2$=B$(161,10)+B$(19,10)+B$(10,4)
6720 READ (Z[5],KEY=K2$,DOM=*NEXT)
6725 K3$=KEY(Z[5],END=6790)
6730 IF K3$(1,LEN(K2$))<>K2$ THEN GOTO 6790
6735 READ (Z[5],KEY=K3$)IOL=0410
6740 IF E0$(110,11)<>B$(147,8)+B$(6,3) THEN GOTO 6725
6741 LOT_BIN$=E0$(100,10); IF V0$(61,2)="B*" AND POS(LOT_BIN$(1,1)=SYMBOLS$,1)>0 THEN LOT_BIN$=LOT_BIN$(2,9)+DIM(1) ! WO214478
6742 IF F6$<>"*" AND V0$(61,1)="B" THEN IF LOT_BIN$<>P7$(1,10) THEN GOTO 6725 ! WO214478, replaced E0$(100,10) with LOT_BIN$
6745 IF E0[2]=0 THEN LOT_QTY=E0[3]*E0[4] ELSE LOT_QTY=E0[2]*E0[3]*E0[4] ! Calculate lot qty in eaches
6750 CALL "FM2EXT",Z[13],0,E0$(129,4),E0[6],LOT_QTY,E0[5],LOT_VALUE,2
6755 J0=J0+LOT_VALUE
6760 GOTO 6725
6790 RETURN 
6800 SET_READONLY:! SSP233147
6810 SET_PARAM 'XI'
6820 SET_READONLY_END:RETURN 
6825 ! 
6830 CLEAR_READONLY:
6835 SET_PARAM -'XI'
6840 CLEAR_READONLY_END:RETURN 
6845 ! 
7000 REM "Totals logic
7001 IF T=T0 THEN IF T[T0,0]<2 THEN GOSUB 7300; GOTO 7100
7002 IF W+3>W0 THEN GOSUB 6000
7010 Y5$(1)=T3$(1,T0+1-T)+" "
7015 IF T$<>"" THEN Y5$(T0+2-T)=""+Q2$+" ("+STR(T[T,0]:"0")+"):"
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7200; GOTO 7190
7095 GOSUB 7300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7205 GOSUB 7300; Y5$(1)=Q1$+": "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 T4$=STR(INT(T2):"##0")
7230 T3=INT(FPT(T2)*3600),T4=MOD(T3,60),T3=INT(T3/60)
7240 T3=T3/60
7250 T4$=T4$+":"+STR(T3:"00")+":"+STR(T4:"00")
7260 Y5$(1)=Q3$+": "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7330 PRINT (W9)STP(Y5$,1); DIM Y5$(W3)
7395 RETURN 
7400 REM "Read report selection parameters"
7405 CLOSE (14); OPEN (14)"ZZP"; Z[12]=14; GOTO 7430
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0490
7460 V2$="LL"+V2$
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"   ")-1)
7482 IF V1$(1,3)="???" THEN V8$="A",V7$=V1$(4,2); IF V0$(71,1)="1" THEN V1$="PO6   "
7485 FOR U7=1 TO LEN(V1$); IF V1$(U7,1)=" " THEN V1$(U7,1)="."; NEXT U7 ELSE NEXT U7 ! SSP#261640
7486 CLOSE (14); Z[12]=0
7490 RETURN 
7500 REM "Run lines count quantity, then run special instr subtracting quantity
7501 REM "P0=# of P/O's to print, at least 1. Line # in P0$, quantitys in P1$., keys to recs in P2$
7503 IF P0=0 THEN P0=1
7510 READ (Z[3],KEY=U$(6,11),DOM=7590)IOL=0320
7515 IF B$(155,1)="M" THEN B[0]=100
7517 IF B$(155,1)="S" AND B[0]=0 AND (B[6]<>0 OR POS(X3$(9,3)="335139",3)<>0 OR B[7]<>0) THEN B[0]=1 ! SSP#234002
7524 REM "ADD THE AMOUNT TO THE LIST OF LINES TO DO, IF THE OPEN QTY IS NOT ZERO OR If inv item and both the open qty and original qty are zero (it is not a line that had a qty that has already been shipped (b(0)=0 & b(10)<>0))
7525 IF B[0]<>0 OR (POS(B$(155,1)="IC")<>0 AND B[0]=0 AND B[10]=0) THEN N0=B[0],N$=B$(6,3); IF X9$(21,1)="O" THEN N0=B[7]; GOSUB 7800 ELSE GOSUB 7800; REM "SSP109324, overruns
7530 REM "Now subtract special inst. off
7535 DIM E$(260),E[3]; READ (Z[6],KEY=U$(6,8)+" "+U$(14,3),DOM=7536)
7537 K$=KEY(Z[6],END=7580)
7540 READ (Z[6])IOL=0350
7545 IF K$(1,8)+K$(10,3)<>U$(6,11) THEN GOTO 7580
7548 IF E$(155,1)="M" THEN E[0]=1
7550 N$=E$(7,3),N0=-E[0]; IF X9$(21,1)="O" THEN N0=-E[2]; REM "SSP109324,overrun
7551 GOSUB 7800; GOSUB 7900
7560 GOTO 7537
7575 REM " if P0$='' no need for general inst., if P0>1 add 1 for all page"
7580 GOSUB 7950
7583 IF P0$="" THEN P0=P0-1
7585 IF P0>1 THEN P0=P0+1
7590 RETURN 
7600 REM "Starting/Ending Number
7610 F5$=""
7620 IF POS(" "<>X$(1,9))>0 THEN F5$=FNS$(FNR$(X$(1,9)))
7630 IF POS(" "<>X$(10,9))>0 THEN F5$=F5$+"/"+FNS$(FNR$(X$(10,9)))
7635 IF F5$="" AND X9$(14,1)="B" THEN F5$=S$(1,19)
7640 IF F5$<>"" THEN F5=14; GOSUB 8350 ELSE IF JETFORM_MODE AND IN_LOTS$="Y" THEN F5=14; GOSUB 8350 ! SSP176413
7645 RETURN 
7650 REM "Read IC0 - 3.5
7652 IF X9[67]=0 AND X9[68]=0 AND X9[70]=0 THEN GOTO 7690
7655 Y$="12C AR4...  12O IC0...  "; GOSUB 9700
7660 DIM I[19]; FIND (Z[12],KEY=B$(161,10)+B$(19,10),DOM=7661)IOL=0365
7665 Y$="12C IC0...  12O AR4...  "; GOSUB 9700; GOTO 7690
7675 REM "Carton weight - 3.5
7680 T9[0]=T9[0]+T9[10]; REM "Cartons in T9(10)
7682 IF I[19]=0 THEN GOTO 7690
7684 T9[8]=INT(T9[9]*I[16]/I[19]),T9[1]=T9[1]+T9[8]; REM "T9(9)=Qty in eachs, T9(8)=Extended weight
7686 F5=70,F5$=STR(T9[8]:Z1$); GOSUB 8350
7690 RETURN 
7700 REM "Order detail
7705 F4=0
7710 IF L0>=Y8[3] THEN F5=115,F5$="*Continued*"; GOSUB 8300; GOSUB 2900; GOSUB 2000; I0=(Y8[2]-1)*W3,L0=0; GOSUB 8980; PL_LINE=PL_LINE+1
7725 IF POS(B$(155,1)="IC")<>0 THEN GOSUB 8055
7730 GOSUB 8500
7732 GOSUB 8700
7735 U5$=B$(124,4); IF JETFORM_MODE=0 OR (B$(2,1)<>"Y" OR B[8]>0) AND B$(155,1)<>"M" THEN GOSUB 8550 ! SSP##240963
7745 IF B1<>0 AND POS(B$(155,1)="M")=0 THEN IF JETFORM_MODE=0 OR B$(2,1)<>"Y" THEN F5=21,F5$=FNQ$(B1*SGN(B(0)),Z2$),T9[9]=INT(B1)*SGN(B(0)); GOSUB 8350; GOSUB 7675 REM "Don't print if in jetform mode and it is a lotted item, unless it's a BO. SSP174081, used to be IF JETFORM_MODE=0 OR (B$(2,1)<>"Y" OR B[8]>0).!SSP#263827
7750 IF X9[75]>0 AND B[12]>0 AND B1<>0 THEN F5=75; PRECISION 6; F5$=STR(INT((ABS(B1)+B[12]-1)/B[12])*SGN(B1):Z3$); PRECISION 2; GOSUB 8350; REM "SSP131224
7755 GOSUB 6500
7775 X$=B$(104,9)+B$(189,9); GOSUB 7600; GOSUB 6300
7779 REM "If lots then goto 8100 to finish this line and print the rest
7780 IF POS(B$(155,1)="M")=0 THEN IF B$(2,1)="Y" THEN GOTO 8100 ELSE GOSUB 8600
7781 IF POS(B$(155,1)="M")<>0 THEN GOSUB 15000; REM SSP 213499
7785 L0=L0+1,I1=I1+F4-1,I0=I0+W3*X9[47]+F4*W3,F4=0
7787 IF F9>0 THEN F5=73,F5$=STR(SGN(B[7]):M0$); GOSUB 8350; F5=74,F5$=STR(F9:Z3$),F9=0; GOSUB 8350; F5=135; GOSUB 8350; F5=136; GOSUB 8350; GOTO 7785; REM "When fld#73 prints possible runts when fld 36 is set, WO241665, second and third printing of carton pack
7790 RETURN 
7800 REM "Add an amount(N0=amount,N$=line #) from P0$ and P1$
7801 REM "if amount left is 0 remove line from P0$ and P1$
7807 IF V0$(61,1)="B" THEN N2$=KY_FILE$(14,10)+N$ ELSE N2$="          "+N$
7810 N1=POS(N2$=P0$,13)
7815 IF N1=0 THEN P0$=P0$+N2$,P1$=P1$+STR(N0:M4$); GOTO 7840
7820 N2=INT((N1-1)/13)*M4+1,N3=N0+NUM(P1$(N2,M4))
7825 IF N3<>0 THEN P1$(N2,M4)=STR(N3:M4$); GOTO 7840
7830 ON N1 GOTO 7831,7831,7836
7831 IF LEN(P0$)=13 THEN P0$="",P1$="" ELSE P0$=P0$(14),P1$=P1$(M4+1)
7832 GOTO 7840
7836 P0$=P0$(1,N1-1)+P0$(N1+13),P1$=P1$(1,N2-1)+P1$(N2+M4)
7840 RETURN 
7850 REM "Return B1 with value of line or 0
7860 N1=POS(P7$(1,13)=P0$,13)
7865 IF N1=0 THEN B1=0; GOTO 7890
7870 B1=NUM(P1$(INT((N1-1)/13)*M4+1,M4))
7890 RETURN 
7900 REM "Sort E$(7,4) into P2$ based on E$(11,5) and inc P0 count if neccessary
7905 P3$=E$(11,5)+E$(16,30)+E$(46,87)+E$(383,2)+E$(150,1)+E$(7,4); IF STP(P3$(2,4),3," ")="" THEN P3$(2,4)=E$(10,1); REM "307438- PL keys: LOC_TYPE, LOC_CODE, ATTN, ADDRESS (1,2,City,St,Zip,Country), SHIP_VIA + [PO3_KEY : LINE_NUM + SHIP_PT]
7910 IF P2$="" THEN P2$=P3$; GOTO 7945
7915 N4=POS(P3$(1,125)=P2$,129); IF N4=0 THEN N4=1
7920 IF P2$(N4,129)>P3$ THEN IF N4=1 THEN P2$=P3$+P2$; GOTO 7945 ELSE P2$=P2$(1,N4-1)+P3$+P2$(N4); GOTO 7945
7930 N4=N4+129; IF N4<LEN(P2$) THEN GOTO 7920 ELSE P2$=P2$+P3$; GOTO 7945
7945 RETURN 
7950 REM "Calculate # of special PO'S
7960 P6$="",N4=1
7965 IF N4>LEN(P2$) THEN GOTO 7990
7970 IF P2$(N4,125)<>P6$ THEN P0=P0+1,P6$=P2$(N4,125)
7975 N4=N4+129; GOTO 7965
7990 RETURN 
8000 REM "Build desc from H8$
8005 IF A1=1 THEN H9$=""; GOTO 8050
8010 H9$=FNS$(H8$(32,8)); IF H9$<>"" THEN H9$=H9$+QUO; IF POS(" "<>H8$(40,8))<>0 THEN H9$=H9$+"x"
8020 H9$=H9$+FNS$(H8$(40,8)); IF H9$<>"" THEN IF POS(" "<>H8$(40,8))<>0 THEN H9$=H9$+QUO+" " ELSE H9$=H9$+" "
8030 IF NUM(H8$(48,2))<>0 THEN H9$=H9$+H8$(48,2)+" Ply "
8040 H8$=""
8050 RETURN 
8055 REM "Print inventory status flag(s)
8056 F7$=""; IF B[8]<>0 THEN F5=83,F5$="B"; GOSUB 8350
8057 REM "IF X9$(16,1)="B" AND B$(2,1)="Y" THEN GOTO 08085
8058 F7$=""; IF B[8]<>0 THEN F5=103; IF MID(X9$,103,1)="b" THEN F5$="Item Backordered" ELSE F5$="Balance to follow"; GOSUB 8350; REM "SSP103478, SSP130496
8059 IF A$(48,1)="Y" AND B[0]=B[7] THEN F5=104; F5$="Balance of item"; GOSUB 8350; REM "SSP103478
8060 IF B$(155,1)="C" THEN K8$=B$(161,10)+B$(19,10) ELSE DIM K8$(20); K8$(11)=B$(19,10)
8062 K8$=K8$+B$(10,4)
8065 DIM R0$(50),R[10]
8070 FIND (Z[9],KEY=K8$,DOM=8071)IOL=0395
8071 F7$="" ! IF B[8]<>0 THEN F5=83,F5$="B"; GOSUB 8350; ! 233602
8075 R0=R[3]+R[4]-R[5]+R[6]-R[7]
8077 IF R0<>0 AND X9[81]<>0 AND (B$(10,1)="9" OR POS(X3$(9,3)="101122",3)>0 OR POS(X9$(81,1)="ae")>0) THEN F5=81,J0=R0; GOSUB 8842
8078 F5=86,F5$=""; IF B$(2,1)="Y" AND X9[86]<>0 AND X9$(86,1)<>"B" THEN MODE$="C"+X9$(86,1); CALL "IC2LCA",X3$,X4$,MODE$,0,K8$,X,0,0,0,"",BIN; F5=86; IF X9$(86,1)="M" THEN F5$=STR(X:Z2$)+" Cartons left at this warehouse" ELSE F5$=STR(X:Z2$) END_IF END_IF ; GOSUB 8350; REM "If lotted item, and we are printing remaining cartons, and this is not a 'B' type (which requires we know the bin number, which we don't right now) then lets get the remaining cartons and then print it with or without a tag line
8080 IF R0<=0 THEN F7$="**" ELSE IF R[10]>0 AND R0<=R[10] THEN F7$="*" ELSE F7$=""
8082 IF X9$(16,1)<>"B" THEN GOTO 8084 ELSE IF F7$="*" THEN F7$=""
8083 IF B[8]<>0 THEN F7$="B"+F7$; IF LEN(F7$)>2 THEN F7$=F7$(1,2)
8084 IF JETFORM_MODE THEN IF FLD_16$="Y" THEN GOTO 8086
8085 IF F7$<>"" THEN F5=16,F5$=F7$; GOSUB 8350; IF JETFORM_MODE THEN FLD_16$="Y"
8089 REM "If not lots then print bin location from here
8090 IF B$(2,1)<>"Y" THEN F5=15,F5$=R0$(35,10); GOSUB 8350
8092 F5=96,F5$=R0$(35,10); GOSUB 8350
8095 RETURN 
8100 REM "Print lot stuff
8102 FIRST_LOT$="",IN_LOTS$="Y"
8104 IF A1<>0 THEN DIM E0$(269,"X"),E0[6],K8$(32,"X"); E0$(50,6)="J90101",ICF_FILE=Z[5]; GOTO 8139
8105 DIM E0$(269),E0[6]; IF B[7]<0 THEN ICF_FILE=Z[21] ELSE ICF_FILE=Z[5]
8107 K8$=B$(161,10)+B$(19,10)+B$(10,4),F9$=""
8110 READ (ICF_FILE,KEY=K8$,DOM=8111)
8120 K$=KEY(ICF_FILE,END=8185)
8125 IF K$(1,LEN(K8$))<>K8$ THEN GOTO 8185
8130 READ (ICF_FILE,KEY=K$)IOL=0410
8132 E0[4]=E0[4]*SGN(B[7])
8133 IF E0$(110,8)<>A$(118,8) THEN GOTO 8120
8134 IF E0$(118,3)<>B$(6,3) THEN GOTO 8120
8135 LOT_VEND$=E0$(68,14),LOT_BIN$=E0$(100,10); IF V0$(61,2)="B*" AND POS(LOT_BIN$(1,1)=SYMBOLS$,1)>0 THEN LOT_BIN$=LOT_BIN$(2,9)+DIM(1) ! WO214478 !SSP#268703
8136 IF F6$<>"*" AND V0$(61,1)="B" THEN IF LOT_BIN$<>P7$(1,10) AND (LOT_BIN$<>DIM(10) AND P7$(1,10)<>DIM(10,$7E$)) THEN GOTO 8120 ELSE IF F6$<>"*" AND V0$(61,1)="B" AND LOT_BIN$=DIM(10) AND P7$(1,10)<>DIM(10,$7E$) AND P7$(1,10)<>LOT_BIN$ THEN GOTO 8120 ! WO214478, replace E0$(100,10) references with LOT_BIN$ which is set on 8135
8137 F9$="Y"; IF FIRST_LOT$="" THEN FIRST_LOT$="Y" ELSE IF FIRST_LOT$="Y" THEN FIRST_LOT$="N",TOD_SEQ+=1 ELSE IF FIRST_LOT$="N" THEN TOD_SEQ+=1 ! WO220758, increment TOD sequence for lines with multiple lots if this isn't the first lot for this line. SSP238037, if on third or more lots for same line need to increment TOD sequence
8138 IF X9$(16,1)="B" THEN GOSUB 3600
8139 IF L0>=Y8[3] THEN F5=115,F5$="*Continued*"; GOSUB 8300; GOSUB 2900; GOSUB 2000; I0=(Y8[2]-1)*W3,L0=0; GOSUB 8980; REM "PL_LINE=PL_LINE+1
8140 F5=23,F5$=E0$(33,8); GOSUB 8350
8142 CALL "ZZDISP","AX",E0$(41,9),"P/O",X3$,F5$,"",0,0,X4$; F5=24; GOSUB 8350; REM "duplicates fld#60!
8145 IF JETFORM_MODE=0 THEN GOSUB 8500 ELSE IF JETFORM_MODE AND FIRST_LOT$="N" THEN GOSUB 8500
8147 U5$=E0$(121,4); GOSUB 8550
8150 X$=E0$(82,18); GOSUB 7600
8152 F5=123,F5$=E0$(234,8); GOSUB 8350
8155 F5=15,F5$=E0$(100,10); GOSUB 17000; GOSUB 8350 ! SSP 217136
8156 IF POS(B$(155,1)="IC")>0 THEN F5$=B$(161,10)+B$(19,10),F5=100; GOSUB 8350; REM "ssp97823
8157 IF B$(155,1)<>"S" THEN CALL "ZZDISP","AX",B$(19,10),"ICE",X3$,F5$,"",0,0,X4$; F5=13; GOSUB 8350; F5=133; GOSUB 8350; F5=134; GOSUB 8350; LOT_VEND$=E0$(68,14); GOSUB 12000; F5=94,F5$=MID(F0$,350,20); GOSUB 8350; F5=155; GOSUB 8350 ! IF POS(" "<>MID(F0$,350,20))>0 THEN F5=94,F5$=F0$(350,20); GOSUB 8350 ! 188536 SSP222119, WO241665, second and third printings of item number. WO257735, second printing of CIC!SSP#268703
8158 IF B$(10,1)="9" THEN F5$="CUST" ELSE F5$="DIST"
8160 F5=18,F5$=STR(E0[2]:M5$); GOSUB 8350
8162 F5=E0[3]; IF X9$(20,1)="C" AND E0[2]<>0 THEN F5=F5*E0[2]
8163 F5$=STR(F5:M5$),F5=20; GOSUB 8350; F5=82; GOSUB 8350
8166 F5=17,F5$=STR(E0[4]:M5$),T9[10]=E0[4]; GOSUB 3790
8169 F5=19,F5$=STR(E0[2]*E0[4]:M5$); GOSUB 8350
8170 IF E0[2]=0 THEN E0=E0[3]*E0[4] ELSE E0=E0[2]*E0[3]*E0[4]
8171 F5=27; IF E0$(155,1)="Y" THEN F5$="*" END_IF ; GOSUB 8350 ! SSP#267156
8172 F5=21,F5$=FNQ$(E0,Z2$),T9[9]=E0; GOSUB 8350; GOSUB 7675
8173 IF X9[37]<>0 AND E0[4]<>0 AND X9$(37,1)<>"N" AND X9$(37,1)<>"Q" THEN F5=37,F5$=STR(E0[4]:Z3$); IF POS(X9$(F5,1)="Ee")>0 THEN F5$=STR(E0[4]*E0[3]:Z3$); GOSUB 8350 ELSE GOSUB 8350
8175 CALL "ZZDISP","AX",E0$(41,9),"P/O",X3$,F5$,"",0,0,X4$; F5=60; GOSUB 8350; REM "duplicates fld#24!
8176 F5$=FND$(E0$(50,6)); F5=61; GOSUB 8350
8177 F5$=E0$(56,12); F5=62; GOSUB 8350
8178 CALL "ZZDISP","AX",E0$(68,10),"A/P",X3$,F5$,"",0,0,X4$; F5=63; GOSUB 8350
8179 F5$=E0$(78,4),F5=64; GOSUB 8350
8180 F5$=E0$(133,15),F5=65; GOSUB 8350
8181 F5$=E0$(156,40),F5=66; GOSUB 8350; GOSUB 6300
8182 IF X9[86]<>0 AND POS(X9$(86,1)="Bb",1)<>0 THEN MODE$="C"+"B"+E0$(100,10); CALL "IC2LCA",X3$,X4$,MODE$,0,K8$,X,0,0,BIN,"",0; F5=86; IF X9$(86,1)="B" THEN F5$="Cartons left in bin: "+STR(BIN:Z2$)+" Warehouse: "+STR(X:Z2$); GOSUB 8350; READ (Z[5],KEY=K$,DOM=8183); ELSE IF X9$(86,1)="b" THEN F5$=STR(BIN:Z2$); GOSUB 8350; READ (Z[5],KEY=K$,DOM=8183); REM "If bin number type remaining cartons message, then we can now go find the correct ones because we know the bin number!
8183 L0=L0+1,I1=I1+F4-1,I0=I0+W3*X9[47]+F4*W3,F4=0; IF FIRST_LOT$<>"Y" THEN PL_LINE=PL_LINE+1
8184 GOTO 8120
8185 IF B[8]<>0 AND B[8]=B[0] THEN GOTO *NEXT ELSE IF FIRST_LOT$="" AND JETFORM_MODE AND V0$(61,1)="D" THEN GOSUB 14000 ELSE IF FIRST_LOT$="" AND JETFORM_MODE THEN GOSUB 14000 ! SSP222119, SSP 233029
8188 IN_LOTS$="N"; IF F9$<>"" THEN GOTO 8195 ELSE IF X9$(16,1)="B" THEN GOSUB 3600; GOTO 7781; REM "for docutec-don't print total cases if no lots
8190 GOSUB 8600; GOTO 7781 ! SSP 233602 - Removed GOSUB 8060, was already called at 7725
8195 RETURN 
8250 REM "FMS PRICE - 3.3
8270 GOSUB SET_READONLY; FIND (Z[14],KEY=B$(161,10)+B$(19,10),DOM=8294)IOL=0440 ! SSP233147
8280 B[4]=F0[29]*B[5]/F0[4]
8294 GOSUB CLEAR_READONLY ! SSP233147
8295 RETURN 
8300 REM "Place in page, F5 = field #, F5$=field info
8302 IF TOD_OK THEN CALL "UPDDTP;UPDATE_LINE",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F6,F5,F5$,TOD_OK,"" ! [SSP-201588] SSP307325
8305 IF X9[F5]=0 THEN GOTO 8345 ELSE IF IL_ARCHIVE THEN GOSUB JETFORM_PRINT ELSE IF JETFORM_MODE THEN GOSUB JETFORM_PRINT; GOTO 8345 ! 180510
8306 IF B9=1 THEN CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,0,P$,O$,A9$,"",Q{ALL}; GOTO 8320; REM "Use barcode module
8310 P$(X9[F5]+Y9[F5]*W3,LEN(F5$))=F5$
8345 RETURN 
8350 REM "F5=field#, F5$=field info. line number is used to index off of I0 set to first line in lines section - 1. line 1  on a line = first line.
8351 REM "Set F4 to highest line # printed
8352 IF TOD_OK THEN CALL "UPDDTP;UPDATE_LINE",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F6,F5,F5$,TOD_OK,"" ! [SSP-201588] SSP307325
8355 IF X9[F5]=0 THEN GOTO 8395 ELSE IF IL_ARCHIVE THEN GOSUB JETFORM_PRINT ELSE IF JETFORM_MODE THEN GOSUB JETFORM_PRINT; GOTO 8365 ! 180510
8356 IF B9=1 THEN CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,I0/W3,P$,O$,A9$,"",Q{ALL}; IF Q[0]>F4 THEN F4=Q[0]; GOTO 8375 ELSE GOTO 8375; REM "Use barcode module to print
8360 P$(I0+X9[F5]+Y9[F5]*W3,LEN(F5$))=F5$
8365 IF Y9[F5]>F4 THEN F4=Y9[F5]
8395 RETURN 
8400 REM "Take city,st,zip in A5$ in std format, and format into A6$
8410 IF POS(" "<>A5$(1,16))=0 THEN DIM A6$(30); GOTO 8440
8415 A6$=FNS$(A5$(1,16))+", "+A5$(17,2)+" "
8420 CALL "ZZDISP","AX",A5$(19,9),"ZIP",X3$,X$,"",0,0,X4$
8422 PERFORM "PO2PAB;GET_COUNTRY" ! ssp 307210
8425 A6$=A6$+STP(X$)+DISP_CNTRY$ ! SSP 307210
8430 A8$=X$
8445 RETURN 
8450 REM "Place in page offset by a number of lines
8451 REM "F5=field #, F5$=field info, F6= # of lines to offset position
8452 IF TOD_OK THEN IF NOT(DTP_MODE) THEN DTP_F5$=F5$ END_IF ; CALL "UPDDTP;UPDATE_LINE",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F6,F5,DTP_F5$,TOD_OK,DISP_CNTRY$ ! [SSP-201588], WO220758, SSP307325
8455 IF X9[F5]=0 THEN GOTO 8495 ELSE IF IL_ARCHIVE THEN GOSUB JETFORM_PRINT ELSE IF JETFORM_MODE THEN GOSUB JETFORM_PRINT; GOTO 8495 ! 180510
8456 IF B9=1 THEN CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,F6,P$,O$,A9$,"",Q{ALL}; GOTO 8375; REM "Use barcode module to print
8460 P$(X9[F5]+(Y9[F5]+F6)*W3,LEN(F5$))=F5$
8495 RETURN 
8500 REM "Print standard stuff on a line
8505 IF B$(2,1)="Y" AND JETFORM_MODE AND ((POS(A$(47,1)="RW",1)<>0 AND B[8]=0 AND B[7]<>0) OR (B[8]<>0 AND B[8]<>B[0])) THEN GOTO 8520 ELSE IF B$(2,1)="Y" AND JETFORM_MODE AND ((A$(47,1)=" " AND B[8]=0 AND B[7]<>0) OR (B[8]<>0 AND B[8]<>B[0])) THEN GOTO 8520; REM "THIS IS TO PREVENT THESE FIELDS FROM BEING PRINTED TWICE. Added B[8]<>0 AND B[8]<>B[0] part on ssp100467 for PMA, related to partial BO.  SSP177424, was just B[8]=0, added AND B[7]<>0
8514 IF POS(B$(155,1)="IC")>0 THEN F5$=B$(161,10)+B$(19,10),F5=100; GOSUB 8350; REM "ssp97823
8515 IF B$(155,1)<>"S" THEN CALL "ZZDISP","AX",B$(19,10),"ICE",X3$,F5$,"",0,0,X4$; F5=13; GOSUB 8350; F5=133; GOSUB 8350; F5=134; GOSUB 8350; X$=""; GOSUB 12000; F5=94,F5$=MID(F0$,350,20); GOSUB 8350; F5=155; GOSUB 8350 ! SSP WAS but if Jetform mode it was moving CIC up if you don't send blanksIF POS(" "<>MID(F0$,350,20))>0 THEN F5=94,F5$=F0$(350,20); GOSUB 8350 ! 188536!222119, WO241665, second and third printings of item number. WO257735, second printing of CIC
8516 IF B$(155,1)="S" AND (JETFORM_MODE OR UNFORM_MODE) THEN F5$=DIM(10),F5=13; GOSUB 8350; F5=133; GOSUB 8350; F5=134; GOSUB 8350 ! SSP#238650, WO241665, second and third printings of item number
8518 IF B$(9,1)<>" " THEN CALL "ZZDISP","AX",B$(94,10),"A/P",X3$,F5$,"",0,0,X4$; F5=117; GOSUB 8350
8520 F5=12,F5$=B$(50,40); GOSUB 8350; F5=131; GOSUB 8350; F5=132; GOSUB 8350; F5=76,H8$=B$; GOSUB 8000; F5$=H9$; IF X9$(76,1)="P" THEN F5$=B$(48,2); GOSUB 8350 ELSE GOSUB 8350 ! WO241665, second and third printings of item description
8521 IF TOD_OK THEN F5=3951,F5$=B$(18,1); CALL "UPDDTP;UPDATE_LINE",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F6,F5,F5$,TOD_OK,"" ! DBD-279-SSP307413 SPECIAL_SHIPPING
8525 F5$=""; IF POS(B$(155,1)="IC")>0 THEN IF B$(10,1)="9" THEN F5$="CUST" ELSE F5$="DIST"
8530 F5=22; GOSUB 8350
8535 F5=112,F5$=B$(6,3); GOSUB 8350 ! SSP283651, move line 2425 to line 8535 so we get the order line number for every line and lot line
8536 F5=160,F5$=B$(155,1); GOSUB 8350 ! SSP282705, Order Line Type
8537 DIM EEG$(380); IF FN%HAS_MODULE("EC") THEN FIND (Z[50],KEY=B$(147,8)+B$(6,3),DOM=*NEXT)EEG$(1); F5=161,F5$=STP(EEG$(12,100)); GOSUB 8350 ! SSP290922, 3rd party order line ID
8538 F5=162,F5$=FN%ZZDISP$(B$(161,10),"A/R"); GOSUB 8350 ! SSP305128, item's customer code - formatted
8539 F5=163,F5$=B$(161,10); GOSUB 8350 ! SSP305128, item's customer code - unformatted
8540 GOSUB 6400
8545 RETURN 
8550 REM "Given u/m U5$, decide whether or not to print U/M desc.
8551 REM "Set U5 to 1 if we print, else oto 0
8552 U5=0
8555 IF U5$<>M$(4,4) THEN DIM M$(21),M[2]; FIND (Z[13],KEY="U/M"+U5$,DOM=8556)IOL=0430
8556 IF POS(U5$="CASECTN CTNS",4)<>0 THEN U5$="  "; REM "Customer 531 using CS to get around this feature!SSP#220190 - Removed the return changed U5 to blanks E/F issue
8560 IF M$(20,1)="Y" THEN U5$="    " ! SSP#220190 E/F issue if it doesn't send fld
8565 F5$=U5$,F5=28; GOSUB 8350
8570 IF STP(U5$,3)<>"" THEN U5=1 ! SSP#220190
8595 RETURN 
8600 REM "Non lot inv, calc # to print based on carton pack or var u/m, and print truncated amount in total cases. If not evenly divisable then create new line with a short case.
8601 REM "If U5 is 0, don't amount here
8605 P5=B[12]; IF P5=0 THEN P5=B[5] ! 233490
8610 IF P5=0 THEN RETURN 
8611 IF X9$(20,1)="U" AND B$(9,1)<>" " THEN GOTO 8612 END_IF ; IF X9[36]<>0 THEN RETURN ! SSP#294495
8615 ! F5=20,F5$=STR(P5:M5$); GOSUB 8350 !SSP#236040 Needs to do check 1st
8620 P6=B1/P5
8622 IF B1<>0 AND B1<P5 THEN GOTO 8648
8623 F5=20,F5$=STR(P5:M5$); GOSUB 8350 ! ssp#236040
8625 IF B1-INT(P6)*P5=0 THEN F5=17,F5$=STR(P6:M5$),T9[10]=P6,T9[9]=B1; GOSUB 3800; GOSUB 7675; RETURN 
8630 F5=17,F5$=STR(INT(P6):M5$),T9[10]=INT(P6); GOSUB 3800
8633 GOSUB 7675 ! F5=21,F5$=FNQ$(INT(P6)*P5,Z2$),T9[9]=INT(P6)*P5; GOSUB 8350; GOSUB 7675 ! does this at 7745 if non lotted, 8172 if lotted SSP#236040
8635 L0=L0+1,PL_LINE=PL_LINE+1,I1=I1+F4-1,I0=I0+W3+Y9[20]*W3,F4=0 ! 233490!SSP#262220
8640 IF L0>=Y8[3] THEN F5=115; F5$="*Continued*"; GOSUB 8300; GOSUB 2900; GOSUB 2000; I0=(Y8[2]-1)*W3; GOSUB 8980; PL_LINE=PL_LINE+1; REM "108433
8645 IF JETFORM_MODE=0 THEN GOSUB 8500
8648 P7=B1-INT(P6)*P5
8650 F5$="*",F5=27; GOSUB 8350
8655 F5=20,F5$=STR(P7:M5$); GOSUB 8350
8657 F5=17,F5$=STR(1:M5$),T9[10]=1; GOSUB 3800
8660 GOSUB 7675 ! F5=21,F5$=FNQ$(P7,Z2$),T9[9]=P7; GOSUB 8350; GOSUB 7675 ! does this at 7745 if non lotted, 8172 if lotted SSP#236040
8665 U5$=B$(124,4); GOSUB 8550
8670 GOSUB 8055
8672 L0=L0+1,PL_LINE=PL_LINE+1,I1=I1+F4-1,I0=I0+W3+Y9[20]*W3,F4=0 ! SSP 278261
8675 IF L0>=Y8[3] THEN F5=115; F5$="*Continued*"; GOSUB 8300; GOSUB 2900; GOSUB 2000; I0=(Y8[2]-1)*W3; GOSUB 8980; PL_LINE=PL_LINE+1; REM SSP 278261
8695 RETURN 
8700 REM "3.1.3 Line items"
8705 IF POS(B$(155,1)="M")>0 THEN RETURN 
8707 REM "IF POS(X3$(9,3)="434")=0 THEN IF B[7]=0 AND B[8]=0 THEN B[7]=B[0]
8708 IF B$(155,1)=" " AND B$(9,1)<>" " AND B[8]=0 AND B[7]=0 THEN B[7]=B[0]
8709 IF POS(A$(47,1)="WR")=0 THEN IF POS(B$(155,1)="IC")<>0 AND B$(9,1)=" " AND B[7]<>0 THEN B[8]=ABS(B[7]-B[0]) ELSE IF POS(A$(47,1)="WR")=0 THEN IF POS(B$(155,1)="IC")<>0 AND B$(9,1)=" " AND B[7]=0 AND B[8]=0 THEN B[7]=B[0]
8710 IF X9[36]<>0 AND B[0]<>0 THEN IF B1<>0 THEN F5=36,J0=B1; GOSUB 8842 ELSE F5=36,J0=B[0]; GOSUB 8842
8715 REM "IF (X9[37]<>0 AND B[7]<>0 AND JETFORM_MODE=0 OR B$(2,1)<>"Y" AND B1<>0 AND POS(A$(47,1)="WR")=0) THEN F5=37,J0=B1; GOSUB 8842 ELSE F5=37,J0=B[7]; GOSUB 8842; REM SSP 194742
8716 IF X9[37]<>0 AND B[7]<>0 THEN IF JETFORM_MODE=0 OR B$(2,1)<>"Y" THEN IF B1<>0 AND POS(A$(47,1)="WR")=0 THEN F5=37,J0=B1; GOSUB 8842 ELSE F5=37,J0=B[7]; GOSUB 8842
8720 IF X9[38]<>0 THEN F5=38,J0=B[8]; GOSUB 8842
8730 F5=44,F5$=B$(124,4); GOSUB 8350
8732 IF X9[45]=0 AND X9[46]=0 THEN GOTO 8770
8733 IF X9[58]>0 AND B$(155,1)="C" AND (B[6]=0 OR B[4]<>0) THEN GOSUB 8250; GOTO 8735; REM "FMS Price
8734 IF X9[46]=0 AND B[4]=0 THEN J0=B[6],F5=45,F5$=STR(J0:Z5$); GOSUB 8350; GOTO 8760
8735 IF B[0]<>0 OR B[7]<>0 THEN F5=45,F5$=STR(B[4]:Z5$); GOSUB 8350 ELSE J0=B[6]; GOTO 8760
8750 CALL "FM2EXT",Z[13],0,B$(124,4),B[5],B[7],B[4],J0,2
8760 IF MID(CUST_PARM$,104,1)="Y" AND B$(10,1)="9" OR (MID(CUST_PARM$,104,1)="Y" AND V0$(61,1)="B") THEN GOSUB 6700 END_IF ; F5=46,F5$=STR(J0:Z5$); GOSUB 8350; T9=T9+J0; REM "Must extend to total. WO155872, get value of lots if 9000 whse and cust parm set
8770 F9=0; IF B[12]=0 OR B[7]=0 OR X9[73]=0 THEN GOTO 8775 ELSE F5=73; IF ABS(B[7])<B[12] THEN J0=1 ELSE PRECISION 6; J0=INT(ABS(B[7])/B[12])*SGN(B(7)); PRECISION 2; F9=ABS(B[7])-B[12]*J0*SGN(B(7)); REM "SSP#202823
8772 F5$=STR(J0*SGN(B[7]):M0$); GOSUB 8350
8775 IF B[12]<>0 THEN F5=74; IF ABS(B[7])<B[12] THEN F5$=STR((B[7]):Z3$); GOSUB 8350; F5=135; GOSUB 8350; F5=136; GOSUB 8350 ELSE F5$=STR(B[12]:Z3$); GOSUB 8350; F5=135; GOSUB 8350; F5=136; GOSUB 8350; REM "SSP#202823, WO241665, second and third printings of carton pack
8790 GOSUB 8850; GOSUB 8900
8795 RETURN 
8800 REM "Convert Qty to U/M"
8820 CALL "FM2EXT",Z[13],2,B$(124,4),B[5],J0,0,0,2
8830 IF FPT(J0)<>0 THEN F5$=STR(J0:Z4$) ELSE F5$=STR(J0:Z3$)
8835 GOSUB 8350
8840 RETURN 
8841 REM "Test for eaches
8842 IF POS(X9$(F5,1)="EeQ")=0 THEN GOTO 8800
8845 F5$=STR(J0:Z3$); GOTO 8835
8850 REM "Cost
8855 IF X9[48]=0 AND X9[49]=0 THEN GOTO 8890
8860 IF X9[49]=0 AND B[1]=0 THEN J1=B[3],F5=48,F5$=STR(J1:Z5$); GOSUB 8350; GOTO 8890
8865 IF B[0]=0 AND B[7]=0 THEN J1=B[3]; GOTO 8880
8866 CALL "FM2EXT",Z[13],1,B$(124,4),B[5],B[7],J1,B[3],2
8868 F5=48,F5$=STR(J1:Z5$); GOSUB 8350
8870 CALL "FM2EXT",Z[13],0,B$(120,4),B[2],B[7],B[1],J1,2
8880 F5=49,F5$=STR(J1:Z5$); GOSUB 8350; T8=T8+J1; REM "Extend cost total
8890 RETURN 
8900 REM "Commission
8910 DIM C0$(32),C0[15]; FIND (Z[12],KEY=B$(128,5),DOM=8911)IOL=0460
8920 IF B$(50,10)<>"XXXXXXXXXX" THEN CALL "AR2COM","",C0$,C0{ALL},J2,J0,J1
8930 T7=T7+J2,F5=53,F5$=B$(128,5); GOSUB 8350
8940 RETURN 
8950 DEF FNQ$(Z9,Z9$)=STR(Z9:Z9$)
8980 REM "Reset line counters used by jetform for positioning line fields
8985 PL_LINE=0; DIM P_LINE[FN%NEA("X9",1)]
8990 RETURN 
9000 REM "ERROR PROCESSING
9002 ! IF %UNATTEND THEN PRINT @(0,10),'CL',"Unattended Error: Program FM2RBC: Error ",STR(ERR),": Line ",STR(TCB(5)),
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9020 IF %UNATTEND THEN {! 257735 - Unattended error handling, logging
9022 IF NUL(%UNATTEND_ERROR$) THEN %UNATTEND_ERROR$="ERR: "+STR(Y5)+" AT: "+STR(Y6)+" IN FM2RBC"
9025 IF NOT(%GUI) THEN PRINT @(0,10),'CL',"Unattended Error: Program FM2RBC: Error ",STR(Y5),": Line ",STR(Y6),@(0,11),%UNATTEND_ERROR$,
9026 ERR_MSG$=FN%ZZDISP$(MID(LAST$,6,8),"O/P")+"|"+%UNATTEND_ERROR$
9027 CALL "ZZ2LOG;LOG_MSG",ERR=*NEXT,X3$,X4$,%LOG_CHANNEL,"EXCP|"+ERR_MSG$+"|",%LOG_DEBUG
9030 IF NOT(NUL(%UNATTEND_EMAIL$)) THEN {
9031 NOTIFYMSG$=""; NOTIFYMSG$=FN%SENDMAIL$(%UNATTEND_EMAIL$,"","","","Unattended Printing Error - SO# "+FN%ZZDISP$(MID(LAST$,6,8),"O/P"),"An error occurred when printing packing list for order: "+ERR_MSG$,"",""); NOTIFYMSG++; IF NOTIFYMSG>=10 THEN NOTIFYMSG$=FN%SENDMAIL$(%UNATTEND_EMAIL$,"","","","Fatal Unattended Printing Error - SO# "+FN%ZZDISP$(MID(LAST$,6,8),"O/P"),"Please review Unattended Printing session for Group "+%UNATTEND_GROUP$+"! Unrecoverable error when printing packing list for order: "+ERR_MSG$,"",""); ESCAPE ! 268007-Unrecoverable error - requires admin manual intervention
9032 IF NUL(NOTIFYMSG$) THEN %UNATTEND_ERROR$=""; GOTO 1900 ELSE CALL "ZZ2LOG;LOG_MSG",ERR=*NEXT,X3$,X4$,%LOG_CHANNEL,"EXCP|EMAIL NOTIFICATION ERROR|"+NOTIFYMSG$+"|",%LOG_DEBUG
9033  }
9034 %UNATTEND_ERROR$="" ! Clear error
9035  }
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000 ! 188536
9520 ON C9 GOTO 1140,2040
9750 REM 
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1; ON Z0 GOTO 9761,9900
9790 RETURN 
9900 REM "End program
9908 IF IL_DEVICE THEN CLOSE (IL_DEVICE) ! 180510
9909 IF V8$="A" THEN V3$(2,6)="AUTO"+V7$
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9912 IF V3$(2,1)="T" THEN GOSUB 5325; REM rebuild po6 for screen
9915 IF V8$="A" OR (Y4$<>X0$ AND V3$(2,1)<>"T") THEN GOSUB 5300
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9921 CLOSE (MMF,ERR=*NEXT); REM SSP 206969
9922 CLOSE (MEM_FL,ERR=*NEXT) ! [SSP-201588]
9923 IF OOP>0 THEN DROP OBJECT OOP ! [SSP-201588]
9925 IF %GUI THEN GOTO 9930
9926 SETERR 9927; EXIT 
9930 IF NOT(NUL(Y4$)) THEN IF %GUI THEN CALL Y4$,ERR=9931 ELSE RUN Y4$,ERR=9931
9932 IF %UNATTEND THEN CALL "ZZ2LOG;CLOSE_LOG",ERR=*NEXT,X3$,X4$,%LOG_CHANNEL; %LOG_CHANNEL=0 ! 257735 - Close log channel
9940 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
10000 GET_ORDER:
10005 CH=Z[4]
10010 EOF=1
10020 KY_FILE$=KEY(CH,END=*RETURN); IF KY_FILE$(1,1)<>BLD$ THEN GOTO *RETURN ELSE KY_FILE$=KY_FILE$(2)
10022 CUR_KY_FILE$=KY_FILE$
10025 IF GB$="Y" THEN GBU$=KY_FILE$; IF GBU$(2,1)<>"!" THEN GBU$=""; GOTO *NEXT ELSE IF (GBU$(3,1)="Y" AND V0$(61,1)<>"G") OR (GBU$(3,1)<>"Y" AND V0$(61,1)="G") THEN READ (CH); GOTO 10020 ELSE U$=GBU$(1,1)+GBU$(9); GOTO 10045
10027 IF LEN(V0$)<201 THEN V0$=PAD(V0$,201)
10033 IF V0$(61,1)<>"B" AND V0$(201,1)<>"Y" AND BLD$<>"1" THEN KY_FILE$=KY_FILE$(1,5)+KY_FILE$(8)
10035 IF V0$(61,1)="B" THEN IF MID(V0$,201,1)="Y" THEN U$=KY_FILE$(1,1)+KY_FILE$(10,4)+KY_FILE$(2,8)+KY_FILE$(24) ELSE U$=KY_FILE$(1,13)+KY_FILE$(24)
10040 IF V0$(61,1)<>"B" THEN IF MID(V0$,201,1)="Y" THEN U$=KY_FILE$(1,1)+KY_FILE$(10,4)+KY_FILE$(2,8)+KY_FILE$(14,3)+MID(KY_FILE$,27,1) ELSE U$=KY_FILE$
10045 IF MID(V0$,201,1)="Y" AND V0$(61,1)<>"B" THEN U$=KY_FILE$(1,1)+KY_FILE$(10,4)+KY_FILE$(2,8)+KY_FILE$(14,3)+MID(KY_FILE$,27,1)
10052 READ (CH)
10072 EOF=0
10095 RETURN 
10100 LOCK_ORDER:
10101 IF LEN(V0$)<212 THEN V0$=PAD(V0$,212)
10102 BSY=1,CURR_ORD$=U$(6,8)
10104 READ (MMF,KEY=CURR_ORD$,DOM=*NEXT)MEM$; GOTO 10160; REM SSP 206959
10110 EXTRACT (Z[2],KEY=CURR_ORD$,ERR=*RETURN)IOL=0310
10112 IF V0$(202,10)<>DIM(10) THEN IF A$(6,10)<>V0$(202,10) THEN READ (Z[2],ERR=*RETURN); GOTO *RETURN
10115 IF A$(1,1)="9" THEN A$(1,1)="8"
10120 A$(128,1)="Y",A$(1,1)=STR(NUM(A$(1,1))+1:"0")
10150 WRITE (Z[2],KEY=CURR_ORD$)IOL=0310
10155 WRITE (MMF,KEY=CURR_ORD$)CURR_ORD$; REM SSP 206959
10160 BSY=0
10190 RETURN 
10200 BUILD_LIST:
10202 IF BSY=0 THEN WRITE (Z[4],KEY="1"+KY_FILE$)
10205 REMOVE (Z[4],KEY=" "+CUR_KY_FILE$)
10220 KY4$=KEY(Z[4],END=10290); IF KY4$(1,1)<>" " THEN GOTO 10290
10225 KY4$=KY4$(2)
10230 IF KY4$(ORD_POS,8)<>CURR_ORD$ THEN READ (Z[4]); GOTO 10220
10235 REMOVE (Z[4],KEY=" "+KY4$)
10240 IF BSY=0 THEN WRITE (Z[4],KEY="1"+KY4$); READ (Z[4],KEY=" "+KY4$,ERR=*NEXT)
10250 GOTO 10220
10290 READ (Z[4],KEY=" "+CUR_KY_FILE$,ERR=*NEXT)
10295 RETURN 
10300 REMOVE_SORT:
10310 READ (Z[4],KEY=" ",DOM=*NEXT)
10320 KY4$=KEY(Z[4],END=*RETURN); IF KY4$(1,1)<>" " THEN GOTO *RETURN ELSE IF POS(U$(8,8)=KY4$(ORD_POS,8))=0 THEN READ (Z[4]); GOTO *SAME
10330 REMOVE (Z[4],KEY=KY4$)
10340 GOTO 10320
10390 RETURN 
11000 IMAGE_LIBRARY_SETUP:! If needed, setup parameters to add image library info to Jetform call
11005 IF %HAS_IMAGE_LIB THEN {
11020 %IL_ADD_DOC_TYPE$="A1"
11025 %IL_ADD_TF1$=A$(118,8) ! Order number
11030 %IL_ADD_TF2$=E$(11,5)+A$(118,8)+LAST$(2,4)+STR(P9) ! Warehouse type and code SSP217911!SSP#293726
11034 DTS$=DTE(0:"%Yz%Mz%Dz_%Hz%mz%s") ! SSP287486, add date/time
11035 IMG_SEQ$=A$(1,1); IF IMG_SEQ$=DIM(1) THEN IMG_SEQ$="0" ! SSP209068
11036 IF NOT(NUL(PL_ALT_SELECTION$)) THEN IMG_SEQ$+="A" ! 263161
11040 %IL_ADD_IMAGE_PATH$=STP(FN%ZZDISP$(MID(A$,118,8),"O/P"))+"_"+MID(LAST$,2,4)+"_"+STR(P9)+"_"+IMG_SEQ$+"_"+DTS$ ! SSP#185008, SSP209068, SSP287486
11045 %IL_FORMAT$=V0$(60,1) ! 186095
11075  } ELSE {
11080 %IL_ADD_DOC_TYPE$="",%IL_ADD_TF1$="",%IL_ADD_TF2$="",%IL_ADD_IMAGE_PATH$="",%IL_FORMAT$="" ! 186095
11085  }
11095 RETURN 
11099 ! ****************************************************************
12000 ! Get F0$ - FM1 info 188536
12005 DIM F0$(500),F0[31]
12010 IF POS(X3$(9,3)="352",3)=0 THEN F0$(350,20)=B$(19,10)
12020 GOSUB SET_READONLY; FIND (Z[14],KEY=B$(161,10)+B$(19,10),DOM=*NEXT)IOL=0440; GOTO 12094 ! SSP#229234, SSP233147
12030 IF POS(X3$(9,3)="074579629",3)<>0 AND STP(B$(161,10))="" THEN FIND (Z[14],KEY=A$(6,10)+B$(19,10),DOM=*NEXT)IOL=0440 ! SSP#229234!SSP#289455
12094 GOSUB CLEAR_READONLY ! SSP233147
12095 IF MID(X9$,94,1)="F" AND STP(F0$(350,20),3," ")="" THEN F0$(350,20)=B$(19,10) ! SSP#291683
12098 RETURN ! SSP#291683
12099 ! **********************************************88
12100 CHECK_ORDER_LINES:! WO246220 - read through lines and look for release types that are pulling from different warehouse that this one and whether there are any lines that contain a PO code.
12105 MULT_WHSE$=DIM(19),SLS_ORD$=DIM(11)
12110 DIM FS2$(356); READ (Z[3],KEY=LAST$(6,8),DOM=*NEXT)
12115 FS2_KEY$=KEY(Z[3],END=*RETURN); IF FS2_KEY$(1,8)<>LAST$(6,8) THEN RETURN 
12120 READ (Z[3],KEY=FS2_KEY$)FS2$(1)
12125 IF POS("P"=FS2$(156,5))>0 THEN CHECK_WHSE$=FS2$(10,4); IF STP(CHECK_WHSE$)="" OR CHECK_WHSE$="DS  " THEN CHECK_WHSE$=FS2$(215,4) END_IF ; IF STP(CHECK_WHSE$)="" OR CHECK_WHSE$="DS  " THEN GOTO *NEXT ELSE IF CHECK_WHSE$(2,3)<>LAST$(3,3) THEN MULT_WHSE$="MULTIPLE WAREHOUSES"
12130 IF FS2$(9,1)<>DIM(1) THEN SLS_ORD$="SALES ORDER"
12135 IF STP(MULT_WHSE$)>"" AND STP(SLS_ORD$)>"" THEN RETURN ELSE GOTO 12115
12140 RETURN 
12145 ! 
12150 OUTPUT_ORDER_CUST_REF:! WO249287
12155 IF STP(FV1$,2)="" THEN RETURN 
12160 IF X9[142]<>0 THEN F5=142; F5$=STP(FV1$(19,60),1); GOSUB 8300 ! WO249287
12162 IF X9[143]<>0 THEN F5=143; F5$=STP(FV1$(79,60),1); GOSUB 8300 ! WO249287
12164 IF X9[144]<>0 THEN F5=144; F5$=STP(FV1$(139,60),1); GOSUB 8300 ! WO249287
12166 IF X9[145]<>0 THEN F5=145; F5$=STP(FV1$(199,60),1); GOSUB 8300 ! WO249287
12168 IF X9[146]<>0 THEN F5=146; F5$=STP(FV1$(259,60),1); GOSUB 8300 ! WO249287
12170 IF X9[147]<>0 THEN F5=147; F5$=STP(FV1$(319,60),1); GOSUB 8300 ! WO249287
12172 IF X9[148]<>0 THEN F5=148; F5$=STP(FV1$(379,60),1); GOSUB 8300 ! WO249287
12174 IF X9[149]<>0 THEN F5=149; F5$=STP(FV1$(439,60),1); GOSUB 8300 ! WO249287
12176 IF X9[150]<>0 THEN F5=150; F5$=STP(FV1$(499,60),1); GOSUB 8300 ! WO249287
12178 IF X9[151]<>0 THEN F5=151; F5$=STP(FV1$(559,60),1); GOSUB 8300 ! WO249287
12180 IF X9[156]<>0 THEN F5=156; F5$=STP(FV1$(19,60),1); GOSUB 8300 ! WO257735, second printing of OCR 1
12182 IF X9[157]<>0 THEN F5=157; F5$=STP(FV1$(79,60),1); GOSUB 8300 ! WO257735, second printing of OCR 2
12195 RETURN 
12199 ! 
12200 BUILD_COMPANION_LIST:! Read through lines and look for master and companion pairs
12210 DIM FS2$(356); COMP$=""; READ (Z[3],KEY=LAST$(6,8),DOM=*NEXT)
12215 FS2_KEY$=KEY(Z[3],END=*RETURN); IF FS2_KEY$(1,8)<>LAST$(6,8) THEN RETURN 
12220 READ (Z[3],KEY=FS2_KEY$)FS2$(1)
12225 IF NOT(NUL(FS2$(230,3))) AND POS(FS2$(155,1)="MS")>0 AND POS("P"=MID(FS2$,156,5))>0 THEN COMP$+=FS2$(230,3)+FS2$(6,3) ! only check for "M" or "S" type companion lines
12235 GOTO 12215
12240 RETURN 
12249 ! 
14000 REM "Missing info on second line of lot for jetform
14005 IF FIRST_LOT$="Y" OR (FIRST_LOT$="" AND V0$(61,1)="D") THEN GOTO 14060 ! SSP#220190
14010 IF POS("D"=V0$(61,10))<>0 THEN IF X9[36]<>0 THEN F5=36,F5$="  "; GOSUB 8350 ! SSP#222119
14011 IF X9[17]<>0 THEN F5=17,F5$="  "; GOSUB 3790
14012 IF X9[21]<>0 THEN F5=21,F5$="  "
14013 IF X9[21]<>0 THEN F5=21,F5$="  "; GOSUB 8350
14014 IF X9[15]<>0 THEN F5=15,F5$=DIM(10); GOSUB 8350
14015 IF X9[20]<>0 THEN F5$="  ",F5=20; GOSUB 8350
14016 IF X9[123]<>0 THEN F5=123,F5$=DIM(8); GOSUB 8350
14017 IF X9[14]<>0 THEN F5=14,F5$=DIM(8); GOSUB 8350
14018 IF X9[37]<>0 THEN F5=37,F5$="  "; GOSUB 8350 ! SSP#222119
14019 IF POS("D"=V0$(61,10))<>0 AND B$(155,1)="S" AND X9[15]<>0 THEN F5=15,F5$="   "; GOSUB 8350 ! SSP#220190
14020 IF POS("D"=V0$(61,10))<>0 AND B$(155,1)="S" AND X9[13]<>0 THEN F5=13,F5$="   "; GOSUB 8350 ! SSP#220190
14025 IF POS("D"=V0$(61,10))<>0 AND B$(155,1)="S" AND X9[133]<>0 THEN F5=133,F5$="   "; GOSUB 8350 ! WO241665, second printing of item number
14030 IF POS("D"=V0$(61,10))<>0 AND B$(155,1)="S" AND X9[134]<>0 THEN F5=134,F5$="   "; GOSUB 8350 ! WO241665, third printing of item number
14999 RETURN 
15000 REM "Missing info for M type lines
15010 IF X9[37]<>0 THEN F5=37,F5$="  "; GOSUB 8350
15012 IF X9[38]<>0 THEN F5=38,F5$="  "; GOSUB 8350
15014 IF X9[44]<>0 THEN F5=44,F5$="  "; GOSUB 8350
15016 IF X9[21]<>0 THEN F5=21,F5$="  "; GOSUB 8350
15017 IF X9[20]<>0 THEN F5=20,F5$="  "; GOSUB 8350 ! SSP#220190
15018 IF X9[17]<>0 THEN F5=17,F5$="  "; GOSUB 8350 ! SSP#220190
15019 IF POS("D"=V0$(61,10))=0 THEN IF X9[28]<>0 THEN F5=28,F5$="  "; GOSUB 8350 ! SSP#220190
15020 IF X9[15]<>0 THEN F5=15,F5$="  "; GOSUB 8350 ! SSP#220190
15021 ! IF POS("D"=V0$(61,10))=0 THEN IF X9[13]<>0 THEN F5=13,F5$="  "; GOSUB 8350 ! SSP#220190
15999 RETURN 
16000 GET_FIELDS:! [SSP-201588]-added routine
16100 ORDER$=A$(118,8) ! set the order number from FS1
16105 DIVISION$=A$(118,2) ! set the division from FS1
16110 WAREHOUSE$=LAST$(2,4) ! set the warehouse from PO6
16115 CUSTOMER$=A$(6,10) ! set the customer from FS1
16120 FLEX_FORMAT_CODE$=" " ! V0$(60,1) ! set the flex format code
16125 GOSUB GET_SHIP_VIA_CODE ! set the ship via code
16195 RETURN 
16198 ! 
16199 ! 
16200 GET_SHIP_VIA_CODE:! [SSP-201588]-added routine
16210 SHIP_VIA_CODE$=" " ! clear the ship via code
16220 SPECIAL_SHIPPING_FLAG$=B$(18,1) ! set the special shipping flag from FS2
16225 ORDER_LINE_NUM$=B$(6,3) ! set the Order Line Number from FS2
16230 IF (SPECIAL_SHIPPING_FLAG$<>"Y") THEN {! no special shipping for the line
16240 TMP_PO3_KEY$=ORDER$+DIM(5) ! set the PO3 key
16250  } ELSE {! special shipping
16260 TMP_PO3_KEY$=ORDER$+" "+ORDER_LINE_NUM$+"1" ! set the PO3 key
16270  }
16280 READ (PO3_FL,KEY=TMP_PO3_KEY$,DOM=*RETURN,ERR=9000)IOL=0495 ! read the PO3 record
16290 SHIP_VIA_CODE$=PO3$(150,1) ! set the ship via code
16395 RETURN 
16398 ! 
16399 ! 
16400 UPDATE_FIELDS:! [SSP-201588]-added routine
16410 F5=400; F5$=OK_TO_PRINT$ ! Update Ok To Print
16415 CALL "UPDDTP;UPDATE_LINE",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F6,F5,F5$,TOD_OK,"" ! SSP307325
16420 F5=401; F5$=DIVISION$ ! Update Division
16425 CALL "UPDDTP;UPDATE_LINE",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F6,F5,F5$,TOD_OK,"" ! SSP307325
16430 F5=402; F5$=FLEX_FORMAT_CODE$ ! Update Flex Format Code
16435 CALL "UPDDTP;UPDATE_LINE",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F6,F5,F5$,TOD_OK,"" ! SSP307325
16447 F5=3693,F5$=A$(6,10) ! Update the Customer
16450 CALL "UPDDTP;UPDATE_LINE",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F6,F5,F5$,TOD_OK,"" ! SSP307325
16453 F5=3748,F5$=WAREHOUSE$ ! Update the actual warehouse - 234689
16456 CALL "UPDDTP;UPDATE_LINE",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F6,F5,F5$,TOD_OK,"" ! SSP307325
16495 RETURN 
16498 ! 
16499 ! 
16500 OUTPUT_DIRECTOR_TRIGGER:! SSP248639, move logic to start new one from 1501-1510 to this GOSUB, will be invoked in 1520-1590 loop when we are starting to output a PL, needed because special shipping wasn't working.
16505 ! 
16510 TOD_OK=0 ! [SSP-201588]
16515 GOSUB GET_FIELDS ! [SSP-201588]
16520 TOD_TRANS$="",TOD_SEQ=0; CALL "UPDDTP;GET_EF_TRANS_NUM",OOP,ZZPARM_FL,MEM_FL,X3$,ORDER$,DIVISION$,WAREHOUSE$,CUSTOMER$,SHIP_VIA_CODE$,FLEX_FORMAT_CODE$,TOD_TRANS$,TOD_SEQ,TOD_OK ! [SSP-201588] WO220758, only do this if OPS parm set for TOD packing list
16525 IF TOD_OK THEN TOD_SEQ=0 ! [SSP-201588]
16530 IF TOD_OK THEN GOSUB UPDATE_FIELDS ! [SSP-201588]
16535 IF TOD_OK THEN TOD_UPDATE=1 ! [SSP-201588]
16540 RETURN 
16545 ! 
16550 OUTPUT_DIRECTOR_FINISH:! SSP248639, move logic to finish one from 5000's to this GOSUB, will be invoked in 1520-1590 look when we are finished with output of this PL, needed because special shipping wasn't working.
16555 ! 
16560 CALL "UPDDTP;UPDATE_HDR_INFO",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,MEM_FL ! [SSP-201588]
16565 CALL "UPDDT6;ADD_TO_QUEUE",DT6_FL,MEM_FL,TOD_OUTPUT_TYPE$ ! [SSP-201588]
16590 RETURN 
16595 ! 
16600 OUTPUT_DIRECTOR_SHIPVIA:! SSP248639, move logic to output ship via code from 16400's to this GOSUB, will be invoked at 2340 when the ship via desc ffu is output so we know we have the correct one, needed because special shipping wasn't working.
16605 ! 
16610 F5=403; F5$=E$(150,1)
16615 CALL "UPDDTP;UPDATE_LINE",DTP_FL,TOD_OUTPUT_TYPE$,TOD_TRANS$,TOD_SEQ,F6,F5,F5$,TOD_OK,"" ! SSP307325
16640 RETURN 
16645 ! 
16700 ! SSP257735 - Re-read program report print selection variables and flex format data, support for alternate formats on order-by-order basis
16705 INIT_FF_SETTINGS:
16706 IOL_ALT_SEL:IOLIST V0$,V3$,V2$
16707 PMODE=0,JETFORM_MODE=0,UNFORM_MODE=0
16708 GOSUB 7400 ! Read original selection settings
16710 PL_ALT_SELECTION$="",PL_ALT_P0$="",PL_ALT_P1$=""; IF NOT(NUL(MID(A$,374,12))) THEN READ (Z[38],KEY="FM2RBA"+MID(A$,374,12),DOM=*NEXT)IOL=IOL_ALT_SEL; V2$="LL"+V2$; PL_ALT_SELECTION$=A$(374,12); PL_ALT_P0$=P0$; PL_ALT_P1$=P1$; GOTO 16715 ! 263161
16712 IF %UNATTEND THEN CALL "ZZ2LOG;LOG_MSG",ERR=*NEXT,X3$,X4$,%LOG_CHANNEL,"INFO|"+FN%ZZDISP$(MID(LAST$,6,8),"O/P")+"|LINE|"+LAST$+"|"+TBL(NUL(MID(A$,374,12)),"ALT SEL|"+MID(A$,374,12)+"|NOT FOUND|",""),%LOG_DEBUG ! 257735
16716 ! Check if barcode module is in use
16718 B9=0; CALL "BC2VER",ERR=GET_FLEX_FORMAT,"","",""; B9=1 ! B9=1 means use Barcode module
16720 DIM D9$(11),A0$(33),A0[10],Y8[5]; D9$(1)="856",D9$(11,1)=V0$(60,1); CALL "BC2FMZ",X3$,X4$,D9$,A0$,A0{ALL},X9{ALL},X9$,Q1$,Q{ALL},C0; IF C0=0 THEN W3=A0[2],Y8[0]=A0[0],Y8[2]=A0[4],Y8[3]=A0[5]; GOTO OPEN_PRINTER ELSE B9=0
16722 ! Get new flex format
16730 GET_FLEX_FORMAT:
16732 READ (Z[13],KEY="FORMATPL"+V0$(60,1))IOL=0314,IOL=0315
16760 SET_LINES:
16762 W3=Y8[1]
16770 OPEN_PRINTER:! Open Printer
16772 CLOSE (W9); CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO *NEXT,9920
16774 X$=V3$,ITEM_CODE$="856"+DIM(7)+V0$(60,1); CALL "EF2PRM",ERR=*NEXT,X3$,X4$,X$,E7$,E6$,ITEM_CODE$,ITEM_PARM$; IF E7$(144,2)="JF" THEN JETFORM_MODE=1,JETFORM_DEV=W9,JF_CHAN=W9,PMODE=JETFORM_MODE ELSE IF E7$(144,2)="UF" THEN UNFORM_MODE=2,UNFORM_DEV=W9,PMODE=UNFORM_MODE
16776 IL_ARCHIVE=0; IF JETFORM_MODE=0 AND UNFORM_MODE=0 AND %HAS_IMAGE_LIB THEN TMP=MSK(V0$(59,12),"![^ ][^ ]"); IF TMP THEN IL_ARCHIVE=1,ILA$=""; DIM EF_PARAMS$(200); EF_PARAMS$(146,3)="J"; IL_DEVICE$=V0$(59+TMP,2); IL_DEVICE=HFN; OPEN (IL_DEVICE)IL_DEVICE$; JF_CHAN=IL_DEVICE
16795 RETURN 
16799 ! 
17000 REM "Establish Bin mask SSP 217136
17010 IF X9$(15,1)<>"M" THEN RETURN ! SSP 217136
17030 CALL "UPDFM0;GET_BIN_MASK",Z[7],B$(10,4),E0$(100,10),BMASK$ ! W/H from FS2 SSP 217136
17040 F5$=BMASK$ ! SSP 217136
17050 RETURN ! SSP 217136
56000 REM "206959-The word "REPRINT" is printing on the DTs. This is the
56010 REM "209068-Add sequence to image name for multiple printings
56011 REM "213499-Issue with packing list before release one way and after
56012 REM "201588-Create XML output of orders to remote warehouse location
56020 ! WO214478-Modify Packing List Printing with a new option for the Bin Sort to ignore the first character if it's ?,*,!,^
56022 REM "217136 Print Bin location with mask for WMS
56024 REM "220758-Additional to WO201588 - COMAC XML Packing List
56025 REM "229234-Need to have the CIC code print on the P/List.  This needs
56026 REM "233029-Qty and u/m fields moving down a line for full backorders
56027 REM "233490-Item missing from Packing List
56028 REM "234689-Create new Output Director report for the WHS_PACKING_LIST
56030 REM "236789-Add flexible format field for PO and PL, ship-to phone num.
56032 REM "233147-Get an error 0 in FM2RBC at line 5660 in unattended often.
56034 REM "238037-IM XML, if item appears 3 times, only first and third line
56035 REM "238650-If item doesn't have a supplier id, then the supplier id
56036 REM "238796-WebEC Buyer bill to override is not working
56038 REM "233147-Get error 0 in unattended, packing list and PO printing.
56040 ! WO241665-Second and third printings of five fields
56041 REM "240963-Release 01-110490 - the packing list didn't print correct
56042 REM "241023-Modify printing programs to use Unform
56044 REM "246220-Two Packing List Flexible Format fields; MULTIPLE WAREHOUSES
56046 REM "246946-Packing List Flexible Format/Printing - Account Number from
56048 REM "246611-3 parting packing slips are not printing in order using
56050 REM "248639-DTP address fields missing data, special shipping support.
56052 ! 249287-Add Order Customer References to Packing List Printing
56054 REM "257917-Customer parameter to trigger location code instead of recv
56055 REM "257735-Trigger alternate packing list format for an order
56056 REM "259339-My packing slips no longer print automatically when I go
56058 REM "259460-Output Director PL, line version of customer comment is
56059 REM "261185-Group 10, division 07 unattended printing group goes down
56060 REM "261640-Problem in packing list printing if you view to the screen
56061 REM "263161-Ability in packing list program to trigger printing of main
56062 REM "263827-Need to turn on the weight field on the Packing Slip.
56063 REM "267156-Added field 27 to packing slip for short cartons and the *
56064 REM "261646-If you use incorrect selection in packing list printing
56065 REM "268007-Unattended Printing emails errors, need counter, so the
56066 REM "269203-PE(047, FM2RBC-2001) when trying to print PL's on the new
56068 REM "272180-Packing List; email to salesperson not working, fax ok.
56069 REM "277774-I cannot get release 02-602052 to print to warehouse 0017.
56070 REM "278261-FM2RBC P/L line count issue with split cartons.
56071 REM "279159-They started using custom Unform Packing Slip. The negative
56072 REM "275545-Add Customer Category to Invoice & Packing List Flexible Fmt
56074 REM "282705-Flowpoint; packing list data output from DB/d to FP
56076 REM "283651-Packing List Printing; need to output order line number fld
56077 ! SSP282705/283651-Add field 160 Order Line Type
56078 REM "286192-Can the first page of the packing list print the page number
56080 REM "287486-See 287466/568; add date/time to I/L filename for PO and PL
56081 REM "289455-CIC code is not printing correctly on the PL
56082 REM "291683-Unform Packing List - needs the CIC code in place of item
56084 REM "291991-Shipper ID field from PO3; need FFU for PO, need PL/PO forms
56086 REM "290922-FlowPoint; Warehouse BCP need EEG 3p order line no
56087 REM "293726-Missing packing list image link when you view images on
56088 REM "294495-Packing List - qty ordered is 1 unit of measure PACKAGE.
56089 REM "304762-On the General Shipping screen, under the ATTN: field, the   last character is missing
56090 REM "305128-FlowPoint; Company 589/Wise Warehouse Orders/Shipping NEED ITEM'S CUSTOMER CODE FORMATTED AND UNFORMATTED
56091 REM "305144-The customer category of the invoice is displaying on
56092 REM "307210-DBD-62-International shipping address - add country code
56093 REM "307210-DBD-98-International shipping address - add country code
56094 REM "307325-DBSPT-108269; PL Ship-to Zip includes country when not US
56096 REM "307413-DBD-279; DTP field FS2 SPECIAL_SHIPPING
56098 REM "307433-DBD-332: Display Third-party order ID in O/P Entry, History
56099 REM "307438-DBD-343: Packing List printing based on physical addresses  
56100 REM "307446-DBD-380; Error 12 when EC module not present                
