0010 REM "General Journal <GL2JBA>
0035 REM "5.7 - 09/02/09 - 10.467222 - tma - SSP# 232675
0037 REM "232675-General Journal-Number of items printed reflects a value    
0040 REM "Copyright 2009 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="GL2JBA",X1$="General Journal"
0120 DIM A$(156),A[1],B$(37),B[4],C$(34),C[1],D$(52),TOT[1] ! SSP225437 !SSP#232675
0130 DIM P9$(200)
0140 Z0$="###,###,###.00",Z1$="###,###.0000-"
0160 DEF FNS$(Z9$)=Z9$(1,POS("  "=Z9$+"  ")-1)
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
0210 T=1,T0=0,T1=1
0220 W3=131
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3)
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0300 REM "I/O lists
0305 REM "IOLIST FOR GL7 - General Ledger Journal Header
0310 IOLIST A$,A[0],A[1]
0315 REM "IOLIST FOR GL8 - General Ledger Journal Lines
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4]
0325 REM "IOLIST FOR GL5 - General Ledger Journal Codes
0330 IOLIST C$,C[0],C[1]
0335 REM "IOLIST FOR GL1 - General Ledger Master
0340 IOLIST D$(1,LEN(D$))
0420 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01O GL7...  09O ZZPARM  02O GL8...  03O GL5...  04O GL1...  06O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0580 READ (Z[6],KEY=X3$(9,3)+"G/L",DOM=9900)G0$
0600 REM "Read report selection parameters"
0605 N0$="GL2JUA"; GOSUB 6900
0700 REM "Open Printer
0720 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0721,9920
0725 IF %HAS_IMAGE_LIB THEN CALL "ILGAUD",ERR=*NEXT,X3$,X4$,"R6" ! 174140
0750 REM "Check for restart record"
0755 READ (Z[1],KEY="",DOM=0780)
0760 X3$(184,1)="1"
0765 CALL "ZZHEAD",X0$,X1$,X2$,X3$,W0$,W1$,W2$,W3$,W3,W,W9,W8,W0,W5,W4,W4$,W5$
0770 CALL "ZZREST",X3$,Z[9],Z[1],W9,W3,W
0775 GOSUB 6000
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[4]; U=14,U0=4,U[0]=0,U[1]=4,U[2]=2,U[3]=2,U[4]=6,T0=2,V1=4,V2=2,U0$="YY  ",T5$="    Z           ",U5$="Fiscal Year Ending",U6$="Accounting Period"; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
1000 REM "Read next record
1005 U$=KEY(U1,END=5000)
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])<V2$(U3,U[U9]) THEN READ (U1,END=5000); EXITTO 1000
1030 IF U$(U2,U[U9])>V2$(U3+U[U9],U[U9]) THEN IF U=1 THEN EXITTO 5000 ELSE READ (U1,END=5000); EXITTO 1000
1040 NEXT U9
1100 REM "Get record"
1110 U9$=U$
1120 ON V0 GOTO 1150,1150,1130,1140
1150 READ (Z[1],KEY=U$,DOM=1000)IOL=0310
1200 REM "
1220 Q$=A$(1,6); GOSUB 7600; P1$=P$,P2$=""
1230 IF A$(15,6)<>"      " THEN Q$=A$(15,6); GOSUB 7600; P2$=P$
1300 REM "Read other data
1330 DIM C$(LEN(C$)); FIND (Z[3],DOM=1331,KEY=A$(7,2))IOL=0330
1400 REM "Subtotals"
1420 ON T GOTO 1470,1430,1440,1450,1460
1430 GOSUB 6200
1440 GOSUB 6300
1490 T=0
1500 REM "Print Data
1510 IF W+6>W0 THEN GOSUB 6000
1515 Y5$=T1$; GOSUB 7300
1520 Y5$(8)="Fiscal Year: "+A$(1,4),Y5$(32)="Accounting",Y5$(43)="Period:",Y5$(51)=A$(5,2),Y5$(56)="Ending: "+P1$,Y5$(87)="Reference: "+A$(9,6)+"   Trans date: "+FND$(A$(160,6))
1522 IF G0$(40,1)="A" OR G0$(180,1)<>"Y" THEN GOTO 1530
1525 Q$="C"; IF G0$(40,1)="C" THEN Q$="A"
1526 Y5$(107)="Updates "+FNS$(A$(156,2))+" Basis data"
1530 GOSUB 7300; P0=21
1540 Y5$(5)="Source",Y5$(12)="Journal:",Y5$(21)=A$(7,2)+" - "+C$(3,30),Y5$(87)=A$(P0,45); P0=P0+45
1545 GOSUB 7300
1560 IF A$(15,4)<>"    " THEN Y5$(3)="Reverse in F/Y/E: "+A$(15,4),Y5$(43)="Period: "+A$(19,2),Y5$(56)="Ending: "+P2$
1580 Y5$(87)=A$(P0,45); P0=P0+45
1590 IF POS(" "<>Y5$)>0 THEN GOSUB 7300
1595 IF P0<156 THEN GOTO 1580
1600 DIM Y5$(LEN(Y5$),"-")
1610 GOSUB 7300
1620 GOSUB 6100
1810 GOSUB 2000
1900 T[0,0]=T[0,0]+1
1990 T[1,0]=T[1,0]+1
1995 GOTO 1000
2000 REM "Print Lines or Detail"
2001 DIM V[2]
2010 IF A[0]<1 THEN RETURN ELSE X3=A[0],T4=0
2015 GOSUB 2500
2020 IF X3<1 THEN GOSUB 2700; RETURN 
2030 READ (Z[2],IND=X3)X3,IOL=0320
2035 IF STP(B$)="" THEN GOTO 2020 ! %GUI
2040 REM "Read Secondary Information"
2090 DIM D$(LEN(D$)); FIND (Z[4],DOM=2091,KEY=B$(7,12))IOL=0340
2200 REM "Print Each Line
2205 T4=T4+1
2210 IF W>W0 THEN GOSUB 6000
2215 Y5$(1,3)=STR(T4:"###")
2220 CALL "ZZDISP","AX",B$(7,12),"G/L",X3$,X$,"",0,0,X4$; Y5$(7)=X$
2230 X=LEN(X$)+2,X$=FNS$(D$(13,35)); IF LEN(B$)>37 THEN X$=X$+"\ "+B$(38)
2240 Y5$(7+X)=X$
2250 IF B[3]>=0 THEN Y5$(100)=STR(B[3]:Z0$) ELSE Y5$(116)=STR(B[3]:Z0$)
2260 GOSUB 7300
2265 IF D$(49,2)<>"JC" THEN GOTO 2340
2270 Y5$(6)="Job:"
2280 CALL "ZZDISP","AX",B$(19,9),"J/C",X3$,X$,"",0,0,X4$; Y5$(11)=X$
2290 Y5$(24)="C/C:"
2300 CALL "ZZDISP","AX",B$(28,9),"JCC",X3$,X$,"",0,0,X4$; Y5$(29)=X$
2310 Y5$(43)=B$(37,1),Y5$(46)="U:",Y5$(49)=STR(B[0]:Z1$),Y5$(64)="H:",Y5$(67)=STR(B[2]:Z1$),Y5$(82)="R:",Y5$(85)=STR(B[1]:Z1$)
2320 GOSUB 7300
2400 REM "Accumulate Line Totals"
2410 IF B[3]<=0 THEN V[1]=V[1]+ABS(B[3]),TOT[0]=TOT[0]+ABS(B[3]) ELSE V[2]=V[2]+ABS(B[3]),TOT[1]=TOT[1]+ABS(B[3]) ! SSP#225437!SSP#232675
2499 GOTO 2020
2500 REM "Line Header
2520 IF W>W0 THEN GOSUB 6000
2690 RETURN 
2700 REM "Line Totals"
2701 ! IF T4<2 THEN GOSUB 7300; GOTO 2790 !SSP#225437
2702 IF W+2>W0 THEN GOSUB 6000
2705 Y5$(100)=T1$(1,15),Y5$(116)=T1$(1,15); GOSUB 7300
2710 IF V(2)<>V(1) THEN Y5$(70)="*** OUT OF BALANCE ***" ! SSP#225437
2720 Y5$(100)=STR(V[2]:Z0$),Y5$(116)=STR(V[1]:Z0$); GOSUB 7300
2765 Y5$(100)=T2$(1,15),Y5$(116)=T2$(1,15); GOSUB 7300
2780 GOSUB 7300
2785 GOSUB 7300
2795 RETURN 
3000 REM "Subtotaling Routines"
5000 REM "End of Print
5020 IF W8=0 THEN GOTO 5290
5030 T0$="END"
5045 IF W+4>W0 THEN GOSUB 6000
5050 T=0,T$="Report"; GOSUB 7000
5200 REM "
5220 IF V3$(2,1)<>"T" THEN Y4$="GL2JUA" ELSE Y4$=""
5290 GOTO 9900
6000 REM "Page header
6040 CALL "ZZHEAD",X0$,X1$,X2$,X3$,W0$,W1$,W2$,W3$,W3,W,W9,W8,W0,W5,W2,W4$,W5$
6070 GOSUB 7300
6090 RETURN 
6100 REM "
6120 Y5$(1)="Line",Y5$(7)="G/L",Y5$(11)="Account",Y5$(24)="Description",Y5$(61)="Trans Date",Y5$(109)="Debit",Y5$(123)="Credit"
6130 GOSUB 7300; GOSUB 7300
6199 RETURN 
6200 REM "Break #1 header
6299 RETURN 
6300 REM "Break #2 header
6399 RETURN 
6900 REM "Auto run update
6905 IF N0$="" OR V3$(1,1)<>"I" THEN GOTO 6990
6910 EXTRACT (Z[1],KEY="",DOM=6990)V0$,K0$
6915 IF K0$>"" THEN GOTO 6990
6930 Q$="+ ("+V0$(22,4)+"."+V0$(26,2)+")"
6935 CALL "ZZPROM","X0AUDITS",X3$,S3,Q$,"","",0
6940 ON S3 GOTO 6941,5200
6950 REMOVE (Z[1],KEY="")
6990 RETURN 
7000 REM "Totals logic
7001 IF T=T0 THEN IF T[T0,0]<2 THEN GOSUB 7300; GOTO 7100
7002 IF W+3>W0 THEN GOSUB 6000
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7300; Y5$(1)="Number of items printed: "+STR(T[0,0]); GOSUB 7300; GOSUB 7200; Y5$(1)="Elapsed time: "+T4$; GOSUB 7300; GOTO 7190
7095 GOSUB 7300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7210 PRECISION 14; T2=TIM-T2
7220 IF INT(T2)>0 THEN T4$=STR(INT(T2))+" Hours " ELSE T4$=""
7230 T3=INT(FPT(T2)*3600)
7240 T3=T3/60
7250 T4$=T4$+STR(T3:"##.##")+" Minutes"
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7320 ON W2 GOTO 7325,7325,7325,7360
7325 IF %IL_PDF THEN PRINT (%IL_PDF,ERR=*NEXT)Y5$ ! 174140
7330 IF Y5$=Y6$ THEN PRINT (W9)'LF', ELSE PRINT (W9)Y5$; DIM Y5$(W3)
7335 GOTO 7390
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=STP(V0$(19,40))
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7525 REM "Modified stmts:
7550 REM "Added stmts:
7575 REM "Deleted stmts:
7600 REM "GET P/E DATE FOR YYYYPP IN Q$; RETURN IN P$
7610 IF Q$(1,4)<>P9$(9,4) THEN READ (Z[9],KEY=X3$(9,3)+"G/LYE"+Q$(1,4))P9$
7620 P$=FND$(P9$(NUM(Q$(5,2))*6+15,6))
7640 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "End program
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9925 IF ABS(TOT[0])<>ABS(TOT[1]) THEN CALL "ZZPROM","X0GL2RDX",X3$,Z,"","","",0 ! SSP#225437!SSP#232675
9930 IF Y4$<>"" THEN IF %GUI THEN CALL Y4$,ERR=9931; EXIT ELSE RUN Y4$,ERR=9931
9935 IF %GUI THEN EXIT 
9940 RUN "ZMENU"
9999 END 
56000 REM "225437-Add out of balance check to G/L-J2 journal                  
