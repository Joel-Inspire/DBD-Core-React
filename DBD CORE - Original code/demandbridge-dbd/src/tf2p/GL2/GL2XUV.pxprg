0010 REM "Update GLV file <GL2XUV>
0020 SETESC 9300; SETERR 9000
0035 REM "5.3 - 12/20/04 - 15.768333 - lms - SSP# 178744
0036 REM "REL 7/18 SUPERIOR DELETE LINE 840
0040 REM "Copyright 2004 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 SETERR 9000
0110 X0$="GL2XUV"
0120 ENTER X3$,X4$,F0$,F0,H0$,R9$,A0,I0,P0,R0,I8,I9,F1$,F2$,A8,F2,F3$,F3,F4,F5,R1,R2,D0$,D1$
0121 IF LEN(F2$)>40 THEN PO$=F2$(40,9),SLSP$=F2$(49,20),CUST$=F2$(69,10),F2$=F2$(1,39)
0125 A9=A8
0140 DIM A[11],B[2],C[14],R[7]
0145 DIM Y[4]
0150 REM "H0$=HEADER INFO (1,19),A0=FIRST LINE, P0=PRECISION
0200 REM "
0245 IF P0>2 THEN PRECISION P0
0250 DEF FNC$(C)=CHR(32+INT(C/95))+CHR(32+MOD(C,95))
0260 DEF FND(Z9$)=(ASC(Z9$(1,1))-32)*95+ASC(Z9$(2,1))-32
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0300 REM "IOLISTS
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11]
0320 IOLIST B$,R$,B[0]
0330 IOLIST C$(1,LEN(C$))
0340 IOLIST D$(1,LEN(D$))
0350 IOLIST E0,E$,E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7]
0360 IOLIST J0,J$,J[0],J[1]
0430 IOLIST V0$,V1$,V2$,V0,V1
0485 IOLIST GLV$,GLV[0],GLV[1],GLV[2],GLV[3],GLV[4]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01X "+F0$+"  02X GL6...  10O GLV...  "; REM "04O GL1...  10O GLV...  "
0512 IF F1$<>"" THEN Z$=Z$+"05X "+F1$(1,6)+"  "
0515 IF POS("J/C"=X4$(7),7)>0 THEN Z$=Z$+"03O JC6...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,8900
0590 REM "REMOVE (Z[2],KEY="",DOM=0591)
0600 REM "RESTART
0610 REM READ (I8,IND=I9) IOL=0430
0615 REM "T9<0 MEANS INDEXED DETAIL, T9=1 MEANS KEYED FILE
0620 T9=-1; READ (Z[1],KEY=F2$,DOM=0625,ERR=0630)
0625 T9=1
0800 REM "Transaction audit
0900 REM "
0920 F=Z[5]
0930 IF R0=0 THEN R0=1
1000 REM "GET DETAIL LINES STARTING WITH A0
1010 IF T9<0 THEN IF A0<=0 THEN GOTO 5000 ELSE L=L+1
1015 PRINT @(12,13),"Now processing G/L detail line ",L:"#,##0",
1020 IF T9<0 THEN READ (Z[1],IND=A0)A1,IOL=0310 ELSE K$=KEY(Z[1],END=5000); READ (Z[1])IOL=0310; IF A$(1,LEN(F2$))<>F2$ THEN GOTO 5000 ELSE A$=A$(LEN(K$)+1)
1030 GOSUB 7500
1040 REM "R0 IS PRO-RATION FACTOR, R9$ IS POST COMMENT
1080 IF R9$="" THEN GOTO 1700
1200 REM "GLV file
1201 IF R[3]=0 THEN GOTO 1350
1220 DIM GLV$(247),GLV[5]
1225 GLV$(11,1)=H0$(7,1)
1230 GLV$(1,4)=H0$(1,4)
1235 GLV$(12,2)=H0$(14,2)
1240 GLV$(14,12)=A$(7,12),R$=R9$+D1$
1241 GLV$(81,12)=A$(19,9)
1242 GLV$(101,9)=PO$,GLV$(93,8)=PO$(1,8)
1243 GLV$(135,20)=SLSP$; REM SSP 178744
1244 GLV$(125,10)=CUST$
1245 GLV$(118,6)=A$(22,6),GLV$(112,6)=H0$(8,6); REM ,B$(34)=H0$(14)
1246 GLV$(53,10)=F2$(1,10),GLV$(71,10)=F2$(11,10)
1247 IF D0$>"" THEN GLV$(118,6)=D0$ ELSE GLV$(118,6)=X3$(15,6)
1255 IF D1$>"" THEN IF LEN(A$)>37 THEN R$=R9$+A$(38),B$(42,1)="Y"
1256 GLV$(5,6)=GLV$(118,6)
1260 GLV[0]=R[3]
1300 GLV_SEQ$=STR(1:"00000")
1310 GLV$(26,5)=GLV_SEQ$
1320 WRITE (Z[10],KEY=GLV$(1,32),DOM=*NEXT)IOL=0485; GOTO 1350
1330 IF GLV_SEQ$="99999" THEN ESCAPE ELSE GLV_SEQ$=STR(NUM(GLV_SEQ$)+1:"00000")
1340 GOTO 1310
1800 REM "Next Line
1810 GOSUB 6600
1820 A0=A1; GOTO 1000
4900 REM "END OF LINES
4920 CALL "ZZEXPF",X3$,X4$,"X"+STR(F),"",G9; IF G9>0 THEN GOTO 9800
4930 Z=NUM(FIN(F,"MAXREC")); Y[3]=Z-1
4940 GOTO 5215
5000 REM "End of lines
5090 GOTO 9900
5200 REM "GET NEXT INDEX TO FILE IN A9
5210 EXTRACT (F,IND=0,ERR=5295)IOL=0290
5212 IF Y[4]=-2 THEN READ (F); GOTO 5270
5215 IF Y[0]>=Y[3] OR Y[2]>=Y[3] THEN GOTO 4900 ELSE Y[4]=-2
5220 WRITE (F,IND=0)IOL=0290
5230 IF Y[1]<1 THEN A9=Y[2],Y[2]=Y[2]+1 ELSE A9=Y[1]; READ (F,IND=A9)Y[1]
5240 Y[0]=Y[0]+1,Y[4]=-1
5250 WRITE (F,IND=0)IOL=0290
5260 RETURN 
5270 LOCK (F,ERR=5210); Y[4]=-1; GOTO 5215
5295 IF ERR<>0 THEN GOTO 9000 ELSE RETRY 
5300 REM "REMOVE INDEX Z
6600 REM "RESTART LOGIG
6602 RETURN 
6605 V0=A0
6610 WRITE (I8,IND=I9)IOL=0430
6690 RETURN 
7500 REM "Prorate amounts
7510 DIM R[3]; PRECISION P0
7515 IF R0=-9 THEN FOR X=0 TO 3; R[X]=A[X]-A[X+8]; NEXT X; GOTO 7595
7518 ON R1 GOTO 7520,7540,7560
7520 REM "Old G/L method
7525 FOR X=0 TO 3; R[X]=A[X]*R0; NEXT X
7535 GOTO 7590
7540 REM "Prorate against original amount
7545 FOR X=0 TO 3; R[X]=A[X]*R0,A[X+4]=A[X+4]+R[X]; NEXT X
7555 GOTO 7585
7560 REM "Prorate against balance left
7565 FOR X=0 TO 3; R[X]=(A[X]-A[X+4])*R0,A[X+4]=A[X+4]+R[X]; NEXT X
7584 REM "goto 7585 to check against total else goto 7590
7585 IF A1<=0 THEN A[7]=A[7]-R[3]+R2,R[3]=R2 ELSE R2=R2-R[3]
7590 FOR X=0 TO 3; A[X+8]=A[X+8]+R[X]; NEXT X
7597 PRECISION 2
7599 RETURN 
8900 REM "Problem with opening file
8910 TMP$="Problem in file open contact Support DO NOT EXIT UPDATE"
8920 CALL "ZZPROM",".4",X3$,Z,TMP$,"","",0; ON Z GOTO 0520
8990 GOTO 0520
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,1
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9110 GOTO 9080
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "END PROGRAM
9905 PRECISION 2
9910 GOSUB 6600
9915 PRINT @(0,13),'CL',
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"CLOSE",Z{ALL},Z0,Z1
9950 EXIT 
9999 END 
