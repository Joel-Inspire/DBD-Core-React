0010 REM "BERT Full Screen Editor <ZA2BAR>
0030 REM "(C) 1984 & 1985 BY BASIC IDEAS, INC; ATLANTA, GA.
0035 REM "    THIS SOFTWARE CONTAINS TRADE SECRETS AND PROPRIETARY INFORMATION"
0109 GOTO 0111
0110 SETERR 9000
0120 DIM S$(40)
0220 DEF FNS$(Q$)=Q$(1,POS("  "=Q$+"  ")-1)
0230 I5$=CHR(186)
0310 IOLIST @(24,23),"Press ",FNS$(C0$(353,8))," for Editor Key Data; ",FNS$(C0$(313,8))," to End Editor; ",FNS$(C0$(233,8))," for Data Item Listing",@(0,22)
0390 IOLIST @(0,23),'CL',@(0,22),'CL',IOL=0310
0400 REM "
0500 REM "
0510 ADDR "ZZ2RSS",ERR=0511
0600 REM "
0605 W0=132,W1=18,W2=100
0610 IF V$="" THEN DIM V$(W0*W1+2)
0620 GOSUB 5800
0640 GOSUB 6900
0900 REM "
0910 PRINT IOL=0310
0940 X0=1,X=0,Y=3
0980 GOTO 1000
0990 PRINT 'RB',
1000 REM "ENTER NEXT CHARACTER
1015 IF C0>0 THEN PRINT 'CI',
1075 PRINT @(122,0),"(",X:"#0",",",Y:"#0",") ",
1080 PRINT @(X,Y),
1120 READ RECORD (Z[9],SIZ=1)Q$
1130 IF Q$=$10$ THEN CALL "ZZSCRN",ERR=1000,X3$,X4$; GOTO 1000
1140 GOSUB 8000; IF C8$>"" THEN IF POS(C$=C8$,2)=0 THEN GOTO 0990
1150 IF C0>=0 THEN GOTO 1200
1155 IF Q$=$08$ THEN C0=1; GOTO 1200
1160 IF POS(CHR(X)+CHR(Y)=B0$,2)>0 THEN GOTO 0990
1165 IF Q$<CHR(32) THEN GOTO 0990
1170 IF Q$="-" THEN IF X=0 AND X0<2247 THEN IF POS(" "<>V$(X0,W0))=0 THEN Q$="-"+STR(W0); GOTO 3400
1180 V$(X0,1)=Q$; PRINT @(X,Y),Q$,
1185 X0=X0+1
1190 GOTO 1555
1200 REM "CONTROL
1220 ON C0 GOTO 4000,1400,1420,1440,1460,1480,1500,1600,1600,1900,2000,2100,2200,2600,3000,3100,3300,3500,3600,3700,3800,3900,3950,0990
1400 REM "LEFT 1 CHAR
1405 IF X0>1 THEN X0=X0-1; GOTO 1550 ELSE GOTO 0990
1420 REM "RIGHT 1 CHAR
1425 IF X<W0-2 THEN X0=X0+1; GOTO 1550 ELSE GOTO 0990
1440 REM "UP 1 LINE
1445 IF X0>W0 THEN X0=X0-W0; GOTO 1550 ELSE GOTO 0990
1460 REM "DOWN 1 LINE
1465 IF Y-3<W1-1 THEN X0=X0+W0; GOTO 1550 ELSE GOTO 0990
1480 X0=INT(X0/W0)*W0+1; GOTO 1550
1500 REM "POSITION
1505 Q$="      "
1515 PRINT @(5,22),"Enter the screen co-ordinates:",
1520 CALL "ZZENTR","SX",A{ALL},Q$,X4$,X3$,36,22,1,6,C0,"","","ENTER THE SCREENPOSITION AS XX OR XX,YY","","","",""; PRINT @(0,22),'CL',; IF C0<0 THEN GOTO 1000
1525 Q$=FNS$(Q$),Q=NUM(Q$,ERR=1526); IF Q>=0 AND Q<W0-1 THEN X0=(Y-3)*W0+Q+1; GOTO 1550 ELSE GOTO 0990
1530 P=POS(","=Q$); IF P=0 THEN GOTO 0990 ELSE Q0=NUM(Q$(1,P-1),ERR=0990),Q1=NUM(Q$(P+1),ERR=0990)
1535 IF Q0<0 OR Q0>W0-1 OR Q1<3 OR Q1>W1+2 THEN GOTO 0990
1540 X0=Q0+(Q1-3)*W0+1; GOTO 1550
1550 REM "AFTER CURSOR POSITIONING CONTROL KEYS...
1555 Y=INT((X0-1)/W0),X=X0-Y*W0-1,Y=Y+3
1560 IF C9$="" THEN GOTO 1000
1580 ON POS(C9$="A") GOTO 1840
1600 REM "ATTACH SCREEN
1605 GOSUB 6500
1610 P$="ATTACH"; IF C0=8 THEN P$="COPY"
1615 DIM A[4,2]; A[0,0]=X0,A[1,0]=1,A[2,0]=1,C9=C0,A1=1,C9$="A",E3=0,P8=X,P9=Y
1616 IF V$(X0,1)<>" " THEN P=POS("  "=V$(X0+1)+"  "); A[1,0]=P
1620 GOSUB 6100; GOSUB 6000
1625 READ RECORD (Z[9],SIZ=1)Q$
1630 GOSUB 8000
1635 IF C0=9 THEN GOTO 1700 ELSE IF POS(STR(C0:"00")="01020304",2)=0 THEN PRINT 'RB',; GOTO 1630
1645 P=POS(STR(C0:"0")="13X24")-3,A1=1; IF P<0 THEN A1=0; IF P=-3 THEN PRINT 'RB',; GOTO 1630
1650 Q2=A[0,0]+A[1,0],Q0=1,Q1=A[2,0]
1655 IF C0=2 THEN IF X+A[1,0]>W0-1 THEN GOTO 1680 ELSE A[1,0]=A[1,0]+1
1660 IF C0=1 THEN IF A[1,0]=0 THEN GOTO 1680 ELSE A[1,0]=A[1,0]-1,Q2=Q2-1
1665 IF C0=3 THEN IF A[2,0]<=1 THEN GOTO 1680 ELSE A[2,0]=A[2,0]-1,Q2=Q2-A[1,0]+A[2,0]*W0,Q1=1,Q0=A[1,0]
1670 IF C0=4 THEN IF A[2,0]>W1-1 THEN GOTO 1680 ELSE Q2=Q2-A[1,0]+A[2,0]*W0,A[2,0]=A[2,0]+1,Q1=1,Q0=A[1,0]
1675 CALL "ZZ2RSS",W0,W1,V$,Q2,Q0,Q1,A1,V1$,V2$,0,0,0,0,W2,0,0,X3$,X4$
1678 GOTO 1625
1680 PRINT 'RB',; GOTO 1625
1690 GOTO 1625
1700 P$="MOVE"; GOSUB 6100
1705 IF A[1,0]=0 THEN V1$=V9$; GOSUB 6720; GOTO 1940
1720 REM "SET MOVE PIECE
1725 P1$=""
1730 FOR P=0 TO A[2,0]-1
1735 P1$=P1$+V$(A[0,0]+P*W0,A[1,0])
1740 IF C9=7 THEN V$(A[0,0]+P*W0,A[1,0])=""
1745 NEXT P
1750 GOSUB 6800
1800 REM "MOVE SCREEN PIECE P1$ AROUND
1810 C8$="010203040506091819",S0=A[0,0],S1=A[1,0],S2=A[2,0]
1820 GOTO 1000
1840 REM "RESTORE CURRENT SCREEN
1850 A1=0; GOSUB 6000
1860 A[0,0]=X0
1870 REM "PAINT P1$ PICTURE
1875 CALL "ZZ2RSS",S1+0,S2+0,P1$,1,S1,S2,1,V1$,V2$,X,Y-3,E2,E3,W2,0,0,X3$,X4$
1880 GOTO 1820
1900 REM "DEPOSIT MOVED SCREEN PIECE
1902 IF C9$="" THEN GOTO 0990 ELSE E4=0; FOR P=0 TO S2-1; E4=E4+POS(I5$=V$(X0+P*W0,S1)); NEXT P
1905 IF E4>0 THEN CALL "ZZPROM","2",X3$,S,"DATA FIELDS RESIDE WITHIN THESE SCREEN CO-ORDINATES. CONTINUE?","","",0; ON S GOTO 1906,1820
1910 P$="WAIT"; GOSUB 6100
1920 FOR P=0 TO S2-1
1925 V$(X0+P*W0,S1)=P1$(P*S1+1,S1)
1930 NEXT P
1935 GOSUB 6600
1940 P$=""; GOSUB 6100
1980 C8$="",C9$="",P1$=""
1990 GOTO 1550
2000 REM "DELETE LINE
2090 GOTO 1000
2100 REM "INSERT LINE
2101 REM "now is report data item listing"
2140 CALL "ZZ2RAE",X3$,X4$,V2$,W2,R$
2190 GOTO 1000
2200 REM "INSERT TEXT
2390 GOTO 1550
2600 REM "DELETE TEXT
2690 RETURN 
3000 REM "CLEAR TO END
3010 FOR P=0 TO W0-X-1
3015 IF V$(X0+P,1)<>" " THEN V$(X0+P,1)=""; IF POS(CHR(X+P)+CHR(Y)=B0$,2)=0 THEN PRINT @(P+X,Y)," ",
3020 NEXT P
3090 GOTO 1000
3100 REM "END EDITOR
3105 PRINT 'CS','T1'
3120 REM "RESEQ ITEMS BY LINE
3122 V9$=""; IF V1$="" THEN GOTO 3176
3125 FOR X=1 TO LEN(V1$) STEP 6
3130 P=POS(V1$(X,6)<V9$,6); IF P=0 THEN V9$=V9$+V1$(X,6); GOTO 3170
3135 V9$=V9$(1,P-1)+V1$(X,6)+V9$(P)
3170 NEXT X
3175 V1$=V9$
3280 L0=1
3290 GOTO 9800
3300 REM "REPEAT CHARACTER
3305 DIM Q$(4)
3310 PRINT IOL=0390,@(0,22),"ENTER THE CHARACTER TO REPEAT OR 'CR':",@(42),"ENTER THE NUMBER OF CHARS: ",
3340 CALL "ZZENTR","SX",A{ALL},Q$,X4$,X3$,40,22,1,1,C0,"","","ENTER THE CHARACTER TO REPEAT OR PRESS RETURN TO ABORT","","","",""
3345 IF C0<0 THEN GOTO 3480
3380 CALL "ZZENTR","Z",A{ALL},Q$,X4$,X3$,69,22,2,3,C0,"","","ENTER THE NUMBER OF TIMES TO REPEAT OR RETURN TO ABORT","","","",""
3390 IF ABS(C0)=2 THEN GOTO 3340
3400 REM "PUT IN REPEAT CHAR
3410 DIM Q$(NUM(Q$(2,3),ERR=3480),Q$(1,1))
3420 V$(X0,LEN(Q$))=Q$
3430 PRINT @(X,Y),Q$,
3450 REM "
3480 REM "
3485 PRINT IOL=0390
3495 GOTO 1000
3500 REM "HELP SCREEN
3510 PRINT 'CS','T1',
3520 CALL "XZCTRL",X3$,X4$,C0$,""
3525 PRINT 'CS','T2',
3530 GOSUB 5800
3590 GOTO 1000
3600 REM "SET/RELEASE TABS
3610 C$=STR(X:"000"),C=POS(C$=T0$,3)
3615 IF C=0 THEN PRINT @(X,2),"+",; C=POS(C$<=T0$,3); IF C=0 THEN T0$=T0$+C$; GOTO 1000 ELSE T0$=T0$(1,C-1)+C$+T0$(C); GOTO 1000
3620 T0$=T0$(1,C-1)+T0$(C+3); PRINT @(X,2),Z0$(1,1),; GOTO 1000
3700 REM "TAB OVER
3710 C$=STR(X:"000"),C=POS(C$<T0$,3); IF C=0 THEN GOTO 0990 ELSE C=NUM(T0$(C,3))-X; X0=X0+C; GOTO 1550
3800 REM "RETURN
3810 X0=(Y-2)*W0+1; GOTO 1550
3900 REM "NEXT WORD
3910 IF V$(X0,1)<>" " THEN P=POS("  "=V$(X0)+"  ") ELSE P=POS(" "<>V$(X0))-1
3920 X0=X0+P; GOTO 1550
3950 REM "Ruler"
3955 PRINT 'SB',
3956 GOSUB 5820
3957 PRINT 'SF',
3960 CALL "ZZ2RAD",V$,R$,Z[9],C0$
3965 GOSUB 5820
3970 GOTO 1550
4000 REM "ENTER DATA FIELD
4005 IF V$(X0,1)<>" " THEN GOTO 0990
4010 P$=STR(Y:"000")+STR(X:"000"),P=POS(P$=V1$,6)
4020 IF P>0 THEN GOTO 4100 ELSE P=LEN(V1$)+1
4040 CALL "ZZPROM","Y",X3$,A,"Do you wish to add a data field here?","","",0; ON A GOTO 4042,4041
4041 PRINT @(0,22),'CL',; GOTO 1000
4042 PRINT @(0,22),'CL',
4045 DIM D9$(W2); D9$(20,6)=P$,D9$(19,1)="S",D9$(1,6)=A$(62,6),V1$=V1$+P$,V2$=V2$+D9$
4050 P0=INT(P/6)+1,P=1+INT(P/6)*W2
4080 GOTO 4200
4100 REM "GET DATA STRING
4110 P0=INT(P/6)+1,P=POS(V1$(P,6)=V2$(20),W2)
4120 D9$=V2$(P,W2)
4200 REM "MAINTAIN DATA ITEM
4210 GOSUB 4400
4215 PRINT @(0,3),'CS',
4220 CALL "ZZ2RAC",X3$,X4$,D9$,S3
4230 IF S3=3 THEN GOTO 4300
4260 V2$(P,W2)=D9$
4270 Q$=D9$(7,4); GOSUB 7000; B0$=B0$+B9$
4280 GOSUB 5810
4290 GOTO 1000
4300 REM "DELETE ITEM
4310 V2$=V2$(1,P-1)+V2$(P+W2)
4320 P=POS(D9$(20,6)=V1$,6)
4325 V1$=V1$(1,P-1)+V1$(P+6),Q$=D9$,D9$=""
4330 GOSUB 7000; P=POS(B9$=B0$); IF P>0 THEN B0$=B0$(1,P-1)+B0$(P+LEN(B9$)+1)
4380 GOSUB 5800
4390 GOTO 1000
4400 REM "GET RID OF RESERVE POSITIONS
4410 Q$=D9$(7,4); GOSUB 7000; A=POS(B9$=B0$); IF A>0 THEN B0$=B0$(1,A-1)+B0$(A+LEN(B9$))
4420 RETURN 
5800 REM "SCREEN
5810 GOSUB 5900
5815 REM "BOTTOM PART OF SCREEN
5820 DIM A[4,2]; A[0,0]=1,A[1,0]=W0,A[2,0]=W1,A0=1,A1=0,E3=1,E0=0,E1=0,E2=0; GOSUB 6000
5830 GOSUB 6720
5850 PRINT IOL=0310
5890 RETURN 
5900 REM "TOP OF SCREEN
5905 X$=FNS$(A$(7,40))
5910 PRINT 'CS','T2',
5911 WAIT 1
5915 PRINT @(INT(W0/2)-INT(LEN(X2$)/2),0),X2$
5925 PRINT @(0,0),"SCREEN: ",A$(1,6),@(INT(W0/2)-INT(LEN(X$)/2),1),X$
5940 PRINT @(0,2),Z0$,Z0$(1,52)
5980 GOSUB 6200
5990 RETURN 
6000 REM "DISPLAY SCREEN - A0=1 MEANS WHOLE SCREEN,A1=1=REVERSE VIDEO
6045 PRINT 'T2',
6050 CALL "ZZ2RSS",W0,W1,V$,A[0,0],A[1,0],A[2,0],A1,V1$,V2$,E0,E1,E2,E3,W2,A0,E4,X3$,X4$
6090 RETURN 
6100 REM "MESSAGE"
6105 PRINT (0,ERR=6106)@(0,1),S$(1,14),@(0),'BR','BB',P$,'ER','EB',
6110 RETURN 
6200 REM "DISPLAY TAB SETTINGS
6210 IF T0$="" THEN GOTO 6290
6220 FOR P=1 TO LEN(T0$) STEP 3
6225 PRINT @(NUM(T0$(P,3)),2),"+",
6230 NEXT P
6290 RETURN 
6500 REM "CHANGE DATA FIELDS TO CHARS
6505 IF V1$="" THEN GOTO 6590
6510 FOR P=1 TO LEN(V1$) STEP 6
6515 Q=(NUM(V1$(P,3))-3)*W0+NUM(V1$(P+3,3))+1
6520 V$(Q,1)=I5$
6530 NEXT P
6535 DIM A[4,2]; A[0,0]=1,A[1,0]=W0,A[2,0]=W1,A0=1,A1=0,E2=1; GOSUB 6000
6550 V9$=V1$,V1$=""
6590 RETURN 
6600 REM "RESTORE DATA FIELDS
6610 P=POS(I5$=V$); IF P=0 THEN GOTO 6620 ELSE V$(P,1)=""; GOTO 6610
6620 REM "
6625 IF POS(I5$=P1$)=0 THEN GOTO 6700
6640 FOR P=1 TO LEN(V8$) STEP 6
6645 Y0=NUM(V8$(P,3)),Y1=NUM(V8$(P+3,3)),P0=POS(V8$(P,6)=V9$,6)
6650 Y0=Y0+(Y-P9),Y1=Y1+(X-P8)
6655 V9$(P0,6)=STR(Y0:"000")+STR(Y1:"000")
6660 Q$=V8$(P,6); GOSUB 7000; A0=POS(B9$=B0$); IF A0>0 THEN B0$=B0$(1,A0-1)+B0$(A0+LEN(B9$))
6665 Q$=V9$(P0,6),V2$(W9+19,6)=Q$; GOSUB 7000; B0$=B0$+B9$
6670 NEXT P
6700 REM "PAINT DATA FIELDS
6705 GOSUB 6000
6715 V1$=V9$
6720 DIM A[4,2]; A[0,0]=1,A[1,0]=W0,A[2,0]=W1,A0=1,A1=0,E2=2; GOSUB 6000
6790 RETURN 
6800 REM "GET DATA FIELDS IN MOVED PIECE
6810 P0=1,P1=0,V8$=""
6820 P=POS(I5$=P1$(P0)); IF P=0 THEN GOTO 6890
6830 P1=P+P0-1
6840 Q$=STR(Y+INT((P1-1)/A[1,0]):"000")+STR(MOD(P1-1,A[1,0])+X:"000")
6850 V8$=V8$+Q$,P0=P1+1
6860 GOTO 6820
6890 RETURN 
6900 REM "GET RESERVE POSITIONS - ALL
6905 IF V1$="" THEN GOTO 6990 ELSE B0$="",P$="WAIT..."; GOSUB 6100
6910 FOR A=1 TO LEN(V1$) STEP 6
6915 Q$=V1$(A,6); GOSUB 7000
6920 B0$=B0$+B9$
6930 NEXT A
6985 P$=""; GOSUB 6100
6990 RETURN 
7000 REM "GET RESERVE POSITIONS
7010 B9$=""
7020 W=POS(Q$=V2$(20),W2),B9$="",W9=W; IF W=0 THEN RETURN ELSE Q$=V2$(INT(W/W2)*W2+1,W2)
7030 Q=NUM(Q$(16,3),ERR=7090),W=NUM(Q$(23,3)); IF Q$(19,1)="N" THEN CALL "ZZXAAY",Q$(13,3),M$; Q=LEN(M$),M$="" ELSE DIM W$(Q,"X"); CALL "ZZDISP",Q$(19,1)+"X",W$,"",X3$,D$,"",0,0,X4$; Q=LEN(D$)
7060 FOR B=W TO Q+W-1; B9$=B9$+CHR(B)+CHR(NUM(Q$(20,3))); NEXT B
7090 RETURN 
8000 REM "GET CONTROL VALUE
8005 C0=-1
8020 P=POS(HTA(Q$)=C0$,20); IF P=0 THEN GOTO 8090 ELSE Q0$=Q$
8025 GOTO 8050
8040 READ RECORD (Z[9],SIZ=1,TIM=1,ERR=8070)Q$
8045 Q0$=Q0$+Q$
8050 IF LEN(Q0$)>6 THEN PRINT 'RB'; GOTO 8090
8055 Q$=HTA(Q0$),Q$=Q$+S$(1,12-LEN(Q$))
8060 P=POS(Q$=C0$,20); IF P=0 THEN GOTO 8040 ELSE P=INT(P/20)
8065 C0=P,C$=STR(C0:"00"); GOTO 8090
8070 PRINT 'RB'
8090 RETURN 
8999 ESCAPE 
9800 REM 
9810 L0=1
9820 RUN X0$
9999 END 
