0010 REM "Return code for formula/calculated type <ZA2BU4>
0035 REM "3.9 - 12/21/95 - 12.04 - dmm
0040 REM "Copyright 1995 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0500 REM "THIS PROG SHOULD BLIP ALONG UNTIL IT EITHER RUNS OUT OF
0505 REM "TEXT OR RUNS OUT OF PAREN'S
1012 REM "Q9$ IS TEXT STUFF, F1$=FILE ENVIRONMENT, F9$,F9=FUNCTION CONTROL
1020 ENTER X3$,V0$,V8,V9,M5$,P8,Q9$,F1$,F9$,F9,F8,V0,V1,A0$,I9$,E0$,E1$,E2$
1040 Q8$=Q9$
1200 REM "FILES
1205 DIM Z[NUM(X3$(60,3))],S$(40)
1210 Z$="01O ZB3...  02O ZA0...  03O ZA1...  04O ZAF... 05O ZA3... "
1220 GOSUB 9750
1260 IF F1$="" THEN F1$=S$(1,20)
1280 F0$=F1$(1,20),I9$="",I0$="",P9=-1,P0=0,P1=0
1285 M0$="",P9$="Y",X$=$22$,Q9$=Q9$+" "
2000 REM "PROCESS STUFF
2010 IF P8<0 THEN IF P9=0 THEN IF P0=0 THEN GOTO 3000
2020 IF POS(" "<>Q9$)=0 THEN GOTO 3000 ELSE CALL "ZA2UAB",Q9$,Q$,Q9
2025 IF Q9>=4 THEN GOTO 2040
2030 I9$=I9$+Q$; IF Q$=")" THEN P0=P0-1; P9=0 ELSE IF Q$="(" THEN P0=P0+1,P9=0
2035 GOTO 2000
2040 IF POS("@"=Q$)<>1 THEN GOTO 2300
2100 REM "IN-LINE MACRO
2110 Q$=Q$(2)
2120 CALL "ZA2BU6",X3$,M5$,V0$,V8,V9,Q$,Q9$,F1$,F9$,F9,F8,0,0,A0$,Q1$,E0$,E1$,E2$
2130 I9$=I9$+Q1$
2140 GOTO 2000
2300 REM "NON-MACRO ELEMENT
2305 IF Q9=5 THEN GOTO 3000
2310 F0$=F1$(1,20),Q$=Q$+S$(1,20-LEN(Q$))
2320 CALL "ZA2BU2",X3$,V0$,V8,V9,F0$,Q$,F1$,I0$,I1$,"",E0$,E1$,E2$
2340 I9$=I9$+I0$; IF I1$="" THEN GOTO 2390 ELSE M0$=M0$+Q$
2350 CALL "ZA2BU4",X3$,V0$,V8,V9,M5$,P8,I1$,F1$,F9$,F9,F8,V0,V1,A0$,I8$,E0$,E1$,E2$
2355 W$=STR(F8)+FNE$(F8)+I0$+"="+I8$,F8=F8+5; GOSUB 8800
2395 GOTO 2000
3000 REM "DONE WITH STATEMENT
3090 GOTO 9900
8800 REM "ADD CODE TO REPORT
8805 Q7$=FNI$(W$),A0$=A0$+Q7$; IF Q7$(6,1)=$F3$ THEN GOSUB 8850
8808 W$="",Q8$=Q9$; RETURN 
8810 IF LEN(W$)<80 THEN WRITE (F0)W$; RETURN ELSE WRITE (F0)W$(1,79); W$=W$(1,4)+": "+W$(80); GOTO 8810
8845 RETURN 
8854 Q8$="+"+Q8$(1,POS(S$(1,10)=Q8$+S$(1,10))-1); IF LEN(Q8$)>50 THEN Q8$=Q8$(1,50)
8860 CALL "ZZPROM","ERZA2",X3$,0,Q8$,"","",0
8890 RETURN 
8910 DEF FNI$(Z$)=BIN(LEN(CPL(Z$)),3)+CPL(Z$)
8915 DEF FNS$(Z$)=Z$(1,POS(S$=Z$+S$)-1)
8925 DEF FNE$(Z)="SETERR "+STR(Z+1)+";"
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9940 EXIT 
9999 END 
