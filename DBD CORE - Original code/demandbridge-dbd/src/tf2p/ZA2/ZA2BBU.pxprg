0010 REM "B-Link Output File Handling <ZA2BBU>
0030 REM "(C) 1985-1988 Basic Ideas, Inc; Atlanta, GA. USA
0035 REM "5.5 - 03/05/07 - 11.545 - mhe - SSP# 205703
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
1000 SETERR 1010; ENTER X3$,B0$,S0$,S0,R0$,X0$,F1$,F0,X8,X9; SETERR 9000; GOTO 1020
1010 CALL "ZZPDOC","ZA2BBU"
1020 F9=NUM(X3$(60,3)),S9=512,X9=0
1030 DIM S$(20)
1100 REM 
1110 IF S0$>"" THEN GOTO 1200 ELSE CLOSE (F9); OPEN (F9)"ZZPARM"
1120 READ (F9,KEY=X3$(9,3)+"ZB2",DOM=9800)S0$,S0
1130 R0$(60,1)=S0$(264,1)
1200 REM "WHAT TO DO
1210 IF X0$="" THEN GOTO 9900 ELSE ON POS(X0$(1,1)="CWE") GOTO 9900,2000,3000
2000 REM "CREATE FILE
2005 IF S0$(264,1)<>" " AND S0$(264,1)<>"*" THEN GOTO 2200
2010 F0$="TMPB"+FID(0),F2$=FNS$(R0$(9,16)); GOSUB 8000
2020 IF X3$(77,1)<>"T" THEN GOTO 2100
2025 GOSUB 8200
2030 F1$=F0$
2090 GOTO 9900
2100 REM "POINT/4 AND UNIX SYSTEMS
2110 SETERR 9800
2115 ! 148605 GOSUB 8200
2120 ! 148605 INVOKE "umask 0; cp /dev/null "+"/"+F0$
2150 F1$=STP(S0$(265,70))+DLM+F0$ ! 148605
2155 ERASE F1$,ERR=*NEXT
2160 SERIAL F1$
2195 GOTO 9900
2200 REM "CHECK FOR DOS PARTITION
2220 GOSUB 4000
2290 GOTO 9900
3000 REM "WRITE ENTRY
3010 ON F0 GOTO 3100,3020
3020 REM "STANDARD WRITE
3025 ON POS(X3$(77,1)="P") GOTO 3027,3200
3027 ! 148605 IF R0$(60,1)="*" THEN S9=LEN(F1$); IF S9=0 THEN GOTO 3060
3029 ! 148605 S9=512
3030 ! 148605 IF LEN(F1$)<S9 THEN GOTO 3050 ELSE WRITE RECORD (F0,SIZ=S9)F1$(1,S9); F1$=F1$(S9+1); GOTO 3030
3035 PRINT (F0)F1$,; F1$="" ! 148605
3050 IF X0$="E" AND F1$>"" THEN WRITE RECORD (F0)F1$; F1$=""; ON POS(X3$(77,1)="UX") GOTO 3051,3400
3060 IF X0$="E" THEN ON POS(X3$(77,1)="UX") GOTO 3061,3400
3090 GOTO 9900
3100 REM "DOS FILE IN PARTITION
3110 IF LEN(F1$)<S9 THEN GOTO 3150
3115 CALL "ZZPROM","X8ZA2BBU",X3$,0,"+("+STR(X8)+")","","",23
3120 CALL "DOSLINK","WRITE",BIN(X8,2)+BIN(1,2)+F1$(1,S9),B0$
3125 X8=X8+1
3130 F1$=F1$(S9+1); GOTO 3110
3150 IF X0$="E" THEN CALL "DOSLINK","WRITE",BIN(X8,2)+BIN(1,2)+F1$,B0$; GOSUB 3900; X8=X8+1
3190 GOTO 9900
3200 REM "POINT 4
3290 GOTO 9900
3400 REM "UNIX/XENIX
3405 GOSUB 8200
3410 ! 148605 Z$=FID(F0); F0$=FNS$(Z$(4,6)+Z$(21)); CLOSE (F0); OPEN (F0)"D"+STR(ASC(Z$(20,1))); Z$=FID(F0); CLOSE (F0); D0$=Z$(4,6)+Z$(21),D0$=FNS$(D0$)
3420 INVOKE "umask 0; mv "+STP(S0$(265,70))+DLM+"TMPB"+FID(0)+" "+STP(S0$(265,70))+DLM+STP(R0$(9,22)) ! 148605
3490 GOTO 9900
3900 REM "CLOSE DOS FILE
3910 CALL "DOSLINK","CLOSE","",B0$
3920 CALL "DOSLINK","END","",B0$
3990 RETURN 
4000 REM "Select Drive
4010 H0$="H0H1F0F1",H1$="",H9$="",H0=POS(S0$(264,1)="CDAB"); IF H0=0 THEN GOTO 9800 ELSE H0$=H0$((H0-1)*2+1,2)
4015 H1$="D"+S0$(260,1); GOTO 4075
4020 FOR X=9 TO 0 STEP -1; D$=FN%DSD$("D"+STR(X),ERR=4040),X$=D$(4,1)+D$(6,1); IF X$<>H0$ THEN GOTO 4040
4022 IF H9$>"" THEN GOTO 9800
4025 DISABLE X,ERR=4026; ENABLE X,ERR=4040; DISABLE X,ERR=4040; H1$=D$(1,2); EXITTO 4041
4030 ENABLE X,ERR=4031; DISABLE X,ERR=4031; H1$=D$(1,2); EXITTO 4041
4040 NEXT X; CALL "ZZPROM","X2ZA2BBU",X3$,0,"+("+S0$(264,1)+")","","",0; GOTO 9800
4075 H9$=H1$; CALL "ZZPROM","X4ZA2BBU",X3$,0,"+("+H1$+")","","",0
4080 B0$=""; CALL "DOSLINK",ERR=4022,"SELECT",H1$,B0$
4100 REM "CHANGE DIRECTORY
4105 D0$=FNS$(S0$(265,70)),D$=""
4110 IF D0$>"" THEN IF D0$(1,1)="\" THEN D0$=D0$(2)
4115 IF D0$>"" THEN IF D0$(LEN(D0$))="\" THEN D0$=D0$(1,LEN(D0$)-1)
4120 IF D0$="" THEN GOTO 4200 ELSE P=POS("\"=D0$+"\"),D$=D0$(1,P-1); IF D$="" THEN GOTO 4200
4125 D$=D$+S$,D$=D$(1,11); CALL "ZZPROM","X5ZA2BBU",X3$,0,"+("+D$+")","","",0
4130 SETERR 4190; CALL "DOSLINK","CD",D$,B0$
4140 D0$=D0$(P); GOTO 4110
4195 CALL "ZZPROM","X3ZA2BBU",X3$,0,"+("+D0$+")","","",0; GOTO 9800
4200 REM " CREATE THE OUTPUT FILE
4205 SETERR 9000
4210 F0$=R0$(9,8)+R0$(3,3),Q$="+( "+S0$(264,1)+":"+FNS$(S0$(265,70))+"\"+FNS$(R0$(9,8))+"."+R0$(3,3)+" )"
4215 CALL "ZZPROM","X6ZA2BBU",X3$,0,Q$,"","",0
4220 CALL "DOSLINK",ERR=4221,"CREATE",F0$+"",B0$; GOTO 4300
4225 E0=ERR; IF E0=12 THEN GOTO 4235
4230 IF E0=16 THEN CALL "ZZPROM","X7ZA2BBU",X3$,0,"","","",0; GOTO 9800 ELSE GOTO 9800
4235 REM "ALREADY EXISTS
4240 IF R0$(31,1)<>"1" THEN CALL "ZZPROM","X0ZA2BBU",X3$,S3,Q$,"","",0; ON S3 GOTO 4241,9800
4250 CALL "DOSLINK",ERR=9800,"ERASE",F0$,B0$
4260 GOTO 4215
4300 REM "OPEN THE FILE
4305 GOTO 4380
4310 CALL "DOSLINK",ERR=9800,"OPEN",F0$,B0$
4315 ESCAPE 
4390 RETURN 
8000 REM "CHECK FILE F2$
8005 Q$="+("+FNS$(F2$)+")"
8010 CLOSE (F9); OPEN (F9,ERR=8150)F2$
8015 IF R0$(31,1)<>"1" THEN GOTO 8100
8020 CLOSE (F9); ERASE F2$,ERR=8021; GOTO 8020
8025 IF ERR<>12 THEN GOTO 9800
8040 RETURN 
8100 REM 
8120 CALL "ZZPROM","X0ZA2BBU",X3$,S3,Q$,"","",0; ON S3 GOTO 8020,9800
8150 REM "ERROR ON OPEN
8160 IF ERR=12 OR (ERR=10 AND X3$(77,1)="U") THEN GOTO 8200
8170 CALL "ZZPROM","X1ZA2BBU",X3$,S3,Q$,"","",0; GOTO 9800
8200 REM "CREATE FILE - TBOS FILE
8209 GOTO 8250 ! 148605
8210 D0=NUM(S0$(260,1),ERR=8211); CLOSE (F9); OPEN (F9)"D"+STR(D0:"0"); Z$=FN%FID$(F9); CLOSE (F9); D0$=FNS$(Z$(4,6)+Z$(21)); GOTO 8250 ! [205703]-changed FID() to FN%FID$()
8220 CLOSE (F9); OPEN (F9,ERR=9800)S0$(260,4); Z$=FN%FID$(F9); IF LEN(Z$)=2 THEN GOTO 9800 ELSE IF Z$(10,1)<>$0A$ THEN GOTO 9800 ELSE D0=ASC(Z$(20,1)) ! [205703]-changed FID() to FN%FID$()
8250 REM 
8255 IF X3$(77,1)<>"T" THEN GOTO 8290 ELSE GOSUB 8300
8260 IF S0=0 THEN S0=10000
8265 Q=S9; IF R0$(60,1)="*" THEN Q=NUM(R0$(61,4),ERR=8266); IF Q=0 THEN Q=S9
8270 S1=1+INT(S0/S9); IF R0$(60,1)="*" THEN S1=NUM(R0$(65,6))
8275 INDEXED F0$,S1,Q,D0,0
8290 RETURN 
8300 REM "CK FOR FILE
8310 CLOSE (F9); OPEN (F9,ERR=8311)F0$; GOTO 8340
8320 IF ERR=12 THEN GOTO 8390 ELSE GOTO 9800
8340 IF R0$(31,1)<>"1" THEN CALL "ZZPROM","X0ZA2BBU",X3$,S3,Q$,"","",0; ON S3 GOTO 8341,9800
8395 RETURN 
8910 DEF FNS$(Z9$)=Z9$(1,POS("  "=Z9$+"  ")-1)
9800 REM "COME TO A BAD END
9805 Q$="+("+FNS$(F0$)+","+STR(TCB(5):"0000")+"."+STR(ERR:"000")+")"
9810 CALL "ZZPROM","ERZA2BBU",X3$,0,Q$,"","",0; X9=1
9940 EXIT 
9999 END 
56000 REM + Modification History
56002 REM "205703-Oracle - FID and FIB calls, replace with FN%FID$ and FN%FIB$
