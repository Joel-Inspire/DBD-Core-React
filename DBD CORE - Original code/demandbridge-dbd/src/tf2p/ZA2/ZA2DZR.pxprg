0010 REM "Rekey a database entry <ZA2DZR>
0030 REM "(C) 1985-1988 Basic Ideas, Inc; Atlanta, GA. USA
0035 REM "This software contains trade secrets and proprietary information"
1020 SETERR 1025; ENTER X3$,F0$,F1$,F2$,F3$,X0,X1,X9; SETERR 9000; GOTO 1100
1030 IF X3$="?" THEN CALL "ZZPDOC","ZA2DZR"; EXIT ELSE EXIT ERR
1105 DIM S$(20),Z[NUM(X3$(60,3))]
1120 Z$="01O ZA0... 02O ZA1... 03O ZA2... 04O ZA4...  05O ZAA... 06O ZAB... "
1130 GOSUB 9750
1140 IF F1$="" THEN F1$=F0$
1400 REM "MAKE SURE ITEM IS THERE
1420 DIM Q$(40); Q$(1,20)=F0$,Q$(21,20)=F2$
1430 FIND (Z[1],KEY=Q$(1,20),DOM=9800)A$
1440 FIND (Z[2],KEY=Q$,DOM=9800)B$
1600 REM "MAKE SURE NEW ITEM AIN'T
1620 DIM B1$(40); B1$(1,20)=F1$,B1$(21,20)=F3$
1630 FIND (Z[2],KEY=B1$(1,40),DOM=1631); GOTO 9800
2020 X9=99
2060 GOSUB 3000
2080 X9=0
2090 GOTO 9900
3000 REM "DATABASE SORT BY FIELD NAME
3010 READ (Z[5],KEY=B$(21,20),DOM=3011)
3020 E$=KEY(Z[5],END=3190); READ (Z[5])
3030 IF E$(1,20)<>B$(21,20) THEN GOTO 3190
3040 Q$=E$(21,20); GOSUB 4000
3050 REM "DATABASE DETAIL
3060 K$=E$(21,20)+E$(1,20); READ (Z[2],KEY=K$,DOM=3020)Q$
3065 Q$(1,20)=F1$,Q$(21,20)=F3$; WRITE (Z[2],KEY=Q$(1,40))Q$
3070 REMOVE (Z[2],KEY=K$)
3100 K$=B$(1,20)+" "+B$(87,6)+B$(21,20)
3110 REMOVE (Z[4],KEY=K$,DOM=3111)
3115 K$(21,1)="C"; REMOVE (Z[4],KEY=K$,DOM=3116)
3120 K$(1,20)=F1$,K$(28,20)=F3$; IF POS("F"=B$(82,5))=0 THEN K$(21,1)=""
3125 WRITE (Z[4],KEY=K$)
3175 WRITE (Z[5],KEY=Q$(21,20)+F1$)
3180 REMOVE (Z[5],KEY=E$)
3185 GOTO 3020
3195 RETURN 
4000 REM "CHECK DATABASE Q$ FOR ELEMENT IN KEY
4005 K9=0
4010 DIM A$(20); A$(1)=Q$; READ (Z[1],KEY=A$,DOM=4090)A$
4020 Q$=FNS$(A$(92,75)),K$=FNS$(F2$),P=POS(K$=Q$); IF P=0 THEN GOTO 4090
4030 K=LEN(K$),Q$=Q$(1,P-1)+FNS$(F3$)+Q$(P+K)
4040 A$(92)=Q$
4050 WRITE (Z[1],KEY=A$(1,20))A$
4060 K9=1
4095 RETURN 
4100 REM 
8910 DEF FNS$(X$)=X$(1,POS(S$=X$+S$)-1)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 IF Y5=68 THEN RETRY ELSE ON C9 GOTO 1140,2040
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM 
9810 CALL "ZZPROM","4",X3$,0,"Problem rekeying database entry","","",0
9820 X9=1
9830 GOTO 9900
9900 REM "END PROGRAM
9905 Y8=2
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9940 EXIT 
9999 END 
