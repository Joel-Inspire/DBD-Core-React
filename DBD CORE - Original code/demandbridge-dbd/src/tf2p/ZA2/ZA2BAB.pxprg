0010 REM "Data field selection <ZA2BAB>
0030 REM "(C) 1985-1989 Basic Ideas, Inc; Atlanta, GA. USA
0035 REM "3.6 - 01/13/93 - 15.58 - jsc
0040 REM "Copyright 1992 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 REM "FOLLOWING MODS TO LEAVE FIELD POSITIONS ALONE:
0051 REM "LINES 8211; 8028
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000; SETESC 9300
0110 X0$="ZA2BAB",X1$="Data field selection",K9$="",K9=0
0115 X1$=""
0120 DIM Z0$(80,"-")
0130 K0=29,K1=4
0135 C9=-1,B=-10
0140 Q0$="001"
0205 REM "*** S0 IS SPACING CONSTANT BETWEEN FIELDS!!!
0210 S0=1
0220 DIM S$(45),B[1],C[1],D[1],A$(80)
0240 CALL "ZZCOMP",X0$,X1$,"*",X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(65,1)>"2" THEN PRECISION NUM(X3$(65,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1))
0300 REM "IOLISTS
0310 IOLIST A$(1),K4$,K5$,K6$
0320 IOLIST B$,B[0],B[1]
0330 IOLIST C$,C[0],C[1]
0340 IOLIST D$,D[0],D[1]
0350 IOLIST E$,D0$,R0$,D2$,T0$
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]; F0$="ZB1"; IF X3$(146,6)="ZA2BBZ" THEN F0$="ZB4"
0510 Z$="01X ZB3...  02O ZB0...  03O ZA0...  04O ZA1...  05O ZB1...  06OSZB3...  13O ZZPARM  "
0520 GOSUB 9750; ON Z0 GOTO 0521,9900
0590 READ (Z[1],KEY=K9$,DOM=0591)
0595 READ (Z[13],KEY=FID(0)+"BERT",DOM=9950)A1$
0600 REM "
0610 CALL "ZZPROM","X0ZA2BAB",X3$,0,H0$,"","",0
0680 GOSUB 6000
0710 A$(1)=A1$; GOSUB 5800
1000 REM "
1010 Y8=1,C9=0; CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
1030 DIM B$(44),B[1],C$(165),C[1],D$(326),D[1],K6$(0); IF E$="" THEN DIM E$(330)
1035 DIM A$(200); A$(1)=A1$
1040 A$(30,20)=E$(60,20)
1050 A$(24,6)=""
1120 GOSUB 6450
1130 GOSUB 7500
1135 IF H8$>"" THEN GOTO 7700
1140 CALL "ZZPROM","X1ZA2BAB",X3$,A,"","","",0; ON A GOTO 9900,1150,7700
1150 REM "ADD FIELD - END
1160 A$(24,3)="001"; GOSUB 8600; A$(50,20)="",A1$=A$(1,29); GOTO 1600
1500 REM "
1505 Z9=-1,C9=0,A2$="",A3$="",A4$="",A5$=""
1510 A1$=A$(1,29)
1520 READ (Z[1],KEY=A1$,DOM=1600)IOL=0310
1525 Z9=1,V7$="",A9$=A$(24,6)
1529 Q$=A$(30,40); IF K4$>"" THEN Q$(1,20)=FNL$(K4$)
1530 FIND (Z[4],KEY=Q$,DOM=1531)IOL=0340
1590 GOTO 1700
1600 REM "
1610 A9$=""
1620 GOTO 1650
1630 GOTO 1000
1660 GOSUB 6200
1690 GOTO 2000
1700 REM "
1770 C0=0
1790 GOSUB 6200
1800 REM "
1810 IF C0=4 THEN GOTO 6700
1812 GOTO 1850
1820 CALL "ZZPROM","X2ZA2BAB",X3$,A,"","","",0; ON A GOTO 6700,6500,2000
1850 REM "MODIFY
1855 X0=X0-1; IF Z9=1 THEN GOTO 1880 ELSE IF Z9=0 THEN Z9=1
1890 IF Z<0 THEN GOTO 2035 ELSE GOTO 2000
2000 REM "DATA SEQ
2010 C0=0,X0=1,X1=1,C9=1; IF A$(50,20)=S$(1,20) THEN X0=-1
2020 SETERR 9000; X$="",Q$="",C0=ABS(C0),X0=X0+1; IF C0=2 THEN IF X0>0 THEN X0=X0-2
2025 IF INT(C0)=3 THEN GOSUB 7300 ELSE IF C0>3 OR X0<0 THEN GOTO 1800
2040 ON X0 GOTO 2100,2150,2400,2200,2250,2300,2350,2450,2500,2550,2600,6700
2100 REM "Database
2105 IF E$(24,1)<>"D" THEN C0=1; GOTO 2020
2108 IF A8$>"" THEN A$(30,20)=A8$ ELSE A8$=E$(60,20)
2109 X$="Databases are: "+FNS$(E$(60,20))+", "+E$(81,20)
2110 CALL "ZZENTR","SUN",A{ALL},A$,X4$,X3$,12,6,30,20,C0,"","{3"+X$,"","ZA2BAB08","ZA0","ZA2DAA",""; IF C0=6 THEN GOSUB 6400; C0=1
2111 IF INT(C0)=3 THEN IF A$(30,20)=E$(60,20) THEN A$(30,20)=E$(81,20) ELSE A$(30,20)=E$(60,20)
2112 IF INT(C0)=3 THEN PRINT @(12,6),A$(30,20),; C0=1
2120 IF V9<>-2 THEN FIND (Z[3],KEY=A$(30,20),DOM=2110)IOL=0330
2125 A8$=A$(30,20)
2130 IF POS(A8$=E$(60,20)+E$(81,20))=0 THEN GOTO 2108
2140 GOTO 2020
2150 REM "Field
2151 GOSUB 7650
2152 IF K4$>"" THEN Q$=FNL$(K4$) ELSE Q$=A$(30,20)
2155 K$=A$(50,20); K$=""; CALL "ZACKEY",X3$,"",3,12,10,20,Z[4],Q$,K$,12,7,0,Z[3],K4$,A$,K5$; IF K$="" THEN C0=4; GOTO 1000 ELSE P9$="S",K$=K$(21),A$(50,20)=K$,C0=0
2160 GOSUB 7200; GOSUB 6300
2165 Q$=A$(30,40); IF K4$>"" THEN Q$(1,20)=FNL$(K4$)
2170 IF A$(50,1)="@" THEN PRINT @(12,7),A$(50,20) ELSE FIND (Z[4],KEY=Q$,DOM=2150)IOL=0340; A$(71,2)=D$(236,2); IF D$(81,1)="N" THEN A$(70,1)="T"; IF POS("T"=E$(338,15))>0 THEN GOSUB 8300
2185 PRINT @(28,9),A$(71,2),
2190 GOTO 2020
2200 REM "Total
2205 X$="For numbers, 'T'=vertical total, A=Average"
2210 CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,12,9,70,1,C0,"","{3"+X$,"","ZA2BAB12","","",""
2240 GOTO 2020
2250 REM "Length
2255 IF C0<>2 THEN GOTO 2020
2260 CALL "ZZENTR","S",A{ALL},A$,X4$,X3$,28,9,71,2,C0,"","{3"+X$,"","ZA2BAB14","","",""
2290 GOTO 2020
2310 CALL "ZZENTR","ZUX",A{ALL},A$,X4$,X3$,12,10,24,3,C0,"","{3"+X$,Q$,"ZA2BAB04","","",""; IF C0=6 THEN GOSUB 6400; C0=1
2312 IF C0>0 THEN Q0$=A$(24,3),B=-10; GOSUB 7500; GOSUB 8600; C0=1
2340 GOTO 2020
2355 IF A$(80,1)<>" " THEN A$(27,3)=A$(80,1)
2360 CALL "ZZENTR","SZUX",A{ALL},A$,X4$,X3$,28,10,27,3,C0,"","{3"+X$,Q$,"ZA2BAB06","","",""; IF C0=6 THEN GOSUB 6400; C0=1
2365 T0=NUM(A$(27,3),ERR=2370); GOTO 2020
2370 GOSUB 5950; IF Q<=0 THEN GOTO 2360
2390 GOTO 2020
2400 REM "Enter special code
2402 IF A$(50,1)<>"@" THEN GOTO 2020
2403 K5$=""
2405 IF K6$="" THEN DIM K6$(28*5) ELSE FOR X=1 TO LEN(K6$) STEP 28; PRINT @(34,6+INT(X/28)),K6$(X,28),; NEXT X
2410 CALL "ZZENTR","S",A{ALL},K6$,X4$,X3$,34,6,1,28,C0,"","","","","","04V0","04V0"
2440 GOTO 2020
2450 REM "Print mode
2455 X$="  Not implemented at this time"
2460 CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,14,12,81,6,C0,"",X$,"","","","",""
2490 GOTO 2020
2500 REM 
2505 X$="  H=Omit Heading for this field"
2510 CALL "ZZENTR","SU",A{ALL},A$,X4$,X3$,14,13,87,16,C0,"",X$,"","","","",""
2540 GOTO 2020
2550 REM "NUMERIC OUTPUT MASK
2555 X$="  Current default mask is "+D$(102,4)
2560 CALL "ZZENTR","SUZ",A{ALL},A$,X4$,X3$,23,14,103,4,C0,"",X$,"","","","",""
2590 GOTO 2020
2600 REM "Headings
2605 X$="Press F10 to initialize as default"
2610 CALL "ZZENTR","S",A{ALL},A$,X4$,X3$,2,17,107,30,C0,"",X$,"","","","","02V0"
2611 IF ABS(C0)=7 THEN A$(107,90)=D$(238,90); GOSUB 6380; GOTO 2610
2640 GOTO 2020
5000 REM "WRITE REPORT DATA (TO UPDATE TABS)
5010 WRITE (Z[5],KEY=E$(1,23))IOL=0350
5090 GOTO 9900
5800 REM "Alt sort keys
5802 EXTRACT (Z[5],KEY=A$(1,23))IOL=0350
5805 FIND (Z[2],KEY=A$(1,3),DOM=5806)IOL=0320
5810 FIND (Z[3],KEY=E$(60,20),DOM=5811)IOL=0330
5825 IF T0$>"" THEN GOSUB 5900
5890 RETURN 
5900 REM "GET REST OF TAB DATA
5905 T1$=""
5910 FOR X=1 TO LEN(T0$) STEP 9
5915 READ (Z[1],KEY=E$(1,23)+T0$(X+3,6),DOM=5916)IOL=0310
5920 T1$=T1$+A$(50,20); NEXT X
5940 GOSUB 7200
5945 RETURN 
5950 REM "SET POSITION BASED ON TAB
5955 Q$=A$(27,1),P=POS(Q$=T0$,9); IF P=0 THEN Q=-1; GOTO 5990
5960 A$(80,1)=Q$,A$(27,3)=T0$(P+6,3),Q=1
5995 RETURN 
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6060 CALL "ZZVDTP",X3$,X0$,X1$,"",0
6070 REM CALL "ZZGRPH",X3$,"!AB",X(ALL),"",3,8,0,0,0,11,26,0,0,0
6165 PRINT (0,ERR=6166)'SF',
6170 RETURN 
6200 REM "DISPLAY DATA
6215 GOSUB 6450
6225 IF K4$>"" THEN PRINT @(12,6),FNL$(K4$), ELSE PRINT @(12,6),A$(30,20),
6230 PRINT @(12,7),A$(50,20),@(12,9),A$(70,1),@(28,9),A$(71,2),
6240 GOSUB 6300
6290 RETURN 
6300 REM "Display extended field info
6305 GOSUB 7600
6310 PRINT 'SB',@(2,12),"Print mode:",@(5,13),"Options:",@(2,14),"Numeric output mask:",'SF'
6315 PRINT @(1,16),'SB',"---- Headings ----",'SF',
6320 PRINT @(14,12),A$(81,6),@(14,13),A$(87,16),@(23,14),A$(103,4),
6380 FOR X=0 TO 2; PRINT @(2,17+X),A$(107+X*30,28),; NEXT X
6390 RETURN 
6400 REM "WHOLE SCREEN
6402 IF C9=0 THEN IF ABS(C0)=17 THEN GOTO 6970
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6460 PRINT @(15,3),A$(1,3),"/",A$(4,20),
6465 PRINT @(12,10),A$(24,3),; IF A$(80,1)=" " THEN PRINT @(28,10),A$(27,3), ELSE PRINT @(28,10),A$(80,1),"  ",
6490 RETURN 
6500 REM "DELETE CURRENT FIELD
6505 IF H8$(Q4*6+1,6)=S$(1,6) OR H8$(Q4*6+4,3)=S$(1,3) THEN GOTO 7700
6507 CALL "ZZPROM","X2ZA2BAB",X3$,S3,"","","",0; ON S3 GOTO 7700,6508
6510 READ (Z[1],KEY=E$(1,23)+H8$(Q4*6+1,6),DOM=6590)A$; A9$=A$(24,6),P0=-NUM(A$(71,2)),X$=A$(24,6),A9=A9-1
6515 GOSUB 8850; IF P>0 THEN P0=-P
6520 GOSUB 8025
6590 GOTO 1630
6600 REM "ALT KEY DATA READS
6605 FIND (Z[2],KEY=A$(1,3),DOM=6606)IOL=0320
6690 RETURN 
6700 REM "ADD ENTRY
6702 IF E$(24,1)<>"T" THEN Q=NUM(A$(27,3))+NUM(A$(71,2)); IF STR(Q:"000")>E$(124,3) THEN CALL "ZZPROM",".4",X3$,0,"NOTE: This field exceeds the line width from screen 1","","",0
6705 IF A9$="" THEN GOSUB 7900; A9=A9+1 ELSE IF A$(24,6)<>A9$ THEN GOSUB 8000
6708 IF A$(50,20)=S$(1,20) THEN GOTO 1630
6710 WRITE (Z[1],KEY=A$(1,29))IOL=0310
6715 IF Q0$<>A$(24,3) THEN Q0$=A$(24,3),Q0=-1
6720 IF T9=1 THEN GOSUB 7200; T9=0
6790 GOTO 1000
6800 REM "NEXT ENTRY IN FILE
6805 ON 10*FPT(C0)+2 GOTO 6850,6806
6810 A1$=KEY(Z[1],END=6895)
6820 IF A1$="" THEN GOTO 6800 ELSE IF A1$(1,LEN(K9$))<>K9$ THEN GOTO 6895
6825 A$(1,LEN(A1$))=A1$
6830 GOSUB 6600
6835 GOSUB 6450
6840 GOTO 1515
6850 REM "PRIOR ENTRY
6855 CALL "ZZKEYP",ERR=6856,Z[1],A1$; GOTO 6820
6860 PRINT 'RB',; CALL "ZZKEYL",ERR=6861,Z[1],A1$; GOTO 6820
6865 GOTO 1100
6870 GOTO 6895
6890 GOTO 1515
6895 IF A1$="" THEN GOTO 6860 ELSE PRINT 'RB',; READ (Z[1],KEY=K9$,DOM=6896)
6898 ON S9 GOTO 6810,1100
7000 REM "SET OR UN-SET POSITION
7010 Q$=A$(50,20),Q$="+("+FNS$(Q$)+")",Q=POS(A$(50,20)=T1$,20); IF Q=0 THEN GOTO 7100
7020 CALL "ZZPROM","T1ZA2BAB",X3$,S3,Q$,"","",0; ON S3 GOTO 7700,7025
7025 T1$=T1$(1,Q-1)+T1$(Q+20),Q=INT(Q/20),Q=Q*9+1
7030 T0$=T0$(1,Q-1)+T0$(Q+9)
7040 GOSUB 7200
7090 GOTO 7700
7100 REM "ADD TAB
7120 CALL "ZZPROM","T0ZA2BAB",X3$,S3,Q$,"","",0; ON S3 GOTO 7700,7125
7130 T1$=T1$+A$(50,20),T1=LEN(T1$)/20-1,Q$=CHR(ASC("A")+T1)
7140 T0$=T0$+Q$+"  "+A$(24,6)
7150 GOSUB 7200
7190 GOTO 7700
7200 REM "DISPLAY TAB WINDOW
7205 GOSUB 7650; IF T0$="" THEN GOTO 7290
7210 PRINT 'SB',; FOR X=0 TO 8
7225 Q=X*9+1; IF Q>LEN(T0$) THEN EXITTO 7290
7230 PRINT @(2,X+12),T0$(Q,1)," ",T1$(X*20+1,20)," ",T0$(Q+6,3)
7240 NEXT X
7290 PRINT 'SF',
7295 RETURN 
7500 REM "DISPLAY PAGE OF ITEMS
7505 REM "H7$ = SELECTIONS WHICH ARE OTHER LINES, H8$ = POSITIONS OF DISPLAYED FIELDS (IN ORDER);  H9$ IS SELECTION DISPLAY TEXT FOR ZZSLCT
7510 GOSUB 7600
7515 Q0=0,Q1=0,H8$="",H9$="",H5$="000",H6=-1,H7=0,H7$="",Q1$=""; DIM W$(80)
7520 READ (Z[1],KEY=A$(1,23),DOM=7521)
7525 READ (Z[1],END=7560)W$; IF W$(1,23)<>A$(1,23) THEN GOTO 7560
7527 IF W$(24,3)<>Q1$ THEN IF W$(24,3)<>Q0$ THEN GOSUB 7800; GOTO 7532 ELSE IF H7>0 THEN Q1=Q1+1
7530 Q$=FNS$(W$(50,20)),Q1$=W$(24,3); IF Q1$=Q0$ THEN H5$=STR(NUM(W$(27,3))+NUM(W$(71,2)):"000")
7532 PRINT @(Q0+35,Q1+6),Q$,; H9$=H9$+CHR(Q0+35)+CHR(Q1+6)+CHR(LEN(Q$))+Q$
7535 H8$=H8$+W$(24,6),Q1=Q1+1,H7=H7+1; IF Q1>14 THEN Q1=0,Q0=Q0+24
7550 GOTO 7525
7560 IF H6<0 THEN GOSUB 7850
7590 RETURN 
7600 REM "CLEAR DISPLAY AREA
7610 FOR X=0 TO 13; PRINT @(34,6+X),S$(1,45),; NEXT X
7645 RETURN 
7650 REM "CLEAR SELECT AREA
7655 FOR X=0 TO 8
7660 PRINT @(2,12+X),S$(1,30),
7670 NEXT X
7690 RETURN 
7700 REM "PICK AN ALREADY SELECTED FIELD
7740 CALL "ZZSLCT",X3$,"CR","000004012014011","",H9$,H0$,"",A9,B,Q4
7745 A9=B; IF B<0 THEN A9=Q4 ELSE IF B=H6 THEN GOSUB 8600; GOTO 1600
7750 IF B=-3 THEN GOTO 5000 ELSE IF B=-5 THEN GOTO 6500
7752 IF B>=0 THEN Q=POS(STR(B:"000")=H7$,6); IF Q>0 THEN Q0$=H7$(Q+3,3),B=-10; GOTO 1130
7755 IF B>=0 THEN X$=H8$(B*6+1,6),A$(24,6)=X$; GOTO 1500
7760 X$=H8$(Q4*6+1,6); IF X$=S$(1,6) THEN GOTO 7700 ELSE A$(24,6)=X$,A9$=X$
7762 READ (Z[1],KEY=A$(1,29))IOL=0310
7775 IF B=-4 THEN A$(24,6)=X$,A$(50,20)="",A1$=A$(1,29); GOTO 1600
7780 IF B=-6 THEN GOTO 7000
7795 RETURN 
7800 REM "DISPLAY - LINE CHANGE
7805 IF H6<0 AND Q1$=Q0$ THEN GOSUB 7850
7810 IF W$(24,3)=Q0$ THEN GOTO 7845
7811 IF Q0$=Q1$ THEN Q1=Q1+1
7820 Q$="** Line "+STR(NUM(W$(24,3)))+" **",Q1$=W$(24,3),H7$=H7$+STR(H7:"000")+Q1$
7840 READ (Z[1],KEY=W$(1,26)+$FF$,DOM=7841)
7842 W$(27)=""
7845 RETURN 
7850 REM "NEW ENTRY
7858 Q$="** Add to Line "+STR(NUM(Q0$))+" **"
7860 H9$=H9$+CHR(Q0+35)+CHR(Q1+6)+CHR(LEN(Q$))+Q$; PRINT @(Q0+35,Q1+6),Q$,; Q1=Q1+1,Q1$="",H6=H7
7865 IF B=-10 THEN A9=H7
7866 IF Q0<0 THEN Q0=0,A9=H7
7870 H8$=H8$+S$(1,6),H7=H7+1,Q1=Q1+1
7895 RETURN 
7900 REM "INSERT CURRENT FIELD
7910 P0=S0+NUM(A$(71,2)),X$=A$(24,6)
7930 GOSUB 8400
7990 RETURN 
8000 REM "MODIFIED CURRENT POSITION: DELETE CURRENT & ADJUST
8020 X$=A9$,P0=NUM(A$(71,2))
8022 P0=NUM(A$(27,3))-NUM(A9$(4,3))
8025 REMOVE (Z[1],KEY=E$(1,23)+A9$,DOM=8026)
8028 GOTO 8040
8030 GOSUB 8400
8090 RETURN 
8200 REM "DELETE ELEMENT X$ WITH PRINT DISPLACEMENT OF P0
8210 REMOVE (Z[1],KEY=E$(1,23)+X$); K$=KEY(Z[1],END=8250); IF K$(1,26)<>E$(1,23)+X$(1,3) THEN GOTO 8250
8211 GOTO 8250
8212 P0=NUM(X$(4,3))-NUM(K$(27,3))
8215 K$=KEY(Z[1],END=8250); IF K$(1,26)<>E$(1,23)+X$(1,3) THEN GOTO 8250
8220 READ RECORD (Z[1],KEY=K$)R$
8225 R$(27,3)=STR(NUM(R$(27,3))-P0:"000")
8230 WRITE RECORD (Z[1],KEY=R$(1,29))R$
8235 REMOVE (Z[1],KEY=K$)
8240 GOTO 8215
8250 REM 
8295 RETURN 
8300 REM "TRUNCATE OPTION - REMOVE DECIMALS
8310 Q=NUM(D$(104,1)); IF Q=0 THEN RETURN 
8315 Q=Q+1,Q=NUM(A$(71,2))-Q,A$(71,2)=STR(Q:"00")
8390 RETURN 
8400 REM "ADJUST FIELDS INCLUDING/AFTER X$ BU +-P0 SPACES
8410 IF P0=0 THEN GOTO 8490 ELSE GOSUB 8800; IF Q$="" THEN GOTO 8490
8420 Q0=INT(LEN(Q$)/6); IF P0>0 THEN FOR Q=Q0-1 TO 0 STEP -1 ELSE FOR Q=0 TO Q0-1
8425 K$=E$(1,23)+Q$(Q*6+1,6); READ RECORD (Z[1],KEY=K$)R$
8430 R$(27,3)=STR(NUM(R$(27,3))+P0:"000")
8435 WRITE RECORD (Z[6],KEY=R$(1,29))R$
8440 REMOVE (Z[1],KEY=K$)
8445 NEXT Q
8495 RETURN 
8600 REM "GET BEST GUESS FOR ADD TO END FROM LAST ENTRY
8605 IF H8$="" THEN A$(27,3)="002"; GOTO 8680
8620 A$(24,3)=Q0$,A$(27,3)=STR(NUM(H5$)+S0:"000")
8640 RETURN 
8650 REM "GET POSITION OF SELECTED FIELD
8690 GOTO 1600
8695 RETURN 
8800 REM "GET LIST OF FIELDS INCLUDING&AFTER X$
8805 Q$=""
8810 EXTRACT (Z[1],KEY=E$(1,23)+X$,DOM=8811)
8815 K$=KEY(Z[1],END=8820); IF K$(1,26)=E$(1,23)+X$(1,3) THEN Q$=Q$+K$(24,6); READ (Z[1]); GOTO 8815
8845 RETURN 
8850 REM "GET POSITION ON RIGHT-NEIGHBOR FIELD
8855 P=POS(X$=H8$,6); IF P>0 THEN P=P+6 ELSE P=-1; GOTO 8890
8860 IF P>LEN(H8$) THEN P=-1; GOTO 8890 ELSE IF H8$(P,3)<>X$(1,3) THEN P=-1; GOTO 8890
8865 P=NUM(H8$(P+3,3))
8895 RETURN 
8910 DEF FNS$(Z$)=Z$(1,POS(S$=Z$+S$)-1)
8915 DEF FNL$(Z$)=Z$(LEN(Z$)-19,20)
9000 REM "ERROR PROCESSING
9010 Y9=-1,Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 IF Y9>0 THEN GOSUB 9400
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400; GOSUB 7500
9520 ON C9 GOTO 1000,2040
9740 RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 Y8=2
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9940 RUN "ZA2BAZ"
9950 RUN "ZMENU"
9999 END 
