0010 REM "Return IOLIST for Database <ZA2BU1>
0020 SETESC 9300; SETERR 9000
0030 REM "(C) 1985-1988 Basic Ideas, Inc; Atlanta, GA. USA
0035 REM "3.5 - 03/18/92 - 15.32
0040 REM "Copyright 1992 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 SETERR 9000; SETESC 9300
0110 X0$="ZA2BU1"
1010 REM "F0$ IS DATABASE, F0 IS FILE DEVICE FOR DATA DICTIONARY
1012 REM "I0$ IS IOLIST, I1$ IS RE-GROUPING
1014 REM "I0 IS STRING OFFSET (ADDITIONAL CHARS), I1 IS ARRAY OFFSET
1016 REM "PROCESSES ALTERNATE SORT BY LOCATION
1020 ENTER X3$,F0$,F0,I0$,I1$,E0$,E1$,E2$
1200 REM "CHECK FILES
1205 DIM Z[NUM(X3$(60,3))]
1210 Z$="01O ZA1... 02O ZA4... 03O ZA5... "; GOSUB 9750
1400 REM "
1800 REM "
2000 REM "
2005 I0=0,I1=0,I2=0,I3=0,I9=0,N1=-1,C0$=CHR(ASC("A")+F0-1),I0$="",I1$=""
2010 READ (Z[2],KEY=F0$,DOM=2011)
2020 F$=KEY(Z[2],END=2900); IF F$(1,20)<>F0$(1,20) THEN GOTO 2900 ELSE READ (Z[2])
2025 READ (Z[1],KEY=F$(1,20)+F$(28,20),DOM=2020)G$; IF POS(G$(81,1)="* ")>0 THEN GOTO 2020
2030 N0=N1,N1=POS(G$(81,1)="N")
2035 I8=NUM(G$(87,3)); IF I9<>I8 THEN GOSUB 4000
2050 ON N1 GOTO 2100,2200
2100 REM "STRING
2105 IF F$(21,1)<>"C" THEN I0=NUM(G$(90,3))
2110 WRITE (Z[2],KEY=F$)F$,I0+I2
2120 IF F$(21,1)="C" THEN I2=I2+NUM(G$(93,3)) ELSE Q=NUM(G$(90,3))+NUM(G$(93,3)); IF Q-I2>I0 THEN I0=Q
2190 GOTO 2290
2220 WRITE (Z[2],KEY=F$)F$,I1+I3
2225 I1=I1+1
2290 GOTO 2020
2900 REM 
2910 IF I0$="" THEN GOTO 2980 ELSE I0$="IOLIST "+I0$,I0$=I0$(1,LEN(I0$)-1),I1$=""
2920 IF I0+I2>0 THEN I1$=I1$+C0$+"$("+STR(I0+I2)+")"+","
2925 IF I1+I3>0 THEN I1$=I1$+C0$+"("+STR(I1+I3)+")"+","; IF POS(G$(81,1)="* ")>0 THEN GOTO 2020
2990 GOTO 9900
4000 REM "NEXT FIELD NUMBER NOT SAME AS CURRENT $
4002 IF POS("F"=G$(82,5))>0 OR F$(21,1)="C" THEN IF N1=0 THEN I2=I2+NUM(G$(90,3)) ELSE I3=I3+0
4003 IF POS("F"=G$(82,5))>0 OR F$(21,1)="C" THEN GOTO 4050
4005 IF N0=0 THEN I2=I2+I0,I0=1
4007 IF N1=0 THEN I0=NUM(G$(90,3))
4010 IF F$(21,1)<>"C" THEN I9=I9+1
4015 IF LEN(I0$)>1250 THEN CALL "ZZPROM",".4",X3$,0,"Database "+F0$+" exceeds limits.  Check data dictionary!","","",0; EXITTO 2900
4016 IF I9<>I8 THEN I0$=I0$+"X$,"; GOTO 4010
4020 I0$=I0$+C0$; IF N1=0 THEN I0$=I0$+"$"
4025 I0$=I0$+"("; IF N1=0 THEN I0$=I0$+STR(I0+I2)+")," ELSE I0$=I0$+STR(I1+I3)+"),"
4190 RETURN 
4400 REM "CREATE ZA4 RECORDS
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 IF Y5=68 THEN RETRY ELSE ON C9 GOTO 1140,2040
9740 RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 Y8=2
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9940 EXIT 
9999 END 
