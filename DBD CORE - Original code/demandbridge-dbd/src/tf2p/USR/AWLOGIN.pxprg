0010 REM "ASG Menu Startup Program  <AWLOGIN> version of ZSTART for Auto Whse
0012 SETESC 9300
0035 REM "4.4 - 05/02/00 - 13.29 - rms - SSP# 118453
0040 REM "Copyright 2000 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0042 REM "All Rights Reserved Worldwide
0043 REM "SETESC 00000; ESCAPE
0120 BEGIN ; SETERR 9000; SETESC 9300; N1$="TopForm Resource Manager",N2$="Computer Software Inc.",S9=PSZ; GOSUB 7950; IF S9<>PSZ THEN GOTO 4000 ELSE GOSUB 0600; CALL "ZZDROP"; GOSUB 2000; CALL "ZZDAPP",X3$,"IPL"; GOSUB 5000; GOSUB 2080
0135 IF S0$(86,1)="?" THEN CALL "ZZ2PRZ"; GOTO 0010
0136 IF X3$(28,1)="1" THEN IF X3$(77,1)="U" THEN GOSUB 8700
0140 IF X3$(200,1)<>" " THEN CALL "ZZPROM","X9ZZMAIL",X3$,S3,"","","",0; IF S3=0 THEN RUN "ZZ2MBA" ELSE CALL "ZZSETM",X3$,K$(1,3),"-"
0150 REM 
0152 IF P7$="" THEN GOTO 0190
0155 REM IF S0$(64,3)<>"   "GOTO 00190
0160 CALL "ZZ2PRX"
0170 CALL "ZZINST",ERR=0171,"DONE!",0,0,"","",""
0190?DIM ]7$(400); LET ]7$(77,3)=X3$(40,3), ]7$(228,1)="A"; CALL "IDPUB4",]6$,]7$,]8$,]9$; CALL "8ZPSYS",]SYS$
0195 RUN "ID"
0600 REM "
0605 DIM B1$(80,"-"),Z$(12,"0"),S$(80),X3$(339); X3$(238,1)="0"
0615 GOSUB 6700; GOSUB 6600; CALL "ZZTRMI",ERR=0616,X$,""
0616 PRINT 'CS','SB',
0617 REM "CALL "ZZDISP","-","0002","",X3$,"","",0,0,""
0620 P=39-INT(LEN(N1$)/2),P1=P+LEN(N1$)
0622 GOTO 0655
0625 FOR X=LEN(N1$) TO 1 STEP -1
0628 IF N1$(X,1)=" " THEN GOTO 0645
0630 FOR Y=1 TO P+X
0635 PRINT @(Y-1,1)," ",@(Y),N1$(X,1),
0640 NEXT Y
0645 PRINT @(0,1),
0650 NEXT X
0655 REM " PRINT @(40-INT(LEN(N1$)/2),1),N1$,
0660 L0$=""; CALL "ZZLANG",X3$,L0$
0680 GOSUB 6000
0690 RETURN 
2000 REM "SETUP X3$ CONTROL RECORD
2005 REMOVE (6,KEY=X3$(1,8),DOM=2006)
2010 IF PSZ<>S9 THEN GOTO 4400 ELSE CLOSE (6); OPEN (6,ERR=6800)"ZZPARM"
2020 DIM P$(80),Q$(160); X3$(1,2)=FID(0); X3$(163,6)=Q$(8,6),X3$(201,1)="0",X3$(64,3)="922"
2021 DT$=FN%NTD$(JUL(0,0,0),"YYYYMMDD"),DT$=CHR(NUM(DT$(1,3))-125)+DT$(4),X3$(21,6)=DT$
2022 GOSUB 7300
2025 Q$="00"; GOSUB 8200; GOSUB 8300
2030 GOSUB 6600; REMOVE (6,KEY=X3$(1,8),DOM=2031)
2031 REMOVE (6,KEY=X3$(1,2)+"NOTE",DOM=2032)
2035 X3$(238,1)="0"; PRINT (0,ERR=2036)'SP',; X3$(238,1)="1"; GOTO 2037; REM "if SP then don't check for ZW
2036 PRINT (0,ERR=2037)'ZW',; X3$(238,1)="2"; REM "Set flag to indicate how to handle revers video
2070 FOR X=1 TO 9; Q0$=FNS$(Q$(X*12+1,12)),Q$(X*12+1,12)=Q0$+Z$(1,12-LEN(Q0$)); NEXT X; FOR X=0 TO 11; Q0$=FNS$(Q$(X*12+201,12)),Q$(X*12+201,12)=Q0$+Z$(1,12-LEN(Q0$)); NEXT X
2071 Q0$=""; FOR X=1 TO 9; Q0$=Q0$+Q$(X*12+1,12); NEXT X; X3$=X3$+Q0$
2072 Q0$=""; FOR X=0 TO 11; Q0$=Q0$+Q$(X*12+201,12); NEXT X; X3$=X3$+Q0$
2073 IF S9<>PSZ THEN GOTO 4400 ELSE READ (6,KEY="INSTALL",DOM=3000)S0$; IF NUM(S0$(47,9))<>S8 THEN GOTO 4010 ELSE X3$(163,6)=S0$(50,6),X3$(77,1)=S0$(72,1),X3$(51,1)=S0$(74,1),X3$(63,1)=S0$(73,1),X3$(27,1)=S0$(78,1),X3$(278,2)=S0$(83,2),X3$(28,1)=S0$(85,1),X3$(234,1)=STR(SGN(POS("2"=S0$(92,6)))); IF S0$(78,1)="0" THEN X3$(9,3)=S0$(79,3) END_IF ; IF POS("MS"=SYS)=1 AND X3$(77,1)="U" THEN X3$(77,1)="D"
2074 X3$(276,1)="S"; IF S0$(82,1)="1" THEN X3$(276,1)="" ELSE IF S0$(82,1)="3" THEN X3$(276,1)="H" ELSE IF S0$(82,1)="4" THEN X3$(276,2)="SL" ELSE IF S0$(82,1)="5" THEN X3$(276,2)="SC"
2075 GOSUB 5450; IF X3$(163,6)="      " THEN GOSUB 3000; RETURN 
2080 Q$=X3$(40,16)+$1F$+X3$(154,26),X3$(73,4)=HTA(CRC(Q$))
2081 IF X3$(40,3)<>"   " THEN DIM P6$(255); READ (6,KEY="osec"+X3$(40,3),DOM=2082)P6$; X3$(333,2)=P6$(37,2)
2082 Q$=X3$(9,3); CALL "ZZMNUC",X3$,X4$,Q$,N1$
2085 GOSUB 2900; WRITE (6,KEY=X3$(1,8))X3$,"",X4$,"","",A9$
2090 RETURN 
2095 RETURN 
2920 Q$="000"+X3$(163,6)
2925 IF T0$>"" THEN X3$(169,3)=T0$ ELSE X3$(169,3)=FID(0)
2940 Q$=X3$(40,12)+Q$+$1F$+X3$(154,18),Q$=HTA(CRC(Q$)); X3$(73,4)=Q$
2950 Q$=STR(S8:"000000000"),S0=S8; IF S0$="" THEN GOTO 2990
2952 I0$="?"; CALL "ZZINST",I0$,S1,U0,Q9$,C0$,""
2953 A9$=""; FOR X=1 TO LEN(Q9$) STEP 17; A9$=A9$+Q9$(X,5); NEXT X
2954 A2$=U0$(2,2); FOR X=6 TO 1 STEP -1; A2$=A2$+STR(MOD(INT(S0/(1+X+NUM(Q$(X,1)))),10))+Q$(X,1); NEXT X; A2$=A2$+U0$(1,1)+"7"; A3$=""; FOR X=1 TO 11 STEP 2; A3$=A3$+CHR(NUM(A2$(X,2))); NEXT X; A3$=HTA(LRC(A3$)+CRC(A9$)); A4$=HTA(LRC(A9$)),A3$=A4$(1,1)+A3$+A4$(2,1),S1$=A3$
2970 IF S1$<>S0$(56,8) THEN GOTO 4010
2975 IF LEN(P$)=3 THEN P$=" "+P$
2980 IF P$(2,3)<>"   " THEN GOSUB 3400
2995 RETURN 
3000 REM "New installation
3010 IF PSZ<>S9 THEN GOTO 4400 ELSE DIM A0$(8); E0=0; GOSUB 3330
3020 IF E0>3 THEN GOTO 4000 ELSE PRINT @(0,3),'CE','SB',@(26,6),"Installation:",@(17,8),"Your Serial"+" Number is:",@(23,10),"Number of users:",@(16,12),"Enter your acce"+"ss code:",
3050 GOSUB 2900
3100 REM "
3101 SETERR 0000
3110 I0$="?"; CALL "ZZINST",ERR=3500,I0$,S1,U0,Q9$,C0$,""
3112 A9$=""; FOR X=1 TO LEN(Q9$) STEP 17; A9$=A9$+Q9$(X,5); NEXT X
3120 S0=S8,U0$=STR(U0:"000")
3125 Q$=STR(S0:"000000000"); PRINT @(40,6),I0$,@(40,8),Q$,@(40,10),U0$,@(40,12),A0$,
3140 IF X3$(77,1)="D" THEN CALL "ZZENTR","ZT",X{ALL},Q$,X4$,X3$,40,8,1,9,C0,"","","","","","",""; S0=NUM(Q$)
3150 E0=E0+1; GOTO 3160
3155 REM # OF USERS;CALL "ZZENTR","ZT",X(ALL),U0$,X4$,X3$,40,10,1,3,C0,"","","","","","","";IF C0=10 PRINT 'RB',;GOTO 03150 ELSE IF C0=4 GOTO 09900
3160?CALL "ZZENTR","SUTJ",X[ALL],A0$,X4$,X3$,40,12,1,8,C0,"","","","","","",""; IF ABS(C0)=10 THEN PRINT 'RB', ELSE IF ABS(C0)=4 OR A0$="ABORT " THEN GOTO 09900 ELSE IF A0$(1,6)="TAICHI" THEN PRINT (6,KEY="") S1$(5,1)+S1$(2,1)+S1$(1,1)+S1$(3,2)+S1$(6,1),; LET E0=3; GOTO 03020 ELSE IF C0=2 THEN GOTO 03155
3180 A2$=U0$(2,2); FOR X=6 TO 1 STEP -1; A2$=A2$+STR(MOD(INT(S0/(1+X+NUM(Q$(X,1)))),10))+Q$(X,1); NEXT X; A2$=A2$+U0$(1,1)+"7"; A3$=""; FOR X=1 TO 11 STEP 2; A3$=A3$+CHR(NUM(A2$(X,2))); NEXT X; A3$=HTA(LRC(A3$)+CRC(A9$)); A4$=HTA(LRC(A9$)),A3$=A4$(1,1)+A3$+A4$(2,1),S1$=A3$
3185 IF S1$<>A0$ THEN GOTO 3020 ELSE A1$=S1$
3190 X3$(163,6)=Q$(4,6),X3$(40,5)=""; GOSUB 2900
3192 READ (6,KEY="INSTALLX",ERR=3193)S9$; S9$(64,3)=""
3195 IF PSZ<>S9 THEN GOTO 3300 ELSE DIM Q$(200); Q$(1)=S9$,Q$(1,7)="INSTALL",Q$(8,30)=I0$,Q$(67,3)=STR(U0:"000"),Q$(47,9)=STR(S0:"000000000"),Q$(56,8)=A1$; GOSUB 3200; WRITE (6,KEY=Q$(1,7))Q$,V0$; CALL "ZZUSER","","!*","CSI",NUM(U0$),0; GOTO 2073
3200 REM 
3205 SETERR 3230
3230 SETERR 9000; Q$(72,1)=" ",Q$(73,12)="0110 0001511",Q$(87,5)="00000"
3232 Q$(72,1)="U",Q$(86,1)="?"; IF I0$>"" THEN Q$(86,1)=""
3235 IF POS("MS-DOS"=SYS)=1 THEN Q$(72,1)="D"
3240 RETURN 
3300 REM "Install
3310 CLOSE (6); OPEN (6)"ZZPARM"; LOCK (6,ERR=3345); UNLOCK (6); EXTRACT RECORD (6,KEY="INSTALL",DOM=3311)S9$; WRITE RECORD (6,KEY="INSTALLX")S9$; REMOVE (6,KEY="INSTALL")
3311 REMOVE (6,KEY="INSTALLX",DOM=3312)
3312 REMOVE (6,KEY="APPS",DOM=3313)
3315 CALL "ZZUSER",ERR=3316,"","!*","CSI",0,0
3320 REM "CLOSE (6)
3330 PRINT @(70,1),"*INSTALL*",; RETURN 
3345 PRINT 'RB',; GOTO 0010
3350 REM "Can't lock ZZPARM
3400 REM "Check applications for version codes
3401 IF A8$>"" THEN GOTO 3490
3402 PRINT @(0,15),'CE',"Initializing",
3405 A8$=A9$,A9$="",K$="@"+STR(%SSN)
3410 CLOSE (8); OPEN (8)"ZX0"
3415 IF POS("8."=SYS)<>0 THEN L8=13 ELSE L8=1
3420 FOR X=1 TO LEN(A8$) STEP 5
3421 IF A8$(X,1)="!" THEN X3$(30,1)=A8$(X+1,1); GOTO 3480
3425 READ (8,KEY=A8$(X,2),DOM=3480)Q$
3430 O$=A8$(X,2)+"2VER"; IF LEN(Q$)>41 THEN IF Q$(41,6)<>"      " THEN O$=Q$(41,6)
3432 CLOSE (14); OPEN (14,ERR=3475)O$; READ RECORD (14)C9$; IF C9$(L8,1)<>$80$ THEN GOTO 3475
3435 CALL O$,ERR=3475,Q0$,Q1$,C9$
3440 CALL "ZZCRYP",X3$,K$,"","U",X$,X{ALL},C9$,X9; IF X9=0 THEN IF ATH(X$(11,10))=A8$(X,5) OR (ATH(X$(11,10))="EF370" AND A8$(X,4)="EFJF") THEN A9$=A9$+A8$(X,5); PRINT ".", ELSE PRINT "!",; S0$(64,3)=""
3445 GOTO 3480
3475 PRINT "*",; S0$(64,3)=""
3480 NEXT X; A8$=A9$
3485 GOSUB 8800
3490 RETURN 
3500 REM "INSTALL
3502 IF POS("MS"=SYS)=1 THEN X3$(77,1)="D"; REM "Check for MS only to cover both Dos and Windows version under "+             "the D type
3503 PRINT @(0,18),
3505 REM " LET P7$="TF.INST"; IF X3$(77,1)="D" THEN IF POS("7."=SYS)<>0 THEN SYSTEM "COPY TFINSTAL UTILS\TFINSTAL"; LET P7$="TFINSTAL"; GOTO 03511 ELSE LET P7$="TFINSTAL"
3510 REM " IF POS("MS W"=SYS)<>1 THEN SYSTEM "CP TF.INST UTILS"-> NOT NEEDED IF HIEARCHARL DIR EXISTS ON  DISK 10 AS IT SHOULD
3512 CALL "ZZTFNM",P7$
3515 PRINT @(0,18),'CL'
3520 CLOSE (14); OPEN (14,ERR=9900)P7$
3530 CALL "ZZINST",ERR=3550,Z8$,0,0,V0$,Z7$,A0$; V9$="INSTALL"
3535 V0$="@"+STR(S8); CALL "ZZINST",V0$,0,0,"","",""
3540 RETRY 
3550 REM "Incorrect tape for this ssn
3560 PRINT @(0,3),'CE',@(0,5),"This release tape is not the correct tape fo"+"r your system.",@(0,7),"Release tape SSN: ",Z7$," for ",Z8$
3580 INPUT 'LF','LF',"Press Enter to continue: ",*
3590 GOTO 9900
4000 REM "UNMATCHED SSNS
4005 PRINT @(0,3),'CE',; CALL "ZZVDTP",X3$,"ZSTART","*","",0
4010 PRINT @(0,3),'CL',; FOR X=5 TO 11; PRINT @(1,X),S$(1,78),; NEXT X; CALL "ZZVDTP",X3$,"ZSTRTX","","",.1; PRINT @(0,22),'CE',
4020 PRINT 'CI','RB',; WAIT 1; PRINT 'RB',; GOSUB 6200
4040 GOSUB 3300; GOTO 0010
4410 RUN "ZSTART"
4500 REM "UNIX GET LOGNAME
4501 REM X3$(85,1)="7"
4520 O9$=""; CALL "ZSTRTU",X3$,P$,T9$,""; IF P$="" THEN IF X3$(77,1)<>"D" THEN GOTO 4590
4530 P$=P$+S$,P$=P$(1,8),O9$=P$(1,3),Q0$=""; EXTRACT (6,KEY="OLS"+P$,DOM=4550)Q0$; I6=IND(6)
4540 O9$=Q0$(12,3),P$=O9$,X3$(32,6)=STR(I6:"000000")
4545 CALL "ZSTRTO",X3$,Q0$,6,I6
4550 REM "OPERATOR CODE
4555 DIM P6$(255); READ (6,KEY="osec",DOM=4556)P6$
4580 P$=O9$,O9$=""; EXTRACT (6,KEY="o"+P$,DOM=4590)P$; O9$=P$(2,3)
4595 RETURN 
5000 REM "Operator code
5002 GOSUB 4500; READ (6,KEY="o",DOM=5003)
5003 IF X3$(32,6)<>S$(1,6) THEN O1$=""
5004 IF O9$>"" AND U6=0 THEN IF O1$<>"&" THEN GOTO 5220
5005 IF FID(0)<>T0$ THEN GOSUB 8500
5010 O=0
5020 READ (6,KEY="o",DOM=5021)
5030 READ (6,END=5090)Q$; IF Q$="" THEN GOTO 5090 ELSE IF Q$(1,1)<>"o" THEN GOTO 5090
5040 GOSUB 2900; GOSUB 5100
5050 REM "
5090 RETURN 
5100 REM "
5110 O=-1,S9=0
5120 PRINT @(0,3),'CE',
5125 GOSUB 7800
5140 IF S9>2 THEN GOTO 5300 ELSE DIM O$(12)
5160 CALL "ZZENTR","ST",X{ALL},O$,X4$,X3$,40,10,1,3,C0,"","","","ZSTART01","","",""; IF C0=10 THEN GOTO 5390
5180 CALL "ZZENTR","SPUT",X{ALL},O$,X4$,X3$,40,12,4,6,C0,"","","","","","",""
5185 IF C0=2 THEN GOTO 5160 ELSE O=O+1
5200 REM 
5205 S9=S9+1
5210 DIM P$(200); READ (6,KEY="o"+O$(1,3),DOM=5140)P$(1)
5215 DIM P6$(255); READ (6,KEY="osec"+O$(1,3),DOM=5216)P6$
5220 IF FNS$(O$(4,6))<>FNS$(P$(35,6)) THEN GOTO 5140
5290 GOTO 5400
5300 REM "
5310 CALL "ZZPROM",".X1ZSTART",X3$,A,"","","",0
5390 RUN "ZZEND"
5400 REM "
5450 REM "
5452 IF LEN(P$)>94 THEN X3$(160,2)=P$(94,2)
5455 X3$(40,3)=P$(2,3),X3$(43,2)=P$(41,2),X3$(45,1)=P$(57,1),X3$(140,3)=P$(51,3),X3$(154,6)=P$(65,6),X3$(51,1)=P$(58,1),X3$(172,6)=P$(59,2),X3$(162,1)=P$(61,1),X3$(47,1)=P$(64,1)
5456 IF LEN(P$)>61 THEN X3$(197,1)=$FF$,X3$(197,1)=CHR(100+NUM(P$(62,2),ERR=5457))
5457 IF S0$(84,1)<>"1" THEN X3$(9,3)="001"
5458 Q$=X3$(9,3); IF P$(54,3)<>"   " THEN Q$=P$(54,3)
5460 CALL "ZZMNUC",X3$,X4$,Q$,N1$
5465 IF POS(X3$(40,3)="   csiCSISYS",3)=0 THEN READ (6,KEY=X3$(9,3)+"R/T",DOM=5466)J9$; IF J9$(7,1)<>"H" THEN X3$(45,1)="0",X3$(51,1)="0",X3$(140,3)="R/T"; CALL "RT2AUT",X3$,AUTH_CODE; IF AUTH_CODE<>0 THEN RELEASE END_IF ; D0$=FID(0)+"DATE"; REMOVE (6,KEY=D0$,DOM=5466); REM "If not csi or sys operator, if Remote T/M exists and this i"+                "s a remote, then restrict DIRect menu and option access and"+                " put R/T as 'MAIN' menu, remove the date record to force "+                "the entry of a date the first time"
5475 IF P$(1,1)="o" THEN IF S0$(75,1)<>"2" THEN X3$(239,1)=P$(71,1),L0$=X3$(239,1); CALL "ZZLANG",X3$,L0$; GOSUB 7500
5478 IF P$(1,1)="o" THEN IF P$(72,2)<>"00" THEN Q$=P$(72,2); GOSUB 8200
5480 IF P$(1,1)="o" THEN GOSUB 7600; GOSUB 8000
5490 RETURN 
6000 REM "COMMERCIAL
6001 RETURN 
6005 IF S9<>PSZ THEN GOTO 4400 ELSE PRINT (0,ERR=6500)@(3,3),'CE',
6010 CALL "ZZVDTP",ERR=6011,X3$,"ZSTART","*",Q$,0; IF Q$>"" THEN Q$=""; GOTO 6220
6030 PRINT (0,ERR=6031)@(18,4),'BB',
6040 PRINT @(19,4),"*** PROPRIETARY SOFTWARE NOTICE ***"
6045 PRINT (0,ERR=6046)'EB'
6110 P=7
6120 PRINT @(P,7),"This software product is the  sole and  exclusive proper"+"ty of"
6130 PRINT @(P,8),N2$,".  All rights to its use are granted pursuant"
6140 PRINT @(P,9),"to the user having executed a Software License Agreement."
6150 PRINT @(P,11),"This is an unpublished work containing trade secrets and"
6160 PRINT @(P,12),"proprietary information of ",N2$,".  This product"
6170 PRINT @(P,13),"may not be distributed, reproduced, or transmitted in a"+"ny"
6175 PRINT @(P,14),"item to any party without the prior written permission "+"of"
6180 PRINT @(P,15),N2$,"."
6190 PRINT @(P,18),"Copyright 1985,1986,1987 ",N2$,";  Norcross, Georgia."
6195 PRINT @(P+14,19),"All Rights Reserved."
6200 REM 
6210 PRINT (0,ERR=6211)'EB'
6220 D0=1; IF POS("G"=FID(0))=1 THEN D0=0
6225 IF D0>0 THEN CLOSE (D0); OPEN (D0)FID(0)
6230 Q$=FNS$(L0$(58,40)); PRINT @(46-LEN(Q$)-2,22),Q$,":",@(46),
6240 PRINT (0)'CI',; READ RECORD (D0,TIM=60,SIZ=1,ERR=6241)Q$; GOTO 6246
6245 RUN "ZZEND"
6246 IF POS(Q$="uU")>0 THEN U6=1,Q$=" "
6250 IF Q$="*" THEN GOTO 7000 ELSE IF POS(Q$="Xx")>0 THEN CALL "ZZDROP",ERR=9900; GOTO 9900 ELSE T0$=FID(0); IF Q$=":" THEN T0$=FID(0)+"D"
6251 IF Q$=$15$ THEN GOSUB 3300 ELSE PRINT @(0,21),'CE',
6252 IF Q$="&" THEN O1$="&" ELSE IF POS(Q$=": ?#")=0 THEN PRINT 'RB',; GOTO 6230
6253 IF Q$="?" THEN CALL "ZZWHOS"; GOTO 9920 ELSE IF Q$="#" THEN GOSUB 6900; GOTO 6740
6255 CALL "ZZPROM","X0ZSTART",X3$,0,"","","!",0
6260 WAIT 1
6270 IF T0$>"" THEN IF T0$<>FID(0) THEN OPEN (10,ISZ=1,ERR=2960)T0$; WRITE RECORD (10,IND=0)$01$; CLOSE (10)
6290 RETURN 
6310 READ RECORD (D0,SIZ=1)Q$
6320 EXITTO 0600
6505 PRINT (0,ERR=6506)'CS','RB',@(0,10),; GOTO 6510
6507 FOR X=0 TO 22; PRINT ""; NEXT X
6510 PRINT "** The terminal mnemonics are not set correctly or the configur"+"ation of",'LF',"   the terminal type is incorrect.  Refer to installa"+"tion and setup",'LF',"   sections of the TopForm documentation."
6520 BEGIN 
6550 DELETE 0001,9999
6560 GOTO 9900
6600 REM "TERMINAL TYPE
6605 SETERR 6800; CLOSE (6); OPEN (6)"ZZPARM"; SETERR 9000
6610 X3$(198,1)="0"; READ (6,KEY="GRCTRL",DOM=6690)Q$
6615 IF X$>"" THEN GOTO 6635
6618?IF POS("7."=SYS)<>0 THEN LET T1$="TCONFIG" ELSE DIM TEMP$[1]; DUMP IPLDEVS (TEMP$[ALL]); FOR TEMP=1 TO 50; IF POS("tty"=TEMP$[TEMP])<>0 OR POS("CON"=TEMP$[TEMP])<>0 THEN IF POS("Non-win"=TEMP$[TEMP])<>0 THEN LET T1$="TCONFIG8" ELSE LET T1$="TCONFIGW" FI; EXITTO 06619 FI; NEXT TEMP
6620 CLOSE (2); OPEN (2,ERR=6690)T1$; READ RECORD (2,KEY="        ")X$; CLOSE (2)
6625 IF T9$>"" THEN X$=T9$(1,8); GOTO 6640
6630 Q=POS(FID(0)=X$(3),10); IF Q=0 THEN GOTO 6690 ELSE X$=X$(Q+4,8)
6635 Q=POS(X$=Q$(8,6*8),8); IF Q>0 THEN Q=INT(Q/8); X3$(198,1)=STR(Q)
6640 FIND (6,KEY="GR"+X$+" ",DOM=6650)Q$; GOTO 6660
6650 X3$(198,1)="0"; FIND (6,KEY="GRMISC    "+" ",DOM=6680)Q$
6660 X3$(235,1)="-"; SETERR 6661; X3$(235,1)=ATH(Q$(158,2)); X3$(236,1)=X3$(235,1); IF Q$(180,2)<>"00" THEN X3$(236,1)=ATH(Q$(180,2))
6665 SETERR 9000
6680 DIM Q$(357); FIND (6,KEY="TCTL"+X$,DOM=7000)Q$(1); Q$=Q$(13)
6690 RETURN 
6700 REM "TERMINAL TYPE
6704?IF POS("7."=SYS)<>0 THEN LET T1$="TCONFIG" ELSE DIM TEMP$[1]; DUMP IPLDEVS (TEMP$[ALL]); FOR TEMP=1 TO 50; IF POS("tty"=TEMP$[TEMP])<>0 OR POS("CON"=TEMP$[TEMP])<>0 THEN IF POS("Non-win"=TEMP$[TEMP])<>0 THEN LET T1$="TCONFIG8" ELSE LET T1$="TCONFIGW" FI; EXITTO 06705 FI; NEXT TEMP
6705 CLOSE (6); OPEN (6)"ZZPARM"
6706 CLOSE (14); OPEN (14,ERR=9800)T1$
6710 READ (6,KEY="PRINTERS",DOM=6711)*,Q0$,Q1$,Q2$; P=POS(FID(0)=Q0$,2); IF P>0 THEN P=INT(P/2)+1; IF LEN(Q2$)>=P THEN X3$(85,1)=Q2$(P,1)
6715 IF X3$(85,1)="?" THEN GOSUB 6900; GOTO 6740 ELSE REM IF X3$(85,1)<>"7"RETURN
6720 CALL "ZSTRTU",X3$,P$,T9$,""; P$=P$+S$(1,8),P$=P$(1,8); IF T9$>"" THEN IF T9$(9,1)="1" THEN GOSUB 6900; T9$=T$+"0" ELSE X$=T9$(1,8)
6723 CLOSE (14); OPEN (14)T1$; IF Q0$(101,1)="?" THEN GOSUB 6900
6725 FIND (6,KEY="OLS"+P$,DOM=6740)Q0$; P$=Q0$(12,3),O9$=P$
6730 CLOSE (14); OPEN (14)T1$; IF Q0$(101,1)="?" THEN GOSUB 6900
6735 REM IF Q0$(101,8)=S$(1,8) THEN GOTO 06790
6736 IF Q0$(101,8)<>S$(1,8) THEN X$=Q0$(101,8)
6740 IF X$="" THEN GOTO 6795 ELSE READ RECORD (14,KEY=X$,DOM=9800)T$
6750 IF POS("7."=SYS)<>0 THEN T$=T$(29+DEC(T$(29,2))),T$=T$(3,DEC(T$(1,2))-2); IF T$<>"" THEN PRINT (0,ERR=9800)'SL',HTA(T$),'EL',
6760 IF POS("8."=SYS)<>0 THEN T$=T$(29+DEC(T$(29,2))),T$=T$(7,DEC(T$(5,2))); IF T$<>"" THEN PRINT (0,ERR=9800)'SL',HTA(T$),'EL',
6790 T$="",P$="",O9$=""
6795 IF X3$(85,1)="7" AND Q0$="" THEN GOTO 9800 ELSE RETURN 
6800 REM "DEFINE PARM FILE
6805 IF ERR<>12 THEN E0=ERR,E0$="open"; GOTO 6830
6815 OPEN (6,ERR=6820)"ZYPARM"; F$=FID(6); D=ASC(F$(20)); CLOSE (6); RENAME "ZZPXXX","ZZPARM"; WAIT 2; RETRY 
6820 DIRECT "ZZPARM",12,100,1024,D,0,ERR=6822; RETRY 
6822 E0=ERR,E0$="Define"
6830 PRINT @(0,22),'CL',@(5),"Unable to ",E0$," parameter file - Error ",E0,; INPUT *; START 10
6905 CLOSE (14); OPEN (14)T1$
6910 FOR X=0 TO 25; PRINT ""; NEXT X
6914 IF T9$>"" THEN PRINT "Default terminal type is ",T9$(1,8)
6915 INPUT "Enter your terminal type or press Enter to use the default:",T$; IF T$="END" THEN GOTO 9900 ELSE IF T9$>"" THEN IF T$="" THEN T$=T9$(1,8)
6920 T$=T$+S$,T$=T$(1,8)
6930 READ (14,KEY=T$,DOM=6915)
6935 IF X3$(85,1)="7" THEN Q0$(101,8)=T$ ELSE X$=T$
6940 FOR X=1 TO 25; PRINT ""; NEXT X
6945 RETURN 
7000 REM "CONTROL SETTINGS
7030 CALL "ZZCTRL",X3$,X4$,M1$,M2$
7090 GOTO 0010
7200 REM "PREFERENCES
7220 CALL "ZZXPRA",ERR=7221
7230 GOTO 7090
7300 REM "NUMBER OF USERS
7302 SETERR 7308
7305 CALL "ZZUSER",X3$,"","CSI",U,Q; IF U>0 THEN U0$=STR(U:"000"); RETURN 
7308 SETERR 7310; IF U=0 THEN CALL "ZZUSER","","!*","CSI",1,0; GOTO 7305
7310 GOTO 7500; REM " PRINT @(0,3),'CE',; CALL "ZZVDTP",ERR=07311,X3$,"ZSTRTU","",V0$,1
7315 Q$="___"; P=POS(Q$=V0$); IF P=0 THEN GOTO 7350
7320 V0$(P,3)=STR(U:"**0"); GOTO 7315
7350 PRINT @(0,3),V0$,
7390 PRINT @(0,20),; GOTO 9940
7480 IF P$(1,4)<>"    " THEN GOSUB 7600
7500 REM "
7530 REM FOR X=0 TO 2;P=1+(POS(X3$(70+X,1)=X3$(56,3))-1)*2;X3$(80+X,1)=STR(P:"0");NEXT X
7540 X3$(31,1)="0"; CLOSE (4); OPEN (4,ERR=7541)X3$(32,4); Q$=FID(4); IF LEN(Q$)>2 THEN X3$(31,1)=STR(ASC(Q$(20,1)))
7590 RETURN 
7600 REM "
7605 GOTO 7645; REM "IF X3$(77,1)=" " OR S0$(8,1)="?" THEN GOTO 07645
7608 GOSUB 7900
7610 PRINT @(0,3),'CE',; CALL "ZZVDTP",ERR=7611,X3$,"ZSTRTA","*","",0
7612 PRINT 'SF'
7613 V8$=V0$; V8$="440"
7615 PRINT @(22,4),S0$(8,39),@(22,5),S0$(47,9),@(22,6),V8$,@(57,5),S0$(56,8),@(57,6),S0$(72,1),"-",U," USER",'SF',
7620 X$=FNS$(L0$(138,40)); PRINT @(39-INT(LEN(X$)/2),8),X$,
7625 PRINT @(29,10),FNS$(P$(5,30))," (",P$(2,3),")",
7626 CALL "ZZDISP","D",P$(76,6),"",X3$,"","",29,11,X4$
7627 CALL "ZZDISP","T",P$(82,4),"",X3$,"","",42,11,X4$
7630 GOSUB 7700
7645 RETURN 
7700 REM "MESSAGE OF THE DAY
7705 GOTO 7790; REM "IF X3$(77,1)=" " THEN GOTO 07790 ELSE LET T0=0, X3$(185,1)="*", F0=NUM(X3$(60,3))
7708 PRECISION 6; T=RND(-TIM); SETERR 7709; T$=STR(RND(1)*100000:"000000"),T=NUM(T$); GOTO 7720
7710 PRECISION 6; T$=STR(10000*FPT(TIM)+3:"000000")
7711 SETERR 7713
7712 T$=STR(1000000*RND(1):"000000"),T=NUM(T$); SETERR 9000; GOTO 7720
7713 PRECISION 2; SETERR 9000
7715 X$=""; FOR X=6 TO 3 STEP -1; X$=X$+T$(X,1); NEXT X; T$=X$; T=NUM(X$)
7720 CLOSE (F0); OPEN (F0,ERR=7790)"ZMS"
7725 CALL "ZZINFO",F0,X0,X3$,R0,R1,0,0,0,0,0,""
7728 CLOSE (F0); OPEN (F0)"ZMS"
7730 R0=MOD(T,R0); T$=STR(R0:"000000")
7735 T0=T0+1; READ (F0,KEY=T$,DOM=7736)T$; GOTO 7740
7736 IF T0<10 THEN GOTO 7710
7738 READ (F0,END=7790)T$
7745 FOR X=0 TO 6
7750 PRINT @(12,X+14),T$(7+X*60,60),
7755 NEXT X
7780 CALL "ZZPROM","4 ZSTART",X3$,Q,"","","*",0; ON Q GOTO 7781,7708
7790 SETERR 9000; RETURN 
7800 REM 
7820 FOR X=0 TO 1; Q$=FNS$(L0$(98+X*20,20)); PRINT @(37-LEN(Q$),10+X*2),Q$,":",; NEXT X
7840 RETURN 
7900 REM "CHECK VERSION
7910 CALL "ZZ2VER",ERR=9900,V0$,"",""
7945 RETURN 
7950 REM "Set S8 to correct serial number
7955?LET S8=SSN
7960 IF POS("MS"=SYS)=1 THEN CALL "ZZNTSN",X3$,SSN,FLAG$,MASTER_SSN; IF FLAG$="Y" THEN S8=MASTER_SSN
7995 RETURN 
8000 REM "CK FOR MESSAGES
8010 CLOSE (7,ERR=8095); OPEN (7,ERR=8095)"ZZM"; READ (7,KEY=X3$(40,3),DOM=8011)
8020 READ (7,END=8090,ERR=8090)K$; IF K$(1,3)=X3$(40,3) THEN IF K$(620,1)="1" OR K$(60,6)>X3$(21,6) THEN GOTO 8020 ELSE CALL "ZZSETM",X3$+"  ",K$(1,3),"+"; X3$(200,1)="M"
8095 CLOSE (7); RETURN 
8200 REM "Set preferences data
8205 READ (6,KEY="PRF"+Q$,DOM=8206)P5$; GOTO 8210
8207 IF Q$="00" THEN GOTO 9900 ELSE Q$="00"; GOTO 8200
8210 X3$(38,2)=P5$(4,2),X3$(46,1)=P5$(105,1),X3$(59,1)=P5$(37,1),X3$(67,1)=P5$(38,1),X3$(68,1)=P5$(39,1)
8215 X3$(78,1)=P5$(104,1),X3$(79,1)=P5$(106,1),X3$(126,1)=P5$(40,1),X3$(127,1)=P5$(41,1),X3$(83,1)=P5$(102,1),X3$(84,1)=P5$(103,1),X3$(280,30)=P5$(42,30)
8220 X3$(48,1)=P5$(36,1)
8225 X3$(80,3)="513"; IF X3$(48,1)="2" THEN X3$(80,3)="531" ELSE IF X3$(48,1)="3" THEN X3$(80,3)="135"
8230 IF X3$(48,1)="1" THEN X3$(56,3)=X3$(71,1)+X3$(72,1)+X3$(70,1) ELSE IF X3$(48,1)="2" THEN X3$(56,3)=X3$(72,1)+X3$(71,1)+X3$(70,1) ELSE IF X3$(48,1)="3" THEN X3$(56,3)=X3$(70,1)+X3$(71,1)+X3$(72,1)
8240 Q=0,L=0,L9=0,Q$=""; FOR X=0 TO 29; IF P5$(72+X,1)=" " THEN EXITTO 8250 ELSE IF P5$(72+X,1)="." THEN Q=Q+1 ELSE Q$=Q$+STR(Q),Q=0,L=L+1
8242 IF P5$(72+X,1)="?" THEN L9=X+1
8245 NEXT X
8250 X3$(310,20)=CHR(100+L)+CHR(100+L9)+Q$
8290 RETURN 
8300 REM "FILE DATA
8310 X=1
8315 Q$=FID(X,ERR=8316); GOTO 8320
8316 IF ERR=41 THEN X3$(60,3)=STR(X-1:"000"); GOTO 8330
8320 X=X+1; IF X>25 THEN X3$(60,3)="025"; GOTO 8340 ELSE GOTO 8315
8330 X3$(60,3)="014"
8340 RETURN 
8505 X3$(169,3)=FID(0)
8510 CALL "ZZDEMO",ERR=0010,X3$,2,0,"",M0
8580 X3$(169,3)=T0$
8590 RETURN 
8700 REM "GHOST TASK STARTUP
8710 F0=NUM(X3$(60,3)); CLOSE (F0)
8720 OPEN (F0,ERR=8721)"G0"; CLOSE (F0); GOTO 8740
8725 IF ERR<>13 THEN GOTO 8750
8730 START 10,ERR=8760,"ZGHOST","G0"
8745 RETURN 
8755 Q$="+("+STR(ERR)+")"
8760 CALL "ZZPROM","G0ZSTART",X3$,0,Q$,"","",0
8790 RETURN 
8800 REM "CHECK SECURE PROGRAMS
8801 SETERR 9000
8802 PRINT @(0,22),'CE',@(12),"Checking protect mode: ",
8803 IF POS("8."=SYS)<>0 THEN L8=13 ELSE L8=1
8805 X$=""; CLOSE (14); OPEN (14)"ZS1"
8810 READ (14,END=8811)Q$; IF Q$(18,1)="1" THEN X$=X$+Q$(1,8)+"  "; GOTO 8810 ELSE GOTO 8810
8815 IF X$="" THEN GOTO 8825 ELSE Q=0; FOR X=1 TO LEN(X$) STEP 10
8820 CLOSE (14); X$(X+8,1)="0"; OPEN (14,ERR=8821)X$(X,8); READ RECORD (14,ERR=8821)Q$; IF Q$(L8,1)=$80$ THEN X$(X+8,1)="" ELSE Q=Q+1
8822 IF X$(X+8,1)=" " THEN PRINT ".", ELSE PRINT "!",
8825 NEXT X
8830 IF Q=0 THEN RETURN ELSE CALL "ZZPROM","X2ZSTART",X3$,Q,"","","",0; ON Q GOTO 8831,9900
8835 PRINT @(0,3),'CE',
8840 FOR X=1 TO LEN(X$) STEP 10
8845 PRINT X$(X,8),"   ",X$(X+8,1)
8850 NEXT X
8860 CALL "ZZPROM","4",X3$,0,"","","",0
8865 PRINT @(0,3),'CE',
8870 RETURN 
8880 GOTO 9900
8910 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
9001 ESCAPE 
9005 IF POS(STR(ERR:"000")="064065069",3)>0 THEN GOSUB 7800; SETERR 9000; RETRY 
9010 IF ERR=67 THEN GOTO 0010
9040 IF ERR=29 THEN GOTO 6500
9350 GOTO 9900
9840 RELEASE 
9900 REM 
9910 PRINT @(0,3),'CE',
9920 PRINT 'LF',"** Topform(R) Startup Program Terminated **"
9940 BEGIN 
9999 END 
