0010 REM "Text Processing Module <ZZTEXT>
0030 REM "(C) 1985,1986,1987 Basic Ideas, Inc; Atlanta, Ga.
0035 REM "This software contains trade secrets and proprietary information"
0120 DIM S$(12); SETERR 9000
0121 SETERR 0000
0210 DEF FNS$(Q$)=Q$(1,POS("  "=Q$+"  ")-1)
0310 IOLIST @(12,23),"Press ",FNS$(C0$(353,8))," for Editor Key Data; ",FNS$(C0$(313,8))," to End Editor",@(0,22)
0380 IOLIST B$
0390 IOLIST @(0,23),'CL',@(0,22),'CL',IOL=0310
0600 DIM S$(20),V2$(0)
0605 W0=80,W1=19,W2=240,B0$="",R5$=CHR(192),D0=1,C9$=""
0606 W2=240,Z7$="ZZ2ASS"
0607 W0=20,W1=5
0610 IF V0$="" THEN DIM V0$(W0*W1); IF A$(61,1)="R" THEN GOSUB 8100
0612 IF LEN(V0$)<W0*W1 THEN V0$=V0$+" "; GOTO 0612
0620 GOSUB 5800
0640 GOSUB 6900
0940 X0=1+R0*W0,X=0,Y=3+R0,R1=X0; IF A$(61,1)="H" THEN R1=1,X0=R1,Y=3
0950 GOTO 1000
0990 PRINT IOL=0310
0995 PRINT 'RB',
1000 REM "ENTER NEXT CHARACTER
1010 PRINT 'SB',
1015 IF C0>0 THEN PRINT 'CI',
1075 IF D0>0 THEN PRINT @(70,0),"(",X:"#0",",",Y:"#0",")",
1080 IF Y<=21 THEN PRINT @(X,Y), ELSE Y=21; GOTO 0990
1120 READ RECORD (Z[9],SIZ=1)Q$
1130 IF Q$=$10$ THEN CALL "ZZSCRN",ERR=1000,X3$,X4$; GOTO 1000
1140 GOSUB 8000; IF C8$>"" THEN IF POS(C$=C8$,2)=0 THEN GOTO 0990
1150 IF C0>=0 THEN GOTO 1200
1155 IF Q$=$08$ THEN C0=1; GOTO 1200
1160 IF POS(CHR(X)+CHR(Y)=B0$,2)>0 THEN GOTO 0990
1165 IF Q$<CHR(32) THEN GOTO 0990
1170 IF LEN(V0$(X0))>W0 THEN IF Q$="-" AND X=0 AND POS(" "<>V0$(X0,W0))=0 THEN Q$="-80"; GOTO 3400
1180 V0$(X0,1)=Q$; PRINT @(X,Y),Q$,
1185 X0=X0+1
1190 GOTO 1555
1200 REM "CONTROL
1220 ON C0 GOTO 4000,1400,1420,1440,1460,1480,1500,1600,1600,1900,2000,2100,2200,2600,3000,3100,3300,3500,3600,3700,3800,3900,3950,4600,0990
1400 REM "LEFT 1 CHAR
1405 IF X0>R1 THEN X0=X0-1; GOTO 1550 ELSE GOTO 0990
1420 REM "RIGHT 1 CHAR
1425 IF X<W0 THEN X0=X0+1; GOTO 1550 ELSE GOTO 0990
1440 REM "UP 1 LINE
1445 IF X0>W0+R1-1 THEN X0=X0-W0; GOTO 1550 ELSE GOTO 0990
1460 REM "DOWN 1 LINE 
1465 IF Y-3<W1-1 THEN X0=X0+W0; GOTO 1550 ELSE GOTO 0990
1480 X0=INT(X0/W0)*W0+1; GOTO 1550
1500 REM "POSITION
1505 Q$="     "
1515 PRINT @(0,22),"Enter the screen position in an X,Y or X only format:",
1520 CALL "ZZENTR","SX",A{ALL},Q$,X4$,X3$,54,22,1,5,C0,"","","ENTER THE SCREEN POSITION AS XX OR XX,YY","","","",""; PRINT @(0,22),'CL',; IF C0<0 THEN GOTO 1000
1525 Q$=FNS$(Q$),Q=NUM(Q$,ERR=1526); IF Q>=0 AND Q<W0 THEN X0=(Y-3)*W0+Q+1; GOTO 1550 ELSE GOTO 0990
1530 P=POS(","=Q$); IF P=0 THEN GOTO 0990 ELSE Q0=NUM(Q$(1,P-1),ERR=0990),Q1=NUM(Q$(P+1),ERR=0990)
1535 IF Q0<0 OR Q0>=W0 OR Q1<3 OR Q1>W1 THEN GOTO 0990
1540 X0=Q0+(Q1-3)*W0+1; GOTO 1550
1550 REM "AFTER CURSOR POSITIONING CONTROL KEYS...
1555 Y=INT((X0-1)/W0),X=X0-Y*W0-1,Y=Y+3
1560 IF C9$="" THEN GOTO 1000
1580 ON POS(C9$="A") GOTO 1840
1600 REM "ATTACH SCREEN
1605 GOSUB 6500
1610 P$="ATTACH"; IF C0=8 THEN P$="COPY"
1615 DIM A[4,2]; A[0,0]=X0,A[1,0]=1,A[2,0]=1,C9=C0,A1=1,C9$="A",E3=0,P8=X,P9=Y
1616 IF V0$(X0,1)<>" " THEN P=POS("  "=V0$(X0+1)+"  "); A[1,0]=P
1620 GOSUB 6100; GOSUB 6000
1625 READ RECORD (Z[9],SIZ=1)Q$
1630 GOSUB 8000
1635 IF C0=9 THEN GOTO 1700 ELSE IF POS(STR(C0:"00")="01020304",2)=0 THEN PRINT 'RB',; GOTO 1630
1645 P=POS(STR(C0:"0")="13X24")-3,A1=1; IF P<0 THEN A1=0; IF P=-3 THEN PRINT 'RB',; GOTO 1630
1650 Q2=A[0,0]+A[1,0],Q0=1,Q1=A[2,0]
1655 IF C0=2 THEN IF X+A[1,0]>W0 THEN GOTO 1680 ELSE A[1,0]=A[1,0]+1
1660 IF C0=1 THEN IF A[1,0]=0 THEN GOTO 1680 ELSE A[1,0]=A[1,0]-1,Q2=Q2-1
1665 IF C0=3 THEN IF A[2,0]<=1 THEN GOTO 1680 ELSE A[2,0]=A[2,0]-1,Q2=Q2-A[1,0]+A[2,0]*W0,Q1=1,Q0=A[1,0]
1670 IF C0=4 THEN IF A[2,0]>W1-1 THEN GOTO 1680 ELSE Q2=Q2-A[1,0]+A[2,0]*W0,A[2,0]=A[2,0]+1,Q1=1,Q0=A[1,0]
1675 CALL Z7$,X3$,A1$,Z[8],W0,W1,V0$,Q2,Q0,Q1,A1,V1$,V2$,0,0,0,0,W2,0,0,X4$
1678 GOTO 1625
1680 PRINT 'RB',; GOTO 1625
1690 GOTO 1625
1700 P$="MOVE"; GOSUB 6100
1705 IF A[1,0]=0 THEN V1$=W9$; GOSUB 6720; GOTO 1940
1720 REM "SET MOVE PIECE
1725 P1$=""
1730 FOR P=0 TO A[2,0]-1
1735 P1$=P1$+V0$(A[0,0]+P*W0,A[1,0])
1740 IF C9=7 THEN V0$(A[0,0]+P*W0,A[1,0])=""
1745 NEXT P
1750 GOSUB 6800
1800 REM "MOVE SCREEN PIECE P1$ AROUND
1810 C8$="010203040506091819",S0=A[0,0],S1=A[1,0],S2=A[2,0]
1820 GOTO 1000
1840 REM "RESTORE CURRENT SCREEN
1850 A1=0; GOSUB 6000
1860 A[0,0]=X0
1870 REM "PAINT P1$ PICTURE
1875 CALL Z7$,X3$,A1$,Z[8],S1+0,S2+0,P1$,1,S1,S2,1,V1$,V2$,X,Y-3,E2,E3,W2,0,0,X4$
1880 GOTO 1820
1900 REM "DEPOSIT MOVED SCREEN PIECE
1902 IF C9$="" THEN GOTO 0990 ELSE E4=0; FOR P=0 TO S2-1; E4=E4+POS(R5$=V0$(X0+P*W0,S1)); NEXT P
1905 IF E4>0 THEN CALL "ZZPROM","Y",X3$,S,"Data fields reside within these co-ordinates. Continue?","","",0
1910 P$="WAIT"; GOSUB 6100
1920 FOR P=0 TO S2-1
1925 V0$(X0+P*W0,S1)=P1$(P*S1+1,S1)
1930 NEXT P
1935 GOSUB 6600
1940 P$="",A1=0; GOSUB 6100
1980 C8$="",C9$="",P1$=""
1990 GOTO 1550
2000 REM "DELETE LINE
2090 GOTO 1000
2100 REM "INSERT LINE
2190 GOTO 0100
2200 REM "INSERT TEXT
2390 GOTO 1550
2600 REM "DELETE TEXT
2690 RETURN 
3000 REM "CLEAR TO END
3010 FOR P=0 TO W0-X-1
3015 IF V0$(X0+P,1)<>" " THEN V0$(X0+P,1)=""; IF POS(CHR(X+P)+CHR(Y)=B0$,2)=0 THEN PRINT @(P+X,Y)," ",
3020 NEXT P
3090 GOTO 1000
3100 REM "END EDITOR
3270 IF POS(" "<>G0$)=0 THEN G0$=""
3280 L0=1,V2$=""
3290 GOTO 9800
3300 REM "REPEAT CHARACTER
3305 DIM Q$(3)
3310 PRINT IOL=0390,@(0,22),"ENTER THE CHARACTER TO REPEAT OR 'CR':",@(42),"ENTER THE NUMBER OF CHARS: ",
3340 CALL "ZZENTR","SX",A{ALL},Q$,X4$,X3$,40,22,1,1,C0,"","","ENTER THE CHARACTER TO REPEAT OR PRESS RETURN TO ABORT","","","",""
3345 IF C0<0 THEN GOTO 3480
3380 CALL "ZZENTR","Z",A{ALL},Q$,X4$,X3$,69,22,2,2,C0,"","","ENTER THE NUMBER OF TIMES TO REPEAT OR RETURN TO ABORT","","","",""
3390 IF ABS(C0)=2 THEN GOTO 3340
3400 REM "PUT IN REPEAT CHAR
3410 DIM Q$(NUM(Q$(2,2),ERR=3480),Q$(1,1))
3420 V0$(X0,LEN(Q$))=Q$
3430 PRINT @(X,Y),Q$,
3450 REM "
3480 REM "
3485 PRINT IOL=0390
3495 GOTO 1000
3500 REM "HELP SCREEN
3520 CALL "XZCTRL",X3$,X4$,C0$,""
3530 GOSUB 5800
3590 GOTO 1000
3600 REM "SET/RELEASE TABS
3610 C$=STR(X:"00"),C=POS(C$=T0$,2)
3615 IF C=0 THEN PRINT @(X,2),"+",; C=POS(C$<=T0$,2); IF C=0 THEN T0$=T0$+C$; GOTO 1000 ELSE T0$=T0$(1,C-1)+C$+T0$(C); GOTO 1000
3620 T0$=T0$(1,C-1)+T0$(C+2); PRINT 'BG',@(X,2),X3$(235,1),'EG',; GOTO 1000
3700 REM "TAB OVER
3710 C$=STR(X:"00"),C=POS(C$<T0$,2); IF C=0 THEN GOTO 0990 ELSE C=NUM(T0$(C,2))-X; X0=X0+C; GOTO 1550
3800 REM "RETURN
3810 X0=(Y-2)*W0+1; GOTO 1550
3900 REM "NEXT WORD
3910 IF V0$(X0,1)<>" " THEN P=POS("  "=V0$(X0)+"  ") ELSE P=POS(" "<>V0$(X0))-1
3920 X0=X0+P; GOTO 1550
3950 IF D0<>0 THEN D0=0 ELSE D0=1
3960 IF D0=0 THEN PRINT @(70,0),'CL',
3990 GOTO 1000
4000 REM "Special Function DISCONNECTED NOW
4020 GOTO 1000
4400 REM "GET RID OF RESERVE POSITIONS
4410 Q$=B$(7,4); GOSUB 7000; A=POS(B9$=B0$); IF A>0 THEN B0$=B0$(1,A-1)+B0$(A+LEN(B9$))
4420 RETURN 
4800 REM 
4805 V1$=""
4810 READ (Z[8],KEY=A1$,DOM=4811)
4815 READ (Z[8],END=4830)B$
4820 IF B$(1,LEN(A1$))=A1$ THEN V1$=V1$+B$(8,4); GOTO 4815
4840 GOTO 0010
5800 REM "SCREEN
5810 GOSUB 5900
5815 REM "BOTTOM PART OF SCREEN
5820 DIM A[4,2]; A[0,0]=1,A[1,0]=W0,A[2,0]=W1,A0=1,A1=0,E3=1,E0=0,E1=0,E2=0; GOSUB 6000
5830 GOSUB 6720
5880 PRINT IOL=0310
5890 RETURN 
5900 REM "TOP OF SCREEN
5905 X$=FNS$(A$(11,50)); IF LEN(A1$)=4 THEN X$=FNS$(A$(5,50))
5910 PRINT 'CS','SB',
5915 PRINT @(39-INT(LEN(X2$)/2),0),X2$
5920 IF X0$="ZZ2ASA" THEN Q$=A$(1,6); IF A$(7,1)<>" " THEN Q$=Q$+"-"+A$(7,1)
5922 IF X0$="ZZ2MMA" THEN Q$=A$(2,3); IF A$(1,1)<>" " THEN Q$=A$(1,1)+"-"+Q$
5925 PRINT @(0,0),"Screen: ",Q$,@(39-INT(LEN(X$)/2),1),X$
5940 CALL "ZZDISP","-","02","",X3$,"","",0,0,X4$
5980 GOSUB 6200
5990 RETURN 
6000 REM "DISPLAY SCREEN - A0=1 MEANS WHOLE SCREEN,A1=1=REVERSE VIDEO
6050 CALL Z7$,X3$,A1$,Z[8],W0,W1,V0$,A[0,0],A[1,0],A[2,0],A1,V1$,V2$,E0,E1,E2,E3,W2,A0,E4,X4$
6090 RETURN 
6100 REM "MESSAGE"
6105 PRINT (0,ERR=6106)@(0,1),S$(1,14),@(0),'BR','BB',P$,'ER','EB',
6110 RETURN 
6200 REM "DISPLAY TAB SETTINGS
6205 PRINT 'SB',
6210 IF T0$="" THEN GOTO 6290
6220 FOR P=1 TO LEN(T0$) STEP 2
6225 PRINT @(NUM(T0$(P,2)),2),"+",
6230 NEXT P
6290 RETURN 
6590 RETURN 
6600 REM "RESTORE DATA FIELDS
6610 RETURN 
6700 REM "PAINT DATA FIELDS 
6705 A1=0; GOSUB 6000
6715 V1$=W9$
6720 DIM A[4,2]; A[0,0]=1,A[1,0]=W0,A[2,0]=W1,A0=1,A1=0,E2=2; GOSUB 6000
6790 RETURN 
6800 REM "GET DATA FIELDS IN MOVED PIECE
6900 REM "GET RESERVE POSITIONS - ALL
6905 RETURN 
7000 REM "ADD RESERVE POSITIONS 
7010 B9$=""; RETURN 
7500 REM "GET EXISTING DATA SETTINGS
7510 V1$=""
7520 READ (Z[8],KEY=A1$,DOM=7521)
7530 READ (Z[8],END=7560)Q$
7535 IF Q$(1,7)=A1$ THEN V1$=V1$+Q$(8,4); GOTO 7530
7570 GOTO 0010
8000 REM "GET CONTROL VALUE
8005 C0=-1
8020 P=POS(HTA(Q$)=C0$,20); IF P=0 THEN GOTO 8090 ELSE Q0$=Q$
8025 GOTO 8050
8040 READ RECORD (Z[9],SIZ=1,TIM=1,ERR=8070)Q$
8045 Q0$=Q0$+Q$
8050 IF LEN(Q0$)>6 THEN PRINT 'RB'; GOTO 8090
8055 Q$=HTA(Q0$),Q$=Q$+S$(1,12-LEN(Q$))
8060 P=POS(Q$=C0$,20); IF P=0 THEN GOTO 8040 ELSE P=INT(P/20)
8065 C0=P,C$=STR(C0:"00"); GOTO 8090
8070 PRINT 'RB'
8090 RETURN 
8100 REM "RANGE TYPE SCREEN
8140 R0=3
8190 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9040 CALL "ZZERRM",Y8$,"ZZ2ASB",Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9800 REM "RETURN TO 1ST OVERLAY
9820 RUN X0$
9900 REM "END PROGRAM
9920 BEGIN 
9940 RUN "ZMENU"
9999 END 
