0010 REM "A/R Order Update Update <AR2DUE>
0020 SETESC 9300; SETERR 9000
0035 REM "4.1 - 07/24/97 - 15.65 - jel - SSP# 084633
0036 REM "510,7500-7595,,2020,
0037 REM "LINE 2090 MOD FOR FMS%
0038 REM "8/6/91 2075 CHANGED TO UNCONDITIONAL FORM REORDER DATE SET.
0039 REM "DELETED LINE 2875 11/12/91 - WAS SCREWING UP AVG.
0040 REM "Copyright 1997 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 REM "Custom Forms, Forms Management, Speical Shipping
0051 REM "Deleted routine for FMY 2/11/93@ 3000-3100
0090 BEGIN 
0100 SETERR 9000
0110 X0$="AR2DUE",X1$="Order Update - Phase II"
0120 DIM A[7],B[21],C[5],F[7],I[10],S$(20),G[1],P$(81),P[2]
0185 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 DEF FND$(Z9$)=STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5]
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15],D[16],D[17],D[18],D[19],D[20],D[21],D[22],D[23],D[24],D[25],D[26],D[27],D[28],D[29],D[30],D[31]
0350 IOLIST E2$,E[0],E[1],E[2],E[3],E[4],E[5]
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7]
0370 IOLIST G$,G[0]
0390 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10]
0395 IOLIST N$,N1$,N[0],N[1],N[2],N[3],N[4],N[5],N[6],N[7],N[8],N[9],N[10],N[11],N[12],N[13],N[14],N[15]
0400 IOLIST S0$,O[0],O[1],O[2],O[3]
0430 IOLIST S$,S[0],S[1]
0450 IOLIST P$,P[0],P[1],P[2]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O FS1...  02O FS2...  03L FS3...  04O FM1...  05O PO3...  07O FMP...  08O FM3...  09O FM4...  10O FM0... 11O FMG... 12O FSW...  15O KT0...  "
0515 Z$=Z$+"13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 0521,8810
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0620 FIND (Z[13],KEY="STAT"+"F/M")F9$
0625 FIND (Z[13],KEY=X3$(9,3)+"F/M")F8$
0630 FIND (Z[13],KEY=X3$(9,3)+"FMS")F0$,F0
0695 PRINT @(29,9),"Invoice      Order    Line"
1000 REM "READ NEXT RECORD
1020 DIM A$(168),B$(205)
1050 READ (Z[3],KEY="",DOM=1051)
1100 READ (Z[3],END=9900)IOL=0330
1110 PRINT @(29,10),C$(1,8),"   ",C$(9,8),"    ",C$(17,3),
1120 IF C$(9,8)<>A$(118,8) THEN EXTRACT (Z[1],KEY=C$(9,8),DOM=1990)IOL=0310; GOSUB 4000
1140 IF C$(9,11)<>B$(147,8)+B$(6,3) THEN EXTRACT (Z[2],KEY=C$(9,11),DOM=1990)IOL=0320; GOSUB 4200
1160 GOSUB 4100
1400 REM "155,1 = LINE TYPE, C$(20,1)=SPECIAL SHIPPING CODE (BLANK = STD - ALWAYS THERE)
1410 IF POS(B$(155,1)="MSN")>0 THEN GOTO 1900
1420 IF C$(20,1)<>" " THEN GOSUB 2200; GOTO 1990 ELSE K$=C$(40,6)
1440 IF B$(18,1)<>"Y" THEN GOSUB 2200
1460 GOSUB 2000
1990 GOTO 1100
2000 REM "Custom item masterfile update
2005 DIM D[31]
2010 D$=A$(6,10)+B$(19,10)
2018 REM "G$(24,1) IS FMS FLAG FOR CUSTOMER, B$(155,1) IF LINE TYPE (C-I-BLANK=CUSTOM)
2019 REM "IF NON-FMS CUSTOMER, ONLY UPDATE CUSTOM FORMS
2020 IF G$(24,1)<>"Y" AND B$(155,1)<>" " THEN RETURN 
2030 EXTRACT (Z[4],KEY=D$(1,20),DOM=2031)IOL=0340; GOTO 2040
2035 CALL "FM2UBI",X3$,B$(19,10),A$(6,10),B$(155,1),B$(161,10),G$,G[0]
2037 EXTRACT (Z[4],KEY=D$(1,20))IOL=0340
2038 IF B$(155,1)="I" THEN IF G$(112,1)="Y" THEN D$(108,1)="N"
2040 GOSUB 2600
2041 IF POS(A$(47,1)="W")=0 THEN D$(126,6)=A$(16,6),D$(132,8)=A$(118,8),D$(140,9)=B$(189,9),D$(149,12)=B$(171,12),D$(161,6)=B$(183,6),D[16]=B[10],D[17]=B[13]
2042 D[0]=B[12],D[8]=D[8]+1,D[9]=D[9]+C[0],D[10]=D[10]+C[2],D[11]=D[11]+C[2]-C[4]; IF B$(94,10)+B$(90,4)<>S$(1,14) THEN D$(82,14)=B$(94,10)+B$(90,4)
2044 REM "CARTON WEIGHT
2045 IF NUM(B$(198,7),ERR=2046)>0 THEN D[18]=NUM(B$(198,7))
2058 IF D$(96,4)=B$(120,4) AND D[2]=B[2] THEN D[1]=B[1]; GOTO 2074
2059 REM "Unit cost
2060 CALL "FM2EXT",Z[13],1,D$(96,4),D[2],C[0],D0,C[4],2
2070 IF D0>0 THEN D[1]=D0
2074 REM "Manual Reorder date
2075 D$(109,6)=B$(113,6)
2076 IF D$(100,4)=B$(124,4) AND D[4]=B[5] THEN D[3]=B[4],D0=0; GOTO 2085
2080 CALL "FM2EXT",Z[13],1,D$(100,4),D[4],C[0],D0,C[2],2
2085 IF B$(161,10)<>S$(1,10) THEN GOSUB 7500
2090 IF D0>0 THEN D[3]=D0; IF D[30]<>0 THEN D[29]=D[3]*D[30]/100
2095 D[2]=B[2],D[4]=B[5],D$(96,4)=B$(120,4),D$(100,4)=B$(124,4)
2100 REM "Art Tracking - USES SHIP DATE FOR STATUS
2110 IF F8$(189,1)="Y" THEN IF D$(231,1)="P" THEN D$(231,1)="B",D$(232,6)=K$
2179 REM "IF B$(10,1)=9, THIS IS CUSTOMER OWNED GOODS - DON'T UPDATE FORM
2180 IF B$(10,1)<>"9" THEN WRITE (Z[4],KEY=D$(1,20))IOL=0340; CALL "FM2UTI",X3$,D$(1,20),"F"; IF RT_PARM$<>"" THEN CUST$=D$(1,10); CALL "RT2WOC",ERR=2181,X3$,X4$,CUST$,"FM1...","U",D$(1,20)
2190 RETURN 
2200 REM "Item Detail by Location Update (FM4)
2205 REM "Check location FMS method
2210 IF POS(S8$="CIE")=0 THEN RETURN 
2220 ESCAPE 
2225 CALL "TSTFM4",X3$,X4$,A$,B$,C8$,X4T$,S8$,K$,C[0]
2240 GOSUB 3000
2350 RETURN 
2400 REM "Update special shipping information
2410 DIM O[3]
2420 EXTRACT (Z[5],KEY=C$(9,8)+" "+C$(17,4),DOM=2450)IOL=0400
2430 IF B$(9,1)=" " THEN O[2]=O[2]+C[0]
2440 WRITE (Z[5],KEY=C$(9,8)+" "+C$(17,4))IOL=0400
2450 RETURN 
2500 REM "FMS USAGE WHEN NON-COUNT FORM
2510 U0=C[0],U1=C[2]; IF F0$(9,1)="I" THEN U0=N[3],U1=N[6]
2512 N[3]=C[0],N[6]=C[2]
2515 IF F0$(10,1)<>"Y" THEN Z7$=N$(75,6),Z8$=K$ ELSE Z7$=K$,Z8$=Z7$
2516 IF Z7$="      " THEN Z7$=Z8$
2520 IF Z7$>Z8$ THEN IF F0$(11,1)="Y" THEN Z7$=K$,Z8$=Z7$ ELSE Z8$=Z7$,Z7$=N$(75,6)
2525 IF K$>N$(75,6) THEN N$(75,6)=K$
2530 IF U0<>0 OR U1<>0 THEN GOSUB 2800
2550 REM "
2590 RETURN 
2600 REM "Update item masterfile - all activity
2605 REM "Average usage for non-FMS forms
2609 Q$="B"; IF D$(105,1)="Y" THEN Q$="F"
2610 IF D$(108,1)<>"Y" THEN CALL "FM2UZD",X3$,X4$,D$(1,20),"",X{ALL},"","",0,0,X,"",Q$,""; D[24]=X
2615 REM "Date first used
2618 IF D$(329,6)=S$(1,6) THEN D$(329,6)=K$ ELSE IF D$(329,6)>K$ THEN D$(329,6)=K$
2619 REM "Last requisitioned date
2620 IF B$(155,1)="I" THEN IF K$>D$(335,6) THEN D$(335,6)=K$
2680 IF B$(10,1)="9" THEN WRITE (Z[4],KEY=D$(1,20))IOL=0340
2690 RETURN 
2800 REM "Post usage and cost as per Issues / Shipments
2801 REM "Usage is shipments since last count prorated over
2802 REM "period from last count (shipment) date to current date
2825 Z9$=S1$(2,10)+B$(19,10)+S1$(12,4)
2830 ESCAPE 
2850 CALL "FM2UBB",X3$,F9$,Z[7],"E"+A$(6,10),Z[8],Z[12],Z9$,Z7$,Z8$,"U",U0,0,0,0
2860 CALL "FM2UBB",X3$,F9$,Z[7],"E"+A$(6,10),Z[8],Z[12],Z9$,Z7$,Z8$,"C",U1,0,0,0
2890 RETURN 
3000 REM "BREAK DOWN COMPONENTS OF A KIT
3001 ESCAPE 
3005 READ (Z[15],KEY=A$(6,10)+B$(19,10),DOM=3006)
3010 J$=KEY(Z[15],END=3190)
3020 READ (Z[15],KEY=J$)IOL=0450
3030 IF J$(1,20)<>A$(6,10)+B$(19,10) THEN GOTO 3190
3040 C[0]=C[0]*P[2]
3050 DIM P1$(16),P2$(30); P1$(6,10)=P$(1,10),P2$(19,10)=P$(31,10)
3080 CALL "TSTFM4",X3$,X4$,P1$,P2$,C8$,X4T$,S8$,K$,C[0]
3090 Z9$=P$(1,10)+P$(31,10)+C8$
3095 CALL "FM2UBB",X3$,F9$,Z[7],"E"+A$(6,10),Z[8],Z[12],Z9$,Z7$,Z8$,"U",U0,0,0,0
3100 CALL "FM2UBB",X3$,F9$,Z[7],"E"+A$(6,10),Z[8],Z[12],Z9$,Z7$,Z8$,"C",U1,0,0,0
3180 GOTO 3010
3190 RETURN 
4000 REM "New Order
4010 IF A$(43,1)="Y" THEN Y4$="AR2DUF"; REM "Production Work Order
4019 REM "O/P Defaults
4020 DIM G$(49); FIND (Z[7],KEY="D"+A$(6,10),DOM=4021)IOL=0370
4039 REM "General Shipping location
4040 DIM C9$(4); FIND (Z[5],KEY=C$(9,8)+" "+C9$,DOM=4041)S0$; C9$=S0$(12,4)
4059 REM "Customer Location F/M method
4060 DIM S1$(224); IF G$(24,1)="Y" THEN FIND (Z[10],DOM=4061,KEY="C"+A$(6,10)+C9$)S1$
4070 S9$=S1$(223,1)
4090 RETURN 
4100 REM "Special Shipping Overrides
4120 C8$=C9$,S8$=S9$
4140 REM IF B$(18,1)<>"Y" OR C$(20,1)=" " THEN RETURN 
4159 REM "Ship to location
4160 S8$="?"; FIND (Z[5],KEY=C$(9,8)+" "+C$(17,4),DOM=4161)S0$; C8$=S0$(12,4)
4165 IF S0$(11,1)="D" THEN D8$=" "; GOTO 4180
4169 REM "Customer Location F/M method
4170 DIM S1$(224); FIND (Z[10],DOM=4171,KEY="C"+A$(6,10)+C8$)S1$; S8$=S1$(223,1)
4180 GOSUB 2400
4190 RETURN 
4200 REM "Get Item Info
4204 REM (10/7/93) IF B$(135,1)<>" " AND B(11)<>0 THEN LET Y4$="AR2DUF"; REM "Check for Finders fee
4205 IF B$(135,1)<>" " THEN Y4$="AR2DUF"; REM "Check for Finders fee
4210 IF B$(155,1)<>" " THEN RETURN 
4220 DIM D$(325),D[31],D8$(1)
4230 IF POS(" "<>B$(161,10))=0 THEN D$(1)=A$(6,10)+B$(19,10) ELSE D$(1)=B$(161,10)+B$(19,10)
4240 FIND (Z[4],KEY=D$(1,20),DOM=4241)IOL=0340; D8$=D$(108,1)
4290 RETURN 
7500 REM "OTHER CUSTOMER'S INVENTORY
7505 REMOVE (Z[11],KEY=D$(185,10)+D$(11,10)+D$(1,10),DOM=7506)
7510 D$(185,10)=B$(161,10)
7515 WRITE (Z[11],KEY=D$(185,10)+D$(11,10)+D$(1,10))
7545 RETURN 
7550 REM "UPDATE 'FROM' CUST ON REQUISITION
7555 IF POS(B$(155,1)="IC")=0 THEN GOTO 7595
7560 IF B$(161,10)=S$(1,10) THEN GOTO 7590
7565 EXTRACT (Z[4],KEY=D$(1,20))IOL=0340
7570 IF D$(185,10)=B$(161,10) THEN READ (Z[4]); GOTO 7590
7575 GOSUB 7500
7580 WRITE (Z[4],KEY=D$(1,20))IOL=0340
7595 RETURN 
8200 SET_DEFAULTS:REM "From Customer FMS Defaults Screen 3
8220 DIM FMS_DEFAULTS$(220),FMS_DEFAULTS[1]; FIND (Z[7],KEY="A"+N$(1,10),DOM=8290)FMS_DEFAULTS$,FMS_DEFAULTS[0],FMS_DEFAULTS[1]
8230 N$(27,5)=FMS_DEFAULTS$(16,5),N[1]=NUM(FMS_DEFAULTS$(21,3)),N[12]=NUM(FMS_DEFAULTS$(24,3)),N[2]=FMS_DEFAULTS[0],N[13]=FMS_DEFAULTS[1]
8290 END_SET_DEFAULTS:RETURN 
8800 REM "Problem in ZZFILES
8810 GOSUB 8850; GOTO 0520
8850 REM 
8860 X$="Update "+PGN+" in progress, you may not exit. Contact SW Support for assistance"
8870 CALL "ZZPROM",".4",X3$,0,X$,"","",0
8890 RETURN 
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,1
9050 ON Y7 GOTO 9060,9100,9190,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9190 GOSUB 6600; GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9800 REM 
9830 Y4$="ZMENU"
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 0000
9945 IF POS(F8$(191,1)="FY")>0 THEN Y4$="AR2DUF"
9950 IF Y4$>"" THEN RUN Y4$
9960 RUN "AR2DUG"
9999 END 
