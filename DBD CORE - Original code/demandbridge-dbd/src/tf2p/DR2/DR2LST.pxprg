0010 ! TopForm Build Table of Schema data      <DR2LST>
0040 REM "Copyright 2002 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0055 ! TF_FILE$ is TopForm Data dictionary name, DR_FILE$ is outgoing file to open, IO$ is Embedded i/o program, ""= clear it,OPT$ is options
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$
0100 SETERR 9000
0105 PRINT 'CS',@(0,3),"Generating Schema info in tfschema.txt"
0110 X0$="DR2LST",X1$="Build Table of Schema Data"
0150 DDE=HFN; OPEN (DDE)"providex.dde"
0170 DDF=HFN; OPEN (DDF)"providex.ddf"
0175 SERIAL "tfschema.txt",ERR=*NEXT
0180 OUTPUT=HFN; OPEN PURGE (OUTPUT)"tfschema.txt"
0195 S$=$09$
0197 PRINT (OUTPUT)"TABLE_NAME",S$,"COLUMN_NAME",S$,"TYPE",S$,"DESCRIPTION",S$
0200 READ_RECORD:
0210 READ (DDF,KNO=1,END=9900)IOL=8010
0220 DDF_K$=KEC(DDF,KNO=0) ! Get primary id
0250 PRINT @(10,10),'CL',TABLE_NAME$,
0300 ! ^100 - Get File Information
0320 READ (DDE,KEY=DDF_K$,DOM=9900)
0400 ! ^100 - Get Element Information
0405 GET_ELM:
0410 READ (DDE,END=ADD_PFX)IOL=8020
0420 DDE_K$=KEC(DDE)
0430 IF DDE_K$(1,6)<>DDF_K$ THEN GOTO ADD_PFX
0435 IF NAME$="DESC" THEN NAME$="DESCRIPTION" ! DESC is reserved word for Oracle
0440 IF TYPE$="N" THEN TYPE$="NUMBER" ELSE IF MID(CLASS$,1,4)="DATE" THEN TYPE$="DATE" ELSE TYPE$="CHAR("+LEN$+")"
0480 PRINT (OUTPUT)TABLE_NAME$,S$,NAME$,S$,TYPE$,S$
0490 GOTO GET_ELM
0500 ! ^100 - Build Prefix File
0510 ADD_PFX:
1990 GOTO READ_RECORD
8000 ! 8000 - iolists
8010 IOLIST TABLE_NAME$,PATH$,LST_UPD$,FILE_PROC$,NOT_USED1$,NOT_USED2$,NOT_USED3$,NOT_USED4$,NOT_USED5$,ALT_IOLIST$,SEP$,RFU$
8020 IOLIST IOLOBJ$,NAME$,DESC$,TYPE$,LEN$,OCC$,FORMAT$,VALID$,PRINT$,HELP$,NOTES$,KEYDEF$,QUERY$,CLASS$,FLAGS$,DFLT$,ALT_NAME$,USER_TAG$
9000 REM "ERROR PROCESSING
9005 PRINT "err: ",ERR," line: ",TCB(5),; INPUT *
9900 REM "END PROGRAM
9910 INPUT @(0,20),"Process complete <ret> to continue",
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
