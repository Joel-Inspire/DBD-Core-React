0010 REM "Convert Custom Form File <CA2FM1>
0020 SETESC 9300; SETERR 9000
0035 REM "5.2 - 08/20/03 - 11.311388 - dmm - SSP# 163697
0040 REM "Copyright 2003 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 REM "LEAVE I/C lookup errors in I/C! map
0080 BEGIN 
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0110 X0$="CA2FM1",X1$="Convert to TopForm Custom Form File"
0120 DIM Z0$(80,"-"),Z1$(20,"0"),S0$(464),S9$(40),BLANKS$(100)
0130 K0=20,K1=1
0135 C9=-1
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=ESC+"BG"+Z0$+ESC+"EG"
0300 REM "IOLISTS
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24],A[25],A[26],A[27],A[28],A[29],A[30],A[31]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15]
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15],D[16],D[17],D[18],D[19],D[20],D[21],D[22],D[23],D[24],D[25],D[26],D[27],D[28],D[29],D[30],D[31],D[32],D[33],D[34],D[35],D[36],D[37],D[38],D[39],D[40]
0350 IOLIST E$,E[0],E[1],E[2]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="02O FM1...  03O AR1...  04O IC0...  11O CA0... 12O MAPDAT  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0522 GOSUB 6000; CALL "CA2MCA",X3$,X4$,10,CA0_SELECTED$,""
0524 IF STP(CA0_SELECTED$,3," ")="" OR CA0_SELECTED$="" THEN GOTO 9900
0535 READ (Z[11],KEY=CA0_SELECTED$(1,4))CA0$
0600 REM "
0605 READER$="CA2R"+STP(CA0$(25,2),1)
0610 GOSUB 6000
0615 CALL READER$,X3$,X4$,CA0$,CA1${ALL},"O","",MEM${ALL},R$,RET_CODE
0640 CALL "ZZPROM",".Y",X3$,Z,"Proceed?","","",0; ON Z GOTO 0641,9900
0700 IF CA0$(62,1)="I" THEN CALL "ZZINIT",STR(Z[2]:"00")+STR(Z[4]:"00")
0701 CALL "ZZINIT",STR(Z[2]:"00")+STR(Z[4]:"00")
0702 READ (Z[12],KEY="FM1I",DOM=0703)
0703 PRINT @(20,15),'CL',"Clearing mappinging of initial form pass (FM1I)",
0704 VV$=KEY(Z[12],END=0705); IF VV$(1,4)<>"FM1I" THEN GOTO 0705 ELSE REMOVE (Z[12],KEY=VV$); GOTO 0704
0705 PRINT @(20,15),'CL',
0710 X$="P/C U/M FMER"
0720 FOR I=1 TO LEN(X$) STEP 4
0725 J$="Clear Mapping for "+FNS$(X$(I,4))+"?"
0730 CALL "ZZPROM",".Y",X3$,Z,J$,"","",0; ON Z GOTO 0731,0790
0735 C9=0,C9$="\|/-",C8=LEN(C9$); PRINT @(20,15),"Clearing ",FNS$(X$(I,4)),":",
0740 READ (Z[12],KEY=X$(I,4),DOM=0741)
0750 K$=KEY(Z[12],END=0780); C9=C9+1; PRINT @(35,15),C9$(MOD(C9,C8)+1,1),; IF K$(1,4)=X$(I,4) THEN REMOVE (Z[12],KEY=K$); GOTO 0750
0780 PRINT @(0,15),'CL',
0790 NEXT I
0800 REM "Clear I/C! records
0805 C9=0,C9$="\|/-",C8=LEN(C9$); PRINT @(20,15),"Clearing I/C Exceptions",
0810 READ (Z[12],KEY="I/C!",DOM=0811)
0820 K$=KEY(Z[12],END=0825); C9=C9+1; PRINT @(35,15),C9$(MOD(C9,C8)+1,1),; IF K$(1,4)="I/C!" THEN REMOVE (Z[12],KEY=K$,DOM=0820); GOTO 0820
0825 PRINT @(0,15),'CL',
0920 H0$=$0A$
0940 READ (Z[12],KEY="*PARAMETERS")P9$
0950 ADDR "CA2CVT"; ADDR "YUCASE"
1000 REM "Read Data file
1010 DIM R$(1000); CALL READER$,X3$,X4$,CA0$,CA1${ALL},"R","",MEM${ALL},R$,RET_CODE; IF RET_CODE=2 THEN GOTO 5000
1180 C1=C1+1; GOSUB 2000
1900 GOTO 1000
2000 REM "Initialize TopForm Record
2100 DIM A$(386),A[31],S$(50),C[15]
2101 IF POS(" "<>R$(3,15))=0 THEN GOTO 2110
2102 IF R$(3,15)=" " THEN R$(3,15)=R$(4,14); GOTO 2102
2119 REM "Apply opposite checks as employed in CA2AR1
2200 REM "Customer Code
2205 Q$=R$(3,15); DIM X$(100); X$(1)="AR1 "+Q$,Q8=0
2210 FIND (Z[12],DOM=2211,KEY=X$(1,24))X$; A$(1,10)=X$(25); GOTO 2220
2215 DIM X$(100); X$(1)="FMER"+R$; WRITE (Z[12],KEY=X$(1,24))X$; GOTO 4990
2220 FIND (Z[3],KEY=A$(1,10),DOM=2215)IOL=0330; GOTO 2225
2225 REM "Form Number
2230 CALL "YUCASE",X3$,R$(18,10),Q$
2231 IF STP(Q$,3," ")="" THEN GOTO 4990; REM 'SKIP RECORD IF FORM CODE IS BLANK
2232 A$(11,10)=Q$,Q9=0
2234 IF CA0$(62,1)="A" THEN READ (Z[2],KEY=A$(1,20),DOM=4990)IOL=0310; GOTO 2250
2235 IF CA0$(62,1)="S" THEN READ (Z[2],KEY=A$(1,20),DOM=2237); GOSUB 7800; IF SKIP=1 THEN GOTO 4990 ELSE REMOVE (Z[2],KEY=A$(1,20)); REM 'IF SECONDARY PASS CK FOR RULES OR PROCESSING RECORD IN 7800
2237 READ (Z[2],KEY=A$(1,20),DOM=2238); IF Q9=0 THEN A$(20,1)="0",Q9=1; GOTO 2236 ELSE IF A$(20,1)="9" THEN ESCAPE ELSE A$(20,1)=STR(NUM(A$(20,1))+1:"0")
2240 REM 'IF INITIAL PASS THEN WRITE OUT MAPPING INFO WITH FM1I
2242 DIM X$(100); X$(1)="FM1I"+A$(1,20); WRITE (Z[12],KEY=X$(1,24))X$
2250 REM "Product Code
2252 IF R$(550,15)=BLANKS$(1,15) THEN GOTO 2280
2260 Q$=R$(550,15); DIM X$(100); X$(1)="P/C "+Q$,I1=21,I2=3; GOSUB 7500
2262 A$(21,3)=STR(NUM(A$(21,3),ERR=2263):"000")
2280 REM "Left - Right
2282 IF R$(31,8)=BLANKS$(1,8) THEN GOTO 2300
2290 A$(24,8)=R$(31,8)
2300 REM "Top-Bottom
2302 IF R$(39,8)=BLANKS$(1,8) THEN GOTO 2320
2310 A$(32,8)=R$(39,8)
2320 REM "Number of Plys
2322 IF R$(47,2)=BLANKS$(1,2) THEN GOTO 2340
2330 A$(40,2)=STR(NUM(R$(47,2)):"00"); IF A$(40,2)="00" THEN A$(40,2)=""
2340 REM "Description
2342 IF R$(49,40)=BLANKS$(1,40) THEN GOTO 2360
2355 A$(42,40)=R$(49,40)
2360 REM "Vendor Code
2370 Q$=R$(89,10); IF STP(Q$,3," ")="" THEN Q$="SMART"
2380 DIM X$(100); X$(1)="AP4 "+Q$,A$(82,10)="00"+"SMART"
2390 FIND (Z[12],DOM=2391,KEY=X$(1,24))X$; A$(82,10)=X$(25,10)
2400 REM "Plant Code
2402 IF R$(99,4)=BLANKS$(1,4) THEN GOTO 2420
2410 A$(92,4)=R$(99,4)
2420 REM "Cost Unit of Measure (SEE ALSO 4700)
2422 IF R$(103,4)=BLANKS$(1,4) THEN GOTO 2450
2425 Q$=R$(103,4); IF Q$="    " AND X3$(9,3)="117" THEN Q$=R$(107,4)
2427 IF Q$="    " THEN Q$="M   "
2428 IF Q$="L   " THEN Q$="LOT "
2430 DIM X$(100); X$(1)="U/M "+Q$,I1=96,I2=4; GOSUB 7500
2440 IF X>0 THEN A[2]=X
2450 REM "Sell Unit of Measure  (SEE ALSO 4700)
2451 R$(107,4)=R$(103,4)
2453 IF R$(107,4)=BLANKS$(1,4) THEN GOTO 2480
2455 Q$=R$(107,4); IF Q$="    " THEN Q$="M   "
2460 DIM X$(100); X$(1)="U/M "+Q$,I1=100,I2=4; GOSUB 7500
2470 IF X>0 THEN A[4]=X
2480 REM "Numbering?
2482 IF R$(111,1)=BLANKS$(1,1) THEN GOTO 2500
2490 A$(111,1)=R$(111,1); IF A$(111,1)<>"Y" THEN A$(111,1)="N"
2500 REM "Distributor Stock (inventoried) item
2510 A$(105,1)=""
2520 REM "Not used
2530 A$(106,2)=""
2540 REM "Forms Management?
2542 IF R$(112,1)=BLANKS$(1,1) THEN GOTO 2570
2560 A$(108,1)=R$(112,1); IF A$(108,1)<>"Y" THEN A$(108,1)="N"
2570 REM "Reorder date
2572 IF R$(540,10)=BLANKS$(1,10) THEN GOTO 2610
2580 Q$=R$(540,10)
2590 GOSUB 7600; A$(109,6)=X$
2610 REM "Finder's Fee Type (Gp,Sales,Cost,Fixed)
2620 A$(115,1)=""
2630 REM "Finder's Fee Vendor Code
2640 Q$=""
2650 DIM X$(100); X$(1)="AP4 "+Q$
2660 FIND (Z[12],KEY=X$(1,24),DOM=2661)X$; A$(116,10)=X$(25)
2670 REM "Date Last Ordered
2672 IF R$(113,10)=BLANKS$(1,10) THEN GOTO 2700
2680 Q$=R$(113,10)
2690 GOSUB 7600; A$(126,6)=X$
2700 REM "Last Sales Order Number
2702 IF R$(123,8)=BLANKS$(1,8) THEN GOTO 2730
2710 Q$=R$(123,8)
2720 IF POS(" "<>Q$)<>0 THEN A$(132,8)=A$(1,2)+Q$
2730 REM "Ending Number
2732 IF R$(131,9)=BLANKS$(1,9) THEN GOTO 2750
2740 A$(140,9)=R$(131,9)
2750 REM "Previous Job Number
2752 IF R$(140,12)=BLANKS$(1,12) THEN GOTO 2770
2760 A$(149,12)=R$(140,12)
2770 REM "Previous Job Date
2772 IF R$(152,10)=BLANKS$(1,10) THEN GOTO 2800
2780 Q$=R$(152,10)
2790 GOSUB 7600; A$(161,6)=X$
2800 REM "Form Revision Date - don't format
2802 IF R$(162,10)=BLANKS$(1,10) THEN GOTO 2820
2804 REM "If > 6 and MM/DD/YY format, cutout day and put in MM/YY format
2805 IF LEN(STP(R$(162,10),1))<=6 THEN GOTO 2810 ELSE TMP$=STP(R$(162,10),1)
2806 P1=POS("/"=TMP$),P2=POS("/"=TMP$,1,2)
2807 IF P2=0 THEN GOTO 2810 ELSE R$(162,10)=TMP$(1,P1-1)+"/"+TMP$(P2+1)
2810 A$(167,6)=R$(162,10)
2820 REM "Function Code
2822 IF R$(565,12)=BLANKS$(1,12) THEN GOTO 2840
2830 A$(173,12)=R$(565,12)
2840 REM "Source Customer
2860 A$(185,10)=""
2870 REM "Active Status
2880 A$(195,1)="A"
2890 REM "*unused
2900 A$(196,3)=""
2910 REM "Old Forms Code
2920 A$(199,10)=""
2930 REM "Form Contact Person Code
2940 A$(209,3)=R$(28,3)
2950 REM "Form Group Code
2952 IF R$(172,3)=BLANKS$(1,3) THEN GOTO 2970
2960 A$(212,3)=PAD(STP(R$(172,3),2),3,0,"0")
2965 IF A$(212,3)="000" THEN A$(212,3)=""
2970 REM "Art Disk File Name
2972 IF R$(175,16)=BLANKS$(1,16) THEN GOTO 2990
2980 A$(215,16)=R$(175,16)
2990 REM "Art Status Code
3000 A$(231,1)=""
3010 REM "Art Status Date
3020 Q$=""
3030 GOSUB 7600; A$(232,6)=X$
3050 REM "Carton Pack
3052 IF R$(215,10)=BLANKS$(1,10) THEN GOTO 3080
3055 Q$=R$(215,10)
3060 GOSUB 7650; A[0]=INT(X)
3080 REM "Alternate Unit of Issues #1-4
3082 IF R$(191,4)=BLANKS$(1,4) THEN GOTO 3130
3085 Q$=STP(R$(191,4),1)
3095 IF Q$="" THEN GOTO 3120
3100 DIM X$(100); X$(1)="U/M "+Q$,I1=238,I2=4; GOSUB 7500
3110 A[25]=X
3112 IF STP(R$(606,10),3," ")="" THEN GOTO 3115 ELSE A[25]=NUM(R$(606,10),ERR=3113)
3115 IF A[25]=0 THEN A$(238,4)=""; REM "If 0 clear alt u/m#1
3130 REM "Form Status Code
3140 A$(254,1)=""
3150 REM "Form Status Date
3160 Q$=""
3170 GOSUB 7600; A$(255,6)=X$
3180 REM "Form Status Memo
3190 A$(261,30)=""
3200 REM "Auto Pricing Estimate Group
3210 A$(291,10)=""
3220 REM "Auto Pricing Features
3230 A$(301,10)=""
3240 REM "Requisition Access Control Codes (3*2x)
3250 A$(311,6)=""
3260 REM "Dont Print Reorder Notice Until
3270 Q$=""
3280 GOSUB 7600; A$(317,6)=X$
3290 REM "Casual Count Date
3300 Q$=""
3310 GOSUB 7600; A$(323,6)=X$
3320 REM "Date Form first used
3322 IF R$(195,10)=BLANKS$(1,10) THEN GOTO 3350
3330 Q$=R$(195,10)
3340 GOSUB 7600; A$(329,6)=X$
3350 REM "Date Last Released
3352 IF R$(205,10)=BLANKS$(1,10) THEN GOTO 3370
3355 Q$=R$(205,10)
3365 GOSUB 7600; A$(335,6)=X$
3370 REM "Default Cost Code
3380 A$(341,9)=""
3385 REM "Customer item code (CIC)
3386 IF R$(470,20)=BLANKS$(1,20) THEN GOTO 3390
3387 A$(350,20)=R$(470,20)
3390 REM "Unused
3400 A$(370,17)=""
3440 REM "Unit Cost
3442 IF R$(225,10)=BLANKS$(1,10) THEN GOTO 3480
3450 Q$=R$(225,10)
3460 GOSUB 7650
3470 A[1]=X
3480 REM "Qty/Cost Unit of Measure
3482 IF R$(235,10)=BLANKS$(1,10) THEN GOTO 3510
3490 Q$=R$(235,10); IF FNS$(Q$)="" THEN Q$=R$(255,10)
3500 GOSUB 7650; A[2]=INT(X)
3510 REM "Unit Selling Price
3512 IF R$(245,10)=BLANKS$(1,10) THEN GOTO 3550
3520 Q$=R$(245,10)
3530 GOSUB 7650
3540 A[3]=X
3542 REM 'PRINT "PRICE: ",X,"  ",A$(1,20); INPUT *
3550 REM "Qty/Selling Unit of Measure
3552 IF R$(255,10)=BLANKS$(1,10) THEN GOTO 3600
3555 IF A[4]>0 THEN GOTO 3600 ELSE Q$=""
3560 Q$=R$(255,10)
3570 GOSUB 7650; A[4]=X
3600 REM "*Not used
3610 Q$=""
3620 GOSUB 7650; A[5]=INT(X)
3630 REM "Estimated Annual Usage
3640 Q$=""
3650 GOSUB 7650; A[6]=INT(X)
3660 REM "Finder's Fee Percentage
3662 IF R$(265,10)=BLANKS$(1,10) THEN GOTO 3700
3670 Q$=R$(265,10)
3680 GOSUB 7650
3690 A[7]=X
3700 REM "YTD - Number of Invoices
3702 IF R$(275,15)=BLANKS$(1,15) THEN GOTO 3730
3710 Q$=R$(275,15)
3720 GOSUB 7650; A[8]=INT(X)
3730 REM "YTD - Quantity Sold
3732 IF R$(290,15)=BLANKS$(1,15) THEN GOTO 3760
3740 Q$=R$(290,15)
3750 GOSUB 7650; A[9]=INT(X)
3760 REM "YTD - Net Sales
3762 IF R$(305,15)=BLANKS$(1,15) THEN GOTO 3790
3770 Q$=R$(305,15)
3780 GOSUB 7650; A[10]=X
3790 REM "YTD - Gross Profit
3792 IF R$(320,15)=BLANKS$(1,15) THEN GOTO 3820
3800 Q$=R$(320,15)
3810 GOSUB 7650; A[11]=X
3820 REM "LY - Number of Invoices
3822 IF R$(335,15)=BLANKS$(1,15) THEN GOTO 3850
3830 Q$=R$(335,15)
3840 GOSUB 7650; A[12]=INT(X)
3850 REM "LY - Quantity
3852 IF R$(250,15)=BLANKS$(1,15) THEN GOTO 3880
3860 Q$=R$(350,15)
3870 GOSUB 7650; A[13]=INT(X)
3880 REM "LY - Net Sales
3882 IF R$(455,15)=BLANKS$(1,15) THEN GOTO 3910
3890 Q$=R$(455,15)
3900 GOSUB 7650; A[14]=X
3910 REM "LY - Gross Profit
3912 IF R$(365,15)=BLANKS$(1,15) THEN GOTO 3940
3920 Q$=R$(365,15)
3930 GOSUB 7650; A[15]=X
3940 REM "Last Qty Ordered
3942 IF R$(380,15)=BLANKS$(1,15) THEN GOTO 3970
3950 Q$=R$(380,15)
3960 GOSUB 7650; A[16]=INT(X)
3970 REM "Combination Quantity
3980 Q$=""
3990 GOSUB 7650; A[17]=INT(X)
4000 REM "Carton Weight
4002 IF R$(395,10)=BLANKS$(1,10) THEN GOTO 4030
4010 Q$=R$(395,10)
4020 GOSUB 7650; A[18]=X
4030 REM "Weeks Supply as Reorder Point
4032 IF R$(405,10)=BLANKS$(1,10) THEN GOTO 4060
4040 Q$=R$(405,10)
4050 GOSUB 7650; A[19]=INT(X)
4060 REM "Last Casual Count Quantiy (all locations)
4070 Q$=""
4080 GOSUB 7650; A[20]=INT(X)
4090 REM "Desired Stocking Level
4092 IF R$(577,15)=BLANKS$(1,15) THEN GOTO 4120
4100 Q$=R$(577,15)
4110 GOSUB 7650; A[21]=INT(X)
4120 REM "Reorder Point in Days
4122 IF R$(415,10)=BLANKS$(1,10) THEN GOTO 4150
4130 Q$=R$(415,10)
4140 GOSUB 7650; A[22]=INT(X)
4150 REM "Reorder Point Quantity
4152 IF R$(425,10)=BLANKS$(1,10) THEN GOTO 4180
4160 Q$=R$(425,10)
4170 GOSUB 7650; A[23]=INT(X)
4180 REM "Monthly Average Usage
4190 Q$=""
4200 GOSUB 7650; A[24]=INT(X)
4210 REM "FMS Price
4212 IF R$(445,10)=BLANKS$(1,10) THEN GOTO 4240
4220 Q$=R$(445,10)
4230 GOSUB 7650; A[29]=X
4240 REM "FMS Percent
4250 Q$=""
4260 GOSUB 7650
4270 A[30]=X
4300 REM "if left-right,topbottom blank then use this field in format of "LEFT-RIGHT"+"X"+"TOP-BOTTOM". IF no "X" then all goes into left-right field
4304 IF STP(R$(490,20),3," ")="" THEN GOTO 4311
4305 XPOS=POS("X"=R$(490,20)); IF XPOS=0 THEN XPOS=POS("x"=R$(490,20))
4310 IF XPOS=0 THEN A$(24,8)=STP(R$(490,20),2) ELSE A$(24,8)=STP(R$(490,XPOS-1),2),A$(32,8)=STP(R$(490+XPOS,20-XPOS),2)
4330 REM "Use YTD cost to figure YTD GP
4340 IF A[11]=0 THEN Q$=R$(510,15); GOSUB 7650; A[11]=A[10]-X
4360 REM "Use LY cost to figure LY GP
4370 IF A[15]=0 THEN Q$=R$(525,15); GOSUB 7650; A[15]=A[14]-X
4700 REM 'IF PACK NOT SET THEN SET TO DEFAULTS
4702 REM 'RE-EVALUATE SELL AND COST UOM PACKS AFTER ALL VARIABLES SET
4710 REM 'SELL UOM PACK
4712 UOM$=A$(100,4),PINDEX=4
4714 IF CA0$(27,1)="G" THEN DIM PACKS[2]; PACKS[1]=A[25],PACKS[2]=A[0]; REM 'IF GALAXY THEN PULL PACK FROM 1ST ALTERNATE THEN CARTON PACK
4715 IF CA0$(27,1)<>"G" THEN DIM PACKS[1]; PACKS[1]=A[0]; REM 'NON GALAXY TRY FOR THE CARTON PACK
4717 GOSUB 7700
4720 REM 'COST UOM
4722 UOM$=A$(96,4),PINDEX=2
4724 IF CA0$(27,1)="G" THEN DIM PACKS[2]; PACKS[1]=A[25],PACKS[2]=A[0]; REM 'SEE SELL UOM
4726 IF CA0$(27,1)<>"G" THEN DIM PACKS[1]; PACKS[1]=A[0]
4728 GOSUB 7700
4730 REM '1ST ALTERNATE UOM
4732 UOM$=A$(238,4),PINDEX=25
4734 DIM PACKS[1]; PACKS[1]=A[0]
4736 GOSUB 7700
4900 REM "Write file(s)
4905 IF A[2]=0 THEN A[2]=1
4906 IF A[4]=0 THEN A[4]=1
4907 IF A$(96,4)="M   " THEN A[2]=1000
4908 IF A$(100,4)="M   " THEN A[4]=1000
4910 WRITE (Z[2],KEY=A$(1,20))IOL=0310
4915 IF CA0$(62,1)="I" THEN GOSUB 8700; REM 'ONLY SETUP IC0 ON INTIAL PASSES
4920 C2=C2+1
4990 RETURN 
5000 REM "EOJ
5010 GOSUB 5200
5020 CALL "ZZPROM",".4",X3$,Z,"Process complete!!","","",0
5040 GOTO 9900
5200 REM "COMPLETE CYCLE
5210 CALL "FM2UT2",X3$,"","","*"
5215 CALL "IC2UT8",X3$,"","","*"
5290 RETURN 
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6020 PRINT @(0,4),"This program converts the Custom Form file to TopForm's FM1 AND IC0."
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
7500 REM "Generalized Mapping
7520 FIND (Z[12],KEY=X$(1,24),DOM=7521)X$,X; A$(I1,I2)=X$(25,I2); GOTO 7590
7560 X$(25)=Q$; WRITE (Z[12],KEY=X$(1,24))X$; GOTO 7520
7590 RETURN 
7600 REM "Generalized Date conversion
7610 IF FNS$(Q$)="" THEN X$=""; GOTO 7640
7620 CALL "CA2CVT",X3$,X4$,P9$(1,2),Q$,0,X$,0,"",0
7640 RETURN 
7650 REM "Generalized Numeric conversion
7660 IF FNS$(Q$)="" THEN X$="",X=0; GOTO 7690
7670 CALL "CA2CVT",X3$,X4$,P9$(5,2),Q$,0,X$,X,"",0
7690 RETURN 
7700 REM 'SETTING OF PACK
7702 REM 'UOM$ = UOM TO CHECK
7703 REM 'PINDEX - A(X) POSITION TO SET PACK IN
7704 REM 'PACKS(1/2/3/4/X) - PRIORITY OF PACKS TO USE IF NOT STANDARD UOM
7720 CALL "MA2UOM",X3$,UOM$,A{ALL},PINDEX,PACKS{ALL},CA0$,CA1$
7740 RETURN 
7800 REM 'EVALUATE FORM ON SECONDARY PASS
7805 SKIP=0
7810 DIM X$(100); X$(1,24)="FM1I"+A$(1,20); FIND (Z[12],KEY=X$(1,24),DOM=7811); SKIP=1; GOTO 7840; REM 'IF RECORD INDICATING CONERTED DURING INITIAL PASS THEN SKIP
7815 Q$=R$(113,10); GOSUB 7600; IF X$<=A$(126,6) THEN SKIP=1; GOTO 7840; REM 'IF INCOMING RECORDS LAST ORDER DATE IS OLDER THAN THE EXISITNG FORM RECORD THEN SKIP
7840 RETURN 
8700 REM "Build inventory item & write out
8705 DIM D$(188),D[40]
8710 D$(1,20)=A$(1,20),D$(21,40)=A$(42,40),D$(61,3)=A$(21,3),D$(64,18)=A$(24,18),D$(82,14)=A$(82,14),D$(120,8)=A$(100,4)+A$(100,4)
8715 D[0]=A[3],D[14]=A[4],D[15]=A[4],D[17]=A[1],D[18]=A[1],D[19]=A[0]
8720 IF STP(R$(592,4),3," ")="" THEN GOTO 8725 ELSE DIM X$(100); X=0,X$(1)="U/M "+R$(592,4); FIND (Z[12],KEY=X$(1,24),DOM=8721)X$,X; D$(124,4)=X$(25,4); GOTO 8722
8721 X$(25)=R$(592,4); WRITE (Z[12],KEY=X$(1,24))X$; GOTO 8720
8722 D[15]=X
8723 IF STP(R$(596,10),3," ")="" THEN GOTO 8724 ELSE D[15]=NUM(R$(596,10),ERR=8724)
8740 WRITE (Z[4],KEY=D$(1,20))IOL=0340
8745 RETURN 
8920 DEF FNS$(Z9$)=Z9$(1,POS(S9$=Z9$+S9$)-1)
8930 DEF FNQ$(Z9$,Z9)=STR(NUM(Z9$):Z1$(1,Z9))
8940 DEF FNE$(Z9)=CHR(ASC("A")+INT(Z9/10))+STR(MOD(Z9,10))
8950 DEF FNS(Z9$)=POS(" "<>Z9$)
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 DROP "CA2CVT",ERR=9921; DROP "YUCASE",ERR=9921
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
