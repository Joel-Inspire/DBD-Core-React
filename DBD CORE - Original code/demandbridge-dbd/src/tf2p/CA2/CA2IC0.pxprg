0010 REM "Convert Item Master File STD <CA2IC0>
0020 SETESC 9300; SETERR 9000
0035 REM "5.2 - 08/20/03 - 11.417222 - dmm - SSP# 163697
0040 REM "Copyright 2003 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0080 BEGIN 
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0110 X0$="CA2IC0",X1$="Convert to TopForm Item Master File"
0120 DIM Z0$(80,"-"),Z1$(20,"0")
0130 K0=20,K1=1
0135 C9=-1
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=ESC+"BG"+Z0$+ESC+"EG"
0300 REM "IOLISTS
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24],A[25],A[26],A[27],A[28],A[29],A[30],A[31],A[32],A[33],A[34],A[35],A[36],A[37],A[38],A[39],A[40]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15]
0340 IOLIST D$,D[0],D[1],D[2],D[3]
0350 IOLIST E$,E[0],E[1],E[2]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="02O IC0...  03O AR1...  04O AP4...  05O FM1...  06O FM2...  11O CA0... 12O MAPDAT  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0535 READ (Z[11],KEY="IC0 ")CA0$
0600 REM "
0605 READER$="CA2R"+STP(CA0$(25,2),1)
0610 GOSUB 6000
0615 CALL READER$,X3$,X4$,CA0$,CA1${ALL},"O","",MEM${ALL},R$,RET_CODE
0640 CALL "ZZPROM",".Y",X3$,Z,"Proceed?","","",0; ON Z GOTO 0641,9900
0700 REM 'CALL "ZZINIT",STR(Z[2]:"00")
0710 X$="AP4 P/C U/M AR1 ",C5$="-/|\"
0720 FOR I=1 TO LEN(X$) STEP 4
0730 CALL "ZZPROM",".Y",X3$,Z,"Clear Mapping for "+X$(I,3)+"?","","",0; ON Z GOTO 0731,0790
0735 PRINT @(20,20),"Clearing",
0740 READ (Z[12],KEY=X$(I,4),DOM=0741)
0750 READ (Z[12],END=0790)R2$
0755 C5=C5+1; PRINT @(29,20),C5$(MOD(C5,3)+1,1),
0760 IF X$(I,4)<>R2$(1,4) THEN GOTO 0790
0770 REMOVE (Z[12],KEY=R2$(1,24))
0780 GOTO 0750
0790 PRINT @(20,20),'CL',
0795 NEXT I
0920 H0$=$0A$
0940 READ (Z[12],KEY="*PARAMETERS")P9$
0950 ADDR "CA2CVT"
1000 REM "Read Data file
1010 DIM R$(1000); CALL READER$,X3$,X4$,CA0$,CA1${ALL},"R","",MEM${ALL},R$,RET_CODE; IF RET_CODE=2 THEN GOTO 5000
1180 GOSUB 2000
1900 GOTO 1000
2000 REM "Initialize TopForm Record
2100 DIM A$(187),A[40],S$(50),C[15]
2110 IF CA0$(27,1)="G" AND R$(1,4)="0000" THEN R$(1,17)=""; GOTO 2225
2200 REM "Customer Code
2205 A$(1,10)=STR(NUM(R$(1,2)):"00")+R$(3,6)
2210 FIND (Z[3],KEY=A$(1,10),DOM=2211)IOL=0330; GOTO 2224
2212 DIM X$(100),C$(LEN(C$)); X$(1)="AR1 "+A$(1,10); READ (Z[12],KEY=X$(1,24),DOM=2213)X$; A$(1,10)=X$(25,10); FIND (Z[3],KEY=A$(1,10),DOM=2224)IOL=0330
2213 X$(25,10)=A$(1,10); WRITE (Z[12],KEY=X$(1,24))X$
2225 REM "Form Number
2235 A$(11,10)=R$(18,15); READ (Z[2],KEY=A$(1,20),DOM=2236); REM ESCAPE
2250 REM "Product Code
2260 Q$=R$(73,3); DIM X$(100); X$(1)="P/C "+Q$,I1=61,I2=3; GOSUB 7500
2280 REM "Left - Right
2290 A$(64,8)=R$(76,8)
2300 REM "Top-Bottom
2310 A$(72,8)=R$(84,8)
2320 REM "Number of Plys
2330 A$(80,2)=STR(NUM(R$(92,2)):"00"); IF A$(80,2)="00" THEN A$(80,2)=""
2340 REM "Description
2350 A$(21,40)=R$(33,40)
2360 REM "Vendor Code
2370 Q$=R$(94,15)
2380 DIM X$(100); X$(1)="AP4 "+Q$,I1=82,I2=10; GOSUB 7500
2390 FIND (Z[4],KEY=A$(82,10),DOM=2391); GOTO 2400
2395 DIM X$(100); X$(1)="AP4 "+A$(82,10); WRITE (Z[12],KEY=X$(1,24))X$
2400 REM "Plant Code
2410 A$(92,4)=R$(109,4)
2420 REM "Inventory Unit of Measure
2425 Q$=R$(139,4); IF Q$="  " THEN Q$="M "
2430 DIM X$(100); X$(1)="U/M "+Q$,I1=124,I2=4; GOSUB 7500
2440 IF X>0 THEN A[15]=X ELSE IF X=0 THEN A[15]=1
2450 REM SELL UNIT OF MEASURE
2455 Q$=R$(135,4); IF Q$="  " THEN Q$="M "
2460 DIM X$(100); X$(1)="U/M "+Q$,I1=120,I2=4; GOSUB 7500
2470 IF X>0 THEN A[14]=X ELSE IF X=0 THEN A[14]=1
2480 REM "Last Sold Date
2490 Q$=R$(113,10)
2500 GOSUB 7600; A$(96,6)=X$
2510 REM "Last Purchased Date
2520 Q$=R$(123,10)
2530 GOSUB 7600; A$(102,6)=X$
2540 REM "Status Flag - I=inactive
2550 IF R$(133,1)="I" THEN A$(108,1)=R$(133,1)
2570 REM "Item Price Class
2580 A$(109,3)=""
2590 REM "Lot Inventory for this Item
2600 A$(112,1)=R$(134,1)
2620 REM "Quantity Break Price Group
2630 A$(113,3)=""
2640 REM "Secured Form?
2650 A$(116,1)=""
2660 REM "*unused
2670 A$(117,3)=""
2680 REM "Second Description Line
2690 A$(128,40)=""
2700 REM "Form Group
2710 A$(168,10)=R$(143,10)
2720 REM "Form Pricing Features
2730 A$(178,10)=""
2740 REM "Unit Selling Price
2750 Q$=R$(153,15)
2760 GOSUB 7650
2770 A[0]=X
2800 REM "Quantity Break Pricing
2850 FOR I=1 TO 12
2855 IF I>6 THEN J=I+20 ELSE J=I
2870 Q$=R$(273+(I-1)*15,15)
2900 GOSUB 7650; A[J]=INT(X)
2910 Q$=R$(453+(I-1)*15,15)
2950 GOSUB 7650; A[J+1]=X
2960 NEXT I
2980 REM "*Not used (avg sales price for fms)
2990 A[13]=0
3000 REM "Qty/Selling Unit of Measure
3005 IF A$(120,4)="M   " THEN A[14]=1000; GOTO 3021
3010 IF A[14]>0 THEN GOTO 3030 ELSE Q$=R$(213,15)
3020 GOSUB 7650; A[14]=INT(X)
3030 REM "Qty/Inventory Unit of Measure
3035 IF A$(124,4)="M   " THEN A[15]=1000; GOTO 3051
3040 IF A[15]>0 THEN GOTO 3200 ELSE Q$=R$(228,15)
3050 GOSUB 7650; A[15]=X
3200 REM "Carton Weight
3210 Q$=R$(243,15)
3220 GOSUB 7650; A[16]=X
3230 REM "Last Purchase Cost
3240 Q$=R$(198,15)
3250 GOSUB 7650; A[17]=X
3260 REM "Average Cost
3270 Q$=R$(168,15)
3280 GOSUB 7650
3290 A[18]=X
3295 IF A[18]=0 THEN A[18]=A[17]; REM "If 0 set from last cost if available
3300 REM "Carton Pack
3310 Q$=R$(258,15)
3320 GOSUB 7650; A[19]=INT(X)
3330 IF R$(135,1)="N" AND A[14]=1 THEN A[14]=A[19],A[15]=A[19]; REM "If cases (N) then bump up to case pack
3335 REM "Salesperson unit cost
3340 Q$=R$(183,15)
3350 GOSUB 7650; A[20]=INT(X)
4000 REM "Custom code
4900 REM "Write file(s)
4910 WRITE (Z[2],KEY=A$(1,20))IOL=0310
4920 C2=C2+1
4930 REM "Setup FM1 record
4931 IF POS(" "<>A$(1,10))=0 THEN GOTO 4950
4932 FIND (Z[5],KEY=A$(1,20),DOM=4933); GOTO 4950; REM "if already setup, don't do again
4935 CALL "FM2UBI",X3$,A$(11,10),A$(1,10),"C",A$(1,10),"",C3
4990 RETURN 
5000 REM "EOJ
5010 GOSUB 5200
5020 CALL "ZZPROM",".4",X3$,Z,"Process complete!!","","",0
5040 GOTO 9900
5200 REM "COMPLETE CYCLE
5290 RETURN 
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6020 PRINT @(0,4),"This program converts the Item Master File to TopForm's IC0."
6025 PRINT @(0,5),"This program also clears the form master & creates new ones."
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
7500 REM "Generalized Mapping
7520 FIND (Z[12],KEY=X$(1,24),DOM=7521)X$,X; A$(I1,I2)=X$(25,I2); GOTO 7590
7530 IF X$(1,3)="AP4" THEN Q$="00"+Q$
7560 X$(25)=Q$; WRITE (Z[12],KEY=X$(1,24))X$; GOTO 7520
7590 RETURN 
7600 REM "Generalized Date conversion
7610 IF FNS$(Q$)="" THEN X$=""; GOTO 7640
7620 CALL "CA2CVT",X3$,X4$,P9$(1,2),Q$,0,X$,0,"",0
7640 RETURN 
7650 REM "Generalized Numeric conversion
7660 IF FNS$(Q$)="" THEN X$="",X=0; GOTO 7690
7670 CALL "CA2CVT",X3$,X4$,P9$(5,2),Q$,0,X$,X,"",0
7690 RETURN 
8920 DEF FNS$(Z9$)=Z9$(1,POS("             "=Z9$+"             ")-1)
8930 DEF FNQ$(Z9$,Z9)=STR(NUM(Z9$):Z1$(1,Z9))
8940 DEF FNE$(Z9)=CHR(ASC("A")+INT(Z9/10))+STR(MOD(Z9,10))
8950 DEF FNS(Z9$)=POS(" "<>Z9$)
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 DROP "CA2CVT",ERR=9921
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
