0010 REM "Format Driven Purchase Order Printing <PO2PAB>
0035 REM "5.7 - 01/25/24 - 12.516317 - crg - SSP# 307472
0037 REM "307472-DBD-395: PO Printing - Companion items and Special shipping 
0040 REM "Copyright 2024 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 SETERR 0060; ENTER Q0$; CALLED$="Y"; GOTO 0091; REM "Called from PO2PAY, WO131248
0080 REM 
0085 IF J9=-99 THEN J9=0; SETERR 9000; GOTO 0650
0087 IF %GUI THEN CLEAR ; GOTO 0091
0090 BEGIN 
0091 SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="PO2PAB",X1$="Purchase Order Printing"
0120 DIM A$(0),B$(82),B[27],C$(350),L$(21),L[1],H$(315),H0$(315),D6$(402),B0$(204),B0[21],Z8$(20),B1$(356),B1[29],D62$(402),DIV$(402) ! WO238337
0140 M0$="######.00-",M1$="#####,###.00-",M2$="##,###,##0-",M3$="###,##0-",M4$="-00000000.00",M4=LEN(M4$),M6$="###.0-",M5$=M0$(1,LEN(M0$)-1)+"#"
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0180 DEF FNS$(Z9$)=Z9$(1,POS(Z8$=Z9$+Z8$)-1)
0185 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
0190 DEF FNT$(Z9$)=Z9$(1,POS(Z8$=Z9$+Z8$))
0210 T=1,T0=1,T1=1
0220 W3=120
0230 DIM T3$(50,"*"),Y5$(131),Y6$(131),W[4],E[3]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9930 ! #SSP#214091
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0292 REM "Initialize logging
0294 IF %UNATTEND THEN {
0296 LOG_OPTIONS$="A",LOG_FILE$="UNATTENDED."+%UNATTEND_GROUP$+"."+FN%GET_BASENAME$(PGN)+".log"; CALL "ZZ2LOG;OPEN_LOG",ERR=*NEXT,X3$,X4$,LOG_FILE$,LOG_OPTIONS$,%LOG_CHANNEL
0297 IF NOT(%LOG_CHANNEL) THEN %LOG_CHANNEL=FN%FFN(LOG_FILE$) ! In case the file was already open in a previous call (to handle second printing scenario)
0298  }
0300 REM "I/O lists
0305 REM "IOLIST FOR PO1 - Purchase order header
0310 IOLIST A$(1)
0315 REM "IOLIST FOR PO2 - Purchase order lines
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21],B[22],B[23],B[24],B[25],B[26],B[27]
0325 REM "IOLIST FOR FS1 - Sales order Header
0330 IOLIST C$(1),DEP_AMT
0335 REM "IOLIST FOR AR1 - Customer Masterfile
0340 IOLIST D$
0345 REM "IOLIST FOR FM0 - Location Masterfile
0350 IOLIST E$,E[0],E[1]
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14],F[15],F[16],F[17]
0365 REM "IOLISTS FOR FMP - Codes - G2$=Vendor master
0370 IOLIST G$
0371 IOLIST G0$
0372 IOLIST G1$
0373 IOLIST G2$
0375 REM "IOLISTS FOR AR3 - Salesperson
0380 IOLIST H$
0382 IOLIST H0$
0383 IOLIST H1$
0385 REM "IOLIST FOR FMS - Item Specification II
0390 IOLIST I$
0395 REM "IOLIST FOR FMU - Ply ( line detail )
0400 IOLIST J$(1)
0405 REM "IOLIST FOR FMV - Item spec comments
0410 IOLIST K$
0420 IOLIST L$,L[0],L[1]
0425 REM "IOLIST FOR FSH - O/P Division Information
0430 IOLIST D6$
0435 IOLIST D62$ ! WO238337 - Alternate division fields printing
0440 IOLIST I6$
0445 REM "IOLIST FOR FS2
0450 IOLIST B0$,B0[0],B0[1],B0[2],B0[3],B0[4],B0[5],B0[6],B0[7],B0[8],B0[9],B0[10],B0[11],B0[12],B0[13],B0[14],B0[15],B0[16],B0[17],B0[18],B0[19],B0[20],B0[21]
0451 REM "Second IOLIST for FS2, ssp91762
0452 IOLIST B1$(1),B1[0],B1[1],B1[2],B1[3],B1[4],B1[5],B1[6],B1[7],B1[8],B1[9],B1[10],B1[11],B1[12],B1[13],B1[14],B1[15],B1[16],B1[17],B1[18],B1[19],B1[20],B1[21],B1[22],B1[23],B1[24],B1[25],B1[26],B1[27],B1[28],B1[29]; REM "Use for extract
0453 IOLIST B1$(1),B1[0],STR(B1[1]),B1[2],B1[3],STR(B1[4]),B1[5],B1[6],B1[7],B1[8],B1[9],B1[10],B1[11],B1[12],B1[13],B1[14],STR(B1[15]),B1[16],B1[17],STR(B1[18]),B1[19],B1[20],B1[21],STR(B1[22]),B1[23],B1[24],B1[25],B1[26],B1[27],B1[28],B1[29]; REM "Use for write
0455 REM "IOLIST FOR AR4
0460 IOLIST C0$,C0[0],C0[1],C0[2],C0[3],C0[4],C0[5],C0[6],C0[7],C0[8],C0[9],C0[10],C0[11],C0[12],C0[13],C0[14],C0[15]
0490 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0495 IOLIST X$(1),X[0],X[1],X[2],X[3],X[4],X[5],X[6],X[7],X[8],X[9],X[10],X[11],X[12],X[13],X[14],X[15],X[16],X[17],X[18],X[19],X[20],X[21],X[22],X[23],X[24],X[25],X[26],X[27],X[28],X[29],X[30],X[31],X[32],X[33],X[34],X[35],X[36],X[37],X[38],X[39],X[40]
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01X PO6...  02O PO1...  03O PO2...  04O IC2...  05O IC0...  06O PO3...  07O FM0...  08O FMP...  09O AR4...  10O FS2...  11O POE...  13O ZZPARM  14O FM0...  15O AR3...  16O AP4...  17O PO4...  180 FM1...  190 FS1... 20O EC6... 21O EC8... 22O FMN...  23O AR4...  24O EF3...  25O FV1...  26O SH5...  27OSPO2...  " ! ssp#148606, 307310
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0535 B9=0; CALL "BC2VER",ERR=0536,"","",""; B9=1; REM "B9=1 means use Barcode module
0540 IF B9=1 THEN GOTO 0550 ELSE FIND (Z[13],DOM=0541,KEY="FORMATPO"+V0$(60,1)); GOTO 0550
0545 CALL "ZZPROM",".4",X3$,0,"Invalid Flexible Format Code: "+V0$(60,1),"","",0; GOTO 9900
0550 FIND (Z[13],KEY=X3$(9,3)+"F/M",ERR=9900)P9$ ! SSP#266959
0560 FIND (Z[13],KEY=X3$(9,3)+"A/R",ERR=9900)P8$ ! SSP#266959
0570 FIND (Z[13],KEY=X3$(9,3)+"AR1",ERR=9900)P4$ ! SSP#266959
0575 FIND (Z[13],KEY="CMP"+X3$(9,3),ERR=9900)N1$ ! SSP#266959 
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0590 PRT_BLNK$=""; IF MID(P9$,332,1)="Y" THEN PRT_BLNK$="Y" ! SSP 246624
0592 DFLT_CNTRY$=""; IF STP(MID(P9$,344,2),2)<>"" THEN DFLT_CNTRY$=MID(P9$,344,2) ! SSP 307210
0600 REM "READ IN FORMATTING, SET W3 ETC.
0605 M0=211; REM "Number of fields on flexible format ! ssp#148606,166626,WO236789,WO239001,WO241399, SSP244403, WO250763!IDB#16629, WO268933, WO275772, WO275705, SSP291991, SSP307210, SSP307287-DBD-116, SSP307417-DBD-282, SSP307433-DBD-332, DBD-322
0610 DIM X9[M0],Y9[M0],X9$(M0),Y8[3],Y8$(35)
0615 IF B9=1 THEN DIM D9$(11); D9$(1)="850",D9$(11,1)=V0$(60,1); CALL "BC2FMZ",X3$,X4$,D9$,A0$,A0{ALL},X9{ALL},X9$,Q1$,Q{ALL},C0; IF C0=0 THEN Y8[0]=A0[0],Y8[1]=A0[2],Y8[2]=A0[4],Y8[3]=A0[5],Y9[32]=A0[6]; GOTO 0625 ELSE B9=0; GOTO 0540
0620 IF CALLED$="Y" THEN CALL "PO2PAX",X3$,X4$,Z{ALL},V0$(60,1),X9{ALL},Y9{ALL},X9$,Y8{ALL},Y8$ ELSE RUN "PO2PAX"; REM "WO131248
0650 REM "RETURN FROM PO2PAX
0655 W3=Y8[1]
0660 DIM Y5$(W3),Y6$(W3)
0665 GOSUB 8650
0700 REM "Open Printer
0730 CALL "ZZDAPP",X3$,"DZZFLESZZENTRZZCOMP"
0735 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0736,9930 ! SSP#214091
0736 IF RETURN$="Y" THEN RETURN ; REM "WO131248
0740 W0=60
0745 X$=V3$,F_CODE$="850"+DIM(7)+V0$(60,1); CALL "EF2PRM",ERR=0746,X3$,X4$,X$,P6$,F6$,F_CODE$,ITEM_PARM$; IF P6$(144,2)="JF" THEN JETFORM_MODE=1,JETFORM_DEV=W9,PMODE=JETFORM_MODE ELSE IF P6$(144,2)="UF" THEN UNFORM_MODE=2,UNFORM_DEV=W9,PMODE=UNFORM_MODE ! SSP 241023
0750 GOSUB 8100
0755 IF W6$<>"" THEN Y$="12O "+W6$+" "; CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1; W6=Z[12]; IF W6$(1,1)="N" THEN X$=FN%FID$(Z[12]); CALL "EF2PRM",ERR=0756,X3$,X4$,X$,P6$,F6$ ! [205703]-changed FID() to FN%FID$()        
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[2]; U=10,U0=2,U[0]=0,U[1]=1,U[2]=9,T0=0,U0$="    ",T5$="                "; GOTO 0850
0830 DIM U[3]; U=23,U0=3,U[0]=0,U[1]=10,U[2]=4,U[3]=9,T0=0,U0$="    ",T5$="                "; GOTO 0850; REM "WO118969
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 U1=Z[1]; IF V0=2 THEN U1=Z[17]
0920 IF V0=1 THEN V2$=V2$(1,20)
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
0995 IF Q5=0 THEN IF CALLED$<>"Y" THEN GOSUB 6000; REM "WO131248
1000 REM "Read next record
1005 U$=KEY(U1,END=5000); READ (U1)
1006 IF V0=1 AND U$(1,1)<>"P" THEN GOTO 5000
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])<V2$(U3,U[U9]) THEN EXITTO 1000
1030 IF U$(U2,U[U9])>V2$(U3+U[U9],U[U9]) THEN IF U=1 THEN EXITTO 5000 ELSE EXITTO 1000
1040 NEXT U9
1100 REM "Get record"
1110 U9$=U$
1120 ON V0 GOTO 1150,1150,1130,1140
1130 READ (Z[1],KEY="P"+U$(15,9),DOM=1000); HOLD_U$=U$,U$="P"+U$(15,9),U9$=U$; REM "V0=2, print by vendor, WO118969 ssp 248242
1150 DIM A$(383); READ (Z[2],KEY=U$(2,9),ERR=1000,DOM=1000)IOL=0310
1154 REM "Selecitve printing by P/O code?
1155 IF P9$(185,1)="Y" AND POS(" "<>V0$(72,10))>0 THEN IF A$(305,1)=" " AND POS("!"=V0$(72,10))=0 THEN GOTO 1000 ELSE IF POS(A$(305,1)=V0$(72,10)+" ")=0 THEN GOTO 1000
1160 REM " 145495 Line is at 1180 the correct place, ->IF V0$(82,2)="  " THEN GOTO SKIP_HOME_DIV ELSE DIM AR3$(236); IF POS(" "<>A$(343,4))>0 THEN FIND (Z[15],KEY=A$(343,4),DOM=1161)AR3$ ELSE FIND (Z[15],DOM=1161,KEY=A$(347,4))AR3$
1170 IF V0$(96,2)="  " THEN GOTO SKIP_DEF_PRINT
1172 DIM C$(350); EXTRACT (Z[19],KEY=A$(306,8),BSY=1000,DOM=SKIP_DEF_PRINT)IOL=0330
1174 DIM OTMP$(500); FIND (Z[13],KEY="o"+C$(169,3),DOM=SKIP_DEF_PRINT)OTMP$
1176 IF OTMP$(59,2)<>V0$(96,2) THEN GOTO 1000
1179 SKIP_DEF_PRINT:
1180 IF V0$(82,2)="  " THEN GOTO SKIP_HOME_DIV ELSE DIM AR3$(236); IF POS(" "<>A$(343,4))>0 THEN FIND (Z[15],KEY=A$(343,4),DOM=1161)AR3$ ELSE FIND (Z[15],DOM=1181,KEY=A$(347,4))AR3$
1182 IF POS(X3$(9,3)="500139",3)<>0 THEN IF V0$(82,2)<>DIM(2) AND AR3$(235,2)=DIM(2) THEN FIND (Z[15],DOM=1181,KEY=A$(347,4))AR3$; REM "ssp# 200531
1185 IF V0$(82,2)<>AR3$(235,2) THEN GOTO 1000
1190 SKIP_HOME_DIV:IF Q5=1 THEN CALL "ZZDISP","A",A$(297,9),"P/O",X3$,"","",34,21,X4$; IF A$(189,1)<>"P" THEN GOTO 1000 ELSE REMOVE (Z[1],KEY=U$,DOM=1000); GOSUB 7900; GOSUB 7550; GOTO 1000
1300 REM "Read other data
1305 P0=1,FIRST_PASS=1,TEXT_MODE=0
1310 Y$="05C IC0...  06C PO3...  07C FM0...  10C FS2...  11C POE...  05O AR1...  06O AP2...  10O FSH...  11O FSV...  "
1315 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
1317 XP=PRM('XI'); SET_PARAM 'XI'
1320 DIM C$(350); FIND (Z[19],KEY=A$(306,8),DOM=1323)IOL=0330
1321 SET_PARAM 'XI'=XP
1323 IF D6$(1,2)<>A$(297,2) THEN DIM D6$(402); FIND (Z[10],KEY=A$(297,2),DOM=1324)IOL=0430
1324 GOSUB AR3_ALT_DIV ! WO238337 - check salesperson record for alternate division for PO printing of fields 104 and 158, either way put division info into DIV$ for these fields (2117-2119, 2137-2138)
1335 DIM D$(225); FIND (Z[5],KEY=A$(179,10),DOM=1336)IOL=0340; IF X9[137]>0 AND POS(" "<>D$(46,10))>0 THEN FIND (Z[5],KEY=D$(46,10),DOM=1336)IOL=0340
1338 IF P4$(64,1)<>"Y" OR P8$(109,1)<>"Y" THEN GOTO 1340 ELSE FIND (Z[11],KEY=A$(306,8),DOM=1339)X$; D$(56,87)=X$(54,87); IF POS(X9$(1,1)="N",1)<>0 AND X$(19,35)<>DIM(35) THEN D$(11,35)=X$(19,35) ! SSP#238796
1340 IF A$(173,1)="S" THEN C$(89,8)=A$(347,4)+A$(343,4),C$(28,15)=A$(328,15)
1350 DIM H$(315); FIND (Z[15],KEY=C$(89,4),DOM=1351)IOL=0380
1355 DIM H0$(315); FIND (Z[15],KEY=C$(93,4),DOM=1356)IOL=0382
1360 DIM G2$(426); FIND (Z[16],KEY=A$(7,10),DOM=1361)IOL=0373; GOSUB GET_JOBCARD; IF POS(" "<>G2$(221,2))>0 THEN TEXT_MODE=1,FORMAT$=G2$(221,2); REM "WO126561, write text file
1365 DIM H1$(52); FIND (Z[6],KEY=A$(210,2),DOM=1366)IOL=0383
1370 Y$="05C AR1...  06C AP2...  10C FSH...  11C FSV...  05O IC0...  06O PO3...  07O FM0...  10O FS2...  11O POE...  "
1375 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
1380 GOSUB 7500
1500 REM "Print Data
1515 P1=1,P2=1
1520 IF P1>P0 THEN GOTO 1700
1530 GOSUB 5400
1540 GOSUB 5500
1560 GOSUB 2000
1580 P1=P1+1
1590 GOTO 1520
1800 REM "fix printed flag
1810 A$(189,1)="P"
1815 GOSUB CHECK_CHANGES ! 252766
1820 WRITE (Z[2],KEY=U$(2,9))IOL=0310
1900 REM "Accumulate Totals"
1990 T[T0,0]=T[T0,0]+1
1991 IF TEXT_MODE THEN CALL "PO2PAT",X3$,X4$,FORMAT$,HEADER${ALL},LINE${ALL},NUM_LINES,X9$; REM "WO126561, call routine to write out text records of PO information
1992 IF DO_2 THEN IF FIRST_PASS THEN FIRST_PASS=0,HOLD_W9=W9,W9=W6,HOLD_JF_MODE=JETFORM_MODE,JETFORM_MODE=0; GOTO 1380 ELSE W9=HOLD_W9,JETFORM_MODE=HOLD_JF_MODE
1994 ! IF V3$(2,1)<>"T" AND POS(" "<>V0$(84,12))>0 AND POS(" "<>A$(297,9))>0 THEN CLOSE (W9); CALL "PO2PAY",X3$,X4$,V0$(84,12),A$(297,9); RETURN$="Y"; GOSUB 0735; RETURN$="N"; IF V0=2 THEN U$=HOLD_U$ END_IF ; READ (U1,KEY=U$); Y$="09C AR4...  09O AR4...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1; REM "WO131248 SSP 248242
1995 GOTO 1000
2000 REM "Print a P/O
2002 IF %UNATTEND THEN CALL "ZZ2LOG;LOG_MSG",ERR=*NEXT,X3$,X4$,%LOG_CHANNEL,"INFO|"+FN%ZZDISP$(PAD(MID(U$,2),9),"P/O")+"|"+TBL(CALLED$="Y","","SECOND PRINTING|"),%LOG_DEBUG
2005 S0$="",S2$=""; GOSUB SET_JOB_MODIFIER; IF TEXT_MODE THEN DIM HEADER$[M0]; NUM_LINES=LEN(P3$)/3,ON_LINE=0; IF NUM_LINES=0 THEN NUM_LINES=1 END_IF ; DIM LINE$[NUM_LINES,M0]
2006 IF NUM(HIGHEST$)>NUM_LINES THEN DIM LINE$[NUM(HIGHEST$),M0]; REM SSP 214091
2007 IF B9=1 THEN F5=0,F5$=""; GOSUB 8300; REM "To print headings and messages for this item
2010 GOSUB 2100
2020 GOSUB 2150
2030 GOSUB 2200
2035 GOSUB 3000
2037 GOSUB ORDER_CUST_REFS ! WO275772
2040 GOSUB 2350
2050 GOSUB 2400
2055 IF P7$<>"" THEN F5=24,F5$=STR(B7:M0$); GOSUB 8300; F5=97,F5$=STR(B5:M0$); GOSUB 8300; F5=99,F5$=STR(B6:M0$); GOSUB 8300; F5=132,F5$=STR(B8:"###"+M2$); GOSUB 8300
2060 IF A$(173,1)<>"S" AND P7$<>"" THEN F5=125,F5$=STR(B5-B7:M0$(2)); GOSUB 8300; F5=127,F5$=STR(B5-B7-B6:M0$(2)); GOSUB 8300; IF B5<>0 THEN F5=126,F5$=STR((B5-B7)*100/B5:M6$); GOSUB 8300; F5=128,F5$=STR((B5-B7-B6)*100/B5:M6$); GOSUB 8300
2070 IF POS("X"<>A$(297,9))=0 THEN RETURN ELSE IF C1>1 THEN GOSUB 5700; GOSUB 4500 ELSE IF S0$<>"" THEN GOSUB 4000
2075 IF P1=1 THEN GOSUB 4700
2080 GOSUB 8800
2081 IF P0>1 AND P1=1 THEN GOSUB 8850
2085 GOSUB 2900
2090 RETURN 
2100 REM "Print very top
2105 IF JETFORM_MODE THEN P$="" ELSE DIM P$(Y8[0]*W3)
2106 PDF_SEQ$=A$(1,1); IF PDF_SEQ$=DIM(1) THEN PDF_SEQ$="0" ! SSP227065   
2117 F5=104,F5$=DIV$(11,35); GOSUB 8300 ! WO238337 - changed to DIV$
2119 IF X9[104]<>0 THEN IF JETFORM_MODE THEN F5=104,F5$=DIV$(46,35); GOSUB JETFORM_PRINT; F5$=DIV$(81,35); GOSUB JETFORM_PRINT ELSE P$((Y9[104]+1)*W3+X9[104],35)=DIV$(46,35),P$((Y9[104]+2)*W3+X9[104],35)=DIV$(81,35) ! WO238337 - changed to DIV$
2120 CALL "ZZDISP","AX",A$(297,9),"P/O",X3$,X$,"",0,0,X4$; P5$=X$
2122 F5=5,F5$=X$; GOSUB 8300; F5=149,F5$=X$; GOSUB 8300; REM "WO108533, 2nd printing of order number
2123 OP$=MID(C$,172,3); IF STP(OP$)="" THEN OP$=A$(358,3) END_IF ; IF STP(OP$)="" THEN OP$=X3$(40,3) ! SSP 191685
2124 IF ((POS("J1"=V0$(59,12))<>0 OR UNFORM_MODE) AND J1_PREV_PO_NUM$=A$(297,9)) THEN GOTO *NEXT ELSE F5=180,F5$=STP("PDFFILE:"+X3$(9,3)+DLM+"PO"+DLM+OP$+DLM+P5$+"+"+STR(P2),3," ")+"_"+PDF_SEQ$; GOSUB 8300 ! 166626 !SSP 191685 SSP 227065,  SSP 236695,245519
2125 IF POS(" "<>C$(55,6))<>0 THEN F5=6,F5$=FND$(C$(55,6)); GOSUB 8300
2127 F5=166,F5$=C$(64,6); GOSUB 8300; REM " SSP# 152507 CUSTOMER CHECK NUMBER
2128 F5=167,F5$=FND$(C$(70,6)); GOSUB 8300; REM " SSP# 152507 CUSTOMER CHECK DATE  
2129 F5=168,F5$=STR(DEP_AMT:"###,###.00-"); GOSUB 8300; REM " SSP# 152507 CUSTOMER CHECK AMOUNT
2130 F5=122,F5$=C$(129,20); GOSUB 8300
2131 F5=179,F5$="VENDOR QUOTE #: "; GOSUB 8300; REM " SSP# 152507
2134 ORDER$=A$(297,8); PERFORM "ECGM3F;GET_3P_INFO",ERR=*NEXT; IF FOUND_3PINFO THEN F5$=STP(ORDER_ID_3P$),F5=210; GOSUB 8300 ! SSP307433-DBD-332, 3rd Party Order ID DBD-380-SSP307446
2135 F5=157,F5$=MID(C$,203,20); GOSUB 8300; REM "WO124448
2137 F5=158,F5$=DIV$(198,35); GOSUB 8300; REM "WO120604, WO238337 - changed to DIV$
2138 IF X9[158]>0 THEN IF JETFORM_MODE THEN F5=158,F5$=DIV$(233,35); GOSUB JETFORM_PRINT; F5$=DIV$(268,35); GOSUB JETFORM_PRINT; F5$=DIV$(303,35); GOSUB JETFORM_PRINT ELSE P$((Y9[158]+1)*W3+X9[158],35)=DIV$(233,35),P$((Y9[158]+2)*W3+X9[158],35)=DIV$(268,35),P$((Y9[158]+3)*W3+X9[158],35)=DIV$(303,35); REM "WO120604, WO238337 - changed to DIV$
2140 RETURN 
2150 REM "Order header info
2154 GOSUB 7600
2155 IF POS(" "<>A$(192,6))<>0 THEN F5=7,F5$=FND$(A$(192,6)); GOSUB 8300; F5=185; GOSUB 8300 ! WO241399, second printing of order date
2156 F5=143,F5$=FNS$(H1$(3,30)); GOSUB 8300
2157 F5=8,F5$=A$(212,12); GOSUB 8300; F5=117,F5$=A$(314,12); GOSUB 8300; F5=118,F5$=STR(NUM(A$(326,2)):"##"); GOSUB 8300
2158 IF POS(" "<>A$(224,6))<>0 THEN F5=9,F5$=FND$(A$(224,6)); GOSUB 8300
2159 CALL "ZZDISP","AX",A$(7,10),"A/P",X3$,X$,"",0,0,X4$
2160 F5=10,F5$=A$(230,12); GOSUB 8300
2161 F5=114,F5$="Vendor Code"; GOSUB 8300; F5=11,F5$=X$; GOSUB 8300
2162 IF POS(" "<>G$(3,15))>0 THEN F5=111,F5$="F.O.B.:"; GOSUB 8300; F5=12,F5$=G$(3,15); GOSUB 8300
2163 IF POS(" "<>A$(291,6))<>0 THEN F5=205,F5$=FND$(A$(291,6)); GOSUB 8300 ! WO275705, Scheduled Shipping Date
2165 F5=13,F5$=G0$(3,15); GOSUB 8300
2166 IF POS(" "<>E$(135,15))>0 THEN F5=112,F5$="INSIDE DELIVERY:"; GOSUB 8300; F5=14,F5$=E$(135,15); GOSUB 8300
2167 F5=110,X$=FND$(A$(242,6)); IF POS(" "<>A$(244,2)+X$(9,2))>0 THEN F5$=A$(244,2)+X3$(59,1)+X$(9,2); GOSUB 8300
2170 F5=15,F5$=G1$(3,15); GOSUB 8300
2171 F5=16,F5$=E$(151,15); GOSUB 8300
2175 F5=115,F5$=FND$(A$(204,6)); GOSUB 8300
2179 IF POS(X3$(9,3)="447",3)>0 THEN IF E$(175,3)="CCA" THEN F5=103,F5$="CRITICAL SHIP DATE REQ'D"; GOSUB 8300; GOTO 2181 ELSE IF E$(175,3)="CPA" THEN F5=103,F5$="CRITICAL PROOF DATE REQUIRED"; GOSUB 8300; GOTO 2181 ELSE IF E$(175,3)="PPA" THEN F5=103,F5$="DATE PROOF REQUIRED"; GOSUB 8300; GOTO 2181 ELSE IF E$(175,3)="FPA" THEN F5=103,F5$="DATE FAX PROOF REQ'D"; GOSUB 8300; GOTO 2181 ELSE IF E$(175,3)="CFA" THEN F5=103,F5$="CRITICAL FAX PROOF DATE REQ'D"; GOSUB 8300; GOTO 2181 ELSE IF STP(E$(175,35),3," ")="" THEN F5=103,F5$="DATE REQUIRED"; GOSUB 8300; GOTO 2181 ELSE IF E$(175,3)="D  " THEN F5=103,F5$="DATE REQUIRED"; GOSUB 8300; GOTO 2181; REM "added D per tkl on 100444, took out company 500, was only for testing
2180 F5=103,F5$=E$(175,35); GOSUB 8300
2182 F5=153,F5$="Proof status:"; GOSUB 8300; REM "WO118420
2183 F5=154; IF A$(284,1)="W" THEN F5$="Waiting"; GOSUB 8300 ELSE IF A$(284,1)="R" THEN F5$="Returned proof"; GOSUB 8300 ELSE IF A$(284,1)="C" THEN F5$="Customer app reqd"; GOSUB 8300 ELSE IF A$(284,1)="H" THEN F5$="Hot"; GOSUB 8300; REM "WO118420
2184 IF J8<>1 AND POS(" "<>A$(285,6))<>0 THEN F5=155,F5$=FND$(A$(285,6)); GOSUB 8300; REM "WO118420
2185 IF A$(1,1)<>" " AND X9$(147,1)=" " THEN F5=147,F5$="*REPRINT* ("+A$(1,1)+")"; GOSUB 8300 ELSE IF A$(1,1)<>" " AND X9$(147,1)="A" THEN F5=147,F5$="AMENDED ("+A$(1,1)+")"; GOSUB 8300 ! SSP#218506, SSP240760                                 
2186 IF A$(351,1)<>" " THEN F5=148,F5$=A$(351,1); GOSUB 8300; REM "ssp93537
2187 F5=186,F5$=D$(11,35); GOSUB 8300 ! WO241399, customer name
2188 IF MID(X9$,206,1)="O" AND E$(363,20)<>DIM(20) THEN F5$=E$(363,20),F5=206; GOSUB 8300; GOTO 2190 ! SSP291991, if PO3 shipper ID not blank and field 206 has O in type field then output in field 206, bypass lookup in SH5 at line 2189.
2189 IF E$(150,1)<>DIM(1) THEN DIM SH5$(36); READ (Z[26],KEY=A$(179,10)+E$(12,4)+E$(150,1),DOM=*NEXT)SH5$(1); IF SH5$(16,20)<>DIM(20) THEN F5=206,F5$=SH5$(16,20); GOSUB 8300 ! SSP291991, shipper ID from SH5 for this customer/shipto/shipvia
2190 RETURN 
2200 REM "Shipto, Soldto, Vender addresses
2205 GOSUB 7750
2206 CNTRY$="" ! SSP 307210
2210 IF C1=1 THEN GOSUB 2300; GOTO 2230
2211 IF LEN(E$)<259 THEN GOSUB 5600 ELSE E0$=E$(225,35)
2212 IF LEN(E$)<299 THEN E$=E$+DIM(299-LEN(E$)); REM "109598, PO3 writing short somewhere, have not been able to find it
2213 IF E$(3,4)<>"    " THEN DIM WHSE$(400); FIND (Z[7],KEY="D"+DIM(10)+E$(3,4),DOM=2214)WHSE$; IF X9[3]<>0 THEN I0=Y9[3]*W3+X9[3],X7$=WHSE$(16,35)+WHSE$(160,20)+DIM(10)+WHSE$(51,87),PRT_WHSE$="Y"; CNTRY$=MID(WHSE$,380,2); GOTO 2220; REM "WO94734, print whse address as ship to rather than customer's ship to address SSP307210
2214 IF E$(3,4)="    " AND E$(295,4)<>"    " THEN DIM PLANT$(400); FIND (Z[7],KEY="P"+E$(285,14),DOM=2215)PLANT$; IF X9[3]<>0 THEN I0=Y9[3]*W3+X9[3],X7$=PLANT$(16,35)+PLANT$(160,20)+DIM(10)+PLANT$(51,87),PRT_PLANT$="Y"; CNTRY$=MID(PLANT$,380,2); GOTO 2220; REM "WO100863, print Plant address as ship to rather than customer's ship to address SSP 307210
2215 IF E$(3,4)="    " AND E$(295,4)="    " AND E$(285,10)<>"          " THEN DIM VEND$(400); FIND (Z[16],KEY=E$(285,10),DOM=2216)VEND$; IF X9[3]<>0 THEN I0=Y9[3]*W3+X9[3],X7$=VEND$(11,35)+DIM(30)+VEND$(46,87),PRT_VEND$="Y"; CNTRY$=MID(VEND$,424,2); GOTO 2220; REM "WO100863, print VENDOR address as ship to rather than customer's ship to address SSP307210  - VEND COUNTRY from AP4
2219 IF X9[3]=0 THEN GOTO 2230 ELSE I0=Y9[3]*W3+X9[3],X7$=E0$(1,35)+E$(16,117); CNTRY$=MID(E$,383,2) ! SSP 307210
2220 GOSUB 5650; F5=3; GOSUB 7700
2230 F5=4,F5$=C$(28,15); GOSUB 8300
2232 F5=207,F5$=MID(E$,383,2); GOSUB 8300 ! SSP307210-DBD-63 Country SSP307307-DBSPT-101107
2235 IF POS(" "<>MID(D$,205,12))>0 THEN CALL "ZZDISP","PX",D$(205,14),"",X3$,F5$,"",0,0,X4$; F5=135; GOSUB 8300
2240 IF POS(" "<>D$(143,12))>0 THEN CALL "ZZDISP","POX",D$(143,12),"",X3$,F5$,"",0,0,X4$; F5=136; GOSUB 8300
2250 IF X9[1]=0 THEN GOTO 2270 ELSE I0=Y9[1]*W3+X9[1],X7$=D$(11,35)+Y6$(1,30)+D$(56,87)
2260 F5=1; GOSUB 7700
2270 IF X9[2]=0 THEN GOTO 2281 ELSE I0=Y9[2]*W3+X9[2],X7$=A$(21,152),CNTRY$=MID(A$,368,2) ! SSP 307210
2280 F5=2; GOSUB 7700
2282 X7$=""; IF POS(" "<>A$(17,4))>0 THEN FIND (Z[7],KEY="P"+A$(7,14),DOM=2283)X7$
2284 IF X7$>"" THEN F5$=X7$(200,14) ELSE F5$=G2$(195,14)
2285 IF POS(" "<>F5$)>0 THEN X$=F5$; CALL "ZZDISP","POX",X$,"",X3$,F5$,"",0,0,X4$; F5=138; GOSUB 8300
2286 IF X7$>"" THEN F5$=X7$(138,12) ELSE F5$=G2$(133,12)
2287 IF POS(" "<>F5$)>0 THEN X$=F5$; CALL "ZZDISP","POX",X$,"",X3$,F5$,"",0,0,X4$; F5=139; IF X9$(139,1)="F" THEN F5$="Fax: "+F5$ END_IF ; GOSUB 8300 ! SSP#219151
2288 F5=140,F5$=G2$(256,15); GOSUB 8300
2289 IF X9[183]<>0 THEN GOSUB GET_SHIP_RECORD ! WO236789, shipping location phone number
2290 F5=184,F5$=E$(12,4); GOSUB 8300 ! WO239001, ship-to location code
2292 IF X9[191]<>0 THEN GOSUB VENDOR_EMAIL_ADDR ! WO250763
2293 IF X9[194]<>0 THEN GOSUB GET_CUST_LOC_CODE; F5=194,F5$=CUST_LOCATION$; GOSUB 8300 ! WO268933
2294 GOSUB GET_SHIP_TO_DESC; F5=209,F5$=SHIP_DESC$; GOSUB 8300 ! SSP307417-DBD-282
2295 RETURN 
2299 ! 
2305 IF Y9[3]=0 AND JETFORM_MODE=0 THEN GOTO 2340 ELSE F5=3,O0=0; REM "SSP#120748 do if jetform mode
2309 REM "If jetform mode then remove asterisks
2310 IF JETFORM_MODE=0 THEN F5$=T3$(1,30); GOSUB 8300
2315 O0=1,F5$="* Multiple ship to addresses *"; IF JETFORM_MODE THEN F5$=F5$(3,LEN(F5$)-4) END_IF ; GOSUB 8320
2320 O0=2,F5$="*   Shipping instructions    *"; IF JETFORM_MODE THEN F5$=F5$(5,LEN(F5$)-6) END_IF ; GOSUB 8320
2325 O0=3,F5$="*     on following pages     *"; IF JETFORM_MODE THEN F5$=F5$(7,LEN(F5$)-8) END_IF ; GOSUB 8320
2330 IF JETFORM_MODE=0 THEN O0=4,F5$=T3$(1,30); GOSUB 8320
2340 RETURN 
2350 REM "Print bottom line
2355 CALL "ZZDISP","AX",A$(179,10),"A/R",X3$,X$,"",0,0,X4$
2360 F5=113,F5$="Customer Code"; GOSUB 8300; F5=25,F5$=X$; GOSUB 8300
2363 X$=" "
2364 ON POS(A$(190,1)="NECSB") GOTO 2380,2365,2366,2367,2368,2369
2365 X$="New"; GOTO 2380
2366 X$="Exact repeat"; GOTO 2380
2367 X$="Copy change"; GOTO 2380
2368 X$="Spec change"; GOTO 2380
2369 X$="Copy+Spec change"; GOTO 2380
2380 F5=26,F5$=X$; GOSUB 8300; F5=189; GOSUB 8300 ! WO241399, second printing of order type
2381 F5=27,F5$=FNT$(H$(149,20)+" "); GOSUB 8300 ! SSP#152175
2382 F5=28,F5$=C$(89,4); GOSUB 8300
2383 F5=29,F5$=FNT$(H0$(149,20)+" "); GOSUB 8300
2384 F5=30,F5$=C$(93,4); GOSUB 8300
2385 IF A$(191,1)="Y" THEN F5=105,F5$="*Confirming*"; GOSUB 8300
2386 IF MID(X9$,151,1)="C" THEN TYPE$="POX",DATA$=H$(189,10) ELSE IF MID(X9$,151,1)="c" THEN TYPE$="PX",DATA$=H$(189,14) ELSE IF MID(X9$,151,1)="E" THEN TYPE$="POX",DATA$=H0$(189,10) ELSE TYPE$="PX",DATA$=H0$(189,14) ! SSP245584, was using H$ which is for CSR! SSP#248161
2387 IF POS(" "<>DATA$)>0 THEN CALL "ZZDISP",TYPE$,DATA$,"",X3$,F5$,"",0,0,X4$; F5=151; GOSUB 8300; REM "WO115716,Salesperson phone number
2388 IF POS(" "<>H0$(127,12))>0 THEN CALL "ZZDISP","POX",H0$(127,12),"",X3$,F5$,"",0,0,X4$; F5=152; GOSUB 8300; REM "WO115716,Salesperson fax number, SSP245584, was using H$ which is for CSR
2390 RETURN 
2400 REM "Print line information
2405 I0=(Y8[2]-1)*W3,I1=0,S0$="",B1=0,B7=0,P7$="",B5=0,B6=0,B8=0,PO_LINE=0
2406 IF C1>2 THEN GOTO 2450 ELSE IF C1=1 AND LEN(P2$)=13 THEN GOTO 2450
2407 IF POS("X"<>A$(297,9))=0 THEN FOR I3=1 TO Y8[3]; GOSUB 2500; NEXT I3
2410 READ (Z[3],KEY=A$(297,9),DOM=2411)
2420 READ (Z[3],END=2490)IOL=0320
2425 IF B$(82,9)<>A$(297,9) THEN GOTO 2490
2426 DIM SPEC_ORD_NUM$(8),SPEC_ORD_LINE_NUM$(3),SPEC_CUST_ITEM$(20); SPEC_ORD_NUM$=B$(82,8),SPEC_ORD_LINE_NUM$=B$(11,3),SPEC_CUST_ITEM$=B$(91,20) ! SSP307287-DBD-116
2430 IF C1<>2 THEN B1=0
2431 PO_LINE=PO_LINE+1,ON_LINE=ON_LINE+1
2432 GOSUB 7850
2434 REM "S2$ is flag to print comments only
2435 IF POS(B$(10,1)="CXI")<>0 AND S0$="" THEN IF B$(81,1)="Y" THEN S0$=B$(91,20)+"001",S8$=A$(297,8)+B$(7,3),S2$=""; GOSUB 8950 ELSE IF B$(81,1)="C" THEN S0$=B$(91,20),S2$="*"; GOSUB 8950
2438 IF I0+F4*W3>=(Y8[2]+Y8[3]-1)*W3 THEN PO_LINE=0; GOSUB 4600 ! SSP#263063
2439 IF P7$="" THEN P7$=B$(25,3); IF P8$(114,1)="Y" THEN CALL "AR2EBJ",X3$,X4$,1,D$(1,10),F5$; IF F5$>"" THEN F5=18; GOSUB 8350; GOSUB 2590; F4=0,PO_LINE=PO_LINE+1; REM "PRINT CUSTOMER COMMENT ON 1ST LINE"                                                                 
2440 GOSUB 2500
2445 GOTO 2420
2450 REM "Print lines from P2$ for spec instr."
2460 READ (Z[6],KEY=P2$(1,13),DOM=2461)IOL=0350
2465 READ (Z[3],KEY=E$(166,9)+E$(7,3),DOM=2466)IOL=0320
2466 READ (Z[3],KEY=A$(297,9)+E$(7,3),DOM=2485)IOL=0320
2470 B1=E[0]; GOSUB 8900; IF L$(20,1)="Y" THEN B1=B1/L[1] ELSE B1=B1/B[2]
2471 GOSUB 2500
2475 IF B$(14,1)="Y" AND NOT(NUL(COMP$)) THEN {! 307472
2476 FOR COMP_I=0 TO LEN(COMP$)/6-1
2477 IF MID(COMP$,COMP_I*6+1,3)=MID(P2$,10,3) THEN READ (Z[27],KEY=A$(297,9)+MID(COMP$,COMP_I*6+4,3),DOM=*NEXT)IOL=0320; GOSUB 2500; PO_LINE++
2479 NEXT COMP_I
2480  }
2485 P2$=P2$(14)
2490 PO_LINE=0
2495 RETURN 
2500 REM "Print one line from B$, I0 is assumed to be set
2503 F4=0,P3=0
2504 REM IF B$(10,1)="I" AND I1>Y8(3)-1 THEN GOSUB 04600 ELSE IF I1>Y8(3) THEN GOSUB 04600
2505 IF B$(10,1)="M" THEN F5=18,F5$=B$(28,40); GOSUB 8350; F5=187; GOSUB 8350; IF B[0]<>0 THEN F5=24,F5$=STR(B[0]:M1$); GOSUB 8350; GOTO 2535 ELSE GOTO 2535 ! WO241399, second printing of description
2506 IF B[2]=0 THEN B[2]=1
2507 F5=31,F5$=B$(7,3); GOSUB 8350
2508 GOSUB 8500; GOSUB 8900
2509 IF L$(21,1)="Y" OR (B$(10,1)="S" AND I1$(61,1)="Y") THEN IF C1<2 THEN P3=B[4]; IF X9[129]=0 OR L$(21,1)="Y" THEN B[0]=B[4] ! SSP#273389
2510 REM "
2511 UM$=B$(77,4),UM0=B[2]; IF C1<2 THEN F5=22,F5$=STR(B[0]:M5$); GOSUB 5900; IF B$(10,1)="M" THEN F5$=DIM(5); GOSUB 8350 ELSE GOSUB 8350; REM "SSP# 208237
2512 F5=23,F5$=UM$; IF MID(X9$,F5,1)="Q" THEN F5$=FNS$(F5$)+"/"+FNR$(STR(UM0:M3$)); GOSUB 8350 ELSE GOSUB 8350
2513 IF B1=0 THEN IF L$(20,1)="Y" THEN B1=B[11]/L[1] ELSE B1=B[11]/B[2]
2515 IF B1<>0 THEN IF FPT(B1)=0 THEN F5=17,F5$=STR(B1:M2$); GOSUB 8350 ELSE F5=17,F5$=STR(B1:M0$); GOSUB 8350
2516 B2=E[0]; IF B2=0 THEN B2=B[11] END_IF ; IF B2<>0 THEN F5=181,F5$=STR(B2:M2$); GOSUB 8350 ! WO168289
2517 IF C1>=2 THEN F5=96,F5$="Shipping instructions"; GOSUB 6300; GOTO 2533 ELSE IF B$(10,1)="S" AND I1$(61,1)="Y" THEN GOTO 2530 ! SSP#273389
2520 IF L$(21,1)="Y" OR B[1]=0 THEN P3=B[0] ELSE IF L$(20,1)="Y" AND L[0]<>0 THEN P3=B[0]*B1/L[0] ELSE P3=B[0]*B1
2530 B7=B7+P3,B8=B8+B1; F5=129,F5$=STR(P3:M0$); GOSUB 8350
2533 H8$=B$; GOSUB 8000; F5=19,F5$=H9$; GOSUB 8350; F5=21,F5$=FNS$(B$(101,10)); GOSUB 8350; F5=188; GOSUB 8350; H9$=" " ! WO241399, second printing of item number
2534 IF X9$(106,1)="B" AND B$(10,1)<>"I" THEN F6=106,F5$=""; GOSUB 8350
2535 DIM FORM$(448); XPR=PRM('XI'); SET_PARAM 'XI'; READ (Z[18],KEY=B$(91,20),DOM=2536)FORM$
2536 SET_PARAM 'XI'=XPR; IF MID(X9$,159,1)="F" AND STP(MID(FORM$,350,20),3," ")="" THEN F5$=B$(101,10),F5=159; GOSUB 8350 ELSE F5$=MID(FORM$,350,20),F5=159; GOSUB 8350
2540 IF POS(X9$(106,1)="Cc")=0 AND B$(10,1)<>"I" THEN GOTO 2550 ! SSP#255027
2542 FIND (Z[4],KEY=B$(91,20)+A$(7,14),DOM=2550)IOL=0440
2544 IF X9$(106,1)<>"B" AND POS(" "<>I6$(35,20))=0 THEN GOTO 2550
2546 F5=106; IF POS(X9$(106,1)="Nc")<>0 THEN F5$=I6$(35,20); GOSUB 8350 ELSE F5$="Your item no: "+I6$(35,20); GOSUB 8350 ! SSP#255027
2550 IF C1<2 THEN GOSUB 8700; REM "Only do if NOT shipping inst.
2560 IF C1<2 AND POS(" "<>B$(68,9))>0 THEN F5=58,F5$=B$(68,9); IF UNFORM_MODE THEN UNF_SPEC=1 END_IF ; GOSUB 8300; UNF_SPEC=0; REM "assume only one line has a starting #" !SSP#248108
2562 IF E$(11,1)="D" THEN E2$=E$(12,4) ELSE E2$=""; GOTO 2570
2565 IF X9[146]<>0 THEN DIM J5[20]; CALL "IC2UTK",ERR=2566,X3$,X4$,B$(91,20)+E2$,J5$,J5{ALL}; F5=146,F5$=J5$(35,10); GOSUB 8350
2570 GOSUB OUTPUT_VP_INFO ! ssp#148606
2575 IF X9[208]<>0 THEN GOSUB GET_SPEC_URLS; GOSUB OUTPUT_SPEC_URL ! SSP307287-DBD-116
2590 I0=I0+F4*W3
2595 RETURN 
2900 REM "Send P$ to printer
2901 JF_OPT$="N"; IF POS("J1"=V0$(59,12))<>0 OR UNFORM_MODE THEN IF J1_PREV_PO_NUM$<>A$(297,9) THEN J1_PREV_PO_NUM$=A$(297,9) ELSE JF_OPT$="E"; IF UNFORM_MODE AND V0$(99,1)="Y" AND C1>2 THEN JF_OPT$="N"; REM "option to create one file only SSP 236695,245519; SSP#285579-optionally, for split ship POs under Unform, user can force separate jobs per shipping point in selection screen
2902 ! IF WHO="crg" THEN PRINT "PO NUM|",A$(297,9),"|J1 PREV|",J1_PREV_PO_NUM$,"|JF_OPT$|",JF_OPT$,"|C1|",STR(C1),"|"; INPUT "Press any key...",*
2904 IF P2>1 THEN F5=134,F5$="PAGE:"+STR(P2:"#0"); GOSUB 8300
2906 IF B9=1 AND JETFORM_MODE=0 AND UNFORM_MODE=0 THEN DIM Q[1]; CALL "BC2FMX",X3$,X4$,P$,O$,W9,Z[13],A0$,A0{ALL},R6$,Q0$,Q{ALL},Z0; IF Z0=1 THEN GOTO 5000 ELSE GOTO 2933; REM "USe barcode module to print ; !SSP 241023
2908 IF UNFORM_MODE THEN GOSUB IMAGE_LIBRARY_SETUP; CALL "EF2UNF",X3$,X4$,P6$,JF_OPT$,UNFORM_DEV,ITEM_PARM$,PO_JOBCARD_OVERRIDE$,RET$; FOR I=0 TO INT(LEN(P$)/W3)-1; Y5$=P$(I*W3+1,W3); GOSUB 7300; NEXT I; GOTO 2930; REM "Open new item for jetform & print or print regular output, option to create one file only  SSP 236695 SSP 241023,245519 SSP 245491
2910 IF JETFORM_MODE THEN GOSUB IMAGE_LIBRARY_SETUP; GOSUB SET_JOBCARD; CALL "EF2JET",X3$,X4$,P6$,JF_OPT$,JETFORM_DEV,ITEM_PARM$,JOB_MODIFIER$,RET$; GOSUB RESET_JOBCARD; PRINT (W9)P$, ELSE FOR I=0 TO INT(LEN(P$)/W3)-1; Y5$=P$(I*W3+1,W3); GOSUB 7300; NEXT I; REM "Open new item for jetform & print or print regular output, option to create one file only  SSP 236695 
2933 IF P6$="" OR (DO_2 AND FIRST_PASS=0) OR ((POS("J1"=V0$(59,12))<>0 OR UNFORM_MODE) AND JF_OPT$="E") THEN GOTO 2934 ELSE GOSUB 8060; CALL "EF2FAX",ERR=*NEXT,X3$,X4$,P6$,F6$,W9,X$,T$,PMODE,EM$; REM "Setup fax #s and Tag 2s, then call fax routine |skip if no params set or if w6$ set(print both printer & elect items) and we ar doing the printer - ssp#134376  SSP 236695 SSP 241023 - PMODE SET TO JF OR UF (st 7145),245519
2935 P2=P2+1; GOSUB 8650
2940 RETURN 
3000 REM " READ ORDER NOTEPAD AND SET INFORMATION TO BE PRINTED SSP# 151507
3010 READ (Z[22],KEY=C$(118,8),DOM=3099)ORDER_NOTE$
3015 F5=169; F5$=ORDER_NOTE$(9,50); GOSUB 8300; REM " SSP# 151507 - LINE 1
3020 F5=170; F5$=ORDER_NOTE$(59,50); GOSUB 8300; REM " SSP# 151507 - LINE 2
3025 F5=171; F5$=ORDER_NOTE$(109,50); GOSUB 8300; REM " SSP# 151507 - LINE 3
3030 F5=172; F5$=ORDER_NOTE$(159,50); GOSUB 8300; REM " SSP# 151507 - LINE 4
3035 F5=173; F5$=ORDER_NOTE$(209,50); GOSUB 8300; REM " SSP# 151507 - LINE 5
3040 F5=174; F5$=ORDER_NOTE$(259,50); GOSUB 8300; REM " SSP# 151507 - LINE 6
3045 F5=175; F5$=ORDER_NOTE$(309,50); GOSUB 8300; REM " SSP# 151507 - LINE 7
3050 F5=176; F5$=ORDER_NOTE$(359,50); GOSUB 8300; REM " SSP# 151507 - LINE 8
3055 F5=177; F5$=ORDER_NOTE$(409,50); GOSUB 8300; REM " SSP# 151507 - LINE 9
3060 F5=178; F5$=ORDER_NOTE$(459,50); GOSUB 8300; REM " SSP# 151507 - LINE 10
3099 RETURN 
3100 ORDER_CUST_REFS:! WO275772
3105 IF J8=1 THEN DIM FV1$(818,"X"); GOTO 3115
3110 DIM FV1$(818); FIND (Z[25],KEY=C$(118,8),DOM=*RETURN)FV1$(1)
3115 IF STP(FV1$,2)="" THEN RETURN 
3125 IF X9[195]<>0 THEN F5=195; F5$=STP(FV1$(19,60),1); GOSUB 8300 ! WO275772
3126 IF X9[196]<>0 THEN F5=196; F5$=STP(FV1$(79,60),1); GOSUB 8300 ! WO275772
3127 IF X9[197]<>0 THEN F5=197; F5$=STP(FV1$(139,60),1); GOSUB 8300 ! WO275772
3128 IF X9[198]<>0 THEN F5=198; F5$=STP(FV1$(199,60),1); GOSUB 8300 ! WO275772
3129 IF X9[199]<>0 THEN F5=199; F5$=STP(FV1$(259,60),1); GOSUB 8300 ! WO275772
3130 IF X9[200]<>0 THEN F5=200; F5$=STP(FV1$(319,60),1); GOSUB 8300 ! WO275772
3131 IF X9[201]<>0 THEN F5=201; F5$=STP(FV1$(379,60),1); GOSUB 8300 ! WO275772
3132 IF X9[202]<>0 THEN F5=202; F5$=STP(FV1$(439,60),1); GOSUB 8300 ! WO275772
3133 IF X9[203]<>0 THEN F5=203; F5$=STP(FV1$(499,60),1); GOSUB 8300 ! WO275772
3134 IF X9[204]<>0 THEN F5=204; F5$=STP(FV1$(559,60),1); GOSUB 8300 ! WO275772
3145 RETURN 
3199 ! 
4000 REM "Print bottom half of P/O
4004 Z$="05C IC0...  06C PO3...  09C AR4...  10C FS2...  11C POE...  09O FS2...  10O FMS...  11O FMU...  12O FMV...  "
4005 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
4006 GOSUB SET_READONLY; DIM F$(448),F[17]; F[0]=X[19]; READ (Z[18],KEY=S0$(1,20),DOM=4007)IOL=0360 ! SSP233147 - set READONLY
4007 GOSUB CLEAR_READONLY ! SSP233147 - clear READONLY
4008 L9$=""
4009 IF S2$="*" THEN GOSUB 4400; S0$="",S2$=""; IF P7$<>"" AND POS(" "<>P7$)<>0 THEN GOSUB 8550; GOTO 4080 ELSE GOTO 4080; REM "Comments only code,gosub to 8550 added on ssp#83146
4010 GOSUB 4100
4015 GOSUB 4550
4018 REM "L9$ set in 4100's if a line was printed
4019 IF L9$="" THEN GOTO 4051
4020 GOSUB 4300
4030 GOSUB 4400
4040 GOSUB 4500
4050 GOSUB 8600
4060 IF S3$="*" THEN S3$="",S0$=""
4079 IF J5$=S0$ THEN S0$="",J5$="" ELSE J5$=S0$; REM "IF s0$ hasn't changed each time thru then something is wrong, so leave
4080 Y$="09C FS2...  10C FMS...  11C FMU...  12C FMV...  05O IC0...  06O PO3...  09O AR4...  10O FS2...  11O POE...  "
4085 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
4090 RETURN 
4100 REM "Print ply information
4104 I0=Y9[32]*W3,L1=0,L2=8,L2=L2+NUM(X9$(32,1),ERR=4105)
4105 DIM J$(134); READ (Z[11],KEY=S0$,DOM=4146)IOL=0400
4109 REM "Set S0$ to "" if we definately are done with plies
4110 IF J$(1,20)<>S0$(1,20) THEN GOTO 4146
4120 IF L2$="*" THEN L2$=""; GOSUB 8830; I0=Y9[32]*W3; REM "We need to new item before printing
4125 IF POS(" "<>J$(102,8))>0 OR (TEXT_MODE AND POS(FORMAT$="0203",2)) THEN F5=43; F5$=J$(102,8); GOSUB 8300; REM SSP 214091
4128 REM "Set L9$ if first line is printed
4129 IF J$(21,3)="001" THEN L9$="*"
4130 GOSUB 4150
4132 S0$=S0$(1,20)+STR(NUM(J$(21,3))+1:"000")
4134 L1=L1+1; IF L1=L2 THEN GOTO 4145
4135 GOTO 4105
4145 RETURN 
4146 IF S0$(21,3)="001" THEN L9$="*"
4147 S3$="*"; GOTO 4145
4150 REM "Print a ply
4156 F5=32,F5$=STR(NUM(J$(21,3)):"##"); GOSUB 8400
4157 F5=33,F5$=J$(24,3); GOSUB 8400
4158 F5=34,F5$=J$(27,3); GOSUB 8400
4159 F5=35,F5$=J$(30,6); GOSUB 8400
4160 IF X9[19]=0 OR J$(36,8)<>F$(24,8) THEN F5=36,F5$=J$(36,8); GOSUB 8400
4161 IF X9[19]=0 OR J$(44,8)<>F$(32,8) THEN F5=37,F5$=J$(44,8); GOSUB 8400
4162 DIM F5$(2); IF NUM(X9$(38,1),ERR=4163)>0 THEN DIM F5$(NUM(X9$(38,1))); REM "Spaces between inks override
4164 IF POS(X3$(9,3)="101302",3)<>0 THEN F5=38,F5$=J$(52,6)+" "+J$(131,1)+F5$+J$(58,6)+" "+J$(132,1)+F5$+J$(64,6)+" "+J$(133,1)+F5$+J$(70,6)+" "+J$(134,1); GOSUB 8400; GOTO 4166
4165 F5=38,F5$=J$(52,6)+F5$+J$(58,6)+F5$+J$(64,6)+F5$+J$(70,6); GOSUB 8400
4170 F5=39,F5$=J$(76,10); GOSUB 8400
4171 F5=116,F5$=J$(86,1); GOSUB 8400
4172 F5=40,F5$=J$(87,2); GOSUB 8400
4173 F5=41,F5$=J$(89,1)+" "+J$(90,1); GOSUB 8400
4174 F5=94,F5$=J$(91,8); GOSUB 8400
4175 F5=95,F5$=J$(99,3); GOSUB 8400
4176 F5=42,F5$=J$(110,20); IF X3$(9,3)="084" THEN F5$=STR(NUM(J$(21,3)):"##")+" "+F5$; GOSUB 8400 ELSE IF POS(X3$(9,3)="110",3)>0 THEN F5$=F5$(1,16); GOSUB 8400 ELSE GOSUB 8400
4178 F5=119,F5$=J$(130,1); GOSUB 8400
4185 I0=I0+W3
4190 RETURN 
4300 REM "Print comp section
4304 REM "First check to see if user def spec and no std comp screen required
4305 IF P9$(168,1)="Y" AND S0$<>"" THEN FIND (Z[8],KEY="T"+P7$,DOM=4381)X$; IF LEN(X$)>34 THEN IF X$(33,3)<>"   " AND X$(21,1)="Y" THEN GOTO 4380
4310 READ (Z[10],KEY=S0$(1,20),DOM=4370)IOL=0390
4315 IF UNFORM_MODE THEN UNF_SPEC=1 ELSE UNF_SPEC=0 ! SSP 241023
4317 IF I$(21,1)="Y" THEN F5$="Plant" ELSE F5$=FNBL$(I$(21,1))
4318 F5=44; GOSUB 8300
4320 REM IF A$(190,1)="E" THEN LET F5=44,F5$="          "; GOSUB 08300; LET F5=54,F5$=I$(32,1); GOSUB 08300; LET F5=55,F5$=I$(33,1); GOSUB 08300; LET F5=57,F5$=STR(NUM(I$(35,3))); GOSUB 08300; GOTO 04328
4321 F5=45,F5$=FNBL$(I$(22,1)); GOSUB 8300; F5=46,F5$=FNBL$(I$(23,1)); GOSUB 8300 ! SSP 246624
4322 F5=47,F5$=FNBL$(I$(25,1)); GOSUB 8300; F5=48,F5$=FNBL$(I$(26,1)); GOSUB 8300
4323 F5=49,F5$=FNBL$(I$(27,1)); GOSUB 8300; F5=50,F5$=FNBL$(I$(28,1)); GOSUB 8300
4324 F5=51,F5$=FNBL$(I$(29,1)); GOSUB 8300; F5=52,F5$=FNBL$(I$(30,1)); GOSUB 8300
4325 F5=53,F5$=FNBL$(I$(31,1)); GOSUB 8300; F5=54,F5$=FNBL$(I$(32,1)); GOSUB 8300
4326 F5=55,F5$=FNBL$(I$(33,1)); GOSUB 8300; F5=56,F5$=FNBL$(I$(34,1)); GOSUB 8300
4327 F5=57,F5$=I$(35,3); GOSUB 8300
4330 F5=59,F5$=I$(48,5); GOSUB 8300; F5=60,F5$=I$(53,2); GOSUB 8300; F5=61,F5$=I$(55,3); GOSUB 8300
4331 F5=62,F5$=FNBL$(I$(58,1)); GOSUB 8300; F5=63,F5$=FNBL$(I$(59,1)); GOSUB 8300
4332 F5=64,F5$=FNBL$(I$(60,1)); GOSUB 8300; F5=65,F5$=FNBL$(I$(61,1)); GOSUB 8300
4333 F5=66,F5$=FNBL$(I$(62,1)); GOSUB 8300; F5=67,F5$=FNBL$(I$(64,1)); GOSUB 8300
4334 F5=68,F5$=FNBL$(I$(65,1)); GOSUB 8300; F5=69,F5$=FNBL$(I$(66,1)); GOSUB 8300
4335 F5=70,F5$=FNBL$(I$(67,1)); GOSUB 8300; F5=145,F5$=FNBL$(I$(63,1)); GOSUB 8300
4336 IF F[0]=0 AND X9$(71,1)<>"S" THEN F5$="Std." ELSE IF F[0]=0 AND X9$(71,1)="S" THEN F5$=DIM(3) ELSE F5$=FNR$(STR(F[0]:M3$)) ! SSP#218946             
4337 F5=71; GOSUB 8300
4341 F5=72,F5$=FNBL$(I$(68,1)); GOSUB 8300; F5=73,F5$=FNBL$(I$(69,1)); GOSUB 8300
4342 F5=74,F5$=FNBL$(I$(70,1)); GOSUB 8300; F5=75,F5$=FNBL$(I$(71,1)); GOSUB 8300
4343 F5=76,F5$=FNBL$(I$(72,1)); GOSUB 8300; F5=77,F5$=I$(73,6); GOSUB 8300
4344 F5=78,F5$=I$(79,8); GOSUB 8300; F5=79,F5$=FNBL$(I$(87,1)); GOSUB 8300
4345 F5=80,F5$=I$(88,5); GOSUB 8300; F5=81,F5$=I$(93,8); GOSUB 8300
4351 F5=82,F5$=FNBL$(I$(101,1)); GOSUB 8300; F5=83,F5$=FNBL$(I$(102,1)); GOSUB 8300
4352 F5=84,F5$=STR(NUM(I$(103,4)):"##"); GOSUB 8300; F5=85,F5$=FNBL$(I$(107,1)); GOSUB 8300
4353 F5=86,F5$=FNBL$(I$(108,1)); GOSUB 8300; F5=87,F5$=FNBL$(I$(109,1)); GOSUB 8300
4354 F5=88,F5$=I$(110,3); GOSUB 8300; F5=89,F5$=FNBL$(I$(113,1)); GOSUB 8300
4355 F5=90,F5$=I$(114,15); GOSUB 8300; F5=91,F5$=I$(129,15); GOSUB 8300
4356 F5=92,F5$=I$(144,15); GOSUB 8300
4358 F5=120,F5$=I$(38,4); GOSUB 8300; F5=121,F5$=STR(NUM(I$(42,5)):"#####"); GOSUB 8300
4370 REM "User defined specs?
4380 IF P9$(168,1)="Y" AND S0$<>"" THEN FIND (Z[8],KEY="T"+P7$,DOM=4381)X$; IF LEN(X$)>34 THEN IF X$(33,3)<>"   " THEN CALL "PO2PAC",X3$,X4$,P$,S0$,X$,W3,"",V3$,0,W9,PMODE ! SSP241023
4385 IF POS(X3$(9,3)="520",3)<>0 AND S0$<>"" THEN GOTO 4386 ELSE GOTO 4390
4386 IF F[0]=0 AND X9$(71,1)<>"S" THEN F5$="Std." ELSE IF F[0]=0 AND X9$(71,1)="S" THEN F5$=DIM(3) ELSE F5$=FNR$(STR(F[0]:M3$)) ! SSP#218946             
4388 F5=71; GOSUB 8300
4390 UNF_SPEC=0; RETURN ! SSP 241023
4400 REM "Print comments
4405 READ (Z[12],KEY=S0$(1,20),DOM=4406)
4406 F2=0
4407 I0=Y9[93]*W3,I9=1
4410 READ (Z[12],END=4435)IOL=0410; IF K$(1,20)<>S0$(1,20) THEN GOTO 4435
4412 ! SSP266211, WM only uses PO E/F type forms with up to 8 comments, this logic no longer needed, and probably wasn't needed for years now, but issue showing up with this now that they are in the process of switching over to UnForm. IF POS(X3$(9,3)="101302",3)<>0 THEN IF I9=5 THEN I0=Y9[101]*W3+X9[101]; GOTO 4420 ELSE IF I9<35 THEN GOTO 4420 ELSE GOTO 4430
4415 IF I9=5 THEN I0=Y9[101]*W3+X9[101]; GOTO 4420 ELSE IF I9>8 THEN GOTO 4435
4420 GOSUB 4450
4430 GOTO 4410
4440 RETURN 
4450 REM "Print a comment
4455 IF K$(24,1)="N" THEN GOTO 4490
4456 IF TEXT_MODE AND B$(10,1)<>"M" THEN IF I9<5 THEN F5=93 ELSE F5=101 END_IF ; IF POS(" "<>HEADER$[F5])=0 THEN HEADER$[F5]=K$(25,60) ELSE HEADER$[F5]=HEADER$[F5]+"|"+K$(25,60); REM "Build string array for call routine to write out test file
4457 I8=60; IF X9$(93,1)="A" OR POS(X3$(9,3)="101302",3)<>0 THEN I8=65
4460 IF X9[93]<>0 THEN IF JETFORM_MODE THEN IF I9<5 THEN F5=93 ELSE F5=101 END_IF ; F5$=K$(25,I8); GOSUB JETFORM_PRINT ELSE P$(I0+X9[93],I8)=K$(25,I8) END_IF ; I9=I9+1,I0=I0+W3; RETURN 
4470 REM LET Y5$(F2*60+1+SGN(F2))=K$(25,60)
4475 REM IF F2=0 THEN LET F2=1 ELSE LET F2=0; GOSUB 07300
4490 RETURN 
4500 REM "Use up rest of page
4540 RETURN 
4550 REM "Use unused ply space
4590 RETURN 
4600 REM "Continue if overflow on lines
4605 GOSUB 8850
4608 IF S0$<>"" THEN GOSUB 4000
4610 GOSUB 2900
4640 GOSUB 4500
4650 GOSUB 2100
4655 GOSUB 2150
4660 GOSUB 2200
4665 GOSUB 2350
4670 I0=(Y8[2]-1)*W3,I1=0; GOSUB 8650
4675 PO_LINE=1; REM "Reset to 1, we already have a line we are doing
4690 RETURN 
4700 REM "Print P/O comments
4702 DIM Y6$(131)
4703 GOSUB 4550; GOSUB 4370
4704 F2=0,I0=Y9[93]*W3,I9=1,I8=60
4705 READ (Z[11],KEY=A$(297,9),DOM=4706)
4710 READ (Z[11],END=4740)IOL=0410
4715 IF K$(1,9)<>A$(297,9) THEN GOTO 4740
4716 IF I9>8 THEN GOTO 4740 ! 298437
4720 IF K$(13,1)<>"Y" THEN GOTO 4735
4722 IF I9=5 THEN I0=Y9[101]*W3+X9[101]; REM "Don't need I9 check since entry limits to 8 lines
4725 Y6$(25,65)=K$(14,65); DIM K$(90); K$=Y6$(1,90); DIM Y6$(131); GOSUB 4460
4735 GOTO 4710; REM "IF W<=NUM(V3$(15,2))-1 THEN GOTO 04710
4750 GOSUB 4500
4790 RETURN 
4800 JETFORM_PRINT:REM "For jetform mode add field nominated value with F5 as the field name and F5$ as the value; P_LINE[ F5 ] is the last po line that the field F5 was printed on (init'ed to 0). IF the current po line is more than 1 > that po line then we need to output blank fields until it is 1 less than the current po line. Ofcourse for the non line (header & total) sections the current po  line is 0. The current po line is in PO_LINE
4810 IF F5<>58 THEN IF PO_LINE>P_LINE[F5]+1 THEN P$=P$+"^field "+STP(P6$(146,3),1)+STR(F5:"000")+'LF'; P_LINE[F5]=P_LINE[F5]+1; GOTO 4810; REM "fld 58 only prints once should only be on line 1
4815 P$=P$+"^field "+STP(P6$(146,3),1)+STR(F5:"000")+'LF'+F5$+'LF'; P_LINE[F5]=P_LINE[F5]+1
4845 JETFORM_PRINT_END:RETURN 
4850 SET_JOB_MODIFIER:REM "Set job_modifier$ to '' or the template code if user defined specs will be printed. job_modifier$ will be passed to EF2JET
4855 JOB_MODIFIER$=""
4859 TMP$=""
4860 READ (Z[3],KEY=A$(297,9),DOM=4861)
4861 READ (Z[3],END=4865)IOL=0320
4863 TMP$=B$(25,3)
4870 IF P9$(168,1)="Y" THEN FIND (Z[8],KEY="T"+TMP$,DOM=4871)X$; IF LEN(X$)>34 THEN IF X$(33,3)<>"   " THEN JOB_MODIFIER$=X$(33,3)
4895 SET_JOB_MODIFIER_END:RETURN 
4900 OUTPUT_VP_INFO:! Generate Variable Print information fields B$=line ssp#148606
4903 IF X9$(165,1)="F" THEN EEM_FULL_URL$=""; CALL "ECGM3H;GET_EEM_REC",ERR=*NEXT,X3$,X4$,B$(82,8),B$(11,3),"01",EEM_FULL_URL$,ECGM3H_OPTIONS$; IF STP(EEM_FULL_URL$)<>"" THEN F5=165,F5$=STP(EEM_FULL_URL$); GOSUB 8350; RETURN ! SSP307433-DBD-332-DBD-322 add STP
4904 IF X9[211]<>0 THEN EEM_FULL_URL_2$=""; CALL "ECGM3H;GET_EEM_REC",ERR=*NEXT,X3$,X4$,B$(82,8),B$(11,3),"02",EEM_FULL_URL_2$,ECGM3H_OPTIONS$; IF STP(EEM_FULL_URL_2$)<>"" THEN F5=211,F5$=STP(EEM_FULL_URL_2$); GOSUB 8350; RETURN ! SSP307433-DBD-332-DBD-322 2nd Full URL field 211
4905 DIM EC8$(200); FIND (Z[21],KEY=B$(82,8)+B$(11,3),DOM=4940)EC8$
4910 DIM EC6$(900); FIND (Z[20],KEY=MID(EC8$,12,10),DOM=*NEXT)EC6$
4920 F5=160,F5$=STP(MID(EC8$,22,20)); GOSUB 8350 ! 160, VP_info_1
4922 F5=161,F5$=STP(MID(EC8$,42,20)); GOSUB 8350 ! 161, VP_info_2
4924 F5=162,F5$=STP(MID(EC6$,1,10)); GOSUB 8350 ! 162 VP_id
4926 F5=163,F5$=STP(MID(EC6$,141,60)); GOSUB 8350 ! 163 VP Proof URL
4928 F5=164,F5$=STP(MID(EC6$,201,60)); GOSUB 8350 ! 164 VP Vendor URL
4930 F5=165,F5$=STP(MID(EC6$,141,60))+"/"+STP(MID(EC8$,42,20)); GOSUB 8350 ! 165 VP Proof URL/Proof file (vp_info_2)
4932 F5=182,F5$=STP(MID(EC8$,62,50)); GOSUB 8350 ! 182, VP_info_3
4949 RETURN 
5000 REM "End of Print
5002 IF CALLED$="Y" THEN EXIT ! SSP 249021
5005 IF V3$(2,1)<>"T" AND POS(" "<>V0$(84,12))>0 AND Q5=0 THEN CALL "PO2PAY",X3$,X4$,V0$(84,12),"" ELSE GOTO *NEXT ! SSP 248242 SSP 249021
5010 IF Q5=1 THEN GOTO 9930 ! SSP#214091
5020 IF W8=0 THEN GOTO 5200
5200 REM "
5270 REM "LET Y$="09C AR3...  10C FMS...  11C FMU...  "
5280 REM "CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z[ALL],Z0,Z1,SSP# 128039
5291 GOTO 9900
5300 REM "Remove printed P/O's
5305 IF V8$="A" THEN GOTO 5330
5310 CALL "ZZPROM",".Y",X3$,Z,"Did all of the purchase orders print correctly?","","",0
5320 ON Z GOTO 5330,5340
5330 GOSUB 5350; GOTO 5345
5345 RETURN 
5350 REM "Do remove
5352 IF P9$(189,1)="Y" THEN Y$="09CU   09O FMS... 11C POE...  11O FM1... "; CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
5353 IF %GUI THEN GOTO 5360
5354 PRINT @(0,19),'CE',
5355 CALL "ZZPROM","X0PO2PAA",X3$,Z,"","","",19
5360 Q5=1; GOTO 0990
5390 RETURN 
5400 REM "Set code C1 for type of P/O
5405 REM "0=1 of 1 p/o, 1=cover p/o for multiple p/os, 2=general inst, 3=print special instr. from current po3 record
5410 IF P0=1 THEN C1=0; GOTO 5445
5414 REM "P0 is > 1
5415 ON P1 GOTO 5445,5420,5430,5440
5420 C1=1; GOTO 5445
5440 C1=3
5445 RETURN 
5500 REM "Get proper address, C1=1 taken care of in 2300's
5505 DIM E$(428) ! WO234689, was 260
5510 ON C1 GOTO 5515,5590,5520,5550
5515 IF LEN(P2$)=13 THEN GOTO 5550; REM "Only one P/O, but it is special ship
5520 READ (Z[6],KEY=A$(297,9)+"    ",DOM=5530)IOL=0350; GOTO 5590
5530 READ (Z[6],KEY=A$(297,8)+"     ",DOM=5540)IOL=0350; GOTO 5590
5535 REM "If no general inst., use customer address
5540 E$(16,30)=D$(165,20),E$(46,87)=D$(56,87); GOTO 5590
5550 REM "Read in special shipping record
5560 READ (Z[6],KEY=P2$(1,13),DOM=5580)IOL=0350
5570 GOTO 5590
5580 REM "Error"
5585 EXITTO 1580
5590 RETURN 
5600 REM "Get name to print on shipto
5610 E0$=D$(11,35)
5615 ON POS(E$(11,1)="CPD") GOTO 5645,5620,5625,5630
5620 GOSUB SET_READONLY; FIND (Z[7],KEY=E$(11,1)+D$(1,10)+E$(12,4),DOM=5645)E1$; GOTO 5635 ! SSP#251963
5625 FIND (Z[7],KEY=E$(11,1)+A$(7,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5630 FIND (Z[7],KEY=E$(11,1)+Y6$(1,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5635 E0$=E1$(16,35)
5645 GOSUB CLEAR_READONLY; RETURN ! SSP#251963
5650 REM "GET EXTENDED SHIPPING ADDRESS
5655 DIM SHIP_TO$(0); IF P9$(244,1)<>"Y" THEN GOTO 5690 ELSE IF J8=1 THEN DIM SHIP_TO$(120,"X"); GOTO 5690
5657 IF PRT_WHSE$="Y" THEN PRT_WHSE$="N"; GOTO 5690; REM "WO94734
5658 IF PRT_PLANT$="Y" THEN PRT_PLANT$="N"; GOTO 5690; REM "WO100863
5659 IF PRT_VEND$="Y" THEN PRT_VEND$="N"; GOTO 5690; REM "WO100863
5660 GOSUB SET_READONLY; READ (Z[7],KEY="C"+D$(1,10)+E$(12,4),DOM=5661)SHIP_TO$ ! ssp 200446 !SSP#251963
5661 GOSUB CLEAR_READONLY ! SSP#251963
5690 RETURN 
5700 REM "Print shipping inst. message
5715 IF C1<2 THEN GOTO 5740
5719 GOSUB 8200
5720 F5=133,F5$="Shipping instructions for P/O number: "+P5$; GOSUB 8300
5735 IF D2$<>"" THEN GOSUB 8150
5740 RETURN 
5800 REM "Print extended shipping lines
5810 FOR I=0 TO 3
5820 IF POS(" "<>MID(SHIP_TO$,402+I*30,30))>0 THEN IF JETFORM_MODE THEN F5$=SHIP_TO$(402+I*30,30); GOSUB JETFORM_PRINT ELSE P$(I0,30)=SHIP_TO$(402+I*30,30); I0=I0+W3
5830 NEXT I
5835 SHIP_TO$=""
5840 RETURN 
5900 REM "Calculate T unit of measure
5920 IF (X9$(F5,1)<>"D" AND X9$(F5,1)<>"d") OR UM$<>"T   " OR UM0<>1000 THEN GOTO 5990
5940 PRECISION 5; F5$=STR(NUM(F5$)*.001:"#.00000"),UM$="EACH",UM0=1; PRECISION 2
5990 RETURN 
6000 REM "Print alignment pattern?
6005 IF V8$="A" THEN GOTO 6090
6010 IF V3$(2,2)="A " THEN PRINT 'EA',
6012 J8=0; REM "Set flag
6015 CALL "ZZPROM","R4",X3$,Z,"","","",X0
6017 IF Z<2 AND V3$(2,2)="A " THEN PRINT 'BA',
6020 ON Z GOTO 6090,6021,9900
6025 J8=1; REM "Flag - we're doing an alignment pattern
6030 GOSUB 6100
6040 GOSUB 6200
6045 IF V3$(2,1)<>"T" THEN PRINTER$=FID(W9); CLOSE (W9); OPEN (W9)PRINTER$
6050 GOTO 6010
6090 RETURN 
6100 REM "Setup test data"
6105 X$="X",X5$="I6XXXX"
6110 DIM A$(383,X$),B$(118,X$),B[27],C$(350,X$),D$(200,X$),E$(428,X$),F$(386,X$),F[17],G$(20,X$),G0$(20,X$),G1$(20,X$),H$(315,X$),H0$(315,X$),I$(159,X$),J$(134,X$),K$(90,X$),G2$(300,X$),H1$(40,X$) ! SSP307210-DBD-63, fix E$ DIM
6120 A$(204,6)=X5$,A$(192,6)=X5$,C$(16,6)=X5$,A$(224,6)=X5$,J$(21,3)="000",A$(242,6)=X5$,A$(291,6)=X5$,C$(55,6)=X5$,I$(103,4)="0999",A$(326,2)="99",I$(42,5)="99999",A$(190,1)="E",C$(70,6)=X5$
6125 I$(68,5)="YYYYY"
6130 DIM H1$(40,"X")
6135 DIM SPEC_ORD_NUM$(8),SPEC_ORD_LINE_NUM$(3),SPEC_CUST_ITEM$(20)
6190 RETURN 
6200 REM " Print align. pattern
6210 S0$=""
6220 GOSUB 2000
6225 I0=Y9[32]*W3,I9=1
6230 FOR I2=1 TO 8; GOSUB 4150; NEXT I2
6240 GOSUB 4550
6245 GOSUB 8600
6250 GOSUB 4320
6255 I0=Y9[93]*W3,I9=5
6260 FOR I2=1 TO 4; GOSUB 4450; NEXT I2
6265 I0=X9[101]+Y9[101]*W3
6266 FOR I2=1 TO 4; GOSUB 4450; NEXT I2
6270 GOSUB 4500
6275 GOSUB 2900
6290 RETURN 
6300 REM 
6310 IF MID(X9$,F5,1)="X" THEN GOTO 6340
6320 GOSUB 8350
6340 RETURN 
6400 GET_SHIP_RECORD:! WO236789, get ship address info, specifically phone number.  The ship address might be a stopover warehouse, or plant or vendor, or just the regular PO3 record info.
6405 SHIP_PHONE$=DIM(14); IF J8=1 THEN SHIP_PHONE$=DIM(14,"X"); GOTO FORMAT_SHIP_PHONE ! J8=1 means printing alignment pattern
6410 IF E$(3,4)<>DIM(4) THEN DIM SHIP$(428); FIND (Z[7],KEY="D"+DIM(10)+E$(3,4),DOM=*NEXT)SHIP$(1); SHIP_PHONE$=SHIP$(200,14); GOTO FORMAT_SHIP_PHONE ! If stopover type warehouse, get that FM0 record
6415 IF E$(295,4)<>DIM(4) THEN DIM SHIP$(428); FIND (Z[7],KEY="P"+E$(285,10)+E$(295,4),DOM=*NEXT)SHIP$(1); SHIP_PHONE$=SHIP$(200,14); IF SHIP_PHONE$<>DIM(14) THEN GOTO FORMAT_SHIP_PHONE ! if stopover type plant, get that FM0 record, if blank go on and try the vendor
6420 IF E$(285,10)<>DIM(10) THEN DIM SHIP$(426); FIND (Z[16],KEY=E$(285,10),DOM=*NEXT)SHIP$(1); SHIP_PHONE$=SHIP$(195,14); GOTO FORMAT_SHIP_PHONE ! If stopover type vendor, get that AP4 record
6430 IF E$(11,1)="D" THEN DIM SHIP$(428); FIND (Z[7],KEY="D"+DIM(10)+E$(12,4),DOM=*NEXT)SHIP$(1); SHIP_PHONE$=SHIP$(200,14); GOTO FORMAT_SHIP_PHONE ELSE IF E$(11,1)="C" THEN DIM SHIP$(428); FIND (Z[7],KEY="C"+D$(1,10)+E$(12,4),DOM=*NEXT)SHIP$(1); SHIP_PHONE$=SHIP$(200,14); GOTO FORMAT_SHIP_PHONE ! No stopover, use either D or C type location info to get FM0 record
6435 ! 
6440 FORMAT_SHIP_PHONE:IF SHIP_PHONE$=DIM(14) THEN GOTO *RETURN ELSE CALL "ZZDISP","POX",SHIP_PHONE$,"",X3$,F5$,"",0,0,X4$; F5=183; GOSUB 8300
6445 RETURN 
6449 ! 
6800 SET_READONLY:! SSP233147
6810 SET_PARAM 'XI'
6820 SET_READONLY_END:RETURN 
6825 ! 
6830 CLEAR_READONLY:
6835 SET_PARAM -'XI'
6840 CLEAR_READONLY_END:RETURN 
6845 ! 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7330 PRINT (W9)STP(Y5$,1); DIM Y5$(W3)
7395 RETURN 
7400 REM "Read report selection parameters"
7405 CLOSE (14); OPEN (14)"ZZP"
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (14,KEY=X3$(1,8),DOM=7451)IOL=0490
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"   ")-1)
7482 IF V1$(1,3)="???" THEN V8$="A",V7$=V1$(4,2); IF V0$(71,1)="1" THEN V1$="PO6   "
7485 FOR U7=1 TO LEN(V1$); IF V1$(U7,1)=" " THEN V1$(U7,1)="."; NEXT U7 ELSE NEXT U7 ! SSP#262397
7486 CLOSE (14)
7488 IF POS(">"=V0$(59,12))=0 THEN W6$="" ELSE W6$=V0$(59,12),W6$=W6$(POS(">"=W6$)+1,2),DO_2=1
7490 RETURN 
7500 REM "Run through special shipping and calculate # of PO's needed (P0)
7504 DIM E[3]
7505 P0=0,P2$="",P3$="",P10$="",SHIP_POINTS$=""; GOSUB 7800; IF A$(173,1)="C" THEN P0$=A$(306,8)+" " ELSE P0$=A$(297,9) ! SSP#188207
7506 GOSUB BUILD_COMPANION_LIST ! 307472
7510 READ (Z[6],KEY=P0$,DOM=7511)
7520 K$=KEY(Z[6],END=7540); IF K$(1,9)<>P0$ THEN GOTO 7540
7522 IF K$(10,4)="    " THEN READ (Z[6]); GOTO 7520; REM "Skip general instructions
7525 READ (Z[6])IOL=0350
7526 IF POS(MID(K$,13,1)=SHIP_POINTS$)=0 THEN SHIP_POINTS$+=K$(13,1) ! SSP#188207
7529 IF POS(E$(7,3)=P3$,3)=0 THEN GOTO 7535
7530 P0=P0+1,P2$=P2$+K$
7535 GOTO 7520
7538 REM "If p0=0 p0=1 for general p/o elseif p0>1 then p0=p0+1 for cover p/o on special shipping
7539 REM "If p0=1 then only one special ship address,see logic to print special ship instead of general
7540 IF POS("S!"=V0$(59,12))<>0 AND LEN(SHIP_POINTS$)=1 THEN P0=0,P2$=MID(P2$,1,13) ! SSP#188207
7541 IF POS(A$(351,1)="BS")>0 THEN IF LEN(P10$)=5 THEN P0=1,P2$=P2$(1,13)
7542 IF P0<>1 THEN P0=P0+1
7545 RETURN 
7550 REM "increment reprint flag
7560 EXTRACT (Z[2],KEY=U$(2,9))IOL=0310
7570 A$(1,1)=STR(NUM(A$(1,1))+1:"0")
7580 WRITE (Z[2])IOL=0310
7590 RETURN 
7600 REM "Set shipping stuff based on shipping record
7610 DIM G$(20); READ (Z[8],KEY="F"+E$(133,1),DOM=7611)IOL=0370
7620 DIM G0$(20); READ (Z[8],KEY="H"+E$(134,1),DOM=7621)IOL=0371
7630 REM DIM G1$(20); READ (Z(8),KEY="S"+E$(150,1),DOM=7631) IOL=0372
7635 DIM G1$(20); G1$(3,15)=E$(210,15)
7645 RETURN 
7650 REM "Fix city, state, zip in X5$ into X6$
7655 REM IF X5$(17,2)="  " THEN GOTO 07690
7660 X6$=FNS$(X5$(1,16))+", "+X5$(17,2)+"  "
7670 CALL "ZZDISP","AX",X5$(19,9),"ZIP",X3$,X$,"",0,0,X4$
7675 GOSUB GET_COUNTRY ! SSP 307210
7680 X6$=X6$+STP(X$)+DISP_CNTRY$ ! SSP 307210
7690 RETURN 
7700 REM "Take name(35),attn(30),address(87) in X7$ & put into P$ at I0
7705 IF TEXT_MODE AND B$(10,1)<>"M" AND POS(FORMAT$="0203",2) THEN HEADER$[F5]=X7$(1,35)+"|"+X7$(36,30)+"|"+X7$(66,30)+"|"+X7$(96,30)+"|"+X7$(126,16)+"|"+X7$(142,2)+"|"; CALL "ZZDISP","AX",X7$(144,9),"ZIP",X3$,X$,"",0,0,X4$; HEADER$[F5]=HEADER$[F5]+X$; REM "Build string array for call routine to write text file SSP 214091
7707 ! IF MID(X9$,F5,1)="C" THEN IF STP(CNTRY$,2)<>"" THEN X7$=STP(X7$,1," ")+"  "+CNTRY$ ! SSP 307210
7710 IF JETFORM_MODE THEN F5$=X7$(1,35); GOSUB JETFORM_PRINT ELSE P$(I0,35)=X7$(1,35); I0=I0+W3 END_IF ; X6$=" "
7712 IF SHIP_TO$>"" THEN GOSUB 5800
7715 IF POS(" "<>X7$(36,30))<>0 OR X9$(F5,1)="Z" THEN IF JETFORM_MODE THEN F5$=X7$(36,30); GOSUB JETFORM_PRINT ELSE P$(I0,30)=X7$(36,30); I0=I0+W3
7720 IF JETFORM_MODE THEN F5$=X7$(66,30); GOSUB JETFORM_PRINT ELSE P$(I0,30)=X7$(66,30); I0=I0+W3
7725 IF POS(" "<>X7$(96,30))<>0 OR X9$(F5,1)="Z" THEN IF JETFORM_MODE THEN F5$=X7$(96,30); GOSUB JETFORM_PRINT ELSE P$(I0,30)=X7$(96,30); I0=I0+W3
7730 X5$=X7$(126); GOSUB 7650; IF JETFORM_MODE THEN F5$=X6$; GOSUB JETFORM_PRINT ELSE P$(I0,LEN(X6$))=X6$
7740 RETURN 
7750 REM "Company Name & optional address
7760 F5=144,O0=0,F5$=FNS$(N1$(7,38)); GOSUB 8300
7765 IF MID(X9$,144,1)<>"A" THEN GOTO 7790
7770 FOR X=0 TO 2; F5$=FNS$(N1$(47+X*40,40)); IF F5$>"" THEN F5=144,O0=O0+1; GOSUB 8320
7775 NEXT X
7780 IF POS(" "<>N1$(167,14))>0 THEN CALL "ZZDISP","PX",N1$(167,14),"",X3$,F5$,"",0,0,X4$; F5=144,O0=O0+1; GOSUB 8320
7790 RETURN 
7800 REM "Put valid p/o lines in P3$
7802 HIGHEST$="" ! SSP#214091
7805 READ (Z[3],KEY=A$(297,9),DOM=7806)
7810 READ (Z[3],END=7825)IOL=0320
7811 IF B$(10,1)="M" THEN GOTO 7810
7815 IF B$(82,9)<>A$(297,9) THEN GOTO 7825
7816 IF HIGHEST$<B$(7,3) THEN HIGHEST$=B$(7,3) ! SSP#214091
7820 P3$=P3$+B$(7,3); GOTO 7810
7825 REM "If B/S type see if all lines have same s/s ship-to
7830 IF POS(A$(351,1)="BS")=0 OR LEN(P3$)<3 THEN GOTO 7845 ELSE INDEX=1; READ (Z[6],KEY=A$(306,8)+" "+P3$(1,3),DOM=7835)
7834 REM "get list of shipto locations (type + code) from ORDER special ship instructions by line. MAKE SURE that the lines we look at are on THIS P/O (possible for lines from more than 1 P/O  on an order). P3$ is list of lines on THIS P/O, so start with first one on that list, and check ONLY lines that are in P3$
7835 K$=KEY(Z[6],END=7845); READ (Z[6])IOL=0350; IF K$(1,8)<>A$(306,8) THEN GOTO 7841 ELSE IF POS(E$(7,3)=P3$,3)<>0 THEN IF POS(E$(11,5)=P10$,5)=0 THEN P10$=P10$+E$(11,5); REM " this logic doesnt work if there is 1 line with more than one special ship to:  K$(1,12)<>A$(306,8)+" "+P3$(INDEX,3) THEN GOTO 07845 ELSE LET INDEX=INDEX+3; IF POS(E$(11,5)=P10$,5)=0 THEN LET P10$=P10$+E$(11,5)
7840 GOTO 7835
7845 RETURN 
7850 REM "Check if ext only
7854 DIM I1$(61) ! SSP#273389
7855 IF B$(10,1)<>"S" THEN GOTO 7890
7860 READ (Z[8],KEY="X"+B$(101,10),DOM=7890)I1$ ! SSP#273389
7890 RETURN 
7900 REM "Change Art Status
7902 IF CALLED$="Y" THEN GOTO 7945; REM "WO131248
7905 IF P9$(189,1)<>"Y" THEN RETURN 
7910 READ (Z[3],KEY=U$(2),DOM=7911)
7913 DIM C$(350); READ (Z[3],END=7990)IOL=0330
7914 IF C$(82,9)<>U$(2,9) THEN GOTO 7990
7915 READ (Z[9],KEY=C$(91,20),DOM=7980)Q$; IF POS("Y"=Q$(28,3))=0 THEN GOTO 7980
7920 EXTRACT RECORD (Z[11],KEY=C$(91,20),DOM=7980)Q$
7925 Q$(231,1)="P",Q$(232,6)=X3$(21,6)
7930 WRITE RECORD (Z[11],KEY=C$(91,20))Q$; IF RT_PARM$<>"" THEN CUST$=C$(91,20); CALL "RT2WOC",ERR=7931,X3$,X4$,CUST$,"FM1...","U",C$(91,20)
7945 RETURN 
7990 RETURN 
8000 REM "Build desc from H8$
8010 H9$=FNT$(H8$(17,8)+" "); IF H9$<>"" AND H9$<>" " THEN H9$=H9$+QUO; IF POS(" "<>H8$(111,8))<>0 THEN H9$=H9$+"x"
8020 H9$=H9$+FNS$(H8$(111,8)); IF H9$<>"" THEN IF POS(" "<>H8$(111,8))<>0 THEN H9$=H9$+QUO+" " ELSE H9$=H9$+" "
8030 IF NUM(H8$(15,2),ERR=8031)<>0 THEN H9$=H9$+H8$(15,2)+" Ply "
8050 RETURN 
8060 REM "Setup Fax String
8065 DIM X$(7*51),EM$(7*21); REM "ssp#134376,WO#271319
8069 CALL "ZZDISP","AX",A$(179,10),"A/R",X3$,T$,"",0,0,X4$
8070 X$(1)="C"+D$(143,12),X$(27)="C:"+T$,EM$(1)="C"+A$(179,10); REM "Customer - ssp#134376
8074 CALL "ZZDISP","AX",A$(7,10),"A/P",X3$,T$,"",0,0,X4$
8075 X$(52)="V"+G2$(133,12),X$(78)="V:"+T$,EM$(22,21)="V"+A$(7,10); REM "Vendor ssp#134376
8077 IF LEN(X7$)<150 THEN DIM J0$(200); J0$(1)="P"+A$(7,10),J0$(138,12)=G2$(133,12) ELSE J0$=X7$; IF STP(J0$(138,12),3," ")="" THEN J0$(138,12)=G2$(133,12)
8078 CALL "ZZDISP","AX",J0$(2,10),"A/P",X3$,T$,"",0,0,X4$
8079 X$(103)="P"+J0$(138,12); IF POS(" "<>J0$(12,4))=0 THEN X$(129)="P:"+T$,EM$(43,21)="P"+J0$(2,10) ELSE X$(129)="P:"+T$+"-"+J0$(12,4),EM$(43,21)="P"+A$(7,10)+J0$(12,4); REM "Plant - ssp#134376
8080 IF LEN(E1$)<150 THEN DIM J0$(200); J0$(1)="C"+A$(179,10),J0$(138,12)=D$(143,12) ELSE J0$=E1$
8081 IF J0$(1,1)="D" THEN X$="Whse" ELSE IF J0$(1,1)="C" THEN CALL "ZZDISP","AX",J0$(2,10),"A/R",X3$,T$,"",0,0,X4$ ELSE CALL "ZZDISP","AX",J0$(2,10),"A/P",X3$,T$,"",0,0,X4$
8082 AA$=E1$; DIM E1$(200); GOSUB 5600; X$(154)="T"+E1$(138,12); IF POS(" "<>E1$(12,4))=0 THEN X$(180)="T:"+T$ ELSE X$(180)="T:"+T$+"-"+E1$(12,4),EM$(64,21)="T"+E1$(2,14); END_IF ; E1$=AA$ ! REM "Ship to - ssp#134376, 240622
8083 X$(205)="S"+H0$(127,12); X$(231,25)="S:"+A$(343,4)+"-"+H0$(5,30),EM$(85,21)="S"+A$(343,4); REM "Salesperson
8085 IF E$(11,1)="D" THEN AA$=E1$; DIM E1$(200); GOSUB 5600; X$(256)="W"+E1$(138,12),X$(282,25)="W:"+E$(12,4)+"-"+E1$(16,35),EM$(106,21)="W"+E$(12,4),E1$=AA$ ! WO153316, Warehouse
8087 IF NOT(NUL(A$(347,4))) THEN X$(6*51+1)="A"+H$(127,12),X$(6*51+27,25)="A:"+A$(347,4)+"-"+H$(5,30),EM$(6*21+1,21)="A"+A$(347,4) ! WO271319 - CSR
8090 IF J8=1 THEN FOR J7=0 TO 4; X$(2+J7*51,25)=P6$(150,12),EM$(2+J7*21,20)="ALIGNMENTPATTERN"; NEXT J7; REM "If alignment pattern, replace with align pat from parameters
8093 CALL "ZZDISP","AX",A$(297,9),"P/O",X3$,T$,"",0,0,X4$; T$="850:"+T$; REM "Tag 1 for fax
8095 RETURN 
8100 REM "Set D1$=normal, D2$=double high printing
8101 REM "Assumes special mode 5 is double & special mode six is un-double
8105 REM "This program assumes that double high is on until turned off, changes will be needed if double high goes off auto. at end of a line see lines 740 & 9905
8110 D1$="",D2$=""
8111 RETURN 
8114 CLOSE (14); OPEN (14)"ZZPARM"
8115 READ (14,KEY="PRINTERS",DOM=8145)D1$,D2$
8120 P=POS(FID(W9)=D2$,2); IF P=0 THEN GOTO 8145
8125 READ (14,KEY="ptr"+D1$(INT(P/2)*8+9,8),DOM=8130)D3$; GOTO 8135
8130 D1$="",D2$=""; GOTO 8145
8135 D1$=D3$(282,16),D2$=D3$(266,16)
8140 D1$=FNS$(D1$),D2$=FNS$(D2$)
8145 RETURN 
8150 REM "Return to normal
8155 IF D1$="" THEN GOTO *RETURN
8160 PRINT (W9)'BO',D1$,'EO',
8175 RETURN 
8200 REM "Goto double high
8205 IF D2$="" THEN GOTO *RETURN
8210 PRINT (W9)'BO',D2$,'EO',
8225 RETURN 
8300 REM "Place in page, F5 = field #, F5$=field info
8303 IF TEXT_MODE THEN IF B$(10,1)<>"M" THEN IF POS(" "<>HEADER$[F5])=0 AND F5<>43 THEN HEADER$[F5]=F5$ ELSE HEADER$[F5]=HEADER$[F5]+"|"+F5$; GOTO 8305; REM "Build string array for call routine to write text file
8304 IF TEXT_MODE AND B$(10,1)<>"M" THEN HEADER$[F5]=F5$; REM "Build string array for call to routine to write text file
8305 IF X9[F5]=0 THEN GOTO 8315 ELSE IF JETFORM_MODE THEN GOSUB JETFORM_PRINT; GOTO 8315
8306 IF B9=1 THEN DIM Q[1]; CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,0,P$,O$,"","",Q{ALL}; GOTO 8315; REM "Use barcode module
8308 IF UNFORM_MODE AND UNF_SPEC THEN IF STP(F5$,2)<>"" THEN QS$="~"+STR(F5:"000")+"~"+STP(F5$,2)+"|"; P$(X9[F5]+Y9[F5]*W3,LEN(QS$))=QS$; END_IF ; RETURN ! SSP 241023
8310 P$(X9[F5]+Y9[F5]*W3,LEN(F5$))=F5$
8315 RETURN 
8320 REM "Offset lines by O0
8325 IF X9[F5]=0 THEN GOTO 8345 ELSE IF JETFORM_MODE THEN GOSUB JETFORM_PRINT; GOTO 8345
8326 IF B9=1 THEN DIM Q[1]; CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,O0,P$,O$,"","",Q{ALL}; GOTO 8345; REM "Use barcode module
8330 P$(X9[F5]+(Y9[F5]+O0)*W3,LEN(F5$))=F5$
8345 RETURN 
8350 REM "F5=field#, F5$=field info. line number is used to index off of I0 set to first line in lines section - 1. line 1  on a line = first line.
8351 REM "Set F4 to highest line # printed
8353 IF TEXT_MODE AND B$(10,1)<>"M" THEN LINE$[ON_LINE,F5]=F5$; REM "Build string array for call routine to write text file
8355 IF X9[F5]=0 THEN GOTO 8395 ELSE IF JETFORM_MODE THEN GOSUB JETFORM_PRINT; F4=1; GOTO 8395
8357 REM IF I0+Y9(F5)*W3>(Y8(2)+Y8(3)-1)*W3 THEN GOSUB 04600
8358 IF B9=1 THEN DIM Q[1]; O0=I0/W3; CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,O0,P$,O$,"","",Q{ALL}; Y9[F5]=Q[0]; GOTO 8361; REM "Use barcode module
8360 P$(I0+X9[F5]+Y9[F5]*W3,LEN(F5$))=F5$
8365 IF Y9[F5]>F4 THEN F4=Y9[F5]
8395 RETURN 
8400 REM "Print a ply line based on I0 offset, F5 index, F5$ data
8403 IF TEXT_MODE THEN IF B$(10,1)<>"M" THEN IF POS(" "<>HEADER$[F5])=0 AND F5<>39 AND F5<>42 AND F5<>43 THEN HEADER$[F5]=F5$ ELSE HEADER$[F5]=HEADER$[F5]+"|"+F5$; REM "Build string array for call routine to write text file
8405 IF X9[F5]=0 THEN GOTO 8445 ELSE IF JETFORM_MODE THEN GOSUB JETFORM_PRINT; GOTO 8430
8410 IF MID(X9$,F5,1)="L" THEN I0=I0+(Y9[F5]-Y9[32])*W3
8415 IF B9=1 THEN DIM Q[1]; O0=I0/W3-A0[6]; CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,O0,P$,O$,"","",Q{ALL}; GOTO 8430; REM "Use barcode module
8420 P$(I0+X9[F5],LEN(F5$))=F5$
8430 IF MID(X9$,F5,1)="L" THEN I0=I0-(Y9[F5]-Y9[32])*W3
8445 RETURN 
8500 REM "SDL= Second Description Line & Line item product codes
8504 DIM X$(187),X[40]; FIND (Z[5],KEY=B$(91,20),DOM=8505)IOL=0495; IF X9[131]<>0 THEN GOTO 8510 ! SSP#260665
8505 DESC$=B$(28,40); IF V3$(2,1)="N" THEN DESC1=POS($A3$=DESC$); IF DESC1<>0 THEN DESC$(DESC1,1)=$9C$
8508 F5=18,F5$=DESC$; GOSUB 8350; F5=187; GOSUB 8350; F5=131,F5$=DIM(40); GOSUB 8350; GOTO 8525 ! WO241399, second printing of description    !SSP#260665          
8510 FIND (Z[5],KEY=B$(91,20),DOM=8525)X$
8515 F5=18,F5$=X$(21,40); GOSUB 8350; F5=187; GOSUB 8350; F5=131,F5$=X$(128,40); GOSUB 8350 ! WO241399, second printing of description
8525 REM "Diversified Label?
8530 IF POS(X3$(9,3)="021500",3)=0 THEN GOTO 8545
8535 FIND (Z[8],KEY="T"+B$(25,3),DOM=8545)X$
8540 IF X$(5,1)="*" THEN F4=8
8545 RETURN 
8550 REM "GET & PRINT PRODUCT CODE DESCRIPTION
8555 FIND (Z[8],KEY="T"+P7$,DOM=8595)X$
8560 F5=100; IF MID(X9$,F5,1)="C" THEN F5$=P7$; GOSUB 8300 ELSE F5$=X$(5,15); GOSUB 8300
8561 IF UNFORM_MODE THEN F5=190,F5$=X$(33,3)+X$(21,1); IF MID(P9$,346,1)<>"Y" THEN GOSUB 8300 ELSE READ (Z[27],KEY=A$(297,9),DOM=*PROCEED); READ (Z[27],END=*NEXT)TMP_PO2$; DIM SPEC_ORD_NUM$(8),SPEC_ORD_LINE_NUM$(3),SPEC_CUST_ITEM$(20); SPEC_ORD_NUM$=MID(TMP_PO2$,82,8),SPEC_ORD_LINE_NUM$=MID(TMP_PO2$,11,3),SPEC_CUST_ITEM$=MID(TMP_PO2$,91,20); GOSUB GET_SPEC_URLS; IF STP(LINE_SPEC_URL$)>"" OR STP(ITEM_SPEC_URL$)>"" THEN F5=190,F5$="URL"+"N"; GOSUB 8300 ELSE GOSUB 8300 ! SSP 241023 !!!SET SPEC TYPE AT COL=1, ROW=2 SSP307287-DBD-116 supress DB/d specs, , 307310,SSP#307388 DBSPT-128879; 307431-The spec code "URL" will be output for spec URL support
8562 F5=156,F5$=P7$; GOSUB 8300; REM "WO100065
8570 IF X$(5,1)="*" AND POS(X3$(9,3)="021500",3)>0 THEN F4=8; REM "For Diversified, * as 1st Char of P/C Desc means custom label
8595 RETURN 
8600 REM "Print item stuff
8605 F5=107,F5$=F$(24,8); GOSUB 8300
8610 F5=108,F5$=F$(32,8); GOSUB 8300
8615 F5=109,F5$=F$(40,2); GOSUB 8300
8620 IF POS(" "<>F$(167,6))>0 THEN F5=20,F5$=F$(167,6); GOSUB 8300
8622 IF F[17]<>0 THEN F5=102,F5$=STR(F[17]:"###,###,###"); IF FPT(F[17])=0 THEN GOSUB 8300 ELSE F5$=F5$+" /"+STR(100*FPT(F[17]):"#0"); GOSUB 8300
8625 IF P7$<>"" AND POS(" "<>P7$)<>0 THEN GOSUB 8550
8630 F5=141,F5$=F$(215,16); GOSUB 8300
8635 IF X9[150]>0 THEN F5=150,F5$=F$(370,10); GOSUB 8300; REM "WO111032, Item Specification Code
8645 RETURN 
8650 REM "Reset line counters used by jetform for positioning line fields
8655 PO_LINE=0; DIM P_LINE[FN%NEA("X9",1)]
8695 RETURN 
8700 REM "Do FS2 stuff
8702 FS2_FOUND$="N"; READ (Z[10],KEY=A$(297,8)+B$(7,3),DOM=8703)IOL=0450; FS2_FOUND$="Y"; GOTO 8709
8704 IF B[20]=0 OR B[21]=0 THEN GOTO 8795 ELSE B0[4]=B[21]*B[2]/B[20]; CALL "FM2EXT",Z[13],0,B$(77,4),B[2],B[1],B0[4],X,2; B0[6]=X; GOTO 8715
8709 REM "If selling u/m <> to po line cost u/m adjusting selling.
8710 IF B0$(124,4)<>B$(77,4) THEN X=B0[4]; CALL "FM2EXT",Z[13],1,B$(77,4),B[2],B0[0],X,B0[6],2; B0[4]=X
8712 IF X9[130]=0 AND B0[4]=0 THEN B0[4]=B0[6]
8715 UM$=B$(77,4),UM0=B(2),F5=96,F5$=STR(B0[4]:M5$); GOSUB 5900; IF B$(10,1)="M" THEN F5$=DIM(5); GOSUB 8350 ELSE GOSUB 8350; REM "SSP#208237
8720 B5=B5+B0[6]; F5=130,F5$=STR(B0[6]:M0$); GOSUB 8350
8722 F5=192,F5$=B0$(124,4); GOSUB 8350 ! IDB#16629
8724 F5=193,F5$=STR(B0[5]:M3$); GOSUB 8350 ! IDB#16629
8725 DIM C0$(32),C0[15]; FIND (Z[9],KEY=B0$(128,5),DOM=8726)IOL=0460
8729 REM "Figure commission x, P3 is set in 2500's to total cost this line
8730 Y$="23O AR4...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1; REM "169855
8731 CALL "AR2COM","",C0$,C0{ALL},X,B0[6],P3
8732 Y$="23C AR4...  09O AR4...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
8735 F5=98,F5$=B0$(128,5); GOSUB 8350
8740 B6=B6+X
8742 IF FS2_FOUND$="Y" THEN EXTRACT (Z[10],KEY=A$(297,8)+B$(7,3),DOM=8743)IOL=0452; B1[25]=X; WRITE (Z[10],KEY=A$(297,8)+B$(7,3))IOL=0453; REM "ssp91762,est comm on line calculated on line 8730
8745 IF A$(173,1)="S" THEN GOTO 8795
8750 IF B0[6]<>0 THEN F5=(B0[6]-P3)*100/B0[6],F5$=STR(F5:M6$),F5=124; GOSUB 8350
8760 F5=123,F5$=STR(B0[6]-P3:M0$(2)); IF B$(10,1)="M" THEN F5$=DIM(5); GOSUB 8350 ELSE GOSUB 8350; REM "SSP#208237
8765 IF B$(7,3)="001" AND POS(" "<>B0$(113,6))>0 THEN F5=142,F5$=FND$(B0$(113,6)); GOSUB 8300
8795 RETURN 
8800 REM "Check to see if any plies remain to be done
8805 IF S0$="" THEN GOTO 8825
8810 L2$="*"
8815 GOSUB 4000
8820 L2$=""
8822 IF S0$<>"" THEN GOTO 8810
8825 RETURN 
8830 REM "Do headup stuff if more lines needed
8834 GOSUB 8850
8837 GOSUB 2900
8840 GOSUB 2100; GOSUB 2150; GOSUB 2200; GOSUB 2350
8845 RETURN 
8850 REM "Print continued message
8855 F5=133,F5$="*Cont*"; GOSUB 8300
8895 RETURN 
8900 REM "U/M
8910 IF B$(77,4)<>L$(4,4) THEN CLOSE (14); OPEN (14)"ZZPARM"; DIM L$(21),L[1]; READ (14,KEY="U/M"+B$(77,4),DOM=8911)IOL=0420
8920 IF L[1]=0 THEN L[1]=1
8940 RETURN 
8950 ! SSP181654, check FS2 record, may have a from customer, set it
8955 IF LEN(S0$)<20 THEN GOTO *RETURN
8960 READ (Z[10],KEY=A$(297,8)+B$(7,3),DOM=*RETURN)FS2$
8965 IF STP(FS2$(161,10),3)>"" AND S0$(1,10)<>DIM(10) AND FS2$(161,10)<>S0$(1,10) THEN S0$(1,10)=FS2$(161,10)
8995 RETURN 
8999 ! 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9020 IF %UNATTEND THEN {
9022 IF NUL(%UNATTEND_ERROR$) THEN %UNATTEND_ERROR$="ERR: "+STR(Y5)+" AT: "+STR(Y6)+" IN PO2PAB"
9025 IF NOT(%GUI) THEN PRINT @(0,10),'CL',"Unattended Error: Program PO2PAB: Error ",STR(ERR),": Line ",STR(TCB(5)),@(0,11),%UNATTEND_ERROR$,
9026 ERR_MSG$=FN%ZZDISP$(PAD(MID(U$,2),9),"P/O")+"|"+%UNATTEND_ERROR$
9027 CALL "ZZ2LOG;LOG_MSG",ERR=*NEXT,X3$,X4$,%LOG_CHANNEL,"EXCP|"+ERR_MSG$+"|",%LOG_DEBUG
9030 IF NOT(NUL(%UNATTEND_EMAIL$)) THEN {
9031 NOTIFYMSG$=""; NOTIFYMSG$=FN%SENDMAIL$(%UNATTEND_EMAIL$,"","","","Unattended Printing Error - PO# "+FN%ZZDISP$(PAD(MID(U$,2),9),"P/O"),"An error occurred when printing purchase order: "+ERR_MSG$,"",""); NOTIFYMSG++; IF NOTIFYMSG>=10 THEN NOTIFYMSG$=FN%SENDMAIL$(%UNATTEND_EMAIL$,"","","","Fatal Unattended Printing Error - PO# "+FN%ZZDISP$(PAD(MID(U$,2),9),"P/O"),"Please review Unattended Printing session for Group "+%UNATTEND_GROUP$+"! Unrecoverable error when printing purchase order: "+ERR_MSG$,"",""); ESCAPE ! 268007-Unrecoverable error - requires admin manual intervention
9032 IF NUL(NOTIFYMSG$) THEN %UNATTEND_ERROR$=""; REMOVE (Z[1],KEY=U$,ERR=1000); GOTO 1000 ELSE CALL "ZZ2LOG;LOG_MSG",ERR=*NEXT,X3$,X4$,%LOG_CHANNEL,"EXCP|EMAIL NOTIFICATION ERROR|"+NOTIFYMSG$+"|",%LOG_DEBUG
9033  }
9034 %UNATTEND_ERROR$="" ! Clear error
9035  }
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "End program
9905 IF W9>0 THEN IF FID(0)<>FID(W9) THEN CLOSE (W9); W9=-1; REM "to prevent formfeed action !SSP#273826
9910 IF V3$(2,2)="A " THEN PRINT 'EA',
9915 IF V8$="A" THEN V3$(2,6)="AUTO"+V7$
9920 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9922 ! IF %GUI AND Y4$="ZZ2PGC" THEN Y4$="",V8$=""; GOTO 9926 ! SSP#207344
9925 IF V8$="A" OR (Y4$<>X0$ AND V3$(2,1)<>"T") AND Q5<>1 THEN IF CALLED$<>"Y" THEN GOSUB 5300; REM "WO131248 !SSP#264953
9930 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9932 IF %UNATTEND THEN CALL "ZZ2LOG;CLOSE_LOG",ERR=*NEXT,X3$,X4$,%LOG_CHANNEL; %LOG_CHANNEL=0 ! Close log channel
9935 CALL "ZZDAPP",X3$,"AALL"
9936 ! IF %GUI AND NOT(NUL(Y4$)) THEN CALL Y4$,ERR=*NEXT ! SSP#207344
9937 IF %GUI AND Y4$<>"" THEN RUN Y4$,ERR=*NEXT
9940 SETERR 9945; EXIT ; REM "WO131248
9945 IF %GUI THEN EXIT 
9950 IF Y4$<>"" THEN RUN Y4$,ERR=9953
9955 RUN "ZMENU"
9999 END 
10000 GET_JOBCARD:
10005 PO_JOBCARD_OVERRIDE$=""
10010 IF MID(V0$,98,1)="Y" THEN {
10040 IF MID(G2$,367,15)<>DIM(15) THEN PO_JOBCARD_OVERRIDE$=STP(G2$(367,15),2)
10085  }
10090 RETURN 
10098 ! 
10099 ! 
10100 SET_JOBCARD:
10105 SAVE_ITEM_PARM$=ITEM_PARM$
10110 IF PO_JOBCARD_OVERRIDE$<>"" THEN {
10120 TMP_PARM$=ITEM_PARM$(12,60); XP=POS(" "=TMP_PARM$)
10130 TMP_PARM$=STP(PO_JOBCARD_OVERRIDE$,2)+TMP_PARM$(XP)
10135 TMP_PARM$=PAD(TMP_PARM$,60)
10150 ITEM_PARM$(12,60)=TMP_PARM$
10180  }
10190 RETURN 
10198 ! 
10199 ! 
10200 RESET_JOBCARD:
10210 ITEM_PARM$=SAVE_ITEM_PARM$
10290 RETURN 
10300 VENDOR_EMAIL_ADDR:! WO250763
10305 DIM EF3$(81),VENDOR_EMAIL_ADDR$(60); IF J8=1 THEN DIM VENDOR_EMAIL_ADDR$(60,"X"); GOTO VENDOR_EMAIL_ADDR_DONE
10310 TRY_1$="P"+A$(7,14)+DIM(6),TRY_2$="P"+A$(7,10)+DIM(10),TRY_3$="V"+A$(7,10)+DIM(10)
10320 FIND (Z[24],KEY=TRY_1$,DOM=*NEXT)EF3$(1); IF STP(EF3$(22,60),3)>"" THEN VENDOR_EMAIL_ADDR$=EF3$(22,60); GOTO VENDOR_EMAIL_ADDR_DONE
10325 FIND (Z[24],KEY=TRY_2$,DOM=*NEXT)EF3$(1); IF STP(EF3$(22,60),3)>"" THEN VENDOR_EMAIL_ADDR$=EF3$(22,60); GOTO VENDOR_EMAIL_ADDR_DONE
10330 FIND (Z[24],KEY=TRY_3$,DOM=*RETURN)EF3$(1); IF STP(EF3$(22,60),3)>"" THEN VENDOR_EMAIL_ADDR$=EF3$(22,60); GOTO VENDOR_EMAIL_ADDR_DONE
10335 VENDOR_EMAIL_ADDR_DONE:
10340 IF STP(VENDOR_EMAIL_ADDR$,3)>"" THEN F5=191,F5$=VENDOR_EMAIL_ADDR$; GOSUB 8300
10345 RETURN 
10349 ! 
10350 GET_CUST_LOC_CODE:! WO268933
10355 DIM CUST_LOCATION$(9); IF J8=1 THEN DIM CUST_LOCATION$(9,"X")
10360 IF E$(11,1)<>"C" THEN RETURN 
10365 DIM FM0$(618); FIND (Z[7],KEY="C"+D$(1,10)+E$(12,4),DOM=*RETURN)FM0$(1)
10370 CUST_LOCATION$=FM0$(214,9)
10395 RETURN 
10399 ! 
10400 GET_SHIP_TO_DESC:! SSP307417-DBD-282
10405 DIM SHIP_DESC$(35); IF J8=1 THEN DIM SHIP_DESC$(35,"X")
10410 IF E$(11,1)<>"C" THEN RETURN 
10415 DIM FM0$(618); FIND (Z[7],KEY="C"+D$(1,10)+E$(12,4),DOM=*RETURN)FM0$(1)
10420 SHIP_DESC$=FM0$(16,35)
10445 RETURN 
10449 ! 
10500 GET_COUNTRY:! SSP 307210
10510 DISP_CNTRY$=""
10520 IF CNTRY$=DFLT_CNTRY$ OR CNTRY$="" THEN RETURN 
10540 DISP_CNTRY$=" "+CNTRY$
10550 CNTRY$=""
10599 RETURN 
11000 IMAGE_LIBRARY_SETUP:! If needed, setup parameters to add image library info to Jetform call
11002 ! SSP307443-DBD-372 RENUMBER 11000 SECTION
11005 IF %HAS_IMAGE_LIB THEN {
11010 %IL_ADD_DOC_TYPE$="A2"
11015 %IL_ADD_TF1$=A$(297,9) ! P/O number
11016 SPEC_CHARS$="<>:"+QUO+"/\|?*" ! SSP307433-DBD-372
11017 PON$=FN%ZZDISP$(MID(A$,297,9),"P/O") ! SSP307433-DBD-372
11018 IF POS(MID(PON$,-1)=SPEC_CHARS$,1)>0 THEN NEWCODE$=HTA(MID(PON$,-1)); PON$=SUB(PON$,(MID(PON$,-1)),NEWCODE$) ! SSP307433-DBD-372
11020 %IL_ADD_TF2$=A$(7,10)+A$(297,9)+STR(P2) ! Vendor code !SSP 211966   
11025 DTS$=DTE(0:"%Yz%Mz%Dz_%Hz%mz%s") ! SSP287486, add date/time
11030 IMG_SEQ$=A$(1,1); IF IMG_SEQ$=DIM(1) THEN IMG_SEQ$="0" ! SSP 211966
11035 IF CALLED$="Y" THEN {! SSP 249025
11040 %IL_ADD_IMAGE_PATH$=STP(PON$)+"_"+STR(P2)+"_"+IMG_SEQ$+"A_"+DTS$ } ELSE {! SSP# 185008  SSP 211966 SSP287486 SSP307433-DBD-372
11045 %IL_ADD_IMAGE_PATH$=STP(PON$)+"_"+STR(P2)+"_"+IMG_SEQ$+"_"+DTS$ ! SSP# 185008  SSP 211966 SSP287486 SSP307433-DBD-372
11050  }
11055 %IL_FORMAT$=V0$(60,1) ! 186095
11060  } ELSE {
11065 %IL_ADD_DOC_TYPE$="",%IL_ADD_TF1$="",%IL_ADD_TF2$="",%IL_ADD_IMAGE_PATH$="",%IL_FORMAT$="" ! 186095
11070  }
11095 RETURN 
11099 ! ****************************************************************
11100 AR3_ALT_DIV:! WO238337
11110 DIM DIV$(402); DIV$=D6$
11115 DIM AR32$(319); READ (Z[15],KEY=A$(343,4),DOM=*RETURN)AR32$
11120 IF MID(AR32$,255,2)=DIM(2) THEN GOTO *RETURN
11125 DIM D62$(402); READ (Z[10],KEY=AR32$(255,2),DOM=*RETURN)IOL=0435
11130 DIM DIV$(402); DIV$=D62$
11145 RETURN 
11149 ! 
11200 DEF FNBL$(LOCAL BF5$)
11205 LOCAL RET$
11210 RET$=BF5$
11220 IF PRT_BLNK$<>"Y" OR MID(BF5$,1,1)<>"N" THEN GOTO END_BL
11230 IF LEN(BF5$)<>1 THEN GOTO END_BL
11240 IF BF5$="N" THEN RET$=""
11260 END_BL:
11270 RETURN RET$
11280 END DEF
11299 ! 
11300 REM "252766 - We will check if specific fields have been modified already in the current PO1 record on disk
11305 CHECK_CHANGES:
11310 LOG_CC_MSG$=""
11320 DIM TMP_PO1$(383); READ (Z[2],KEY=U$(2,9),ERR=CHK_CHG_ERR)TMP_PO1$
11321 IF MID(TMP_PO1$,2,1)<>MID(A$,2,1) THEN A$(2,1)=MID(TMP_PO1$,2,1) ! LOG_CC_MSG$+="|CHECK CHANGES|PO1.VEND_XML_SENT|DISK|"+MID(TMP_PO1$,2,1)+"|PO2PAB|"+MID(A$,2,1) ! PO1.VEND_XML_SENT
11330 DONE_CHECK_CHANGES:
11335 IF %UNATTEND THEN IF NOT(NUL(LOG_CC_MSG$)) THEN CALL "ZZ2LOG;LOG_MSG",ERR=*NEXT,X3$,X4$,%LOG_CHANNEL,"INFO|"+FN%ZZDISP$(PAD(MID(U$,2),9),"P/O")+"|"+TBL(CALLED$="Y","","SECOND PRINTING|")+LOG_CC_MSG$,%LOG_DEBUG
11340 RETURN 
11345 ! 
11346 CHK_CHG_ERR: TMPY5=ERR,TMPY6=TCB(5); LOG_CC_MSG$+="|CHECK CHANGES|ERR: "+STR(TMPY5)+" AT: "+STR(TMPY6)+" IN PO2PAB"; GOTO DONE_CHECK_CHANGES
11349 ! 
11350 GET_SPEC_URLS:! SSP307287-DBD-116
11355 LINE_SPEC_URL$="",ITEM_SPEC_URL$=""
11360 IF SPEC_ORD_LINE_NUM$<>DIM(3) THEN CALL "ECGM3I;CALL_SPEC_URL",ERR=*NEXT,SPEC_ORD_NUM$,SPEC_ORD_LINE_NUM$,LINE_SPEC_URL$
11370 IF SPEC_CUST_ITEM$(1,10)<>DIM(10) THEN CALL "FMGFV8;CALL_SPEC_URL",ERR=*NEXT,SPEC_CUST_ITEM$,ITEM_SPEC_URL$
11373 RETURN 
11374 ! 
11375 OUTPUT_SPEC_URL:! output either line or item spec URL
11380 IF STP(LINE_SPEC_URL$)>"" THEN F5$=STP(LINE_SPEC_URL$) ELSE IF MID(X9$,208,1)="I" AND STP(ITEM_SPEC_URL$)>"" THEN F5$=STP(ITEM_SPEC_URL$)
11390 IF STP(F5$)>"" THEN F5=208; GOSUB 8350
11395 RETURN 
11399 ! 
11400 BUILD_COMPANION_LIST:! Read through lines and look for master and companion pairs
11410 DIM FS2$(356); COMP$=""; READ (Z[10],KEY=A$(306,8),DOM=*NEXT)
11415 FS2_KEY$=KEY(Z[10],END=*RETURN); IF FS2_KEY$(1,8)<>A$(306,8) THEN RETURN 
11420 READ (Z[10],KEY=FS2_KEY$)FS2$(1)
11425 IF NOT(NUL(FS2$(230,3))) AND POS(FS2$(155,1)="M")>0 THEN COMP$+=FS2$(230,3)+FS2$(6,3) ! only check for "M" type companion lines
11435 GOTO 11415
11440 RETURN 
11449 ! 
56000 REM "186670-Add ability to output purchase orders by a Vendor Set       
56002 REM "199188-Error zero in unattended printing                           
56003 REM "200531-Home Department for CSR does not work                       
56010 ! "191685-Stock P/O 334 will not print, see notes. PO 344 will not    
56011 ! "200446-This error happens a lot when trying to print PO's from     
56012 ! "       I can go into CHUI after I get this error and PO's print.
56014 REM "205703-Oracle - FID and FIB calls, replace with FN%FID$ and FN%FIB$
56015 REM "218506-Purchase order printing - Custom change to change           
56016 REM "214091-Email from Brenda requesting ability to have another  
56017 ! "207344-AUTO4 will not print anything from GUI but works in CHUI    
56018 REM "236695-PO printing-wants to know the number of pages for PO PDF
56020 REM "236789-Add flexible format field for PO and PL, ship-to phone num.
56022 REM "238337-New Alternate Division for PO/RFQ print in AR3, mod to PO
56023 REM "238796-WebEC Buyer bill to override is not working                 
56024 REM "233147-Get error 0 in unattended, packing list and PO printing.
56026 REM "239001-Need to have the 4 digit ship to code added to the purchase
56027 REM "240622-JFAXT-Location data not getting included properly 
56028 ! 240760 - Field 147 REPRINT not working
56030 REM "241023-Modify printing programs to use Unform                      
56032 REM "245519-PO printing using Unform, treat multi-page POs as single job
56034 REM "245584-Salesperson phone and fax are not correct on po             
56035 REM "246624-If you don't mark the questions in the comp section it fills
56036 REM "248108-Testing Unform Purchase Orders - the starting numbers        do not print
56037 REM "248242-Getting error 11 trying to print po's using alternate seq   
56040 REM "249025-Imaged copy is not the correct copy for Unform.             
56041 REM "249021-How do I get this message to not pop up with unattended     
56042 REM "250763-Add Vendor Email Address as field to PO, add to PO Prining. 
56044 REM "248040-PE(026, PO2PAC-1410) when in Unattended printing.           
56045 REM "255027-Field 106 - Your item number (includes heading) on the      
56046 REM "252766-Flowpoint XML PO's to BCT sometimes going more than once.   
56047 REM "260665-Quote to pull 2nd description field that shows in I/C, S1   
56048 REM "262397-Proactive change, validate all form printing programs for   
56049 REM "264953-Receiving thousands of emails from Unattended printing      
56050 REM "266211-PE(047, PO2PAB-4460) when in purchase order printing.       
56051 REM "266959-Program exception in Unattended printing, same as ref number
56052 REM "016629-Would like the following field added to the Flexible format 
56054 REM "268933-Add location code (9) from ship-to as flexible format field 
56055 REM "271319-New fax/email type CSR. Modify PO Printing to honor this new
56056 REM "273389-Line 7 on order 00-A00FGC keeps printing on the PO as $0 and
56057 REM "273826-PE(041, PO2PAB-9905) in Unattended Printing logs.           
56058 REM "275772-Add 10 Order Customer Reference fields (FV1 file) to the PO 
56060 REM "275705-Add PO Scheduled Shipping Date to PO Flexible Format.       
56061 REM "285703-Split ship orders, Unform output combined PO, breaks delivery options
56062 REM "287486-See 287466/568; add date/time to I/L filename for PO and PL 
56064 ! 290559-override field 165 with full URL if in EEM
56066 ! 291991-field 206 Cust/Shipto/Shipvia Shipper ID O=Override
56068 REM "307210-DBD-63-International shipping address - add country code           
56069 REM "307210-DBD-98-International shipping address - add country code           
56070 REM "307287-DBD-116; Suppress specs on PO if spec URL present from DB/a.
56072 REM "307307-DBSPT-101107; PO not printing completely PE(047-PO2PAB-2232)
56073 REM "307310-DBD-116 - Timing issue with spec URL logic causing specs to show
56074 REM "307388-DBSPT-128879 Standard composition not printing on Purchase  
56076 REM "307417-DBD-282;Add Ship-to Desc to PO Flexible Format and Printing 
56077 REM "307431-PO Printing - Spec URL support for DB Sourcing URL          
56078 REM "307433-DBD-332: Display Third-party order ID in O/P Entry, History 
56079 ! DBD-322 2nd Full URL field 211
56080 REM "307443-DBD-372; PO Code Special Characters in Image Filename       
56082 REM "307446-DBD-380; Error 12 when EC module not present                
56083 REM "307472-DBD-395: PO Printing - Companion items and Special shipping 
