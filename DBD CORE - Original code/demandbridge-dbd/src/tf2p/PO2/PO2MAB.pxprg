0010 REM "Purchase Order Entry - Line entry <PO2MAB>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 10/10/14 - 11.735555 - jvv - SSP# 273055
0037 REM "273055-Expand IC2 for 6 additional cost breaks, allow entry in GUI 
0040 REM "Copyright 2014 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0080 IF L0=1 THEN L0=0; GOTO 1800
0090 CLEAR ; SETERR 0091; ENTER X3$,X4$,Q0$,Q1$; GOTO 0100
0095 BEGIN 
0100 SETERR 9000
0110 X0$="PO2MAB",X1$="Purchase Order Line Setup",K9$="",K9=0
0120 DIM Z0$(80,"-"),L[29]
0130 K0=9,K1=2
0135 C9=-1,V0=3
0140 M0$="###,###.00-",M1$="##,###,###.00-",M2$="#####0-",M4$="#,###.00-"
0145 IF Q1$="" THEN GOSUB 8950
0150 IF R0$<>"" THEN X1$="Receive Purchase Orders"
0160 DEF FNS$(Z9$)=Z9$(1,POS("    "=Z9$+"    ")-1)
0200 REM "
0225 Q8$=Q1$
0230 IF Q1$<>"" THEN X2=-1; IF F0$<>"" THEN PRINT @(0,7),'CE', ELSE PRINT @(0,3),'CE',
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0309 REM "Change in special shipping also both P/O and S/O
0310 IOLIST A$(1,LEN(A$)),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24],A[25],A[26],A[27]
0311 IOLIST A$(1,LEN(A$)),STR(A[0]),A[1],A[2],A[3],A[4],A[5],A[6],A[7],STR(A[8]),A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],STR(A[17]),A[18],A[19],A[20],STR(A[21]),A[22],A[23],A[24],A[25],A[26],A[27]
0320 IOLIST B$
0330 IOLIST C$
0340 IOLIST D$
0341 IOLIST D1$,D[0],D[1],D[2]
0350 IOLIST E$
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14],F[15],F[16],F[17],F[18],F[19],F[20],F[21],F[22],F[23],F[24],F[25],F[26],F[27],F[28],F[29],F[30] ! WO273055
0370 IOLIST G$
0380 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13],H[14],H[15],H[16],H[17],H[18],H[19],H[20],H[21],H[22],H[23],H[24],H[25],H[26],H[27],H[28],H[29],H[30],H[31]
0390 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15],I[16],I[17],I[18],I[19],I[20],I[21],I[22],I[23],I[24],I[25],I[26],I[27],I[28],I[29],I[30]
0400 IOLIST U$,U[0],U[1]
0410 IOLIST L$,L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15],L[16],L[17],L[18],L[19],L[20],L[21],L[22],L[23],L[24],L[25],L[26],L[27],L[28],L[29]
0411 IOLIST L$,L[0],STR(L[1]),L[2],L[3],STR(L[4]),L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],STR(L[15]),L[16],L[17],STR(L[18]),L[19],L[20],L[21],STR(L[22]),L[23],L[24],L[25],L[26],L[27],L[28],L[29]
0420 IOLIST J$,J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8],J[9],J[10],J[11],J[12]
0421 IOLIST J$,J[0],STR(J[1]),J[2],J[3],J[4],STR(J[5]),J[6],J[7],J[8],J[9],J[10],J[11],J[12]
0425 IOLIST JJ$,JJ[0],JJ[1],JJ[2],JJ[3],JJ[4],JJ[5],JJ[6],JJ[7],JJ[8],JJ[9],JJ[10],JJ[11],JJ[12] ! SSP 211614
0430 IOLIST PO2$,PO2{ALL} ! SSP229416 jdf
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01X PO2...  02O PO1...  03O FM0...  04O FMP...  05O AR1...  06O IC2...  07O AP4...  08O FM1...  09O FS2...  10O IC0...  11O POA...  12O PO7...  13O ZZPARM  15O PO3...  16O FS1...  17O POH... "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0550 DIM M6[1]; CALL "IC2PRE",X3$,Z[13],M6$,M6{ALL},"",0,"",0
0570 DIM S6$(255); FIND (Z[13],KEY="osec"+X3$(40,3),DOM=0571)S6$
0580 READ (Z[13],KEY=X3$(9,3)+"F/M")P4$
0590 READ (Z[13],KEY=X3$(9,3)+"I/C")P$
0595 P8=NUM(P$(40,2)),P9=NUM(P$(42,1))
0600 REM "
0620 GOSUB 6000
0690 READ (Z[1],KEY=K9$,DOM=0691)
1000 REM "
1010 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
1030 DIM B$(383),C$(126),D$(100),E$(100),G$(100),H$(126),H[31],I$(187),I[30],U$(20),U[1],F$(115),F[30],D[2],S0$(30),D1$(61) ! WO273055  
1035 DIM A$(170),A[27]
1045 A$(10,1)="I"; PRINT @(23,4+V0),A$(10+K9,1),
1049 IF F9$="*" THEN A1$=Q1$
1050 IF Q1$<>"" THEN GOTO 1100
1060 PRINT (0,ERR=1070)'CF',; GOSUB 6450; GOTO 1100
1070 GOSUB 6000; GOSUB 6450
1100 REM "KEY SEQ
1110 X0=-1,C0=0,X1=0,C9=0,Z9=0
1120 C0=ABS(C0),X$=""; IF C0=2 AND X0>0 THEN X0=X0-1 ELSE IF C0<>2 THEN X0=X0+1; IF C0=4 THEN GOTO 9700
1140 ON X0 GOTO 1200,1250,1500
1200 REM "P/O number
1202 IF Q1$<>"" THEN IF C0=2 THEN GOTO 9700 ELSE A1$=Q1$,A$(82+K9)=Q1$; GOSUB 6450
1205 IF LEN(A1$)>0 THEN A$(82,9)=A1$(1,9); GOTO 1212
1210 CALL "ZZENTR","AXUX",A{ALL},A$,X4$,X3$,39,3,82,9,C0,"P/O","{1"+X$,"","PO2MAB00","PO1","PO2MAA",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 1210,1211
1215 IF C0<0 THEN ON INT(ABS(C0)-2) GOTO 1210,6800,9700,6970
1220 EXTRACT (Z[2],KEY=A$(82+K9,9),DOM=1210)IOL=0320
1225 FIND (Z[7],KEY=B$(7,10),DOM=1226)IOL=0370
1230 IF POS(" "<>B$(17,4))<>0 THEN FIND (Z[3],KEY="P"+B$(7,14),DOM=1231)IOL=0330
1235 GOSUB 7600
1240 GOTO 1120
1250 REM "Line number
1252 IF F9$="*" AND LEN(Q1$)>=12 THEN A$(7,3)=Q1$(10,3); GOTO 1262
1253 IF R0$<>"" THEN GOTO 1255 ELSE IF A5$="" THEN A$(7,3)="001" ELSE A$(7,3)=STR(NUM(A5$)+1:"000")
1254 PRINT @(10,4+V0),A$(7,3); GOTO 1260
1255 IF LEN(A1$)>9 THEN A$(7,3)=A1$(10,3); PRINT @(10,4+V0),A$(7,3),; GOTO 1262
1257 IF R0$<>"" THEN GOSUB 7500; X$="'ADD' for new line"
1260 Q$=A$(82,9); CALL "ZZENTR","SZUX",A{ALL},A$,X4$,X3$,10,4+V0,7+K9,3,C0,"","{2"+X$,Q$,"PO2MAB02","PO2","",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 1260,1261
1261 IF A$(7+K9,3)="ADD" AND R0$<>"" THEN GOTO 8800 ELSE I=NUM(A$(7+K9,3),ERR=1260)
1262 IF ABS(C0)=2 AND LEN(A1$)>0 THEN A1$=A1$(1,0)
1265 IF C0<0 THEN IF R0$="" AND -C0=1 THEN GOTO 1266 ELSE C0=ABS(C0)
1290 GOTO 1120
1500 REM "
1505 Z9=-1
1510 A1$=K9$+A$(82,9)+A$(7,3),A$(1,LEN(K9$))=K9$
1515 GOSUB PERMIT_DELETE ! SSP229416 jdf
1520 READ (Z[1],KEY=A1$,DOM=1600)IOL=0310
1525 Z9=0
1530 FIND (Z[2],KEY=A$(1+K9,6),DOM=1531)IOL=0320
1535 FIND (Z[4],KEY="T"+A$(25+K9,3),DOM=1536)IOL=0340
1536 IF A$(10,1)="S" THEN FIND (Z[4],KEY="X"+A$(101,10),DOM=1537)IOL=0341; GOTO 1542
1537 IF A$(10,1)="M" OR A$(10,1)="N" THEN GOTO 1542
1540 FM1=1; IF A$(10+K9,1)="I" OR A$(10+K9,1)="X" OR A$(10+K9,1)="C" THEN FIND (Z[10],KEY=A$(91,20),DOM=1541)IOL=0390; I9=1; GOSUB 8100 ELSE FM1=0; FIND (Z[8],KEY=A$(91,20),DOM=1541)IOL=0380; FM1=1; REM SSP 203803 changed to also look for C type
1541 IF NOT(FM1) THEN CALL "ZZPROM",".Y",X3$,Z,"|Item is not in the Forms Master File. Continue","","",0; ON Z GOTO 1542,1000
1542 FIND (Z[7],KEY=B$(7,10),DOM=1545)IOL=0370
1544 IF POS(" "<>B$(17,4))<>0 THEN FIND (Z[3],KEY="P"+B$(7,14),DOM=1545)IOL=0330
1545 FIND (Z[5],KEY=A$(91,10),DOM=1546)IOL=0350
1546 DIM HOLDH[31]; HOLDH$=H$; FOR X=0 TO 31; HOLDH[X]=H[X]; NEXT X; REM "hold H$ info if form master not found return to item master info
1550 DIM H[31],H$(325); FIND (Z[8],KEY=A$(91,20),DOM=1551)IOL=0380; GOTO 1555
1552 H$=HOLDH$; FOR X=0 TO 31; H[X]=HOLDH[X]; NEXT X
1555 FIND (Z[13],KEY="U/M"+A$(77,4),DOM=1556)IOL=0400
1560 FIND (Z[9],KEY=A$(82,8)+A$(7,3),DOM=1561)IOL=0410
1562 LOT_INV=0; GOSUB CHECK_FOR_LOT_INV; IF LOT_INV THEN GOTO 1000 ! ; GOTO 1120 ! AP Vendor invoice # enetered SSP 211614
1565 IF R0$<>"" THEN J0=0; GOSUB 8400; Z=-1,X0=27; GOTO 1850
1570 IF F9$="*" THEN Q1$=Q1$(1,9); RUN "PO2MA2"
1590 GOTO 1700
1600 REM "
1605 IF POS(R0$="Rr")>0 THEN GOTO 1621
1610 GOSUB 7800
1620 CALL "ZZPROM","2",X3$,Z,"","","",0; ON Z GOTO 1650,1630
1630 IF Q1$=A1$ THEN GOTO 9700 ELSE A5$=A1$(10),A1$=A1$(1,9); GOTO 1000
1690 GOTO 2000
1700 REM "
1790 GOSUB 6200
1800 REM "
1805 REM IF R0$="" THEN IF A$(6,1)<>" " THEN CALL "ZZPROM","4",X3$,X,"This line is in PO Receiving and cannot be changed!","","",0; GOTO 1630;REM 202849 moved this check to the header...checking the batch file
1810 IF Q0$="2" THEN CALL "ZZPROM","4",X3$,Z,"","","",X0; GOTO 9900
1814 IF %HAS_IMAGE_LIB THEN %IL_IMAGE_TYPE$="PO",%IL_IMAGE_KEY$=A1$
1815 IF LEN(Q1$)=LEN(A1$) THEN CALL "ZZPROM","1",X3$,Z,"","","V",X0; %IL_IMAGE_TYPE$="",%IL_IMAGE_KEY$=""; ON Z+1 GOTO 1850,6700,1850
1820 CALL "ZZPROM",STR(6+C9),X3$,Z,"","","V",X0; %IL_IMAGE_TYPE$="",%IL_IMAGE_KEY$=""; ON Z GOTO 1850,6500,1630,6700
1830 GOTO 2000
1850 GOSUB 6200
1855 X0=X0-1; IF Z9=1 THEN GOTO 1880 ELSE IF Z9=0 THEN Z9=1
1860 IF R0$<>"" THEN EXTRACT (Z[1],KEY=A1$,DOM=1870)A$ ELSE EXTRACT (Z[1],KEY=A1$,DOM=1870)IOL=0310
1861 REM IF R0$<>"" THEN GOSUB 8400
1862 IF R0$<>"" THEN GOSUB 7000
1865 C9=1
1870 GOSUB 6200
1880 IF POS(R0$="Rr")>0 AND P$(62,1)="Y" AND POS(A$(10+K9,1)="IX")>0 THEN CALL "PO2MA3",X3$,X4$,I$,I{ALL},P$,N0; IF N0=6420 THEN N0=0; GOSUB 6420
1890 IF Z<0 THEN GOTO 2035 ELSE GOTO 2000
2000 REM 
2010 L0=2; RUN "PO2MA2"
2035 L0=3; RUN "PO2MA2"
6000 REM "BACKGROUND
6005 DIM U[1],H[18]
6010 CALL "PO2MA1",X3$,X4$,6000,N0,A$,A{ALL},B$,E$,U$,H$,U[1],H[2],E2$,E4$,R0$
6190 RETURN 
6200 REM "DISPLAY DATA
6215 IF A$(10,1)="S" THEN IF D1$(61,1)="Y" THEN R0$=R0$+"*"
6220 CALL "PO2MA1",X3$,X4$,6200,N0,A$,A{ALL},B$,E$,U$,H$,U[1],H[2],E2$,E4$,R0$
6265 IF A$(90,1)<>" " AND LEN(L$)>4 THEN PRINT @(8,18+V0),'SB',"Fixed price?",'SF',@(21,18+V0),L$(4,1),
6290 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6410 IF A$(10,1)="S" THEN IF D1$(61,1)="Y" THEN R0$=R0$+"*"
6420 CALL "PO2MA1",X3$,X4$,6400,N0,A$,A{ALL},B$,E$,U$,H$,U[1],H[2],E2$,E4$,R0$
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6460 CALL "PO2MA1",X3$,X4$,6450,N0,A$,A{ALL},B$,E$,U$,H$,U[1],H[2],E2$,E4$,R0$
6462 GOSUB 7600
6464 PRINT @(10,4+V0),A$(7+K9,3),
6490 RETURN 
6500 REM "DELETE
6501 IF S6$(67,1)="Y" AND B$(189,1)="P" AND X0$<>"PO2MAR" THEN CALL "ZZPROM",".4",X3$,0,"Access denied!  Purchase Order previously printed. May not be deleted.","","",0; GOTO 1820; REM "WO105690,SSP117282,SSP117663
6506 IF DELETE_HIDE THEN CALL "ZZPROM",".4",X3$,0,"Access Denied!  Purchase Order has been received.  May not be deleted.","","",0; GOTO 1820 ! SSP229416 jdf
6510 IF R0$="" THEN REMOVE (Z[1],KEY=A1$,DOM=6511) ELSE A$(6,1)="",A[7]=0,A[8]=0,A[14]=0,A[12]=0,A[10]=0,A[16]=0,A[17]=0; WRITE (Z[1],KEY=A1$)IOL=0310
6515 IF R1$="" THEN GOTO 6560
6520 K$=A$(82,9)+R1$(1,10)+A$(7,3); DIM J$(130),J[12]
6525 READ (Z[12],KEY=K$,DOM=6526)
6530 K0$=KEY(Z[12],END=6550); READ (Z[12],KEY=K0$)IOL=0420
6535 IF K0$(1,LEN(K$))<>K$ THEN GOTO 6550
6537 IF J$(66,3)<>"   " THEN CALL "FM2ICC",X3$,X4$,"PO2MAB",-1,J$,J{ALL},"",0; REM "WO111482, Inventory Costing, delete FTF record(s) that go with this PO7 rec
6540 REMOVE (Z[12],KEY=K0$)
6545 GOTO 6530
6550 IF P$(44,1)="Y" AND LOT_DELETE THEN X$=A1$; CALL "IC2LAC",X3$,X4$,"",X$ ! SSP 239950
6590 GOTO 1630
6600 REM "ALT KEY DATA READS
6605 FIND (Z[2],KEY=A1$(1,9),DOM=6606)IOL=0320
6690 RETURN 
6700 REM "ADD ENTRY
6706 IF R0$<>"" THEN GOSUB 8450
6708 IF R0$<>"" THEN IF P4$(272,1)="Y" THEN M$="Reprint Packing List for line "+A$(11,3)+" after PO Receiving Update?"; EXTRACT RECORD (Z[16],KEY=A$(82,8),DOM=6709)FS1$; IF FS1$(128,1)="Y" THEN CALL "ZZPROM",".RR",X3$,S3,M$,"","",0; IF S3=0 THEN FS1$(128,1)=" "; WRITE RECORD (Z[16],KEY=A$(82,8))FS1$; REM "WO94734. SSP262306, changed prompt from .RP to newly created .RR
6709 REM IF U$(21,1)="Y" OR (A$(10,1)="S" AND D1$(61,1)="Y") THEN LET A(0)=A(4)
6710 WRITE (Z[1],KEY=A1$)IOL=0311
6715 A6$=A1$
6725 IF POS(A$(10,1)="IC")<>0 AND A$(14,1)<>"Y" THEN CALL "PO2MAC",X3$,X4$,A$(82,9)+A$(7,3),B$(173,1),I$
6780 IF R0$="" THEN IF A$(14,1)="Y" OR (A$(81,1)="Y" AND FNS$(A$(91,10))>"") THEN GOTO 7700
6783 REM " R0$<>""
6784 IF A$(10,1)="S" THEN IF D1$(61,1)="Y" THEN GOTO 6786
6785 IF A$(14,1)="Y" AND J[0]<>0 THEN U1$="PO2MAF22"+A$(82,9)+R1$(1,10)+A$(7,3)+"PO2MAB"+STR(2+LEN(A6$)+LEN(Q4$):"00")+"@"+A6$+"@"+Q4$+U1$; GOTO 9715; REM "Skip call to PO2MAH ; !SSP 239950
6786 REM "If still here, then no special shipping, do we need to do lots?
6787 IF R1$<>"" THEN IF B$(173,1)<>"C" AND P$(44,1)="Y" AND J[0]<>0 AND I$(112,1)="Y" THEN J1$=A$(82,9)+R1$(1,10)+A$(7,3),JLOT$=J1$; CALL "PO2MAU",X3$,X4$,JLOT$,A{ALL},""," ",8800,"",J{ALL},""; CALL "IC2LAB",X3$,X4$,"",J1$; CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0; GOSUB 6000 ! SSP 239950 SSP 241034 SSP 242707
6788 ! IF R1$<>"" THEN IF B$(173,1)<>"C" AND P$(44,1)="Y" AND J[0]<>0 AND I$(112,1)="Y" THEN J1$=A$(82,9)+R1$(1,10)+A$(7,3),JLOT$=J1$; CALL "PO2MAU","X3$,X4$,JLOT$,A{ALL},""," ",8800,"",J{ALL},"";CALL "IC2LAB",X3$,X4$,"",J1$; CALL "PO2MAU",X3$,X4$,JLOT$,A{ALL},""," ",8800,"",J{ALL},""; CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0; GOSUB 6000 ! SSP 239950 SSP 241034
6790 GOTO 1630
6800 REM "NEXT ENTRY IN FILE
6805 ON 10*FPT(C0)+2 GOTO 6850,6806
6810 A1$=KEY(Z[1],END=6895)
6815 GOSUB 6600
6820 IF A1$(1,LEN(K9$))<>K9$ THEN GOTO 6895
6822 IF Q1$<>"" THEN IF A1$(1,LEN(Q1$))<>Q1$ THEN PRINT 'RB',; READ (Z[1],KEY=Q1$,DOM=1140); GOTO 1140
6825 A$(1,LEN(A1$))=A1$
6830 GOSUB 6600
6835 GOSUB 6450
6840 GOTO 1515
6850 REM PRIOR ENTRY
6855 CALL "ZZKEYP",ERR=6856,Z[1],A1$; GOTO 6820
6860 CALL "ZZKEYL",ERR=6861,Z[1],A1$; GOTO 6820
6870 GOTO 6895
6890 GOTO 1515
6895 PRINT 'RB',; READ (Z[1],KEY=K9$,DOM=1140); GOTO 1140
6902 V9$="1203  6104  7404  1806  6106  0009  1109  3909  1711  1713  1715  5511  6311  5513  5515  "
7000 REM "Preset values if receiving
7010 IF A[18]=0 THEN IF A$(10,1)="I" THEN A[18]=I[16] ELSE IF A$(10,1)="C" THEN A[18]=H[18],A[19]=H[17]
7020 IF POS(" "<>A$(119,12))=0 THEN A$(119,12)=B$(248,12),A$(131,6)=B$(260,6)
7040 RETURN 
7500 REM "If receiving get next line number
7504 REM "A6$ set @ 6715
7505 IF A6$="" THEN A6$=A$(82,9)
7510 READ (Z[1],KEY=A6$,DOM=7511)
7515 K8$=KEY(Z[1],END=7540)
7520 IF K8$(1,9)=A6$(1,9) THEN A$(7,3)=K8$(10)
7530 READ (Z[1],KEY=K8$)K6$
7535 REM IF K6$(10,1)="M" THEN GOTO 7515
7540 RETURN 
7600 REM "Print P/O stuff
7610 CALL "ZZDISP","A",B$(7,10),"A/P",X3$,"","",17,4,X4$
7615 PRINT @(5,5),G$(11,35),@(61,4),B$(17,4),@(44,5),B$(21,35),
7640 RETURN 
7700 REM "P/O Spec Ship & Specs Run Logic
7705 U1$="PO2MAB"+"13"+"#"+A$(82,9)+A$(7,3)+U1$
7720 IF A$(14,1)="Y" THEN U1$="PO2MAD12"+A1$+U1$
7730 IF A$(81,1)="Y" AND FNS$(A$(91,10))>"" THEN Q4$=A$(91,20)+FNS$(A$(101,10))+" - "+FNS$(A$(28,40)),U1$="FM2OB6"+STR(LEN(Q4$):"00")+Q4$+U1$
7740 GOTO 9700
8100 REM "Assign inv values to cust job rec, read in inv-vendor stuff
8110 DIM H$(448); H$(24,18)=I$(64,18),H$(96,4)=I$(124,4),H[2]=I[15],H[0]=I[19]
8115 IF I9=1 THEN I9=0; GOTO 8140
8120 FIND (Z[6],KEY=A$(91,20)+B$(7,14),DOM=8140)IOL=0360
8125 A$(77+K9,4)=F$(55,4),A[0]=F[13],H$(96,4)=F$(55,4),A[2]=F[14],H[2]=F[14],H[0]=F[16],A[5]=F[16]
8140 RETURN 
8400 REM "Remove PO7, either delete or prepare for PO2 entry
8402 OPTIONS$=""
8403 LOT_DELETE=0 ! SSP 239950
8405 IF P4$(280,1)="Y" AND B$(351,1)="B" AND A$(7,3)<>"001" THEN OPTIONS$=OPTIONS$+"P"+"W"; REM "WO111482, Inventory costing feature, get product code and warehouse to ship to from FTE record
8410 CALL "PO2MAU",X3$,X4$,A$,A{ALL},R1$," ",8400,J$,J{ALL},OPTIONS$
8420 IF POS("L"=OPTIONS$)<>0 THEN LOT_DELETE=1 ! SSP 239950
8445 RETURN 
8450 REM "Add back to P07 if after PO2 entry
8452 OPTIONS$=""
8455 IF P4$(280,1)="Y" AND B$(351,1)="B" AND A$(7,3)<>"001" THEN OPTIONS$=OPTIONS$+"P"+"W"
8460 CALL "PO2MAU",X3$,X4$,A$,A{ALL},R1$," ",8450,J$,J{ALL},OPTIONS$
8495 RETURN 
8700 REM "Call po2mah
8710 CALL "ZZDAPP",X3$,"DZZENTRZZINPT"
8730 CALL "PO2MAH",X3$,B$(173,1),B$(297,9),"1"
8735 CALL "ZZDAPP",X3$,"AALL"
8740 RETURN 
8800 REM "Add a new orderline
8802 IF POS(" "<>B$(306,8))=0 THEN GOTO 8825
8805 U1$="FM2ODB27"+"@"+A$(82,9)+"001"+B$(7,14)+"PO2MAB"+STR(2+LEN(A6$)+LEN(Q4$):"00")+"@"+A6$+"@"+Q4$+U1$; GOTO 9715; REM "Skip call to PO2MAH
8810 GOTO 9715
8825 REM "STOCK P/O -add line
8830 U1$="PO2MAB10"+A6$(1,9)+"*"+"PO2MAB"+STR(2+LEN(A6$)+LEN(Q4$):"00")+"@"+A6$+"@"+Q4$+U1$; GOTO 9715; REM "Skip call to PO2MAH
8950 REM "Program flow logic
8960 DIM U0$(6); U0$(1)=FID(0),U0$=U0$+"PF"
8970 CLOSE (14); OPEN (14)"ZZPARM"; FIND (14,KEY=U0$,DOM=8990)U0$,U1$
8975 IF U1$="" THEN GOTO 8990 ELSE IF U1$(1,6)<>X0$ THEN GOTO 8990
8980 Q1=NUM(U1$(7,2)),Q1$=U1$(9,Q1),U1$=U1$(Q1+9); IF LEN(Q1$)<=9 THEN GOTO 8985
8981 IF Q1$(10)="*" THEN Q1$=Q1$(1,9),F0$="*" ELSE F0$=""
8982 IF Q1$(1,1)="@" THEN Q1$=Q1$(2),Q0=POS("@"=Q1$+"@"),A6$=Q1$(1,Q0-1),Q1$=Q1$(Q0+1)
8983 Q4$=Q1$; IF LEN(Q1$)>=10 AND POS(Q1$(10,1)="Rr")<>0 THEN F0$="*",R1$=Q1$(11),R0$=Q1$(10,1),Q1$=Q1$(1,9) ELSE R0$=""
8985 REM "All refs to len(Q1$)=12 are display from IC2MAI stuff
8987 F9$=""; IF Q1$(1,1)="!" THEN F9$="*",Q1$=Q1$(2),L0=4; IF Q1$(1,1)="!" THEN Q1$=Q1$(2),L0=5
8988 IF Q1$(1,1)="#" THEN Q1$=Q1$(2),A5$=Q1$(10,3),Q1$=Q1$(1,9)
8990 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9700 REM "PROG FLOW
9705 REM "For call from IC2MAI to PO2MAA
9706 IF LEN(Q1$)=12 THEN PRINT @(0,3),'CE',
9710 IF U1$="" THEN REMOVE (Z[13],KEY=U0$,DOM=9900); GOTO 9900
9714 IF R0$<>"" THEN GOSUB 8700
9715 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9720 WRITE (Z[13],KEY=U0$)U0$,U1$
9725 O1=0
9730 RUN U1$(1,6)
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 IF R0$<>"" THEN CALL "PO2MAH",X3$,B$(173,1),B$(297,9),"1"
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
10600 CHECK_FOR_LOT_INV:! SSP 211614
10602 IF R1$="" THEN RETURN 
10605 LOT_INV=0
10610 IF P$(44,1)="Y" AND I$(112,1)="Y" THEN GOTO *NEXT ELSE GOTO *RETURN ! Only do check in POH if inventory SSP 211614
10615 PO7_FIND$=A$(82,9)+R1$(1,10)+A$(7,3)+" "
10620 FIND (Z[12],KEY=PO7_FIND$,DOM=10630)*; GOTO *RETURN
10640 PO7_CNT=0,POH_CNT=0,PO7_PO$="",PO7_HOLD$=A$(82,9)+R1$(1,10)+A$(7,3); DIM JJ$(130),JJ[12]
10645 READ (Z[12],KEY=A$(82,9)+"",DOM=10650)
10650 KEY7$=KEY(Z[12],END=10700); READ (Z[12],KEY=KEY7$)IOL=0425
10660 IF KEY7$(1,9)<>A$(82,9) THEN GOTO 10700
10670 IF KEY7$(20,3)<>A$(7,3) THEN GOTO 10650
10680 IF JJ$(10,10)<>DIM(10) THEN PO7_CNT=PO7_CNT+1,PO7_PO$=PO7_PO$+JJ$(10,10)
10690 GOTO 10650
10700 HOLD_POH$=A$(82,9)+A$(7,3)
10710 READ (Z[17],KEY=HOLD_POH$,DOM=*NEXT)POH$
10720 POH_KEY$=KEY(Z[17],END=10750); READ (Z[17],KEY=POH_KEY$)POH$
10730 IF POH_KEY$(1,LEN(HOLD_POH$))<>HOLD_POH$ THEN GOTO 10750
10740 POH_CNT=1
10750 IF PO7_CNT=0 AND POH_CNT=0 THEN GOTO *RETURN
10760 IF R0$="r" THEN IF PO7_CNT>0 THEN GOTO 10810 ELSE GOTO *RETURN
10765 IF FRM_PO2MAR THEN IF POH_CNT AND J$(1,23)=PO7_FIND$ THEN GOTO *RETURN ! SSP 241034
10770 IF POH_CNT AND POS(R1$(1,10)=PO7_PO$,10)=0 THEN GOTO 10800
10790 GOTO *RETURN
10800 MSGBOX MSG("POGMAB_L1"),MSG("FYI"),"!"; GOTO 10830; REM "WO105690,SSP117282,SSP117663
10810 MSGBOX MSG("POGMAB_L2"),MSG("FYI"),"!" ! WO105690,SSP117282,SSP117663
10830 LOT_INV=1
10840 A6$=A1$
10890 RETURN 
11000 PERMIT_DELETE:! SSP229416 jdf
11001 DELETE_HIDE=0 ! SSP229416 jdf
11002 DIM PO2[27] ! SSP229416 jdf
11003 PER_KEY$=A1$(1,9) ! SSP229416 jdf
11004 IF PER_KEY$(9,1)<>" " THEN GOTO 11090 ! SSP229416 jdf
11030 READ (Z[1],KEY=PER_KEY$,DOM=*NEXT) ! SSP229416 jdf
11040 PER_Q1$=KEY(Z[1],END=11090) ! SSP229416 jdf
11050 IF PER_KEY$<>PER_Q1$(1,9) THEN GOTO 11090 ! SSP229416 jdf
11060 READ (Z[1],KEY=PER_Q1$)IOL=0430 ! SSP229416 jdf
11065 IF PO2[6]<>0 THEN DELETE_HIDE=1 ! SSP229416 jdf
11070 IF PO2[7]<>0 THEN DELETE_HIDE=1 ! SSP229416 jdf
11080 GOTO 11040 ! SSP229416 jdf
11150 RETURN ! SSP229416 jdf
56000 REM "197204-Program Exception 047,PO2MAR-8002                           
56001 REM "197831-[helpdesk #37651]  Possible update issue?                   
56002 REM "202849-Ref 198988 - After PO is received, going back into chui and
56003 REM "203803-PO/P1 orders closing if received in full 
56004 REM "229416-Is there a way to restrict users from deleting POs after    
56005 REM "211614-It seems that lots aren't getting setup in PO receiving     
56006 REM "239950-P/O Receiving-Multiple Vendor bill and Receivings in batch  
56008 REM "241034-Trying to PO receive a stock PO and trying to correct a line
56009 REM "242707-Cannot delete a PO Lot record after receiving has been      
56010 REM "262306-PO Receiving prompt to reprint PL should only do one line at
56011 REM "273055-Expand IC2 for 6 additional cost breaks, allow entry in GUI 
