0010 REM "Format Driven Purchase Order Printing <PO2PAB>
0035 REM "5.5 - 03/05/07 - 13.711666 - mhe - SSP# 205703
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0080 REM 
0085 IF J9=-99 THEN J9=0; GOTO 0650
0090 BEGIN ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="PO2PAB",X1$="Purchase Order Printing"
0120 DIM A$(0),B$(82),B[27],C$(297),L$(20),L[1],H$(169),H0$(169),D6$(116),B0$(204),B0[21],Z8$(20)
0140 M0$="######.00-",M1$="#####,###.00-",M2$="##,###,##0-",M3$="###,##0-",M4$="-00000000.00",M4=LEN(M4$),M6$="###.0-",M5$=M0$(1,LEN(M0$)-1)+"#"
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0180 DEF FNS$(Z9$)=Z9$(1,POS(Z8$=Z9$+Z8$)-1)
0185 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
0190 DEF FNT$(Z9$)=Z9$(1,POS(Z8$=Z9$+Z8$))
0210 T=1,T0=1,T1=1
0220 W3=120
0230 DIM T3$(50,"*"),Y5$(131),Y6$(131),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0300 REM "I/O lists
0305 REM "IOLIST FOR PO1 - Purchase order header
0310 IOLIST A$(1)
0315 REM "IOLIST FOR PO2 - Purchase order lines
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21],B[22],B[23],B[24],B[25],B[26],B[27]
0325 REM "IOLIST FOR FS1 - Sales order Header
0330 IOLIST C$
0335 REM "IOLIST FOR AR1 - Customer Masterfile
0340 IOLIST D$
0345 REM "IOLIST FOR FM0 - Location Masterfile
0350 IOLIST E$,E[0],E[1]
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14],F[15],F[16],F[17]
0365 REM "IOLISTS FOR FMP - Codes - G2$=Vendor master
0370 IOLIST G$
0371 IOLIST G0$
0372 IOLIST G1$
0373 IOLIST G2$
0375 REM "IOLISTS FOR AR3 - Salesperson
0380 IOLIST H$
0382 IOLIST H0$
0383 IOLIST H1$
0385 REM "IOLIST FOR FMS - Item Specification II
0390 IOLIST I$
0395 REM "IOLIST FOR FMU - Ply ( line detail )
0400 IOLIST J$(1)
0405 REM "IOLIST FOR FMV - Item spec comments
0410 IOLIST K$
0420 IOLIST L$,L[0],L[1]
0425 REM "IOLIST FOR FSH - O/P Division Information
0430 IOLIST D6$
0440 IOLIST I6$
0445 REM "IOLIST FOR FS2
0450 IOLIST B0$,B0[0],B0[1],B0[2],B0[3],B0[4],B0[5],B0[6],B0[7],B0[8],B0[9],B0[10],B0[11],B0[12],B0[13],B0[14],B0[15],B0[16],B0[17],B0[18],B0[19],B0[20],B0[21]
0455 REM "IOLIST FOR AR4
0460 IOLIST C0$,C0[0],C0[1],C0[2],C0[3],C0[4],C0[5],C0[6],C0[7],C0[8],C0[9],C0[10],C0[11],C0[12],C0[13],C0[14],C0[15]
0490 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0495 IOLIST X$(1),X[0],X[1],X[2],X[3],X[4],X[5],X[6],X[7],X[8],X[9],X[10],X[11],X[12],X[13],X[14],X[15],X[16],X[17],X[18],X[19],X[20],X[21],X[22],X[23],X[24],X[25],X[26],X[27],X[28],X[29],X[30],X[31],X[32],X[33],X[34],X[35],X[36],X[37],X[38],X[39],X[40]
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01X PO6...  02O PO1...  03O PO2...  04O IC2...  05O IC0...  06O PO3...  07O FM0...  08O FMP...  09O AR4...  10O FS2...  11O POE...  13O ZZPARM  14O FM0...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0535 B9=0; CALL "BC2VER",ERR=0536,"","",""; B9=1; REM "B9=1 means use Barcode module
0540 IF B9=1 THEN GOTO 0550 ELSE FIND (Z[13],DOM=0541,KEY="FORMATPO"+V0$(60,1)); GOTO 0550
0545 CALL "ZZPROM",".4",X3$,0,"Invalid Flexible Format Code: "+V0$(60,1),"","",0; GOTO 9900
0550 FIND (Z[13],KEY=X3$(9,3)+"F/M")P9$
0560 FIND (Z[13],KEY=X3$(9,3)+"A/R")P8$
0570 FIND (Z[13],KEY=X3$(9,3)+"AR1")P4$
0575 FIND (Z[13],KEY="CMP"+X3$(9,3))N1$
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0600 REM "READ IN FORMATTING, SET W3 ETC.
0610 DIM X9[147],Y9[147],X9$(147),Y8[3],Y8$(35)
0615 IF B9=1 THEN DIM D9$(11); D9$(1)="850",D9$(11,1)=V0$(60,1); CALL "BC2FMZ",X3$,X4$,D9$,A0$,A0{ALL},X9{ALL},X9$,Q1$,Q{ALL},C0; IF C0=0 THEN Y8[0]=A0[0],Y8[1]=A0[2],Y8[2]=A0[4],Y8[3]=A0[5],Y9[32]=A0[6]; GOTO 0625 ELSE B9=0; GOTO 0540
0620 RUN "PO2PAX"
0650 REM "RETURN FROM PO2PAX
0655 W3=Y8[1]
0660 DIM Y5$(W3),Y6$(W3)
0700 REM "Open Printer
0730 CALL "ZZDAPP",X3$,"DZZFLESZZENTRZZCOMP"
0735 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0736,9920
0740 W0=60
0745 IF W6$="" THEN X$=FID(W9); CALL "EF2PRM",ERR=0746,X3$,X4$,X$,P6$,F6$; IF P6$(144,2)="JF" THEN JETFORM_MODE=1,JETFORM_DEV=W9
0750 GOSUB 8100
0755 IF W6$<>"" THEN Y$="12O "+W6$+" "; CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1; W6=Z[12]; X$=FN%FID$(Z[12]); CALL "EF2PRM",ERR=0756,X3$,X4$,X$,P6$,F6$ ! [205703]-changed FID() to FN%FID$()                   
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[2]; U=10,U0=2,U[0]=0,U[1]=1,U[2]=9,T0=0,U0$="    ",T5$="                "; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 U1=Z[1]
0920 V2$=V2$(1,20)
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
0995 IF Q5=0 THEN GOSUB 6000
1000 REM "Read next record
1005 U$=KEY(U1,END=5000); READ (U1)
1006 IF U$(1,1)<>"P" THEN GOTO 5000
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])<V2$(U3,U[U9]) THEN READ (U1,END=5000); EXITTO 1000
1030 IF U$(U2,U[U9])>V2$(U3+U[U9],U[U9]) THEN IF U=1 THEN EXITTO 5000 ELSE READ (U1,END=5000); EXITTO 1000
1040 NEXT U9
1100 REM "Get record"
1110 U9$=U$
1120 ON V0 GOTO 1150,1150,1130,1140
1150 DIM A$(383); READ (Z[2],KEY=U$(2,9),DOM=1000)IOL=0310
1154 REM "Selecitve printing by P/O code?
1155 IF P9$(185,1)="Y" AND POS(" "<>V0$(72,10))>0 THEN IF A$(305,1)=" " AND POS("!"=V0$(72,10))=0 THEN GOTO 1000 ELSE IF POS(A$(305,1)=V0$(72,10)+" ")=0 THEN GOTO 1000
1165 IF Q5=1 THEN CALL "ZZDISP","A",A$(297,9),"P/O",X3$,"","",34,21,X4$; IF A$(189,1)<>"P" THEN GOTO 1000 ELSE REMOVE (Z[1],KEY=U$,DOM=1000); GOSUB 7900; GOSUB 7550; GOTO 1000
1300 REM "Read other data
1305 P0=1
1310 Y$="04C IC2...  05C IC0...  06C PO3...  07C FM0...  09C AR4...  10C FS2...  11C POE...  04O FS1...  05O AR1...  06O AP2...  07O AP4...  09O AR3...  10O FSH...  11O FSV...  "
1315 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
1320 DIM C$(200); FIND (Z[4],KEY=A$(306,8),DOM=1321)IOL=0330
1323 IF D6$(1,2)<>A$(297,2) THEN DIM D6$(116); FIND (Z[10],KEY=A$(297,2),DOM=1324)IOL=0430
1335 DIM D$(225); FIND (Z[5],KEY=A$(179,10),DOM=1336)IOL=0340; IF X9[137]>0 AND POS(" "<>D$(46,10))>0 THEN FIND (Z[5],KEY=D$(46,10),DOM=1336)IOL=0340
1338 IF P4$(64,1)<>"Y" OR P8$(109,1)<>"Y" THEN GOTO 1340 ELSE FIND (Z[11],KEY=A$(306,8),DOM=1339)X$; D$(56,87)=X$(54,87)
1340 IF A$(173,1)="S" THEN C$(89,8)=A$(347,4)+A$(343,4),C$(28,15)=A$(328,15)
1350 DIM H$(169); FIND (Z[9],KEY=C$(89,4),DOM=1351)IOL=0380
1355 DIM H0$(169); FIND (Z[9],KEY=C$(93,4),DOM=1356)IOL=0382
1360 DIM G2$(308); FIND (Z[7],KEY=A$(7,10),DOM=1361)IOL=0373
1365 DIM H1$(52); FIND (Z[6],KEY=A$(210,2),DOM=1366)IOL=0383
1370 Y$="04C FS1...  05C AR1...  06C AP2...  07C AP4...  09C AR3...  10C FSH...  11C FSV...  04O IC2...  05O IC0...  06O PO3...  07O FM0...  09O AR4...  10O FS2...  11O POE...  "
1375 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
1380 GOSUB 7500
1500 REM "Print Data
1515 P1=1,P2=1
1520 IF P1>P0 THEN GOTO 1700
1530 GOSUB 5400
1540 GOSUB 5500
1560 GOSUB 2000
1580 P1=P1+1
1590 GOTO 1520
1800 REM "fix printed flag
1810 A$(189,1)="P"
1820 WRITE (Z[2],KEY=U$(2,9))IOL=0310
1900 REM "Accumulate Totals"
1990 T[T0,0]=T[T0,0]+1
1995 GOTO 1000
2000 REM "Print a P/O
2005 S0$="",S2$=""; GOSUB SET_JOB_MODIFIER
2006 IF JETFORM_MODE AND (P1=1 OR J8=1) THEN CALL "EF2JET",X3$,X4$,P6$,"N",JETFORM_DEV,JOB_MODIFIER$,RET$; REM "If in jetform mode and this is the first page for this po start a new file.
2007 IF B9=1 THEN F5=0,F5$=""; GOSUB 8300; REM "To print headings and messages for this item
2010 GOSUB 2100
2020 GOSUB 2150
2030 GOSUB 2200
2040 GOSUB 2350
2050 GOSUB 2400
2055 IF P7$<>"" THEN F5=24,F5$=STR(B7:M0$); GOSUB 8300; F5=97,F5$=STR(B5:M0$); GOSUB 8300; F5=99,F5$=STR(B6:M0$); GOSUB 8300; F5=132,F5$=STR(B8:"###"+M2$); GOSUB 8300
2060 IF A$(173,1)<>"S" AND P7$<>"" THEN F5=125,F5$=STR(B5-B7:M0$(2)); GOSUB 8300; F5=127,F5$=STR(B5-B7-B6:M0$(2)); GOSUB 8300; IF B5<>0 THEN F5=126,F5$=STR((B5-B7)*100/B5:M6$); GOSUB 8300; F5=128,F5$=STR((B5-B7-B6)*100/B5:M6$); GOSUB 8300
2070 IF POS("X"<>A$(297,9))=0 THEN RETURN ELSE IF C1>1 THEN GOSUB 5700; GOSUB 4500 ELSE IF S0$<>"" THEN GOSUB 4000
2075 IF P1=1 THEN GOSUB 4700
2080 GOSUB 8800
2081 IF P0>1 AND P1=1 THEN GOSUB 8850
2085 GOSUB 2900
2090 RETURN 
2100 REM "Print very top
2105 DIM P$(Y8[0]*W3)
2117 F5=104,F5$=D6$(11,35); GOSUB 8300
2119 IF X9[104]<>0 THEN IF JETFORM_MODE THEN F5=104,F5$=D6$(46,35); GOSUB JETFORM_PRINT; F5$=D6$(81,35); GOSUB JETFORM_PRINT ELSE P$((Y9[104]+1)*W3+X9[104],35)=D6$(46,35),P$((Y9[104]+2)*W3+X9[104],35)=D6$(81,35)
2120 CALL "ZZDISP","AX",A$(297,9),"P/O",X3$,X$,"",0,0,X4$; P5$=X$
2122 F5=5,F5$=X$; GOSUB 8300
2125 IF POS(" "<>C$(55,6))<>0 THEN F5=6,F5$=FND$(C$(55,6)); GOSUB 8300
2130 F5=122,F5$=C$(129,20); GOSUB 8300
2140 RETURN 
2150 REM "Order header info
2154 GOSUB 7600
2155 IF POS(" "<>A$(192,6))<>0 THEN F5=7,F5$=FND$(A$(192,6)); GOSUB 8300
2156 F5=143,F5$=FNS$(H1$(3,30)); GOSUB 8300
2157 F5=8,F5$=A$(212,12); GOSUB 8300; F5=117,F5$=A$(314,12); GOSUB 8300; F5=118,F5$=STR(NUM(A$(326,2)):"##"); GOSUB 8300
2158 IF POS(" "<>A$(224,6))<>0 THEN F5=9,F5$=FND$(A$(224,6)); GOSUB 8300
2159 CALL "ZZDISP","AX",A$(7,10),"A/P",X3$,X$,"",0,0,X4$
2160 F5=10,F5$=A$(230,12); GOSUB 8300
2161 F5=114,F5$="Vendor Code"; GOSUB 8300; F5=11,F5$=X$; GOSUB 8300
2162 IF POS(" "<>G$(3,15))>0 THEN F5=111,F5$="F.O.B.:"; GOSUB 8300; F5=12,F5$=G$(3,15); GOSUB 8300
2165 F5=13,F5$=G0$(3,15); GOSUB 8300
2166 IF POS(" "<>E$(135,15))>0 THEN F5=112,F5$="INSIDE DELIVERY:"; GOSUB 8300; F5=14,F5$=E$(135,15); GOSUB 8300
2167 F5=110,X$=FND$(A$(242,6)); IF POS(" "<>A$(244,2)+X$(9,2))>0 THEN F5$=A$(244,2)+X3$(59,1)+X$(9,2); GOSUB 8300
2170 F5=15,F5$=G1$(3,15); GOSUB 8300
2171 F5=16,F5$=E$(151,15); GOSUB 8300
2175 F5=115,F5$=FND$(A$(204,6)); GOSUB 8300
2180 F5=103,F5$=E$(175,35); GOSUB 8300
2185 IF A$(1,1)<>" " THEN F5=147,F5$="*REPRINT* ("+A$(1,1)+")"; GOSUB 8300
2190 RETURN 
2200 REM "Shipto, Soldto, Vender addresses
2205 GOSUB 7750
2210 IF C1=1 THEN GOSUB 2300; GOTO 2230
2211 IF LEN(E$)<259 THEN GOSUB 5600 ELSE E0$=E$(225,35)
2215 IF X9[3]=0 THEN GOTO 2230 ELSE I0=Y9[3]*W3+X9[3],X7$=E0$(1,35)+E$(16,117)
2220 GOSUB 5650; F5=3; GOSUB 7700
2230 F5=4,F5$=C$(28,15); GOSUB 8300
2235 IF POS(" "<>D$(205,12))>0 THEN CALL "ZZDISP","PX",D$(205,14),"",X3$,F5$,"",0,0,X4$; F5=135; GOSUB 8300
2240 IF POS(" "<>D$(143,12))>0 THEN CALL "ZZDISP","POX",D$(143,12),"",X3$,F5$,"",0,0,X4$; F5=136; GOSUB 8300
2250 IF X9[1]=0 THEN GOTO 2270 ELSE I0=Y9[1]*W3+X9[1],X7$=D$(11,35)+Y6$(1,30)+D$(56,87)
2260 F5=1; GOSUB 7700
2270 IF X9[2]=0 THEN GOTO 2281 ELSE I0=Y9[2]*W3+X9[2],X7$=A$(21,152)
2280 F5=2; GOSUB 7700
2282 X7$=""; IF POS(" "<>A$(17,4))>0 THEN FIND (Z[7],KEY="P"+A$(7,14),DOM=2283)X7$
2284 IF X7$>"" THEN F5$=X7$(200,14) ELSE F5$=G2$(195,14)
2285 IF POS(" "<>F5$)>0 THEN X$=F5$; CALL "ZZDISP","POX",X$,"",X3$,F5$,"",0,0,X4$; F5=138; GOSUB 8300
2286 IF X7$>"" THEN F5$=X7$(138,12) ELSE F5$=G2$(133,12)
2287 IF POS(" "<>F5$)>0 THEN X$=F5$; CALL "ZZDISP","POX",X$,"",X3$,F5$,"",0,0,X4$; F5=139; GOSUB 8300
2288 F5=140,F5$=G2$(256,15); GOSUB 8300
2290 RETURN 
2300 REM "Set up message for multiple shipto's
2305 IF Y9[3]=0 THEN GOTO 2340 ELSE F5=3,O0=0
2309 REM "If jetform mode then remove asterisks
2310 IF JETFORM_MODE=0 THEN F5$=T3$(1,30); GOSUB 8300
2315 O0=1,F5$="* Multiple ship to addresses *"; IF JETFORM_MODE THEN F5$=F5$(3,LEN(F5$)-4) END_IF ; GOSUB 8320
2320 O0=2,F5$="*   Shipping instructions    *"; IF JETFORM_MODE THEN F5$=F5$(5,LEN(F5$)-6) END_IF ; GOSUB 8320
2325 O0=3,F5$="*     on following pages     *"; IF JETFORM_MODE THEN F5$=F5$(7,LEN(F5$)-8) END_IF ; GOSUB 8320
2330 IF JETFORM_MODE=0 THEN O0=4,F5$=T3$(1,30); GOSUB 8320
2340 RETURN 
2350 REM "Print bottom line
2355 CALL "ZZDISP","AX",A$(179,10),"A/R",X3$,X$,"",0,0,X4$
2360 F5=113,F5$="Customer Code"; GOSUB 8300; F5=25,F5$=X$; GOSUB 8300
2363 X$=" "
2364 ON POS(A$(190,1)="NECSB") GOTO 2380,2365,2366,2367,2368,2369
2365 X$="New"; GOTO 2380
2366 X$="Exact repeat"; GOTO 2380
2367 X$="Copy change"; GOTO 2380
2368 X$="Spec change"; GOTO 2380
2369 X$="Copy+Spec change"; GOTO 2380
2380 F5=26,F5$=X$; GOSUB 8300
2381 F5=27,F5$=FNT$(H$(149,16)+" "); GOSUB 8300
2382 F5=28,F5$=C$(89,4); GOSUB 8300
2383 F5=29,F5$=FNT$(H0$(149,20)+" "); GOSUB 8300
2384 F5=30,F5$=C$(93,4); GOSUB 8300
2385 IF A$(191,1)="Y" THEN F5=105,F5$="*Confirming*"; GOSUB 8300
2390 RETURN 
2400 REM "Print line information
2405 I0=(Y8[2]-1)*W3,I1=0,S0$="",B1=0,B7=0,P7$="",B5=0,B6=0,B8=0
2406 IF C1>2 THEN GOTO 2450 ELSE IF C1=1 AND LEN(P2$)=13 THEN GOTO 2450
2407 IF POS("X"<>A$(297,9))=0 THEN FOR I3=1 TO Y8[3]; GOSUB 2500; NEXT I3
2410 READ (Z[3],KEY=A$(297,9),DOM=2411)
2420 READ (Z[3],END=2490)IOL=0320
2425 IF B$(82,9)<>A$(297,9) THEN GOTO 2490
2430 IF C1<>2 THEN B1=0
2432 GOSUB 7850
2434 REM "S2$ is flag to print comments only
2435 IF POS(B$(10,1)="CXI")<>0 AND S0$="" THEN IF B$(81,1)="Y" THEN S0$=B$(91,20)+"001",S8$=A$(297,8)+B$(7,3),S2$="" ELSE IF B$(81,1)="C" THEN S0$=B$(91,20),S2$="*"
2438 IF I0+F4*W3>(Y8[2]+Y8[3]-1)*W3 THEN GOSUB 4600
2439 IF P7$="" THEN P7$=B$(25,3); IF P8$(114,1)="Y" THEN CALL "AR2EBJ",X3$,X4$,1,D$(1,10),F5$; IF F5$>"" THEN F5=18; GOSUB 8350; GOSUB 2590; REM "PRINT CUSTOMER COMMENT ON 1ST LINE"
2440 GOSUB 2500
2445 GOTO 2420
2450 REM "Print lines from P2$ for spec instr."
2460 READ (Z[6],KEY=P2$(1,13),DOM=2461)IOL=0350
2465 READ (Z[3],KEY=E$(166,9)+E$(7,3),DOM=2466)IOL=0320
2466 READ (Z[3],KEY=A$(297,9)+E$(7,3),DOM=2475)IOL=0320
2470 B1=E[0]; GOSUB 8900; IF L$(20,1)="Y" THEN B1=B1/L[1] ELSE B1=B1/B[2]
2471 GOSUB 2500
2475 P2$=P2$(14)
2490 RETURN 
2500 REM "Print one line from B$, I0 is assumed to be set
2503 F4=0,P3=0
2504 REM IF B$(10,1)="I" AND I1>Y8(3)-1 THEN GOSUB 04600 ELSE IF I1>Y8(3) THEN GOSUB 04600
2505 IF B$(10,1)="M" THEN F5=18,F5$=B$(28,40); GOSUB 8350; IF B[0]<>0 THEN F5=24,F5$=STR(B[0]:M1$); GOSUB 8350; GOTO 2535 ELSE GOTO 2535
2506 IF B[2]=0 THEN B[2]=1
2507 F5=31,F5$=B$(7,3); GOSUB 8350
2508 GOSUB 8500; GOSUB 8900
2509 IF L$(21,1)="Y" OR (B$(10,1)="S" AND I$(61,1)="Y") THEN IF C1<2 THEN P3=B[4]; IF X9[129]=0 OR L$(21,1)="Y" THEN B[0]=B[4]
2510 F5=23,F5$=B$(77,4); IF X9$(F5,1)="Q" THEN F5$=FNS$(F5$)+"/"+FNR$(STR(B[2]:M3$)); GOSUB 8350 ELSE GOSUB 8350
2511 IF C1<2 THEN F5=22,F5$=STR(B[0]:M5$); GOSUB 8350
2513 IF B1=0 THEN IF L$(20,1)="Y" THEN B1=B[11]/L[1] ELSE B1=B[11]/B[2]
2515 IF B1<>0 THEN IF FPT(B1)=0 THEN F5=17,F5$=STR(B1:M2$); GOSUB 8350 ELSE F5=17,F5$=STR(B1:M0$); GOSUB 8350
2517 IF C1>=2 THEN F5=96,F5$="Shipping instructions"; GOSUB 6300; GOTO 2535 ELSE IF B$(10,1)="S" AND I$(61,1)="Y" THEN GOTO 2530
2520 IF L$(21,1)="Y" OR B[1]=0 THEN P3=B[0] ELSE IF L$(20,1)="Y" AND L[0]<>0 THEN P3=B[0]*B1/L[0] ELSE P3=B[0]*B1
2530 B7=B7+P3,B8=B8+B1; F5=129,F5$=STR(P3:M0$); GOSUB 8350
2537 H8$=B$; GOSUB 8000; F5=19,F5$=H9$; GOSUB 8350; F5=21,F5$=FNS$(B$(101,10)); GOSUB 8350; H9$=" "
2538 IF X9$(106,1)="B" AND B$(10,1)<>"I" THEN F6=106,F5$=""; GOSUB 8350
2540 IF B$(10,1)<>"I" THEN GOTO 2550
2542 FIND (Z[4],KEY=B$(91,20)+A$(7,14),DOM=2550)IOL=0440
2544 IF X9$(106,1)<>"B" AND POS(" "<>I6$(35,20))=0 THEN GOTO 2550
2546 F5=106,F5$="Your item no: "+I6$(35,20); GOSUB 8350
2550 IF C1<2 THEN GOSUB 8700; REM "Only do if NOT shipping inst.
2560 IF C1<2 AND POS(" "<>B$(68,9))>0 THEN F5=58,F5$=B$(68,9); GOSUB 8300; REM "assume only one line has a starting #"
2565 IF X9[146]<>0 THEN DIM J5[20]; CALL "IC2UTK",ERR=2566,X3$,X4$,B$(91,20),J5$,J5{ALL}; F5=146,F5$=J5$(35,10); GOSUB 8350
2590 I0=I0+F4*W3
2595 RETURN 
2900 REM "Send P$ to printer
2902 W7=-1
2904 IF P2>1 THEN F5=134,F5$="PAGE:"+STR(P2:"#0"); GOSUB 8300
2905 IF JETFORM_MODE THEN IF P0>P1 THEN CALL "EF2JET",X3$,X4$,P6$,"E",JETFORM_DEV,JOB_MODIFIER$,RET$ END_IF ; GOTO 2933; REM "If jetform mode skip printing of p$, if this is not the last page of this po, we need to eject a new item however
2906 IF B9=1 THEN DIM Q[1]; CALL "BC2FMX",X3$,X4$,P$,O$,W9,Z[13],A0$,A0{ALL},R6$,Q0$,Q{ALL},Z0; IF Z0=1 THEN GOTO 5000 ELSE GOTO 2933; REM "USe barcode module to print
2910 FOR I=0 TO INT(LEN(P$)/W3)-1
2920 Y5$=P$(I*W3+1,W3); GOSUB 7300
2930 NEXT I
2933 IF P6$="" OR (W6$<>"" AND W7=-1) THEN GOTO 2934 ELSE GOSUB 8060; CALL "EF2FAX",X3$,X4$,P6$,F6$,W9,X$,T$; REM "Setup fax #s and Tag 2s, then call fax routine |skip if no params set or if w6$ set(print both printer & elect items) and we ar doing th epiinter
2934 IF W6$<>"" THEN IF W7=-1 THEN W7=W9,W9=W6; GOTO 2905 ELSE W9=W7
2935 P2=P2+1
2940 RETURN 
4000 REM "Print bottom half of P/O
4004 Z$="05C IC0...  06C PO3...  07C FM0...  09C AR4...  10C FS2...  11C POE...  07O FM1...  09O FS2...  10O FMS...  11O FMU...  12O FMV...  "
4005 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
4006 DIM F$(386),F[17]; F[0]=X[19]; READ (Z[7],KEY=S0$(1,20),DOM=4007)IOL=0360
4008 L9$=""
4009 IF S2$="*" THEN GOSUB 4400; S0$="",S2$=""; GOTO 4080; REM "Comments only code
4010 GOSUB 4100
4015 GOSUB 4550
4018 REM "L9$ set in 4100's if a line was printed
4019 IF L9$="" THEN GOTO 4051
4020 GOSUB 4300
4030 GOSUB 4400
4040 GOSUB 4500
4050 GOSUB 8600
4060 IF S3$="*" THEN S3$="",S0$=""
4079 IF J5$=S0$ THEN S0$="",J5$="" ELSE J5$=S0$; REM "IF s0$ hasn't changed each time thru then something is wrong, so leave
4080 Y$="07C FM1...  09C FS2...  10C FMS...  11C FMU...  12C FMV...  05O IC0...  06O PO3...  07O FM0...  09O AR4...  10O FS2...  11O POE...  "
4085 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
4090 RETURN 
4100 REM "Print ply information
4104 I0=Y9[32]*W3,L1=0,L2=8,L2=L2+NUM(X9$(32,1),ERR=4105)
4105 DIM J$(134); READ (Z[11],KEY=S0$,DOM=4146)IOL=0400
4109 REM "Set S0$ to "" if we definately are done with plies
4110 IF J$(1,20)<>S0$(1,20) THEN GOTO 4146
4120 IF L2$="*" THEN L2$=""; GOSUB 8830; I0=Y9[32]*W3; REM "We need to new item before printing
4125 IF POS(" "<>J$(102,8))>0 THEN F5=43; F5$=J$(102,8); GOSUB 8300
4128 REM "Set L9$ if first line is printed
4129 IF J$(21,3)="001" THEN L9$="*"
4130 GOSUB 4150
4132 S0$=S0$(1,20)+STR(NUM(J$(21,3))+1:"000")
4134 L1=L1+1; IF L1=L2 THEN GOTO 4145
4135 GOTO 4105
4145 RETURN 
4146 IF S0$(21,3)="001" THEN L9$="*"
4147 S3$="*"; GOTO 4145
4150 REM "Print a ply
4156 F5=32,F5$=STR(NUM(J$(21,3)):"##"); GOSUB 8400
4157 F5=33,F5$=J$(24,3); GOSUB 8400
4158 F5=34,F5$=J$(27,3); GOSUB 8400
4159 F5=35,F5$=J$(30,6); GOSUB 8400
4160 IF X9[19]=0 OR J$(36,8)<>F$(24,8) THEN F5=36,F5$=J$(36,8); GOSUB 8400
4161 IF X9[19]=0 OR J$(44,8)<>F$(32,8) THEN F5=37,F5$=J$(44,8); GOSUB 8400
4162 DIM F5$(2); IF NUM(X9$(38,1),ERR=4163)>0 THEN DIM F5$(NUM(X9$(38,1))); REM "Spaces between inks override
4164 IF POS(X3$(9,3)="101302",3)<>0 THEN F5=38,F5$=J$(52,6)+" "+J$(131,1)+F5$+J$(58,6)+" "+J$(132,1)+F5$+J$(64,6)+" "+J$(133,1)+F5$+J$(70,6)+" "+J$(134,1); GOSUB 8400; GOTO 4166
4165 F5=38,F5$=J$(52,6)+F5$+J$(58,6)+F5$+J$(64,6)+F5$+J$(70,6); GOSUB 8400
4170 F5=39,F5$=J$(76,10); GOSUB 8400
4171 F5=116,F5$=J$(86,1); GOSUB 8400
4172 F5=40,F5$=J$(87,2); GOSUB 8400
4173 F5=41,F5$=J$(89,1)+" "+J$(90,1); GOSUB 8400
4174 F5=94,F5$=J$(91,8); GOSUB 8400
4175 F5=95,F5$=J$(99,3); GOSUB 8400
4176 F5=42,F5$=J$(110,20); IF X3$(9,3)="084" THEN F5$=STR(NUM(J$(21,3)):"##")+" "+F5$; GOSUB 8400 ELSE IF POS(X3$(9,3)="110",3)>0 THEN F5$=F5$(1,16); GOSUB 8400 ELSE GOSUB 8400
4178 F5=119,F5$=J$(130,1); GOSUB 8400
4185 I0=I0+W3
4190 RETURN 
4300 REM "Print comp section
4304 REM "First check to see if user def spec and no std comp screen required
4305 IF P9$(168,1)="Y" AND S0$<>"" THEN FIND (Z[8],KEY="T"+P7$,DOM=4381)X$; IF LEN(X$)>34 THEN IF X$(33,3)<>"   " AND X$(21,1)="Y" THEN GOTO 4380
4310 READ (Z[10],KEY=S0$(1,20),DOM=4370)IOL=0390
4317 IF I$(21,1)="Y" THEN F5$="Plant" ELSE F5$=I$(21,1)
4318 F5=44; GOSUB 8300
4320 REM IF A$(190,1)="E" THEN LET F5=44,F5$="          "; GOSUB 08300; LET F5=54,F5$=I$(32,1); GOSUB 08300; LET F5=55,F5$=I$(33,1); GOSUB 08300; LET F5=57,F5$=STR(NUM(I$(35,3))); GOSUB 08300; GOTO 04328
4321 F5=45,F5$=I$(22,1); GOSUB 8300; F5=46,F5$=I$(23,1); GOSUB 8300
4322 F5=47,F5$=I$(25,1); GOSUB 8300; F5=48,F5$=I$(26,1); GOSUB 8300
4323 F5=49,F5$=I$(27,1); GOSUB 8300; F5=50,F5$=I$(28,1); GOSUB 8300
4324 F5=51,F5$=I$(29,1); GOSUB 8300; F5=52,F5$=I$(30,1); GOSUB 8300
4325 F5=53,F5$=I$(31,1); GOSUB 8300; F5=54,F5$=I$(32,1); GOSUB 8300
4326 F5=55,F5$=I$(33,1); GOSUB 8300; F5=56,F5$=I$(34,1); GOSUB 8300
4327 F5=57,F5$=I$(35,3); GOSUB 8300
4330 F5=59,F5$=I$(48,5); GOSUB 8300; F5=60,F5$=I$(53,2); GOSUB 8300; F5=61,F5$=I$(55,3); GOSUB 8300
4331 F5=62,F5$=I$(58,1); GOSUB 8300; F5=63,F5$=I$(59,1); GOSUB 8300
4332 F5=64,F5$=I$(60,1); GOSUB 8300; F5=65,F5$=I$(61,1); GOSUB 8300
4333 F5=66,F5$=I$(62,1); GOSUB 8300; F5=67,F5$=I$(64,1); GOSUB 8300
4334 F5=68,F5$=I$(65,1); GOSUB 8300; F5=69,F5$=I$(66,1); GOSUB 8300
4335 F5=70,F5$=I$(67,1); GOSUB 8300; F5=145,F5$=I$(63,1); GOSUB 8300
4336 IF F[0]=0 THEN F5$="Std." ELSE F5$=FNR$(STR(F[0]:M3$))
4337 F5=71; GOSUB 8300
4341 F5=72,F5$=I$(68,1); GOSUB 8300; F5=73,F5$=I$(69,1); GOSUB 8300
4342 F5=74,F5$=I$(70,1); GOSUB 8300; F5=75,F5$=I$(71,1); GOSUB 8300
4343 F5=76,F5$=I$(72,1); GOSUB 8300; F5=77,F5$=I$(73,6); GOSUB 8300
4344 F5=78,F5$=I$(79,8); GOSUB 8300; F5=79,F5$=I$(87,1); GOSUB 8300
4345 F5=80,F5$=I$(88,5); GOSUB 8300; F5=81,F5$=I$(93,8); GOSUB 8300
4351 F5=82,F5$=I$(101,1); GOSUB 8300; F5=83,F5$=I$(102,1); GOSUB 8300
4352 F5=84,F5$=STR(NUM(I$(103,4)):"##"); GOSUB 8300; F5=85,F5$=I$(107,1); GOSUB 8300
4353 F5=86,F5$=I$(108,1); GOSUB 8300; F5=87,F5$=I$(109,1); GOSUB 8300
4354 F5=88,F5$=I$(110,3); GOSUB 8300; F5=89,F5$=I$(113,1); GOSUB 8300
4355 F5=90,F5$=I$(114,15); GOSUB 8300; F5=91,F5$=I$(129,15); GOSUB 8300
4356 F5=92,F5$=I$(144,15); GOSUB 8300
4358 F5=120,F5$=I$(38,4); GOSUB 8300; F5=121,F5$=STR(NUM(I$(42,5)):"#####"); GOSUB 8300
4370 REM "User defined specs?
4380 IF P9$(168,1)="Y" AND S0$<>"" THEN FIND (Z[8],KEY="T"+P7$,DOM=4381)X$; IF LEN(X$)>34 THEN IF X$(33,3)<>"   " THEN CALL "PO2PAC",X3$,X4$,P$,S0$,X$,W3,"",V3$,0,W9,JETFORM_MODE
4390 RETURN 
4400 REM "Print comments
4405 READ (Z[12],KEY=S0$(1,20),DOM=4406)
4406 F2=0
4407 I0=Y9[93]*W3,I9=1
4410 READ (Z[12],END=4435)IOL=0410; IF K$(1,20)<>S0$(1,20) THEN GOTO 4435
4412 IF POS(X3$(9,3)="101302",3)<>0 THEN IF I9=5 THEN I0=Y9[101]*W3+X9[101]; GOTO 4420 ELSE IF I9<35 THEN GOTO 4420 ELSE GOTO 4430
4415 IF I9=5 THEN I0=Y9[101]*W3+X9[101]; GOTO 4420 ELSE IF I9>8 THEN GOTO 4435
4420 GOSUB 4450
4430 GOTO 4410
4440 RETURN 
4450 REM "Print a comment
4455 IF K$(24,1)="N" THEN GOTO 4490
4457 I8=60; IF X9$(93,1)="A" OR POS(X3$(9,3)="101302",3)<>0 THEN I8=65
4460 IF X9[93]<>0 THEN IF JETFORM_MODE THEN IF I9<5 THEN F5=93 ELSE F5=101 END_IF ; F5$=K$(25,I8); GOSUB JETFORM_PRINT ELSE P$(I0+X9[93],I8)=K$(25,I8) END_IF ; I9=I9+1,I0=I0+W3; RETURN 
4470 REM LET Y5$(F2*60+1+SGN(F2))=K$(25,60)
4475 REM IF F2=0 THEN LET F2=1 ELSE LET F2=0; GOSUB 07300
4490 RETURN 
4500 REM "Use up rest of page
4540 RETURN 
4550 REM "Use unused ply space
4590 RETURN 
4600 REM "Continue if overflow on lines
4605 GOSUB 8850
4608 IF S0$<>"" THEN GOSUB 4000
4610 IF JETFORM_MODE THEN CALL "EF2JET",X3$,X4$,P6$,"E",JETFORM_DEV,JOB_MODIFIER$,RET$ ELSE GOSUB 2900
4640 GOSUB 4500
4650 GOSUB 2100
4655 GOSUB 2150
4660 GOSUB 2200
4665 GOSUB 2350
4670 I0=(Y8[2]-1)*W3,I1=0
4690 RETURN 
4700 REM "Print P/O comments
4702 DIM Y6$(131)
4703 GOSUB 4550; GOSUB 4370
4704 F2=0,I0=Y9[93]*W3,I9=1,I8=60
4705 READ (Z[11],KEY=A$(297,9),DOM=4706)
4710 READ (Z[11],END=4740)IOL=0410
4715 IF K$(1,9)<>A$(297,9) THEN GOTO 4740
4720 IF K$(13,1)<>"Y" THEN GOTO 4735
4722 IF I9=5 THEN I0=Y9[101]*W3+X9[101]; REM "Don't need I9 check since entry limits to 8 lines
4725 Y6$(25,65)=K$(14,65); DIM K$(90); K$=Y6$(1,90); DIM Y6$(131); GOSUB 4460
4735 GOTO 4710; REM "IF W<=NUM(V3$(15,2))-1 THEN GOTO 04710
4750 GOSUB 4500
4790 RETURN 
4800 JETFORM_PRINT:REM "For jetform mode add field nominated value with F5 as the field name and F5$ as the value
4815 PRINT (W9)"^field "+STR(F5:"000"),'LF',F5$
4845 JETFORM_PRINT_END:RETURN 
4850 SET_JOB_MODIFIER:REM "Set job_modifier$ to '' or the template code if user defined specs will be printed. job_modifier$ will be passed to EF2JET
4855 JOB_MODIFIER$=""
4859 TMP$=""
4860 READ (Z[3],KEY=A$(297,9),DOM=4861)
4861 READ (Z[3],END=4865)IOL=0320
4863 TMP$=B$(25,3)
4870 IF P9$(168,1)="Y" THEN FIND (Z[8],KEY="T"+TMP$,DOM=4871)X$; IF LEN(X$)>34 THEN IF X$(33,3)<>"   " THEN JOB_MODIFIER$=X$(33,3)
4895 SET_JOB_MODIFIER_END:RETURN 
5000 REM "End of Print
5010 IF Q5=1 THEN GOTO 9920
5020 IF W8=0 THEN GOTO 5200
5200 REM "
5270 Y$="09C AR3...  10C FMS...  11C FMU...  "
5280 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
5291 GOTO 9900
5300 REM "Remove printed P/O's
5305 IF V8$="A" THEN GOTO 5330
5310 CALL "ZZPROM",".Y",X3$,Z,"Did all of the purchase orders print correctly?","","",0
5320 ON Z GOTO 5330,5340
5330 GOSUB 5350; GOTO 5345
5345 RETURN 
5350 REM "Do remove
5352 IF P9$(189,1)="Y" THEN Y$="09CU   09O FMS... 11C POE...  11O FM1... "; CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
5354 PRINT @(0,19),'CE',
5355 CALL "ZZPROM","X0PO2PAA",X3$,Z,"","","",19
5360 Q5=1; GOTO 0990
5390 RETURN 
5400 REM "Set code C1 for type of P/O
5405 REM "0=1 of 1 p/o, 1=cover p/o for multiple p/os, 2=general inst, 3=print special instr. from current po3 record
5410 IF P0=1 THEN C1=0; GOTO 5445
5414 REM "P0 is > 1
5415 ON P1 GOTO 5445,5420,5430,5440
5420 C1=1; GOTO 5445
5440 C1=3
5445 RETURN 
5500 REM "Get proper address, C1=1 taken care of in 2300's
5505 DIM E$(260)
5510 ON C1 GOTO 5515,5590,5520,5550
5515 IF LEN(P2$)=13 THEN GOTO 5550; REM "Only one P/O, but it is special ship
5520 READ (Z[6],KEY=A$(297,9)+"    ",DOM=5530)IOL=0350; GOTO 5590
5530 READ (Z[6],KEY=A$(297,8)+"     ",DOM=5540)IOL=0350; GOTO 5590
5535 REM "If no general inst., use customer address
5540 E$(16,30)=D$(165,20),E$(46,87)=D$(56,87); GOTO 5590
5550 REM "Read in special shipping record
5560 READ (Z[6],KEY=P2$(1,13),DOM=5580)IOL=0350
5570 GOTO 5590
5580 REM "Error"
5585 EXITTO 1580
5590 RETURN 
5600 REM "Get name to print on shipto
5610 E0$=D$(11,35)
5615 ON POS(E$(11,1)="CPD") GOTO 5645,5620,5625,5630
5620 FIND (Z[7],KEY=E$(11,1)+D$(1,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5625 FIND (Z[7],KEY=E$(11,1)+A$(7,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5630 FIND (Z[7],KEY=E$(11,1)+Y6$(1,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5635 E0$=E1$(16,35)
5645 RETURN 
5650 REM "GET EXTENDED SHIPPING ADDRESS
5655 DIM SHIP_TO$(0); IF P9$(244,1)<>"Y" THEN GOTO 5690 ELSE IF J8=1 THEN DIM SHIP_TO$(120,"X"); GOTO 5690
5660 READ (Z[14],KEY="C"+D$(1,10)+E$(12,4),DOM=5661)SHIP_TO$
5690 RETURN 
5700 REM "Print shipping inst. message
5715 IF C1<2 THEN GOTO 5740
5719 GOSUB 8200
5720 F5=133,F5$="Shipping instructions for P/O number: "+P5$; GOSUB 8300
5735 IF D2$<>"" THEN GOSUB 8150
5740 RETURN 
5800 REM "Print extended shipping lines
5810 FOR I=0 TO 3
5820 IF POS(" "<>SHIP_TO$(402+I*30,30))>0 THEN IF JETFORM_MODE THEN F5$=SHIP_TO$(402+I*30,30); GOSUB JETFORM_PRINT ELSE P$(I0,30)=SHIP_TO$(402+I*30,30); I0=I0+W3
5830 NEXT I
5835 SHIP_TO$=""
5840 RETURN 
6000 REM "Print alignment pattern?
6005 IF V8$="A" THEN GOTO 6090
6010 IF V3$(2,2)="A " THEN PRINT 'EA',
6012 J8=0; REM "Set flag
6015 CALL "ZZPROM","R4",X3$,Z,"","","",X0
6017 IF Z<2 AND V3$(2,2)="A " THEN PRINT 'BA',
6020 ON Z GOTO 6090,6021,9900
6025 J8=1; REM "Flag - we're doing an alignment pattern
6030 GOSUB 6100
6040 GOSUB 6200
6050 GOTO 6010
6090 RETURN 
6100 REM "Setup test data"
6105 X$="X",X5$="I6XXXX"
6110 DIM A$(383,X$),B$(118,X$),B[27],C$(200,X$),D$(200,X$),E$(225,X$),F$(386,X$),F[17],G$(20,X$),G0$(20,X$),G1$(20,X$),H$(200,X$),H0$(200,X$),I$(159,X$),J$(134,X$),K$(90,X$),G2$(300,X$),H1$(40,X$)
6120 A$(204,6)=X5$,A$(192,6)=X5$,C$(16,6)=X5$,A$(224,6)=X5$,J$(21,3)="000",A$(242,6)=X5$,A$(291,6)=X5$,C$(55,6)=X5$,I$(103,4)="0999",A$(326,2)="99",I$(42,5)="99999",A$(190,1)="E"
6125 I$(68,5)="YYYYY"
6130 DIM H1$(40,"X")
6190 RETURN 
6200 REM " Print align. pattern
6210 S0$=""
6220 GOSUB 2000
6225 I0=Y9[32]*W3,I9=1
6230 FOR I2=1 TO 8; GOSUB 4150; NEXT I2
6240 GOSUB 4550
6245 GOSUB 8600
6250 GOSUB 4320
6255 I0=Y9[93]*W3,I9=5
6260 FOR I2=1 TO 4; GOSUB 4450; NEXT I2
6265 I0=X9[101]+Y9[101]*W3
6266 FOR I2=1 TO 4; GOSUB 4450; NEXT I2
6270 GOSUB 4500
6275 GOSUB 2900
6290 RETURN 
6300 REM 
6310 IF X9$(F5,1)="X" THEN GOTO 6340
6320 GOSUB 8350
6340 RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7330 PRINT (W9)STP(Y5$,1); DIM Y5$(W3)
7395 RETURN 
7400 REM "Read report selection parameters"
7405 CLOSE (14); OPEN (14)"ZZP"
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (14,KEY=X3$(1,8),DOM=7451)IOL=0490
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"  ")-1)
7482 IF V1$(1,3)="???" THEN V8$="A",V7$=V1$(4,2); IF V0$(71,1)="1" THEN V1$="PO6   "
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7486 CLOSE (14)
7488 IF POS(">"=V0$(59,12))=0 THEN W6$="" ELSE W6$=V0$(59,12),W6$=W6$(POS(">"=W6$)+1,2)
7490 RETURN 
7500 REM "Run through special shipping and calculate # of PO's needed (P0)
7504 DIM E[3]
7505 P0=0,P2$="",P3$="",P10$=""; GOSUB 7800; IF A$(173,1)="C" THEN P0$=A$(306,8)+" " ELSE P0$=A$(297,9)
7510 READ (Z[6],KEY=P0$,DOM=7511)
7520 K$=KEY(Z[6],END=7540); IF K$(1,9)<>P0$ THEN GOTO 7540
7522 IF K$(10,4)="    " THEN READ (Z[6]); GOTO 7520; REM "Skip general instructions
7525 READ (Z[6])IOL=0350
7529 IF POS(E$(7,3)=P3$,3)=0 THEN GOTO 7535
7530 P0=P0+1,P2$=P2$+K$
7535 GOTO 7520
7538 REM "If p0=0 p0=1 for general p/o elseif p0>1 then p0=p0+1 for cover p/o on special shipping
7539 REM "If p0=1 then only one special ship address,see logic to print special ship instead of general
7540 IF POS(A$(351,1)="BS")>0 THEN IF LEN(P10$)=5 THEN P0=1,P2$=P2$(1,13)
7542 IF P0<>1 THEN P0=P0+1
7545 RETURN 
7550 REM "increment reprint flag
7560 EXTRACT (Z[2],KEY=U$(2,9))IOL=0310
7570 A$(1,1)=STR(NUM(A$(1,1))+1:"0")
7580 WRITE (Z[2])IOL=0310
7590 RETURN 
7600 REM "Set shipping stuff based on shipping record
7610 DIM G$(20); READ (Z[8],KEY="F"+E$(133,1),DOM=7611)IOL=0370
7620 DIM G0$(20); READ (Z[8],KEY="H"+E$(134,1),DOM=7621)IOL=0371
7630 REM DIM G1$(20); READ (Z(8),KEY="S"+E$(150,1),DOM=7631) IOL=0372
7635 DIM G1$(20); G1$(3,15)=E$(210,15)
7645 RETURN 
7650 REM "Fix city, state, zip in X5$ into X6$
7655 REM IF X5$(17,2)="  " THEN GOTO 07690
7660 X6$=FNS$(X5$(1,16))+", "+X5$(17,2)+"  "
7670 CALL "ZZDISP","AX",X5$(19,9),"ZIP",X3$,X$,"",0,0,X4$
7680 X6$=X6$+X$
7690 RETURN 
7700 REM "Take name(35),attn(30),address(87) in X7$ & put into P$ at I0
7710 IF JETFORM_MODE THEN F5$=X7$(1,35); GOSUB JETFORM_PRINT ELSE P$(I0,35)=X7$(1,35); I0=I0+W3 END_IF ; X6$=" "
7712 IF SHIP_TO$>"" THEN GOSUB 5800
7715 IF POS(" "<>X7$(36,30))<>0 THEN IF JETFORM_MODE THEN F5$=X7$(36,30); GOSUB JETFORM_PRINT ELSE P$(I0,30)=X7$(36,30); I0=I0+W3
7720 IF JETFORM_MODE THEN F5$=X7$(66,30); GOSUB JETFORM_PRINT ELSE P$(I0,30)=X7$(66,30); I0=I0+W3
7725 IF POS(" "<>X7$(96,30))<>0 THEN IF JETFORM_MODE THEN F5$=X7$(96,30); GOSUB JETFORM_PRINT ELSE P$(I0,30)=X7$(96,30); I0=I0+W3
7730 X5$=X7$(126); GOSUB 7650; IF JETFORM_MODE THEN F5$=X6$; GOSUB JETFORM_PRINT ELSE P$(I0,LEN(X6$))=X6$
7740 RETURN 
7750 REM "Company Name & optional address
7760 F5=144,O0=0,F5$=FNS$(N1$(7,38)); GOSUB 8300
7765 IF X9$(144,1)<>"A" THEN GOTO 7790
7770 FOR X=0 TO 2; F5$=FNS$(N1$(47+X*40,40)); IF F5$>"" THEN F5=144,O0=O0+1; GOSUB 8320
7775 NEXT X
7780 IF POS(" "<>N1$(167,14))>0 THEN CALL "ZZDISP","PX",N1$(167,14),"",X3$,F5$,"",0,0,X4$; F5=144,O0=O0+1; GOSUB 8320
7790 RETURN 
7800 REM "Put valid p/o lines in P3$
7805 READ (Z[3],KEY=A$(297,9),DOM=7806)
7810 READ (Z[3],END=7825)IOL=0320
7815 IF B$(82,9)<>A$(297,9) THEN GOTO 7825
7820 P3$=P3$+B$(7,3); GOTO 7810
7825 REM "If B/S type see if all lines have same s/s ship-to
7830 IF POS(A$(351,1)="BS")=0 OR LEN(P3$)<3 THEN GOTO 7845 ELSE INDEX=1; READ (Z[6],KEY=A$(306,8)+" "+P3$(1,3),DOM=7835)
7835 K$=KEY(Z[6],END=7845); READ (Z[6])IOL=0350; IF K$(1,12)<>A$(306,8)+" "+P3$(INDEX,3) THEN GOTO 7845 ELSE INDEX=INDEX+3; IF POS(E$(11,5)=P10$,5)=0 THEN P10$=P10$+E$(11,5)
7840 GOTO 7835
7845 RETURN 
7850 REM "Check if ext only
7854 DIM I$(61)
7855 IF B$(10,1)<>"S" THEN GOTO 7890
7860 READ (Z[8],KEY="X"+B$(101,10),DOM=7890)I$
7890 RETURN 
7900 REM "Change Art Status
7905 IF P9$(189,1)<>"Y" THEN RETURN 
7910 READ (Z[3],KEY=U$(2),DOM=7911)
7913 READ (Z[3],END=7990)IOL=0330
7914 IF C$(82,9)<>U$(2,9) THEN GOTO 7990
7915 READ (Z[9],KEY=C$(91,20),DOM=7980)Q$; IF POS("Y"=Q$(28,3))=0 THEN GOTO 7980
7920 EXTRACT RECORD (Z[11],KEY=C$(91,20),DOM=7980)Q$
7925 Q$(231,1)="P",Q$(232,6)=X3$(21,6)
7930 WRITE RECORD (Z[11],KEY=C$(91,20))Q$; IF RT_PARM$<>"" THEN CUST$=C$(91,20); CALL "RT2WOC",ERR=7931,X3$,X4$,CUST$,"FM1...","U",C$(91,20)
7945 RETURN 
7990 RETURN 
8000 REM "Build desc from H8$
8010 H9$=FNT$(H8$(17,8)+" "); IF H9$<>"" AND H9$<>" " THEN H9$=H9$+QUO; IF POS(" "<>H8$(111,8))<>0 THEN H9$=H9$+"x"
8020 H9$=H9$+FNS$(H8$(111,8)); IF H9$<>"" THEN IF POS(" "<>H8$(111,8))<>0 THEN H9$=H9$+QUO+" " ELSE H9$=H9$+" "
8030 IF NUM(H8$(15,2),ERR=8031)<>0 THEN H9$=H9$+H8$(15,2)+" Ply "
8050 RETURN 
8060 REM "Setup Fax String
8065 DIM X$(5*51)
8069 CALL "ZZDISP","AX",A$(179,10),"A/R",X3$,T$,"",0,0,X4$
8070 X$(1)="C"+D$(143,12),X$(27)="C:"+T$; REM "Customer
8074 CALL "ZZDISP","AX",A$(7,10),"A/P",X3$,T$,"",0,0,X4$
8075 X$(52)="V"+G2$(133,12),X$(78)="V:"+T$; REM "Vendor
8077 IF LEN(X7$)<150 THEN DIM J0$(200); J0$(1)="P"+A$(7,10),J0$(138,12)=G2$(133,12) ELSE J0$=X7$
8078 CALL "ZZDISP","AX",J0$(2,10),"A/P",X3$,T$,"",0,0,X4$
8079 X$(103)="P"+J0$(138,12); IF POS(" "<>J0$(12,4))=0 THEN X$(129)="P:"+T$ ELSE X$(129)="P:"+T$+"-"+J0$(12,4); REM "Plant
8080 IF LEN(E1$)<150 THEN DIM J0$(200); J0$(1)="C"+A$(179,10),J0$(138,12)=D$(143,12) ELSE J0$=E1$
8081 IF J0$(1,1)="D" THEN X$="Whse" ELSE IF J0$(1,1)="C" THEN CALL "ZZDISP","AX",J0$(2,10),"A/R",X3$,T$,"",0,0,X4$ ELSE CALL "ZZDISP","AX",J0$(2,10),"A/P",X3$,T$,"",0,0,X4$
8082 X$(154)="T"+J0$(138,12); IF POS(" "<>J0$(12,4))=0 THEN X$(180)="T:"+T$ ELSE X$(180)="T:"+T$+"-"+J0$(12,4); REM "Ship to
8083 X$(205)="S"+H0$(127,12); X$(231,25)="S:"+A$(343,4)+"-"+H0$(5,30); REM "Salesperson
8090 IF J8=1 THEN FOR J7=0 TO 4; X$(2+J7*51,25)=P6$(150,12); NEXT J7; REM "If alignment pattern, replace with align pat from parameters
8093 CALL "ZZDISP","AX",A$(297,9),"P/O",X3$,T$,"",0,0,X4$; T$="850:"+T$; REM "Tag 1 for fax
8095 RETURN 
8100 REM "Set D1$=normal, D2$=double high printing
8101 REM "Assumes special mode 5 is double & special mode six is un-double
8105 REM "This program assumes that double high is on until turned off, changes will be needed if double high goes off auto. at end of a line see lines 740 & 9905
8110 D1$="",D2$=""
8111 RETURN 
8114 CLOSE (14); OPEN (14)"ZZPARM"
8115 READ (14,KEY="PRINTERS",DOM=8145)D1$,D2$
8120 P=POS(FID(W9)=D2$,2); IF P=0 THEN GOTO 8145
8125 READ (14,KEY="ptr"+D1$(INT(P/2)*8+9,8),DOM=8130)D3$; GOTO 8135
8130 D1$="",D2$=""; GOTO 8145
8135 D1$=D3$(282,16),D2$=D3$(266,16)
8140 D1$=FNS$(D1$),D2$=FNS$(D2$)
8145 RETURN 
8150 REM "Return to normal
8155 IF D1$="" THEN GOTO 8175
8160 FOR I=1 TO LEN(D1$) STEP 2
8165 IF D1$(I,2)<>"  " THEN IF POS(D1$(I,2)="ES1B",2)<>0 THEN PRINT (W9,ERR=8166)'ES', ELSE IF D1$(I,1)=" " THEN PRINT (W9,ERR=8166)D1$(I+1,1), ELSE PRINT (W9,ERR=8166)ATH(D1$(I,2)),
8170 NEXT I
8175 RETURN 
8200 REM "Goto double high
8205 IF D2$="" THEN GOTO 8225
8210 FOR I=1 TO LEN(D2$) STEP 2
8215 IF D2$(I,2)<>"  " THEN IF POS(D2$(I,2)="ES1B",2)<>0 THEN PRINT (W9,ERR=8216)'ES', ELSE IF D2$(I,1)=" " THEN PRINT (W9,ERR=8216)D2$(I+1,1), ELSE PRINT (W9,ERR=8216)ATH(D2$(I,2)),
8220 NEXT I
8225 RETURN 
8300 REM "Place in page, F5 = field #, F5$=field info
8305 IF X9[F5]=0 THEN GOTO 8315 ELSE IF JETFORM_MODE THEN GOSUB JETFORM_PRINT; GOTO 8315
8306 IF B9=1 THEN DIM Q[1]; CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,0,P$,O$,"","",Q{ALL}; GOTO 8315; REM "Use barcode module
8310 P$(X9[F5]+Y9[F5]*W3,LEN(F5$))=F5$
8315 RETURN 
8320 REM "Offset lines by O0
8325 IF X9[F5]=0 THEN GOTO 8345 ELSE IF JETFORM_MODE THEN GOSUB JETFORM_PRINT; GOTO 8345
8326 IF B9=1 THEN DIM Q[1]; CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,O0,P$,O$,"","",Q{ALL}; GOTO 8345; REM "Use barcode module
8330 P$(X9[F5]+(Y9[F5]+O0)*W3,LEN(F5$))=F5$
8345 RETURN 
8350 REM "F5=field#, F5$=field info. line number is used to index off of I0 set to first line in lines section - 1. line 1  on a line = first line.
8351 REM "Set F4 to highest line # printed
8355 IF X9[F5]=0 THEN GOTO 8395 ELSE IF JETFORM_MODE THEN GOSUB JETFORM_PRINT; GOTO 8365
8357 REM IF I0+Y9(F5)*W3>(Y8(2)+Y8(3)-1)*W3 THEN GOSUB 04600
8358 IF B9=1 THEN DIM Q[1]; O0=I0/W3; CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,O0,P$,O$,"","",Q{ALL}; Y9[F5]=Q[0]; GOTO 8361; REM "Use barcode module
8360 P$(I0+X9[F5]+Y9[F5]*W3,LEN(F5$))=F5$
8365 IF Y9[F5]>F4 THEN F4=Y9[F5]
8395 RETURN 
8400 REM "Print a ply line based on I0 offset, F5 index, F5$ data
8405 IF X9[F5]=0 THEN GOTO 8445
8410 IF X9$(F5,1)="L" THEN I0=I0+(Y9[F5]-Y9[32])*W3
8415 IF B9=1 THEN DIM Q[1]; O0=I0/W3-A0[6]; CALL "BC2FMY",X3$,X4$,A0$,A0{ALL},F5,F5$,0,O0,P$,O$,"","",Q{ALL}; GOTO 8430; REM "Use barcode module
8420 IF JETFORM_MODE THEN GOSUB JETFORM_PRINT ELSE P$(I0+X9[F5],LEN(F5$))=F5$
8430 IF X9$(F5,1)="L" THEN I0=I0-(Y9[F5]-Y9[32])*W3
8445 RETURN 
8500 REM "SDL= Second Description Line & Line item product codes
8504 DIM X$(187),X[40]; FIND (Z[5],KEY=B$(91,20),DOM=8505)IOL=0495
8505 IF X9[131]=0 OR POS(B$(10,1)="IC")=0 THEN F5=18,F5$=B$(28,40); GOSUB 8350; GOTO 8525
8510 FIND (Z[5],KEY=B$(91,20),DOM=8525)X$
8515 F5=18,F5$=X$(21,40); GOSUB 8350; F5=131,F5$=X$(128,40); GOSUB 8350
8525 REM "Diversified Label?
8530 IF POS(X3$(9,3)="021500",3)=0 THEN GOTO 8545
8535 FIND (Z[8],KEY="T"+B$(25,3),DOM=8545)X$
8540 IF X$(5,1)="*" THEN F4=8
8545 RETURN 
8550 REM "GET & PRINT PRODUCT CODE DESCRIPTION
8555 FIND (Z[8],KEY="T"+P7$,DOM=8595)X$
8560 F5=100; IF X9$(F5,1)="C" THEN F5$=P7$; GOSUB 8300 ELSE F5$=X$(5,15); GOSUB 8300
8570 IF X$(5,1)="*" AND POS(X3$(9,3)="021500",3)>0 THEN F4=8; REM "For Diversified, * as 1st Char of P/C Desc means custom label
8595 RETURN 
8600 REM "Print item stuff
8605 F5=107,F5$=F$(24,8); GOSUB 8300
8610 F5=108,F5$=F$(32,8); GOSUB 8300
8615 F5=109,F5$=F$(40,2); GOSUB 8300
8620 IF POS(" "<>F$(167,6))>0 THEN F5=20,F5$=F$(167,6); GOSUB 8300
8622 IF F[17]<>0 THEN F5=102,F5$=STR(F[17]:"###,###,###"); IF FPT(F[17])=0 THEN GOSUB 8300 ELSE F5$=F5$+" /"+STR(100*FPT(F[17]):"#0"); GOSUB 8300
8625 IF P7$<>"" AND POS(" "<>P7$)<>0 THEN GOSUB 8550
8630 F5=141,F5$=F$(215,16); GOSUB 8300
8645 RETURN 
8700 REM "Do FS2 stuff
8702 READ (Z[10],KEY=A$(297,8)+B$(7,3),DOM=8703)IOL=0450; GOTO 8709
8704 IF B[20]=0 OR B[21]=0 THEN GOTO 8795 ELSE B0[4]=B[21]*B[2]/B[20]; CALL "FM2EXT",Z[13],0,B$(77,4),B[2],B[1],B0[4],X,2; B0[6]=X; GOTO 8715
8709 REM "If selling u/m <> to po line cost u/m adjusting selling.
8710 IF B0$(124,4)<>B$(77,4) THEN X=B0[4]; CALL "FM2EXT",Z[13],1,B$(77,4),B[2],B0[0],X,B0[6],2; B0[4]=X
8712 IF X9[130]=0 AND B0[4]=0 THEN B0[4]=B0[6]
8715 F5=96,F5$=STR(B0[4]:M5$); GOSUB 8350
8720 B5=B5+B0[6]; F5=130,F5$=STR(B0[6]:M0$); GOSUB 8350
8725 DIM C0$(32),C0[15]; FIND (Z[9],KEY=B0$(128,5),DOM=8726)IOL=0460
8729 REM "Figure commission x, P3 is set in 2500's to total cost this line
8730 CALL "AR2COM","",C0$,C0{ALL},X,B0[6],P3
8735 F5=98,F5$=B0$(128,5); GOSUB 8350
8740 B6=B6+X
8745 IF A$(173,1)="S" THEN GOTO 8795
8750 IF B0[6]<>0 THEN F5=(B0[6]-P3)*100/B0[6],F5$=STR(F5:M6$),F5=124; GOSUB 8350
8760 F5=123,F5$=STR(B0[6]-P3:M0$(2)); GOSUB 8350
8765 IF B$(7,3)="001" AND POS(" "<>B0$(113,6))>0 THEN F5=142,F5$=FND$(B0$(113,6)); GOSUB 8300
8795 RETURN 
8800 REM "Check to see if any plies remain to be done
8805 IF S0$="" THEN GOTO 8825
8810 L2$="*"
8815 GOSUB 4000
8820 L2$=""
8822 IF S0$<>"" THEN GOTO 8810
8825 RETURN 
8830 REM "Do headup stuff if more lines needed
8834 GOSUB 8850
8837 IF JETFORM_MODE THEN CALL "EF2JET",X3$,X4$,P6$,"E",JETFORM_DEV,JOB_MODIFIER$,RET$ ELSE GOSUB 2900
8840 GOSUB 2100; GOSUB 2150; GOSUB 2200; GOSUB 2350
8845 RETURN 
8850 REM "Print continued message
8855 F5=133,F5$="*Cont*"; GOSUB 8300
8895 RETURN 
8900 REM "U/M
8910 IF B$(77,4)<>L$(4,4) THEN CLOSE (14); OPEN (14)"ZZPARM"; DIM L$(21),L[1]; READ (14,KEY="U/M"+B$(77,4),DOM=8911)IOL=0420
8920 IF L[1]=0 THEN L[1]=1
8940 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "End program
9905 IF FID(0)<>FID(W9) THEN CLOSE (W9); W9=-1; REM "to prevent formfeed action
9906 IF V3$(2,2)="A " THEN PRINT 'EA',
9909 IF V8$="A" THEN V3$(2,6)="AUTO"+V7$
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9915 IF V8$="A" OR (Y4$<>X0$ AND V3$(2,1)<>"T") THEN GOSUB 5300
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9925 CALL "ZZDAPP",X3$,"AALL"
9930 IF Y4$<>"" THEN RUN Y4$,ERR=9931
9940 RUN "ZMENU"
9999 END 
56000 REM + Modification History
56002 REM "205703-Oracle - FID and FIB calls, replace with FN%FID$ and FN%FIB$
