0010 REM "Purchase Order Printing <PO2PAA>
0035 REM "5.7 - 06/02/14 - 16.479166 - crg - SSP# 270561
0037 REM "270561-Enhance Unattended Printing setup; display print selection  
0040 REM "Copyright 2014 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 IF %GUI THEN SETERR 9000; GOTO 0095
0090 BEGIN ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="PO2PAA",X1$="Purchase Order Printing"
0120 DIM A$(0),B$(82),B[19],C$(297),L$(20),L[1],H$(169),H0$(169),D6$(116)
0140 M0$="###,###.00-",M1$="#####,###.00-",M2$="##,###,##0-",M3$="###,###-",M4$="-00000000.00",M4=LEN(M4$)
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0180 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
0210 T=1,T0=1,T1=1
0220 W3=120
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(131),Y6$(131),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0300 REM "I/O lists
0305 REM "IOLIST FOR PO1 - Purchase order header
0310 IOLIST A$
0315 REM "IOLIST FOR PO2 - Purchase order lines
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19]
0325 REM "IOLIST FOR FS1 - Sales order Header
0330 IOLIST C$
0335 REM "IOLIST FOR AR1 - Customer Masterfile
0340 IOLIST D$
0345 REM "IOLIST FOR FM0 - Location Masterfile
0350 IOLIST E$,E[0],E[1]
0355 REM "IOLIST FOR AP4 - Vendor Masterfile
0360 IOLIST F$,F[0]
0365 REM "IOLISTS FOR FMP - Codes
0370 IOLIST G$
0371 IOLIST G0$
0372 IOLIST G1$
0375 REM "IOLISTS FOR AR3 - Salesperson
0380 IOLIST H$
0382 IOLIST H0$
0385 REM "IOLIST FOR FMS - Item Specification II
0390 IOLIST I$
0395 REM "IOLIST FOR FMU - Ply ( line detail )
0400 IOLIST J$
0405 REM "IOLIST FOR FMV - Item spec comments
0410 IOLIST K$
0420 IOLIST L$,L[0],L[1]
0425 REM "IOLIST FOR FSH - O/P Division Information
0430 IOLIST D6$
0440 IOLIST I6$
0490 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01O PO6...  02O PO1...  03O PO2...  04O IC2...  05O AR1...  06O PO3...  07O FM0...  08O FMP...  09O AR3...  10O FSH...  11O POE...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0700 REM "Open Printer
0730 CALL "ZZDAPP",X3$,"DZZFLESZZENTRZZCOMP"
0735 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0736,9920
0740 W0=60
0750 GOSUB 8100
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0840
0820 DIM U[2]; U=10,U0=2,U[0]=0,U[1]=1,U[2]=9,T0=0,U0$="    ",T5$="                "; GOTO 0850
0850 DIM T[T0,T1]
0860 V5=V1+1,V6=V5+V2,V7=V6+V3
0900 REM " Position read"
0905 REM "set key file to read from"
0910 U1=Z[1]
0920 V2$=V2$(1,20)
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
0995 IF Q5=0 THEN GOSUB 6000
1000 REM "Read next record
1005 U$=KEY(U1,END=5000); READ (U1)
1006 IF U$(1,1)<>"P" THEN GOTO 5000
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])<V2$(U3,U[U9]) THEN READ (U1,END=5000); EXITTO 1000
1030 IF U$(U2,U[U9])>V2$(U3+U[U9],U[U9]) THEN IF U=1 THEN EXITTO 5000 ELSE READ (U1,END=5000); EXITTO 1000
1040 NEXT U9
1100 REM "Get record"
1110 U9$=U$
1120 ON V0 GOTO 1150,1150,1130,1140
1150 READ (Z[2],KEY=U$(2,9),DOM=1000)IOL=0310
1165 IF Q5=1 THEN CALL "ZZDISP","A",A$(297,9),"P/O",X3$,"","",34,21,X4$; IF A$(189,1)<>"P" THEN GOTO 1000 ELSE REMOVE (Z[1],KEY=U$,DOM=1000); GOTO 1000
1300 REM "Read other data
1305 P0=1
1310 Y$="04C IC2...  04O FS1...  "
1315 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
1320 DIM C$(118); FIND (Z[4],KEY=A$(306,8),DOM=1321)IOL=0330
1325 Y$="04C FS1...  04O IC2...  "
1330 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
1335 DIM D$(200); FIND (Z[5],KEY=A$(179,10),DOM=1336)IOL=0340
1340 GOSUB 7500
1350 DIM H$(169); FIND (Z[9],KEY=C$(89,4),DOM=1351)IOL=0380
1355 DIM H0$(169); FIND (Z[9],KEY=C$(93,4),DOM=1356)IOL=0382
1500 REM "Print Data
1515 P1=1
1520 IF P1>P0 THEN GOTO 1700
1530 GOSUB 5400
1540 GOSUB 5500
1560 GOSUB 2000
1580 P1=P1+1
1590 GOTO 1520
1800 REM "fix printed flag
1810 A$(189,1)="P"
1820 WRITE (Z[2],KEY=U$(2,9))IOL=0310
1900 REM "Accumulate Totals"
1990 T[T0,0]=T[T0,0]+1
1995 GOTO 1000
2000 REM "Print a P/O
2005 S0$=""
2010 GOSUB 2100
2020 GOSUB 2150
2030 GOSUB 2200
2040 GOSUB 2350
2050 GOSUB 2400
2060 GOSUB 2900
2070 IF POS("X"<>A$(297,9))=0 THEN RETURN ELSE IF C1>1 THEN GOSUB 5700; GOSUB 4500 ELSE IF S0$<>"" THEN GOSUB 4000 ELSE GOSUB 4700
2090 RETURN 
2100 REM "Print very top
2105 DIM P$(20*W3)
2110 IF D6$(1,2)<>A$(297,2) THEN DIM D6$(116); FIND (Z[10],KEY=A$(297,2),DOM=2111)IOL=0430
2115 GOSUB 7300
2117 Y5$(45)=D6$(11,35); GOSUB 7300
2119 Y5$(45)=D6$(46,35)
2120 CALL "ZZDISP","AX",A$(297,9),"P/O",X3$,X$,"",0,0,X4$; Y5$(96)=X$,P5$=X$
2125 IF POS(" "<>A$(204,6))<>0 THEN Y5$(108)=FND$(A$(204,6))
2130 GOSUB 7300
2139 Y5$(45)=D6$(81,35); GOSUB 7300
2140 RETURN 
2150 REM "Order header info
2154 GOSUB 7600
2155 IF POS(" "<>A$(192,6))<>0 THEN P$(82,10)=FND$(A$(192,6))
2157 P$(94,12)=A$(212,12)
2158 IF POS(" "<>A$(224,6))<>0 THEN P$(108,10)=FND$(A$(224,6))
2159 CALL "ZZDISP","AX",A$(7,10),"A/P",X3$,X$,"",0,0,X4$
2160 P$(321,12)=A$(230,12),P$(338-INT(LEN(X$)/2),LEN(X$))=X$,P$(345,14)=G$(3,15)
2165 P$(563,15)=G0$(3,15),P$(582,15)=E$(135,15)
2170 P$(803,15)=G1$(3,15),P$(822,15)=E$(151,15)
2190 RETURN 
2200 REM "Shipto, Soldto, Vender addresses
2210 IF C1=1 THEN GOSUB 2300; GOTO 2230
2211 IF LEN(E$)<259 THEN GOSUB 5600 ELSE E0$=E$(225,35)
2215 I0=164,X7$=E0$(1,35)+E$(16,117)
2220 GOSUB 7700
2230 X6$=FNS$(C$(28,15)),X6=LEN(X6$),P$(786-X6,X6)=X6$
2250 I0=605,X7$=D$(11,35)+Y6$(1,30)+D$(56,87)
2260 GOSUB 7700
2270 I0=1445,X7$=A$(21,152)
2280 GOSUB 7700
2290 RETURN 
2300 REM "Set up message for multiple shipto's
2310 P$(166,30)=T3$(1,30)
2315 P$(286,30)="* Multiple ship to addresses *"
2320 P$(406,30)="*   Shipping instructions    *"
2325 P$(526,30)="*     on following pages     *"
2330 P$(646,30)=T3$(1,30)
2340 RETURN 
2350 REM "Print bottom line
2355 CALL "ZZDISP","AX",A$(179,10),"A/R",X3$,X$,"",0,0,X4$
2360 P$(2286-INT(LEN(X$)/2),LEN(X$))=X$
2364 ON POS(A$(190,1)="NECSB") GOTO 2380,2365,2366,2367,2368,2369
2365 P$(2293,30)="New"; GOTO 2380
2366 P$(2293,30)="Exact repeat"; GOTO 2380
2367 P$(2293,30)="Copy change"; GOTO 2380
2368 P$(2293,30)="Spec change"; GOTO 2380
2369 P$(2293,30)="Copy&Spec change"; GOTO 2380
2380 P$(2324,20)=H$(149,20),P$(2345,4)=C$(89,4),P$(2350,20)=H0$(149,20),P$(2371,4)=C$(93,4)
2385 IF A$(191,1)="Y" THEN P$(2310,12)="*Confirming*"
2390 RETURN 
2400 REM "Print line information
2405 I0=1120,I1=0,S0$="",B1=0
2406 IF C1>2 THEN GOTO 2450 ELSE IF C1=1 AND LEN(P2$)=13 THEN GOTO 2450
2407 IF POS("X"<>A$(297,9))=0 THEN FOR I3=1 TO 6; GOSUB 2500; I1=I1+1; NEXT I3
2410 READ (Z[3],KEY=A$(297,9),DOM=2411)
2420 READ (Z[3],END=2490)IOL=0320; I1=I1+1; IF POS(" "<>B$(17,8)+B$(111,8)+B$(15,2))<>0 THEN I1=I1+1,B9$="*" ELSE B9$=""
2425 IF B$(82,9)<>A$(297,9) THEN GOTO 2490
2430 IF C1<>2 THEN B1=0
2432 GOSUB 7850
2435 IF POS(B$(10,1)="CXI")<>0 AND B$(81,1)="Y" AND S0$="" THEN S0$=B$(91,20),S8$=A$(297,8)+B$(7,3)
2440 GOSUB 2500
2445 GOTO 2420
2450 REM "Print lines from P2$ for spec instr."
2460 READ (Z[6],KEY=P2$(1,13),DOM=2461)IOL=0350
2465 READ (Z[3],KEY=E$(166,9)+E$(7,3),DOM=2466)IOL=0320
2466 READ (Z[3],KEY=A$(297,9)+E$(7,3),DOM=2475)IOL=0320
2470 B1=E[0]; GOSUB 2500
2475 P2$=P2$(14)
2490 RETURN 
2500 REM "Print one line from B$, I0 is assumed to be set
2504 IF B$(10,1)="I" AND I1>8 THEN GOSUB 4600 ELSE IF I1>9 THEN GOSUB 4600
2505 IF B$(10,1)="M" THEN P$(I0+11,40)=B$(28,40); IF B[0]<>0 THEN P$(I0+67,LEN(M1$))=STR(B[0]:M1$); GOTO 2535 ELSE GOTO 2535
2506 IF B[2]=0 THEN B[2]=1
2508 P$(I0+11,40)=B$(28,40)
2509 IF B$(10,1)="S" AND I$(61,1)="Y" THEN IF C1>=2 THEN GOTO 2517 ELSE P3=B[4]; GOTO 2530
2510 IF C1<2 THEN P$(I0+51,11)=STR(B[0]:M0$),X$=FNS$(B$(77,4)),P$(I0+65-INT(LEN(X$)/2),4)=X$
2511 IF B$(77,4)<>L$(4,4) THEN CLOSE (14); OPEN (14)"ZZPARM"; DIM L$(21),L[1]; READ (14,KEY="U/M"+B$(77,4),DOM=2512)IOL=0420
2512 IF L[1]=0 THEN L[1]=1
2513 IF B1=0 THEN IF L$(20,1)="Y" THEN B1=B[11]/L[1] ELSE B1=B[11]/B[2]
2515 IF B1<>0 THEN IF FPT(B1)=0 THEN P$(I0,11)=STR(B1:M2$) ELSE P$(I0,11)=STR(B1:M0$)
2517 IF C1>=2 THEN P$(I0+58,21)="Shipping instructions"; GOTO 2535
2520 IF L$(21,1)="Y" OR B[1]=0 THEN P3=B[0] ELSE IF L$(20,1)="Y" AND L[0]<>0 THEN P3=B[0]*B1/L[0] ELSE P3=B[0]*B1
2530 P$(I0+67,LEN(M1$))=STR(P3:M1$)
2535 I0=I0+W3
2537 IF B9$="*" THEN H8$=B$; GOSUB 8000; P$(I0+11,40)=H9$+" ("+FNS$(B$(101,10))+")",H9$="",I0=I0+W3
2540 IF B$(10,1)<>"I" THEN GOTO 2550
2542 FIND (Z[4],KEY=B$(91,20)+A$(7,14),DOM=2550)IOL=0440
2544 IF POS(" "<>I6$(35,20))=0 THEN GOTO 2550
2546 P$(I0+11,40)="Your item no: "+I6$(35,20),I0=I0+W3,I1=I1+1
2590 RETURN 
2900 REM "Send P$ to printer
2910 FOR I=0 TO INT(LEN(P$)/W3)-1
2920 Y5$=P$(I*W3+1,W3); GOSUB 7300
2930 NEXT I
2940 RETURN 
4000 REM "Print bottom half of P/O
4004 Z$="05C AR1...  06C PO3...  07C FM0...  09C AR3...  10C FSH...  11C POE...  07O FM1...  09O FS2...  10O FMS...  11O FMU...  12O FMV...  "
4005 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
4006 DIM F$(150),F[1]; READ (Z[7],KEY=S0$,DOM=4015)IOL=0360
4007 DIM S9$(125); FIND (Z[9],KEY=S8$,DOM=4008)S9$
4010 GOSUB 4100
4015 GOSUB 4550
4020 GOSUB 4300
4030 GOSUB 4400
4040 GOSUB 4500
4080 Y$="07C FM1...  09C FS2...  10C FMS...  11C FMU...  12C FMV...  05O AR1...  06O PO3...  07O FM0...  09O AR3...  10O FSH...  11O POE...  "
4085 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
4090 RETURN 
4100 REM "Print ply information
4105 READ (Z[11],KEY=S0$,DOM=4106)
4110 READ (Z[11],END=4140)IOL=0400; IF J$(1,20)<>S0$ THEN GOTO 4140
4120 IF W>=40 THEN GOTO 4145
4130 GOSUB 4150
4135 GOTO 4110
4145 RETURN 
4150 REM "Print a ply
4152 IF W=24 THEN GOSUB 7300; Y5$(111)=J$(102,8); GOSUB 7300; GOSUB 7300
4155 Y5$(1)=STR(NUM(J$(21,3)):"##"),Y5$(4)=J$(24,3),Y5$(8)=J$(27,3),Y5$(12)=J$(30,6),Y5$(19)=J$(36,8),Y5$(28)=J$(44,8),Y5$(37)=J$(52,6),Y5$(44)=J$(58,6),Y5$(51)=J$(64,6),Y5$(58)=J$(70,6)
4160 Y5$(65)=J$(76,10),Y5$(76)=J$(86,1),Y5$(78)=J$(87,2),Y5$(81)=J$(89,1),Y5$(83)=J$(90,1),Y5$(85)=J$(91,8),Y5$(94)=J$(99,3),Y5$(99)=J$(110,20)
4185 GOSUB 7300; IF V0$(59,1)=" " AND NUM(F$(40,2),ERR=4186)<=6 THEN GOSUB 7300
4186 IF NUM(F$(40,2),ERR=4187)<=4 AND V0$(59,1)="1" THEN GOSUB 7300
4190 RETURN 
4300 REM "Print comp section
4310 READ (Z[10],KEY=S0$,DOM=4370)IOL=0390
4315 IF A$(190,1)="N" THEN I$(31,1)=" " ELSE IF POS(A$(190,1)="CSB")<>0 THEN I$(31,1)="Y"
4319 IF I$(21,1)="Y" THEN Y5$(9)="Plant" ELSE Y5$(10)=I$(21,1)
4320 IF A$(190,1)="E" THEN Y5$(9,10)="",Y5$(93)=I$(32,1),Y5$(100)=I$(33,1),Y5$(115)=I$(35,3) ELSE Y5$(19)=I$(22,1),Y5$(27)=I$(23,1),Y5$(35)=I$(25,1),Y5$(45)=I$(26,1),Y5$(55)=I$(27,1),Y5$(67)=I$(28,1),Y5$(72)=I$(29,1),Y5$(77)=I$(30,1),Y5$(84)=I$(31,1),Y5$(93)=I$(32,1),Y5$(100)=I$(33,1),Y5$(107)=I$(34,1),Y5$(115)=I$(35,3)
4325 GOSUB 7300; GOSUB 7300
4328 IF POS(" "<>S9$(104,9))=0 THEN Y5$(13)=I$(38,9) ELSE Y5$(13)=S9$(104,9)
4330 Y5$(25)=I$(48,5),Y5$(33)=I$(53,2),Y5$(39)=I$(55,3)
4331 Y5$(48)=I$(58,1),Y5$(54)=I$(59,1),Y5$(60)=I$(60,1),Y5$(67,1)=I$(61,1),Y5$(73)=I$(62,1),Y5$(79)=I$(64,1),Y5$(84)=I$(65,1),Y5$(89)=I$(66,1),Y5$(94)=I$(67,1); IF F[0]=0 THEN Y5$(104)="Standard" ELSE Y5$(104)=STR(F[0]:M3$)
4335 GOSUB 7300; GOSUB 7300
4340 Y5$(13)=I$(68,1),Y5$(20)=I$(69,1),Y5$(26)=I$(70,1),Y5$(34)=I$(71,1),Y5$(42)=I$(72,1),Y5$(58)=I$(73,6),Y5$(73)=I$(79,8),Y5$(89)=I$(87,1),Y5$(99)=I$(88,5),Y5$(111)=I$(93,8)
4345 GOSUB 7300; GOSUB 7300
4350 Y5$(12)=I$(101,1),Y5$(16)=I$(102,1),Y5$(22)=I$(103,4),Y5$(28)=I$(107,1),Y5$(31)=I$(108,1),Y5$(35)=I$(109,1),Y5$(41)=I$(110,3),Y5$(47)=I$(113,1),Y5$(62)=I$(114,15),Y5$(83)=I$(129,15),Y5$(103)=I$(144,15)
4355 GOSUB 7300; GOSUB 7300
4360 RETURN 
4370 REM "No comp section
4380 GOSUB 7300; GOSUB 7300; GOSUB 7300; GOSUB 7300
4385 GOSUB 7300; GOSUB 7300; GOSUB 7300; GOSUB 7300
4390 RETURN 
4400 REM "Print comments
4402 IF V0$(59,1)="1" THEN GOSUB 7300; GOSUB 7300
4405 READ (Z[12],KEY=S0$,DOM=4406)
4406 F2=0
4408 IF MID(I$,63,1)="Y" THEN DIM K$(90); F2=1,K$(25,65)="Jumbo numbering"; GOSUB 4450
4410 READ (Z[12],END=4435)IOL=0410; IF K$(1,20)<>S0$ THEN GOTO 4435
4415 IF W>NUM(V3$(15,2))-1 THEN GOTO 4435
4420 GOSUB 4450
4430 GOTO 4410
4435 IF V0$(59,1)="1" AND F2=1 THEN GOSUB 7300
4440 RETURN 
4450 REM "Print a comment 
4455 IF K$(24,1)="N" THEN GOTO 4490
4460 IF V0$(59,1)=" " THEN Y5$(8)=K$(25,65); GOSUB 7300; RETURN 
4470 Y5$(F2*60+1+SGN(F2))=K$(25,60)
4475 IF F2=0 THEN F2=1 ELSE F2=0; GOSUB 7300
4490 RETURN 
4500 REM "Use up rest of page
4510 IF W<NUM(V3$(15,2)) THEN GOSUB 7300; GOTO 4510
4520 W=0
4540 RETURN 
4550 REM "Use unused ply space
4560 IF W<40 AND V0$(59,1)=" " THEN GOSUB 7300; GOTO 4560
4570 IF W<36 AND V0$(59,1)="1" THEN GOSUB 7300; GOTO 4570
4590 RETURN 
4600 REM "Continue if overflow on lines
4610 GOSUB 2900
4620 FOR I4=1 TO 6; GOSUB 7300; NEXT I4
4630 Y5$(40)="Purchase order continued on the next page"
4635 GOSUB 7300
4640 GOSUB 4500
4650 GOSUB 2100
4655 GOSUB 2150
4660 GOSUB 2200
4665 GOSUB 2350
4670 I0=1120,I1=0
4690 RETURN 
4700 REM "Print P/O comments
4703 GOSUB 4550; GOSUB 4370
4704 F2=0
4705 READ (Z[11],KEY=A$(297,9),DOM=4706)
4707 IF V0$(59,1)="1" THEN GOSUB 7300; GOSUB 7300
4710 READ (Z[11],END=4740)IOL=0410
4715 IF K$(1,9)<>A$(297,9) THEN GOTO 4740
4720 IF K$(13,1)<>"Y" THEN GOTO 4735
4725 Y6$(25,65)=K$(14,65); DIM K$(90); K$=Y6$(1,90); DIM Y6$(131); GOSUB 4460
4735 IF W<=NUM(V3$(15,2))-1 THEN GOTO 4710
4740 IF V0$(59,1)="1" AND F2=1 THEN GOSUB 7300
4750 GOSUB 4500
4790 RETURN 
5000 REM "End of Print
5010 IF Q5=1 THEN GOTO 9920
5020 IF W8=0 THEN GOTO 5200
5200 REM "
5270 Y$="09C AR3...  10C FMS...  11C FMU...  "
5280 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
5291 GOTO 9900
5300 REM "Remove printed P/O's
5310 CALL "ZZPROM",".Y",X3$,Z,"Did all of the purchase orders print correctly?","","",0
5320 ON Z GOTO 5330,5340
5330 GOSUB 5350; GOTO 5345
5345 RETURN 
5350 REM "Do remove
5354 PRINT @(0,19),'CE',
5355 CALL "ZZPROM","X0PO2PAA",X3$,Z,"","","",19
5359 REM "5360 WAS:LET Q5=1; DIM V2$(20,"~"); LET V2$(1,2)="PP",V2$(3,9)=""; GOTO 0900
5360 Q5=1; GOTO 0990
5390 RETURN 
5400 REM "Set code C1 for type of P/O
5405 REM "0=1 of 1 p/o, 1=cover p/o for multiple p/os, 2=general inst, 3=print special instr. from current po3 record
5410 IF P0=1 THEN C1=0; GOTO 5445
5414 REM "P0 is > 1
5415 ON P1 GOTO 5445,5420,5430,5440
5420 C1=1; GOTO 5445
5440 C1=3
5445 RETURN 
5500 REM "Get proper address, C1=1 taken care of in 2300's
5505 DIM E$(260)
5510 ON C1 GOTO 5515,5590,5520,5550
5515 IF LEN(P2$)=13 THEN GOTO 5550; REM "Only one P/O, but it is special ship
5520 READ (Z[6],KEY=A$(297,9)+"    ",DOM=5530)IOL=0350; GOTO 5590
5530 READ (Z[6],KEY=A$(297,8)+"     ",DOM=5540)IOL=0350; GOTO 5590
5535 REM "If no general inst., use customer address
5540 E$(16,30)=D$(165,20),E$(46,87)=D$(56,87); GOTO 5590
5550 REM "Read in special shipping record
5560 READ (Z[6],KEY=P2$(1,13),DOM=5580)IOL=0350
5570 GOTO 5590
5580 REM "Error"
5585 EXITTO 1580
5590 RETURN 
5600 REM "Get name to print on shipto
5610 E0$=D$(11,35)
5615 ON POS(E$(11,1)="CPD") GOTO 5645,5620,5625,5630
5620 FIND (Z[7],KEY=E$(11,1)+D$(1,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5625 FIND (Z[7],KEY=E$(11,1)+A$(7,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5630 FIND (Z[7],KEY=E$(11,1)+Y6$(1,10)+E$(12,4),DOM=5645)E1$; GOTO 5635
5635 E0$=E1$(16,35)
5645 RETURN 
5700 REM "Print shipping inst. message
5710 IF W<=48 THEN GOSUB 7300; GOTO 5710
5715 IF C1<2 THEN GOTO 5740
5719 GOSUB 8200
5720 Y5$(10)="Shipping instructions for P/O number: "+P5$
5730 GOSUB 7300
5735 IF D2$<>"" THEN GOSUB 8150
5740 RETURN 
6000 REM "Print alignment pattern?
6010 IF V3$(2,2)="A " THEN PRINT 'EA',
6015 CALL "ZZPROM","R4",X3$,Z,"","","",X0
6017 IF Z<2 AND V3$(2,2)="A " THEN PRINT 'BA',
6020 ON Z GOTO 6090,6021,9900
6030 GOSUB 6100
6040 GOSUB 6200
6050 GOTO 6010
6090 RETURN 
6100 REM "Setup test data"
6105 X$="X",X5$="I6XXXX"
6110 DIM A$(314,X$),B$(82,X$),B[19],C$(118,X$),D$(200,X$),E$(225,X$),F$(149,X$),F[2],G$(20,X$),G0$(20,X$),G1$(20,X$),H$(200,X$),H0$(200,X$),I$(159,X$),J$(130,X$),K$(90,X$)
6120 A$(204,6)=X5$,A$(192,6)=X5$,C$(16,6)=X5$,A$(224,6)=X5$,J$(21,3)="000"
6190 RETURN 
6200 REM " Print align. pattern
6210 S0$=""
6220 GOSUB 2000
6230 FOR I2=1 TO 8; GOSUB 4150; NEXT I2
6240 GOSUB 4550
6250 GOSUB 4320
6255 IF V0$(59,1)="1" THEN GOSUB 7300; GOSUB 7300
6260 FOR I2=1 TO 4; GOSUB 4450; NEXT I2
6270 GOSUB 4500
6290 RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7330 IF Y5$=Y6$ THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; DIM Y5$(131)
7395 RETURN 
7400 REM "Read report selection parameters"
7405 CLOSE (14); OPEN (14)"ZZP"
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (14,KEY=X3$(1,8),DOM=7451)IOL=0490
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"  ")-1)
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7486 CLOSE (14)
7490 RETURN 
7500 REM "Run through special shipping and calculate # of PO's needed (P0)
7504 DIM E[3]
7505 P0=0,P2$="",P3$=""; GOSUB 7800; IF A$(173,1)="C" THEN P0$=A$(306,8)+" " ELSE P0$=A$(297,9)
7510 READ (Z[6],KEY=P0$,DOM=7511)
7520 K$=KEY(Z[6],END=7540); IF K$(1,9)<>P0$ THEN GOTO 7540
7522 IF K$(10,4)="    " THEN READ (Z[6]); GOTO 7520; REM "Skip general instructions
7525 READ (Z[6])IOL=0350
7529 IF POS(E$(7,3)=P3$,3)=0 THEN GOTO 7535
7530 P0=P0+1,P2$=P2$+K$
7535 GOTO 7520
7538 REM "If p0=0 p0=1 for general p/o elseif p0>1 then p0=p0+1 for cover p/o on special shipping
7539 REM "If p0=1 then only one special ship address,see logic to print special ship instead of general
7540 IF P0<>1 THEN P0=P0+1
7590 RETURN 
7600 REM "Set shipping stuff based on shipping record
7610 DIM G$(20); READ (Z[8],KEY="F"+E$(133,1),DOM=7611)IOL=0370
7620 DIM G0$(20); READ (Z[8],KEY="H"+E$(134,1),DOM=7621)IOL=0371
7630 REM DIM G1$(20); READ (Z(8),KEY="S"+E$(150,1),DOM=7631) IOL=0372
7635 DIM G1$(20); G1$(3,15)=E$(210,15)
7645 RETURN 
7650 REM "Fix city, state, zip in X5$ into X6$
7655 IF X5$(17,2)="  " THEN X6$=""; GOTO 7690
7660 X6$=FNS$(X5$(1,16))+", "+X5$(17,2)+"  "
7670 CALL "ZZDISP","AX",X5$(19,9),"ZIP",X3$,X$,"",0,0,X4$
7680 X6$=X6$+X$
7690 RETURN 
7700 REM "Take name(35),attn(30),address(87) in X7$ & put into P$ at I0
7710 P$(I0,35)=X7$(1,35); I0=I0+W3
7715 IF POS(" "<>X7$(36,30))<>0 THEN P$(I0,30)=X7$(36,30); I0=I0+W3
7720 P$(I0,30)=X7$(66,30); I0=I0+W3
7725 IF POS(" "<>X7$(96,30))<>0 THEN P$(I0,30)=X7$(96,30); I0=I0+W3
7730 X5$=X7$(126); GOSUB 7650; P$(I0,LEN(X6$))=X6$
7740 RETURN 
7800 REM "Put valid p/o lines in P3$
7805 READ (Z[3],KEY=A$(297,9),DOM=7806)
7810 READ (Z[3],END=7840)IOL=0320
7820 IF B$(82,9)<>A$(297,9) THEN GOTO 7840
7825 P3$=P3$+B$(7,3)
7830 GOTO 7810
7840 RETURN 
7850 REM "Check if ext only
7854 DIM I$(61)
7855 IF B$(10,1)<>"S" THEN GOTO 7890
7860 READ (Z[8],KEY="X"+B$(101,10),DOM=7890)I$
7890 RETURN 
8000 REM "Build desc from H8$
8010 H9$=FNS$(H8$(17,8)); IF H9$<>"" THEN H9$=H9$+QUO; IF POS(" "<>H8$(111,8))<>0 THEN H9$=H9$+"x"
8020 H9$=H9$+FNS$(H8$(111,8)); IF H9$<>"" THEN IF POS(" "<>H8$(111,8))<>0 THEN H9$=H9$+QUO+" " ELSE H9$=H9$+" "
8030 IF NUM(H8$(15,2),ERR=8031)<>0 THEN H9$=H9$+H8$(15,2)+" Ply "
8050 RETURN 
8100 REM "Set D1$=normal, D2$=double high printing
8101 REM "Assumes special mode 5 is double & special mode six is un-double
8105 REM "This program assumes that double high is on until turned off, changes will be needed if double high goes off auto. at end of a line see lines 740 & 9905
8110 D1$="",D2$=""
8114 CLOSE (14); OPEN (14)"ZZPARM"
8115 READ (14,KEY="PRINTERS",DOM=8145)D1$,D2$
8120 P=POS(FID(W9)=D2$,2); IF P=0 THEN GOTO 8145
8125 READ (14,KEY="ptr"+D1$(INT(P/2)*8+9,8),DOM=8130)D3$; GOTO 8135
8130 D1$="",D2$=""; GOTO 8145
8135 D1$=D3$(282,16),D2$=D3$(266,16)
8140 D1$=FNS$(D1$),D2$=FNS$(D2$)
8145 RETURN 
8150 REM "Return to normal
8155 IF D1$="" THEN GOTO *RETURN
8160 PRINT (W9)'BO',D1$,'EO',
8175 RETURN 
8200 REM "Goto double high
8205 IF D2$="" THEN GOTO *RETURN
8210 PRINT (W9)'BO',D2$,'EO',
8225 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "End program
9905 IF FID(0)<>FID(W9) THEN W9=-1; REM "to prevent formfeed action
9906 IF V3$(2,2)="A " THEN PRINT 'EA',
9908 IF Y4$<>X0$ AND V3$(2,1)<>"T" THEN GOSUB 5300
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9915 REM IF Y4$<>X0$ AND V3$(2,1)<>"T" THEN GOSUB 5300
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9925 CALL "ZZDAPP",X3$,"AALL"
9928 IF %GUI THEN EXIT 
9930 IF NOT(NUL(Y4$)) THEN IF %GUI THEN CALL Y4$,ERR=*NEXT ELSE RUN Y4$,ERR=9931
9940 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
10000 PARSE_ZZS:
10005 SEL_OPTS$+="Printer ["+MID(ZZS2$,2,2)+"]; "
10006 TMPI=POS("2"=MID(ZZS1$,59,12)); IF TMPI>0 AND TMPI<12 THEN SEL_OPTS$+="Format ["+MID(ZZS1$,59+TMPI,1)+"]; "
10010 SEL_OPTS$+="Seq ["+TBL(MID(ZZS1$,71,1)="1","By Vendor Code","By PO Number")+"]; "
10015 IF MID(ZZS1$,71,1)="1" THEN {
10020 SEL_OPTS$+="Purchase Order ["+TBL(NUL(MID(ZZS3$,3,9)),FN%ZZDISP$(MID(ZZS3$,3,9),"P/O"),"FIRST")+"] - ["+TBL((MID(ZZS3$,12,9)="~~~~~~~~~"),FN%ZZDISP$(MID(ZZS3$,12,9),"P/O"),"LAST")+"]; "
10025  }
10035 IF MID(ZZS1$,71,1)="2" THEN {
10040 SEL_OPTS$+="Vendor ["+TBL(NUL(MID(ZZS3$,1,10)),FN%ZZDISP$(MID(ZZS3$,1,10),"A/P"),"FIRST")+"] - ["+TBL((MID(ZZS3$,11,10)="~~~~~~~~~~"),FN%ZZDISP$(MID(ZZS3$,11,10),"A/P"),"LAST")+"]; "
10041 SEL_OPTS$+="Plant ["+TBL(NUL(MID(ZZS3$,21,4)),MID(ZZS3$,21,4),"FIRST")+"] - ["+TBL((MID(ZZS3$,25,4)="~~~~"),MID(ZZS3$,25,4),"LAST")+"]; "
10042 SEL_OPTS$+="Purchase Order ["+TBL(NUL(MID(ZZS3$,29,9)),FN%ZZDISP$(MID(ZZS3$,29,9),"P/O"),"FIRST")+"] - ["+TBL((MID(ZZS3$,38,9)="~~~~~~~~~"),FN%ZZDISP$(MID(ZZS3$,38,9),"P/O"),"LAST")+"]; "
10045  }
10090 IF NOT(NUL(MID(ZZS1$,82,2))) THEN SEL_OPTS$+="Home Division ["+MID(ZZS1$,82,2)+"]; "
10091 IF NOT(NUL(MID(ZZS1$,84,12))) THEN SEL_OPTS$+="Alt Print Selection ["+STP(MID(ZZS1$,84,12))+"]; "
10092 IF NOT(NUL(MID(ZZS1$,96,2))) THEN SEL_OPTS$+="User Printer ["+MID(ZZS1$,96,2)+"]; "
10093 IF MID(ZZS1$,98,1)="Y" THEN SEL_OPTS$+="Job Card Override [Y]; "
10095 RETURN 
10099 ! 
56001 REM "270561-Enhance Unattended Printing setup; display print selection  
