0010 REM "Update Fax File with flog <FX2XBA>
0035 REM "5.7 - 08/16/10 - 16.052777 - tma - SSP# 240435
0036 REM "ADDED STD ERROR LOGIC AND SETERR TO PERMIT AUTO FILE EXPANSION 93/1/6
0037 REM "240435-Compare of programs/panels from DEV to Release              
0040 REM "Copyright 2010 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
1015 REM "F0 IS DEVICE FOR FX0 FILE
1020 ! NTER X3$,F0
1022 BEGIN 
1030 ! ETERR 9000
1100 REM 
1105 DIM Z[20]
1110 ! IM Z[NUM(X3$(60,3))]
1115 Z$="14O ZZPARM"; GOSUB 9750
1118 ! ALL "FX2SBC",X3$,Z[14],F1$,X9
1120 D9$=DAY,D9$=D9$(7,2); IF D9$(1,1)="9" THEN D9$(1,1)="J" ELSE IF D9$(1,1)="0" THEN D9$(1,1)="K"
1125 IF X3$>"" THEN D9$=X3$(21,2)
2000 REM "GET FLOG OUTPUT IN TEMP FILE
2005 D0$=%DATAPATH$+DLM
2010 F0$="TMP"+FID(0)
2015 ERASE F0$,ERR=2016; GOTO 2015
2020 REM "LET Q$="UMASK 0;/USR/VSIFAX/BIN/FLOG -D >"+D0$+F0$
2022 F2$="seq,que,nat,sbt,sbt,sti,eti,eti,gse,dia,tsi,cli,res,nps,nak,act,act,tg3,tg1,tg2"; REM "Set up tags to build file
2025 REM IF F1$(695,1)>="3" THEN Q$="umask 0;"+STP(F1$(697,30),1)+"/bin/vfxolog -U vsifax -f "+F2$+" >"+D0$+F0$ ELSE Q$="umask 0;/usr/vsifax/bin/flog -d >"+D0$+F0$
2026 ! F F1$(695,2)>="42" THEN CALL "ZZ2CMD",X3$,X4$,"{VF_DUMP_LOG_42}",SEP+F2$+SEP+STP(F1$(697,30),1)+SEP,"N{"+D0$+F0$+"}",RETURN_CODE,RETURN$; GOTO 2028
2027 ! F F1$(695,1)>="3" THEN CALL "ZZ2CMD",X3$,X4$,"{VF_DUMP_LOG_3}",SEP+F2$+SEP+STP(F1$(697,30),1)+SEP,"N{"+D0$+F0$+"}",RETURN_CODE,RETURN$ ELSE CALL "ZZ2CMD",X3$,X4$,"{VF_DUMP_LOG_2}",SEP+F2$+SEP+STP(F1$(697,30),1)+SEP,"N{"+D0$+F0$+"}",RETURN_CODE,RETURN$
2030 REM INVOKE Q$,ERR=2031
3000 REM "PROCESS FILE F0$
3005 Z$="01O EFL... "
3010 GOSUB 9700
3015 OPEN (20)"|grep JOB /usr/unform/ufdbd.log"
3030 READ RECORD (2,IND=0,ERR=*NEXT)A$; GOTO 3046
3040 REM "p=POS($0A$=a$); IF p=0 THEN READ RECORD (z[1],END=4000)x$; a$=a$+x$; GOTO 3040
3045 READ RECORD (20,END=4000)A$
3050 Q$=A$
3090 GOSUB 7000
3200 REM "
3210 READ (Z[1],KEY=B$(1,8),DOM=3220)B0$
3215 IF B0$(77,10)>B$(77,10) THEN GOTO 3280
3220 WRITE (Z[1],KEY=B$(1,8))B$
3290 GOTO 3040
4000 REM "END
4090 GOTO 9900
7000 REM "PARSE FLOG -D OPTION
7020 DIM B$(600); X0=0,Q$=Q$+"|"
7050 P=POS("|"=Q$),X0=X0+1; IF P=0 THEN RETURN 
7055 X$=Q$(1,P-1),Q$=Q$(P+1); IF X$="" THEN GOTO 7060
7056 IF X$(1,1)="'" THEN X$=X$(2),X$=X$(1,LEN(X$)-1)
7060 IF X0=1 THEN B$(12,10)=X$(1,10),B$(22,8)=X$(12,8); GOTO 7390
7065 IF X0=2 THEN B$(30,3)=X$; GOTO 7390 ! Company code
7070 IF X0=5 THEN B$(33,3)=X$; GOTO 7390 ! Driver Type
7075 IF X0=3 THEN B$(1,8)=X$; GOTO 7390 ! Job ID
7078 IF X0=4 THEN B$(84,2)=X$; GOTO 7390 ! Version Number
7080 IF X0=7 THEN GOSUB 8000; B$(77,6)=Q0$,B$(83,4)=Q1$; GOTO 7390
7085 IF X0=8 AND F1$(695,1)>="3" THEN B$(106)=STR(NUM(B$(83,4))-NUM(B$(73,4)):"000"); GOTO 7390 ELSE IF X0=8 AND F1$(695,1)<"3" THEN B$(106,3)=STR(NUM(X$):"000"); GOTO 7390
7088 IF X0=6 THEN B$(36,20)=X$; GOTO 7390 ! Rule file
7090 IF X0=9 THEN B$(15,16)=X$; GOTO 7390
7095 IF X0=10 THEN B$(37,30)=X$; GOTO 7390
7100 IF X0=11 THEN B$(139,20)=X$; GOTO 7390
7105 IF X0=12 THEN B$(34,3)=X$; GOTO 7390
7110 IF X0=16 AND F1$(695,1)>="3" THEN B$(98,8)=X$(5); GOTO 7390 ELSE IF X0=16 AND F1$(695,1)<"3" THEN B$(98,8)=X$; GOTO 7390
7115 IF X0=17 AND F1$(695,1)>="3" THEN B$(90,8)=X$(5); GOTO 7390 ELSE IF X0=16 AND F1$(695,1)<"3" THEN B$(90,8)=X$; GOTO 7390
7120 IF X0=19 THEN B$(109,15)=X$; GOTO 7390
7125 IF X0=20 THEN B$(124,15)=X$; GOTO 7390
7390 GOTO 7050
7400 RETURN 
8000 REM "GET DATE AND TIME
8010 IF LEN(X$)<10 THEN GOTO 8045
8020 IF F1$(695,1)>="3" THEN Q0$=FNE$(X$(1,4))+X$(5,4) ELSE Q0$=D9$+X$(1,2)+X$(4,2)
8025 IF F1$(695,1)>="3" THEN Q1$=X$(9,2)+STR(100*NUM(X$(11,2))/60:"00") ELSE Q1$=X$(7,2)+STR(100*NUM(X$(10,2))/60:"00")
8045 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9700 REM 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9835 DEF FNE$(Z0$)=CHR(NUM(Z0$(1,3))-190+65)+Z0$(4,1)
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9940 EXIT 
9999 END 
