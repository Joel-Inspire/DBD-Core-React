0010 REM "A/R Invoice Data Entry - II <AR2EAL>
0035 REM "5.2 - 03/02/04 - 10.683333 - lms - SSP# 167214
0040 REM "Copyright 2004 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 SETERR 0100; L$=""; ENTER X3$,X4$,A1$,A$,A{ALL},L1,Z{ALL}; L$="Y"
0100 SETERR 9000; SETESC 9300
0102 IF J9=-10 AND A$(337,1)="Y" THEN A$(337,1)="y"; REM " If in auto bill mode, set to lc "Y" so we will stop @ prompt in here, other progs will use "Y" or "Y" to detect auto bill
0105 J8=J7,J7=0; ON J8 GOTO 0106,1000,1100,1120,1125,1160,1800,1900,5400,7000,0106
0110 X0$="AR2EAL"
0140 M0$="##,###,###.00-",M1$="###,###.00-",M2$="##,###.00-",M3$="##,###"
0145 DIM M5[1]; M5$="###,###.00 ",M5[0]=621,M5[1]=2; IF I0$(45,1)>"2" THEN DIM M5$(11,"0"); M5[1]=NUM(I0$(45,1)),M5$(1,10-M5[1])="##########",M5$(POS("0"=M5$),1)=".",M5[0]=(10-M5[1])*100+M5[1]*10
0160 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
0210 IF D5$="*" THEN GOSUB 6500; RUN "AR2EAM"
0280 A5=0
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0310 IOLIST A,B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20]
0311 IOLIST A,B$,B[0],B[1],STR(B[2]),STR(B[3]),B[4],B[5],B[6],B[7],B[8],B[9],B[10]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6]
0340 IOLIST D$
0350 IOLIST E$,E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15],E[16],E[17],E[18],E[19],E[20],E[21],E[22],E[23],E[24],E[25],E[26],E[27],E[28],E[29],E[30]
0351 IOLIST E$,E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15],E[16],E[17],E[18],E[19],E[20]
0352 IOLIST E$,E[0],E[1],E[2]
0370 IOLIST G$
0380 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13],H[14],H[15]
0390 IOLIST P3$,P[0],P[1]
0400 IOLIST W$
0420 CALL "ZZDISP","AX","XXXXXXXXX","ARV",X3$,Q$,"",0,0,X4$
0425 J0=LEN(Q$)+26
0439 Z$="05C AR2...  12C FMN...  12C ARG...  13C FM0...  07C AR5...  10C FS1...  11C ARC...  05O IC0...  12O ARV...  13O ART...  07O FM0...  10O FM1...  11O IC1...  "; GOTO 0450
0440 IF L$="Y" THEN Z$="05O IC0...  12O ARV...  13O ART...  07O FM0...  10O FM1...  11O IC1...  " ELSE Z$="05C AR2...  12C FMN...  12C ARG...  13C FM0...  07C AR5...  10C FS1...  11C ARC...  05O IC0...  12O ARV...  13O ART...  07O FM0...  10O FM1...  11O IC1...  "
0450 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0451,9900
0455 F=Z[13],A0=A[20]
0470 IF J9=-10 THEN J9=0; PRINT @(0,6),'CE','SB',; GOSUB 7510 ELSE GOSUB 7500
0475 DIM E[20]
0480 B$=""; GOSUB 6800
0500 REM "SET-UP
0505 A1=17,A2=1
0510 A3=INT((22-A1)/A2),A4=1,Y9=2,K8=LEN(A1$),Y$="",B$="",A9$=""
0520 DIM X[2],Y[6],T[3],O[10]
0522 O[0]=1,O[1]=100,O[2]=1000
0523 IF L$="Y" THEN GOSUB 5100; GOTO 7080
0525 IF A0=0 THEN U1=7,U2=U1,A9$=""; GOSUB 5200; GOTO 0800 ELSE H$="N",U1=0
0530 REM IF A0=0 THEN GOTO 0800
0540 GOSUB 5100
0550 L=1; GOTO 6425
0560 X[0]=1
0590 GOTO 1125
0800 REM "NEW ENTRY
0810 Y$=""
0830 X[0]=1; GOTO 1125
1000 REM 
1045 B$(1,8)=K9$+A1$
1100 REM "SELECT LINE
1110 GOTO 7000
1125 A6=0,A4=X[0]
1126 GOSUB 6965
1129 IF A4=0 THEN GOTO 7000
1130 A4=X[0],Y=(A4-1)*Y9+1; IF Y>LEN(Y$) THEN Y=-1,A4=LEN(Y$)/Y9+1,X[0]=A4
1132 PRINT @(6,6),A4:"##0",
1135 IF Y<0 THEN GOTO 1200
1140 A5=DEC(Y$(Y,Y9))
1150 READ (F,IND=A5)IOL=0310
1155 GOSUB 6600
1160 GOSUB 6200
1165 REM "TO AVOID DISPLAY; GOTO 1400 HERE!!!
1170 IF POS(BIN(A4,Y9)=L0$,Y9)>0 THEN GOTO 1400
1175 GOSUB 7300; GOTO 1400
1200 REM "NEW LINE
1210 IF A9<=0 THEN GOSUB 5200 ELSE GOSUB 5200
1220 Y$=Y$+BIN(A9,Y9),A6=1,A5=A9,A=-1,A9=-1,C6=1
1280 GOSUB 6960; PRINT @(6,6),A4:"##0",; GOSUB 6800
1290 GOTO 1400
1310 C0=-C0
1400 REM "MAINTAIN ENTRY
1490 GOTO 2000
1500 REM "OPTIONS (DISPLAY)
1510 C0=ABS(C0)
1520 IF C0=1 THEN GOTO 1125 ELSE GOTO 7000
1580 GOTO 2000
1600 REM "
1800 REM "PRIOR LINE
1810 IF X[0]>1 THEN X[0]=X[0]-1
1820 GOTO 1125
1900 REM "Finished with line
1904 IF B$(1,1)="M" OR (U=0 AND ABS(INT(C0))=3) OR (C0=4 AND U=0) THEN GOTO 1950
1906 IF POS(B$(54,1)="YNFC")=0 THEN CALL "ZZPROM",".Y",X3$,Z,"Is this item taxable?","","",0; IF Z=0 THEN B$(54,1)="Y"; PRINT @(77,14),"Y", ELSE B$(54,1)="N"; PRINT @(77,14),"N",
1908 IF B$(1,1)="C" AND B$(89,1)="9" THEN GOTO 1950
1910 IF ABS(B[4])<ABS(B[5]) THEN CALL "ZZPROM",".A",X3$,Z,"|WARNING - Price is less than cost","","",0; IF Z=0 THEN X0=13,C0=0; GOTO 2040
1915 IF B$(1,1)<>"T" AND B[4]<>0 THEN IF ABS((B[4]-B[5])*100/B[4])<10 THEN CALL "ZZPROM",".A",X3$,Z,"|WARNING - Low gross profit!!","","",0; IF Z=0 THEN X0=13,C0=0; GOTO 2040
1919 IF P3$(21,1)="Y" OR (B$(1,1)="S" AND E$(61,1)="Y") THEN GOTO 1926
1920 IF B[2]*10^(M5[1]-2)<=0 THEN CALL "ZZPROM",".A",X3$,Z,"|WARNING - Price is less than or equal to zero","","",0; IF Z=0 THEN X0=13,C0=0; GOTO 2040
1925 IF B[3]*10^(M5[1]-2)<=0 THEN CALL "ZZPROM",".A",X3$,Z,"|WARNING - Cost is less than or equal to zero","","",0; IF Z=0 THEN X0=15,C0=0; GOTO 2040
1950 REM "
1955 IF T<>0 OR U=1 THEN GOSUB 6700
1965 IF C0=3.2 THEN X[0]=X[0]-2
1968 IF A7=1 THEN GOSUB 5700
1970 REM "IF C6=1 THEN LET C0=0,C6=0
1975 IF C0=4 AND U=0 THEN GOTO 7000 ELSE X[0]=X[0]+1; GOTO 1125
2000 REM "DATA SEQ
2010 C0=0,D9=1,X0=-1,X1=1,T=0,U=0,Q$="?",V8$="000211172099"; IF Y<0 OR A7=1 THEN T=-1,X0=0
2020 X$="",C0=ABS(C0); IF C0=2 AND X0=0 THEN X0=999; GOTO 2040 ELSE IF C0=2 THEN X0=X0-1 ELSE X0=X0+1; IF C0=2 AND X0=0 THEN X[0]=X[0]-1; GOTO 1100
2025 IF C0>3 OR X0<0 THEN X0=999
2030 IF X0>0 THEN IF T=0 THEN T=-1; GOSUB 7200
2040 J7=1; RUN "AR2EAM"
2050 REM "STATUS
2055 C0=0,Q$="?",X$="MDNPLEIA"
2060 C1=1
2062 IF C1>1 THEN GOTO 5800
2070 IF T=0 THEN T=-1; GOSUB 7200
2090 GOTO 2020
2116 REM 
2158 U=1
4900 REM "END OF LINES
4910 Y[4]=-1; WRITE (F,IND=0)IOL=0290
4920 CALL "ZZEXPF",X3$,X4$,"X"+STR(F),"",G9; IF G9>0 THEN GOTO 7000
4925 EXTRACT (F,IND=0)IOL=0290
4930 Z=NUM(FIN(F,"MAXREC")); Y[3]=Z-1
4935 Y[4]=-2; WRITE (F,IND=0)IOL=0290
4940 GOTO 5230
4980 GOTO 7000
5000 REM "LINE LINE Z0 TO LINE Z1
5010 Q=(Z0-1)*Y9+1; IF Q>LEN(Y$) OR Q<1 THEN GOTO 5090 ELSE Z9=DEC(Y$(Q,Y9))
5012 Q=(Z1-1)*Y9+1; IF Q>LEN(Y$) OR Q<1 THEN Z8=-1 ELSE Z8=DEC(Y$(Q,Y9))
5015 READ (F,IND=Z9)IOL=0310
5020 IF Z1>LEN(Y$)/Y9 THEN Z8=-1
5030 IF A<>Z8 THEN A=Z8; WRITE (F,IND=Z9)IOL=0311
5095 RETURN 
5100 REM "BUILD INDEX STRING
5105 Y$="",Y=A0
5120 IF Y<=0 THEN GOTO 5195 ELSE Q$=BIN(Y,Y9); IF POS(Q$=Y$,Y9)=0 THEN Y$=Y$+Q$ ELSE GOTO 5195
5130 READ (F,IND=Y,END=5131)Y; GOTO 5120
5140 IF Y$>"" THEN Y$=Y$(1,LEN(Y$)-Y9)
5195 RETURN 
5200 REM "GET NEXT INDEX TO FILE IN A9
5205 IF A9$>"" THEN A9=DEC(A9$(1,Y9)),A9$=A9$(Y9+1); GOTO 5290
5210 EXTRACT (F,IND=0,ERR=5295)IOL=0290
5215 IF Y[4]=-2 THEN READ (F); WAIT 0; GOTO 5210
5220 Y[4]=-2; WRITE (F,IND=0)IOL=0290
5230 IF Y[1]<1 THEN A9=Y[2],Y[2]=Y[2]+1; GOTO 5260
5255 A9=Y[1]; READ (F,IND=A9)Y[1]
5260 IF Y[0]<Y[3] AND Y[2]<=Y[3] THEN Y[0]=Y[0]+1,Y[4]=-1 ELSE Y[2]=Y[2]-1; GOTO 4900
5270 IF U1>0 THEN U1=U1-1,A9$=A9$+BIN(A9,Y9); IF U1>0 THEN GOTO 5230
5280 WRITE (F,IND=0)IOL=0290
5285 IF A0=0 THEN A0=A9
5290 RETURN 
5295 IF ERR<>0 THEN GOTO 9000 ELSE RETRY 
5300 REM "REMOVE INDEX Z
5302 IF POS(BIN(Z,Y9)=A9$,Y9)>0 THEN ESCAPE 
5305 IF U2>0 THEN A9$=BIN(Z,Y9)+A9$; GOTO 5360
5310 EXTRACT (F,IND=0)IOL=0290
5315 IF Y[4]=-2 THEN READ (F); WAIT 0; GOTO 5310 ELSE Y[4]=-2
5320 WRITE (F,IND=0)IOL=0290
5330 WRITE (F,IND=Z)Y[1]
5340 Y[1]=Z,Y[4]=-1,Y[0]=Y[0]-1
5350 WRITE (F,IND=0)IOL=0290
5360 Q0$=BIN(Z,Y9),Q=POS(Q0$=Y$,Y9); IF Q=0 THEN GOTO 5390
5365 Y$=Y$(1,Q-1)+Y$(Q+Y9)
5390 RETURN 
5395 ON ERR GOTO 5310,5311,9000
5400 REM "DELETE CURRENT LINE
5405 Z0=A4-1,Z1=A4+1,A5=DEC(Y$((A4-1)*Y9+1,Y9))
5410 IF T=0 THEN T=-1; GOSUB 7200
5415 GOSUB 5000; Z=A5
5420 GOSUB 5300
5430 GOSUB 6800
5435 IF ABS(C0)=3.2 THEN C0=2 ELSE IF ABS(C0)=3.1 THEN C0=4
5485 IF C7=1 THEN C7=0,C0=ABS(C0); IF C0=2 THEN X[0]=X[0]-1; D9=0; GOTO 1120 ELSE GOTO 7000
5490 IF Q$="D" THEN GOSUB 5700; GOTO 6100 ELSE GOTO 1125
5495 X[0]=999,D9=0; GOTO 1120
5500 REM "INSERT CURRENT LINE
5510 GOSUB 5200
5515 Y$=Y$(1,Y-1)+BIN(A9,Y9)+Y$(Y),A5=A9,A9=-1
5520 GOSUB 6800
5530 A6=1,X[0]=A4,A7=1
5540 WRITE (F,IND=A5)IOL=0311; Q$="I"; GOSUB 6000; A4=X[0]
5545 PRINT @(6,6),A4:"##0",
5590 GOTO 1160
5600 REM "TACK ON LINE TO END
5610 Z7=A8; IF Z7=0 THEN GOTO 5635
5620 READ (F,IND=Z7)IOL=0310
5625 A=Y[A5],Z8=0
5630 WRITE (F,IND=Z7)IOL=0311
5635 Z8=0
5690 RETURN 
5700 REM "DISPLAY AFTER DELETE/INSERT
5705 IF A7=1 THEN GOSUB 7300; A7=0; GOTO 5750
5710 IF L0$>"" THEN Z=DEC(L0$(1,Y9)); GOSUB 6000
5750 RETURN 
5800 REM "LINE CONTROL
5810 IF T<>0 THEN T=1; GOSUB 7200; T=0
5820 IF C0=2 THEN GOTO 1100
5880 ON POS(Q$="?DNPLEIA") GOTO 2060,2020,5400,1900,1800,6400,7000,5500,5495
5900 REM "Reset reserved links as avail
5910 Z=DEC(A9$(1,Y9)); GOSUB 5310
5915 A9$=A9$(Y9+1); IF A9$>"" THEN GOTO 5910 ELSE RETURN 
6000 REM "DISPLAY PAGE @ LINE Z
6002 IF Z<=0 THEN Z=1
6005 Y0=(Z-1)*Y9+1,L0=0,L1=Z,L0$="",L2=0,L2$=""
6010 PRINT @(0,A1),'CE',
6020 IF Y0>LEN(Y$) THEN Z=Z-1,A4=Z,L0$=""; GOTO 7320 ELSE IF Y0<1 THEN GOTO 6090
6022 IF Q$="I" AND A4=L1 THEN GOTO 6040
6025 READ (F,IND=DEC(Y$(Y0,Y9)))IOL=0310
6030 GOSUB 6600; GOSUB 6300
6040 L2$=L2$+CHR(1)+CHR(L0+A1)+CHR(3)+STR(L1:"##0")
6080 L0$=L0$+BIN(L1,Y9),L0=L0+1,L1=L1+1,Y0=Y0+Y9
6085 IF Y0>LEN(Y$) THEN L2=1 ELSE IF L0<A3 THEN GOTO 6022
6090 READ (F,IND=A5)IOL=0310
6095 RETURN 
6100 REM "SELECT LINE ROUTINE
6105 IF Y$="" THEN GOTO 7000 ELSE L1=DEC(L0$(1,Y9)),L2=DEC(L0$(LEN(L0$)-Y9+1,Y9)),X8=A4-L1
6106 C1$="004018012014001"
6110 CALL "ZZSLCT",X3$,"CX",C1$,"",L2$,"{4","",X8,X9,A4; A4=A4+L1,X[0]=A4,X0=A4,Y=(A4-1)*Y9+1; IF X9=-5 THEN Q$="D"; GOSUB 6170; ON S3 GOTO 6111,6110 ELSE IF X9=-4 THEN Q$="I" ELSE IF X9=-3 THEN X9=0 ELSE IF X9=-6 THEN X9=0
6112 IF X9<0 THEN ON -X9 GOTO 6115,6113,7000,6113,5500,5400,6120
6115 IF X9=0 THEN IF A4>=0 AND A4<=L2 THEN X0=A4; GOTO 7100
6120 IF X9<0 THEN A4=L1 ELSE Y=(A4-1)*Y9+1; IF A4>LEN(Y$)/Y9 THEN GOTO 7000
6130 X0=A4
6150 IF X9=1 AND L1=1 THEN X8=0; GOTO 6110 ELSE IF X9=1 THEN Z=DEC(L0$(1,Y9))-1 ELSE Z=LEN(L0$)-Y9+1,Z=DEC(L0$(Z,Y9))+1
6155 Z=INT(Z/A3)*A3; IF Z=0 THEN Z=1
6160 GOSUB 6000
6165 X8=A4-L1+1; GOTO 6105
6170 X$="",X8=A4-L1; CALL "ZZPROM","L2",X3$,0,X$,"","",0; X$=X$+" ( #"+STR(A4)+" )"
6175 CALL "ZZPROM","Y",X3$,S3,X$,"","",0
6180 RETURN 
6200 REM "PRINT ONE ENTRY
6210 CALL "AR2EAJ",X3$,X4$,B$,B{ALL},D7,H$,J0,G$,0,W$,M5$
6290 RETURN 
6300 REM "DISPLAY ONE LINE
6304 IF LEN(B$)<84 THEN GOTO 6390
6305 PRINT @(1,L0+A1),L1:"##0",
6310 PRINT @(5,L0+A1),B$(1,1),"-",B$(7,40),
6311 GOSUB 8500
6312 IF B[1]<>0 THEN PRINT @(46,L0+A1),B[1]/D7:M0$,
6319 IF B[2]*10^(M5[1]-2)=0 THEN B2=B[4] ELSE B2=B[2]
6320 IF POS(B$(1,1)="M")=0 THEN PRINT @(60,L0+A1),B2:M5$,@(73),B$(50,4),
6330 IF B$(6,1)<>"Y" THEN PRINT @(0,L0+A1),"X",
6390 RETURN 
6400 REM "LIST OPTION
6405 L=1
6410 IF A$(337,1)="Y" THEN GOTO 7000 ELSE CALL "ZZPROM","L3",X3$,S3,"","","V",X; ON S3 GOTO 6411,7000
6415 IF S3<0 THEN IF (X-1)*Y9+1>LEN(Y$) THEN X=LEN(Y$)/Y9-1 ELSE IF X<=0 THEN X=1
6420 IF S3<0 THEN L=X+1
6425 Z=L-1; GOSUB 6000
6430 IF L2=1 THEN GOTO 7000 ELSE L=L+L0; GOTO 6410
6460 GOTO 6410
6500 REM "RE-DO SCREEN
6505 D9$="*"
6510 GOSUB 6700
6520 GOSUB 7500
6525 D9$="",Z=INT(A4/A3)*A3; IF Z=0 THEN Z=1; IF C0>4 THEN C0=C0-5
6530 GOSUB 6000; GOSUB 7280; IF D9=0 THEN GOTO 1100
6535 PRINT @(6,6),X[0]:"##0",
6540 READ (F,IND=A5)IOL=0310
6545 GOSUB 6200; IF ABS(C0)>4 THEN C0=ABS(C0)-5
6549 D9$=""; RETURN 
6550 ON C0 GOTO 2040,2020
6600 REM "ALTERNATE DATA READS FOR 1 LINE
6602 IF LEN(B$)<109 THEN DIM B$(289),B[20],P3$(40),P[1],W$(150)
6605 DIM D$(40),G$(205),P[1],W$(150)
6610 FIND (Z[2],KEY="T"+B$(3,3),DOM=6611)IOL=0340
6615 FIND (Z[12],KEY=B$(75,9),DOM=6616)IOL=0370
6619 ON POS(B$(1,1)="ICFS") GOTO 6630,6620,6620,6623,6627
6620 DIM E[30]; FIND (Z[5],KEY=B$(55,20),DOM=6629)IOL=0350; GOSUB 8750; GOTO 6630
6623 DIM E[20]; FIND (Z[10],KEY=B$(55,20),DOM=6629)IOL=0351; GOTO 6630
6627 DIM E[2]; FIND (Z[2],KEY="X"+B$(65,10),DOM=6629)IOL=0352; GOTO 6630
6630 FIND (Z[6],KEY="U/M"+B$(50,4),DOM=6631)IOL=0390
6632 FIND (Z[7],KEY="D          "+B$(89,4),DOM=6633)IOL=0400
6635 GOSUB 8500
6640 DIM H$(33); FIND (Z[8],KEY=B$(84,5),DOM=6641)IOL=0380
6690 RETURN 
6700 REM "WRITE CURRENT LINE
6705 IF Y+1=LEN(Y$) THEN A=-1 ELSE A=0
6710 IF A=0 THEN A=DEC(Y$(Y+Y9,Y9))
6715 IF D9$<>"*" THEN T=1; GOSUB 7200; T=0
6720 WRITE (F,IND=A5)IOL=0311; Z=A,Q=Y
6725 IF A6<>0 THEN Z0=A4-1,Z1=A4; GOSUB 5000; READ (F,IND=A5)IOL=0310
6760 IF Z<0 THEN A6=1 ELSE A6=0
6765 IF POS(B$(1,1)="IC")<>0 AND (Q[1]>0 OR E[1]>0) THEN Z=1; GOSUB 6000; GOTO 6790
6780 IF D9$="" THEN IF A7<>1 THEN GOSUB 7300
6790 RETURN 
6800 REM "SET-UP DATA FOR 1 LINE
6810 B1$=B$,D7=1
6820 DIM B$(289),B[20],P3$(40),P[1],H$(100),H[15],W$(150),G$(50)
6821 IF L$="Y" THEN GOTO 6895
6832 B$(125,10)=A$(67,10),B$(54,1)="Y"; IF C9$="S" THEN B$(54,1)="" ELSE IF A$(115,1)="Y" THEN B$(54,1)="N"
6833 B$(6,1)="Y"
6840 C3$="*"+B$(1,1)+X3$(9,3)+A$(128,5); REM "*=no p/o code
6845 CALL "AR2COM",ERR=6845,"DEFAULT",C3$,C{ALL},Z[6],0,0
6848 B$(84,5)=C3$
6850 FIND (Z[8],KEY=B$(84,5),DOM=6851)IOL=0380
6880 REM "GOSUB 6600
6895 RETURN 
6900 REM "SET LAST LINE TO NO LINK
6905 IF Y$="" THEN A0=0; GOTO 6945 ELSE A5=DEC(Y$(LEN(Y$)-1,2)),A0=DEC(Y$(1,Y9))
6910 READ (F,IND=A5)IOL=0310
6940 A=-1; WRITE (F,IND=A5)IOL=0311
6945 RETURN 
6950 IF A5>0 THEN WRITE (F,IND=A5)IOL=0311
6960 PRINT @(50,6),'CL',@(0,8),'CL',@(0,10),'CL',@(12,11),'CL',@(17,13),'CL',@(17,14),'CL','SB',@(36,11),"Cost:",@(43,13),"GP Adj:",@(62),"Comm:",@(41,14),"Ord type:",@(54),"STC:",@(72),"Tax?",'SF',
6965 DIM C2$(20); PRINT @(19,6),C2$,
6990 RETURN 
7000 REM "END OF ENTRIES
7005 GOSUB 6900
7010 Z9=2,Z8=1
7020 GOSUB 6950
7025 IF A$(337,1)="Y" THEN S3=0; GOTO 7040
7030 CALL "ZZPROM","8",X3$,S3,"'X' to the left of the line number means line will not print on invoice","","V",X0
7040 ON S3+1 GOTO 7100,7050,7060,5495,6400,6100
7055 IF T[0]<>0 THEN CALL "ZZ2PRM","L1",X3$,S3,"","","",0; ON S3 GOTO 7000,7060,7060
7060 L0=1; IF S3=1 THEN L0=2
7070 IF A9$>"" THEN GOSUB 5900
7075 IF Y$>"" THEN A0=DEC(Y$(1,Y9)) ELSE A0=0
7080 A[20]=A0; GOSUB 8000
7082 Z$="05C IC0...  05O AR2...  12C ARV...  12O ARG...  07C FM0...  11C IC1...  11O ARC...  07O AR5...  10C FM1...  10O FS1...  13C ART...  13O FM0...  "
7083 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
7084 DIM B$(0),B[0],E$(0),E[0],G$(0)
7085 IF L$="Y" THEN GOTO 9900 ELSE IF S3=1 THEN RUN "AR2EAA" ELSE RUN "AR2EAD"
7100 REM "GOTO LINE NUMBER X0
7105 IF X0<=0 THEN X0=1
7110 X[0]=X0; GOTO 1125
7200 REM "TOTAL LOGIC (T= 1 OR -1)
7290 RETURN 
7300 REM "Display logic
7310 Q=POS(BIN(A4,Y9)=L0$,Y9),L0=INT(Q/Y9); IF Q>0 THEN GOTO 7400
7311 L0=INT((LEN(L0$)+1)/Y9)
7312 L2$=L2$+CHR(1)+CHR(L0+A1)+CHR(3)+STR(A4:"##0")
7315 IF BIN(A4,Y9)>=L0$ THEN IF LEN(L0$)/Y9<A3 THEN L0$=L0$+BIN(A4,Y9); GOTO 7310
7320 Z=INT(A4/A3)*A3; IF Z=0 THEN Z=1
7330 IF Y$>"" THEN GOSUB 6000
7390 IF X0>0 THEN X0=X0-0
7395 RETURN 
7400 REM "Lines section - display line a4
7410 Q=INT(Q/Y9),L0=Q,L1=A4
7440 GOSUB 6300
7490 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7505 IF L$="Y" THEN RETURN ELSE CALL "AR2EAO",X3$,X4$,A$,P1$,0; RETURN 
7510 IF L$="Y" THEN RETURN ELSE CALL "AR2EAO",X3$,X4$,A$,P1$,1; RETURN 
7600 REM "Calculated amounts
7610 IF B[6]<>0 THEN B[4]=B[1]*B[2]/B[6],B[5]=B[1]*B[3]/B[6]
7630 REM IF P(0)<>0 AND P(0)<>1 THEN LET B(4)=B(4)/P(0),B(5)=B(5)/P(0)
7635 PRINT @(54,10),B[4]:M0$,@(54,11),B[5]:M0$,@(69,10),'CL',@(69,11),'CL',
7636 B=B[4]-B[5]; PRINT @(69,10),B:M1$,; IF B[4]<>0 THEN PRINT @(72,11),B*100/ABS(B[4]):"-###.00%",
7640 RETURN 
7700 REM "DEFAULT ITEMS
7710 B$(7,40)=E$(21,40),B$(3,3)=E$(61,3),B$(50,4)=E$(120,4),B$(47,3)="   "
7715 B[2]=E[0],B[3]=E[17]
7720 FIND (Z[2],KEY="T"+B$(3,3),DOM=7721)IOL=0340
7725 B$(75,9)=D$(24,9)
7730 FIND (Z[12],KEY=B$(75,9),DOM=7731)IOL=0370
7735 GOSUB 8100
7780 GOSUB 6200
7790 RETURN 
7800 REM "Display inventory quantity breaks"
7805 IF E[1]=0 AND Q[1]=0 THEN RETURN 
7810 PRINT @(0,16),'CE','SB',@(0,16),"Base price:",@(14,17),"Quantity",@(34,17),"Price",
7812 IF E[7]<>0 THEN PRINT @(52,17),"Quantity",@(72,17),"Price",
7815 PRINT 'SF',@(12,16),E[0]:M1$,
7817 I5=11,I6=17
7820 FOR I=1 TO 11 STEP 2
7825 I6=I6+1; IF I6>20 THEN I6=18,I5=49
7830 IF E[I]=0 THEN EXITTO 7840 ELSE PRINT @(I5,I6),E[I]:M0$,@(I5+19,I6),E[I+1]:M1$,
7835 NEXT I
7840 RETURN 
7850 REM "Get proper price
7855 IF POS(B$(1,1)<>"IC")<>0 OR (E[1]=0 AND Q[1]=0) THEN RETURN 
7860 IF B[0]>B[1] THEN B2=B[0] ELSE B2=B[1]
7865 FOR I=1 TO 11 STEP 2
7870 IF E[I]=0 OR E[I]>B2 THEN B[2]=E[I-1]; EXITTO 7880
7875 NEXT I
7876 B[2]=E[12]
7880 PRINT @(51,10),B[2]:M1$,
7890 RETURN 
8000 REM "GET TOTAL COST/PRICE/GP ADJ
8005 A[1]=0,A[11]=0,A[18]=0,A[17]=0,A[19]=0,X0=0
8010 IF A0<=0 THEN GOTO 8090
8020 FOR X=1 TO LEN(Y$) STEP Y9
8030 EXTRACT (F,IND=DEC(Y$(X,Y9)))IOL=0310
8035 IF B$(2,1)="Y" THEN A[17]=A[17]+B[4]
8040 A[1]=A[1]+B[4],A[11]=A[11]+B[5],A[18]=A[18]+B[7],A[19]=A[19]+B[8],X0=X0+B[8]
8045 GOSUB 8200
8050 NEXT X
8060 IF A$(128,5)<>H$(1,5) THEN DIM H$(50),H[15]; FIND (Z[8],KEY=A$(128,5),DOM=8061)IOL=0380
8064 IF POS(X3$(9,3)="092130",3)>0 AND H$(32,1)="I" THEN C0=A[1]-A[17] ELSE C0=A[1]
8065 IF H$(32,1)="I" THEN GOSUB 8250; CALL "AR2COM",ERR=8066,"",H$,H{ALL},Q,C0,A[11]-X0; A[18]=Q
8067 IF POS(H$(33,1)="123456789")>0 AND H$(32,1)="L" THEN CALL "AR2COM",ERR=8067,"CC",H$,H{ALL},Q,A[1],A[11]-X0; A[18]=A[18]-Q; REM "See if comm chargeback is by invoice"
8070 IF POS(X3$(9,3)="066",3)>0 AND A[1]>=200 THEN A[18]=A[18]-5; REM "Jerome
8090 RETURN 
8140 ESCAPE ; RETURN 
8200 REM "Include Load into Invoice Total GP Adjustment
8210 DIM X$(33); Q=0,B[9]=B[8]; FIND (Z[8],KEY=B$(84,5),DOM=8211)X$(1),Q
8211 IF POS(X3$(9,3)="092130",3)>0 THEN IF B$(2,1)="Y" AND X$(32,1)="I" AND B[4]<>0 THEN X0=X0-B[8]
8212 IF POS(X$(33,1)="123456789")>0 AND POS(B$(1,1)="M")=0 THEN CALL "AR2COM",ERR=8213,"HC"+B$(112,4),X$,H{ALL},Q,B[4],B[5]-B[8]; B[9]=B[8]-Q
8214 IF X$(33,1)="F" THEN B[9]=B[8]-Q
8216 IF POS(X$(33,1)=" C")>0 THEN B[9]=B[8]-(B[5]-B[8])*Q/100
8220 A[19]=A[19]-B[8]+B[9]
8230 WRITE (F,IND=DEC(Y$(X,Y9)))IOL=0311
8240 RETURN 
8250 REM "Pre compute load on Invoice Total Type Commissions"
8255 IF POS(H$(33,1)="123456789")>0 THEN GOTO 8290
8260 A[19]=X0-A[11]*H[0]/100
8265 IF H$(33,1)="S" THEN A[19]=X0
8270 IF H$(33,1)="F" THEN A[19]=X0-H[0]
8290 RETURN 
8500 REM "Set D7 for quantities
8501 REM "Assumes IOLIST 390 has been read in properly
8505 IF P3$(20,1)="Y" THEN D7=P[1] ELSE D7=B[6]
8510 IF D7=0 THEN D7=1
8540 RETURN 
8750 REM "Get List Price for existing price
8760 E9=E[0]; Q=B[1]; IF B[0]>Q THEN Q=B[0]
8770 FOR I=1 TO 11 STEP 2
8775 IF E[I]=0 OR Q<E[I] THEN I=99; GOTO 8790
8780 E9=E[I+1]
8790 NEXT I
8795 RETURN 
8800 REM "Compute sales tax total T9(X,0)=Taxable Sale, T9(X,1)=Non-taxable sale, T9(X,2)=Tax as Freight
8810 IF A0=0 THEN GOTO 8890 ELSE GOSUB 8900; A=A0
8820 IF A<=0 THEN GOTO 8890
8830 READ (Z[13],IND=A)IOL=0310; X=(POS(B$(125,10)=T9$)-1)/10
8840 IF B$(54,1)="Y" THEN T9[X,0]=T9[X,0]+B[4]
8850 IF B$(54,1)="C" THEN T9[X,0]=T9[X,0]+B[4]*.5,T9[X,1]=T9[X,1]+B[4]-B[4]*.5
8860 IF B$(54,1)="F" THEN T9[X,2]=T9[X,2]+B[4]
8870 IF B$(54,1)="N" THEN T9[X,1]=T9[X,1]+B[4]
8880 GOTO 8820
8890 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9505 GOTO 6500
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 BEGIN ; SETESC 9350
9950 RUN "ZMENU"
9999 END 
