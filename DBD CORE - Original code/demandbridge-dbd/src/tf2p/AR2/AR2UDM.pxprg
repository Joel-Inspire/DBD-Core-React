0010 REM "Remove Invoice Batch records from files create for ODBC <AR2UDM>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 12/12/12 - 11.492222 - tma - SSP# 259372
0037 REM "259372-Needs to purge records from the AZT file.                   
0040 REM "Copyright 2012 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0110 X0$="AR2UDM",X1$="Remove Records from ODBC Avail Files"
0120 DIM Z0$(80,"-")
0130 K0=20,K1=1
0135 C9=-1
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0391 IOLIST AZB$,AZB[0],AZB[1],AZB[2],AZB[3],AZB[4],AZB[5],AZB[6],AZB[7],AZB[8],AZB[9],AZB[10],AZB[11],AZB[12],AZB[13],AZB[14],AZB[15],AZB[16],AZB[17],AZB[18],AZB[19],AZB[20]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O AZB...  02O AZT...  03O AZS... 04O AZD...  05O AZC...  06O AZ3...  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0600 REM "
0610 GOSUB 6000
0640 ! CALL "ZZPROM",".Y",X3$,Z,"Proceed?","","",0; ON Z GOTO 0641,9900!SSP#236056
0700 DIM A$(7)
0710 CALL "ZZENTR","Z",A{ALL},A$,X4$,X3$,35,9,1,4,C0,"",X$,"","AR2UDM00","","",""; IF ABS(C0)>=4 THEN GOTO 9900 ! ssp#236056
0720 CALL "ZZENTR","Z",A{ALL},A$,X4$,X3$,35,10,5,2,C0,"",X$,"","AR2UDM02","","",""; IF ABS(C0)>=4 THEN GOTO 9900
0780 CALL "ZZPROM",".Y",X3$,Z,"Proceed?","","",0; ON Z GOTO 0781,9900
0990 PRINT @(14,14),"Invoice Record:",
1000 REM 
1010 K$=KEY(Z[1],END=5000)
1025 IF K$(1,6)>A$(1,6) THEN READ (Z[1]); GOTO 4999 ! SSP#236056
1030 IF MOD(C1,100)=1 THEN PRINT @(35,14),C1,"-",K$
1040 DIM AZB[20]; READ (Z[1],KEY=K$)IOL=0391
1080 REMOVE (Z[1],KEY=K$)
1100 READ (Z[2],KEY=K$,DOM=*NEXT)
1110 AZT_KEY$=KEY(Z[2],END=1200)
1120 IF AZT_KEY$(1,17)<>K$(1,17) THEN GOTO 1200
1130 REMOVE (Z[2],KEY=AZT_KEY$)
1140 GOTO 1110
1200 READ (Z[6],KEY=K$(7,8),DOM=*NEXT)
1210 AZ3_KEY$=KEY(Z[6],END=1300); READ (Z[6],KEY=AZ3_KEY$)AZ3_REC$ ! SSP#259372
1215 IF AZ3_KEY$(1,8)<>K$(7,8) THEN GOTO 1300 ! If not the same invoice we are done !SSP#259372
1220 IF AZ3_REC$(34,6)+AZ3_REC$(1,8)+AZ3_REC$(21,3)<>K$(1,17) THEN READ (Z[6]); GOTO 1210 ! If not the same Year+period & seq # check next record !SSP#259372
1230 REMOVE (Z[6],KEY=AZ3_KEY$)
1240 GOTO 1210
1300 READ (Z[4],KEY=K$,DOM=*NEXT)
1310 AZD_KEY$=KEY(Z[4],END=1400); READ (Z[4],END=1400)
1320 IF AZD_KEY$(1,17)<>K$(1,17) THEN GOTO 1400 ! SSP#259372
1330 REMOVE (Z[4],KEY=AZD_KEY$)
1340 GOTO 1310
1400 READ (Z[3],KEY=K$(1,14),DOM=*NEXT)
1410 AZS_KEY$=KEY(Z[3],END=1500); READ (Z[3],END=1500)
1415 IF AZS_KEY$(1,14)<>K$(1,14) THEN GOTO 1500 ! If not the same invoice we are done !SSP#259372
1420 IF AZS_KEY$(1,14)+AZS_KEY$(25,3)<>K$(1,17) THEN GOTO 1410 ! If not the same sequence read the next record !SSP#259372
1430 REMOVE (Z[3],KEY=AZS_KEY$)
1440 GOTO 1410
1500 READ (Z[5],KEY=K$(1,14),DOM=*NEXT)
1510 AZC_KEY$=KEY(Z[5],END=1600)
1520 IF AZC_KEY$(1,17)<>K$(1,17) THEN GOTO 1600
1530 REMOVE (Z[5],KEY=AZC_KEY$)
4990 C1=C1+1
4999 GOTO 1000
5000 REM "EOJ
5010 X$=STR(C1)+" records removed" ! SSP#259643
5020 CALL "ZZPROM",".4",X3$,Z,X$,"","",0
5040 GOTO 9900
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6020 PRINT @(4,4),"This utility will process the ODBC Available Invoice Files and remove",@(4,5),"any records from AZB, AZT, AZC,AZD, AZS, and AZ3 that are prior to",@(4,6),"and including the Fiscal Year and Accounting Period entered.",@(15,7),"Progress will be reported every 100 records...", ! ssp#236056
6040 PRINT @(20,9),"Fiscal Year:",@(14,10),"Accounting Period:", ! SSP#236056
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56001 REM "259372-Needs to purge records from the AZT file.                   
