0010 REM "A/R Invoice Data Entry <AR2DAA>
0020 SETESC 9300; SETERR 9000
0025 REM "(C) Copyright 1986 - All Rights Reserved
0035 REM "5.2 - 03/02/04 - 10.544166 - lms - SSP# 167214
0040 REM "Copyright 2004 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 ON L0 GOTO 0100,6700,6500,7100,1800
0100 CLEAR ; SETERR 9000; SETESC 9300
0110 X0$="AR2DAA",X1$="A/R Invoice Data Entry",K9$="",K9=0
0120 DIM Z0$(80,"-"),Z1$(30),Q9$(202)
0130 K0=14,K1=3
0135 C9=-1,V9=-2
0140 M0$="-#,###,###.00",M1$="-###,###.00",M3$="-###.00"
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$(1,LEN(A$)),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24],A[25],A[26],A[27],A[28],A[29],A[30]
0320 IOLIST B$
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15]
0340 IOLIST D$
0350 IOLIST E$,E[0],E[1],E[2],E[3]
0370 IOLIST G$,G[0],G[1],G[2]
0380 IOLIST H$
0390 IOLIST I$
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01X ARB...  02O ARD...  03O AR1...  04O ZYB...  05ORAR2...  07ORAR5...  08O AR4...  09O AR3...  11O ARC...  12O ARG...  06O ZZPARM  "
0511 IF %ACTION$="C" THEN Z$="01X GRB...  02O GRD...  03O AR1...  04O ZYB...  05ORAR2...  07ORAR5...  08O AR4...  09O AR3...  11O GRC...  12O ARG...  06O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0600 REM "
0605 GOSUB 7400
0615 GOSUB 7800
0620 GOSUB 6000
0700 REM "Get date"
0720 D0$=X3$(15,6)
0725 READ (Z[6],KEY=X3$(9,3)+"A/R",DOM=9800)P0$
0730 READ (Z[6],KEY=X3$(9,3)+"AR1",DOM=9800)P2$
1000 REM "
1005 A0=0
1010 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
1030 DIM B$(1),C$(391),C[15],E$(54),E[3],G$(37,"Z"),G[2],H$(31),I$(244)
1032 T0=0,V0=0
1035 DIM A$(689+K9),A[30],T[9]
1045 A$(1,6+K9)=K9$+A1$
1050 GOSUB 6000; GOSUB 6450; GOTO 1071
1060 PRINT (0,ERR=1070)'CF',; GOSUB 6450; GOTO 1100
1070 GOSUB 6000; GOSUB 6450
1100 REM "KEY SEQ
1110 X0=-1,C0=0,X1=0,C9=0,Z9=0
1120 C0=ABS(C0),X$=""; IF C0=2 AND X0>0 THEN X0=X0-1 ELSE IF C0<>2 THEN X0=X0+1; IF C0=4 THEN GOTO 9900
1140 ON X0 GOTO 1200,1250,1300,1500
1200 REM "Fiscal Year Ending
1205 IF LEN(A1$)>0 THEN A$(1,4)=A1$(1,4); GOTO 1212
1209 J$=X3$(9,3)+"G/LYE"
1210 CALL "ZZENTR","ZXUX",A{ALL},A$,X4$,X3$,16,3+V0,1+K9,4,C0,"","{1"+X$,J$,"AR2DAA00","GLYE","GL2MQA",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 1210,1211
1215 IF C0=-2 OR C0=-4 THEN GOTO 9900
1220 FIND (Z[6],KEY=X3$(9,3)+"G/LYE"+A$(1,4),DOM=1210)P1$
1223 IF POS(P1$(99,1)="CR")<>0 THEN CALL "ZZPROM",".4",X3$,Z,"This year is closed and cannot be posted to","","",0; GOTO 1210
1240 GOTO 1120
1250 REM "Accounting Period
1255 IF LEN(A1$)>4 THEN A$(5,2)=A1$(5,2); GOTO 1262
1260 CALL "ZZENTR","ZUX",A{ALL},A$,X4$,X3$,48,3+V0,5+K9,2,C0,"","{2"+X$,"","GL2JAA02","","",""
1262 IF ABS(C0)=2 AND LEN(A1$)>0 THEN A1$=A1$(1,0)
1265 IF A$(5+K9,2)<"01" OR A$(5+K9,2)>P1$(13,2) THEN GOTO 1260
1270 GOSUB 7700
1290 GOTO 1120
1300 REM "Invoice number
1309 REM "Change to account type AR6 and remove lines 1320-1330 when account types work"
1310 CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,16,4+V0,7+K9,8,C0,"","{2"+X$,"","AR2DAA04","ARB","",""; IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 1310,1311
1312 IF ABS(C0)=2 AND LEN(A1$)>4 THEN A1$=A1$(1,4)
1315 IF C0<0 THEN IF -C0=1 THEN GOTO 6800 ELSE IF C0=-4 OR C0=-2 THEN GOTO 1120 ELSE C0=ABS(C0)
1320 A=NUM(A$(7+K9,7),ERR=1310),A$(7+K9,8)=STR(A:"0000000")+A$(14+K9,1)
1330 CALL "ZZDISP","A",A$(7+K9,8),"AR6",X3$,"","",16,4+V0,X4$
1340 GOTO 1120
1500 REM "
1505 Z9=-1
1510 A1$=K9$+A$(LEN(K9$)+1,14),A$(1,LEN(K9$))=K9$
1520 READ (Z[1],KEY=A1$,DOM=1600)IOL=0310
1525 T0=A[1]
1530 FIND (Z[3],KEY=A$(15+K9,10),DOM=1531)IOL=0330
1540 FIND (Z[5],KEY=A$(65+K9,2),DOM=1541)IOL=0350
1550 FIND (Z[8],KEY=A$(128+K9,5),DOM=1551)IOL=0380
1555 FIND (Z[9],KEY=A$(133+K9,4),DOM=1556)IOL=0390
1590 GOTO 1700
1600 REM "
1620 CALL "ZZPROM","2",X3$,Z,"","","",0; ON Z GOTO 1650,1630,6975
1630 GOTO 1000
1660 IF V9>=0 THEN GOSUB 6200
1690 GOTO 2000
1700 REM "
1790 GOSUB 6200
1800 REM "
1820 CALL "ZZPROM",STR(6+C9),X3$,Z,"","","V",X0; ON Z+1 GOTO 1850,1830,6500,7000,7000
1830 GOTO 2000
1850 REM "MODIFY
1855 X0=X0-1; IF Z9=1 THEN GOTO 1880 ELSE IF Z9=0 THEN Z9=1
1860 EXTRACT (Z[1],KEY=A1$,DOM=1870)IOL=0310
1865 C9=1
1870 GOSUB 6200
1890 GOTO 2020
2000 REM "Run Entry overlay
2010 C0=0,X0=-1,X1=1
2020 L0=4
2030 RUN "AR2DAB"
4000 REM "Routines to calculate and/or lookup values"
4500 REM "Get commission code from 1st salesperson"
4510 IF A$(133+K9,4)<>I$(1,4) THEN FIND (Z[9],KEY=A$(133+K9,4),DOM=4511)IOL=0390
4520 A$(128,5)=I$(219,5)
4540 RETURN 
5900 REM "REMOVE LINES
5905 GOTO 5990
5910 IF A0=0 THEN GOTO 5990
5920 EXTRACT (F,IND=0,ERR=5960)IOL=0290
5925 IF Y[4]=-2 THEN READ (F,IND=0); WAIT 0; GOTO 5920 ELSE Y[4]=-2; WRITE (F,IND=0)IOL=0290
5930 A1=Y[1],Y[1]=A0,Y[0]=Y[0]-1
5935 READ (F,IND=A0)A; IF A>0 THEN Y[0]=Y[0]-1,A0=A; GOTO 5935
5940 WRITE (F,IND=A0)A1
5950 Y[4]=-1; WRITE (F,IND=0)IOL=0290
5955 GOTO 5990
5960 IF ERR=0 THEN RETRY ELSE GOTO 9900
5990 RETURN 
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6060 PRINT @(3,3+V0),"Fiscal year:",@(29,3+V0),"Accounting period:",@(0,4+V0),"Invoice number:",@(33,4+V0),"Customer code:",@(0,5+V0),Z0$,@(3,6+V0),"Name:",
6065 CALL "ZY2AAA",X3$,X4$,0,7+V0,"B","",0,"","",0,0,0
6070 PRINT @(48,6+V0),"Terms code:",@(44,7+V0),"Sales tax code:",@(46,8+V0),"Invoice type:",@(62,8+V0),"Apply to:",@(46,9+V0),"Invoice date:",@(42,10+V0),"Our order number:",@(0,11+V0),"Cash sale?",@(13,11+V0),"Bank code:",@(39,11+V0),"Customer P/O number:",@(0,12+V0),Z0$,
6080 PRINT @(13,13+V0),"Net amount:",@(45,13+V0),"Invoice due date:",@(16,14+V0),"Freight:",@(44,14+V0),"Discount due date:",@(2,15+V0),"Exempt?",@(13,15+V0),"Taxable Sale",@(28,15+V0),"Sales Tax",@(46,15+V0),"Discount amount:",@(3,16+V0),"State:",@(57,16+V0),"Cost:",@(2,17+V0),"County:",@(48,17+V0),"Category code:",@(3,18+V0),"Local:",@(46,18+V0),"Commission code:",@(8,19+V0),"Sales Tax Total:",@(44,19+V0),"Commission amount:",@(45,20+V0),"Salesperson code:",@(25,20+V0),Z0$(1,LEN(M0$)),@(10,21+V0),"Invoice total:",
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6200 REM "DISPLAY DATA
6215 GOSUB 6450
6220 CALL "ZZDISP","A",A$(15+K9,10),"A/R",X3$,"","",48,4+V0,X4$
6222 PRINT @(9,6+V0),A$(25+K9,35),
6223 CALL "ZY2AAA",X3$,X4$,0,7+V0,"B","",1,C$(56,99),"",0,0,0
6224 PRINT @(11,11+V0),A$(60+K9,1),@(24,11+V0),A$(61+K9,4),@(60,6+V0),A$(65+K9,2),
6228 CALL "ZZDISP","A",A$(67+K9,10),"AR5",X3$,"","",60,7+V0,X4$
6232 PRINT @(60,8+V0),A$(77+K9,1),
6233 CALL "ZZDISP","A",A$(78+K9,8),"AR6",X3$,"","",71,8+V0,X4$
6236 CALL "ZZDISP","D",A$(86+K9,6),"",X3$,"","",60,9+V0,X4$
6240 PRINT @(60,10+V0),A$(92+K9,8),@(60,11+V0),A$(100+K9,15),@(25,13+V0),A[1]:M0$,@(27,14+V0),A[2]:M1$,@(10,15+V0),A$(115+K9,1),
6244 CALL "ZZDISP","D",A$(116+K9,6),"",X3$,"","",63,13+V0,X4$
6248 CALL "ZZDISP","D",A$(122+K9,6),"",X3$,"","",63,14+V0,X4$
6250 GOSUB 6300
6252 PRINT @(63,16+V0),A[11]:M0$,@(63,18+V0),A$(128+K9,5),@(65,19+V0),A[18]:M1$,
6253 CALL "ZZDISP","A",A$(153+K9,9),"ARG",X3$,"","",63,17+V0,X4$
6260 ON NUM(P2$(8,1)) GOTO 6290,6285,6280,6275,6270,6265
6265 IF POS(" "<>A$(149+K9,4))<>0 THEN PRINT @(63,22+V0),A$(149+K9,4),@(69),A[16]:M3$,
6270 IF POS(" "<>A$(145+K9,4))<>0 THEN PRINT @(48,22+V0),A$(145+K9,4),@(54),A[15]:M3$,
6275 IF POS(" "<>A$(141+K9,4))<>0 THEN PRINT @(63,21+V0),A$(141+K9,4),@(69),A[14]:M3$,
6280 IF POS(" "<>A$(137+K9,4))<>0 THEN PRINT @(48,21+V0),A$(137+K9,4),@(54),A[13]:M3$,
6285 IF POS(" "<>A$(133+K9,4))<>0 THEN PRINT @(63,20+V0),A$(133+K9,4),; IF P2$(8,1)<>"1" THEN PRINT @(69),A[12]:M3$,
6290 RETURN 
6300 REM "Display calculated amounts only"
6310 IF A$(115+K9,1)="Y" THEN PRINT @(13,16+V0),Z1$(1,25),@(13,17+V0),Z1$(1,25),@(13,18+V0),Z1$(1,25),@(27,19+V0),Z1$(1,11),; GOTO 6350
6320 IF A$(67+K9,2)<>Z1$(1,2) THEN PRINT @(13,16+V0),A[3]:M0$,@(27,16+V0),A[4]:M1$, ELSE PRINT @(13,16+V0),Z1$(1,25),
6330 IF A$(69+K9,4)<>Z1$(1,4) THEN PRINT @(13,17+V0),A[5]:M0$,@(27,17+V0),A[6]:M1$, ELSE PRINT @(13,17+V0),Z1$(1,25),
6340 IF A$(73+K9,4)<>Z1$(1,4) THEN PRINT @(13,18+V0),A[7]:M0$,@(27,18+V0),A[8]:M1$, ELSE PRINT @(13,18+V0),Z1$(1,25),
6345 PRINT @(27,19+V0),A[4]+A[6]+A[8]:M1$,
6380 PRINT @(25,21+V0),A[9]:M0$,@(65,15+V0),A[10]:M1$,
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>=0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6460 PRINT @(16,3+V0),A$(1+K9,4),@(48,3+V0),A$(5+K9,2),
6465 GOSUB 7700
6470 CALL "ZZDISP","A",A$(7+K9,8),"AR6",X3$,"","",16,4+V0,X4$
6490 RETURN 
6500 REM "DELETE
6505 GOSUB 5900
6510 REMOVE (Z[1],KEY=A1$,DOM=6511)
6520 REMOVE (Z[11],KEY=A1$,DOM=6521)
6590 GOTO 7200
6600 REM "ALT KEY DATA READS
6690 RETURN 
6700 REM "ADD ENTRY
6705 A[0]=A0
6710 WRITE (Z[1],KEY=A1$)IOL=0310
6780 ON Z9 GOTO 7000,6781
6785 GOTO 7200
6790 GOTO 1630
6800 REM "NEXT ENTRY IN FILE
6810 A1$=KEY(Z[1],END=6895)
6820 A$(1,LEN(A1$))=A1$
6825 IF A1$(1,LEN(K9$))<>K9$ THEN GOTO 1140
6830 GOSUB 6600
6835 GOSUB 6450
6890 GOTO 1515
6895 PRINT 'RB',; READ (Z[1],KEY=K9$,DOM=1140); GOTO 1140
7000 REM "RUN OVERLAY
7002 IF E[1]>1 THEN CALL "AR2DAC",X3$,X4$,"",A1$,A[9],A[10],A$(116,6),A$(122,6),E$,E[0],E[1],E[2] ELSE REMOVE (Z[11],KEY=A$(1,14),DOM=7003)
7009 Z$="10O GL1...  13O ARI...  "
7010 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 7011,7200
7011 X3$(15,6)=A$(86,6),L0=1,F=Z[2],A0=A[0],V1=0,V9=-2,V3=Z[10],T[0]=T0-A[1]
7014 PRINT (0,ERR=7015)@(0,6+V0),'CE','SB',
7015 PRINT @(3,6),"Name:",@(48),"Net Amount:",@(0,7),Z0$,
7016 PRINT (0,ERR=7017)'SF',
7020 PRINT @(9,6+V0),A$(25+K9,35),@(60),A[1]:M0$,
7030 IF A0=0 THEN GOSUB 8400 ELSE T9$=""
7050 RUN "GL2XAA"
7100 REM "RE-DO SCREEN AND RUN 2ND OVERLAY
7105 V0=0,M0$="-#,###,###.00",M1$="-###,###.00"
7110 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,0,0,0
7120 PRINT (0,ERR=7121)'SB',
7130 PRINT @(3,3+V0),"Fiscal year:",@(29,3+V0),"Accounting period:",@(0,4+V0),"Invoice number:",@(33,4+V0),"Customer code:",@(0,5+V0),Z0$,@(3,6+V0),"Name:",@(0,7+V0),Z0$,
7135 PRINT (0,ERR=7136)'SF',
7140 GOSUB 6450
7190 GOTO 7020
7200 REM "Return from lines
7210 Z$="10C GL1...  13C ARI...  "
7220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 7221,7221
7225 C9=-1,V0=0,M0$="-#,###,###.00",M1$="-###,###.00"
7230 PRINT @(0,6+V0),'CE',
7250 GOTO 1630
7400 REM "Audit already run
7410 FIND (Z[1],KEY="",DOM=7490)V0$,K0$
7420 IF K0$>"" THEN CALL "ZZPROM","4",X3$,S3,"The update has already been initiated. Press |Return>","","",0; GOTO 9900
7430 EXTRACT (Z[1],KEY="",ERR=9800)
7440 Q$="Audit report "+V0$(22,4)+"."+V0$(26,2)+" has already been printed for this data entry."
7445 PRINT @(6,22),Q$,; CALL "ZZPROM","1",X3$,S3,"","","",0; ON S3 GOTO 9800,7446
7450 REMOVE (Z[1],KEY="")
7490 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7600 REM "Set info based on customer file"
7611 REM "Set invoice date & type(7615), customer info(7620), calculated info(7630)
7615 A$(86+K9,6)=D0$,A$(77+K9,1)="I",A$(60,1)="N"; IF C$(245,1)="Y" THEN A$(115+K9,1)="Y" ELSE A$(115+K9,1)="N"
7620 A$(25+K9,35)=C$(11,35),A$(65,2)=C$(359,2),A$(67,10)=C$(235,10),A$(133,20)=C$(278,20),A[12]=C[0],A[13]=C[1],A[14]=C[2],A[15]=C[3],A[16]=C[4],A$(153,9)=C$(220,9)
7630 GOSUB 4500
7640 GOSUB 8300
7670 GOSUB 6200
7680 IF C0<>2 THEN X0=X0+7
7690 RETURN 
7700 REM "PRINT P/E DATE"
7720 PRINT @(53,3+V0),"Ending ",FND$(P1$(NUM(A$(5+K9,2))*6+15,6)),
7749 RETURN 
7800 REM "GET G/L Z MASK
7810 CALL "ZZDISP","AX","000000000000","G/L",X3$,W2$,"",0,0,X4$
7815 M2=0; FOR X=1 TO LEN(W2$); M2=M2+POS("0"=W2$(X,1)); NEXT X
7850 REM "Set Fiscal year & period"
7860 FIND (Z[6],DOM=8900,KEY=X3$(9,3)+"A/R")P0$
7870 FIND (Z[6],DOM=8900,KEY=X3$(9,3)+"G/LYE"+P0$(7,4))P1$
7880 A1$=P0$(7,6)
7890 RETURN 
7900 REM "Check for 100% addition
7905 IF POS(" "<>A$(133+K9,20))=0 THEN RETURN 
7907 T6=0,T7=-1
7910 FOR I=0 TO NUM(P2$(8,1))-1
7915 IF A$(133+I*4,4)="    " THEN A[I+12]=0; GOTO 7940
7920 T7=I,T6=T6+A[I+12]
7940 NEXT I
7945 IF T7=-1 THEN GOTO 7990 ELSE IF T6=100 THEN GOTO 7990
7950 A[T7+12]=A[T7+12]+100-T6
7960 IF P2$(8,1)="1" THEN GOTO 7990 ELSE ON T7 GOTO 7965,7970,7975,7980,7985
7965 PRINT @(69,19+V0),A[12]:M3$,; GOTO 7990
7970 PRINT @(54,20+V0),A[13]:M3$,; GOTO 7990
7975 PRINT @(69,20+V0),A[14]:M3$,; GOTO 7990
7980 PRINT @(54,21+V0),A[15]:M3$,; GOTO 7990
7985 PRINT @(69,21+V0),A[16]:M3$,
7990 RETURN 
8000 REM " move salesperson codes up
8010 IF POS(" "<>A$(129+S0*4+K9,4))<>0 THEN RETURN 
8020 FOR I=S0-1 TO 3
8030 I0=K9+I*4,A$(133+I0,4)=A$(137+I0,4),A[I+12]=A[I+13]
8035 NEXT I
8040 PRINT @(63,20+V0),'CL',@(48,21+V0),'CL',@(48,22+V0),'CL',
8042 GOSUB 6255
8045 RETURN 
8300 REM "CALC DUE DATE
8305 IF E$(1,2)<>A$(65+K9,2) THEN DIM E[54],E[3]; FIND (Z[5],KEY=A$(65+K9,2),DOM=8306)IOL=0350
8310 CALL "ZZDISC",X3$,E$,0,0,A$(86+K9,6),Q0$,Q1$,0,0
8315 A$(116+K9,6)=Q0$,A$(122+K9,6)=Q1$
8320 CALL "ZZDISP","D",A$(116+K9,6),"",X3$,"","",63,13+V0,X4$
8325 CALL "ZZDISP","D",A$(122+K9,6),"",X3$,"","",63,14+V0,X4$
8345 RETURN 
8400 REM "Set up T9$, and T() for default lines
8405 DIM Q8$(9)
8410 IF P0$(19,1)<>"Y" THEN Q8$(1)=A$(15,2) ELSE Q8$(1)=A$(153,9)
8420 IF Q8$(1,9)<>Q9$(1,9) THEN DIM Q9$(202); Q9$(1,9)=Q8$; FIND (Z[13],KEY=Q8$,DOM=8421)Q9$
8430 T9$=Q9$(94,12)+Q9$(106,12)+Q9$(118,12),T[1]=-A[1],T[2]=A[11],T[3]=-A[11]
8440 T[0]=T[1]+T[2]+T[3]
8490 RETURN 
8900 REM "
8910 CALL "ZZPROM","4",X3$,S3,"Check the parameters for this company. Press |Return to continue","","",0; GOTO 9900
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
