0010 REM "Export A/R Invoices  - Stratacom - Generic Format-all fields <AR2XID>
0020 SETESC 9300; SETERR 9000
0035 REM "5.5 - 07/06/06 - 17.720833 - bam - SSP# 197292
0037 REM "197292-program exception when clearing summary bill                
0040 REM "Copyright 2006 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0070 REM "FILES[] 0=EXP ASCII file
0072 REM "OPTION$ = Option routine to perform
0073 REM "SUMBIL$ = Summary bill number
0074 REM "FMYREC$ = FMY Record
0075 REM "SHIPTO$ = Ship to Record
0076 REM "EXAMT[] = Export amounts passed for ASCII record;REM "0,1,2
0077 REM "0=Freight, 1=Tax, 2=Extended value of goods
0078 REM "FMY[]   = FMY Numeric Array
0079 REM "EXPTOT[]= Totals for EXP
0080 REM "0=Total Freight, 1=Total Tax, 2=Total Sum Bill, 3=Count
0081 REM "4=       , 5=
0082 REM "CH_ZZPARM =Channel number for ZZPARM file
0083 REM "DETREC$ = Detail record built from Item & Special Charges
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,FILES{ALL},OPTION$,SUMBIL$,FMYREC$,SHIPTO$,EXAMT{ALL},FMY{ALL},EXPTOT{ALL},CH_ZZPARM,DETREC$
0100 SETERR 9000
0105 PRECISION 4
0110 X0$="AR2XID",X1$="Export A/R Invoice Information"
0115 SEP$=","
0120 IF FN%NEA("FILES",0)=0 THEN DIM FILES[9]
0140 IF FN%NEA("EXPTOT",0)=0 THEN DIM EXPTOT[5]
0200 REM "Set data paths & file names
0205 READ (CH_ZZPARM,KEY=X3$(9,3)+"A/R",DOM=0206)AR_PARMS$
0210 DATA_PATH$=%DATAPATH$
0220 EXP_PATH$=STP(AR_PARMS$(181,60),1," ")
0221 ! 
0222 ! note STP(...) on line 220 ssp# 197292
0223 ! 
0224 IF EXP_PATH$="" THEN EXP_PATH$=%DATAPATH$+DLM ! ssp# 197292
0225 IF MID(EXP_PATH$,-1)<>DLM THEN EXP_PATH$+=DLM ! ssp# 197292
0230 DATENO=FN%DTN(FND$(X3$(15,6)),"MMDDYY")
0250 REM "Set File Name
0260 EXP_FILE$="SB"+STP(SUMBIL$,1); REM SSP
0261 REM "EXP_FILE$=STR(0:"00000"); REM SSP 190893
0300 REM "Iolists
0310 IOLIST CUST_DIV$,CUST_CODE$,INV_NUM$,SEQ_NUM$,SHIPPING_PT$,INV_DATE$,SUMMARY_BILL$,INV_PRINTED$,FMY_UNUSED_1$,CUST_PO$,ORDER_DIV$,ORDER_NUM$,SHIP_VIA_DESC$,ORDER_TYPE$,INV_LINE_TYPE$,ITEM_CUST_DIV$,ITEM_CUST_CODE$,ITEM_CODE$,ITEM_DESC$,SHIP_FROM$,SELL_UM$,PREV_PR$,TAXABLE$,ORDER_LINE_NUM$,LOC_TYPE$,LOC_CODE$,PRICE_NOT_EQUAL_EXT$,STARTING_NUM$,ENDING_NUM$,SHIP_DATE$,INV_FY$,INV_ACCTPD$,COST_CODE$,MONTHLY_PRINT$,MONTHLY_UPDATE_FLAG$,FMY_UNUSED_2$,RECVG_DEPT$,BILLING_DEPT$,UNUSED_1$,CITY$,STATE$,ORDERED_BY$,UNUSED$,ATTN$,RC$,UNUSED_2$,SELL_QTY_PER,QTY_SHIPPED,UNIT_PRICE,EXT,EXT_VALUE,PRORATED_FRT,PRORATED_STAX,PRORATED_SPEC_CHG,FMS_PRICE,FMS_EXT,FMY_UNUSED_5
0311 IOLIST CUST_DIV$+SEP$+CUST_CODE$+SEP$+INV_NUM$+SEP$+SEQ_NUM$+SEP$+SHIPPING_PT$+SEP$+INV_DATE$+SEP$+SUMMARY_BILL$+SEP$+INV_PRINTED$+SEP$+FMY_UNUSED_1$+SEP$+CUST_PO$+SEP$+ORDER_DIV$+SEP$+ORDER_NUM$+SEP$+SHIP_VIA_DESC$+SEP$+ORDER_TYPE$+SEP$+INV_LINE_TYPE$+SEP$+ITEM_CUST_DIV$+SEP$+ITEM_CUST_CODE$+SEP$+ITEM_CODE$+SEP$+ITEM_DESC$+SEP$+SHIP_FROM$+SEP$+SELL_UM$+SEP$+PREV_PR$+SEP$+AXABLE$+SEP$+ORDER_LINE_NUM$+SEP$+LOC_TYPE$+SEP$+LOC_CODE$+SEP$+PRICE_NOT_EQUAL_EXT$+SEP$+STARTING_NUM$+SEP$+ENDING_NUM$+SEP$+SHIP_DATE$+SEP$+INV_FY$+SEP$+INV_ACCTPD$+SEP$+COST_CODE$+SEP$+MONTHLY_PRINT$+SEP$+MONTHLY_UPDATE_FLAG$+SEP$+FMY_UNUSED_2$+SEP$+RECVG_DEPT$+SEP$+BILLING_DEPT$+SEP$+UNUSED_1$+SEP$+CITY$+SEP$+STATE$+SEP$+ORDERED_BY$+SEP$+UNUSED$+SEP$+ATTN$+SEP$+RC$+SEP$+UNUSED_2$+SEP$+STR(SELL_QTY_PER)+SEP$+STR(QTY_SHIPPED)+SEP$+STR(UNIT_PRICE)+SEP$+STR(EXT)+SEP$+STR(EXT_VALUE)+SEP$+STR(PRORATED_FRT)+SEP$+STR(PRORATED_STAX)+SEP$+STR(PRORATED_SPEC_CHG)+SEP$+STR(FMS_PRICE)+SEP$+STR(FMS_EXT)+SEP$+STR(FMY_UNUSED_5)
0400 REM "Check for files, if not there then create
0401 REM "if array values <>0 then we've already done this
0410 REM "IF FILES[0]<>0 THEN GOTO 0600
0440 REM "CLOSE (14); ERASE EXP_PATH$+"SB"+EXP_FILE$,ERR=0441; GOTO 0450; REM SSP 190893
0450 SERIAL EXP_PATH$+EXP_FILE$,0,0,ERR=0451; GOTO 0460
0451 REM "EXP_FILE$=STR(NUM(EXP_FILE$)+1:"00000"); GOTO 0450
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]
0510 REM "Z$="02O "+EXP_PATH$+EXP_FILE$
0520 REM "CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ESCAPE ; ON Z0 GOTO 0521,9900
0524 REM "Close and re-open as text files then save file slots in FILES[]
0530 REM "CLOSE (Z[2]); OPEN LOCK (Z[2],OPT="TEXT")EXP_PATH$+EXP_FILE$; FILES[0]=Z[2]
0531 CLOSE (14); OPEN LOCK (14,OPT="TEXT")EXP_PATH$+EXP_FILE$; REM "FILES[0]=Z[2];REM SSP 190893
1000 REM "CALL TO CREATE FILE, ETC
1010 REM "CALL "UT2EXF","FMY"
1020 CUST_DIV$=FMYREC$(1,2)
1022 CUST_CODE$=FMYREC$(3,8)
1024 INV_NUM$=FMYREC$(11,8)
1026 SEQ_NUM$=FMYREC$(19,3)
1028 SHIPPING_PT$=FMYREC$(22,1)
1030 INV_DATE$=FN%FMT_TFDATE$(FMYREC$(23,6),"MM/DD/YY")
1040 SUMMARY_BILL$=FMYREC$(29,1)
1042 INV_PRINTED$=FMYREC$(30,1)
1044 FMY_UNUSED_1$=FMYREC$(31,3)
1046 CUST_PO$=FMYREC$(34,15)
1048 ORD_DIV$=FMYREC$(49,2)
1049 ORD_NUM$=FMYREC$(51,6)
1050 SHIP_VIA_DESC$=FMYREC$(57,15)
1052 ORDER_TYPE$=FMYREC$(72,1)
1054 INV_LINE_TYPE$=FMYREC$(73,1)
1056 ITEM_CUST_DIV$=FMYREC$(74,2)
1068 ITEM_CUST_CODE$=FMYREC$(76,8)
1070 ITEM_CODE$=FMYREC$(84,10)
1072 ITEM_DESC$=SUB(FMYREC$(94,40),","," ")
1074 SHIP_FROM$=FMYREC$(134,4)
1076 SELL_UM$=FMYREC$(138,4)
1078 PREV_PR$=FMYREC$(142,1)
1080 TAXABLE$=FMYREC$(143,1)
1082 ORDER_LINE_NUM$=FMYREC$(144,3)
1084 LOC_TYPE$=FMYREC$(147,1)
1086 LOC_CODE$=FMYREC$(148,4)
1088 PRICE_NOT_EQUAL_EXT$=FMYREC$(152,1)
1090 STARTING_NUM$=FMYREC$(153,9)
1092 ENDING_NUM$=FMYREC$(162,9)
1094 SHIP_DATE$=FN%FMT_TFDATE$(FMYREC$(171,6),"MM/DD/YY")
1100 INV_FY$=FMYREC$(177,4)
1102 INV_ACCTPD$=FMYREC$(181,2)
1104 COST_CODE$=FMYREC$(183,9)
1106 MONTHLY_PRINT$=FMYREC$(192,1)
1108 MONTHLY_UPDATE_FLAG$=FMYREC$(193,1)
1110 FMY_UNUSED_2$=FMYREC$(194,32)
1112 RECVG_DEPT$=FMYREC$(226,20)
1114 BILLING_DEPT$=FMYREC$(246,20)
1116 UNUSED_1$=MID(FMYREC$,266,30)
1118 CITY$=FMYREC$(296,16)
1120 STATE$=FMYREC$(312,2)
1122 ORDERED_BY$=FMYREC$(314,20)
1124 UNUSED$=FMYREC$(334,1)
1126 ATTN$=FMYREC$(335,30)
1128 RC$=FMYREC$(365,20)
1130 UNUSED_2$=FMYREC$(386,125)
1132 SELL_QTY_PER=FMY[0]
1134 QTY_SHIPPED=FMY[1]
1136 UNIT_PRICE=FMY[2]
1138 EXT=FMY[3]
1140 EXT_VALUE=FMY[4]
1142 PRORATED_FRT=FMY[5]
1144 PRORATED_STAX=FMY[6]
1146 PRORATED_SPEC_CHG=FMY[7]
1148 FMS_PRICE=FMY[8]
1150 FMS_EXT=FMY[9]
1152 FMY_UNUSED_5=FMY[10]
1155 RECORD$=""
1160 RECORD$=CUST_DIV$+SEP$+CUST_CODE$+SEP$+INV_NUM$+SEP$+SEQ_NUM$+SEP$+SHIPPING_PT$+SEP$+INV_DATE$+SEP$+SUMMARY_BILL$+SEP$+INV_PRINTED$+SEP$+FMY_UNUSED_1$+SEP$+CUST_PO$+SEP$+ORD_DIV$+SEP$+ORD_NUM$+SEP$+SHIP_VIA_DESC$+SEP$+ORDER_TYPE$+SEP$+INV_LINE_TYPE$+SEP$+ITEM_CUST_DIV$+SEP$+ITEM_CUST_CODE$+SEP$+ITEM_CODE$+SEP$+ITEM_DESC$+SEP$+SHIP_FROM$+SEP$+SELL_UM$+SEP$+PREV_PR$+SEP$+TAXABLE$+SEP$+ORDER_LINE_NUM$+SEP$+LOC_TYPE$+SEP$+LOC_CODE$+SEP$+PRICE_NOT_EQUAL_EXT$+SEP$+STARTING_NUM$+SEP$+ENDING_NUM$+SEP$+SHIP_DATE$+SEP$+INV_FY$+SEP$+INV_ACCTPD$+SEP$+COST_CODE$+SEP$+MONTHLY_PRINT$+SEP$+MONTHLY_UPDATE_FLAG$+SEP$+FMY_UNUSED_2$+SEP$+RECVG_DEPT$+SEP$+BILLING_DEPT$+SEP$+UNUSED_1$+SEP$+CITY$+SEP$+STATE$+SEP$+ORDERED_BY$+SEP$+UNUSED$+SEP$+ATTN$+SEP$+RC$+SEP$+UNUSED_2$+SEP$+STR(SELL_QTY_PER)+SEP$+STR(QTY_SHIPPED)+SEP$+STR(UNIT_PRICE)+SEP$+STR(EXT)+SEP$+STR(EXT_VALUE)+SEP$+STR(PRORATED_FRT)+SEP$+STR(PRORATED_STAX)+SEP$+STR(PRORATED_SPEC_CHG)+SEP$+STR(FMS_PRICE)+SEP$+STR(FMS_EXT)+SEP$+STR(FMY_UNUSED_5)
1165 PRINT (14)RECORD$+$0D$
1200 GOTO 9900
8000 REM "Define functions
8955 DEF FND$(Z9$)=Z9$(3,4)+STR(MOD((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)),100):"0#")
8960 DEF FNE$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR(MOD(ASC(Z9$(1,1))-65,10)*10+NUM(Z9$(2,1)):"00")
9000 REM "Error Processing
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM "Transfer Control
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "Ctrl Logic
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "End Program
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56010 REM "5.4 - 04/04/06 - 14.993888 - lms - SSP# 190893
56011 REM "190893-Change the file name on the Summary Bill files that are     
56020 REM "5.5 - 06/23/06 - 14.160277 - bam - SSP# 197292
56021 REM "197292-program exception when clearing summary bill                
