0010 REM "Collect CFSTEPHENS Commission Data <AR2YZA>
0035 REM "3.5 - 12/16/91 - 13.38
0040 REM "Copyright 1991 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0120 ENTER X3$,X4$,A0$
0125 IF LEN(A0$)<2 THEN EXIT 36
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9]
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O FMY...  02O U01... "; GOSUB 9700
0610 DIM C0$(9*10)
0620 C0$(1)="COMM"
0625 C0$(11)="REQ"
0630 C0$(21)="LINE"
0635 C0$(31)="FRTAIR"
0640 C0$(41)="FREIGHT"
0645 C0$(51)="IMPRINT"
0650 C0$(61)="COMP"
0655 C0$(71)=""
0990 READ (Z[1],KEY=A0$,DOM=0991)
0995 DIM A[6]
1000 REM "PROCESS FMY
1020 K$=KEY(Z[1],END=5000); READ (Z[1],END=5000)IOL=0310
1040 IF A$(1,LEN(A0$))<>A0$ THEN GOTO 5000
1045 PRINT @(0,22),"PROCESSING: ",A$(1,22),
1090 REM "A$(84,10)=SPECIAL CHARGE CODE
1100 REM "NEW INVOICE NUMBER?
1110 IF B$="" THEN GOTO 1190 ELSE IF B$(1,7)=A$(11,7) THEN GOTO 1200
1150 REM "WRITE LINE
1160 GOSUB 7500
1190 DIM B$(42),B[9]
1195 B$(1,7)=A$(11,7),B$(8,10)=A$(1,10),B$(18,8)=A$(49,8),B$(36,6)=A$(171,6)
1197 READ (Z[2],KEY=B$(1,7),DOM=1198)IOL=0320
1200 REM "PROCESS RECORD
1210 IF A$(84,3)="ART" THEN A$(84,4)="COMP"
1220 P=POS(A$(84,10)=C0$,10)
1225 IF P=0 THEN P=9 ELSE P=2+INT(P/10)
1400 REM 
1410 IF A$(73,1)<>"S" THEN B[9]=B[9]+A[3]; GOTO 1450
1420 B[P]=B[P]+A[3]
1450 REM "FREIGHT TOTALS
1451 REM "ALSO ADDED TAX (IF ANY)
1460 B[6]=B[6]+A[5]+A[6]
1470 IF P=2 THEN B[0]=B[0]+A[1]
1820 REMOVE (Z[1],KEY=K$)
1890 GOTO 1000
5000 REM "END
5020 IF B$>"" THEN GOSUB 7500
5090 GOTO 9900
7500 REM "FLUSH RECORD
7510 T0=0; FOR X=2 TO 9; T0=T0+B[X]; NEXT X; B[1]=T0
7520 WRITE (Z[2],KEY=B$(1,7))IOL=0320
7590 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 Y8=2
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
