0010 REM "A/R Open Invoice Report <AR2RAB>
0035 REM "5.3 - 07/22/04 - 17.362222 - lms - SSP# 172299
0040 REM "Copyright 2004 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0042 REM "Option to print all columns if past due - 9/22/90
0043 REM "OPTION TO PRINT TERMS DESCR - CFSTEPHENS 4/2/91
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0105 SETERR 9000; SETESC 9300
0110 X0$="AR2RAB",X1$="Open Invoice Report"
0120 DIM A$(139),A[12],B[3],C$(398),C[15],P[8],J[8],D[1]
0125 DIM S$(20)
0140 Z0$="##,###,###.00-",Z1$="#,###,###.00-",Z2$="##,###,###",Z3$="-#,###,###.00%"
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
0175 DEF FNS$(Z9$)=Z9$(1,POS("     "=Z9$+"     ")-1)
0210 T=1,T0=0,T1=6
0220 W3=131
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3)
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0300 REM "I/O lists
0305 REM "IOLIST FOR AR6 - Open Invoice Header File
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12]
0315 REM "IOLIST FOR AR7 - Invoice Detail
0320 IOLIST B$,B[0],B[1]; REM " 124844 ,B[2],B[3]
0325 REM "IOLIST FOR AR1 - Customer Masterfile
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15]
0340 IOLIST D0,D$,D(1),D(2)
0360 IOLIST P$,P[0],P[1],P[2],P[3],P[4],P[5],P[6],P[7],P[8]
0420 IOLIST X3$,X4$,V1$,V3$,V2$,V0$
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0510 Y$="01O AR6...  02O AR7...  03O AR1...  04O ARN...  05O AR3...  06O ZZPARM  07O AR2...  08O FS8...  09O FS6...  10O FM1...  11O IC0...  12O ASJ... 15O AR9... 20O AXM...  "; REM "13 in use by V0=4, see 8400's-153690-AR9
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0600 REM "read parameters"
0602 REM "IF V0$(91,1)="Y" THEN W3=213; REM " SSP 172299
0610 READ (Z[6],KEY=X3$(9,3)+"A/R",DOM=9900)IOL=0360
0612 REM "P[2]=P[3],P[3]=P[4],P[4]=0
0613 P[0]=0,P[1]=30,P[2]=60,P[3]=90
0619 REM "Setup aging"
0620 GOSUB 4100
0650 SUMOFFSET=8
0700 REM "Open Printer
0720 REM 
0800 REM "Alternate Sort Info & total dim"
0805 DIM U0$(4)
0810 ON V0 GOTO 0820,0820,0830,0850,0840,0850,0860
0820 DIM U[1]; U=10,U0=1,U[0]=0,U[1]=10,T0=2,V1=2,V2=8,U0$="Y   ",T5$="S   AA/R        ",U5$="Division",U6$="Customer",X1$=X1$+" by Customer"; GOTO 0860
0830 DIM U[2]; U=14,U0=2,U[0]=0,U[1]=4,U[2]=10,T0=3,V1=4,V2=2,V3=8,U0$="Y   ",T5$="S   S   AA/R        ",U5$="Salesperson",U6$="Division",U7$="Customer",X1$=X1$+" for "; GOTO 0860
0840 DIM U[2]; U=14,U0=2,U[0]=0,U[1]=10,U[2]=4,T0=3,V1=2,V2=8,V3=4,U0$="Y   ",T5$="S   AA/RS       ",U5$="Division",U6$="Customer",U7$="Ship to ",X1$=X1$+" by Shipto"; GOTO 0860
0850 DIM U[4]; U=22,U0=3,U[0]=0,U[1]=4,U[2]=10,U[3]=8,T0=4,V1=4,V2=10,V3=8,U0$="YY  ",T5$="S   AA/RS           ",U5$="Salesperson",U6$="Division",U7$="Customer",U8$="Summary Bill:",X1$=X1$+" by Summary Bill   "
0860 DIM T[T0,T1]
0870 V5=V1+1,V6=V5+V2,V7=V6+V3
0890 IF V0=4 THEN GOSUB SHIP_TO_SORT
0891 IF V0=5 THEN GOSUB 8600
0895 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W8$,W9$,W0,W9,W2,W3,W4; ON W4 GOTO 0896,9920
0900 REM " Position read"
0905 REM "set key file to read from"
0910 CALL "ZZFLES",X3$,Y1$,Y0$,"00O "+V1$+"  ",Z{ALL},Z0,0; IF Z0>0 THEN GOTO 9900 ELSE U1=Z[0]
0930 IF LEN(V2$)>=U*2 THEN GOTO 0965
0934 REM "create default 'all' range key
0935 DIM V2$(U*2),V4$(U,"~"); U3=1
0940 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1]
0950 V2$(U3+U[U9],U[U9])=V4$(1,U[U9])
0955 NEXT U9
0964 REM "Get starting key from range key
0965 DIM V4$(U); U3=1,U4=1
0970 FOR U9=1 TO U0; U3=U3+U[U9-1]+U[U9-1],U4=U4+U[U9-1]
0975 V4$(U4,U[U9])=V2$(U3,U[U9])
0980 NEXT U9
0985 V4$(U,1)=CHR(ASC(V4$(U,1))-1)
0990 READ (U1,KEY=V4$,DOM=0991)
1000 REM "Read next record
1005 U$=KEY(U1,END=5000); READ (U1)
1008 REM "check key against range info"
1009 U3=1,U2=1
1010 FOR U9=1 TO U0; U2=U2+U[U9-1],U3=U3+U[U9-1]+U[U9-1]
1020 IF U$(U2,U[U9])>=V2$(U3,U[U9]) THEN GOTO 1030 ELSE EXTRACT (U1,KEY=U$(1,U2-1)+V2$(U3,U[U9]),DOM=1021)
1025 EXITTO 1000
1030 IF U$(U2,U[U9])<=V2$(U3+U[U9],U[U9]) THEN GOTO 1040 ELSE READ (U1,KEY=U$(1,U2-1)+$FF$,DOM=1032)
1035 EXITTO 1000
1040 NEXT U9
1045 REM "IF V0=1 THEN GOTO 1090 ELSE IF V0=5 THEN GOTO 1100
1050 U9$=U$
1055 DIM G$(244); READ (Z[5],KEY=U9$(1,4),DOM=1056)G$
1060 REM "READ (Z[4],KEY=U$(5,10),DOM=1061)
1065 REM "U$=KEY(Z[4],END=1000); READ (Z[4])
1070 REM "IF U$(1,10)<>U9$(5,10) THEN GOTO 1000
1075 REM "U$=U$(1,10)+U$(18,8)
1080 REM "READ (Z[1],KEY=U$,DOM=1065)IOL=0310; GOTO 1151
1090 REM "U$=U$(5,10)+U$(11,8)
1100 REM "Get record"
1110 U9$=U$
1120 REM "IF V0=4 THEN U$=U9$(1,10)+U9$(15); GOTO 1150
1121 IF V0=5 THEN U$=U9$(5,10)+U9$(23,8); GOTO 1150
1150 READ (Z[1],KEY=U$,DOM=1000)IOL=0310
1155 IF V0$(71,1)="3" AND POS("C"=V0$(59,12))<>0 AND (A$(108,9)<V2$(21,9) OR A$(108,9)>V2$(30,9)) THEN GOTO 1000
1160 IF V0$(71,1)="3" THEN READ (Z[3],KEY=A$(1,10),DOM=1000)X$; IF X$(220,9)<V2$(21,9) OR X$(220,9)>V2$(30,9) THEN READ (Z[1],KEY=A$(1,10)+$FF$,DOM=1000)
1180 IF POS(" "<>V0$(84,6))>0 THEN GOSUB 7500
1200 REM "Age invoice and check to see if print
1210 IF V0$(81,1)<>"Y" THEN IF V0=1 AND POS("F"=V0$(59,12))<>0 AND A$(19,1)="F" THEN GOTO 1000 ELSE IF V0$(81,1)<>"Y" THEN IF V0=2 AND POS("F"=V0$(59,12))<>0 AND A$(19,1)="F" THEN GOTO 1065
1220 GOSUB 4500
1225 IF V0$(59,1)="A" AND A5>1 AND F9=1 THEN GOTO 1235
1230 IF V0=2 AND (A2<A5 OR (V0$(80,1)<>"Y" AND A[3]=0)) THEN GOTO 1065 ELSE IF A2<A5 OR (V0$(80,1)<>"Y" AND A[3]=0) THEN GOTO 1000
1232 IF V0$(59,1)="A" AND A5>1 THEN F9=1; READ (U1,KEY=U9$,DOM=1005)
1235 IF V0<>5 THEN GOTO 1240
1237 IF A[3]=0 THEN IF V0$(80,1)<>"Y" THEN GOTO 1065 ELSE GOTO 1300
1240 IF A[3]=0 THEN IF V0$(80,1)<>"Y" THEN GOTO 1000
1300 REM "Read other data
1305 TERM$=""; REM " SSP# 146930
1330 IF MID(V0$,90,1)="O" THEN READ (Z[7],KEY=A$(51,2),DOM=1331)TERM$; REM " SSP# 146930              
1331 IF MID(V0$,90,1)="O" AND MID(TERM$,57,1)="Y" THEN GOTO 1332 ELSE IF MID(V0$,90,1)="O" AND MID(TERM$,57,1)<>"Y" AND V0=5 THEN GOTO 1065 ELSE IF MID(V0$,90,1)="O" AND MID(TERM$,57,1)<>"Y" AND V0<>5 THEN GOTO 1000; REM " SSP# 146930
1340 IF MID(V0$,90,1)="N" THEN READ (Z[7],KEY=A$(51,2),DOM=1341)TERM$; IF MID(TERM$,57,1)="Y" AND V0=5 THEN GOTO 1065 ELSE IF MID(TERM$,57,1)="Y" THEN GOTO 1000; REM " SSP# 146930                                 
1360 IF U9$<>"" THEN U1$=U9$(1,V1)
1400 REM "Subtotals"
1415 GOSUB 3100
1416 IF V0$(59,1)="A" AND A5>1 AND F9=2 THEN F9=0; IF V0=1 THEN U2$=""; READ (U1,KEY=U9$,DOM=1000) ELSE U3$=""; EXTRACT (U1,KEY=U9$,DOM=1000); GOTO 1000
1417 IF V0=5 THEN ON T GOTO 1470,1430,1490,1440,1450,1450
1420 REM "ON T GOTO 1470,1430,1440,1450,1460
1430 GOSUB 6200
1443 DIM C$(LEN(C$)); IF V0$(81,1)<>"Y" THEN FIND (Z[3],DOM=1444,KEY=A$(1,10))IOL=0330 ELSE EXTRACT (Z[3],DOM=1444,KEY=A$(1,10))IOL=0330
1444 GOSUB 6200
1445 GOSUB 6300
1490 T=0
1500 REM "Print Data
1510 IF A$(11,7)="ONACCNT" THEN O$=A$,O1=A[1],O2=A[2],O3=A[3],O6=A[6]; GOTO 1995
1520 GOSUB 7700
1910 REM "T[T0,1]=T[T0,1]+A[0],T[T0,2]=T[T0,2]+A[1],T[T0,3]=T[T0,3]+A[2],T[T0,4]=T[T0,4]+A[6],T[T0,5]=T[T0,5]+A[7],T[T0,6]=T[T0,6]+A[8]
1990 REM "T[T0,0]=T[T0,0]+1
1995 IF V0=2 THEN GOTO 1065 ELSE GOTO 1000
2000 REM "Print Lines or Detail"
2005 REM "IF A[1]<1 AND A[3]<>A[2] THEN LET X5=A[2]; GOSUB 02700 ELSE LET X5=0                                                                   
2010 X3=A[1],T4=0,X5=A[6],FLAG$="",SEQ$=""
2014 IF A$(11,7)="ONACCNT" THEN X5=O6
2015 GOSUB 2500
2016 IF A(1)<=0 AND A(3)=A(2) THEN RETURN 
2020 IF FLAG$="END" THEN B$=""; RETURN 
2030 CALL "AR2XAB",X3$,X4$,Z[2],A$,X3,B$,B{ALL},FLAG$,SEQ$,"R"
2032 IF SEQ$<>"" AND FLAG$="END" THEN B$=""; GOSUB 2700; RETURN 
2033 IF FLAG$="NONE" THEN B$=""; RETURN 
2034 IF B$(1,18)<>A$(1,18) THEN B$=""; GOSUB 2700; RETURN 
2035 IF POS(" "<>V0$(84,6))>0 THEN IF B$(40,6)>V0$(84,6) THEN GOTO 2020
2040 REM "Read Secondary Information"
2200 REM "Print Each Line
2205 T4=T4+1
2210 IF W+1>W0 THEN GOSUB 6000; GOSUB 2500
2215 IF X3$(69,1)<>"Y" THEN Y5$(13+SUMOFFSET)=FND$(B$(20,6)) ELSE CALL "ZZDISP","DX",B$(20,6),"   ",X3$,X$,"",0,0,X4$; Y5$(13+SUMOFFSET)=X$
2220 ON POS(B$(19,1)="PACD") GOTO 2245,2225,2230,2235,2240
2225 Y5$(25+SUMOFFSET)="Chk:"; GOTO 2245
2230 Y5$(25+SUMOFFSET)="Adj:"; GOTO 2245
2235 Y5$(25+SUMOFFSET)=" CM:"; GOTO 2245
2240 Y5$(25+SUMOFFSET)=" DM:"
2245 Y5$(30+SUMOFFSET)=B$(26,8),Y5$(A1+SUMOFFSET)=STR(B[0]-B[1]:Z1$),X5=X5+B[0]-B[1]
2250 GOSUB 7300
2260 IF B[1]<>0 THEN Y5$(25+SUMOFFSET)="Discount allowed",Y5$(A1+SUMOFFSET)=STR(B[1]:Z1$),X5=X5+B[1]; GOSUB 7300
2400 REM "Accumulate Line Totals"
2410 IF SEQ$="" AND FLAG$="END" THEN B$=""; GOSUB 2700; RETURN 
2499 GOTO 2020
2500 REM "Line Header
2690 RETURN 
2700 REM "Line Totals"
2701 IF T4<1 THEN GOTO 2795
2702 IF W+2>W0 THEN GOSUB 6000
2705 IF X5<>A[3] THEN Y5$(25+SUMOFFSET)="Cleared detail",Y5$(A1+SUMOFFSET)=STR(A[3]-X5:Z1$); GOSUB 7300
2710 Y5$(A1+SUMOFFSET)=T1$(1,LEN(Z1$)); GOSUB 7300
2720 Y5$(A1+SUMOFFSET)=STR(A[3]:Z1$); GOSUB 7300
2790 GOSUB 7300
2795 RETURN 
3000 REM "Subtotaling Routines"
3001 ESCAPE 
3050 REM "Add to T$ for total title, T & T5 should be set
3055 T7$=T5$(T*4-3,4)
3060 IF T7$(1,1)=" " THEN RETURN 
3070 IF T7$(1,1)<>"S" THEN CALL "ZZDISP",T7$(1,1)+"X",T6$,T7$(2,3),X3$,T6$,"",0,0,X4$
3080 IF T$="" THEN T$=T6$ ELSE T$=T$+" "+T6$
3090 RETURN 
3100 REM "High order break"                                                     
3110 IF V1=0 THEN RETURN ELSE IF U1$=U9$(1,V1) THEN GOSUB 3200; RETURN 
3120 GOSUB 3220
3130 IF U1$="" THEN IF V0=2 AND V0$(79,1)<>"R" THEN X1$=X1$(1,28)+U9$(1,4)+"-"+G$(5,24); GOTO 3160 ELSE GOTO 3160
3140 IF V0=5 THEN T=1,T$=U5$,T6$=U1$; GOSUB 3050; GOSUB 7000; GOTO 3155
3150 T=1,T$=U5$,T6$=U1$; GOSUB 3050; IF P$(13,1)<>"Y" THEN GOSUB 7100; GOTO 3160
3155 IF V0=5 THEN X1$=X1$(1,28)+U9$(1,4)+"- "+G$(5,24)
3156 IF U0$(1,1)="Y" AND V0$(79,1)<>"R" THEN GOSUB 6000
3160 IF U9$<>"" THEN U1$=U9$(1,V1)
3180 RETURN 
3200 REM "Second highest order break"                                           
3210 IF V2=0 THEN RETURN ELSE IF U2$=U9$(V5,V2) THEN GOSUB 3300; RETURN 
3220 GOSUB 3320
3230 IF U2$="" THEN GOTO 3260
3232 IF V0=1 AND V0$(59,1)="A" AND A5>1 THEN F9=2
3235 IF V0=1 AND O$<>"" THEN GOSUB 7800
3237 IF V0<>2 THEN GOTO 3240
3238 ESCAPE ; T=2,T$=U6$,T6$=U2$; GOSUB 3050; IF P$(13,1)<>"Y" THEN GOSUB 7100; GOTO 3260 ELSE GOSUB 7000
3239 T=3; T$=U7$,T6$=U3$; GOSUB 3050; GOSUB 7000; GOTO 3260
3240 IF V0$(81,1)="Y" THEN C[6]=0; FOR I=1 TO 6; C[I+6]=T[2,I],C[6]=C[6]+T[2,I]; NEXT I; C$(391,6)=V0$(72,6); WRITE (Z[3],KEY=C$(1,10))IOL=0330; IF RT_PARM$<>"" THEN CUST$=C$(1,10); CALL "RT2WOC",ERR=3241,X3$,X4$,CUST$,"AR1...","U",C$(1,10)
3250 REM "T=2,T$=U6$,T6$=U2$; GOSUB 3050; GOSUB 7000
3255 IF U0$(2,1)="Y" THEN GOSUB 6000
3260 IF U9$<>"" THEN U2$=U9$(V5,V2)
3280 RETURN 
3300 REM "Next to lowest order break                                            
3310 IF V3=0 THEN RETURN ELSE IF U3$=U9$(V6,V3) THEN GOSUB 3400; RETURN 
3320 GOSUB 3420
3330 IF U3$="" THEN GOTO 3360
3332 IF V0=2 AND V0$(59,1)="A" AND A5>1 THEN F9=2
3335 IF V0=2 AND O$<>"" THEN GOSUB 7800
3340 REM "IF V0=2 AND V0$(81,1)="Y" THEN C[6]=0; FOR I=1 TO 6; C[I+6]=T[3,I],C[6]=C[6]+T[3,I]; NEXT I; C$(391,6)=V0$(72,6); WRITE (Z[3],KEY=C$(1,10))IOL=0330; IF RT_PARM$<>"" THEN CUST$=C$(1,10); CALL "RT2WOC",ERR=3341,X3$,X4$,CUST$,"AR1...","U",C$(1,10)
3350 T=3,T$=U7$,T6$=U3$; GOSUB 3050; GOSUB 7000
3355 IF U0$(3,1)="Y" THEN GOSUB 6000
3360 U3$=U9$(V6,V3)
3380 RETURN 
3400 REM "Lowest Order Break
3410 IF V4=0 THEN RETURN ELSE IF U4$=U9$(V7,V4) THEN GOSUB 3400; RETURN 
3420 GOSUB 3520
3430 IF U4$="" THEN GOTO 3460
3450 T=4,T$=U8$,T6$=U4$; GOSUB 3050; GOSUB 7000
3455 IF U0$(4,1)="Y" THEN GOSUB 6000
3460 U4$=U9$(V6,V3)
3480 RETURN 
3490 RETURN 
3580 RETURN 
4100 REM "Set up constants for ageing
4105 DIM I[5]; I[0]=44,I[1]=59,I[2]=74,I[3]=89,I[4]=104,I[5]=104
4106 REM "Set a5 to limit invoice to a range of ages
4107 A5=NUM(V0$(83,1))
4110 IF P$(47,1)="Y" THEN GOTO 4200
4115 REM "age by months"
4120 A0$=V0$(72,4),A2=NUM(A0$(3)),A0=3
4130 FOR I=1 TO 4
4135 A1$=A0$(1,2),A3=A2-I; IF A3<1 THEN A3=A3+12; IF A1$(2,1)<>"0" THEN A1$(2,1)=CHR(ASC(A1$(2,1))-1) ELSE A1$=CHR(ASC(A1$(1,1))-1)+"9"
4140 A0$=A0$+A1$+STR(A3:"00")
4145 NEXT I
4190 RETURN 
4200 REM "Set aging if aging is days"
4210 A0$="",A0=6,A1$="      "
4220 FOR I=0 TO 4
4230 CALL "ZZDATE",X3$,"",V0$(72,6),A1$,-P[I],0,0,0,0,0,0,"","",""
4240 A0$=A0$+A1$
4250 NEXT I
4290 RETURN 
4500 REM "Age invoice and set A1= xpos to print, A2= total to update"
4505 IF V0$(78,1)="I" THEN D0$=A$(20,6) ELSE D0$=A$(54,6)
4506 IF A$(11,7)="ONACCNT" OR (A$(19,1)="C" AND P$(96,1)<>"Y") THEN A1=I[1],A2=2; GOTO 4590
4510 FOR I=0 TO 4
4520 IF D0$(1,A0)>A0$(I*A0+1,A0) THEN A1=I[I],A2=I+1; EXITTO 4550
4530 NEXT I
4539 REM "if still here then maximum age
4540 A1=I[5],A2=6
4590 RETURN 
5000 REM "End of Print
5001 IF W0=99999999999999 THEN GOTO 5030; REM " SSP# 143489
5010 IF W8=0 AND V0$(79,1)<>"R" THEN GOTO 5290
5030 T0$="END"
5035 REM "IF V0=5 THEN X1$="A/R Open Invoice Report     "
5040 IF V1>0 THEN GOSUB 3120
5050 T=0,T$="Report"; GOSUB 7000
5200 REM "
5290 GOTO 9900
6000 REM "Page header
6010 IF U1$(1,4)<>G$(1,4) THEN X1$=X1$+G$(1,4)+"   "+G$(5,30)
6035 IF T0$="END" THEN W0$=""
6040 CALL "ZZHEAD","!"+X0$,X1$,X2$,X3$,W0$,W1$,W2$,W3$,W3,W,W9,W8,W0,W5,W2,W8$,W5$; IF T0$="END" THEN GOTO 6060 ELSE ON W5 GOTO 6041,9910
6050 REM "GOSUB 6200; REM " THIS IS NEW
6060 REM "GOSUB 6100; REM THIS IS NEW
6090 RETURN 
6100 REM "
6124 IF V0$(59,1)="A" AND A5>1 THEN GOTO 6125 ELSE ON A5 GOTO 6150,6125,6126,6127,6128,6129,6130
6125 Y5$(48+SUMOFFSET)="Future"
6126 Y5$(62+SUMOFFSET)=P$(48,8)
6127 Y5$(77+SUMOFFSET)="Over 30"
6128 REM REM "Y5$(92+SUMOFFSET)=P$(64,8)
6129 Y5$(92+SUMOFFSET)="Over 60"
6130 Y5$(107+SUMOFFSET)="Over 90"
6150 GOSUB 7300
6155 GOSUB 7300
6199 RETURN 
6200 REM "Break #1 header                                             
6210 IF V0=1 THEN GOTO 6299
6220 DIM G$(244); READ (Z[5],KEY=U9$(1,4),DOM=6221)G$
6299 RETURN 
6300 REM "Break #2 header                                                       
6310 IF W+4>W0 THEN GOSUB 6000
6315 REM " GOSUB 7300                                                           
6320 CALL "ZZDISP","AX",A$(1,10),"A/R",X3$,X$,"",0,0,X4$; Y5$(1)=X$,X5$=X$
6325 Y5$(13)=C$(11,35)
6328 Q$=C$(338,14); IF Q$=S$(1,14) THEN Q$=C$(205,14)
6330 CALL "ZZDISP","PX",Q$,"   ",X3$,X$,"",0,0,X4$; Y5$(51)=X$
6333 X$=""; IF POS(" "<>C$(143,12))>0 THEN CALL "ZZDISP","POX",C$(143,12),"",X3$,X$,"",0,0,X4$; X$="  Fax: "+X$
6335 Y5$(77)=FNS$(C$(298,20))+X$
6340 GOSUB 7300
6342 IF POS("T"=V0$(59,12))>0 THEN GOSUB 7900
6345 IF V0$(82,1)<>"Y" THEN GOTO 6390
6350 Y5$(13)=C$(56,30); GOSUB 7300
6355 IF POS(" "<>C$(86,30))<>0 THEN Y5$(13)=C$(86,30); GOSUB 7300
6360 Y5$(13)=FNS$(C$(116,16))+",  "+C$(132,2)
6365 CALL "ZZDISP","AX",C$(134,9),"ZIP",X3$,X$,"",0,0,X4$; Y5$(43-LEN(X$))=X$
6370 GOSUB 7300
6390 REM " IF V0$(79,1)<>"C" THEN GOSUB 7300                                    
6399 RETURN 
6401 IF V0=3 THEN GOTO 6490 ELSE IF V0=4 THEN GOTO 6500
6405 IF W+4>W0 THEN GOSUB 6000
6410 Y5$(1)="Summary Bill: "+U9$(15,10)
6420 GOSUB 7300
6490 RETURN 
6501 IF V0=3 THEN GOTO 6590 ELSE IF V0=4 THEN GOTO 6600
6505 IF W+4>W0 THEN GOSUB 6000
6510 Y5$(1)="Salesperson: "+U9$(1,4)
6520 GOSUB 7300
6590 RETURN 
7000 REM "Totals logic
7002 IF T=T0 THEN IF V0$(79,1)="R" THEN GOTO 7090 ELSE IF V0$(79,1)="C" THEN GOSUB 7665; GOTO 7020
7003 IF W+2>W0 THEN GOSUB 6000
7005 GOSUB 7600
7020 REM "Y5$(27+SUMOFFSET)=STR(T[T,1]+T[T,2]+T[T,3]+T[T,4]+T[T,5]+T[T,6]:Z0$)
7025 IF V0$(59,1)="A" AND A5>1 THEN GOTO 7026 ELSE ON A5 GOTO 7035,7026,7027,7028,7029,7030,7031
7026 Y5$(43+SUMOFFSET)=STR(T[T,1]:Z0$)
7027 Y5$(58+SUMOFFSET)=STR(T[T,2]:Z0$)
7028 Y5$(73+SUMOFFSET)=STR(T[T,3]:Z0$)
7029 Y5$(88+SUMOFFSET)=STR(T[T,4]:Z0$)
7030 T[T,5]=T[T,5]+T[T,6]; Y5$(103+SUMOFFSET)=STR(T[T,5]:Z0$)
7031 REM "Y5$(118+SUMOFFSET)=STR(T[T,6]:Z0$)
7035 GOSUB 7300
7065 IF T0$="END" THEN Y5$(27+SUMOFFSET)=T2$(1,14),Y5$(43+SUMOFFSET)=T2$(1,14),Y5$(58+SUMOFFSET)=T2$(1,14),Y5$(73+SUMOFFSET)=T2$(1,14),Y5$(88+SUMOFFSET)=T2$(1,14),Y5$(103+SUMOFFSET)=T2$(1,14); GOSUB 7300
7080 IF T<2 THEN GOSUB 8300
7085 IF DSO THEN IF MID(T$,1,6)="Report" THEN GOSUB PRINT_DSO_RPT_TOTALS ELSE IF MID(T$,1,8)="Division" THEN GOSUB PRINT_DSO ! 153690
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7200; GOTO 7190
7095 IF V0$(79,1)<>"R" THEN GOSUB 7300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7135 IF POS(X3$(9,3)="020091095")<>0 THEN IF T=2 THEN T[T-1,X]=T[T-1,X]-J[X]; J[X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7201 GOTO 7290
7205 GOSUB 7300; Y5$(1)="Number of items printed: "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 IF INT(T2)>0 THEN T4$=STR(INT(T2))+" Hours " ELSE T4$=""
7230 T3=INT(FPT(T2)*3600)
7240 T3=T3/60
7250 T4$=T4$+STR(T3:"##.##")+" Minutes"
7260 Y5$(1)="Elapsed time: "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7310 IF POS("V"=W8$)>0 THEN CALL "ZZVIEW",X3$,0,0,W3,W9,W,W9$,Y5$; GOTO 7390
7320 W=W+1; IF POS(" "<>Y5$)=0 THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; Y5$(1)=""
7330 REM 
7390 IF W>=W0 THEN GOSUB 6000
7395 RETURN 
7400 REM "Read report selection parameters"
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7469 IF V0$(19,1)="!" THEN DSO=1,DSO_FYAP$=V0$(20,6),V0$(19,40)=V0$(25,34) ! 153690
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"   ")-1)
7482 IF V0=3 THEN V0=1
7485 REM FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN LET V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 IF V0=2 THEN V1$="ARU..." ELSE V1$="ARN..."
7493 IF V0$(78,1)="I" THEN W2$="Aged by invoice date as of "+FND$(V0$(72,6)) ELSE W2$="Aged by due date as of "+FND$(V0$(72,6))
7495 RETURN 
7500 REM "Get transaction data set Inv Bal to Orig amount then adjust by trans
7505 A[3]=A[6]; IF A$(127,6)>V0$(84,6) THEN A[3]=0
7510 D0=A[1],FLAG$="",SEQ$=""; DIM D[1]
7520 IF FLAG$="END" THEN GOTO 7570
7530 CALL "AR2XAB",X3$,X4$,Z[2],A$,D0,D$,D{ALL},FLAG$,SEQ$,"R"
7532 IF MID(D$,1,18)<>A$(1,18) THEN GOTO 7570
7535 IF SEQ$="" AND FLAG$="NONE" THEN GOTO 7570
7540 IF D$(40,6)<=V0$(84,6) THEN A[3]=A[3]+D[0]
7560 GOTO 7520
7570 D$=""
7590 RETURN 
7600 REM "Handle total lines"
7604 IF T=3 THEN GOTO 7650
7605 REM "IF V0=5 AND T=3 THEN GOTO 7650 ELSE IF V0<>5 AND T=2 THEN GOTO 7650
7606 IF V0$(79,1)<>"T" THEN GOSUB 7300
7607 REM "IF V0$(79,1)="R" THEN GOTO 7618 ELSE Y5$(27+SUMOFFSET)=T1$(1,14)
7608 IF V0$(59,1)="A" AND A5>1 THEN GOTO 7609 ELSE ON A5 GOTO 7614,7609,7610,7611,7612,7613,7614
7609 Y5$(43+SUMOFFSET)=T1$(1,14)
7610 Y5$(58+SUMOFFSET)=T1$(1,14)
7611 Y5$(73+SUMOFFSET)=T1$(1,14)
7612 Y5$(88+SUMOFFSET)=T1$(1,14)
7613 Y5$(103+SUMOFFSET)=T1$(1,14)
7614 REM "Y5$(118+SUMOFFSET)=T1$(1,14)
7615 GOSUB 7300
7618 Y5$(1)=T3$(1,T0+1-T)+" "
7620 IF T$<>"" THEN Y5$(T0+2-T)=T$+" Total ("+STR(T[T,0]:"0")+"):"
7630 RETURN 
7650 REM "Customer case"
7652 IF V0$(79,1)="R" THEN GOTO 7690
7655 IF V0$(59,1)="A" AND A5>1 THEN GOTO 7656 ELSE ON A5 GOTO 7665,7656,7657,7658,7659,7660,7661
7656 Y5$(43+SUMOFFSET)=T1$(1,14)
7657 Y5$(58+SUMOFFSET)=T1$(1,14)
7658 Y5$(73+SUMOFFSET)=T1$(1,14)
7659 Y5$(88+SUMOFFSET)=T1$(1,14)
7660 Y5$(103+SUMOFFSET)=T1$(1,14)
7661 REM Y5$(118+SUMOFFSET)=T1$(1,14)
7662 CALL "ZZDISP","AX",C$(1,10),"A/R",X3$,X$,"",0,0,X4$
7665 REM "Y5$(1)="Total for: "+U6$+" "+X$; GOSUB 7300
7669 REM "X5$ is set in 6300 display routine"
7670 REM "Y5$(2+SUMOFFSET)=STR(C[5]:Z2$),Y5$(14+SUMOFFSET)=X5$
7680 REM "Y5$(27+SUMOFFSET)=STR(T[T,1]+T[T,2]+T[T,3]+T[T,4]+T[T,5]+T[T,6]:Z0$)
7690 RETURN 
7700 REM "Print an invoice
7705 IF POS(V0$(79,1)="CRD")>0 THEN GOTO 7770
7712 IF W+1>W0 THEN GOSUB 6000
7713 IF V0=4 THEN OFFSET=5; Y5$(1)=U9$(11,4)
7715 IF A$(11,7)="ONACCNT" THEN Y5$(1+OFFSET)="ON ACCOUNT" ELSE CALL "ZZDISP","AX",A$(11,8),"AR6",X3$,X$,"",0,0,X4$; Y5$(2+OFFSET)=X$
7720 IF X3$(69,1)<>"Y" THEN Y5$(13+OFFSET)=FND$(A$(20,6)) ELSE CALL "ZZDISP","DX",A$(20,6),"   ",X3$,X$,"",0,0,X4$; Y5$(13+OFFSET)=X$
7721 Y5$(13+OFFSET)=A$(160,8)
7725 IF X3$(69,1)<>"Y" THEN Y5$(25+OFFSET+SUMOFFSET)=FND$(A$(54,6)) ELSE CALL "ZZDISP","DX",A$(54,6),"   ",X3$,X$,"",0,0,X4$; Y5$(25+OFFSET+SUMOFFSET)=X$
7730 IF POS("p"=V0$(59,12))>0 THEN Y5$(30+SUMOFFSET)=" "+A$(36,13)
7735 IF V0$(59,1)="*" AND A[6]<>A[3] THEN Y5$(40+SUMOFFSET,2)="**"
7740 IF POS("j"=V0$(59,12))>0 THEN GOSUB 8000
7745 IF POS("S"=V0$(59,12))>0 THEN Y5$(11+SUMOFFSET,1)=A$(19,1)
7750 IF V0$(79,1)="T" THEN Y5$(A1+SUMOFFSET)=STR(A[6]:Z1$); GOSUB 7300; GOSUB 2000 ELSE Y5$(A1+SUMOFFSET)=STR(A[3]:Z1$); GOSUB 7300
7760 IF POS("S"=V0$(59,12))>0 THEN GOSUB 8100; GOSUB 8200
7770 REM "Accumulate Totals"
7775 IF POS(X3$(9,3)="020091095")<>0 THEN IF A$(11,7)="9999999" THEN J[A2]=J[A2]+A[3]
7780 T[T0,A2]=T[T0,A2]+A[3]
7785 T[T0,0]=T[T0,0]+1
7790 RETURN 
7800 REM "Print on account amount
7803 IF POS(V0$(79,1)="CR")>0 THEN GOTO 7810
7805 IF W+2>W0 THEN GOSUB 6000
7806 REM "GOSUB 7300
7810 Q$=A$,Q1=A[1],Q2=A[2],Q3=A[3],Q6=A[6],Q8=A1,Q9=A2
7815 A$=O$,A[1]=O1,A[2]=O2,A[3]=O3,A[6]=O6
7825 A1=I[1],A2=2
7830 GOSUB 7700
7885 O$="",A$=Q$,A[1]=Q1,A[2]=Q2,A[3]=Q3,A[6]=Q6,A1=Q8,A2=Q9
7890 RETURN 
7900 REM 
7905 Y5$(13)="Std terms: "+C$(359,2); FIND (Z[7],KEY=C$(359,2),DOM=7906)X$; Y5$(29)=X$(3,30)
7910 GOSUB 7300
7945 RETURN 
8000 REM "Get Job Number from Order History
8020 READ (Z[8],KEY=A$(1,10)+A$(66,8),DOM=8021)
8040 X$=KEY(Z[8],END=8090); READ (Z[8])
8050 IF A$(1,10)+A$(66,8)<>X$(1,18) THEN GOTO 8090
8060 READ (Z[9],KEY=X$(1,10)+X$(19,11)+X$(11,8)+X$(30,1),DOM=8040)X$
8070 IF POS(" "<>X$(69,12))=0 THEN GOTO 8040
8080 Y5$(30+SUMOFFSET)=" "+X$(69,12)+" "
8090 RETURN 
8100 REM "Get Order History Record of first line
8110 I$=""
8120 READ (Z[8],KEY=A$(1,10)+A$(66,8),DOM=8121)
8140 X$=KEY(Z[8],END=8190); READ (Z[8])
8150 IF X$(1,18)<>A$(1,10)+A$(66,8) THEN GOTO 8190
8160 READ (Z[9],KEY=X$(1,10)+X$(19,11)+X$(11,8)+X$(30,1),DOM=8160)I$
8190 RETURN 
8200 REM "Print 2nd line for "I" type report showing Item, etc
8205 IF I$="" THEN GOTO 8290
8210 Y5$(1)=FND$(I$(34,6))
8215 CALL "ZZDISP","AX",I$(22,8),"O/P",X3$,X$,"",0,0,X4$; Y5$(12)=X$
8220 FIND (Z[7],KEY=A$(51,2),DOM=8221)X$; Y5$(22)=X$(34,3)
8230 Y5$(26)=I$(12,10)
8235 X$=""; FIND (Z[10],KEY=I$(1,10)+I$(12,10),DOM=8236)X$; X$=X$(42,40); GOTO 8250
8240 FIND (Z[11],KEY=I$(1,10)+I$(12,10),DOM=8241)X$; X$=X$(21,40); GOTO 8250
8245 FIND (Z[11],KEY=S$(1,10)+I$(12,10),DOM=8246)X$; X$=X$(21,40)
8250 REM "ITEM DESC.
8260 Y5$(37)=X$
8270 GOSUB 7300
8290 RETURN 
8300 REM "Total Percentages
8305 TOTAL=0
8310 FOR I=0 TO 6; TOTAL=TOTAL+T[T,I]; NEXT I
8320 IF TOTAL=0 THEN GOTO 8390 ELSE Y5$(26+SUMOFFSET)=STR(100:Z3$)
8330 FOR I=1 TO 6
8340 IF T[T,I]<>0 THEN Y5$(43+SUMOFFSET,(I-1)*15)=STR(T[T,I]*100/TOTAL:Z3$)
8350 NEXT I
8360 GOSUB 7300
8390 RETURN 
8400 SHIP_TO_SORT:REM "Sort open invoices by shipto code from ASJ
8405 TMP$="A/R Open Invoices by Shipto Code"
8410 CALL "ZZ2SRT",X3$,X4$,Z[6],Z[1],22,TMP$,Z,"YY"; IF Z=2 THEN GOTO 9920
8415 V1$=TMP$; Z$="13O "+TMP$+" "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
8418 IF Z=1 THEN GOTO 8490
8419 REM "Read thru AR6 starting with starting customer and going to ending customer. Read each AR6 record, get order# and then read records from ASJ until we find first non-blank shipto, if any. Then write out to temp file keyed by customer & ship to.
8420 COUNT=0; READ (Z[1],KEY=V2$(1,10),DOM=8421)
8425 AR6_KEY$=KEY(Z[1],END=8490); IF AR6_KEY$(1,10)>V2$(11,10) THEN GOTO 8490
8428 COUNT=COUNT+1; IF MOD(COUNT,20)=0 THEN PRINT @(25,22),AR6_KEY$(1,10),"-",AR6_KEY$(11),
8430 READ (Z[1],KEY=AR6_KEY$,DOM=8425)AR6$
8435 DIM SHIPTO$(4); READ (Z[12],KEY=AR6$(1,10)+AR6$(66,8),DOM=8436)
8440 ASJ_KEY$=KEY(Z[12],END=8460); IF ASJ_KEY$(1,18)<>AR6$(1,10)+AR6$(66,8) THEN GOTO 8460 ELSE READ (Z[12],KEY=ASJ_KEY$,DOM=8440)ASJ$
8445 IF ASJ$(21,8)<>AR6$(11,8) THEN GOTO 8440; REM "Skip if invoice number doesnt match
8450 IF ASJ$(41,4)<>"    " THEN SHIPTO$=ASJ$(41,4); GOTO 8456
8455 GOTO 8440
8460 WRITE (Z[13],KEY=AR6_KEY$(1,10)+SHIPTO$+AR6_KEY$(11))
8485 GOTO 8425
8495 SHIP_TO_SORT_END:RETURN 
8500 PRINT_DSO:! 153690 Get info for & print Days Sales Outstanding           
8505 DSO_DIV_TOTAL=0; DSO_FY$=MID(DSO_FYAP$,1,4); DSO_AP=NUM(MID(DSO_FYAP$,5,2)); DIM AR9[13]; IF P$(13,1)<>"Y" THEN DSO_DIV$="00" ELSE DSO_DIV$=MID(T$,-2)
8506 Z8$="##,##0"
8507 IOLIST AR9$,AR9[0],AR9[1],AR9[2],AR9[3],AR9[4],AR9[5],AR9[6],AR9[7],AR9[8],AR9[9],AR9[10],AR9[11],AR9[12],AR9[13]
8508 READ (Z[15],KEY=DSO_DIV$,DOM=*NEXT)
8510 KEY15$=KEY(Z[15],END=8521); IF KEY15$(1,2)<>DSO_DIV$ THEN GOTO 8521 ELSE IF KEY15$(11,4)<>DSO_FY$ OR KEY15$(15,1)<>"S" THEN READ (Z[15]); GOTO 8510
8511 READ (Z[15],KEY=KEY15$,DOM=8510)IOL=8507
8515 IF AR9$(11,4)=DSO_FY$ THEN DSO_DIV_TOTAL+=AR9[DSO_AP]
8520 GOTO 8510
8524 DDT=DSO_DIV_TOTAL; DSO_DIV_TOTAL=DSO_DIV_TOTAL/30
8525 DSO_RPT_TOTAL+=DDT
8526 IF P$(13,1)<>"Y" THEN GOTO 8545
8529 Y5$(2)="Revenue: "+STR(DDT:Z0$); GOSUB 7300
8530 Y5$(2)="Days Sales Outstanding:"; IF DSO_DIV_TOTAL=0 THEN GOTO 8538 ELSE Y5$(32)=STR((T[T,1]+T[T,2]+T[T,3]+T[T,4]+T[T,5]+T[T,6])/DSO_DIV_TOTAL:Z8$)
8531 IF V0$(59,1)="A" AND A5>1 THEN GOTO 8532 ELSE ON A5 GOTO 8538,8532,8533,8534,8535,8536,8537
8532 Y5$(48+SUMOFFSET)=STR(T[T,1]/DSO_DIV_TOTAL:Z8$)
8533 Y5$(63+SUMOFFSET)=STR(T[T,2]/DSO_DIV_TOTAL:Z8$)
8534 Y5$(78+SUMOFFSET)=STR(T[T,3]/DSO_DIV_TOTAL:Z8$)
8535 Y5$(93+SUMOFFSET)=STR(T[T,4]/DSO_DIV_TOTAL:Z8$)
8536 Y5$(108+SUMOFFSET)=STR(T[T,5]/DSO_DIV_TOTAL:Z8$)
8537 Y5$(123+SUMOFFSET)=STR(T[T,6]/DSO_DIV_TOTAL:Z8$)
8538 GOSUB 7300
8545 RETURN 
8549 ! 
8550 PRINT_DSO_RPT_TOTALS:! 153690 print totals for DSO report                
8560 IF P$(13,1)<>"Y" THEN GOSUB PRINT_DSO
8575 DRT=DSO_RPT_TOTAL; DSO_RPT_TOTAL=DSO_RPT_TOTAL/30
8579 Y5$(2)="Revenue: "+STR(DRT:Z0$); GOSUB 7300
8580 Y5$(2)="Days Sales Outstanding:"; IF DSO_RPT_TOTAL=0 THEN GOTO 8588 ELSE Y5$(32)=STR((T[T,1]+T[T,2]+T[T,3]+T[T,4]+T[T,5]+T[T,6])/DSO_RPT_TOTAL:Z8$)
8581 IF V0$(59,1)="A" AND A5>1 THEN GOTO 8582 ELSE ON A5 GOTO 8588,8582,8583,8584,8585,8586,8587
8582 Y5$(48)=STR(T[T,1]/DSO_RPT_TOTAL:Z8$)
8583 Y5$(63)=STR(T[T,2]/DSO_RPT_TOTAL:Z8$)
8584 Y5$(78)=STR(T[T,3]/DSO_RPT_TOTAL:Z8$)
8585 Y5$(93)=STR(T[T,4]/DSO_RPT_TOTAL:Z8$)
8586 Y5$(108)=STR(T[T,5]/DSO_RPT_TOTAL:Z8$)
8587 Y5$(123)=STR(T[T,6]/DSO_RPT_TOTAL:Z8$)
8588 GOSUB 7300
8595 RETURN 
8599 ! 
8600 REM " Sort by Summary Bill ssp 172299
8605 TMP$="A/R Open Invoices by Salesperson/Summary Bill"
8610 CALL "ZZ2SRT",X3$,X4$,Z[6],Z[1],30,TMP$,Z,"YY"; IF Z=2 THEN GOTO 9920
8615 V1$=TMP$; Z$="13O "+TMP$+" "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
8618 IF Z=1 THEN GOTO 8690
8619 REM "Read thru AR6 starting with starting customer and going to ending customer. Read each AR6 record, get salesperson and summary bill number,then write out to temp file keyed by customer salesperson/summary bill
8620 COUNT=0; READ (Z[1],KEY=V2$(9,10),DOM=8621)
8625 AR6_KEY$=KEY(Z[1],END=8690); IF AR6_KEY$(1,10)>V2$(19,10) THEN GOTO 8690
8628 COUNT=COUNT+1; IF MOD(COUNT,20)=0 THEN PRINT @(25,22),AR6_KEY$(1,10),"-",AR6_KEY$(11),
8630 READ (Z[1],KEY=AR6_KEY$,DOM=8625)AR6$
8632 READ (Z[3],KEY=AR6$(1,10),DOM=8640)AR1$
8634 AR6$(74,4)=AR1$(278,4)
8640 IF AR6$(160,8)=DIM(8) THEN AR6$(160,8)="ZZZZZZZZ"
8650 DIM TEMP_KEY$(30); TEMP_KEY$(1,4)=AR6$(74,4),TEMP_KEY$(5,10)=AR6$(1,10),TEMP_KEY$(15,8)=MID(AR6$,160,8),TEMP_KEY$(23,8)=AR6$(11,8)
8660 WRITE (Z[13],KEY=TEMP_KEY$)
8685 GOTO 8625
8695 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "End program
9905 IF POS("V"=W8$)>0 THEN GOSUB 6000
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 IF Y4$<>"" THEN RUN Y4$,ERR=9931
9940 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
