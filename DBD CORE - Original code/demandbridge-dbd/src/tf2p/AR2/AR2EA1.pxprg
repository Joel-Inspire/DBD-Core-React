0010 REM "Release 3.8 Sales Tax Computation IN ART <AR2EA1>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 06/13/16 - 13.320555 - jvv - SSP# 284976
0037 REM "284976-Sales Tax Interface: Modifications to freight salestax logic
0040 REM "Copyright 2016 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 REM "A$=ARB string, A0=index to ART
0051 REM "T(I,0)=Taxable Sales, T(I,1)=Non-Taxable Sale, T(I,2)=Tax as Freight
0052 REM "T(I,3)=State Taxable Sale, T(I,4)=State Sales Tax, T(I,5)=County Taxable Amount, T(I,6)=County Sales Tax, T(I,7)=Local Taxable Amount, T(I,8)=Local Sales Tax, T(I,9)=Total Sales Tax   ,T(I,10)=Additonal Freight, T(I,11)=Total of Special Charges to subtract if not taxing special charges, T(I,12)=NonTaxed special charges (fuel surcharge for 584 for now)
0053 REM "Don't worry about deletion, since we will always go thru ARB and thisroutine always removes ASD records before computing tax.
0054 REM "S0=when coming from taxable amount override entry.  4=state, 6=county, 8=local
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,A$,A{ALL},S0
0100 SETERR 9000
0110 X0$="AR2EA1",X1$="Compute ART Sales Tax"
0120 DIM S$(40),D$(400),D[4]
0125 DIM AR5[7]; REM " SSP# 149046
0135 C9=-1
0140 M2$="###,###.00-"
0200 REM "
0300 REM "IOLISTS
0310 IOLIST A,B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20],B[21],B[22],B[23],B[24],B[25],B[26],B[27],B[28],B[29],B[30],B[31],B[32],B[33],B[34],B[35],B[36],B[37],B[38],B[39],B[40],B[41],B[42],B[43],B[44],B[45],B[46],B[47],B[48]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16]
0340 IOLIST D$(1),D[0],D[1],D[2],D[3],D[4]
0350 IOLIST AR5$,AR5[0],AR5[1],AR5[2],AR5[3],AR5[4],AR5[5],AR5[6],AR5[7]
0380 IOLIST ICF$,ICF[0],ICF[1],ICF[2],ICF[3],ICF[4],ICF[5],ICF[6],ICF[7],ICF[8]
0390 IOLIST FM1$,FM1[0],FM1[1],FM1[2],FM1[3],FM1[4],FM1[5],FM1[6],FM1[7],FM1[8],FM1[9],FM1[10],FM1[11],FM1[12],FM1[13],FM1[14],FM1[15],FM1[16],FM1[17],FM1[18],FM1[19],FM1[20],FM1[21]
0430 IOLIST C1$,C1[0],C1[1],C1[2],C1[3],C1[4],C1[5],C1[6],C1[7],C1[8],C1[9],C1[10],C1[11],C1[12],C1[13],C1[14],C1[15],C1[16]
0440 IOLIST C2$,C2[0],C2[1],C2[2],C2[3],C2[4],C2[5],C2[6],C2[7],C2[8],C2[9],C2[10],C2[11],C2[12],C2[13],C2[14],C2[15],C2[16]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="02O ART...  03O ASD...  04O AR5...  05O FMP...  06O ICF...  10O FM1...  13O ZZPARM  250 AR1...  26O PO3...  "
0511 IF %ACTION$="C" THEN Z$="02O GRT...  03O GSD...  04O AR5...  05O FMP...  06O ICF...  10O FM1...  13O ZZPARM  25O AR1...  26O PO3...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0600 READ (Z[13],KEY=X3$(9,3)+"A/R")AR_PARMS$; REM " SSP# 149046
0900 DIM B[48],C[16],TA[8]
0910 DIM T[1,17] ! SSP 257195 SSP 284976
0915 FRT_EXCL$="357" ! SSP 257195
0920 A0=A[20]
1000 REM 
1010 GOSUB 3000 ! Clear ASD records
1100 REM "Compute sales tax total T(X,0)=Taxable Sale, T(X,1)=Non-taxable sale, T(X,2)=Tax as Freight
1102 FLAG$=""
1110 T9$=A$(67,10); REM " TAX CODE
1120 IF A0=0 THEN GOTO 3100 ELSE GOSUB 1300; A=A0
1140 IF A<=0 THEN GOTO 5000
1160 A9=A; READ (Z[2],IND=A)IOL=0310
1161 DIM TL[12] ! Dim for ART line tax amounts
1162 IF POS(MID(AR_PARMS$,176,1)="Y")=0 THEN GOTO 1170; REM " SSP# 158548
1163 READ (Z[5],KEY="D"+A$(15,10),DOM=1170)CUST_PARMS$; REM " SSP# 158548
1164 IF POS(MID(CUST_PARMS$,244,1)="Y")=0 THEN GOTO 1170
1165 IF B$(135,1)<>"" THEN GOSUB 8500
1166 REM "IF B$(89,1)<>"9" OR PO3$(12,1)<>"9" THEN GOTO 1170
1168 IF B$(1,1)="S" THEN GOTO 1170
1169 GOSUB 8400; GOTO 1174
1170 EXTENSION=B[4]
1173 REM "IF B$(89,1)="9" THEN GOTO 1260 ELSE X=(POS(B$(125,10)=T9$)-1)/10
1174 X=(POS(B$(125,10)=T9$)-1)/10
1175 GOSUB PCODE_SET_EXCLUDE ! SSP 257195 ssp 284976
1176 IF EXTENSION=0 THEN GOTO 1140
1177 IF B$(89,1)="9" THEN GOSUB 1686
1180 IF B$(54,1)="Y" OR (B$(54,1)="C" AND B$(125,2)<>"IL") THEN T[X,0]=T[X,0]+EXTENSION,TL[0]=EXTENSION
1200 IF B$(54,1)="C" AND B$(125,2)="IL" THEN T[X,0]=T[X,0]+EXTENSION*.5,T[X,1]=T[X,1]+EXTENSION-EXTENSION*.5,TL[0]=EXTENSION*.5,TL[1]=EXTENSION-EXTENSION*.5
1220 IF B$(54,1)="F" THEN T[X,2]=T[X,2]+EXTENSION,TL[2]=EXTENSION
1240 IF POS(B$(54,1)="YCF")=0 THEN T[X,1]=T[X,1]+EXTENSION,TL[1]=EXTENSION
1245 IF B$(1,1)="S" THEN T[X,11]+=EXTENSION,TL[11]=EXTENSION
1250 ! IF POS(X3$(9,3)="584500",3) AND B$(1,1)="S" THEN IF MID(B$,65,10)=PAD("ENERGY",10) THEN T[X,12]+=EXTENSION,TL[12]=EXTENSION  ;!SSP 262668
1255 T[X,13]=T[X,13]+PCS_AMOUNT ! WO 249775 This is accumulated amount by product code. If the prod code is exempt because it is part of the product code set defined in AR5, the pcs amount will be zero. This will be used to determine if  tax is to be calculated on freight if all items are non taxable and the flag in AR5 set to Y.
1260 DIM C[20]; I=1
1265 FOR J=0 TO 10; C[J]=TL[J]; NEXT J
1270 C[17]=TL[11],C[18]=TL[12]
1275 C[9]=T[I,4]+T[I,6]+T[I,8]
1278 IF POS(MID(CUST_PARMS$,244,1)="Y")>0 THEN C[11]=C[3],C[12]=C[5],C[13]=C[7],C[14]=C[1],C[15]=C[1],C[16]=C[1]
1280 FOR I=0 TO 18; B[I+21]=C[I]; NEXT I ! Populate ART from DIM C[]
1285 WRITE (Z[2],IND=A9)IOL=0310
1290 GOTO 1140
1295 PCS$="" ! SSP 249975
1300 REM "Multiple Sales Tax Codes 3.8
1320 A=A0
1340 IF A<=0 THEN GOTO 1400 ELSE A9=A; READ (Z[2],IND=A)IOL=0310; IF POS(" "<>B$(125,10))=0 THEN B$(125,10)=A$(67,10); WRITE (Z[2],IND=A9)IOL=0310
1360 IF POS(B$(125,10)=T9$)=0 THEN T9$=T9$+B$(125,10)
1380 GOTO 1340
1400 DIM T[LEN(T9$)/10,17] ! SSP 257195 SSP 284976
1410 IF T9$<>A$(67,10) THEN A$(178,1)="Y" ELSE A$(178,1)="N"
1415 T[0,10]=A[2]; REM "Header STC is always in T(0,), must put additional freight here"
1420 RETURN 
1440 REM "Write results to ASD record
1460 REM PRINT 'CS'
1470 IF S0>0 AND A0>0 AND A$(178,1)<>"Y" THEN GOSUB 3200
1480 FOR X=1 TO LEN(T9$) STEP 10
1500 I=(X-1)/10
1540 DIM C$(44),C[16]
1541 DIM C1$(44),C1[16],C2$(44),C2[16]
1560 C$(1,14)=A$(1,14),C$(15,10)=T9$(X,10)
1640 FOR J=0 TO 10; C[J]=T[I,J]; NEXT J
1650 C[9]=T[I,4]+T[I,6]+T[I,8]
1656 IF POS(MID(CUST_PARMS$,244,1)="Y")>0 THEN C[11]=C[3],C[12]=C[5],C[13]=C[7],C[14]=C[1],C[15]=C[1],C[16]=C[1]
1657 READ (Z[3],KEY=C$(1,24),DOM=1659)IOL=0430
1658 EXTRACT (Z[3],KEY=C$(1,24),DOM=1659)IOL=0430
1659 FOR I=0 TO 16; C1[I]=C1[I]+C[I]; NEXT I
1660 C1$=C$; WRITE (Z[3],KEY=C$(1,24))IOL=0430
1670 REM PRINT C$,"  ",C(0):M2$,C(1):M2$,C(2):M2$,C(3):M2$,C(4):M2$,C(5):M2$,C(6):M2$,C(7):M2$,C(8):M2$,C(9):M2$
1672 REM "IF POS(C$(15,10)=TAXABLE$)>0 THEN GOSUB 1686
1680 NEXT X
1681 RETURN 
1682 ! 
1685 REM WRITE OUT ASD record
1687 DIM C1$(44)
1688 FIND (Z[25],KEY=A$(15,10),DOM=1720)AR_CUST$
1689 C1$(1,14)=A$(1,14),C1$(15,10)=AR_CUST$(235,10)
1690 DIM C1[16],C2[16]
1691 FOR I=14 TO 16; C1[I]=EXTENSION*(-1); NEXT I
1692 READ (Z[3],KEY=C1$(1,24),DOM=1694)IOL=0440
1693 EXTRACT (Z[3],KEY=C1$(1,24))IOL=0440
1694 FOR I=0 TO 16; C2[I]=C2[I]+C1[I]; NEXT I
1695 C2$=C1$
1700 WRITE (Z[3],KEY=C2$(1,24))IOL=0440
1710 RETURN 
1720 ! 
2000 REM "Compute tax
2010 ! IF A$(178,1)="Y" THEN FOR X=3 TO 8; A[X]=0; NEXT X
2020 ! OR X=1 TO LEN(T9$) STEP 10
2040 ! =(X-1)/10,Q$=T9$(X,10)
2080 IF Q$(1,2)<>"  " AND (S0=0 OR S0=3) THEN READ (Z[4],KEY=Q$(1,2)+S$(1,8),DOM=2160)IOL=0340; J=3; GOSUB 2500
2100 IF Q$(3,4)<>S$(1,4) AND (S0=0 OR S0=5) THEN READ (Z[4],KEY=Q$(1,6)+S$(1,4),DOM=2160)IOL=0340; J=5; GOSUB 2500
2120 IF Q$(7,4)<>S$(1,4) AND (S0=0 OR S0=7) THEN READ (Z[4],KEY=Q$,DOM=2160)IOL=0340; J=7; GOSUB 2500
2160 ! EXT X
2190 RETURN 
2500 REM "Calculate Tax
2502 GOSUB PCS_LOOKUP; IF IGNORE_PCS=1 THEN GOTO *NEXT ELSE IF EXCLUDE_PCS=1 THEN GOTO *RETURN ! SSP 249975
2509 IF A$(178,1)="Y" AND (S0>0 OR A0=0) THEN PRINT @(0,22),'CL',"A$(178,1)=",A$(178,1),"  S0=",S0,"  A0=",A0,; INPUT *,
2510 IF S0=0 THEN K=TL[0] ELSE K=A[J]; GOTO 2540
2512 IF D$(106,1)="Y" THEN {! If Canadian Tax Method
2513 IF D$(104,1)<>"Y" THEN IF K<TL[11] THEN SP=K ELSE SP=TL[11] END_IF ; K-=SP,TL[0]-=SP,TL[1]+=SP ! if not taxing special charges, subtract off the amount of special charges
2514 IF J=5 THEN IF D$(104,1)="Y" THEN IF ABS(K)<ABS(TL[12]) THEN SP=K ELSE SP=TL[12] END_IF ; K-=SP,TL[0]-=SP,TL[1]+=SP ! If taxing special charges, subtract off the amount of special charges that should be non-taxed ONLY IF PST
2515 IF D$(105,1)="Y" THEN K+=TL[J-1],TL[0]+=TL[J-1] ! If taxing the other tax then add into total and taxable amounts
2519  }
2520 FEX=POS(STR(J)=FRT_EXCL$,1) ! SSP 257195
2525 IF D$(36,1)="Y" AND A$(115,1)<>"Y" THEN GOSUB FRT_OVERRIDE; IF NOT(FRT_FLG) THEN GOTO *RETURN ELSE K=K+TL[2]+HFRT; REM "Freight on lines/total screen  - additional freight can only be in (0,10)-SSP#108423 only add in if invoice is taxable SSP 252349 257195 SSP 284976
2535 IF A$(178,1)<>"Y" AND A$(115,1)="Y" THEN K=0
2540 TL[J+1]=K*D[0]/100
2560 IF D[1]>0 THEN IF ABS(TL[J+1])>D[1] THEN TL[J+1]=D[1]*SGN(TL[J+1]); REM "Maximum tax
2580 TL[J]=K
2585 T[I,J]=T[I,J]+TL[J],T[I,J+1]=T[I,J+1]+TL[J+1] ! update tax amounts 
2590 RETURN 
2600 FRT_OVERRIDE:
2610 FRT_FLG=0
2620 IF MID(D$,202,1)="Y" THEN GOTO *NEXT ELSE FRT_FLG=1; GOTO FRT_OVERRIDE_EXIT ! SSP 284976
2630 IF MID(D$,203,1)="Y" THEN GOTO *NEXT ELSE IF T[I,(13+FEX)]=0 THEN GOTO FRT_OVERRIDE_EXIT ELSE FRT_FLG=1; GOTO FRT_OVERRIDE_EXIT ! SP 284976
2640 IF T[I,17]=0 THEN GOTO FRT_OVERRIDE_EXIT ELSE FRT_FLG=1 ! SSP 284976
2680 FRT_OVERRIDE_EXIT:
2690 RETURN 
2699 ! 
3000 REM "Remove existing records
3020 READ (Z[3],KEY=A$(1,14),DOM=3021)
3040 K$=KEY(Z[3],END=3090)
3060 IF K$(1,14)<>A$(1,14) THEN GOTO 3090
3080 REMOVE (Z[3],KEY=K$); GOTO 3040
3090 RETURN 
3100 REM "no lines
3110 GOSUB 1400
3120 T[0,0]=A[1],T[0,1]=0,T[0,2]=0
3130 FOR I=3 TO 8; T[0,I]=A[I]; NEXT I
3190 GOTO 5000
3200 REM "Sales Tax override with line items and 1 tax code case
3210 FOR I=3 TO 8 STEP 2; T[0,I]=A[I],T[0,I+1]=A[I+1] ! SSP 257468
3220 NEXT I
3240 RETURN 
4000 REM "CALCULATE TAX IF DOWNLOADED TAX FILE
4010 ! F A$(178,1)="Y" THEN FOR X=3 TO 8; A[X]=0; NEXT X
4020 ! FOR X=1 TO LEN(T9$) STEP 10
4040 ! =(X-1)/10,Q$=T9$(X,10)
4045 IF Q$(1,10)=DIM(10) THEN GOTO 4160; REM SSP 187704
4050 DIM AR5$(400),AR5[15]; READ (Z[4],KNO=0,KEY=Q$(1,10),DOM=4060)IOL=0350
4055 DIM D$(400)
4058 D$(191,13)=MID(AR5$,191,13) ! WO 249775 WO284976
4060 PRECISION 3; D[0]=AR5[3]; D[1]=AR5[4]; PRECISION 2; D$(36,1)=MID(AR5$,154,1); J=3; GOSUB 2500; REM " STATE!SSP#233395
4070 PRECISION 3; D[0]=AR5[2]; D[1]=AR5[5]; PRECISION 2; D$(36,1)=MID(AR5$,155,1); J=5; GOSUB 2500; REM " COUNTY  !SSP#233395
4080 PRECISION 3; D[0]=AR5[0]; D[1]=AR5[6]; PRECISION 2; D$(36,1)=MID(AR5$,156,1); J=7; GOSUB 2500; REM " CITY !SSP#233395  
4160 ! EXT X
4190 RETURN 
5000 ! This section will do tax calculations for ART lines. The tax values will be update to ASD and ARB.
5010 A=A0
5015 HFRT=0 ! SSP 252349
5020 IF A<=0 THEN GOTO 5700
5030 A9=A; READ (Z[2],IND=A)IOL=0310
5035 IF B$(1,1)="M" THEN GOTO 5020 ! SSP#279447 should not calc tax if Message ln
5040 EXCL_PCS_ST$=MID(B$,146,1),EXCL_PCS_CNTY$=MID(B$,147,1),EXCL_PCS_CITY$=MID(B$,148,1)
5050 GOSUB CALC_TAX ! SSP 252349
5060 FOR J=0 TO 10; B[J+21]=TL[J]; NEXT J ! Set ART from CALC VALUES SSP 252349
5070 B[30]=TL[4]+TL[6]+TL[8] ! SSP 252349
5550 ! Calculate tax for each ART record
5600 WRITE (Z[2],IND=A9)IOL=0310
5605 FOR K=3 TO 8; TA[K]=TA[K]+TL[K]; NEXT K ! Accumulate to update ARB
5610 GOTO 5020
5700 ! This section will create dummy transaction if freight is entered on summary screen (ARB[2]); !SSP 252349
5710 IF A[2]=0 THEN GOTO 5800 ! SSP 252349
5720 DIM B$(289),B[48] ! SSP 252349
5725 IF A[20]<=0 THEN FOR I=3 TO 8; T[0,I]=0; NEXT I ! SSP 258875
5730 B$(125,10)=A$(67,10) ! ssp 252349 Set to Header tax code
5735 HFRT=A[2] ! SSP 252349
5740 GOSUB CALC_TAX ! SSP 252349
5750 FOR K=3 TO 8; TA[K]=TA[K]+TL[K]; NEXT K ! Accumulate to update ARB; !SSP 252349
5800 GOSUB 1440 ! Write out ASD record
5810 IF S0<>0 THEN GOTO *NEXT ELSE FOR J=3 TO 8; A[J]=TA[J]; NEXT J ! SSP 252349; SSP 253223
5820 GOTO 9900 ! SSP 252349
5900 CALC_TAX:! This section will do tax calculations for ART lines. The tax values will be update to ASD and ARB. SSP 252349
5910 I=(POS(B$(125,10)=T9$)-1)/10
5920 Q$=B$(125,10)
5930 DIM TL[12]
5940 FOR J=0 TO 10; TL[J]=B[J+21]; NEXT J ! Set TC array to ART values 
5950 TL[11]=B[38],TL[12]=B[39]
5960 IF AR_PARMS$(134,1)="Y" THEN GOSUB 4000; GOTO 5970; REM " CALCULATE TAX IF FROM DOWNLOADED FILE
5965 GOSUB 2000
5970 ! Calculate tax for each ART record
5990 RETURN 
6000 PCS_LOOKUP:! Product code set lookup; !SSP 249775
6005 IGNORE_PCS=0,EXCLUDE_PCS=0 ! Ignore=No PC Sets setup in AR5, Exclude=matching product code in ART found in AR5 group
6010 IF MID(D$,202,1)="Y" THEN B$(149,1)="Y" ELSE B$(149,1)=""
6020 IF POS(B$(54,1)="YC")=0 THEN RETURN ! SSP 257195 Allow Freight line to be subject to Product Code exclusion as well
6050 IF J=3 THEN PCS$=MID(D$,191,3),OV=0
6100 IF J=5 THEN CNTY_PCS$=MID(D$,194,3),OV=1; IF MID(D$,197,1)="Y" THEN PCS$=CNTY_PCS$
6150 IF J=7 THEN CITY_PCS$=MID(D$,198,3),OV=2; IF MID(D$,201,1)="Y" THEN PCS$=CITY_PCS$
6200 IF STP(PCS$,2)="" THEN IGNORE_PCS=1; GOTO PCS_LOOKUP_EXIT
6210 DIM PROD_SETS$(144); READ (Z[5],KEY="e"+PCS$,DOM=PCS_LOOKUP_EXIT)PROD_SETS$; PRCSET$=PROD_SETS$(36)
6220 ART_PC$=B$(3,3)+DIM(6)
6250 IF POS(ART_PC$=PRCSET$,9)<>0 THEN EXCLUDE_PCS=1,B$(146+OV,1)="Y" ELSE B$(146+OV,1)=""
6600 PCS_LOOKUP_EXIT:
6990 RETURN 
6999 ! 
7000 PCODE_SET_EXCLUDE:
7005 ! This routine will determine if a product code is part of pcs and line therefore excluded from having tax calculated on it. 
7006 PCS$="",PCS_AMOUNT=0
7008 IF POS(B$(54,1)="YC")=0 OR B$(54,1)="F" THEN RETURN ! iGNORE IF FREIGHT OR NON TAXABLE LINE
7020 TX_CODE$=B$(125,10)
7030 FIND (Z[4],KEY=TX_CODE$,DOM=7090)PTAX$
7035 FOR TC=1 TO 3 ! SSP 257195 (LINE 7035-7100)
7038 PCS_AMOUNT=EXTENSION
7040 IF TC=1 THEN PCS$=MID(PTAX$,191,3),OV=0
7045 IF TC=2 THEN CNTY_PCS$=MID(PTAX$,194,3),OV=1; IF MID(PTAX$,197,1)="Y" THEN PCS$=CNTY_PCS$
7050 IF TC=3 THEN CITY_PCS$=MID(PTAX$,198,3),OV=2; IF MID(PTAX$,201,1)="Y" THEN PCS$=CITY_PCS$
7055 IF STP(PCS$,2)="" THEN GOTO PCS_EXCLUDE_NEXT
7060 DIM PROD_SETS$(144); READ (Z[5],KEY="e"+PCS$,DOM=PCS_EXCLUDE_NEXT)PROD_SETS$; PRCSET$=PROD_SETS$(36)
7065 ART_PC$=B$(3,3)+DIM(6)
7070 IF POS(ART_PC$=PRCSET$,9)<>0 THEN EXCLUDE_PCS=1,PCS_AMOUNT=0; B$(146+OV,1)="Y" ELSE B$(146+OV,1)=""
7080 PCS_EXCLUDE_NEXT:
7082 IF MID(PTAX$,203,1)="Y" THEN IF POS(B$(54,1)="YC")<>0 THEN T[X,17]=T[X,17]+1 ! SSP 284976 Accumulate for taxable lines
7083 T[X,14+OV]=T[X,14+OV]+PCS_AMOUNT ! SSP 257195
7084 PCS_NEXT:
7085 NEXT TC
7090 PCS_EXCLUDE_EXIT:
7095 RETURN 
7099 ! 
8400 REM " SEARCH FOR PRICE IN LOT RECORD
8401 IF MID(PO3$,12,1)="9" THEN EXTENSION=B[4]; RETURN 
8403 EXTENSION=0
8405 DIM ICF$(214),ICF[8]
8407 Q=0,ICF_K$=B$(55,20)+B$(89,4),Q1=0
8410 READ (Z[6],KEY=ICF_K$,DOM=8411)
8415 READ (Z[6],END=8435)IOL=0380
8420 IF ICF$(1,LEN(ICF_K$))<>ICF_K$ THEN GOTO 8445 ELSE IF ICF$(110,11)<>A$(92,8)+B$(47,3) THEN GOTO 8415
8430 PRICE=ICF(5),UOM$=ICF$(129,4),PER_UNIT=ICF(6)
8435 IF PER_UNIT=0 THEN PER_UNIT=1
8440 EXTENSION=(PRICE*B[1])/PER_UNIT
8441 FLAG$="T"
8445 IF PRICE<>0 THEN GOTO 8499
8450 FM1$=""; DIM FM1[21]; READ (Z[10],KEY=B$(55,20),DOM=8495)IOL=0390
8460 PRICE=FM1(3),UOM$=FM1$(100,4),PER_UNIT=FM1(4)
8470 EXTENSION=(PRICE*B[1])/PER_UNIT
8495 IF EXTENSION=0 THEN EXTENSION=B[4]
8499 RETURN 
8500 REM "CHECK PO3 FOR SPECIAL SHIPPING
8510 READ (Z[26],KEY=A$(92,9)+B$(47,3)+B$(135,1),DOM=8599)PO3$
8599 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 ! Program changes since 03/01/2006
56005 REM "190474-Additional Services - Enhance TF to provide for tax codes   
56006 REM "252349-Releasing items from 9000 level whse.  When frt added to    
56008 REM "253223-DT5: When in invoice entry, if they try to change the sales 
56009 REM "257195-Sales tax for freight - product code exemption for product  
56010 REM "257468-We have lost the ability to change the taxable sale in CHUI 
56011 REM "258875-Getting message in AR Invoice match about sales tax issue   
56012 REM "262668-Has a special charge and needs to know how tax is determine 
56014 REM "279447-Printing AR Sales Journal batch and getting the sales tax    on message lines
56015 REM "284976-Sales Tax Interface: Modifications to freight salestax logic
