0010 REM "AR2VCC - Validate Credit Card
0035 REM "5.5 - 05/04/06 - 8.837777 - lms - SSP# 192616
0037 REM "192616-On credit card orders that have been backordered, need to   
0040 REM "Copyright 2006 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 ENTER X3$,X4$,CC$,CC_TYPE$,FLAG$
0091 IF POS("|"=CC$)=0 THEN GOTO 0100
0092 DATE_IN$=CC$(POS("|"=CC$)+1,4)
0093 CC$=CC$(1,POS("|"=CC$)-1)
0099 IF DATE_IN$<>"" THEN DATE_IN$=DATE_IN$(3,2)+DATE_IN$(1,2)
0500 REM "FILES                                                                 
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O ASP...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0900 ACCT$=CC$
0910 ACCT_LENGTH=LEN(ACCT$)
0911 DATE$=DAY
0912 CHECK_DATE$=STR(NUM(DATE$(7,2)):"00")+STR(NUM(DATE$(1,2)):"00")
1000 REM 
1010 FLAG$="EXPIRED DATE"
1011 IF DATE_IN$="" THEN GOTO 1019
1012 IF DATE_IN$<CHECK_DATE$ THEN GOTO 9900
1019 FLAG$="WRONG LENGTH"
1020 READ (Z[1],KEY=CC_TYPE$,DOM=9900)ASP$
1025 IF ASP$(43,10)=DIM(10) THEN FLAG$="NO"; GOTO 9900; REM " N means NO validation took place
1030 IF NUM(ASP$(41,2))<>ACCT_LENGTH AND NUM(ASP$(93,2))<>ACCT_LENGTH THEN GOTO 9000
1031 IF ACCT_LENGTH=0 THEN GOTO 9000
2000 FLAG$="INVALID PREFIX"
2010 IF ASP$(53,4)<>DIM(4) AND ACCT$(1,LEN(STP(ASP$(53,4),1)))=STP(ASP$(53,4),1) THEN GOTO 2030
2012 IF ASP$(57,4)<>DIM(4) AND ACCT$(1,LEN(STP(ASP$(57,4),1)))=STP(ASP$(57,4),1) THEN GOTO 2030
2014 IF ASP$(61,4)<>DIM(4) AND ACCT$(1,LEN(STP(ASP$(61,4),1)))=STP(ASP$(61,4),1) THEN GOTO 2030
2016 IF ASP$(65,4)<>DIM(4) AND ACCT$(1,LEN(STP(ASP$(65,4),1)))=STP(ASP$(65,4),1) THEN GOTO 2030
2018 IF ASP$(69,4)<>DIM(4) AND ACCT$(1,LEN(STP(ASP$(69,4),1)))=STP(ASP$(69,4),1) THEN GOTO 2030
2020 IF ASP$(73,4)<>DIM(4) AND ACCT$(1,LEN(STP(ASP$(73,4),1)))=STP(ASP$(73,4),1) THEN GOTO 2030
2022 IF ASP$(77,4)<>DIM(4) AND ACCT$(1,LEN(STP(ASP$(77,4),1)))=STP(ASP$(77,4),1) THEN GOTO 2030
2024 IF ASP$(81,4)<>DIM(4) AND ACCT$(1,LEN(STP(ASP$(81,4),1)))=STP(ASP$(81,4),1) THEN GOTO 2030
2026 IF ASP$(85,4)<>DIM(4) AND ACCT$(1,LEN(STP(ASP$(85,4),1)))=STP(ASP$(85,4),1) THEN GOTO 2030
2028 IF ASP$(89,4)<>DIM(4) AND ACCT$(1,LEN(STP(ASP$(89,4),1)))=STP(ASP$(89,4),1) THEN GOTO 2030
2029 GOTO 9900
2500 FLAG$="INVALID CARD"
3000 REM " CHECK DIGIT ALGORITHM 10
3005 REM "ACCT$="340000000000009",ACCT_LENGTH=LEN(ACCT$)
3020 DIM ACT[ACCT_LENGTH],FIRST_TOTAL[ACCT_LENGTH]
3030 FOR I=1 TO ACCT_LENGTH; ACT[ACCT_LENGTH-I]=NUM(ACCT$(I,1)); NEXT I
3050 TOTAL=0
3075 FOR I=1 TO ACCT_LENGTH-1 STEP 2; FIRST_TOTAL[I]=ACT[I]*2; NEXT I
3076 FOR I=0 TO ACCT_LENGTH STEP 2; FIRST_TOTAL[I]=ACT[I]; NEXT I
3100 FOR I=0 TO ACCT_LENGTH-1
3105 SUBTOTAL=0,FIRST_DIGIT=0,SECOND_DIGIT=0
3120 FIRST_DIGIT=INT(FIRST_TOTAL[I]/10)
3130 SECOND_DIGIT=MOD(FIRST_TOTAL[I],10)
3140 TOTAL=TOTAL+FIRST_DIGIT+SECOND_DIGIT
3150 NEXT I
3175 IF MOD(TOTAL,10)=0 THEN FLAG$="GOOD"
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 EXIT 
9950 RUN "ZMENU"
9999 END 
56000 REM "192616-On credit card orders that have been backordered, need to      
