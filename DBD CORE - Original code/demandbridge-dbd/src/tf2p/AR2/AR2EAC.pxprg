0010 REM "A/R Invoice Data Entry II <AR2EAC>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 01/24/18 - 17.420833 - jvv - SSP# 295218
0037 REM "295218-Only seeing 4 records in GLV_DETAILINVT and no record for   
0040 REM "Copyright 2018 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 SETERR 0095; L$=""; ENTER X3$,X4$,A$,A{ALL},Z{ALL},Y1$,Y0$,F,Y{ALL},G0$,I0$,M$,P0$,E{ALL}; X0$="AR2EAC",L$="Y"; DIM T[30]; SETERR 9000; GOTO 7000
0095 SETERR 9000
0100 REM "
0110 ON L0 GOTO 7000,8000,8000,7100
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 FID_0$=FID(0); IF %IN_WEBEC$="Y" THEN FID_0$(1,1)="G"
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0350 IOLIST E$,E[0],E[1],E[2],E[3]
0430 IOLIST X0,B$,B[0],B[1],B[2],B[3],B[4],B[5]
1036 %IL_IMAGE_TYPE$="",%IL_IMAGE_KEY$=""
5300 REM "REMOVE INDEX Z
5310 EXTRACT (F,IND=0)IOL=0290
5315 IF Y[4]=-2 THEN READ (F); WAIT 0; GOTO 5310 ELSE Y[4]=-2
5320 WRITE (F,IND=0)IOL=0290
5330 WRITE (F,IND=Z)Y[1]
5340 Y[1]=Z,Y[4]=-1,Y[0]=Y[0]-1
5350 WRITE (F,IND=0)IOL=0290
5390 RETURN 
5395 ON ERR GOTO 5310,5311,9000
6704 %IL_IMAGE_TYPE$="",%IL_IMAGE_KEY$=""
7000 REM "RUN OVERLAY
7001 IF E[1]<=1 THEN REMOVE (Z[11],KEY=A$(1,14),DOM=7004); GOTO 7004
7002 FIND (Z[5],KEY=A$(65,2),DOM=7003)IOL=0350
7003 CALL "AR2EAG",X3$,X4$,"",A1$,A[9],A[10],A$(116,6),A$(122,6),E$,E[0],E[1],E[2]
7005 Z$="03C AR1...  07C AR5...  11C ARC...  11O FS3...  02C FMP...  02O ARD...  13C FM0...  13O ART...  09C AR3...  09O ARI...  08C AR4...  08O GL1...  12C ARG...  12O ARV...  04C PO3...  04O FM0...  15O FS2...  25O GLW...  "
7006 IF %ACTION$="C" THEN Z$="03C AR1...  07C AR5...  11C GRC...  11O GS3...  02C FMP...  02O GRD...  13C FM0...  13O GRT...  09C AR3...  09O ARI...  08C AR4...  08O GL1...  12C ARG...  12O ARV...  04C PO3...  04O FM0...  15O FS2...  25O GLW...  "
7010 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 7011,9900
7012 IF L$="Y" THEN JJ=FFN("ZZPARM"); IF JJ<>0 THEN READ (JJ,KEY=X3$(9,3)+"G/L")G0$; G8=NUM(G0$(170,2),ERR=7013) ELSE CLOSE (14); OPEN (14)"ZZPARM"; READ (14,KEY=X3$(9,3)+"G/L")G0$; G8=NUM(G0$(170,2),ERR=7013); REM "ssp#106776 If being called need to read G0$ in, we won't have it.
7013 IF L$="Y" THEN GOTO 7022
7014 PRINT (0,ERR=7015)@(0,6),'CE','SB',
7015 PRINT @(3,6),"Name:",@(48),"Net Amount:",@(0,7),Z0$,
7016 PRINT (0,ERR=7017)'SF',
7020 PRINT @(9,6),A$(25,35),@(60),A[1]:M0$,
7022 DIM E$(350); IF POS(" "<>A$(92,8))>0 THEN FIND (Z[10],KEY=A$(92,8),DOM=7023)E$
7023 IF %HAS_IMAGE_LIB THEN %IL_IMAGE_TYPE$="ORDER",%IL_IMAGE_KEY$=A$(92,8)
7025 GOSUB 8400
7040 X0$="AR2EAC",L0=1,A5=0
7045 X3$(15,6)=A$(86,6),L0=1,F=Z[2],A0=A[0],V1=0,V9=-2,V3=Z[8],T[0]=-A[1]; IF A[20]>0 THEN T[0]=-A[1]
7048 Z$="15C FS2...  15O ASQ...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 7049,7049; REM "ssp94807, close FS2 opened on 7005
7050 IF L$="Y" THEN IF LEN(T9$)>=12 THEN CALL "GL2XAB",X3$,T9$,T{ALL},V9$,F,A0; A[0]=A0 END_IF ; GOTO 8000 ELSE RUN "GL2XAA"
7100 REM "RE-DO SCREEN AND RUN 2ND OVERLAY
7105 V0=0,M0$="-#,###,###.00",M1$="-###,###.00"
7110 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,0,0,0
7120 PRINT (0,ERR=7121)'SB',
7130 PRINT @(3,3),"Fiscal year:",@(29,3),"Accounting period:",@(0,4),"Invoice number:",@(33,4),"Customer code:",@(0,5),Z0$,@(3,6),"Name:",@(0,7),Z0$,
7135 PRINT (0,ERR=7136)'SF',
7140 PRINT @(16,3),A$(1,4),@(44,3),A$(5,2),
7145 PRINT @(49,3),"Ending ",FND$(P1$(NUM(A$(5,2))*6+15,6)),
7150 CALL "ZZDISP","A",A$(7,8),"AR6",X3$,"","",16,4,X4$
7155 PRINT @(9,6),A$(25,35),@(60),A[1]:M0$,
7190 GOTO 7050
7200 REM "Return from lines
7205 GOTO 9800
7210 Z$="10C GL1...  13C ARI...  "
7220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 7221,7221
7225 C9=-1,V0=0,M0$="-#,###,###.00",M1$="-###,###.00"
7230 IF %IN_WEBEC$="N" THEN PRINT @(0,6),'CE',
7250 GOTO 1630
7500 REM "W/O?
7510 DIM D[1]; FIND (Z[11],KEY=A$(7,8)+A$(92,8)+B$(47,3)+" ",DOM=7590)*,*,*,*,*,*,D[0]
7515 IF B$(1,1)="N" THEN Q0$=Q$(190,12)
7520 Q0=-D[0]
7530 J9=1; GOSUB 8700
7540 Q0=(-B[5])-Q0
7550 REM "APPLIED OVERHEAD ACCT"
7560 Q0$=Q$(178,12); J9=0; GOSUB 8700
7590 RETURN 
8000 REM "RESET FILES FOR 1ST OVERLAY Must close and reopen AR1 since it is closed and opened in AR2EBG
8005 V0=0
8008 Z$="03C AR1...  11C FS3...  02C ARD...  02O FMP... 09C ARI...  08C GL1...  12C ARV...  04C FM0... 05O AR2... 13C ART...  "; REM "GOSUB 9750
8009 IF %ACTION$="C" THEN Z$="03C AR1...  11C FS3...  02C GRD...  02O FMP... 09C ARI...  08C GL1...  12C ARV...  04C FM0... 05O AR2... 13C GRT...  "; REM "GOSUB 9750
8010 GOSUB 9750
8011 IF L$="Y" THEN DIM P2$(255); JJ=FFN("ZZPARM"); IF JJ<>0 THEN READ (JJ,KEY=X3$(9,3)+"AR1",DOM=8012)P2$ ELSE CLOSE (14); OPEN (14)"ZZPARM"; READ (14,KEY=X3$(9,3)+"AR1",DOM=8012)P2$; REM "WO122361, if called we don't have P2$, need for immediate print options
8012 DIM CUST_DEF$(243); FIND (Z[2],KEY="D"+A$(15,10),DOM=8013)CUST_DEF$
8015 IF POS(MID(P2$,65,1)="YC")=0 OR A$(345,1)<>"Y" OR L0=2 THEN GOTO 8040 ! SSP#238636
8017 IF P2$(65,1)="C" THEN IF CUST_DEF$(234,1)="P" THEN GOTO 8021 ELSE IF CUST_DEF$(234,1)<>"Y" THEN GOTO 8040; REM "If cust specific imm prt then if P then just print else if Y ask question
8020 IF L$<>"Y" AND L0<>2 THEN CALL "ZZPROM",".Y",X3$,Z,"Print this invoice now?","","",0; ON Z GOTO 8021,8040 ! SSP#238636
8029 IF L$="Y" THEN A1$=A$(1,14)
8030 IF %ACTION$="" THEN CALL "AR2EBY",X3$,X4$,A1$,""
8031 IF L$="Y" THEN A1$=""
8035 A$(64,1)="P"
8039 Y0$="",Y1$=""
8040 Z$="01O ARB...  02O FMP...  03O AR1...  05O AR2...  10O FS1...  11O ARC...  09O AR3...  08O AR4...  07O AR5...  12O FMN...  04O PO3...  13O FM0...  "; REM "GOSUB 9750
8041 IF %ACTION$="C" THEN Z$="01O GRB...  02O FMP...  03O AR1...  05O AR2... 10O FS1...  11O GRC...  09O AR3...  08O AR4...  07O AR5...  12O FMN...  04O PO3...  13O FM0...  "; REM "GOSUB 9750
8042 GOSUB 9750
8043 REM "Added open of AR2 to Z$ - cwj 3/10/98 SSP# 096213
8050 IF L$<>"Y" THEN PRINT @(0,4),'CE',
8060 Z0$=""
8090 IF L$="Y" THEN GOTO 9800 ELSE RUN "AR2EAA"
8400 REM "Set up T9$, and T() for default lines
8402 GOSUB 8900
8404 IF A[20]>0 THEN GOTO 8500
8405 DIM Q8$(9)
8410 IF P0$(19,1)<>"Y" THEN Q8$(1)=A$(15,2) ELSE Q8$(1)=A$(153,9)
8420 DIM Q9$(202); Q9$(1,9)=Q8$; FIND (Z[9],KEY=Q8$,DOM=8421)Q9$
8425 T9$=Q9$(94,12),T[1]=-A[1]
8430 IF POS(G0$(40,1)="A")>0 THEN T9$=T9$+Q9$(106,12)+Q9$(118,12),T[2]=A[11],T[3]=-A[11]
8435 Q9$=""
8490 RETURN 
8500 REM "G/L INTERFACE TO DETAIL
8502 IF LEN(I0$)<42 THEN DIM I$(40); FIND (Z[6],KEY=X3$(9,3)+"I/C",DOM=8503)I0$
8505 T9$="",J9=0,I0=NUM(I0$(40,2)),I1=NUM(I0$(42,1)); DIM T[30],B$(104),B[5],M$(223)
8510 IF A[20]=0 THEN GOTO 8595 ELSE IF A[0]>0 THEN GOSUB 8900
8520 X0=A[20]
8521 IF G0$(32,1)="Y" AND A[20]=X0 THEN GOSUB 8800; REM "CLEAR THE ENTRIES
8525 IF X0<=0 THEN GOTO 8595
8530 READ (Z[13],IND=X0)IOL=0430
8535 IF POS(B$(1,1)="M")<>0 OR (B[4]=0 AND B[5]=0) THEN GOTO 8525
8537 DIM FS2$(228); FIND (Z[15],KEY=A$(92,8)+B$(47,3),DOM=8538)FS2$; REM "ssp90847, will check for PO code, if none then no WIP entry
8540 FIND (Z[12],KEY=B$(75,9),DOM=8541)Q$
8545 Q=0; IF A$(77,1)="C" THEN Q=1
8547 DIM GLW$(99),GLW[1]; GLW$(1,8)=A$(7,8),GLW$(26,20)=B$(55,20),GLW$(9,3)=B$(47,3),GLW$(46,1)=FS2$(9,1),GLW$(47,4)=E$(93,4),GLW$(51,16)=E$(106,16)
8548 IF A[20]=X0 THEN LINE=1 ELSE LINE=LINE+1; REM " SSP 172448
8550 Q=94+Q*36,Q0$=Q$(Q,12),Q0=-B[4]; GOSUB 8700
8555 IF POS(G0$(40,1)="AC")>0 AND POS(B$(1,1)="IC")<>0 AND B$(89,4)<>"DS  " AND B$(89,4)<>"    " THEN Q=Q+12,Q0$=Q$(Q,12),Q0=B[5]; GOSUB 8700; Q=Q+12,Q0=-Q0,Q0$=Q$(Q,12),J9=1; IF E$(43,1)="Y" AND B$(47,3)<>"   " THEN GOSUB 7500 ELSE GOSUB 8700
8560 IF E$(43,1)="Y" AND B$(47,1)<>"   " AND B$(1,1)="N" THEN Q=Q+12,Q0$=Q$(Q,12),Q0=B[5]; GOSUB 8700; GOSUB 7500
8570 IF POS(" "<>Q$(202,12))>0 AND POS(G0$(40,1)="AC")>0 AND POS(B$(89,4)="    DS  ",4)>0 AND (FS2$(9,1)<>" " OR P0$(120,1)="Y") THEN Q=Q+12,Q0$=Q$(Q,12),Q0=B[5]; GOSUB 8700; Q0=-Q0,Q0$=Q$(202,12); IF POS(P0$(121,1)="YD")>0 THEN GOSUB 8700 ELSE GOSUB 8705; REM "SKIP DIV & WHSE SUBSTITUTION SSP 83064 unless parm set ssp98579, added FS2 PO code check on ssp90847, added a/r parm check on ssp98118
8590 GOTO 8525
8595 DIM M$(0); RETURN 
8600 REM "Digit replacement (2 digits)
8605 IF J9=1 THEN J9=0; GOTO 8620
8606 IF G8<=0 THEN GOTO 8612
8609 REM "Division subsitition - OR - Salesperson
8610 IF POS(P0$(121,1)="DN")>0 AND Q$(202,G8)=Q0$(G8,2) THEN Q0$(G8,2)="00"
8611 IF P0$(13,1)="Y" THEN Q0$(G8,2)=A$(15,2) ELSE IF P0$(13,1)="S" AND NUM(A$(135,2),ERR=8611)>=0 THEN Q0$(G8,2)=STR(NUM(A$(135,2)):"00")
8612 IF P0$(13,1)<>"S" AND P0$(110,2)>"00" AND NUM(A$(135,2),ERR=8613)>=0 THEN Q0$(NUM(P0$(110,2),ERR=8611),2)=STR(NUM(A$(135,2)):"00")
8613 IF P0$(110,2)<>DIM(2) AND POS(P0$(121,1)="D")>0 AND Q$(202,G8-1)=Q0$(1,G8-1) THEN Q0$(NUM(P0$(110,2),ERR=8616),2)="00"
8614 IF Q$(202,G8-1)=Q0$(1,G8-1) AND P0$(13,1)="Y" AND P0$(121,1)="D" THEN Q0$(G8,2)=A$(15,2); REM " SSP# 
8615 IF Q$(202,G8-1)=Q0$(1,G8-1) AND P0$(121,1)="Y" THEN TEST_P0$=MID(Q0$,NUM(P0$(110,2),ERR=*NEXT),2,ERR=*NEXT); Q0$(NUM(P0$(110,2),ERR=*NEXT),2)=STR(NUM(A$(135,2)):"00"); REM " SSP# TEST_P0$=mid is to see if p0$(110,2) is a valid number (ie not 0), in that case no substitution takes place
8616 GOTO 8640
8619 REM "Warehouse substitution
8625 IF M$(1,1)<>"D" OR M$(12,4)<>B$(89,4) THEN DIM M$(223); READ (Z[4],KEY="D"+M$(1,10)+B$(89,4),DOM=8626)M$
8630 IF POS(" "<>M$(214,I1))=0 THEN GOTO 8640
8635 Q0$(I0,I1)=M$(214,I1)
8640 RETURN 
8690 RETURN 
8700 REM "ACCUM
8702 IF G0$(149,1)="Y" OR (J9=1 AND I0$(39,1)="Y") THEN GOSUB 8600
8705 IF Q0=0 THEN GOTO 8790
8706 GLW$(14,12)=Q0$
8707 GLW[0]=Q0
8710 P=POS(Q0$=T9$,LEN(Q0$)); IF P=0 THEN T9$=T9$+Q0$; GOTO 8710 ELSE P=INT(P/LEN(Q0$))+1
8720 T[P]=T[P]+Q0
8722 GOTO 8790 ! SSP 295218 Process to write GLW now in AR2DUA
8725 IF G0$(32,1)<>"Y" THEN GOTO 8790; REM " SSP 172448
8730 WRITE_SEQ$=STR(1:"00")
8732 GLW$(12,2)=WRITE_SEQ$
8735 WRITE (Z[25],KEY=GLW$(1,13),DOM=*NEXT)GLW$,GLW[0],GLW[1]; GOTO 8790
8740 WRITE_SEQ$=FN%NEXT_SEQ$(WRITE_SEQ$,1); GOTO 8732
8790 RETURN 
8800 REM "REMOVE INVOICE ENTRIES FROM GLW FILE
8805 RETURN ! SSP 295218 Process to update GLW now in AR2DUA
8810 READ (Z[25],KEY=A$(7,8),DOM=*NEXT)
8820 K$=KEY(Z[25],END=8890)
8830 IF K$(1,8)<>A$(7,8) THEN GOTO 8890
8840 REMOVE (Z[25],KEY=K$)
8850 GOTO 8820
8890 RETURN 
8900 REM "DELETE CURRENT LIST
8905 F=Z[2],Z=A[0]
8915 IF Z<=0 THEN GOTO 8990 ELSE READ (F,IND=Z)Z9
8920 GOSUB 5300
8930 Z=Z9; GOTO 8915
8990 A[0]=0; RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9704 %IL_IMAGE_TYPE$="",%IL_IMAGE_KEY$=""
9750 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 9751,9900
9760 RETURN 
9800 REM "EXIT PROGRAM
9805 C0=0
9900 REM "END PROGRAM
9904 %IL_IMAGE_TYPE$="",%IL_IMAGE_KEY$=""
9910 IF L$="Y" THEN CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 REM "238636-AR invoicing - System should NOT ask question, do you wish  
56002 REM "295218-Only seeing 4 records in GLV_DETAILINVT and no record for   
