0010 REM "<AR2DUM> Read invoices from ARB file - for ODBC update ssp 164962
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 12/14/20 - 12.233888 - dmm - SSP# 307319
0037 REM "307319-DBSPT-87098-DBD-147; Change timing of ShipNotice Request to 
0040 REM "Copyright 2020 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$
0100 SETERR 9000
0110 X0$="AR2DUM",X1$="Read invoices from ARB file for ODBC Access"
0120 DIM Z0$(80,"-")
0130 K0=20,K1=1,C=1
0135 C9=-1
0140 DIM Z1$(15," "),I[20]
0300 IOLIST ARC$,ARC[0],ARC[1],ARC[2],ARC[3],ARC[4],ARC[5],ARC[6],ARC[7],ARC[8],ARC[9],ARC[10],ARC[11],ARC[12],ARC[13],ARC[14],ARC[15],ARC[16],ARC[17],ARC[18],ARC[19],ARC[20],ARC[21],ARC[22],ARC[23]
0301 IOLIST AZC$,AZC[0],AZC[1],AZC[2],AZC[3],AZC[4],AZC[5],AZC[6],AZC[7],AZC[8],AZC[9],AZC[10],AZC[11],AZC[12],AZC[13],AZC[14],AZC[15],AZC[16],AZC[17],AZC[18],AZC[19],AZC[20],AZC[21],AZC[22],AZC[23]
0310 IOLIST K0,ARD$,ARD[0],ARD[1],ARD[2],ARD[3],ARD[4],ARD[5],ARD[6],ARD[7]
0311 IOLIST AZD$,AZD[0],AZD[1],AZD[2],AZD[3],AZD[4],AZD[5],AZD[6],AZD[7]
0320 IOLIST K0,ART$,ART[0],ART[1],ART[2],ART[3],ART[4],ART[5],ART[6],ART[7],ART[8],ART[9],ART[10],ART[11],ART[12],ART[13],ART[14],ART[15],ART[16],ART[17],ART[18],ART[19],ART[20],ART[21],ART[22],ART[23],ART[24],ART[25],ART[26],ART[27],ART[28],ART[29],ART[30],ART[31],ART[32],ART[33],ART[34],ART[35],ART[36],ART[37],ART[38],ART[39],ART[40],ART[41],ART[42],ART[43],ART[44],ART[45],ART[46],ART[47],ART[48] ! SSP 249775
0321 IOLIST AZT$,AZT[0],AZT[1],AZT[2],AZT[3],AZT[4],AZT[5],AZT[6],AZT[7],AZT[8],AZT[9],AZT[10],AZT[11],AZT[12],AZT[13],AZT[14],AZT[15],AZT[16],AZT[17],AZT[18],AZT[19],AZT[20],AZT[21],AZT[22],AZT[23],AZT[24],AZT[25],AZT[26],AZT[27],AZT[28],AZT[29],AZT[30],AZT[31],AZT[32],AZT[33],AZT[34],AZT[35],AZT[36],AZT[37],AZT[38],AZT[39],AZT[40],AZT[41],AZT[42],AZT[43],AZT[44],AZT[45],AZT[46],AZT[47],AZT[48] ! SSP 249775
0330 IOLIST FS3$,FS3[0],FS3[1],FS3[2],FS3[3],FS3[4],FS3[5],FS3[6],FS3[7],FS3[8],FS3[9]
0331 IOLIST AZ3$,AZ3[0],AZ3[1],AZ3[2],AZ3[3],AZ3[4],AZ3[5],AZ3[6],AZ3[7],AZ3[8],AZ3[9]
0340 IOLIST ASD$,ASD[0],ASD[1],ASD[2],ASD[3],ASD[4],ASD[5],ASD[6],ASD[7],ASD[8],ASD[9],ASD[10],ASD[11],ASD[12],ASD[13],ASD[14],ASD[15],ASD[16]
0341 IOLIST AZS$,AZS[0],AZS[1],AZS[2],AZS[3],AZS[4],AZS[5],AZS[6],AZS[7],AZS[8],AZS[9],AZS[10],AZS[11],AZS[12],AZS[13],AZS[14],AZS[15],AZS[16]
0390 IOLIST ARB$,ARB[0],ARB[1],ARB[2],ARB[3],ARB[4],ARB[5],ARB[6],ARB[7],ARB[8],ARB[9],ARB[10],ARB[11],ARB[12],ARB[13],ARB[14],ARB[15],ARB[16],ARB[17],ARB[18],ARB[19],ARB[20],ARB[21],ARB[22],ARB[23],ARB[24],ARB[25],ARB[26],ARB[27],ARB[28],ARB[29],ARB[30]
0391 IOLIST AZB$,AZB[0],AZB[1],AZB[2],AZB[3],AZB[4],AZB[5],AZB[6],AZB[7],AZB[8],AZB[9],AZB[10],AZB[11],AZB[12],AZB[13],AZB[14],AZB[15],AZB[16],AZB[17],AZB[18],AZB[19],AZB[20],AZB[21],AZB[22],AZB[23],AZB[24],AZB[25],AZB[26],AZB[27],AZB[28],AZB[29],AZB[30]
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="09O ARB...  10O ARC...  11O ARD...  13O ZZPARM  14O ART...  15O ASD...  16O FS3...  19O AZB...  20O AZC...  21O AZD...  24O AZT...  25O AZS...  26O AZ3...  27O FS1...  28O PO3...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0560 DIM ECS$(1275); READ (Z[13],KEY=X3$(9,3)+"E/C",DOM=*NEXT)ECS$ ! WO224137
0600 READ (Z[13],KEY=X3$(9,3)+"A/R")P3$
0990 READ (Z[9],KEY="",DOM=*NEXT) ! SSP286899, position to beginning of file, there could be a "" record so need to check that in 1000's
1000 REM "Main Process - READ ARB
1005 INV$=KEY(Z[9],END=9900)
1006 IF INV$="" THEN READ (Z[9],KEY=INV$); GOTO 1005 ! SSP286899, if we have "" record then position to the next one
1010 DIM ARB[30]; READ (Z[9],KEY=INV$,DOM=1011)IOL=0390; REM "Initial read from orders file (ARB)
1050 REM "UPDATE AZB FILE - COPY OF ARB
1060 DIM AZB[31],AZB$(703)
1070 AZB$(1,14)=ARB$(1,14)
1080 AZB$(18,400)=MID(ARB$,15,400)
1090 AZB$(418,6)=X3$(178,6); REM "AUDIT CONTROL NUMBER"
1100 AZB$(424,4)=X3$(174,4); REM "BATCH NUMBER"
1101 AZB$(428,5)=MID(ARB$,415,5); REM " SALESMEN BUCKETS  ssp#172885
1104 AZB$(433,6)=ARB$(86,6) ! SSP194808 - use invoice date as default, for cm
1105 IF ARB$(92,8)<>DIM(8) THEN FIND (Z[27],KEY=ARB$(92,8),ERR=*NEXT)FS1$; AZB$(433,6)=FS1$(16,6),AZB$(439,20)=FS1$(129,20) ! SSP194808, SSP195039
1107 IF ARB$(92,8)<>DIM(8) THEN DIM PO3$(428); FIND (Z[28],KEY=ARB$(92,8)+DIM(5),DOM=*NEXT)PO3$(1); AZB$(507,30)=PO3$(16,30) ! WO301029, general shipping attn
1110 AZB$(459,1)=MID(ARB$,420,1),AZB$(460,20)=MID(ARB$,421,20),AZB$(480,6)=MID(ARB$,441,6) ! SSP#228772
1111 AZB$(486,3)=MID(ARB$,447,3),AZB$(489,3)=MID(ARB$,450,3) ! WO240665, operator code when first entered and last accessed
1112 AZB$(492,15)=MID(ARB$,453,15) ! WO264703, invoice job card override
1115 DIM AZB[30]; FOR I=0 TO 30; AZB[I]=ARB[I]; NEXT I ! SSP#230380
1120 WRITE_SEQ$=STR(1:"000")
1125 AZB$(15,3)=WRITE_SEQ$
1130 WRITE (Z[19],KEY=AZB$(1,17),DOM=1131)IOL=0391; GOTO 1140; REM " WRITE TO AZB
1131 IF WRITE_SEQ$="999" THEN ESCAPE ELSE WRITE_SEQ$=STR(NUM(WRITE_SEQ$)+1:"000")
1132 GOTO 1125
1150 REM " READ ART FILE
1151 LINE$="000"
1160 DIM ART[48] ! SSP 249775
1170 IF ARB[20]<=0 THEN GOTO 1350 ELSE K0=ARB[20]
1180 READ (Z[14],IND=K0)IOL=0320
1185 IF LINE$="999" THEN ESCAPE ELSE LINE$=STR(NUM(LINE$)+1:"000")
1190 DIM AZT[48]; FOR I=O TO 47; AZT[I]=ART[I]; NEXT I ! SSP 249775
1200 DIM AZT$(290) ! WO266633, change DIM from 160 to 290
1210 AZT$(1,14)=ARB$(1,14)
1220 AZT$(21)=MID(ART$,1,289)
1290 REM "IF K0>0 THEN GOTO 1180
1300 REM " WRITE RECORD FOR AZT
1315 AZT$(15,3)=WRITE_SEQ$; AZT$(18,3)=LINE$
1320 WRITE (Z[24],KEY=AZT$(1,20))IOL=0321; REM " WRITE TO AZT
1322 IF K0>0 THEN GOTO 1180
1400 REM "READ ARC
1410 DIM ARC[23]; READ (Z[10],KEY=ARB$(1,14),DOM=1600)IOL=0300
1420 REM "ARC_KEY$=KEY(Z[10],END=1600)
1430 REM "IF ARC_KEY$(1,14)<>ARB$(1,14) THEN GOTO 1600
1440 REM "READ (Z[10],KEY=ARC_KEY$)IOL=0300
1450 DIM AZC$(161)
1460 AZC$(1,14)=ARC$(1,14)
1470 AZC$(18)=ARC$(15,144)
1480 DIM AZC[23]; FOR I=0 TO 23; AZC[I]=ARC[I]; NEXT I
1490 AZC$(15,3)=WRITE_SEQ$
1500 WRITE (Z[20],KEY=AZC$(1,17))IOL=0301; REM " WRITE TO AZC
1510 REM "GOTO 1420
1600 REM "READ ARD
1610 LINE$="000"
1640 IF ARB[0]<=0 THEN GOTO 1750 ELSE K0=ARB[0]
1650 DIM ARD[7]; READ (Z[11],IND=K0)IOL=0310
1660 DIM AZD$(56); IF NUL(ARD$) THEN ARD$=DIM(38)
1665 AZD$(1,14)=ARB$(1,14); AZD$(21)=ARD$(1,37)
1670 DIM AZD[7]; FOR I=0 TO 7; AZD[I]=ARD[I]; NEXT I
1680 IF LINE$="999" THEN ESCAPE ELSE LINE$=STR(NUM(LINE$)+1:"000")
1685 AZD$(15,3)=WRITE_SEQ$; AZD$(18,3)=LINE$
1690 WRITE (Z[21],KEY=AZD$(1,20))IOL=0311
1720 IF K0>0 THEN GOTO 1650
1800 REM " READ ASD
1810 READ (Z[15],KEY=ARB$(1,14),DOM=*NEXT)
1820 ASD_KEY$=KEY(Z[15],END=1900)
1825 IF ASD_KEY$(1,14)<>ARB$(1,14) THEN GOTO 1900
1830 DIM ASD[16]; READ (Z[15],KEY=ASD_KEY$)IOL=0340
1840 DIM AZS$(48)
1850 AZS$(1,24)=ASD$(1,24)
1853 AZS$(25,3)=WRITE_SEQ$
1855 DIM AZS[16]; FOR I=0 TO 16; AZS[I]=ASD[I]; NEXT I
1870 WRITE (Z[25],KEY=AZS$(1,27))IOL=0341
1880 GOTO 1820
1900 REM "READ FS3
1920 READ (Z[16],KEY=ARB$(7,8)+ARB$(92,8),DOM=*NEXT)
1930 FS3_KEY$=KEY(Z[16],END=2100) ! WO224137 - change END from 8999
1935 IF FS3_KEY$(1,16)<>ARB$(7,8)+ARB$(92,8) THEN GOTO 2100 ! WO224137 - was GOTO 8999
1940 DIM FS3[9]; READ (Z[16],KEY=FS3_KEY$)IOL=0330
1950 DIM AZ3$(53)
1960 DIM AZ3[9]; FOR I=0 TO 9; AZ3[I]=FS3[I]; NEXT I
1970 AZ3$(1,20)=FS3$(1,20)
1980 AZ3$(24)=FS3$(21,30)
1995 AZ3$(21,3)=WRITE_SEQ$
2000 WRITE (Z[26],KEY=AZ3$(1,23))IOL=0331
2010 GOTO 1930
2100 ! done with AZ3 WO224137
3000 ! WO224137 - done writing records for this invoice - see if we need to generate a Ship Notice request
3010 IF ECS$(1179,1)="Y" AND NOT(NUL(AZB$(95,8))) THEN AZB_KEY$=AZB$(1,17),ORDER$=AZB$(95,8); CALL "EC3SN0;ENQUEUE",ERR=*NEXT,X3$,X4$,AZB_KEY$,ORDER$,OTHER$ ! SSP307319-DBD-147 QUEUE EES FOR LATER PROCESSING TRIGGERED IN AR2DUG CALL "EC3SN0",X3$,X4$,AZB_KEY$,ORDER$,OTHER$ ! WO224137 - create EC ship notice request
3020 IF ECS$(1181,1)="Y" AND NOT(NUL(AZB$(95,8))) THEN AZB_KEY$=AZB$(1,17),ORDER$=AZB$(95,8),CUST$=AZB$(18,10); CALL "EC3IN2",X3$,X4$,AZB_KEY$,ORDER$,CUST$,OTHER$ ! WO233141, create EC invoice request. SSP282961, add CUST$
8999 GOTO 1000
9000 REM "Error Processing
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM "Transfer Control
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "Ctrl Logic
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "End Program
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 EXIT 
9999 END 
56000 REM "194808-Work Order to update the Order date to File AZB             
56002 REM "195039-Work Order to add Ordered By field from Order Header        
56004 REM "224137-Capture Four51 info by order, retrieve later for ShipNotice
56006 REM "233141-Ability to output an XML AR Invoice for H&R Block 
56008 REM "240665-Add first and last operator code fields to AR Invoice Header
56009 REM "249775-Changes to sales tax parameters and tax calculations to     
56010 REM "264703-AR Invoice Entry; ability to enter Job Card Override.  If   
56012 REM "266633-Add vendor division, code, plant from order line to ART/AZT 
56014 REM "282961-Pass customer into EC3IN2 to trigger by cust sender ID
56016 REM "286899-See 282961/107, 285900/352; Timing issue with XML Output of 
56018 REM "301029-Attention from order general shipping record prints on AR   
56020 REM "307319-DBSPT-87098-DBD-147; Change timing of ShipNotice Request to 
