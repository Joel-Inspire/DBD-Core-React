0010 ! APGMPE - File Maintenance Program for APX_GLInterface (="APX"+%C$)
0020 ! Generated by ProvideX® NOMADS II File Maintenance on May. 15, 2003 10:00
0030 ! ************************************************************************
0035 REM "5.7 - 09/07/11 - 11.881666 - jdf - SSP# 249158
0037 REM "249158-Program: FMSGMCA OP Special Charge. Exit button does not    
0040 REM "Copyright 2011 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 PROCESS "FSGMCA","../OPG/OP.EN"
0060 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 ! 
0130 X0$="FSGMCA",X1$="O/P Special Charge Setup"
0140 ! 
0150 X0=-1,X2=-1
0160 CALL "ZZCOMP",X0$,X11$,X2$,X3$,X4$,X5$,X0,X1,X2; IF X1>0 THEN GOSUB WRAPUP
0170 ! 
0190 DIM Z[NUM(X3$(60,3))],FMP[2],B_FMP[2]
0195 DIM FMP$(222) ! SSP 229728
0200 ! Files
0209 REM + [202418]-Modifed line 210 to also open XPX
0210 Z$="01X FMP...  02O XPX...  06O ZZPARM  "
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
0300 ! IOList Section
0310 IOLIST FMP$(1),FMP{ALL}
0320 ! 
0330 ! 
0400 ! System Parameters
0410 GOSUB GET_SYS_PARAM
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0520 ! 
0530 CALL "*WINGRP;DISABLE",FIELDS.GRP$
0780 REFRESH_FLG=1
0790 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0970 RETURN 
1000 ! find Record
1010 FIND_REC:
1015 SPECIAL_CHARGE_CODE$=PAD(SPECIAL_CHARGE_CODE$,10)
1020 KEY_1$="X"+SPECIAL_CHARGE_CODE$
1030 FIND (Z[1],KEY=KEY_1$,DOM=TERM_MSG)IOL=0310
1040 ! 
1050 SPECIAL_CHARGE_DESC$=FMP$(12,40)
1060 PROD_CODE$=FMP$(52,3)
1070 SELL_UM$=FMP$(55,4)
1080 SELL_QTY_PER=FMP[0]; PRICE=FMP[1]; TF_COST=FMP[2] ! SSP227008 jdf
1090 KEEP_ORDER_HISTORY$=FMP$(59,1)
1100 FRT_AMT$=FMP$(60,1)
1110 EXT_ONLY$=FMP$(61,1)
1120 NOT_WEBEC$=FMP$(62,1)
1130 WEBEC_SPEC_CHG_CD$=FMP$(63,10)
1140 FRT_AS_LINE$=MID(FMP$,73,1) ! SSP 229728
1170 CALL "*WINGRP;ENABLE",BUTTONS.GRP$
1172 CALL "*WINGRP;ENABLE",FIELDS.GRP$
1173 GOSUB SEL_UM ! SSP 229728
1175 B_FMP$=FMP$; B_FMP{ALL}=FMP{ALL}
1180 REFRESH_FLG=1
1190 RETURN 
1500 ! Write Record
1510 WRITE_REC:
1515 IF STP(SPECIAL_CHARGE_CODE$)="" THEN NEXT_ID=SPECIAL_CHARGE_CODE.CTL; EXIT ! SSP249158 jdf
1520 ! MSGBOX MSG("ADD_RECORD"),MSG("CONFIRM"),"?,YesNo",ANS$
1530 ! IF ANS$="NO" THEN RETURN 
1535 IF STP(SELL_UM$)="" THEN GOTO 18055 ! SSP249458 jdf
1540 WRITE (Z[1],KEY=KEY_1$)IOL=0310
1544 REM + [202418]-Added line 1545 to update XPX
1545 CALL "UPDFMP;DUPLICATE_XPX",Z[2],FMP$,FMP{ALL},"U"
1550 ! MSGBOX "Record Updated!","FYI","!"
1570 GOSUB CLEAR_INFO
1575 DIM FMP$(222),FMP[2] ! !SSP 229728
1580 B_FMP$=FMP$; B_FMP{ALL}=FMP{ALL}
1585 CALL "*WINGRP;DISABLE",FIELDS.GRP$
1590 RETURN 
2000 ! Load Information
2010 LOAD_INFO:
2020 SPECIAL_CHARGE_CODE$=FMP$(2,10)
2030 SPECIAL_CHARGE_DESC$=FMP$(12,40)
2040 PROD_CODE$=FMP$(52,3)
2050 SELL_UM$=FMP$(55,4); GOSUB SEL_UM
2060 SELL_QTY_PER=FMP[0]; PRICE=FMP[1]; TF_COST=FMP[2] ! SSP227008 jdf
2070 KEEP_ORDER_HISTORY$=FMP$(59,1)
2080 FRT_AMT$=FMP$(60,1)
2090 EXT_ONLY$=FMP$(61,1)
2100 NOT_WEBEC$=FMP$(62,1)
2110 WEBEC_SPEC_CHG_CD$=FMP$(63,10)
2120 FRT_AS_LINE$=MID(FMP$,73,1) ! SSP 229728
2160 CALL "*WINGRP;ENABLE",BUTTONS.GRP$
2165 CALL "*WINGRP;ENABLE",FIELDS.GRP$
2168 GOSUB SEL_UM ! SSP 229728
2170 B_FMP$=FMP$; B_FMP{ALL}=FMP{ALL}
2180 REFRESH_FLG=1
2190 RETURN 
2300 ! Load Slections
2310 LOAD_SELECTION:
2315 IF NUL(FMP$) THEN DIM FMP$(222),FMP[2] ! SSP 229728
2320 FMP$(1,1)="X"; FMP$(2,10)=SPECIAL_CHARGE_CODE$
2330 FMP$(12,40)=SPECIAL_CHARGE_DESC$
2340 FMP$(52,3)=PROD_CODE$
2350 FMP$(55,4)=SELL_UM$
2360 FMP[0]=SELL_QTY_PER; FMP[1]=PRICE; FMP[2]=TF_COST ! SSP227008 jdf
2370 FMP$(59,1)=KEEP_ORDER_HISTORY$
2380 FMP$(60,1)=FRT_AMT$; IF FRT_AMT$<>"Y" THEN FRT_AS_LINE$="N" ! SSP 229728
2390 FMP$(61,1)=EXT_ONLY$
2400 FMP$(62,1)=NOT_WEBEC$
2410 FMP$(63,10)=WEBEC_SPEC_CHG_CD$
2420 FMP$(73,1)=FRT_AS_LINE$ ! SSP 229728
2490 RETURN 
2500 ! Delete Record
2510 DELETE_REC:
2515 IF STP(SPECIAL_CHARGE_CODE$)="" THEN NEXT_ID=SPECIAL_CHARGE_CODE.CTL; EXIT ! SSP249158 jdf
2520 MSGBOX MSG("DELETE_REC"),MSG("CONFIRM"),"?,YesNo",ANS$
2530 IF ANS$="NO" THEN RETURN 
2540 REMOVE (Z[1],KEY=KEY_1$)
2544 REM + [202418]-Added line 1545 to update XPX
2545 CALL "UPDFMP;DUPLICATE_XPX",Z[2],FMP$,FMP{ALL},"D"
2550 ! MSGBOX "Record Deleted!","FYI","!"
2580 GOSUB CLEAR_INFO
2590 RETURN 
3000 ! First Record
3010 FIRST_REC:
3015 READ (Z[1],KEY="X",DOM=*NEXT)
3020 KEY_1$=KEY(Z[1],END=NO_FIRST); IF MID(KEY_1$,1,1)<>"X" THEN GOTO NO_FIRST
3030 READ (Z[1],KEY=KEY_1$)IOL=0310
3040 GOSUB LOAD_INFO
3090 RETURN 
3200 ! Last Record
3210 LAST_REC:
3215 READ (Z[1],KEY="X~~~~~~~~~~",DOM=*NEXT)
3220 KEY_1$=KEP(Z[1],ERR=NO_LAST); IF MID(KEY_1$,1,1)<>"X" THEN GOTO NO_LAST
3230 READ (Z[1],KEY=KEY_1$)IOL=0310
3240 GOSUB LOAD_INFO
3290 RETURN 
3400 ! Prior Record
3410 PRIOR_REC:
3415 IF NUL(KEY_1$) THEN GOTO FIRST_REC ELSE READ (Z(1),KEY=KEY_1$,DOM=*NEXT)
3420 KEY_1$=KEP(Z[1],END=START_FILE); IF MID(KEY_1$,1,1)<>"X" THEN GOTO START_FILE
3430 READ (Z[1],KEY=KEY_1$)IOL=0310
3440 GOSUB LOAD_INFO
3490 RETURN 
3600 ! Next Record
3610 NEXT_REC:
3615 IF NUL(KEY_1$) THEN READ (Z(1),KEY="X",DOM=*NEXT) ELSE READ (Z(1),KEY=KEY_1$,DOM=*NEXT)
3620 B_KEY_1$=KEY_1$,KEY_1$=KEY(Z[1],END=END_FILE); IF MID(KEY_1$,1,1)<>"X" THEN KEY_1$=B_KEY_1$; READ (Z(1),KEY=KEY_1$); GOTO END_FILE
3630 READ (Z[1],KEY=KEY_1$)IOL=0310
3640 GOSUB LOAD_INFO
3690 RETURN 
5000 ! Check Changes
5010 CHECK_CHANGES:
5020 IF FMP$=B_FMP$ AND FMP[0]=B_FMP[0] AND FMP[1]=B_FMP[1] AND FMP[2]=B_FMP[2] OR STP(SPECIAL_CHARGE_CODE$)="" THEN RETURN ! SSP249158 jdf
5025 IF STP(FMP$)="" THEN RETURN 
5027 REM IF STP(B_FMP$)="" THEN RETURN  ! SSP249158 jdf
5030 MSGBOX MSG("REC_ALTERD"),MSG("UPDATE"),"?,YesNo",ANS$
5040 IF ANS$="NO" THEN RETURN 
5050 GOSUB WRITE_REC
5090 RETURN 
6000 ! Clear Information
6010 CLEAR_INFO:
6020 SPECIAL_CHARGE_CODE$=""
6030 SPECIAL_CHARGE_DESC$=""
6040 PROD_CODE$=""
6050 SELL_UM$=""
6060 SELL_QTY_PER=0; PRICE=0; TF_COST=0 ! SSP227008 jdf
6070 KEEP_ORDER_HISTORY$=""
6080 FRT_AMT$=""
6090 EXT_ONLY$=""
6100 NOT_WEBEC$=""
6110 WEBEC_SPEC_CHG_CD$=""
6120 FRT_AS_LINE$="" ! SSP 229728
6160 CALL "*WINGRP;DISABLE",BUTTONS.GRP$
6165 CALL "*WINGRP;DISABLE",FIELDS.GRP$
6167 DIM FMP$(222),FMP[2]; B_FMP$=FMP$,B_FMP{ALL}=FMP{ALL} ! SSP 229728
6170 NEXT_ID=SPECIAL_CHARGE_CODE.CTL
6180 REFRESH_FLG=1
6190 RETURN 
8000 ! Messages
8010 TERM_MSG:
8015 IF STP(SPECIAL_CHARGE_CODE$)="" THEN NEXT_ID=SPECIAL_CHARGE_CODE.CTL; EXIT ! SSP249158 jdf
8020 MSGBOX MSG("ADD_RECORD"),MSG("CONFIRM"),"?,YesNo",ANS$
8030 IF ANS$="NO" THEN SPECIAL_CHARGE_CODE$=""; NEXT_ID=SPECIAL_CHARGE_CODE.CTL; RETURN 
8040 NEXT_ID=SPECIAL_CHARGE_DESC.CTL
8080 CALL "*wingrp;Enable",SAVE_1.GRP$; REFRESH_FLG=1
8085 CALL "*WINGRP;ENABLE",FIELDS.GRP$
8090 RETURN 
8100 ! No First Record
8110 NO_FIRST:
8120 MSGBOX MSG("REC_NO_1ST"),"FYI","!"
8130 RETURN 
8200 ! No Last Record
8210 NO_LAST:
8220 MSGBOX MSG("REC_NO_LST$"),"FYI","!"
8230 RETURN 
8300 ! Start of File
8310 START_FILE:
8320 MSGBOX MSG("START_FILE"),"FYI","!"
8330 RETURN 
8400 ! End of File
8410 END_FILE:
8420 MSGBOX MSG("END_OF_FIL"),"FYI","!"
8430 RETURN 
8500 ! Invalid Day Message
8510 INVALID_MSG:
8520 MSGBOX MSG("INVALID_D"),"FYI","!"
8590 RETURN 
9000 ! Parameters
9010 GET_SYS_PARAM:
9020 READ (Z[6],KEY=X3$(9,3)+"I/C",DOM=WRAPUP)I0$
9090 RETURN 
9999 END 
10000 SEL_UM:
10010 FIND (Z(6),KEY="U/M"+SELL_UM$,DOM=NO_UM)UM$,UM0,UM1
10020 IF MID(UM$,20,1)="Y" THEN IF UM0<>0 THEN SELL_QTY_PER=UM0 ELSE SELL_QTY_PER=UM1
10030 IF MID(UM$,20,1)="Y" THEN CALL "*WINGRP;DISABLE",FIXED.GRP$ ELSE CALL "*wingrp;enable",FIXED.GRP$; NEXT_ID=SELL_QTY_PER.CTL ! SSP 229728
10035 IGNORE_EXIT=0 ! SSP249158 jdf
10040 REFRESH_FLG=1
10050 RETURN 
10060 NO_UM:
10070 MSGBOX "Please Enter Unit of Measure",MSG("WARNING"),"!,TIM=5"
10080 NEXT_ID=SELL_UM.CTL
10090 RETURN 
18055 MSGBOX "Please Enter Unit of Measure",MSG("WARNING"),"!,TIM=5"; NEXT_ID=SELL_UM.CTL; IGNORE_EXIT=1; EXIT ! SSP249158 jdf
56000 REM + Modification History
56001 REM "5.5 - 11/28/06 - 10.920833 - mhe - SSP# 202418
56002 REM "202418-Modify FSGMCA to also call UPDFMP to update XPX after       
56003 REM "227008-Issue with setting up special charge                        
56004 REM "229728-Parameter for special charge codes classified as freight to 
56005 REM "249158-Program: FMSGMCA OP Special Charge. Exit button does not    
