0010 REM "Update between FM1 record and IC0 record <FMGUTI>
0035 REM "5.6 - 09/03/08 - 16.588055 - jvv - SSP# 191604
0037 REM "191604-Add special pricing modifications to gui                    
0040 REM "Copyright 2008 DemandBridge, Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0310 IOLIST A$(1),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24],A[25],A[26],A[27],A[28],A[29],A[30],A[31],A[32],A[33],A[34],A[35],A[36],A[37],A[38],A[39],A[40]
0311 IOLIST A$(1),STR(A[0]),A[1],STR(A[2]),A[3],STR(A[4]),A[5],STR(A[6]),A[7],STR(A[8]),A[9],STR(A[10]),A[11],STR(A[12]),STR(A[13]),A[14],A[15],A[16],STR(A[17]),STR(A[18]),A[19],STR(A[20]),A[21],STR(A[22]),A[23],STR(A[24]),A[25],STR(A[26]),A[27],STR(A[28]),A[29],STR(A[30]),A[31],STR(A[32]),A[33],A[34],A[35],A[36],A[37],A[38],A[39],A[40]
0320 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14],F[15],F[16],F[17],F[18],F[19],F[20],F[21],F[22],F[23],F[24],F[25],F[26],F[27],F[28],F[29],F[30],F[31]
0395 ! 
0660 GOTO CONTINUE
0665 ! 
0670 OPEN_ERR: MSGBOX _MSG_FILOPNERR1$+QUO+_FILE_NAME$+QUO+SEP+_MSG_DIRECTORY$+LWD+SEP+_MSG_PREFIX$+PFX,MSG(ERR),"!"
0675 GOTO DONE
0685 ! 
0690 CONTINUE:
0695 ! 
1010 SETERR 1025
1020 ENTER X3$,K$,C$
1040 DIM S$(40),A[40],F[31],F$(448),A$(188)
1095 ! 
1100 REM "K$ is key, C$ of I=IC0 to FM1, F=FM1 to IC0
1105 GOSUB SETUP_MESSAGES
1110 _FILE_NAME$="FM1"+%C$,_FM1=HFN; OPEN (_FM1,ERR=OPEN_ERR)_FILE_NAME$
1115 _FILE_NAME$="IC0"+%C$,_IC0=HFN; OPEN (_IC0,ERR=OPEN_ERR)_FILE_NAME$
1120 _FILE_NAME$="IC5"+%C$,_IC5=HFN; OPEN (_IC5,ERR=OPEN_ERR)_FILE_NAME$
1125 _FILE_NAME$="IC4"+%C$,_IC4=HFN; OPEN (_IC4,ERR=OPEN_ERR)_FILE_NAME$
1130 _FILE_NAME$="FM2"+%C$,_FM2=HFN; OPEN (_FM2,ERR=OPEN_ERR)_FILE_NAME$
1133 _FILE_NAME$="FMP"+%C$,_FMP=HFN; OPEN (_FMP,ERR=OPEN_ERR)_FILE_NAME$
1134 _FILE_NAME$="SP0"+%C$,_SP0=HFN; OPEN (_SP0,ERR=OPEN_ERR)_FILE_NAME$ ! SSP 191604
1135 RT$=""; CALL "RTGPRM",ERR=*NEXT,RT$
1185 RT_PARM$=""; CALL "RTGPRM",ERR=*NEXT,RT_PARM$
1190 ON POS(C$="IF") GOTO 9900,1200,2000,9900
1195 ! 
1200 REM "Transfer from IC0 to FM1
1210 DIM C1$(224); FIND (_FMP,KEY="D"+K$(1,10),DOM=1211)C1$,*,C1
1310 EXTRACT (_FM1,KEY=K$,DOM=9900)IOL=0320
1330 FIND (_IC0,KEY=K$,DOM=1331)IOL=0310; GOTO 1400
1335 READ (_FM1,KEY=K$); GOTO 1490; REM "Needed for FS2UT4 utility
1400 GOSUB 8100
1440 WRITE (_FM1,KEY=K$)IOL=0320; IF RT_PARM$<>"" THEN CUST$=K$(1,10); CALL "RTGWOC",ERR=*NEXT,CUST$,"FM1...","U",K$
1490 GOTO 9900
1495 ! 
2000 REM "Transfer from FM1 to IC0
2020 EXTRACT (_IC0,KEY=K$,DOM=9900)IOL=0310
2025 FIND (_FM1,KEY=K$,DOM=9900)IOL=0320
2026 IF LEN(F$)=20 OR K$(11,10)="          " THEN DIM F$(448); F$(1,20)=K$; REM "FIX BLANK FORMS CODE IF WRITTEN OUT ALREADY
2030 GOSUB 8200
2040 WRITE (_IC0,KEY=K$)IOL=0311
2045 IF RT$>"" THEN IF RT$(7,1)="H" THEN CUST$=K$(1,10); CALL "RTGWOC",ERR=*NEXT,CUST$,"IC0...","U",K$
2095 GOTO 9900
2099 ! 
8100 REM "Info from IC0 to FM1
8140 A2$=F$(21,3)+F$(24,16)+F$(40,2)+F$(11,10)+F$(1,10)
8150 GOSUB 8300
8160 A3$=F$(21,3)+F$(24,16)+F$(40,2)+F$(11,10)+F$(1,10); IF A2$=A3$ THEN GOTO 8165 ELSE REMOVE (_FM2,KEY=A2$,DOM=8161)
8165 IF F[30]>0 THEN F[29]=F[3]*F[30]/100 ELSE IF C1>0 THEN F[30]=C1; GOTO 8165
8166 CALL "UPDSP0;DETERMINE_FMS",_SP0,F$(1,10),F$(11,10),F[29],F[1],NEWFMS,F[30],F[3],F[2],F[4]; IF NEWFMS<>F[29] THEN F[29]=NEWFMS ! SSP188067 191604
8170 WRITE (_FM2,KEY=A3$)
8190 RETURN 
8195 ! 
8200 REM "Info from FM1 to IC0
8210 REM "Adjust IC0 prices if necessary
8215 IF A[14]=F[4] THEN GOTO 8240
8220 IF A[14]=0 THEN GOTO 8240 ELSE R=F[4]/A[14]
8225 A[13]=A[13]*F[4]/A[14]; REM "A(13)=avg sale price for forms mngmt
8230 FOR I=2 TO 12 STEP 2
8235 A[I]=A[I]*F[4]/A[14],A[I+20]=A[I+20]*F[4]/A[14]
8237 NEXT I
8240 A2$=A$(61,3)+A$(1,20),A3$=A$(82,14)+A2$
8245 IF F$(311,6)<>S$(1,6) THEN A$(116,1)="Y" ELSE A$(116,1)=""
8250 A$(21,40)=F$(42,40),A$(61,3)=F$(21,3),A$(64,18)=F$(24,18),A$(82,14)=F$(82,14),A$(120,4)=F$(100,4),A[0]=F[3],A[14]=F[4],A[19]=F[0],A[16]=F[18]
8251 A$(119,1)=F$(387,1); REM SSP 201823       
8260 IF A2$=A$(61,3)+A$(1,20) THEN GOTO 8270 ELSE REMOVE (_IC5,DOM=8261,KEY=A2$)
8265 WRITE (_IC5,KEY=A$(61,3)+A$(1,20))
8270 IF A3$=A$(82,14)+A$(61,3)+A$(1,20) THEN GOTO 8280 ELSE REMOVE (_IC4,DOM=8271,KEY=A3$)
8275 WRITE (_IC4,KEY=A$(82,14)+A$(61,3)+A$(1,20))
8295 RETURN 
8299 ! 
8300 REM "Set Item Data values from Item Masterfile
8320 F$(42,40)=A$(21,40),F$(21,3)=A$(61,3),F$(24,18)=A$(64,18),F$(82,14)=A$(82,14),F$(100,4)=A$(120,4),F[3]=A[0],F[4]=A[14],F[0]=A[19],F[18]=A[16]
8325 F$(387,1)=A$(119,1); REM SSP 201823        
8345 RETURN 
8395 ! 
9200 SETUP_MESSAGES:
9210 _MSG_FILOPNERR1$=MSG("FILOPNERR1")
9220 _MSG_DIRECTORY$=MSG("DIRECTORY")
9230 _MSG_PREFIX$=MSG("PREFIX")
9290 SETUP_MESSAGES_END:RETURN 
9295 ! 
9700 WRAPUP:
9710 IF _FM1<>0 THEN CLOSE (_FM1)
9715 IF _IC0<>0 THEN CLOSE (_IC0)
9720 IF _IC5<>0 THEN CLOSE (_IC5)
9725 IF _IC4<>0 THEN CLOSE (_IC4)
9730 IF _FM2<>0 THEN CLOSE (_FM2)
9735 IF _FMP<>0 THEN CLOSE (_FMP)
9790 WRAPUP_END:RETURN 
9795 ! 
9900 REM "END PROGRAM
9903 DONE:
9910 GOSUB WRAPUP
9930 EXIT 
9999 END 
56000 REM "201823-Provide the ability to set the taxable flag  by Item  
