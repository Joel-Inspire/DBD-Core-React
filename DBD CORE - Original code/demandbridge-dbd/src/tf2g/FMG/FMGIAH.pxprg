0010 ! FMGIAH - Order History Inquiry (="FS6"+%C$)
0035 REM "5.7 - 06/22/21 - 19.025097 - jvv - SSP# 307357
0037 REM "307357-Update FS6 to allow for more line numbers                   
0040 REM "Copyright 2021 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 ! 
0093 PNL_INVOKE: %MAX_SCREEN=1,%EXEC_CMD$="PROCESS "+QUO+"FMGIAI"+QUO+","+QUO+"../FMG/FM.EN"+QUO
0094 _CUSTOMER$=%CUSTOMER$; GOSUB INIT; %FS1=_FS1,%ICO=_IC0,%P0$=P0$,%FM1=_FM1,%FMP=_FMP,%FS9=_FS9; IF %P0$(243,1)="Y" THEN PROCESS "QRY_AIH","../FMG/FM.EN",VAL$; IF VAL$<>"" THEN ORDER_LINE$=VAL$; GOSUB 28150; VAL$=""; GOSUB WRAPUP; GOTO 0093 ELSE GOSUB WRAPUP; GOTO 0096; REM SSP210101 jdf   !SSP#213986
0095 PROCESS "FMGIAH","../ARG/AR.EN"
0096 %CUSTOMER$=_CUSTOMER$,%MAX_SCREEN=0 ! SSP210101 jdf
0097 EXIT 
0100 ! 100 - Initialization
0105 INIT:
0110 IF %CUSTOMER$<>"" THEN CUSTOMER$=%CUSTOMER$
0112 DIM Z[NUM(%X3$(60,3))]; Z$="01S FS6... 02O FS8... 03O FM1... 04O AR1... 05O IC0... 06O FMP... 07O FS9... 10S FS1... 13O ZZPARM" ! SSP#213986 SSP#216994
0114 CALL "ZZFLES",%X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1 ! SSP#213986
0115 _FILE_NAME$="FS6"+%C$
0120 _FIL_NO=Z[1] ! _FIL_NO=HFN; OPEN (_FIL_NO,IOL=*,ERR=OPEN_ERR)_FILE_NAME$    SSP#213986
0125 _ZZPARM=Z[13] ! _FILE_NAME$="ZZPARM"; _ZZPARM=HFN; OPEN (_ZZPARM,ERR=OPEN_ERR)_FILE_NAME$  SSP#213986
0130 _FS8=Z[2] ! _FILE_NAME$="FS8"+%C$; _FS8=HFN; OPEN (_FS8,ERR=OPEN_ERR)_FILE_NAME$  SSP#213986
0135 _FM1=Z[3] ! _FILE_NAME$="FM1"+%C$; _FM1=HFN; OPEN (_FM1,ERR=OPEN_ERR,IOL=*)_FILE_NAME$  SSP#213986
0140 _AR1=Z[4] ! _FILE_NAME$="AR1"+%C$; _AR1=HFN; OPEN (_AR1,ERR=OPEN_ERR,IOL=*)_FILE_NAME$  SSP#213986
0145 _IC0=Z[5] ! _FILE_NAME$="IC0"+%C$,_IC0=HFN; OPEN (_IC0,ERR=OPEN_ERR)_FILE_NAME$  SSP#213986
0150 _FMP=Z[6] ! _FILE_NAME$="FMP"+%C$,_FMP=HFN; OPEN (_FMP,ERR=OPEN_ERR)_FILE_NAME$  SSP#213986
0155 _FS9=Z[7] ! _FILE_NAME$="FS9"+%C$,_FS9=HFN; OPEN (_FS9,ERR=OPEN_ERR,IOL=*)_FILE_NAME$  SSP#213986
0160 _FS1=Z[10] ! _FILE_NAME$="FS1"+%C$,_FS1=HFN; OPEN (_FS1,ERR=OPEN_ERR,IOL=*)_FILE_NAME$ ! SSP#213986
0181 READ (_ZZPARM,KEY=%C$+"A/R",DOM=*NEXT)P0$; GOTO 0183
0182 CMD_STR$="END"; EXIT 
0195 RETURN 
0200 OPEN_ERR: MSGBOX _MSG_FILOPNERR1$+QUO+_FILE_NAME$+QUO+SEP+_MSG_DIRECTORY$+LWD+SEP+_MSG_PREFIX$+PFX,MSG(ERR),"!"
0210 CMD_STR$="END"
0220 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0512 IF %X3$(48,1)="1" THEN DATE_SET$="[Order Date]MDYL10."; END_IF ; IF %X3$(48,1)="2" THEN DATE_SET$="[Order Date]DMYL10."; END_IF ; IF %X3$(48,1)="3" THEN DATE_SET$="[Order Date]YMDL10." ! SSP222459 jdf
0513 IF STP(DATE_SET$)<>"" THEN DATE_STRING$=DETAILS.CTL'FMT$; NEW_DATE_STRING$=SUB(DATE_STRING$,DATE_STRING$(1,19),DATE_SET$,1) ! SSP222459 jdf
0514 IF STP(DATE_SET$)<>"" THEN DETAILS.CTL'FMT$=NEW_DATE_STRING$ ! SSP222459 jdf
0515 IF P0$(15,1)<>"Y" THEN CALL "*wingrp;Hide",BILLTO.GRP$
0520 GOSUB STARTING_POINT ! SSP 200903
0525 IF SEL_EXIT$="FMGIAH_EXIT" THEN CMD_STR$="END"; GOTO *RETURN ! SSP218588 jdf
0535 GOSUB PROCESS_CUSTOMER
0540 RETURN 
0900 ! 900 - Wrapup
0905 WRAPUP:
0908 %MAX_SCREEN=0,%EXEC_CMD$=""; REM SSP210101 jdf
0910 ! IF _FIL_NO<>0 THEN CLOSE (_FIL_NO); _FIL_NO=0! SSP#213986
0912 %LINE_TYPE$="",%CUST_KEY$="",%ITEM_DESC$="" ! SSP238722 jdf
0915 CALL "ZZFLES",%X3$,Y1$,Y0$,"END",Z{ALL},0,0 ! SSP#213986! SSP#213986
0917 ! IF _CUR_FN<>0 THEN CLOSE (_CUR_FN); _CUR_FN=0!SSP#213986
0920 ! IF _ZZPARM<>0 THEN CLOSE (_ZZPARM); _ZZPARM=0!SSP#213986
0925 ! IF _FS8<>0 THEN CLOSE (_FS8); _FS8=0!SSP#213986
0930 ! IF _FM1<>0 THEN CLOSE (_FM1); _FM1=0!SSP#213986
0935 ! IF _AR1<>0 THEN CLOSE (_AR1); _AR1=0!SSP#213986
0940 ! IF _IC0<>0 THEN CLOSE (_IC0); _IC0=0!SSP#213986
0945 ! IF _FMP<>0 THEN CLOSE (_FMP); _FMP=0!SSP#213986
0950 ! IF _FS9<>0 THEN CLOSE (_FS9); _FS9=0!SSP#213986
0955 ! IF _FS1<>0 THEN CLOSE (_FS1); _FS1=0!SSP#213986
0990 RETURN ! SSP 217075
1000 ! 1000 - Process customer
1005 PROCESS_CUSTOMER:
1010 REFRESH_FLG=1
1011 IF %CUSTOMER$<>"" THEN DISABLE CONTROL CUSTOMER.CTL
1012 CUSTOMER$=%CUSTOMER$; ITEM_CODE$=%ITEM_CODE$
1015 CALL "ZZWLKU;PARSE_CUST",CUSTOMER$,CUST_DIV$,CUST_CODE$; CUSTOMER$=CUST_DIV$+CUST_CODE$
1020 READ (_AR1,KEY=CUST_DIV$+CUST_CODE$,DOM=*NEXT); BILL_TO_CUST$=BILL_TO_CUST_DIV$+BILL_TO_CUST_CODE$
1022 DIM TF_TYPE$[8]; TF_TYPE$[1]="Custom forms",TF_TYPE$[2]="Customer specific Inventory items",TF_TYPE$[3]="Inventory items",TF_TYPE$[4]="Non-Stock items",TF_TYPE$[5]="Stock Purchase Orders",TF_TYPE$[6]="Hidden Warehouse Items",TF_TYPE$[7]="Special charges",TF_TYPE$[8]="Message lines" ! ssp 191962!SSP#214025
1023 PRINT 'MESSAGE'(DEF 40),'MESSAGE'('_RED'+'WHITE'+"Click here to Abort",1),
1025 GOSUB LOAD_DETAILS
1030 RETURN 
7500 GET_ITEM_DESC:
7503 IF STP(SEL_ITEM$)<>"" THEN ITEM_CODE$=SEL_ITEM$ ! SSP218588 jdf
7504 IF STP(SEL_TYPE$)<>"" AND SEL_TYPE$<>"A" THEN HIST_TYPE$=SEL_TYPE$ ! SSP218588 jdf!SSP#220016                                                       
7505 ON POS(HIST_TYPE$="BDFHJM") GOTO 7590,7550,7510,7515,7600,7570,7600
7510 C0$=CUST_DIV$+CUST_CODE$; GOTO 7520
7515 DIM C0$(10)
7520 FIND (_IC0,KEY=C0$+ITEM_CODE$,DOM=7555)IC0$
7525 ITEM_DESC$=IC0$(21,40)
7545 GOTO 7590
7550 REM "Custom item case
7560 FIND (_FM1,KEY=CUST_DIV$+CUST_CODE$+ITEM_CODE$,DOM=*NEXT); GOTO 7565
7561 ITEM_DESC$=DIM(40)
7569 GOTO 7590
7570 REM "Special stuff
7580 FIND (_FMP,KEY="X"+ITEM_CODE$,DOM=*NEXT)FMP$; ITEM_DESC$=FMP$(12,40); GOTO 7582
7581 ITEM_DESC$=DIM(40)
7590 RETURN 
7600 REM "Read in non stock info from FS9 and put into E0$
7620 FIND (_FS9,KEY=ORDER_DIV$+ORDER_NUM$+ITEM_CODE$+MID(ITEM_CODE$,LEN(ITEM_CODE$)),DOM=*NEXT); ITEM_DESC$=TF_DESC$; GOTO 7635 ! SSP216881 jdf
7622 SEQ_NUM$=" ",SEQ_NUM=0 ! SSP216881 jdf
7624 IF SEQ_NUM>9 THEN GOTO 7633 ! SSP216881 jdf
7626 FIND (_FS9,KEY=ORDER_DIV$+ORDER_NUM$+ITEM_CODE$+SEQ_NUM$,DOM=*NEXT); ITEM_DESC$=TF_DESC$; GOTO 7635 ! SSP216881 jdf
7628 SEQ_NUM=SEQ_NUM+1 ! SSP216881 jdf
7630 SEQ_NUM$=STR(SEQ_NUM) ! SSP216881 jdf
7632 GOTO 7624 ! SSP216881 jdf
7633 ITEM_DESC$=DIM(40)
7640 GOTO 7590
7690 RETURN 
9999 END 
11000 SET_READONLY:REM "Set the PRM READONLY to on !SSP#249726           
11010 SET_PARAM 'XI'; REM "Turn Readonly logic on !SSP#249726              
11020 SET_READONLY_END:RETURN ! SSP#249726                                 
11030 CLEAR_READONLY:REM "Set  the PRM READONLY flag to off !SSP#249726   
11040 SET_PARAM 'XI'=0; REM "Turn off READONLY logic !SSP#249726           
11050 CLEAR_READONLY_END:RETURN ! SSP#249726                               
21000 ! 21000 - Read and load line details
21005 LOAD_DETAILS:
21008 TOT_NUM_INV=5000,CUR_NUM_INV=0,BT_MORE.CTL'ENABLED=0,REFRESH_FLG=1 ! SSP 225600, ssp300654
21010 LIST_BOX LOAD DETAILS.CTL,""; CALL "*WINGRP;HIDE",INVO.GRP$; CALL "*Wingrp;Hide",INVO3.GRP$
21011 DETAILS.CTL'VISIBLE=0 ! SSP 300654
21012 SEL_ITEM$=PAD(SEL_ITEM$,10) ! SSP238722 jdf
21013 IF NUL(_FS6_KEY$) THEN _FS6_KEY$=CUST_DIV$+CUST_CODE$+SEL_TYPE$+SEL_ITEM$ ! SSP 300654
21015 READ (_FIL_NO,KEY=_FS6_KEY$,DOM=*NEXT) ! SSP 191962 SSP 200903
21016 ! EAD (_FIL_NO,KEY=CUST_DIV$+CUST_CODE$+SEL_TYPE$+SEL_ITEM$,DOM=*NEXT) ! SSP 191962 SSP 200903
21020 NEXT_FS8_REC: _FS6_KEY$=KEY(_FIL_NO,END=ALL_DONE); IF CUR_NUM_INV>TOT_NUM_INV THEN BT_MORE.CTL'ENABLED=1,BT_MORE.CTL'VISIBLE=1; REFRESH_FLG=1; GOTO ALL_DONE ELSE IF _FS6_KEY$(1,10)<>CUST_DIV$+CUST_CODE$ THEN LIST_BOX WRITE DETAILS.CTL,1; PRINT 'MESSAGE'('F8'+'BLACK'+"",0); GOTO ALL_DONE ! SSP 191962
21025 READ (_FIL_NO)
21026 IF STP(SEL_TYPE$)<>"" AND SEL_TYPE$<>"A" AND SEL_TYPE$<>_FS6_KEY$(11,1) THEN GOTO NEXT_FS8_REC ! SSP#220016
21028 IF STP(SEL_ITEM$)<>"" AND SEL_ITEM$<>_FS6_KEY$(12,10) THEN GOTO NEXT_FS8_REC ! SSP#220016
21030 ! HIST_TYPE$=_FS8_KEY$(19,1),ITEM_CODE$=_FS8_KEY$(20,10),SEQ_NUM$=_FS8_KEY$(30,1),ORDER$=_FS8_KEY$(11,8) SSP 191962
21035 ! FS6_KEY$=CUST_DIV$+CUST_CODE$+HIST_TYPE$+ITEM_CODE$+ORDER$+SEQ_NUM$ SSP 191962
21040 ! READ (_FIL_NO,KEY=FS6_KEY$,DOM=NEXT_FS8_REC) ssp 191962
21041 REM IF STP(SEL_TYPE$)<>"" THEN IF STP(HIST_TYPE$)<>STP(SEL_TYPE$) THEN GOTO NEXT_FS8_REC ! SSP218588 jdf
21042 GOSUB GET_TYPE_DESC
21043 OBTAIN (0,TIM=0,ERR=*NEXT)'ME',*,'MN'; IF CTL=-1401 THEN GOTO ALL_DONE
21045 GOSUB GET_ITEM_DESC
21050 GOSUB LOAD_LISTBOX
21055 GOTO NEXT_FS8_REC
21060 ALL_DONE: DETAILS.CTL'VISIBLE=1 ! SSP 300654
21065 IF CUR_NUM_INV<=TOT_NUM_INV THEN BT_MORE.CTL'ENABLED=0,BT_MORE.CTL'VISIBLE=0,REFRESH_FLG=1 ! SSP217347  SSP 225600 ssp300654
21070 PRINT 'MESSAGE'('F8'+'BLACK'+"",1); PRINT 'MESSAGE'('F8'+'BLACK'+"",0),'CI',; RETURN ! SSP 200707
21095 ! 
22000 SEL_QUERY:! SSP238722 jdf
22005 VAL$="" ! SSP238722 jdf
22010 SWITCH UCS(MID(INVOICE_TYPE$,1,1)) ! SSP238722 jdf
22012 CASE "F" ! SSP238722 jdf
22013 %ITEM_CUST$=DIM(10) ! SSP238722 jdf
22014 PROCESS "QRY_IC0.1.4","../ICG/IC.EN",VAL$ ! SSP238722 jdf
22016 ITEM_CODE$=MID(VAL$,1,10),ITEM_CODE.CTL'VALUE$=MID(VAL$,11,10),REFRESH_FLG=1 ! SSP238722 jdf
22018 %LINE_TYPE$="I" ! SSP238722 jdf
22019 BREAK ! SSP238722 jdf
22020 CASE "D" ! SSP238722 jdf
22030 PROCESS "QRY_IC0.1","../ICG/IC.EN",VAL$ ! SSP238722 jdf
22032 ITEM_CODE$=MID(VAL$,11,10),ITEM_CODE.CTL'VALUE$=MID(VAL$,11,10),REFRESH_FLG=1 ! SSP238722 jdf
22034 %LINE_TYPE$="I" ! SSP238722 jdf
22040 BREAK ! SSP238722 jdf
22041 CASE "J" ! SSP238722 jdf
22042 PROCESS "QRY_FMPX","../OPG/OP.EN",VAL$ ! SSP238722 jdf
22044 ITEM_CODE$=MID(VAL$,1,10),ITEM_CODE.CTL'VALUE$=MID(VAL$,1,10),REFRESH_FLG=1 ! SSP238722 jdf
22045 XP=HFN; OPEN (XP)"XPX"+%C$ ! SSP238722 jdf
22046 FIND (XP,KEY="X"+ITEM_CODE$,DOM=*NEXT)XPX$ ! SSP238722 jdf
22047 %LINE_TYPE$="S" ! SSP238722 jdf
22048 BREAK ! SSP238722 jdf
22050 DEFAULT ! SSP238722 jdf
22060 PROCESS "QRY_FM1_ITM2","../FMG/FM.EN",VAL$ ! SSP238722 jdf
22062 ITEM_CODE$=MID(VAL$,1,10),ITEM_CODE.CTL'VALUE$=MID(VAL$,1,10),REFRESH_FLG=1 ! SSP238722 jdf
22064 %LINE_TYPE$="C" ! SSP238722 jdf
22070 END SWITCH ! SSP238722 jdf
22071 SELECT_ITEM_CODE:! SSP238722 jdf
22072 FIELD$=ITEM_CODE$; IF MID(INVOICE_TYPE$,1,1)="F" THEN %CUST_KEY$=DIM(10) ELSE %CUST_KEY$=CUSTOMER$ ! SSP238722 jdf
22075 PERFORM "FMGODB;ITEM_CODE_FMT" ! SSP238722 jdf
22077 %ITEM_DESC$=ITEM_DESC$,%ITEM_DESC.CTL'VALUE$=ITEM_DESC$,REFRESH_FLG=1 ! SSP238722 jdf
22078 IF %LINE_TYPE$="S" THEN %ITEM_DESC$=MID(XPX$,12,40),%ITEM_DESC.CTL'VALUE$=MID(XPX$,12,40); IF XP THEN CLOSE (XP); XP=0,REFRESH_FLG=1 ! SSP238722 jdf
22079 PRINT 'CI', ! SSP#271904
22080 RETURN ! SSP238722 jdf
22500 TYPE_ITEM_CODE:! SSP238722 jdf
22505 ITEM_CODE$=PAD(ITEM_CODE$,10) ! SSP238722 jdf
22510 SWITCH UCS(MID(INVOICE_TYPE$,1,1)) ! SSP238722 jdf
22520 CASE "D","F" ! SSP238722 jdf
22530 %LINE_TYPE$="I" ! SSP238722 jdf
22540 BREAK ! SSP238722 jdf
22550 CASE "J" ! SSP238722 jdf
22560 XP=HFN; OPEN (XP)"XPX"+%C$ ! SSP238722 jdf
22570 FIND (XP,KEY="X"+ITEM_CODE$,DOM=*NEXT)XPX$ ! SSP238722 jdf
22580 %LINE_TYPE$="S" ! SSP238722 jdf
22590 BREAK ! SSP238722 jdf
22600 DEFAULT ! SSP238722 jdf
22610 %LINE_TYPE$="C" ! SSP238722 jdf
22620 END SWITCH ! SSP238722 jdf
22630 GOSUB SELECT_ITEM_CODE ! SSP238722 jdf
22640 RETURN 
23000 ! Determine the Type
23010 INVOICE_TYPE:
23020 REPLACEMENT_SCRN$="FMGIAH_1"
23030 PERFORM "*winproc;overlay_screen"
23050 SEL_TYPE$=INVOICE_TYPE$; GOTO LOAD_DETAILS ! SSP#216994
23090 RETURN 
25000 ! 25000 - Load items into listbox
25005 LOAD_LISTBOX:! COLUMN SEPARATOR IS SEP 
25006 GOSUB SET_READONLY; IF %P0$(243,1)<>"Y" THEN IF B_HIST_TYPE$<>HIST_TYPE$ THEN TF_DESC$=TF_TYPE$[POS(HIST_TYPE$="BDFHPZJM")]; LIST_BOX LOAD DETAILS.CTL,0,'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+'YELLOW'+TF_DESC$+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP+'_BLUE'+SEP; B_HIST_TYPE$=HIST_TYPE$; ++CUR_NUM_INV ! ssp 191962  SSP210101 jdf!SSP#249726 300654
25007 ! BL$=""; READ (_FS1,KEY=ORDER_DIV$+ORDER_NUM$,DOM=*NEXT)FS1$; IF FS1$(63,1)="Y" THEN BL$='SF'+'_CYAN'; CALL "*WINGRP;SHOW",INVO.GRP$ ELSE BL$='SF'+'_GREEN'; CALL "*WINGRP;SHOW",INVO3.GRP$ ; ! SSP210101 jdf
25008 IF %P0$(243,1)<>"Y" THEN BL$=""; READ (_FS1,KEY=ORDER_DIV$+ORDER_NUM$,DOM=*NEXT)FS1$; IF FS1$(63,1)="Y" AND (_FS6_KEY$(1,10)=FS1$(6,10)) THEN BL$='SF'+'_CYAN'; CALL "*WINGRP;SHOW",INVO.GRP$ ELSE IF _FS6_KEY$(1,10)=FS1$(6,10) THEN BL$='SF'+'_GREEN'; CALL "*WINGRP;SHOW",INVO3.GRP$ ! SSP210101 jdf    
25009 IF %P0$(243,1)="Y" THEN %BL$="",%COLOR_LN=7,%COLOR_LN$='BLACK'; READ (_FS1,KEY=ORDER_DIV$+ORDER_NUM$,DOM=*NEXT)FS1$; IF FS1$(63,1)="Y" AND (_FS6_KEY$(1,10)=FS1$(6,10)) THEN %COLOR_LN=14,%COLOR_LN$='SF'+'CYAN',%BL$="*** Invoicing in Progress ***" ELSE IF _FS6_KEY$(1,10)=FS1$(6,10) THEN %COLOR_LN=10,%COLOR_LN$='SF'+'GREEN',%BL$="*** Open Order ***" ! SSP210101 jdf    
25010 GOSUB CLEAR_READONLY ! SSP#249726
25011 IF %P0$(243,1)="Y" THEN RETURN ! SSP210101 jdf
25012 CALL "ZZWDTE;DISPLAY",ORDER_DATE$
25013 MSG_1$=DIM(10); IF ORDER_TYPE$="B" THEN MSG_1$="Bill as Ship"
25015 COLUMNS$=BL$+ORDER_DATE$+SEP+BL$+FN%ZZDISP$(ORDER_DIV$+ORDER_NUM$,"O/P")+SEP+BL$+CUST_PO$+SEP+BL$+ITEM_CODE$+SEP+BL$+ITEM_DESC$+SEP+BL$+STR(FN%QTY_IN_UM(SELL_QTY,SELL_UM$,QTY_PER):"##,###,###-")+SEP+BL$+STR(UNIT_PRICE:"###,###.00#")+SEP+BL$+SELL_UM$+"/"+STR(QTY_PER:"##,##0")+SEP+BL$+STR(UNIT_COST:"###,###.00#")+SEP+BL$+PROD_CODE$+SEP+BL$+HIST_TYPE$+SEP+BL$+TYPE_DESC$+SEP+BL$+MSG_1$+SEP+BL$+LINE_NUM$+SEP+SEQ_NUM$ ! SSP 181457, SSP#210717 SSP307357
25016 IF NOT(NUL(INV_NUM$)) THEN CALL "ZZWDTE;DISPLAY",INV_DATE$; COLUMNS$+=SEP+BL$+INV_NUM$+SEP+BL$+INV_DATE$
25020 ++CUR_NUM_INV; LIST_BOX LOAD DETAILS.CTL,0,COLUMNS$
25022 COUNT+=1; IF MOD(COUNT,500)=0 THEN PRINT 'MESSAGE'('_GREEN'+'WHITE'+"Please Wait, Records : "+STR(COUNT),0); CALL "$CTL-10;AGENT_MSG","Please Wait, Records :"+STR(COUNT),0; LIST_BOX WRITE DETAILS.CTL,COUNT ! SSP 
25024 IF TCB(29)>=7100000 THEN DETAILS.CTL'LOADPOINT=-1 ! SSP300654
25025 RETURN 
25095 ! 
26000 GET_TYPE_DESC:
26005 TYPE_DESC$=""
26010 ON POS(HIST_TYPE$="BDFHJMZ") GOTO 26090,26020,26025,26030,26035,26040,26045,26050
26020 TYPE_DESC$=MSG("CUSTOM_ORD"); GOTO GET_TYPE_DESC_END
26025 TYPE_DESC$=MSG("CUST_INV"); GOTO GET_TYPE_DESC_END
26030 TYPE_DESC$=MSG("STOCK_INV"); GOTO GET_TYPE_DESC_END
26035 TYPE_DESC$=MSG("NONSTOCK"); GOTO GET_TYPE_DESC_END
26040 TYPE_DESC$=MSG("SPEC_CHRGS"); GOTO GET_TYPE_DESC_END
26045 TYPE_DESC$=MSG("MESS_LNS"); GOTO GET_TYPE_DESC_END
26050 TYPE_DESC$=MSG("HID_INV"); GOTO GET_TYPE_DESC_END
26090 GET_TYPE_DESC_END:RETURN 
26095 ! 
28000 ! 
28010 HIST_LINE_INFO:
28015 IF _EOM$=$01$ THEN RETURN 
28020 LIST_BOX READ DETAILS.CTL,IDX,ERR=*RETURN ! 261823
28030 LINE_INFO$=DETAILS.CTL'VALUE$ ! LIST_BOX FIND DETAILS.CTL,IDX,LINE_INFO$
28031 IF POS($1B42348A$=LINE_INFO$) THEN RETURN ! SSP 191962
28035 XX=POS($1B53461B4236$=LINE_INFO$); IF XX<>0 THEN LINE_INFO$=LINE_INFO$(1,XX-1)+LINE_INFO$(XX+6); GOTO 28035
28037 XX=POS($1B53461B4232$=LINE_INFO$); IF XX<>0 THEN LINE_INFO$=LINE_INFO$(1,XX-1)+LINE_INFO$(XX+6); GOTO 28037
28040 ORD_DATE$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28050 ORD_NUM$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28055 CUST_PO$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28060 ITEM_NUM$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28070 ITEM_DESC$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28080 ORD_QTY$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28090 PRICE$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28100 U_M$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28110 TF_COST$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28120 PROD_CODE$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28125 TF_TYPE$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28127 TYPE_DESC$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28129 ORDER_TYPE_1$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1)
28130 LINE_NUM$=LINE_INFO$(1,POS(SEP=LINE_INFO$)-1); LINE_INFO$=LINE_INFO$(POS(SEP=LINE_INFO$)+1) ! SSP 307357
28132 SEQ_NUM$=LINE_INFO$; SEQ_NUM$=SEQ_NUM$(1,1) ! SSP 307357
28135 IF %OP_DIV_LEN=0 THEN ORD_NUM$="00"+ORD_NUM$ ! SSP 217129
28140 ORDER_LINE$=CUSTOMER$+TF_TYPE$(1,1)+ITEM_NUM$+STP(ORD_NUM$,3,"-")+SEQ_NUM$
28150 PROCESS "FMGIAI","../FMG/FM.EN",ORDER_LINE$
28190 RETURN 
29000 STARTING_POINT:! SSP 200903
29005 SEL_EXIT$="",%ITEM_DESC$="" ! SSP238722 jdf
29010 PROCESS "FMGIAH.1","../ARG/AR.EN",SEL_TYPE$,SEL_ITEM$,SEL_EXIT$
29015 IF SEL_EXIT$="FMGIAH_EXIT" THEN GOTO *RETURN ! SSP218588 jdf
29020 IF ID$="TYPE_2" THEN INVOICE_TYPE$=""; GOSUB PROCESS_CUSTOMER ! SSP#216994 ! SSP218588 jdf
29025 NEXT_ID=BUTTON_3.CTL ! SSP218588 jdf
29030 RETURN 
30000 SEL_RECORD:
30010 ENTER HIST_TYPE$,ORDER_TYPE$,ITEM_CODE$,SELL_QTY,SELL_UM$,QTY_PER,ORDER_DIV$,ORDER_NUM$
30020 GOSUB GET_TYPE_DESC; %TYPE_DESC$=TYPE_DESC$
30030 %MSG_1$=DIM(10); IF ORDER_TYPE$="B" THEN %MSG_1$="Bill as Ship"
30040 CALL "ZZWLKU;PARSE_CUST",%CUSTOMER$,CUST_DIV$,CUST_CODE$
30042 %IC0=FN%FFN("IC0"+%C$) ! SSP#213594
30050 _IC0=%IC0,_FM1=%FM1,_FS1=%FS1,_FMP=%FMP,_FS9=%FS9,_FS6_KEY$=CUST_DIV$+CUST_CODE$; GOSUB GET_ITEM_DESC; %ITEM_DESC$=ITEM_DESC$ ! SSP210101 jdf
30060 %QTY=FN%QTY_IN_UM(SELL_QTY,SELL_UM$,QTY_PER)
30065 %COLOR_LN$="",%MESS_COLOR$='B>'+'BLACK'+"*** Invoicing in Progress ***"+SEP+'B:'+'BLACK'+"*** Open Order ***"+SEP
30070 GOSUB LOAD_LISTBOX
30100 EXIT 
30200 COLOR:
30210 %TT+=1; IF MOD(%TT,2)=0 THEN %COLOR_LN$='YELLOW' ELSE %COLOR_LN$='GREEN'
30220 EXIT 
56000 ! "181457-GUI, order entry. Cannot enter a negative requisition       
56001 ! 191962-Order History by item needs to display by type B=Custom form
56002 REM "194087-Changes made at Whitepaper during 2nd week of install       
56005 ! "200707-Program FMGIAH Order History by item number. Click the Exit 
56010 ! "200903-GUI Order History by item cannot enter a starting item code 
56012 REM "210101-Order Number Controls                                       
56013 REM "213594-PE IN AR1: Order History By Item                            
56014 REM "214025-In order history the description say's Hidden Warehouse     
56015 REM "213986-Bad record being written out to FS1 key=order data=""
56016 REM "216881-QRY_AIH - Does not show description for message lines.      
56017 ! "217129-Under A/R, order history by item, this pulling up the       
56018 REM "218588-GUI issue with Order History By Item coming from A/R        
56019 REM "222459-When selecting order date to sort by it is using the format 
56020 REM "224571-GUI issue in Order History by Item. Getting a message(PANEL CHANGE ONLY- FMGIAH.1)
56021 REM "238722-A/R, Order History by Item - is not looking up stock/invent 
56022 REM "249726-Trying to view Order History inquiry screen and getting      an error 0
56023 REM "261823-db/d crashing. Working with Order History by item screen. I 
56024 REM "271904-Customers/order history by item, select B-customer orders   
56025 REM "283352-Order History by item and order history by order number     
56026 REM "300654-Issue with order history queries                            
56027 REM "300654-Issue with order history queries                            
56028 REM "307357-Update FS6 to allow for more line numbers                   
