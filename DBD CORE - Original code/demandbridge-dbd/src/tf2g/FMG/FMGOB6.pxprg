0010 ! FMGOB6 - Run specs if necessary
0035 REM "5.5 - 06/30/06 - 9.6925 - jir - SSP# 197483
0040 REM "Copyright 2006 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 X0$="FM2OB6"
0100 SETERR 9000
0140 GOSUB 8950
0145 INIT:
5800 REM "Determine how many specs to run then set U1$ and run them
5810 ZZP=HFN; OPEN (ZZP)"ZZPARM"; READ (ZZP,KEY=%X3$(9,3)+"F/M",DOM=5811)P3$
5812 DIR$=%DATAPATH$,Q1$=%CUSTOMER$+%ITEM_CODE$
5827 IF %X3$(9,3)="491" THEN GOSUB 6000; GOTO 5831; REM " SSP# 149480
5830 IF P3$(286,6)<>DIM(6) THEN GOSUB 7000; REM " WRITE TO LOG - SSP# 149480
5831 RETURN ; CALL "ZZPROM","X0FM2ODB",%X3$,Z,P4$,"","",0; ON Z GOTO 9700,5832,5838,9700 ! SSP 197483
5832 Q2$=Q2$+"FM2IAS"+Q3$
5835 Q2$=Q2$+"FM2IAU"+Q3$
5838 Q2$=Q2$+"FM2IAW"+Q3$
5880 U1$=Q2$+U1$
5890 GOTO 9700
6000 REM " SPECIAL CODE FOR COMPANY 491 - SSP# 149480
6010 IF %X3$(9,3)<>"491" THEN RETURN 
6020 CLOSE (14); OPEN (14)"FM1491"
6030 READ (14,KEY=Q1$(1,20),DOM=6100)TMP$
6040 IF STP(TMP$(126,6),3," ")="" OR TMP$(126,6)<"J80908" THEN S$=Q1$(1,20)+"    "+%X3$(21,6)+"   "+%X3$(40,3) ! SSP 197483
6050 REM "Create if necessary and open log files, used to be system calls using echo but needed change to support NT systems - SSP# 149480
6060 LOG_FILE=HFN; OPEN LOCK (LOG_FILE,ERR=*NEXT)DIR$+DLM+"SPEC_LOG"; GOTO 6080
6070 IF ERR=12 THEN SERIAL DIR$+DLM+"SPEC_LOG"; GOTO 6060 ELSE LOG_FILE=0; GOTO 6100
6080 IF LOG_FILE>0 THEN PRINT (LOG_FILE)S$
6100 RETURN 
7000 REM "Write to log file
7010 IF %X3$(9,3)="491" THEN RETURN 
7020 CLOSE (ZZP)
7030 OPEN (ZZP)"FM1"+%C$
7050 READ (ZZP,KEY=Q1$(1,20),DOM=7120)TMP$
7060 IF STP(TMP$(126,6),3," ")="" OR TMP$(126,6)<P3$(286,6) THEN S$=Q1$(1,20)+"   "+%X3$(21,6)+"   "+%X3$(40,3)
7070 REM "Create if necessary and open log files, used to be system calls using echo but needed change to support NT systems - SSP# 149480
7080 LOG_FILE=HFN; OPEN LOCK (LOG_FILE,ERR=*NEXT)DIR$+DLM+"SPEC_LOG"; GOTO 7110
7100 IF ERR=12 THEN SERIAL DIR$+DLM+"SPEC_LOG"; GOTO 7080 ELSE LOG_FILE=0; GOTO 7120
7110 IF LOG_FILE>0 AND S$<>"" THEN PRINT (LOG_FILE)S$; CLOSE (ZZP),(LOG_FILE); CMD_STR$="E",%SPEC_ANSWER$="M"; EXIT 
7120 CLOSE (ZZP,ERR=*NEXT)
7130 CLOSE (LOG_FILE,ERR=*NEXT)
7140 EXIT 
8900 REM "Functions
8910 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
8950 REM "Program flow logic
8960 DIM U0$(6); U0$(1)=FID(0),U0$=U0$+"PF"
8970 CLOSE (14); OPEN (14)"ZZPARM"; FIND (14,KEY=U0$,DOM=8990)U0$,U1$
8975 IF U1$="" THEN GOTO 8990 ELSE IF U1$(1,6)<>X0$ THEN GOTO 8990
8980 Q1=NUM(U1$(7,2)),Q1$=U1$(9,Q1),U1$=U1$(Q1+9)
8985 IF Q1$(1,1)="*" THEN Q5$=Q1$(2,11),Q1$=Q1$(13) ELSE Q5$=""
8990 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF %X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN ! SSP 197483
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9515 IF C8=2 THEN GOTO 5010
9520 ON C9 GOTO 1140,2040
9700 REM "PROG FLOW
9703 IF Q5$<>"" THEN L0=0,L1=0,L2=0
9705 CLOSE (14); OPEN (14)"ZZPARM"
9710 IF U1$="" THEN REMOVE (14,KEY=U0$,DOM=9900); GOTO 9900
9720 WRITE (14,KEY=U0$)U0$,U1$
9725 IF LOG_FILE>0 THEN CLOSE (LOG_FILE); REM " SSP # 149480
9730 RUN U1$(1,6)
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9940 SETESC 9350
9950 RUN "ZMENU"
56000 ! 185968-Force specification Check If last Order date parameter      
56001 ! not working in GUI
56002 ! "197483-Getting a gui error in order entry. ERROR=47, LN=6040
