0010 ! FMGIAC - Re-order and Other Data
0031 ! 
0035 REM "5.6 - 01/12/08 - 10.040555 - crg - SSP# 211380
0037 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
0040 REM "Copyright 2008 DemandBridge, Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 _CUSTOMER$=%CUSTOMER$,_ITEM_CODE$=%ITEM_CODE$
0060 PROCESS "FMGIAC","../FMG/FM.EN"
0070 %CUSTOMER$=_CUSTOMER$,%ITEM_CODE$=_ITEM_CODE$
0090 EXIT 
0100 ! 
0110 ! 100 - Initialization
0120 INIT:
0130 X0=-1; X2=0; X0$="FMGIAC"
0140 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2
0150 ! 
0155 DIM Z[NUM(X3$(60,3))]
0160 Z$="01O FM1...  02O AR1...  03O AP4...  04O AR3...  05O FM1...  06O ZZPARM  07O FM0...  08O ZZT  "
0170 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
0180 ! 
0190 ! dim Variables
0200 DIM FM1[31],AR1[15],AP4[2],B_FM1[31],FMP9[3],B_FMP9[3]
0220 ! DIM FM1$(300),FMP1$(200),FMP2$(200),FMP3$(200),AP4$(200)
0225 DIM FMP4$(200),FMP5$(200),FMP6$(200),FMP9$(200)
0230 ! IO List
0240 IOLIST FM1$,FM1{ALL}
0250 IOLIST FMP1$
0260 IOLIST FMP2$
0270 IOLIST FMP3$
0280 IOLIST AR1$,AR1{ALL}
0290 IOLIST AP4$,AP4{ALL}
0300 IOLIST FMP4$
0310 IOLIST FMP5$
0320 IOLIST FMP6$
0330 IOLIST FMP9$,FMP9{ALL}
0400 ! 
0410 GOSUB GET_PARM
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0520 IF %CUSTOMER$<>"" THEN {
0530 CUSTOMER$=%CUSTOMER$
0540 DISABLE CONTROL CUSTOMER.CTL
0560  }
0570 NEXT_ID=CUSTOMER.CTL,REFRESH_FLG=1
0600 IF %ITEM_CODE$<>"" THEN {
0610 ITEM_CODE$=%ITEM_CODE$
0620 DISABLE CONTROL ITEM_CODE.CTL
0625 GOTO GET_INFO
0630  }
0640 NEXT_ID=ITEM_CODE.CTL,REFRESH_FLG=1
0790 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0920 ! 
0930 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0970 RETURN 
1000 ! Get Customer Information
1010 GET_CUSTOMER:
1020 CALL "ZZWLKU;Parse_cust",CUSTOMER$,B.CUST_DIV$,B.CUST_CODE$
1030 CUSTOMER$=B.CUST_DIV$+B.CUST_CODE$
1040 READ (Z[2],KEY=CUSTOMER$,DOM=*RETURN)IOL=0280
1050 CUST_NAME$=AR1$(11,35)
1090 RETURN 
2000 ! get information from FMP
2010 GET_INFO:
2020 KEY_1$=CUSTOMER$+ITEM_CODE$
2030 READ (Z[1],KEY=KEY_1$,DOM=*RETURN)IOL=0240
2280 B_FM1$=FM1$; B_FM1{ALL}=FM1{ALL}
2290 GOSUB LOAD_PANEL
2300 RETURN 
3000 ! get info from ZZPARM
3010 GET_PARM:
3020 READ (Z[6],KEY=X3$(9,3)+"FMS")F9$
3030 READ (Z[6],KEY=X3$(9,3)+"F/M")P1$
3040 READ (Z[6],KEY=X3$(9,3)+"A/R",DOM=WRAPUP)P0$
3050 READ (Z[8],KEY="P? REORDER ")ZZT$
3060 READ (Z[6],KEY="",DOM=*RETURN)
3290 RETURN 
4000 ! load information on panel
4010 LOAD_PANEL:
4020 ITEM_DESC$=FM1$(42,40)
4030 ! Screen 1                                       
4040 PROD_CODE$=FM1$(21,3)
4050 LEFT_RIGHT$=FM1$(24,8); TOP_BOTTOM$=FM1$(32,8); PLY$=FM1$(40,2)
4060 REV_DATE$=FM1$(167,6)
4070 CIC$=FM1$(350,20)
4080 FROM_CUST$=FM1$(185,10)
4100 ! SCREEN 2
4110 PREV_ITEM_CODE$=FM1$(199,10); ITEM_CONTACT$=FM1$(209,3)
4120 REORD_GRP_CODE$=FM1$(212,3)
4130 ART$=FM1$(215,16); ART_STATUS$=FM1$(231,1); ART_DATE$=FM1$(232,6)
4200 ! SCREEN 3
4210 FOR X9=0 TO 3
4220 IF NOT(NUL(FM1$(238+X*4,4))) THEN {
4230 EXECUTE "ALT_UM"+STR(X9+1)+"$=FM1$(238+X*4,4);"+"ALT_COUNT"+STR(X9+1)+"=FM1[25+X]"
4240  }
4250 NEXT X9
4300 ! screen 4
4310 REORDER_QTY=FM1[21]; REORDER_DATE$=FM1$(109,6)
4320 REORDER_POINT=FM1[22]; REORDER_POINT_QTY=FM1[23]
4330 MTH_AVE_USAGE=FM1[24]
4340 TF_MEMO$=FM1$(389,60)
4400 ! SCREEN 4
4410 ITEM_STATUS$=FM1$(254,1); STATUS_DATE$=FM1$(255,6)
4420 MEMO_2$=FM1$(261,30)
4430 NOTE_PRINT_DATE$=FM1$(317,6); REQ_ACCESS$=FM1$(311,6)
4980 REFRESH_FLG=1
4990 RETURN 
6000 ! Check if any changes have been made
6010 CHECK_CHANGES:
6030 IF B_FM1$=FM1$ AND B_FM1[22]=FM1[22] AND B_FM1[23]=FM1[23] AND B_FM1[24]=FM1[24] AND B_FM1[25]=FM1[25] AND B_FM1[26]=FM1[26] AND B_FM1[27]=FM1[27] AND B_FM1[28]=FM1[28] THEN RETURN 
6040 MSG_1$="Changes have been made "+SEP+"Would you like to save your changes"
6050 MSGBOX MSG_1$,"Update Record","YesNo",ANS$
6060 IF ANS$="NO" THEN RETURN 
6070 WRITE (Z[1],KEY=KEY_1$)IOL=0240
6080 MSGBOX "Record Has Been Updated!","FYI"
6090 RETURN 
7000 ! Calculate On-OP Qauntity
7010 ON_PO_QTY:
7020 O0$="*"; CALL "FM2UZO",X3$,FM1$(1,20),O0$,0,0,0,0,O0,0,Q{ALL}
7030 IF O0$>"" THEN X$="",X=LEN(O0$)/5; FOR X=1 TO LEN(O0$) STEP 5; X$=X$+O0$(X,5)+", "; NEXT X; O0$=X$,X$="",O0$="  ("+O0$(1,LEN(O0$)-2)+")"; IF LEN(O0$)>40 THEN O0$="( "+STR(X)+" locations)"
7040 MSG_1$="On-PO Quantity: "+STR(O0:"###,###,###.00-")+"  "+O0$
7050 MSGBOX MSG_1$,MSG("FYI"),"INFO"
7090 RETURN 
9000 ! load data
9010 LOAD_DATA:
9015 %ITEM_STATUS$=""
9020 FOR XX=0 TO 10
9030 XX$=ZZT$(82+XX*16,16)
9040 IF NOT(NUL(XX$)) THEN %ITEM_STATUS$+=XX$+"/"; ITEM_STATUS_VAL$+=STR(XX)
9050 NEXT XX
9080 REFRESH_FLG=1
9090 RETURN 
9999 END 
10000 ! load all the variables
10010 LOAD_VARIABLES:
10040 FM1$(21,3)=PROD_CODE$
10050 FM1$(24,8)=LEFT_RIGHT$; FM1$(32,8)=TOP_BOTTOM$; FM1$(40,2)=PLY$
10060 FM1$(167,6)=REV_DATE$
10070 FM1$(350,20)=CIC$
10080 FM1$(185,10)=FROM_CUST$
10100 FM1$(199,10)=PREV_ITEM_CODE$; FM1$(209,3)=ITEM_CONTACT$
10110 FM1$(212,3)=REORD_GRP_CODE$
10120 FM1$(215,16)=ART$; FM1$(231,1)=ART_STATUS$; FM1$(232,6)=ART_DATE$
10200 FM1$(238,4)=ALT_UM1$; FM1$(242,4)=ALT_UM2$; FM1$(246,4)=ALT_UM3$; FM1$(250,4)=ALT_UM4$
10210 FM1[25]=ALT_COUNT1; FM1[26]=ALT_COUNT2; FM1[27]=ALT_COUNT3; FM1[28]=ALT_COUNT4
10300 FM1$(254,1)=ITEM_STATUS$; FM1$(255,6)=STATUS_DATE$
10310 FM1$(261,30)=MEMO_2$
10320 FM1$(317,6)=NOTE_PRINT_DATE$; FM1$(311,6)=REQ_ACCESS$
10400 FM1[21]=REORDER_QTY; FM1$(109,6)=REORDER_DATE$
10410 FM1[22]=REORDER_POINT; FM1[23]=REORDER_POINT_QTY
10420 FM1[24]=MTH_AVE_USAGE
10430 FM1$(389,60)=TF_MEMO$
10890 RETURN 
12000 ! Write record
12005 WRITE_REC:
12010 KEY_1$="D"+CUSTOMER$
12020 KEY_2$="A"+CUSTOMER$
12030 WRITE (Z[1],KEY=KEY_1$)IOL=0240
12040 IF FMS$<>"Y" THEN GOSUB UPDATE_MSG; RETURN 
12050 WRITE (Z[1],KEY=KEY_2$)IOL=0330
12060 GOSUB UPDATE_MSG
12070 RETURN 
13000 ! Delete Record
13010 DELETE_REC:
13020 MSGBOX "Are you sure you want to delete this information","Delete","YesNo",ANS$
13030 IF ANS$="NO" THEN RETURN 
13040 KEY_1$="D"+CUSTOMER$
13050 KEY_2$="A"+CUSTOMER$
13060 REMOVE (Z[1],KEY=KEY_1$)
13070 IF FMS$<>"Y" THEN GOSUB UPDATE_MSG; RETURN 
13080 REMOVE (Z[1],KEY=KEY_2$)
13090 GOSUB UPDATE_MSG
13100 REFRESH_FLG=1
13110 RETURN 
15000 ! Update Message
15010 UPDATE_MSG:
15020 MSGBOX "The Information have been Update.","FYI"
15030 RETURN 
56001 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
