0010 ! FMGMPA - File Maintenance Program for APX_GLInterface (="APX"+%C$)
0020 ! Generated by ProvideX® NOMADS II File Maintenance on May. 15, 2003 10:00
0030 ! ************************************************************************
0035 REM "5.5 - 09/10/07 - 11.978055 - jdf - SSP# 211380
0037 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 PROCESS "OPGMPA","../PMG/PM.EN"
0060 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 ! 
0130 X0$="FM2MPA",X1$="Order Processing Parameter Setup"
0140 ! 
0150 X0=-1,X2=-1
0160 CALL "ZZCOMP",X0$,X11$,X2$,X3$,X4$,X5$,X0,X1,X2; IF X1>0 THEN GOSUB WRAPUP
0170 ! 
0190 DIM Z[NUM(X3$(60,3))],PARAM[6],PARAM_2[29],B_PARAM[6],B_PARAM_2[29]
0200 ! Files
0210 Z$="06O ZZPARM  "
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
0300 ! IOList Section
0310 IOLIST PARAM$,PARAM{ALL}
0320 IOLIST PARAM_2$,PARAM_2{ALL}
0400 ! System Parameters
0420 GOSUB GET_SYS_PARAM
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0790 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0970 RETURN 
2000 ! Load Screen with Parameter Information
2010 LOAD_SCREEN_1:
2015 GOSUB LOAD_FY
2020 FM.A17$=PARAM$(143,4); FM.A4$=PARAM$(19,2)
2030 FM.A2$=PARAM$(8,1); FM.A5$=PARAM$(21,1); FM.A3_Q$=PARAM$(9,8)
2040 FM.A18$=PARAM$(147,1); FM.A19$=PARAM$(148,1)
2050 FM0=PARAM[0]; FM6=PARAM[6]; FM1=PARAM[1]
2060 IF NOT(NUL(B1$)) THEN CALL "*WINGRP;SHOW",WORK_ORDER.GRP$ ELSE CALL "*WINGRP;HIDE",WORK_ORDER.GRP$
2065 FM2=PARAM[2]; FM3=PARAM[3]; FM4=PARAM[4]; FM5=PARAM[5]
2070 FOR I=0 TO 4; EXECUTE "FM.A"+STR(I+7)+"$=PARAM$(23+"+STR(I)+"*12,12)"; NEXT I
2075 FOR I=0 TO 4; EXECUTE "FM.A"+STR(I+12)+"$=PARAM$(83+"+STR(I)+"*12,12)"; NEXT I
2080 REFRESH_FLG=1
2090 RETURN 
2100 ! Parametr Screen 2
2105 LOAD_SCREEN_2:
2110 FM.A20$=PARAM$(149,1); FM.A21$=PARAM$(150,1); FM.A22$=PARAM$(151,1)
2115 IF FM.A20$="Y" THEN CALL "*WINGRP;ENABLE",A21.GRP$
2120 FM.A23$=PARAM$(152,1); FM.A24$=PARAM$(153,1); FM.A25$=PARAM$(154,1)
2130 FM.A26$=PARAM$(155,1); FM.A27$=PARAM$(156,1); FM.A28$=PARAM$(157,1)
2140 FM.A29$=PARAM$(158,1); FM.A30$=PARAM$(159,1); FM.A31$=PARAM$(160,1)
2150 FM.A32$=PARAM$(161,5); FM.A33$=PARAM$(166,1); FM.A34$=PARAM$(167,1)
2160 FM.A35$=PARAM$(168,1); FM.A36$=PARAM$(169,1); FM.A37$=PARAM$(170,1)
2170 FM.A120$=PARAM$(286,6)
2175 IF POS(X3$(9,3)="500084067",3)<>0 THEN CALL "*WINGRP;ENABLE",A34.GRP$
2180 REFRESH_FLG=1
2190 RETURN 
2200 ! LOAD SCREEN 3
2210 LOAD_SCREEN_3:
2215 IF FM.A19$="Y" THEN CALL "*WINGRP;ENABLE",PROMO.GRP$
2220 FM.A57$=PARAM$(201,1); FM.A60$=PARAM$(204,1)
2230 FM.A58$=PARAM$(202,1); FM.A59$=PARAM$(203,1); FM.A61$=PARAM$(205,2)
2240 FM.A62$=PARAM$(207,3); FM.A63$=PARAM$(210,3)
2280 REFRESH_FLG=1
2290 RETURN 
2300 ! LOAD SCREEN 4 PARAMETERS
2310 LOAD_SCREEN_4:
2320 FM.A38$=PARAM$(171,1); FM.A39$=PARAM$(172,10); FM.A40$=PARAM$(182,1)
2325 IF FM.A38$="Y" THEN CALL "*WINGRP;ENABLE",CUST.GRP$ ELSE FM.A39$=""; CALL "*WINGRP;DISABLE",CUST.GRP$
2330 FM.A41$=PARAM$(183,1); FM.A42$=PARAM$(184,1); FM.A43$=PARAM$(185,1)
2340 FM.A44$=PARAM$(186,1); FM.A45$=PARAM$(187,1); FM.A46$=PARAM$(188,1)
2350 FM.A47$=PARAM$(189,1); FM.A48$=PARAM$(190,1); FM.A49$=PARAM$(191,1)
2360 FM.A50$=PARAM$(192,1); FM.A51$=PARAM$(193,1); FM.A52$=PARAM$(194,1)
2370 FM.A53$=PARAM$(195,1); FM.A54$=PARAM$(196,1); FM.A55$=PARAM$(197,1)
2380 FM.A56$=PARAM$(198,1)
2480 REFRESH_FLG=1
2490 RETURN 
2500 ! LOAD SCREEN 5 PARAMETERS
2510 LOAD_SCREEN_5:
2520 FM.A64$=PARAM$(213,1); FM.A65$=PARAM$(214,5); FM.A66$=PARAM$(219,1)
2525 IF FM.A64$="Y" THEN CALL "*WINGRP;ENABLE",STOCK.GRP$ ELSE CALL "*WINGRP;DISABLE",STOCK.GRP$
2530 FM.A67$=PARAM$(220,1); FM.A68$=PARAM$(221,1); FM.A69$=PARAM$(222,1)
2540 FM.A70$=PARAM$(223,1); FM.A71$=PARAM$(224,1); FM.A72$=PARAM$(225,1)
2550 FM.A73$=PARAM$(226,1); FM.A74$=PARAM$(227,1); FM.A75$=PARAM$(228,1)
2560 FM.A76$=PARAM$(229,10); FM.A77$=PARAM$(239,1); FM.A78$=PARAM$(240,1)
2570 FM.A79$=PARAM$(241,1); FM.A80$=PARAM$(242,1); FM.A81$=PARAM$(243,1)
2575 FM.A82$=PARAM$(244,1)
2580 REFRESH_FLG=1
2590 RETURN 
2600 ! LOAD SCREEN 6 PARAMETERS
2610 LOAD_SCREEN_6:
2620 FM.A83$=PARAM$(245,1); FM.A84$=PARAM$(246,1); FM.A85$=PARAM$(247,1)
2630 FM.A86$=PARAM$(248,1); FM.A87$=PARAM$(249,1); FM.A88$=PARAM$(250,1)
2640 FM.A89$=PARAM$(251,1); FM.A90$=PARAM$(252,1); FM.A91$=PARAM$(253,1)
2650 FM.A92$=PARAM$(254,1); FM.A93$=PARAM$(255,1); FM.A94$=PARAM$(256,1)
2660 FM.A95$=PARAM$(257,1); FM.A96$=PARAM$(258,1); FM.A97$=PARAM$(259,1)
2670 FM.A98$=PARAM$(260,1); FM.A99$=PARAM$(261,1); FM.A100$=PARAM$(262,1)
2675 FM.A101$=PARAM$(263,1); FM.A133$=PARAM$(307,2)
2680 REFRESH_FLG=1
2690 RETURN 
2700 ! LOAD SCREEN 7 PARAMETERS
2710 LOAD_SCREEN_7:
2720 FM.A102$=PARAM$(264,1); FM.A103$=PARAM$(265,1); FM.A104$=PARAM$(266,1)
2725 IF FM.A104$="Y" THEN CALL "*WINGRP;ENABLE",PO_NUM.GRP$ ELSE CALL "*WINGRP;DISABLE",PO_NUM.GRP$
2730 FM.A105$=PARAM$(267,5); FM.A106$=PARAM$(272,1); FM.A107$=PARAM$(273,1)
2735 IF FM.A107$="Y" THEN CALL "*WINGRP;ENABLE",REPEAT.GRP$ ELSE FM.A108$="N"; CALL "*WINGRP;DISABLE",REPEAT.GRP$
2740 FM.A108$=PARAM$(274,1); FM.A109$=PARAM$(275,1); FM.A110$=PARAM$(276,1)
2750 FM.A111$=PARAM$(277,1); FM.A112$=PARAM$(278,1); FM.A113$=PARAM$(279,1)
2760 FM.A114$=PARAM$(280,1); FM.A115$=PARAM$(281,1); FM.A116$=PARAM$(282,1)
2770 FM.A117$=PARAM$(283,1); FM.A118$=PARAM$(284,1); FM.A119$=PARAM$(285,1); FM.A122$=PARAM$(292,5)
2780 REFRESH_FLG=1
2790 RETURN 
2800 ! LOAD SCREEN 8 PARAMETERS
2810 LOAD_SCREEN_8:
2820 FM.A123$=PARAM$(297,1); FM.A124$=PARAM$(298,1); FM.A125$=PARAM$(299,1)
2830 FM.A126$=PARAM$(300,1); FM.A127$=PARAM$(301,1); FM.A128$=PARAM$(302,1)
2840 FM.A129$=PARAM$(303,1); FM.A130$=PARAM$(304,1); FM.A131$=PARAM$(305,1)
2850 FM.A132$=PARAM$(306,1); FM.A134$=PARAM$(309,1); FM.A135$=PARAM$(310,1)
2880 REFRESH_FLG=1
2890 RETURN 
3000 ! Write the record
3010 WRITE_REC:
3040 WRITE (Z[6],KEY=X3$(9,3)+"F/M")IOL=0310
3060 B_PARAM$=PARAM$
3070 FOR XX=0 TO 6; B_PARAM[XX]=PARAM[XX]; NEXT XX
3090 RETURN 
4000 ! load Information into Parameter String
4010 LOAD_INFO_1:
4020 PARAM$(143,4)=FM.A17$; PARAM$(19,2)=FM.A4$
4030 PARAM$(8,1)=FM.A2$; PARAM$(21,1)=FM.A5$; PARAM$(9,8)=FM.A3_Q$
4040 PARAM$(147,1)=FM.A18$; PARAM$(148,1)=FM.A19$
4050 PARAM[0]=FM0; PARAM[6]=FM6; PARAM[1]=FM1
4060 PARAM[2]=FM2; PARAM[3]=FM3; PARAM[4]=FM4; PARAM[5]=FM5
4070 FOR I=0 TO 4; EXECUTE "PARAM$(23+"+STR(I)+"*12,12)=FM.A"+STR(I+7)+"$"; NEXT I
4075 FOR I=0 TO 4; EXECUTE "PARAM$(83+"+STR(I)+"*12,12)=FM.A"+STR(I+12)+"$"; NEXT I
4085 WRITE (Z[6],KEY=X3$(9,3)+"F/M")IOL=0310
4090 RETURN 
4100 ! Parametr Screen 2
4105 LOAD_INFO_2:
4110 PARAM$(149,1)=FM.A20$; PARAM$(150,1)=FM.A21$; PARAM$(151,1)=FM.A22$
4120 PARAM$(152,1)=FM.A23$; PARAM$(153,1)=FM.A24$; PARAM$(154,1)=FM.A25$
4130 PARAM$(155,1)=FM.A26$; PARAM$(156,1)=FM.A27$; PARAM$(157,1)=FM.A28$
4140 PARAM$(158,1)=FM.A29$; PARAM$(159,1)=FM.A30$; PARAM$(160,1)=FM.A31$
4150 PARAM$(161,5)=FM.A32$; PARAM$(166,1)=FM.A33$; PARAM$(167,1)=FM.A34$
4160 PARAM$(168,1)=FM.A35$; PARAM$(169,1)=FM.A36$; PARAM$(170,1)=FM.A37$
4170 PARAM$(286,6)=FM.A120$
4185 WRITE (Z[6],KEY=X3$(9,3)+"F/M")IOL=0310
4190 RETURN 
4200 ! Parameter Screen 3
4210 LOAD_INFO_3:
4220 PARAM$(201,1)=FM.A57$; PARAM$(204,1)=FM.A60$
4230 PARAM$(202,1)=FM.A58$; PARAM$(203,1)=FM.A59$; PARAM$(205,2)=FM.A61$
4240 PARAM$(207,3)=FM.A62$; PARAM$(210,3)=FM.A63$
4285 WRITE (Z[6],KEY=X3$(9,3)+"F/M")IOL=0310
4290 RETURN 
4300 ! LOAD SCREEN 4 PARAMETERS
4310 LOAD_INFO_4:
4320 PARAM$(171,1)=FM.A38$; PARAM$(172,10)=FM.A39$; PARAM$(182,1)=FM.A40$
4330 PARAM$(183,1)=FM.A41$; PARAM$(184,1)=FM.A42$; PARAM$(185,1)=FM.A43$
4340 PARAM$(186,1)=FM.A44$; PARAM$(187,1)=FM.A45$; PARAM$(188,1)=FM.A46$
4350 PARAM$(189,1)=FM.A47$; PARAM$(190,1)=FM.A48$; PARAM$(191,1)=FM.A49$
4360 PARAM$(192,1)=FM.A50$; PARAM$(193,1)=FM.A51$; PARAM$(194,1)=FM.A52$
4370 PARAM$(195,1)=FM.A53$; PARAM$(196,1)=FM.A54$; PARAM$(197,1)=FM.A55$
4380 PARAM$(198,1)=FM.A56$
4485 WRITE (Z[6],KEY=X3$(9,3)+"F/M")IOL=0310
4490 RETURN 
4500 ! LOAD SCREEN 5 PARAMETERS
4510 LOAD_INFO_5:
4520 PARAM$(213,1)=FM.A64$; PARAM$(214,5)=FM.A65$; PARAM$(219,1)=FM.A66$
4530 PARAM$(220,1)=FM.A67$; PARAM$(221,1)=FM.A68$; PARAM$(222,1)=FM.A69$
4540 PARAM$(223,1)=FM.A70$; PARAM$(224,1)=FM.A71$; PARAM$(225,1)=FM.A72$
4550 PARAM$(226,1)=FM.A73$; PARAM$(227,1)=FM.A74$; PARAM$(228,1)=FM.A75$
4560 PARAM$(229,10)=FM.A76$; PARAM$(239,1)=FM.A77$; PARAM$(240,1)=FM.A78$
4570 PARAM$(241,1)=FM.A79$; PARAM$(242,1)=FM.A80$; PARAM$(243,1)=FM.A81$
4575 PARAM$(244,1)=FM.A82$
4585 WRITE (Z[6],KEY=X3$(9,3)+"F/M")IOL=0310
4590 RETURN 
4600 ! LOAD SCREEN 6 PARAMETERS
4610 LOAD_INFO_6:
4620 PARAM$(245,1)=FM.A83$; PARAM$(246,1)=FM.A84$; PARAM$(247,1)=FM.A85$
4630 PARAM$(248,1)=FM.A86$; PARAM$(249,1)=FM.A87$; PARAM$(250,1)=FM.A88$
4640 PARAM$(251,1)=FM.A89$; PARAM$(252,1)=FM.A90$; PARAM$(253,1)=FM.A91$
4650 PARAM$(254,1)=FM.A92$; PARAM$(255,1)=FM.A93$; PARAM$(256,1)=FM.A94$
4660 PARAM$(257,1)=FM.A95$; PARAM$(258,1)=FM.A96$; PARAM$(259,1)=FM.A97$
4670 PARAM$(260,1)=FM.A98$; PARAM$(261,1)=FM.A99$; PARAM$(262,1)=FM.A100$
4675 PARAM$(263,1)=FM.A101$; PARAM$(307,2)=FM.A133$
4685 WRITE (Z[6],KEY=X3$(9,3)+"F/M")IOL=0310
4690 RETURN 
4700 ! LOAD SCREEN 7 PARAMETERS
4710 LOAD_INFO_7:
4720 PARAM$(264,1)=FM.A102$; PARAM$(265,1)=FM.A103$; PARAM$(266,1)=FM.A104$
4730 PARAM$(267,5)=FM.A105$; PARAM$(272,1)=FM.A106$; PARAM$(273,1)=FM.A107$
4740 PARAM$(274,1)=FM.A108$; PARAM$(275,1)=FM.A109$; PARAM$(276,1)=FM.A110$
4785 WRITE (Z[6],KEY=X3$(9,3)+"F/M")IOL=0310
4790 RETURN 
4800 ! LOAD SCREEN 8 PARAMETERS
4810 LOAD_INFO_8:
4820 PARAM$(297,1)=FM.A123$; PARAM$(298,1)=FM.A124$; PARAM$(299,1)=FM.A125$
4830 PARAM$(300,1)=FM.A126$; PARAM$(301,1)=FM.A127$; PARAM$(302,1)=FM.A128$
4840 PARAM$(303,1)=FM.A129$; PARAM$(304,1)=FM.A130$; PARAM$(305,1)=FM.A131$
4850 PARAM$(306,1)=FM.A132$; PARAM$(309,1)=FM.A134$; PARAM$(310,1)=FM.A135$
4885 WRITE (Z[6],KEY=X3$(9,3)+"F/M")IOL=0310
4890 RETURN 
5000 ! Check Changes
5010 CHECK_CHANGES:
5020 GOSUB VERIFY_CHANGE
5030 IF CHG_FLG=0 THEN RETURN 
5040 MSGBOX MSG("REC_ALTERD"),MSG("UPDATED"),"?,YESNO",ANS$
5050 IF ANS$="NO" THEN RETURN 
5060 GOSUB WRITE_REC
5090 RETURN 
5500 ! FIND WHAT SCREEN IS CURRENTLY ACTIVE
5510 FIND_SCREEN:
5520 IF FOLDER_ID$="FMGMPA.1" THEN GOSUB LOAD_INFO_1; RETURN 
5530 IF FOLDER_ID$="FMGMPA.2" THEN GOSUB LOAD_INFO_2; RETURN 
5540 IF FOLDER_ID$="FMGMPA.3" THEN GOSUB LOAD_INFO_3; RETURN 
5550 IF FOLDER_ID$="FMGMPA.4" THEN GOSUB LOAD_INFO_4; RETURN 
5560 IF FOLDER_ID$="FMGMPA.5" THEN GOSUB LOAD_INFO_5; RETURN 
5565 IF FOLDER_ID$="FMGMPA.6" THEN GOSUB LOAD_INFO_6; RETURN 
5570 IF FOLDER_ID$="FMGMPA.7" THEN GOSUB LOAD_INFO_7; RETURN 
5580 IF FOLDER_ID$="FMGMPA.8" THEN GOSUB LOAD_INFO_8; RETURN 
5590 RETURN 
7000 ! Check if tax module is installed.
7010 PROCESS_FM.A20:
7020 IF FM.A20$<>"Y" THEN FM.A21$="N" ELSE CALL "*WINGRP;ENABLE",A21.GRP$
7080 REFRESH_FLG=1
7090 RETURN 
7100 ! DETERMINE ml CODE
7110 PROCESS_FM.60:
7120 IF NOT(POS(FM.A60$="CT")) THEN {
7130 FM.A61$="",FM.A62$="",FM.A63$=""
7140 CALL "*WINGRP;DISABLE",CODES.GRP$
7150  } ELSE {
7160 CALL "*WINGRP;ENABLE",CODES.GRP$
7170  }
7180 REFRESH_FLG=1
7190 RETURN 
7200 ! MAILING CODES.
7225 PROCESS_FM.A61:! ^25,5 - Verify mailing label code is correct
7230 IF (FM.A60$="C" AND NUM(FM.A61$)>3) OR (FM.A60$="T" AND NUM(FM.A61$)>11) THEN {
7235 MSGBOX "Invalid Mailing Label code."+SEP+"If update by 'Customer', Mailing Label code value is between 1 and 3"+SEP+"If update by 'Telemarketing', Mailing Label code value is between 1 and 11","Attention",""
7240 FM.A61$="",REFRESH_FLG=1
7245  }
7290 RETURN 
7300 ! G/P ADJUSTMENT
7310 PROCESS_FM.A38:
7320 IF FM.A38$="Y" THEN {
7330 CALL "*WINGRP;ENABLE",CUST.GRP$
7340  } ELSE {
7350 FM.A39$=""; CALL "*WINGRP;DISABLE",CUST.GRP$
7360  }
7380 REFRESH_FLG=1
7390 RETURN 
7400 ! STOCK PURCHASE ORDERS
7410 PROCESS_FM.A64:
7420 IF FM.A64$="Y" THEN CALL "*WINGRP;ENABLE",STOCK.GRP$ ELSE CALL "*WINGRP;DISABLE",STOCK.GRP$
7480 REFRESH_FLG=1
7490 RETURN 
7500 ! pPO CODE
7510 PROCESS_FM.A104:
7520 IF FM.A104$="Y" THEN CALL "*WINGRP;ENABLE",PO_NUM.GRP$ ELSE CALL "*WINGRP;DISABLE",PO_NUM.GRP$
7590 REFRESH_FLG=1; RETURN 
7600 ! REPEAT ORDERS
7610 PROCESS_FM.A107:
7620 IF FM.A107$="Y" THEN CALL "*WINGRP;ENABLE",REPEAT.GRP$ ELSE FM.A108$="N"; CALL "*WINGRP;DISABLE",REPEAT.GRP$
7680 REFRESH_FLG=1
7690 RETURN 
8000 ! Add Messages
8010 ADD_MSG:
8020 MSGBOX MSG("ADD_RECORD")+SEP+MSG("OP_REC"),MSG("VERIFY"),"?,YESNO",ANS$
8030 IF ANS$="NO" THEN CMD_STR$="END"; RETURN 
8040 DIM PARAM$(512),PARAM[6]
8050 NEXT_ID=APG.AP001.CTL
8090 RETURN 
8100 ! Add Messages
8110 ADD_MSG2:
8120 MSGBOX MSG("ADD_RECORD")+SEP+MSG("AR1_REC"),MSG("VERIFY"),"?,YESNO",ANS$
8130 IF ANS$="NO" THEN CMD_STR$="END"; RETURN 
8140 DIM PARAM_2$(100),PARAM_2[29]
8150 NEXT_ID=APG.AP001.CTL
8190 RETURN 
8500 ! CHECK FOR CHANGES
8510 VERIFY_CHANGE:
8520 CHG_FLG=0
8530 IF B_PARAM$<>PARAM$ THEN CHG_FLG=1
8540 IF B_PARAM_2$<>PARAM_2$ THEN CHG_FLG=1
8550 FOR XX=0 TO 6; IF B_PARAM[XX]<>PARAM[XX] THEN CHG_FLG=1
8555 NEXT XX
8590 RETURN 
9000 ! Parameters
9010 GET_SYS_PARAM:
9030 B1$=""; READ (Z[6],KEY=X3$(9,3)+"F/W",DOM=*NEXT)B1$
9040 EXTRACT (Z[6],KEY=X3$(9,3)+"F/M",DOM=*NEXT)
9050 READ (Z[6],KEY=X3$(9,3)+"F/M",DOM=ADD_MSG)IOL=0310
9060 B_PARAM$=PARAM$
9070 FOR XX=0 TO 6; B_PARAM[XX]=PARAM[XX]; NEXT XX
9090 RETURN 
9999 END 
39000 LOAD_FY:
39010 ! ONLY_OPEN$="Y" means only load open FY's, TF_MODULE$ can be set to second part of key for that system parameter record, ie A/P, A/R, I/C
39020 ONLY_OPEN$="Y"
39030 FM.A17$=""; FM.A4$=""
39040 CUR_FY$="",CUR_ACCTPD$=""; READ (Z[6],KEY=%C$+"A/R",DOM=*NEXT)SYS_PARMS$; CUR_FY$=SYS_PARMS$(7,4),CUR_ACCTPD$=SYS_PARMS$(11,2)
39045 IF NOT(NUL(PARAM$(143,4))) THEN CUR_FY$=PARAM$(143,4)
39047 IF NOT(NUL(PARAM$(19,2))) THEN CUR_ACCTPD$=PARAM$(19,2)
39050 DIM GL$(300); READ (Z[6],KEY=%C$+"G/L")GL$(1)
39060 DIM OSEC$(255); READ (Z[6],KEY="osec"+%X3_OP_ID$,DOM=*NEXT)OSEC$
39070 READ (Z[6],KEY=%C$+"G/LYE",DOM=*NEXT)
39080 K$=KEY(Z[6],END=LOAD_FY_DROP_BOX); READ (Z[6],KEY=K$)GLYE$
39090 IF LEN(K$)<8 OR K$(1,8)<>%C$+"G/LYE" THEN GOTO LOAD_FY_DROP_BOX
39100 IF ONLY_OPEN$="Y" AND POS(GLYE$(99,1)="CR")>0 THEN GOTO 39080
39110 IF GL$(256,1)="Y" AND OSEC$(58,1)<>"Y" AND K$(9,4)<GL$(34,4) THEN GOTO 39080
39120 FM.A17$=FM.A17$+K$(9,4)+"/"
39130 GOTO 39080
39140 LOAD_FY_DROP_BOX:
39150 DROP_BOX LOAD FM.A17.CTL,FM.A17$
39160 IF CUR_FY$<>"" THEN IF GL$(256,1)="Y" AND OSEC$(58,1)<>"Y" AND CUR_FY$<GL$(34,4) THEN CUR_FY$=GL$(34,4),CUR_ACCTPD$=GL$(38,2)
39170 IF CUR_ACCTPD$<>"" THEN IF GL$(256,1)="Y" AND OSEC$(58,1)<>"Y" AND CUR_ACCTPD$<GL$(38,2) THEN CUR_ACCTPD$=GL$(38,2)
39180 IF CUR_FY$<>"" THEN DROP_BOX WRITE FY.CTL,CUR_FY$
39185 FM.A17$=CUR_FY$
39190 IF CUR_FY$<>"" THEN FROM_FY$="Y",FM.A17$=CUR_FY$; GOSUB LOAD_ACCTPD
39210 LOAD_FY_END:RETURN 
39220 ! 
39230 LOAD_ACCTPD:
39240 ! FY$ should be set to a valid fiscal year
39250 FM.A4$=""; FROM_FY$="Y"
39260 IF FROM_FY$="Y" THEN GOTO 39280
39280 READ (Z[6],KEY=%C$+"G/LYE"+FM.A17$,DOM=LOAD_ACCTPD_END)GLYE$
39290 PDS=12; PDS=NUM(GLYE$(13,2),ERR=*NEXT) ! Number of periods in this FY
39300 FOR X=1 TO PDS
39310 X$=STR(X:"00"),FLAG$="NO"; CALL "ARGDTE",%X3$,%X4$,FM.A17$+X$,FLAG$; IF FLAG$<>"*" THEN FM.A4$=FM.A4$+X$+"/" ! Checks osec, only load valid periods
39320 NEXT X
39330 DROP_BOX LOAD FM.A4.CTL,FM.A4$
39340 IF FROM_FY$="Y" AND CUR_ACCTPD$<>"" THEN DROP_BOX WRITE FM.A4.CTL,CUR_ACCTPD$
39350 FM.A4$=CUR_ACCTPD$
39360 LOAD_ACCTPD_END:RETURN 
40000 PROCESS_FM.A65:
40005 IF STP(FM.A122$)="" THEN FM.A122$=" "
40010 FOR AA=1 TO LEN(FM.A122$)
40020 IF POS(FM.A122$(AA,1)="SIP ")=0 THEN NEXT_ID=FM.A122.CTL; EXIT 
40030 NEXT 
40035 PARAM$(292,5)=FM.A122$
40040 RETURN 
56000 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
