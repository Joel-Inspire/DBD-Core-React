0010 ! FMGIAR - Item Specification Maintenance
0035 REM "5.7 - 07/09/13 - 10.539444 - tma - SSP# 264165
0037 REM "264165-589 - unable to get into spec section of RFQ# 05-04295      
0040 REM "Copyright 2013 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 _CUSTOMER$=%CUSTOMER$,_ITEM_CODE$=%ITEM_CODE$
0060 PROCESS "FMGIAR","../FMG/FM.EN"
0070 %CUSTOMER$=_CUSTOMER$,%ITEM_CODE$=_ITEM_CODE$
0080 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 ! 
0130 X0$="FM2IAR",X1$="Item Specs"
0140 X0=-1,X2=-1
0150 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2; IF X1>0 THEN CMD_STR$="END"; RETURN 
0160 ! 
0190 DIM Z[NUM(X3$(60,3))],AP4$(426),AP4[2],B_AP4[2],ASV[3]
0200 ! Files
0210 IF %RFQ THEN Z$="01X QSF...  02O FSE...  03O FMP... 04O QS1...  06O ZZPARM  " ELSE Z$="01X FSF...  02O FSE...  03O FMP... 04O FM1...  05O IC0...  06O ZZPARM  " ! SSP206206 jdf, 261680
0215 IF STP(%SPEC$)<>"" THEN Z$="01X QSF...  02O FSE...  03O FMP... 04O QS1...  06O ZZPARM  "
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; IF Z0>0 THEN CMD_STR$="END"; RETURN 
0300 ! IOList
0310 IOLIST FSF$(1)
0380 IOLIST FSE$
0400 ! Get system Parameters...
0410 ! GOSUB GET_PARAM
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0520 IF %CUSTOMER$<>"" THEN {
0530 CUSTOMER$=%CUSTOMER$
0540 DISABLE CONTROL CUSTOMER.CTL
0550  }
0560 NEXT_ID=CUSTOMER.CTL
0570 ! GOSUB CHECK_PARAM
0600 IF %ITEM_CODE$<>"" THEN {
0610 ITEM_CODE$=%ITEM_CODE$
0620 DISABLE CONTROL ITEM_CODE.CTL
0630  }
0640 NEXT_ID=ITEM_CODE.CTL
0650 GOSUB GET_TEMPLATE
0780 REFRESH_FLG=1
0790 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0930 %TEMP$=""
0970 RETURN 
3000 ! Write out the Record...
3010 WRITE_REC:
3020 REM MSGBOX MSG("UPDATE_REC"),MSG("CONFIRM"),"?,YESNO",ANS$ ! SSP227471 jdf
3030 REM IF ANS$="NO" THEN RETURN ! SSP227471 jdf
3035 FSF$(1,23+K9)=%SPEC$+CUSTOMER$+ITEM_CODE$+TEMPLATE$
3040 IF STP(%SPEC$)="" THEN WRITE (Z[1],KEY=FSF$(1,20))IOL=0310 ELSE WRITE (Z(1),KEY=FSF$(1,11))IOL=0310
3080 B_FSF$=FSF$
3090 RETURN 
4000 ! Delete the Record
4010 DELETE_REC:
4020 MSGBOX MSG("DELETE_REC"),MSG("VERIFY"),"?,YesNo",ANS$
4030 IF ANS$="NO" THEN RETURN 
4040 REMOVE (Z[1],KEY=KEY_1$)
4190 RETURN 
5000 ! Check Changes
5010 CHECK_CHANGES:
5020 IF B_FSF$=FSF$ THEN RETURN 
5030 MSGBOX MSG("REC_ALTERD"),MSG("UPDATE"),"?,YESNO",ANS$
5040 IF ANS$="NO" THEN CMD_STR$="END"; RETURN 
5060 GOSUB WRITE_REC
5090 RETURN 
9000 ! Get all system parameters....
9010 GET_PARAM:
9020 DIM SEC$(255); FIND (Z[6],KEY="osec"+X3$(40,3),DOM=*NEXT)SEC$
9030 FIND (Z[6],KEY=X3$(9,3)+"A/P")F0$
9040 READ (Z[6],KEY=X3$(9,3)+"AP2A",DOM=*NEXT)F1$
9080 REFRESH_FLG=1
9090 RETURN 
9100 ! check parameters
9110 CHECK_PARAM:
9120 IF POS(X3$(9,2)="500538118130",3)>0 THEN CALL "*wingrp;Show",FILE_OUT.GRP$
9130 IF F0$(16,1)<>"Y" THEN CALL "*wingrp;Hide",BANK_C.GRP$
9140 IF F0$(66,1)<>"Y" THEN CALL "*wingrp;Hide",DISC.GRP$
9150 IF F0$(78,1)<>"Y" THEN CALL "*wingrp;Hide",INTER.GRP$
9190 RETURN 
9999 END 
21040 ! 
21100 LOAD_GRID:! ^100,5 - Load user defined fields and vendor data
21103 IF TEMPLATE$="BLA" OR TEMPLATE$="BLB" THEN GOSUB LOAD_BLA_GRID; RETURN 
21105 _CHANGE_FLG=CHANGE_FLG
21110 GRID CLEAR ITEM_SPEC.CTL,0,0; _ROW=0; DIM ROW_ARRAY[200],ROW_DATE[200]
21115 ! 
21120 ! IF NOT(GRID_ROWS) THEN {
21125 ! NEXT_FOLDER=FLDR.FMGIAR.1.CTL,REFRESH_FLG=1,CHANGE_FLG=0
21130 ! RETURN
21135 ! }
21140 ITEM_SPEC.CTL'COLUMN=-1,ITEM_SPEC.CTL'COLUMNWIDTH=0,ITEM_SPEC.CTL'ROW=-1,ITEM_SPEC.CTL'ROWHEIGHT=0
21150 ITEM_SPEC.CTL'COLUMNSWIDE=2; GRID LOCK ITEM_SPEC.CTL,1,0; ITEM_SPEC.CTL'COLUMN=2,ITEM_SPEC.CTL'COLUMNWIDTH=52,ITEM_SPEC.CTL'COLUMN=1,ITEM_SPEC.CTL'COLUMNWIDTH=25
21152 DIM FSF$(1650); IF STP(%SPEC$)="" THEN K9=0,FSF$(1,20)=CUSTOMER$+ITEM_CODE$,FSF$(21,3)=TEMPLATE$,KK$=FSF$(1,20) ELSE FSF$(1,31)=%SPEC$+CUSTOMER$+ITEM_CODE$,FSF$(32,3)=TEMPLATE$,KK$=FSF$(1,11),K9=11
21182 READ (Z[1],KEY=KK$,DOM=*NEXT)IOL=0310
21183 FSF$(21+K9,3)=FMP$(33,3) ! IF FSF$(21+K9,3)<>FMP$(33+K9,3) THEN MSGBOX "This item has a spec with template code "+FSF$(21+K9,3)+". Prod Code indicates "+FMP$(33+K9,3)+" Continue?","Confirm","?,YESNO",ANS$; IF ANS$<>"YES" THEN CMD_STR$="END"; EXIT ELSE FSF$(21+K9,3)=FMP$(33,3)
21184 FSF_DATA$=MID(FSF$,31+K9); B_FSF$=FSF$,TEMPLATE$=FSF$(21+K9,3)
21185 READ (Z[2],KEY=FSF$(21+K9,3),DOM=*NEXT)
21187 KEY_2$=KEY(Z[2],END=21250); READ (Z[2])IOL=0380
21188 IF KEY_2$(1,3)<>FSF$(21+K9,3) THEN GOTO 21250
21190 ITEM_SPEC.CTL'COLUMN=1
21195 IF NUL(FSE$(27,6)) AND (NUL(FSE$(7,20)) OR NUL(STP(STP(FSE$(72,40),3,"-"),3))) THEN GOTO 21187 ! If Heading (nul(fse$(27,6)) ) and heading field is blank OR the screen text is all '-'s then skip it
21196 IF STP(FSE$(72,40),2)<>"" THEN FLD_TXT$=FSE$(72,40) ELSE FLD_TXT$=FSE$(7,20) ! SSP#233645
21198 _ROW+=1; IF _ROW>1 THEN GRID LOAD ITEM_SPEC.CTL,1,0,"A"
21199 IF NUL(FSE$(27,6)) THEN ITEM_SPEC.CTL'ROW=_ROW,ITEM_SPEC.CTL'VALUE$=STP(FLD_TXT$,1),ITEM_SPEC.CTL'ALIGN$="Left",ITEM_SPEC.CTL'CELLTYPE$="ellipsis",ITEM_SPEC.CTL'BACKCOLOUR$="BLUE",ITEM_SPEC.CTL'TEXTCOLOUR$="WHITE"; ITEM_SPEC.CTL'COLUMN=2,ITEM_SPEC.CTL'LOCK=1,ITEM_SPEC.CTL'BACKCOLOUR$="BLUE"; GOTO 21187
21200 ITEM_SPEC.CTL'ROW=_ROW,ITEM_SPEC.CTL'VALUE$=STP(STP(FLD_TXT$,2),1,":")+":",ITEM_SPEC.CTL'CELLTYPE$="ellipsis",ITEM_SPEC.CTL'ALIGN$="Right" ! SSP#233645
21205 ! 
21210 FSE_DATA$=MID(FSF_DATA$,1,NUM(FSE$(33,3))); FSF_DATA$=MID(FSF_DATA$,NUM(FSE$(33,3))+1)
21215 ROW_ARRAY[_ROW]=NUM(FSE$(33,3))
21220 IF STP(FSE_DATA$,2)<>"" THEN FIELD_DATA$=FSE_DATA$
21222 IF FSE$(27,1)="D" THEN CALL "ZZWDTE;DISPLAY",FIELD_DATA$; ROW_DATE[_ROW]=1
21225 ! IF STP(FIELD_DATA$,2)<>"" THEN {
21230 ITEM_SPEC.CTL'COLUMN=2
21233 IF POS("?"=FSE$(7,20))<>0 THEN IF FIELD_DATA$="Y" THEN FIELD_DATA$="1"
21235 ITEM_SPEC.CTL'VALUE$=STP(FIELD_DATA$,2),ITEM_SPEC.CTL'CELLTYPE$="ellipsis",ITEM_SPEC.CTL'LEN=NUM(FSE$(33,3))
21237 IF POS("?"=FSE$(7,20))<>0 THEN ITEM_SPEC.CTL'CELLTYPE$="CheckMark"
21240 ! }
21243 FIELD_DATA$=""
21245 GOTO 21187
21250 ITEM_SPEC.CTL'ROWSHIGH=_ROW
21253 GRID GOTO ITEM_SPEC.CTL,2,1
21255 RETURN 
21260 ! 
21300 UPDATE_FIELD:! ^100,5 - User defined field has been accessed
21305 FSF_DATA$=""
21310 FOR XX9=1 TO _ROW
21320 GRID FIND ITEM_SPEC.CTL,1,XX9,ITEM_DATA$,ERR=21355
21330 GRID FIND ITEM_SPEC.CTL,2,XX9,FIELD_DATA$,ERR=21355
21335 IF ROW_DATE[XX9] THEN CALL "ZZWDTE;VALIDATE",FIELD_DATA$
21340 IF POS("?"=ITEM_DATA$)<>0 THEN IF FIELD_DATA$="1" THEN FIELD_DATA$="Y" ELSE IF FIELD_DATA$="0" THEN FIELD_DATA$=" "
21345 F_DATA$=""; F_DATA$=FIELD_DATA$; F_DATA$=PAD(F_DATA$,ROW_ARRAY[XX9],1," ")
21350 FSF_DATA$=FSF_DATA$+F_DATA$
21355 NEXT XX9
21359 IF LEN(FSF$)<1650 THEN XX$=FSF$; DIM FSF$(1650); FSF$(1)=XX$
21360 FSF$(31+K9,1618-K9)=FSF_DATA$
21365 ! WRITE (Z[1],KEY=CUSTOMER$+ITEM_CODE$)IOL=0310
21370 ! 
21390 RETURN 
21400 LOOKUP_ZIP:! Lookup zipcode, set city & state if found, set NEW_ZIP for later use
21405 NEW_ZIP=0
21410 CALL "ZYGMBA;CHECK_ZIP",VEND_ZIP$,ZIP_FOUND,ZIP_CITY$,ZIP_ST$,"",ZIP_AREA_CODE$,""
21415 IF VEND_PHONE$="" THEN VEND_PHONE$=DIM(14)
21420 IF ZIP_FOUND THEN VEND_CITY$=ZIP_CITY$,VEND_ST$=ZIP_ST$,VEND_PHONE$(1,3)=ZIP_AREA_CODE$; REFRESH_FLG=1,NEXT_ID=VEND_PHONE.CTL ELSE NEW_ZIP=1
21495 RETURN 
21499 ! 
21500 UPDATE_ZIP:! If new_zip then update the zip code table
21510 IF NEW_ZIP THEN CALL "ZYGMBA;UPDATE_ZIP",VEND_ZIP$,VEND_CITY$,VEND_ST$,"",VEND_PHONE$(1,3),VEND_CITY$ ! get area code from phone,long city from regular city
21520 NEW_ZIP=0
21595 RETURN 
21599 ! 
22000 ! Grid Tab
22100 GRID_TAB:
22110 GRID SELECT READ ITEM_SPEC.CTL,COL,ROW
22112 IF ROW_DATE[ROW] THEN GRID FIND ITEM_SPEC.CTL,2,ROW,DD$,ERR=*NEXT; CALL "ZZWDTE;VALIDATE",DD$,ERMSG$; IF ERMSG$<>"" THEN MSGBOX ERMSG$,MSG("WARNING"),"!,TIM=5"; ERMSG$=""; GRID WRITE ITEM_SPEC.CTL,2,ROW,""; GRID GOTO ITEM_SPEC.CTL,2,ROW; SET_FOCUS ITEM_SPEC.CTL; RETURN ELSE CALL "ZZWDTE;DISPLAY",DD$; GRID WRITE ITEM_SPEC.CTL,2,ROW,DD$
22120 ROW+=1
22130 IF ROW>_ROW THEN %GRID=0; NEXT_ID=SAVE_1.CTL,ROW=_ROW; RETURN 
22140 GRID GOTO ITEM_SPEC.CTL,2,ROW
22150 RETURN 
22200 GET_TEMPLATE:! Get template code from customer + item code
22205 ITEM_CODE$=PAD(ITEM_CODE$,10,1)
22206 IF STP(%SPEC$)="" THEN KK$=CUSTOMER$+ITEM_CODE$ ELSE KK$=%SPEC$,K9=11
22207 IF NUL(%CUSTOMER$) THEN GOTO 22212
22210 DIM FM1$(1000); FIND (Z[4],KEY=KK$,DOM=*NEXT)FM1$; PROD_CODE$=MID(FM1$,21+K9,3),%ITEM_DESC$=MID(FM1$,42+K9,40); GOTO 22215 ! SSP#264165
22212 DIM IC0$(1000); FIND (Z[5],KEY=KK$,DOM=*NEXT)IC0$; PROD_CODE$=MID(IC0$,61,3),%ITEM_DESC$=MID(IC0$,21,40)
22215 DIM FMP$(50); READ (Z[3],KEY="T"+PAD(PROD_CODE$,3),DOM=*NEXT)FMP$
22220 TEMPLATE$=MID(FMP$,33,3)
22225 ITEM_DESC$=%ITEM_DESC$,%ITEM_DESC.CTL'VALUE$=ITEM_DESC$; REFRESH_FLG=1
22295 RETURN 
22299 ! 
23000 LOAD_BLA_GRID:! ^100,5 - Load user defined fields and vendor data
23005 _CHANGE_FLG=CHANGE_FLG
23010 GRID CLEAR ITEM_SPEC.CTL,0,0; _ROW=0; DIM ROW_ARRAY[200],ROW_DATE[200]
23015 ! 
23020 ! IF NOT(GRID_ROWS) THEN {
23025 ! NEXT_FOLDER=FLDR.FMGIAR.1.CTL,REFRESH_FLG=1,CHANGE_FLG=0
23030 ! RETURN
23035 ! }
23040 ITEM_SPEC.CTL'COLUMN=-1,ITEM_SPEC.CTL'COLUMNWIDTH=0,ITEM_SPEC.CTL'ROW=-1,ITEM_SPEC.CTL'ROWHEIGHT=0
23045 ITEM_SPEC.CTL'COLUMNSWIDE=2; GRID LOCK ITEM_SPEC.CTL,1,0; ITEM_SPEC.CTL'COLUMN=2,ITEM_SPEC.CTL'COLUMNWIDTH=77,ITEM_SPEC.CTL'COLUMN=1,ITEM_SPEC.CTL'COLUMNWIDTH=5
23050 DIM FSF$(1650); IF STP(%SPEC$)="" THEN K9=0,FSF$(1,20)=CUSTOMER$+ITEM_CODE$,FSF$(21,3)=TEMPLATE$,KK$=FSF$(1,20) ELSE FSF$(1,31)=%SPEC$+CUSTOMER$+ITEM_CODE$,FSF$(32,3)=TEMPLATE$,KK$=FSF$(1,11),K9=11
23055 READ (Z[1],KEY=KK$,DOM=*NEXT)IOL=0310
23060 FSF$(21+K9,3)=FMP$(33,3) ! IF FSF$(21+K9,3)<>FMP$(33+K9,3) THEN MSGBOX "This item has a spec with template code "+FSF$(21+K9,3)+". Prod Code indicates "+FMP$(33+K9,3)+" Continue?","Confirm","?,YESNO",ANS$; IF ANS$<>"YES" THEN CMD_STR$="END"; EXIT ELSE FSF$(21+K9,3)=FMP$(33,3)
23065 FSF_DATA$=MID(FSF$,31+K9); B_FSF$=FSF$,TEMPLATE$=FSF$(21+K9,3)
23070 READ (Z[2],KEY=FSF$(21+K9,3),DOM=*NEXT)
23075 KEY_2$=KEY(Z[2],END=23175); READ (Z[2])IOL=0380
23080 IF KEY_2$(1,3)<>FSF$(21+K9,3) THEN GOTO 23175
23085 ITEM_SPEC.CTL'COLUMN=1
23090 IF NUL(FSE$(27,6)) AND (NUL(FSE$(7,20)) OR NUL(STP(STP(FSE$(72,40),3,"-"),3))) THEN GOTO 23075 ! If Heading (nul(fse$(27,6)) ) and heading field is blank OR the screen text is all '-'s then skip it
23095 _ROW+=1; IF _ROW>1 THEN GRID LOAD ITEM_SPEC.CTL,1,0,"A"
23097 IF _ROW>17 THEN GOTO 23175
23100 ! IF NUL(FSE$(27,6)) THEN ITEM_SPEC.CTL'ROW=_ROW,ITEM_SPEC.CTL'VALUE$=STP(FSE$(7,20),1),ITEM_SPEC.CTL'ALIGN$="Left",ITEM_SPEC.CTL'CELLTYPE$="ellipsis",ITEM_SPEC.CTL'BACKCOLOUR$="BLUE",ITEM_SPEC.CTL'TEXTCOLOUR$="WHITE"; ITEM_SPEC.CTL'COLUMN=2,ITEM_SPEC.CTL'LOCK=1,ITEM_SPEC.CTL'BACKCOLOUR$="BLUE"; GOTO 23075
23101 IF STP(FSE$(72,40),2)<>"" THEN FLD_TXT$=FSE$(72,40) ELSE FLD_TXT$=FSE$(7,20) ! SSP#233645
23103 IF NUL(FLD_TXT$) THEN FLD_TXT$=STR(_ROW:"###") ! IF NUL(FSE$(7,20)) THEN FSE$(7,20)=STR(_ROW:"###")!SSP#233645
23105 ITEM_SPEC.CTL'ROW=_ROW,ITEM_SPEC.CTL'VALUE$=STP(STP(FLD_TXT$,2),1,":")+":",ITEM_SPEC.CTL'CELLTYPE$="ellipsis",ITEM_SPEC.CTL'ALIGN$="Right" ! SSP#233645
23110 ! 
23115 FSE_DATA$=MID(FSF_DATA$,1,NUM(FSE$(33,3))); FSF_DATA$=MID(FSF_DATA$,NUM(FSE$(33,3))+1)
23120 ROW_ARRAY[_ROW]=NUM(FSE$(33,3))
23125 IF STP(FSE_DATA$,2)<>"" THEN FIELD_DATA$=FSE_DATA$
23130 ! IF FSE$(27,1)="D" THEN CALL "ZZWDTE;DISPLAY",FIELD_DATA$; ROW_DATE[_ROW]=1
23135 ! IF STP(FIELD_DATA$,2)<>"" THEN {
23140 ITEM_SPEC.CTL'COLUMN=2
23145 IF POS("?"=FSE$(7,20))<>0 THEN IF FIELD_DATA$="Y" THEN FIELD_DATA$="1"
23150 ITEM_SPEC.CTL'VALUE$=STP(FIELD_DATA$,1),ITEM_SPEC.CTL'CELLTYPE$="ellipsis",ITEM_SPEC.CTL'LEN=NUM(FSE$(33,3)) ! SSP#240984  ! SSP250386 jdf
23155 IF POS("?"=FSE$(7,20))<>0 THEN ITEM_SPEC.CTL'CELLTYPE$="CheckMark"
23160 ! }
23165 FIELD_DATA$=""
23170 GOTO 23075
23175 ITEM_SPEC.CTL'ROWSHIGH=_ROW
23180 GRID GOTO ITEM_SPEC.CTL,2,1
23185 RETURN 
56000 REM "206206-RFQ. When setting up a new form and you use the copy feature
56001 REM "233645-User defined specs in GUI display the description not        the field text
56002 REM "240984-GUI Specs, if you have spaces at the front of a field, the  
56003 REM "250386-custom item spec composition section for custom items       
56004 REM "261680-Specs are not displaying correctly between gui and chui     
56005 REM "264165-589 - unable to get into spec section of RFQ# 05-04295      
