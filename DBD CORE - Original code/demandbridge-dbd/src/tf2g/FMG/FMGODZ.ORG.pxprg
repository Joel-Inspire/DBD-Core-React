0010 REM "Order Line Releated Maintenance <FM2ODZ>
0020 SETESC 9300; SETERR 9000
0035 REM "5.5 - 01/18/07 - 11.031944 - jme - SSP# 203894
0036 REM "4.? - 08/09/99 - dxm - SSP# 115875
0037 REM "203894-Urgent - WMS pick queue update is not in FMGODZ             
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0087 REM "C0=command, 1=add, -1=maint delete  (modify line) -2=delete line stuff only, -3=-1&-2, 99=Rebuild mode (FM2UT9)
0088 REM "A$,A(ALL)=sales order line detail, B$=sales order data
0090 CLEAR ; SETERR 0100; ENTER X3$,C0,A$,A{ALL},B$
0100 SETERR 9000
0110 X0$="FM2ODZ"
0120 DIM S0$(10),H[3],XPS[4] ! [197451] added XPS
0140 IF A$="ALL" THEN F9$="Y"
0145 REM "I8$ > "" if coming fro order/invoice interface screen
0150 P=POS("~"=B$)
0160 IF P=0 THEN I8$="" ELSE I8$=B$(P+1),B$=B$(1,P-1)
0170 FID_0$=FID(0); IF %IN_WEBEC$="Y" OR %IN_GUI$="Y" THEN FID_0$(1,1)="G"
0210 IF FID_0$(1,1)<>"G" THEN PRINT @(0,22),'CE',@(23,22),"Adjusting sales order information",
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24],A[25],A[26],A[27],A[28],A[29]
0311 IOLIST A$,A[0],STR(A[1]),A[2],A[3],STR(A[4]),A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],STR(A[15]),A[16],A[17],STR(A[18]),A[19],A[20],A[21],STR(A[22]),A[23],A[24],A[25],A[26],A[27],A[28],A[29]
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15]
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7]
0341 IOLIST D$,D[0],STR(D[1]),D[2],D[3],STR(D[4]),D[5],D[6],D[7]
0380 IOLIST H$,H[0],H[1],H[2],H[3]
0390 IOLIST I$,I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15],I[16],I[17],I[18],I[19],I[20],I[21],I[22],I[23],I[24],I[25],I[26],I[27] ! SSP 203181
0391 IOLIST I$,STR(I[0]),I[1],I[2],I[3],I[4],I[5],I[6],I[7],STR(I[8]),I[9],I[10],I[11],I[12],I[13],I[14],I[15],I[16],STR(I[17]),I[18],I[19],I[20],STR(I[21]),I[22],I[23],I[24],I[25],I[26],I[27] ! SSP 203181
0400 IOLIST J$,J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8],J[9],J[10],J[11],J[12],J[13],J[14],J[15],J[16],J[17],J[18],J[19],J[20]
0401 IOLIST J$,J[0],STR(J[1]),STR(J[2]),J[3],J[4],J[5],J[6],J[7],J[8],J[9],J[10],J[11],J[12],J[13],J[14],J[15],J[16],J[17],J[18],J[19],J[20]
0410 IOLIST O$,O[0],O[1],O[2],O[3],O[4],O[5]
0411 IOLIST O$,O[0],STR(O[1]),O[2],O[3],O[4],O[5]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01X FS2...  02O FS5...  03O FS6...  04O FS7...  05O FS8...  06O IC1...  08O PO3...  09O PO2...  10O FS9...  11O PO6... 12O AR1...  13O ZZPARM  25O FMP...  26O FM0...  "
0515 IF I8$>"" THEN Z$=Z$+"14O FS3...  "; REM "SSP# 111764
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0540 READ (Z[13],KEY=X3$(9,3)+"F/M")S9$
0545 GB$=""; FIND (Z[13],KEY=X3$(9,3)+"G/B",DOM=0546)GB$
0585 RT_PARM$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,RT_PARM$
0790 IF F9$<>"Y" THEN GOTO 0900
0794 IF B$(2,1)="Y" OR POS("D"=B$(232,5))>0 THEN GOTO 0796; REM "Background processing, don't ask suspend packing list question
0795 IF S9$(242,1)="Y" AND I8$="" AND B$(128,1)<>"Y" AND C0>0 AND C0<>99 THEN GOSUB 8400; IF B$(314,1)="Y" THEN B$(128,1)="S" ELSE IF B$(128,1)="A" THEN PROCESS "ZZGASK","../ZZG/ZZ.EN",MSG("FMGODH_10"),_ANS$; IF _ANS$="YES" THEN B$(128,1)="S" ELSE B$(128,1)="N" ! SSP 200137  ! SSP246794 jdf
0800 REM "Process all lines"
0805 DIM A[29]
0810 READ (Z[1],KEY=B$(118,8),DOM=0811)
0820 K1$=KEY(Z[1],END=0870)
0825 IF B$(118,8)<>K1$(1,8) THEN GOTO 0870
0830 READ (Z[1],KEY=K1$)IOL=0310
0840 DID_GOSUB=1; GOSUB 0900; DID_GOSUB=0
0860 GOTO 0820
0890 GOTO 9905
0900 REM "
0901 W9$=A$(10,1)
0902 IF POS(B$(47,1)="RW")>0 OR POS(X3$(9,3)="543537539541542584585",3)>0 THEN IF A$(10,1)<>"8" OR POS(X3$(9,3)="470474",3)<>0 THEN W9$="0" END_IF ELSE W9$=A$(10,1); REM "SSP138569, if company 543 then change 1st position of whse to 0 even if it's an O1 type order 
0903 IF POS(X3$(9,3)="020")>0 THEN W9$=A$(10,1)
0904 IF S9$(285,1)="Y" THEN W9$=A$(10,1)
0905 O9$=A$(147,8)
0910 IF FID_0$(1,1)<>"G" THEN PRINT @(30,23),"Order Line ",A$(6,3),
0920 IF ABS(C0)=1 OR C0=99 AND POS(A$(9,1)=P$+" ")=0 THEN P$=P$+A$(9,1)
0929 REM "If a Work Order, build up string for FW2ODL, cus#(10)+inv #(20)+order#(8)+location(4)
0930 IF B$(43,1)="Y" AND POS(A$(155,1)="IC")>0 THEN W$=W$+B$(6,10)+A$(161,10)+A$(19,10)+O9$+A$(10,4)
0990 ON C0 GOTO 1000,2000
1000 REM "Delete out
1002 IF POS(A$(155,1)="MN")=0 THEN CALL "UPDPO6;DEL_FOR_WMS",ERR=*NEXT,Z[11],A$ ! SSP180032                                                                            
1005 IF C0=-2 THEN GOTO 3000
1020 IF A$(155,1)="M" THEN GOTO 1120
1040 GOSUB 7000; REM "Adjust customer's open order amount
1060 GOSUB 7050; REM "Remove FS5 sort key
1080 GOSUB 8600; REM "Take off committed
1100 IF C0=-1 AND I8$<>"" THEN REMOVE (Z[14],KEY=I8$(1,8)+O9$+A$(6,3)+" ",DOM=1101); REM "Remove FS3 record
1120 GOSUB 7500; REM "Remove PO6 records
1300 IF C0=-3 THEN GOTO 3000
1900 REM "EOD
1990 GOTO 9900
2000 REM "Add in
2005 IF POS(A$(155,1)="MN")=0 AND A[0]>0 THEN CALL "UPDPO6;UPD_FOR_WMS",ERR=*NEXT,Z[11],Z[26],Z[12],A$,B$(6,10),X3$ ! SSP180032 - NOTE:if WMS, routine changes print flag to not print p/l
2010 IF A$(9,1)<>" " AND A$(219,1)<>"Y" THEN GOSUB 8100; GOSUB 8800; REM "Set up PO line [197451] added gosub 8800
2020 REM "IF A$(155,1)="M" THEN GOTO 02200
2120 IF A$(155,1)<>"M" THEN GOSUB 7000; REM "Adjust customer open order amount
2140 IF A$(155,1)<>"M" THEN GOSUB 7050; REM "FS5 sort key
2160 GOSUB 7300; REM "Write out FS6,7,8,9 records
2180 IF A$(155,1)<>"M" THEN GOSUB 8600; REM "Put on committed
2200 GOSUB 7500; REM "PO6 file
2210 IF A$(155,1)<>"M" AND (C0=1 OR C0=99) AND S9$(280,1)="Y" AND B$(54,1)="B" AND B$(240,1)="Y" THEN CALL "FM2ICA",X3$,X4$,"FM2ODZ",C0,A$,A{ALL},B$; REM "WO111482, Inventory Costing
2900 REM "EOA
2990 GOTO 9900
3000 REM "Do delete only things
3010 GOSUB 8000; REM "Remove shipping instructions
3020 GOSUB 7100; REM "Remove FS6,7,8,9 records
3025 CALL "BM2DEL",ERR=3026,X3$,X4$,B$(118,8)+A$(6,3)
3030 IF A$(2,1)="Y" THEN GOSUB 3100
3040 IF F9$="Y" THEN TF_TYPE$="ALL" ELSE TF_TYPE$=A$
3041 IF B$(54,1)="B" THEN CALL "FM2ICA",X3$,X4$,"FM2ODZ",C0,TF_TYPE$,A{ALL},B$; REM "WO111482, Inventory Costing
3090 GOTO 9900
3100 REM "Lot Inventory
3110 IF A$(155,1)="I" THEN DIM C0$(10) ELSE C0$=A$(161,10)
3120 J$=C0$+A$(19,10)+A$(10,4)+O9$+A$(6,3)
3130 IF A[0]<0 THEN GOSUB 3200 ELSE CALL "IC2LCA",X3$,"","D",0,J$,0
3140 RETURN 
3200 REM "Remove Order entry returns from ICN
3203 Z$="02C FS5...  07O ICN...  "
3204 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 3205,9900
3205 READ (Z[7],KEY=C0$+A$(19,10),DOM=3206)
3210 J8$=KEY(Z[7],END=3240); READ (Z[7],KEY=J8$)J9$
3215 IF J9$(1,20)<>C0$+A$(19,10) THEN GOTO 3240
3220 IF J9$(110,11)<>A$(147,8)+A$(6,3) THEN GOTO 3210
3225 REMOVE (Z[7],KEY=J8$,DOM=3226)
3230 GOTO 3210
3241 Z$="07C ICN...  02O FS5...  "
3242 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 3243,9900
3245 RETURN 
7000 REM "Adjust customer open order amount
7002 IF POS(B$(54,1)="BS")>0 THEN GOTO 7040; REM "To be consistant before change
7005 DIM C$(100),C[15]
7010 EXTRACT (Z[12],KEY=B$(6,10),DOM=7040)IOL=0330
7020 C[13]=C[13]+SGN(C0)*A[6]
7025 IF C[13]<0 THEN C[13]=0
7030 WRITE (Z[12],KEY=B$(6,10))IOL=0330; IF RT_PARM$<>"" THEN CUST$=B$(6,10); CALL "RT2WOR",ERR=7031,X3$,X4$,CUST$,"AR1...","U",B$(6,10)
7040 RETURN 
7050 REM "Add or rem FS5 sort key
7054 IF A$(14,1)="Y" AND (C0=-1 OR C0=-3) THEN GOTO 7056
7055 IF POS(A$(155,1)="IC ")=0 THEN GOTO 7090; REM "WO106216, changed from IC
7060 IF A$(155,1)="I" THEN DIM I$(20); I$(11,10)=A$(19,10) ELSE I$=A$(161,10)+A$(19,10)
7062 IF A$(155,1)=" " THEN IF STP(I$(1,10),3," ")="" THEN I$(1,10)=B$(6,10); REM "WO106216
7065 I$=I$+A$(10,4)+A$(147,8)+A$(6,3)
7070 IF C0=-1 OR C0=-3 THEN REMOVE (Z[2],KEY=I$,DOM=7071) ELSE GOTO 7080
7075 REMOVE (Z[2],KEY=A$(161,10)+I$(11),DOM=7076)
7078 GOTO 7090
7080 WRITE (Z[2],KEY=I$)
7090 RETURN 
7100 REM "Remove FS6,7,8,9 records
7102 GOSUB 7200; IF T$=" " THEN GOTO 7190
7104 FOR I=1 TO LEN(T$)
7105 DIM D$(113),D[7]
7110 IF T$(I,1)="M" THEN A$(19,10)="M"+B$(120,6)+A$(6,3)
7115 D$(1)=B$(6,10)+T$(I,1)+A$(19,10)+B$(118,8)
7120 GOSUB 7450
7130 READ (Z[3],KEY=D$(1,30),DOM=7131)IOL=0340
7132 REM "If invoiced already then DO NOT remove
7133 IF POS(" "<>D$(40,14))<>0 THEN A[10]=A[10]-A[0]; EXITTO 7300
7140 REMOVE (Z[3],KEY=D$(1,30),DOM=7141)
7141 IF RT_PARM$<>"" THEN CUST$=D$(1,10); CALL "RT2WOC",ERR=7142,X3$,X4$,CUST$,"FS6...","D",D$(1,30)
7160 REMOVE (Z[4],KEY=A$(29,3)+D$(11,1)+D$(12,10)+D$(1,10)+D$(22,8)+D$(30,1),DOM=7161)
7165 REMOVE (Z[5],KEY=D$(1,10)+D$(22,8)+D$(11,11)+D$(30,1),DOM=7166)
7170 REMOVE (Z[10],KEY=D$(22,8)+D$(12,10)+D$(30,1),DOM=7171)
7174 IF T$(I,1)="M" THEN A$(19,10)=DIM(10)
7175 NEXT I
7180 CALL "FM2ODS",X3$,D$,"D"
7190 RETURN 
7200 REM "Set T$ to type for FS6 records
7204 T$=" "
7205 ON POS(A$(155,1)=" CINSM") GOTO 7240,7210,7215,7220,7225,7230,7235
7210 T$="B"; GOTO 7240
7215 T$="D"; GOTO 7240
7220 T$="F"; GOTO 7240
7225 T$="H"; GOTO 7240
7230 T$="J"; GOTO 7240
7235 T$="M"; GOTO 7240
7240 DIM T[1]; T[0]=A[10]
7250 REM "Hidden Warehouse
7255 IF S9$(195,1)<>"Y" THEN GOTO 7290
7265 REM "Hidden Warehouse situation coming up
7280 CALL "FM2MAK",X3$,X4$,A$,A{ALL},B$,B{ALL},T$,T{ALL}
7290 RETURN 
7300 REM "Setup & write out FS6,7,8 records
7302 IF C0=99 THEN RETURN 
7303 IF A$(155,1)="M" AND S9$(263,1)<>"Y" THEN RETURN 
7304 GOSUB 7200
7306 FOR I=1 TO LEN(T$)
7308 DIM D$(113),D[7]
7309 IF T$(I,1)="M" THEN A$(19,10)="M"+B$(120,6)+A$(6,3); REM "Message line
7310 D$(1)=B$(6,10)+T$(I,1)+A$(19,10)+B$(118,8)+" "+A$(29,3)+B$(16,6)
7312 GOSUB 7450; GOSUB 7400
7315 D$(54,15)=B$(28,15),D$(81)=A$(113,6)+A$(94,10)+A$(90,4)+A$(124,4)
7318 D$(106,5)="D"+A$(10,4),D$(111,1)=B$(54,1)
7320 D[0]=T[I-1],D[1]=A[4],D[2]=A[5],D[3]=A[13]
7321 IF D[1]=0 THEN D[1]=A[6],D[4]=A[3]; REM " GOTO 07325
7322 IF A[1]=0 THEN D[4]=A[3]; GOTO 7325 ELSE D[4]=A[1]
7323 IF A[2]<>0 AND A[2]<>A[5] THEN D[4]=D[4]*A[5]/A[2] ELSE D[4]=D[4]
7325 WRITE (Z[3],KEY=D$(1,30))IOL=0341; IF RT_PARM$<>"" THEN CUST$=D$(1,10); CALL "RT2WOC",ERR=7326,X3$,X4$,CUST$,"FS6...","U",D$(1,30)
7330 WRITE (Z[4],KEY=D$(31,3)+D$(11,1)+D$(12,10)+D$(1,10)+D$(22,8)+D$(30,1))
7334 WRITE (Z[5],KEY=D$(1,10)+D$(22,8)+D$(11,11)+D$(30,1))
7335 IF T$(I,1)="M" THEN A$(19,10)=DIM(10)
7336 NEXT I
7337 CALL "FM2ODS",X3$,D$,"W"; GOSUB 7350
7338 REM IF POS(" "<>A$(161,10))>0 AND A$(161,10)<>B$(6,10) THEN CALL "FM2UBI",X3$,A$(19,10),B$(6,10),B$(155,1),A$(161,10),"",0
7340 RETURN 
7350 REM "Write out FS9 record if necessary
7360 IF POS(A$(155,1)="MN")=0 THEN GOTO 7390
7365 DIM D1$(81)
7370 D1$(1)=D$(22,8)+D$(12,10)+D$(30,1)+A$(29,61)
7375 WRITE (Z[10],KEY=D1$(1,19))D1$
7390 RETURN 
7400 REM "Check for old record and set up last inv stuff
7410 READ (Z[3],KEY=D$(1,30),DOM=7440)IOL=0340
7440 RETURN 
7450 REM "Compute seq no for FS6 record
7460 D9=NUM(A$(6,3),ERR=7461)
7465 IF D9>=90 THEN D9=D9+10
7470 IF D9>206 THEN D9=206
7480 D$(30,1)=CHR(D9+48)
7490 RETURN 
7500 REM "Carton Label Printing
7505 IF C0=99 OR I8$<>"" OR POS("D"=B$(232,5))>0 THEN RETURN ; REM "D=coming from BO fill report or other process that we don't want to reprint anything
7510 X$="C"+O9$+A$(9,1)+A$(6,3),M$=MSG("FMGODH_11",A$(6,3),A$(50,40))
7515 IF C0<0 OR B$(194,1)="Y" THEN GOSUB 7900; GOTO 7550
7520 IF (A[9]<=0 AND H[1]<=0) THEN GOTO 7550; REM "Mod cwj 3/3/98 SSP# 085719 - add H(1) to if ...
7525 IF B$(127,1)="Y" AND NUM(PRT$)<=1 THEN CALL "FMGODH.1",M$,S3,"Y"; PRT$=STR(S3); IF S3=1 OR S3=3 THEN GOSUB 7900; GOTO 7550; REM W/O 115875; REM "S3=0 REPRINT,S3=1 DO NOR REPRINT,S3=2 REPRINT ALL, S3=3 NO TO ALL
7526 IF PRT$="3" THEN GOSUB 7900; GOTO 7550; REM W/O 115875
7530 WRITE (Z[11],KEY=X$)
7550 REM "Packing List Printing - "B"=consolidated pick list - S=suspend
7560 X$="L"+W9$+A$(11,3)+PICK_PRIORITY$+O9$+A$(6,3),M$=MSG("FMGODH_12",A$(6,3),A$(50,40)) ! [197451]-added pick priority
7563 IF A$(9,1)<>" " AND POS("P"=A$(156,5))>0 AND A$(10,4)="DS  " THEN X$(2,4)=A$(215,4); REM "can't use W9$ value since it is 'D' from 10,4
7564 IF GB$<>"" THEN GOSUB 7600; REM "Special GB stuff
7565 IF C0<0 AND POS("B"=B$(232,5))<>0 THEN GOTO 7590 ELSE IF C0<0 OR B$(194,1)="Y" THEN GOSUB 7900; GOTO 7590 ELSE IF POS("P"=A$(156,5))=0 THEN GOTO 7590
7570 IF B$(128,1)="Y" AND NUM(PRT1$)<=1 THEN CALL "FMGODH.1",M$,S3,""; PRT1$=STR(S3); IF S3=1 OR S3=3 THEN GOSUB 7900; GOTO 7590; REM W/O 115875
7575 IF PRT1$="3" THEN GOSUB 7900; GOTO 7590; REM W/O 115875
7578 READ (Z[11],KEY=X$+"P",DOM=7580); GOTO 7590
7580 IF B$(128,1)<>"S" THEN WRITE (Z[11],KEY=X$); IF B$(53,1)="Y" THEN WRITE (Z[11],KEY="B"+A$(10,1)+X$(3))
7590 RETURN 
7600 REM "Do special key for Gold Bond, WO106451
7602 REM "If first line use it's product code, else look for line 001 product code. If no line 001 use this line's prod  code, MUST reposition file on Z[1]!!
7605 PROD_CODE$=A$(29,3); IF A$(6,3)="001" THEN GOTO 7620
7610 DIM FS2$(200); FS2$(29,3)=A$(29,3); FIND (Z[1],KEY=A$(147,8)+"001",DOM=7611)FS2$
7611 PROD_CODE$=FS2$(29,3)
7612 READ (Z[1],KEY=A$(147,8)+A$(6,3))
7620 X$="L!"+B$(195,1)+PROD_CODE$+DIM(2)+X$(2); REM "Two spaces are for now unused # copies field, we pick it up during printing
7645 RETURN 
7900 REM "Remove PO6 Records
7905 F8$=X$
7910 REMOVE (Z[11],KEY=F8$,DOM=7911)
7920 IF F8$(1,1)<>"L" THEN REMOVE (Z[11],KEY=F8$+"P",DOM=7921)
7930 IF B$(53,1)="Y" AND F8$(1,1)="L" THEN F8$(1,1)="B"; GOTO 7910
7935 IF F8$(1,1)="L" AND B$(128,1)<>"Y" THEN B$(128,1)=" "
7940 RETURN 
8000 REM "Remove shipping instructions
8010 K$=B$(118,8)+" "+A$(6,3)
8020 READ (Z[8],KEY=K$,DOM=8021)
8030 K0$=KEY(Z[8],END=8045)
8035 IF K0$(1,LEN(K$))<>K$ THEN GOTO 8045
8040 REMOVE (Z[8],KEY=K0$,DOM=8030); GOTO 8030
8045 RETURN 
8100 REM "Setup P/O line"
8102 IF C0=99 THEN RETURN 
8106 DIM I$(170),I[27] ! SSP 203181
8110 IF A$(155,1)="M" THEN I$(1)=A$(1,6)+A$(6,3)+"M",I$(28,40)=A$(50,40),I$(82,9)=A$(147,8)+A$(9,1); GOTO 8160
8140 REM "Setup line
8142 I$(10,1)="C"
8145 EXTRACT (Z[9],KEY=A$(147,8)+A$(9,1)+A$(6,3),DOM=8146)IOL=0390
8146 A[10]=A[0] ! TEMP UNTIL a[10] FILLED OUT CORRECTLY
8150 I$(1,9)=S0$(1,5)+I$(6,1)+A$(6,3),I$(11)=A$(6,3)+A$(18,1),I$(25,3)=A$(29,3),I$(28)=A$(50,40)+A$(104,9)+A$(120,4)+A$(119,1),I[0]=A[1],I[1]=A[0],I[11]=A[10],I[2]=A[2],I[3]=A[9],I[4]=A[3],I$(1,1)=A$(1,1),I$(101,10)=A$(19,10)
8151 I$(82,9)=A$(147,8)+A$(9,1),I$(15,2)=A$(48,2),I$(17,8)=A$(32,8),I$(111,8)=A$(40,8),I[5]=A[12]
8155 IF A$(14,1)="Y" THEN I$(91,10)=B$(6,10) ELSE IF A$(155,1)="C" THEN I$(10,1)="I",I$(91,10)=A$(161,10) ELSE I$(10,1)=A$(155,1)
8170 IF A$(18,1)<>"Y" THEN GOTO 8280
8175 REM "Check special shipping for D locations.
8180 K$=A$(147,8)+" "+A$(6,3)
8190 READ (Z[8],KEY=K$,DOM=8191)
8200 K0$=KEY(Z[8],END=8280)
8210 IF K0$(1,LEN(K$))<>K$ THEN GOTO 8280
8220 READ (Z[8],KEY=K0$)IOL=0380
8230 IF H$(11,1)<>"D" THEN GOTO 8270
8239 REM "NOT SURE ABOUT SETTING I$(91,10) BEFORE THE CALL"
8240 I$(10,1)="I",I$(91,10)=B$(6,10); CALL "FM2ODY",X3$,X4$,I$,I{ALL},A$,A{ALL}
8250 GOSUB 8300
8270 GOTO 8200
8280 REM 
8285 I(24)=A(26); WRITE (Z[9],KEY=I$(82,9)+I$(7,3))IOL=0391
8290 RETURN 
8300 REM "FIX ORDER LINE
8320 IF A$(155,1)="I" THEN A$(155,1)="C"
8330 A$(161,10)=B$(6,10); WRITE (Z[1],KEY=A$(147,8)+A$(6,3))IOL=0311
8390 RETURN 
8400 REM "Any Packing Lists to print?
8410 READ (Z[1],KEY=B$(118,8),DOM=8411)
8420 READ (Z[1],END=8480)X$
8430 IF X$(147,8)<>B$(118,8) THEN GOTO 8480
8440 IF POS("P"=X$(156,5))>0 THEN B$(128,1)="A"; GOTO 8490
8450 GOTO 8420
8490 RETURN 
8525 SET_READONLY_END:RETURN 
8530 CLEAR_READONLY:REM "Restore previous setting
8535 SET_PARAM 'XI'=SAVE_XI ! restore previous setting
8545 CLEAR_READONLY_END:RETURN 
8600 REM "Put on or take off committed based on C0
8602 IF A$(9,1)<>" " OR POS(A$(155,1)="IC")=0 THEN GOTO 8640
8604 IF POS(" "<>A$(10,4))=0 OR A$(10,2)="DS" THEN GOTO 8640
8605 DIM J$(58),J[20]
8606 IF A$(155,1)="I" THEN DIM C0$(10) ELSE C0$=A$(161,10)
8609 J$(1)=C0$+A$(19,10)+A$(10,4)
8610 EXTRACT (Z[6],KEY=J$(1,24),DOM=8611)IOL=0400
8620 J[7]=J[7]+SGN(C0)*A[0],J[11]=J[11]+SGN(C0)*A[8]
8630 WRITE (Z[6],KEY=J$(1,24))IOL=0401
8635 IF RT_PARM$>"" THEN IF RT_PARM$(7,1)="H" THEN CUST$=J$(1,10); CALL "RT2WOC",ERR=8636,X3$,X4$,CUST$,"IC1...","U",J$(1,24)
8638 IF GB$<>"" THEN ORDER_LINE$=A$(147,8)+A$(6,3); CALL "BM2ICU",X3$,X4$,1*SGN(C0),ORDER_LINE$,0,"",0
8640 RETURN 
8800 REM + Get the picking priority
8801 ! [197451]-Added this routine to get the picking priority order
8802 ! [197451]-XPS_KEY$ = rec type + ship via code
8815 PICK_PRIORITY$="~~"
8817 GOTO 8895
8820 XPS_KEY$="S"+H$(150,1)
8825 READ (Z[25],KEY=XPS_KEY$,DOM=8895)IOL=0412
8880 PICK_PRIORITY$=XPS$(278,2)
8895 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9049 REM "132100
9050 ON Y7 GOTO 9060,9100,9910,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9902 IF DID_GOSUB THEN RETURN 
9905 IF F9$="Y" AND P$>"" THEN CALL "POGMAH",X3$,"C"+STR(C0:"00"),"!"+B$(118,8)+P$(1,1),STR(SGN(C0)); P$=P$(2); GOTO 9905
9906 IF W$<>"" THEN CALL "FW2ODL",X3$,C0,W$
9907 ANSWER$=DIM(10),ANSWER$=GBL("ANSWER",ANSWER$); REM "SSP118724
9908 IF FID_0$(1,1)<>"G" THEN PRINT @(0,22),'CE',
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 REM "193611-Stopover order. When you enter several messages lines tied  
56001 ! "200137-GUI Panel question 'Suspend Packing List Printing' should   
56002 ! "203181-IOLIST and DIM incorrect in FMGODZ writing out short        
56003 ! "200130-Storage Expiration Date (SED) needs to be entered at the    
56004 REM "203894-Urgent - WMS pick queue update is not in FMGODZ             
56005 REM "203894-Urgent - WMS pick queue update is not in FMGODZ             
