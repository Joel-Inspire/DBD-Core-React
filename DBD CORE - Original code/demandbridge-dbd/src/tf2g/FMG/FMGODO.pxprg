0010 ! FMGODR - Order Entry Sls Order Lines Maintenance"                      
0035 REM "5.5 - 06/19/07 - 11.937222 - jme - SSP# 208671
0037 REM "208671-Order Entry - GUI Order Lines. Redesign based upon a        
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! this program cannot be executed directly
0075 ESCAPE 
0080 END 
0110 INIT:
0115 ORDER_DIV$=ARG_1$,ORDER_NUM$=ARG_2$; ORDER$=ORDER_DIV$+ORDER_NUM$,ORDER_TYPE$=ARG_4$
0117 CUST_DIV$=ARG_5$,CUST_CODE$=ARG_6$; CUSTOMER$=CUST_DIV$+CUST_CODE$
0118 ORIG_CUST_DIV$=CUST_DIV$,ORIG_CUST_CODE$=CUST_CODE$
0119 FS1_CUSTOMER$=CUSTOMER$ ! used for grid customer number display (order header)
0120 _SV_KR=PRM('KR'); SET_PARAM 'KR'=0 ! Ensure native handling of KEP()
0130 GOSUB SETUP_LIBRARY; IF %FLMAINT_MSG$<>"" THEN MESSAGE_LIB %FLMAINT_MSG$
0140 CHANGE_FLG=0,_ENABLE_FLG=0,_KCNT=1,_FIRST_KEY=0,_FIRST_FIELD=0
0145 %VEND_NAME$="",%PLANT_NAME$="",%CUST_NAME$="",%SPEC_FLG$=""; DIM S_UM$(21),S_UM[1],C_UM$(21),C_UM[1]
0146 DAY_FORMAT READ DAY_FORMAT$
0147 DIM M6[1]; M6[1]=2,M1$="##,###,###.00-",M6$=M1$
0160 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,-1,X1,X2; DIM Z[NUM(X3$(60,3))]
0165 Z$="01O FS2... 02O FS1... 03O FM1... 04O IC0... 05O QSA... 06O QSB... 07O QSC... 08O QSD... 09O FMP... 10O PO1... 11O AR4... 13O ZZPARM 15O FE5... 16O FE6... 17O FE7... 18O FM2... 20O FW0... 21O ASQ... 22O AP4... 23O AP8... 24O FSH... 25O FM0... 26O IC1... 27O IC2... 28O ICF... 29O OSD... 30O OS2... 31O EDW... 32O AR1...  33O PO3...  34O PO3...  35O PO2...  36O FS1...  " ! AR4 is used in AR2COM, ! SSP 184532
0170 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
0172 QUOTE_CHAN=Z[5],QUOTE_CHAN$=STR(QUOTE_CHAN) ! Default for later use FMGGRD 22865
0174 FS2=Z[1],FS1=Z[36],FM1=Z[3],IC0=Z[4],AR1=Z[32],EDW=Z[31],PO3=Z[33],PO3_2=Z[34],PO1=Z[10],PO2=Z[35],QSB=Z[6],FMP=Z[9],AP4=Z[22]
0175 _FILE_NAME$=FIN(Z[1],"FILENAME"),_FIL_NO=Z[1]
0177 CLOSE (_FIL_NO); OPEN (_FIL_NO,IOL=*)_FILE_NAME$
0180 _CUR_FN=HFN; OPEN (_CUR_FN,IOL=*,REC=_CUR$)_FILE_NAME$
0181 TP$=FN%FID$(Z[3]); CLOSE (Z[3]); OPEN (Z[3],IOL=*)TP$(4,6); CALL "ZZWIOL",Z[3],"B",%FM1_IOL$ ! SSP205703-changed FID() to FN%FID$()             
0182 TP$=FN%FID$(Z[2]); CLOSE (Z[2]); OPEN (Z[2],IOL=*)TP$(4,6); CALL "ZZWIOL",Z[2],"B",%FS1_IOL$ ! SSP205703-changed FID() to FN%FID$()             
0183 TP$=FN%FID$(Z[4]); CLOSE (Z[4]); OPEN (Z[4],IOL=*)TP$(4,6); CALL "ZZWIOL",Z[4],"B",%IC0_IOL$ ! SSP205703-changed FID() to FN%FID$()             
0184 GOSUB GET_PARMS
0185 DIM Q[100],L0[100]; GOSUB GET_INFO
0199 RETURN 
0200 OPEN_ERR: MSGBOX _MSG_FILOPNERR1$+QUO+_FILE_NAME$+QUO+SEP+_MSG_DIRECTORY$+LWD+SEP+_MSG_PREFIX$+PFX,MSG(ERR),"!"
0210 CMD_STR$="END"
0220 RETURN 
0300 ! 300 - Set up the message library
0310 SETUP_LIBRARY:
0320 _SV_MSGLIB$=MSG(*)
0330 _LANG$=LCS(%NOMAD_DEF_SFX$); IF _LANG$="" THEN _LANG$=LCS(ENV("PVXLANG")); IF _LANG$="" THEN _LANG$=LCS(ENV("LANG")); IF _LANG$="" THEN _LANG$="en"
0340 MESSAGE_LIB "*msglib."+_LANG$,ERR=*NEXT; GOTO 0360
0350 MESSAGE_LIB "*msglib.en"
0360 SET_MSG:GOSUB SETUP_MESSAGES
0370 RETURN 
9000 ! 9000 - Retrieve messages from the *msglib.xxx library
9010 SETUP_MESSAGES:
9020 _FYI$=MSG("FYI"),_ERROR$=MSG("ERROR")
9030 _MSG_DIRECTORY$=MSG("DIRECTORY")
9040 _MSG_END_OF_FIL$=MSG("END_OF_FIL")
9050 _MSG_FILOPNERR1$=MSG("FILOPNERR1")
9060 _MSG_JUST_CHECK$=MSG("JUST_CHECK")
9070 _MSG_MANDATORY$=MSG("MANDATORY")
9080 _MSG_NEXT$=MSG("NEXT")
9090 _MSG_NON_NUMER$=MSG("NON_NUMER")
9100 _MSG_NOT_FOUND$=MSG("NOT_FOUND")
9110 _MSG_OVRWRT_CHG$=MSG("OVRWRT_CHG")
9120 _MSG_PRECEDING$=MSG("PRECEDING")
9130 _MSG_PREFIX$=MSG("PREFIX")
9140 _MSG_REC_ACCESS$=MSG("REC_ACCESS")
9150 _MSG_REC_ALTERD$=MSG("REC_ALTERD")
9160 _MSG_REC_CR_NEW$=MSG("REC_CR_NEW")
9170 _MSG_REC_LOCKED$=MSG("REC_LOCKED")
9180 _MSG_X$=MSG("REC_MISS","^"),P=POS("^"=_MSG_X$),_MSG_REC_MISS1$=_MSG_X$(1,P-1),_MSG_REC_MISS2$=_MSG_X$(P+1)
9190 _MSG_REC_NOTFND$=MSG("REC_NOTFND")
9200 _MSG_REC_NO_1ST$=MSG("REC_NO_1ST")
9210 _MSG_REC_NO_LST$=MSG("REC_NO_LST")
9220 _MSG_REC_REMOVE$=MSG("REC_REMOVE")
9230 _MSG_REC_UPDADD$=MSG("REC_UPDADD")
9240 _MSG_X$=MSG("REC_VFYDEL","^"),P=POS("^"=_MSG_X$),_MSG_REC_VFYDEL1$=_MSG_X$(1,P-1),_MSG_REC_VFYDEL2$=_MSG_X$(P+1)
9250 _MSG_X$=MSG("REC_VIEW","^"),P=POS("^"=_MSG_X$),_MSG_REC_VIEW1$=_MSG_X$(1,P-1),_MSG_REC_VIEW2$=_MSG_X$(P+1)
9260 _MSG_REQ_FIELDS$=MSG("REQ_FIELDS")
9270 _MSG_START_FILE$=MSG("START_FILE")
9280 _MSG_UPDATE$=MSG("UPDATE")
9290 _MSG_UPD_OTHER1$=MSG("UPD_OTHER1")
9300 _MSG_UPD_OTHER2$=MSG("UPD_OTHER2")
9310 _MSG_UPD_SAME$=MSG("UPD_SAME")
9320 _MSG_WARNING$=MSG("WARNING")
9330 _MSG_CANNOT_WRITE$=MSG("CANT_WRITE")
9340 _MSG_DUP_UNIQUE$=MSG("DUP_UNIQUE")
9350 RETURN 
9999 END 
21500 GET_INFO:
21502 FS1$="FS1"
21505 READ (Z[2],KEY=ORDER$,REC=FS1$,ERR=*NEXT)
21510 CALL "UPDFS1;EXTRACTBYKEY",Z[2],0,ORDER$,SEG2$,SEG3$,SEG4$,SEG5$,FS1$,FS1{ALL},FOUNDFS1,BUSYFS1
21520 CALL "UPDAR1;READBYKEY",AR1,0,CUSTOMER$,SEG2$,SEG3$,SEG4$,SEG5$,AR1$,AR1{ALL},FOUNDAR1
21525 CUST_NAME$=AR1$(11,35)
21530 VAL_TYP$="I/C/M/S/U/"; CALL "ZZ2PRP","OS",TMP_RESULT$,TMP_DATE$; IF TMP_RESULT$="Y" THEN VAL_TYP$=VAL_TYP$+"T/"
21535 VAL_BAS_TYP$="M/S/"
21540 VAL_PO_TYPE$=" /1/2/3/4/5/6/7/8/9/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O/P/Q/R/S/T/U/V/W/X/Y/Z/"
21690 RETURN 
21698 ! 
21699 ! 
21700 GET_PARMS:! get parameters 
21725 %OP_PARM$=""; FIND (Z[13],KEY=%X3_COMP$+"F/M",DOM=*PROCEED)%OP_PARM$; IF NUL(%OP_PARM$) THEN MSGBOX MSG("FMGODA_2"),MSG(ERR),"!"; CMD_STR$="END",ARG_3$="CANCEL"; RETURN 
21728 DIM %IC_PARM$(200); FIND (Z[13],KEY=%X3_COMP$+"I/C",DOM=*NEXT)%IC_PARM$
21730 %AR1_PARM$=""; FIND (Z[13],KEY=%X3_COMP$+"AR1",DOM=*PROCEED)%AR1_PARM$; IF NUL(%AR1_PARM$) THEN MSGBOX MSG("FMGODA_19"),MSG(ERR),"!"; CMD_STR$="END",ARG_3$="CANCEL"; RETURN 
21735 %AR_PARM$=""; FIND (Z[13],KEY=%X3_COMP$+"A/R",DOM=*PROCEED)%AR_PARM$; IF NUL(%AR_PARM$) THEN MSGBOX MSG("FMGODA_28"),MSG(ERR),"!"; CMD_STR$="END",ARG_3$="CANCEL"; RETURN 
21740 DIM SMP_PARM$(50); CALL "ZZ2PRP","SP",RESULT$,DATE$; IF RESULT$="Y" THEN CIG_PLUS$="Y"; READ (Z[13],KEY=X3$(9,3)+"SMP",DOM=*NEXT)SMP_PARM$ ELSE CIG_PLUS$="N"; REM "SSP144414
21745 DIM %OP_SECURITY$(255); READ (Z[13],KEY="osec"+%X3_OP_ID$,DOM=*NEXT)%OP_SECURITY$
21750 IF NUL(%OP_PARM$) THEN FIND (Z[13],KEY=%C$+"F/M",DOM=*NEXT)%OP_PARM$
21760 CALL "ZZ2PRP","OS",RESULT$,TF_DATE$; IF RESULT$="Y" THEN USING_TOPS=1 ELSE USING_TOPS=0
21770 DIM OSP_PARMS$(512); IF USING_TOPS THEN FIND (Z[13],KEY=%X3$(9,3)+"OSP",DOM=*NEXT)OSP_PARMS$
21990 RETURN 
21998 ! 
21999 ! 
22000 MAIN_POST_DISPLAY:
22005 GRID_TYPE$="SLS",%OE_GRID=1
22007 EN_GRID$="Y"; GOSUB ENABLE_GROUPS
22010 PERFORM "FMGGRD;BUILD_GRID"
22090 RETURN 
22098 ! 
22099 ! 
22100 WRAPUP:
22120 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
22180 %OE_GRID=0
22190 RETURN 
22198 ! 
22199 ! 
22600 SELECT_PO:
22610 %SALES_ORDER_PREFIX$=ORDER_DIV$+ORDER_NUM$
22620 PROCESS "POGMAA.OR","../POG/PO.EN"
22630 NEXT_ID=BUTTON_14.CTL ! p.o. button
22690 RETURN 
55000 ENABLE_GROUPS:
55060 IF EN_GRID$="Y" THEN CALL "*wingrp;enable",GRID.GRP$; EN_GRID$=""
55070 IF EN_GRID$="N" THEN CALL "*wingrp;disable",GRID.GRP$; EN_GRID$=""
55075 IF EN_KEYS$="N" THEN CALL "*wingrp;disable",KEYS.GRP$; EN_KEYS$=""
55077 IF EN_KEYS$="Y" THEN CALL "*wingrp;enable",KEYS.GRP$; EN_KEYS$=""
55290 RETURN 
55298 ! 
55299 ! 
56000 REM "208671-Order Entry - GUI Order Lines. Redesign based upon a        
