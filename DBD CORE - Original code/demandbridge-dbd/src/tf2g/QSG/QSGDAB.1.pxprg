0010 ! RFQ Detail Entry <QSGDAB.1> GUI Version
0020 ! "5.0 - 04/03/02 - 16.285555 - rms
0030 ! "Copyright 2002 Computer Software Inc.; Norcross, Georgia
0035 REM "5.7 - 01/04/10 - 11.673888 - tma - SSP# 234369
0037 REM "234369-RFQ - If you change the unit of measure for pricing from    
0040 REM "Copyright 2010 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0300 IOLISTS:! ^300
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24]
0320 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20],C[21],C[22],C[23],C[24],C[25],C[26],C[27],C[28],C[29],C[30],C[31]
0330 IOLIST E$,E0$,E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15],E[16],E[17],E[18],E[19],E[20],E[21],E[22],E[23],E[24],E[25],E[26],E[27],E[28],E[29],E[30],E[31],E[32],E[33],E[34],E[35],E[36]
0340 IOLIST E2$
0350 IOLIST M$,M[0],M[1],M[2],M[3],M[4],M[5],M[6],M[7],M[8],M[9],M[10],M[11],M[12],M[13],M[14],M[15],M[16],M[17],M[18],M[19],M[20],M[21],M[22],M[23],M[24],M[25],M[26],M[27],M[28],M[29],M[30],M[31],M[32],M[33],M[34],M[35] ! SSP#234369
0360 RETURN 
0370 ! 
0500 OPEN_FILES:! ^500,5
0505 _FMP=HFN; OPEN (_FMP)"FMP"+%C$
0510 _FM0=HFN; OPEN (_FM0)"FM0"+%C$
0515 _QS1=HFN; OPEN (_QS1)"QS1"+%C$
0520 _AR1=HFN; OPEN (_AR1)"AR1"+%C$
0525 _QS2=HFN; OPEN (_QS2)"QS2"+%C$
0530 _IC0=HFN; OPEN (_IC0)"IC0"+%C$
0535 _FM1=HFN; OPEN (_FM1)"FM1"+%C$
0537 _ZZPARM=HFN; OPEN (_ZZPARM)"ZZPARM"
0540 _FILE_NAME$="QSB"+%C$
0545 _FIL_NO_QSB=HFN; OPEN (_FIL_NO_QSB,IOL=*)_FILE_NAME$
0550 _CUR_FN_QSB=HFN; OPEN (_CUR_FN_QSB,IOL=*,REC=_CUR_B$)_FILE_NAME$
0555 _QSB=HFN; OPEN (_QSB,IOL=*,REC=_LINE$)_FILE_NAME$
0560 _FILE_NAME$="QSC"+%C$,_FIL_NO_QSC=HFN; OPEN (_FIL_NO_QSC,IOL=*)_FILE_NAME$
0565 ! SAVE_SELL_QTY_PER=SELL_QTY_PER,SAVE_SELL_QTY_PER$=SELL_QTY_PER$
0590 RETURN 
0595 ! 
0600 SETUP:! ^600,5
0605 E0$=""; DIM E2$(130),E$(120),E[36]
0610 DIM A$(157),A[24]
0615 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,-1,X1,X2
0620 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=*NEXT)
0625 READ (_ZZPARM,KEY=%C$+"RFQ",DOM=*NEXT)P8$
0630 READ (_ZZPARM,KEY=%C$+"F/M")FMS_PARM$
0635 READ DATA FROM REC(IOL(_FIL_NO_QSB)) TO IOL=0310
0640 READ DATA FROM REC(IOL(_FIL_NO_QSC)) TO IOL=0330
0645 RETURN 
0650 ! 
0700 LOAD_DATA:! ^700,5
0705 READ DATA FROM REC(IOL=0310) TO IOL=IOL(_FIL_NO_QSB)
0710 READ DATA FROM REC(IOL=0330) TO IOL=IOL(_FIL_NO_QSC)
0715 RETURN 
0720 ! 
2100 ! ^2100,5 REM "Custom?
2105 ! CALL "ZZPROM",".4",X3$,0,"Only line 001 may contain a custom item","","",0
2110 ! 
2200 ! ^2200,5 REM "Product code
2205 GOSUB SET_INFO
2210 GOSUB CHECK_CHANGES
2215 ! 
2250 ! ^2250,5 REM "Left-right
2255 GOSUB SET_INFO
2260 GOSUB CHECK_CHANGES
2265 ! 
2300 ! ^2300,5 REM "Top-Bottom
2305 GOSUB SET_INFO
2310 GOSUB CHECK_CHANGES
2315 ! 
2350 ! ^2350,5 REM "Number of plys
2355 GOSUB SET_INFO
2360 GOSUB CHECK_CHANGES
2365 ! 
2400 ! ^2400,5 REM "Item description
2405 GOSUB SET_INFO
2410 GOSUB CHECK_CHANGES
2415 ! 
2800 ITEM_CODE:! ^2800,5
2805 GOSUB OPEN_FILES; GOSUB SETUP
2810 IF A$(99,1)<>"Y" AND POS(A$(9,1)="S")<>0 THEN PERFORM "QSGDAH.1;SPECIALS"
2815 ! X$="F1-F1 Lookup will show Custom Item Masters for this Customer"
2820 IF A$(99,1)="Y" THEN GOSUB FORM_SETUP
2825 GOSUB LOAD_DATA
2830 GOSUB CLOSE_FILES
2835 RETURN 
2840 ! 
5000 FORM_SETUP:! ^5000,5
5005 ! IF FMS_PARM$(283,1)="Y" THEN CALL "FS2DAN",X3$,%CUST_DIV$+%CUST_CODE$+A$(10,10),14
5010 A$(101,1)="Y"
5015 DIM C[31],C$(325)
5020 FIND (_QS1,KEY=QUOTE_DIV$+QUOTE_NUM$+QUOTE_LINE_NUM$,DOM=NEW_RFQ_ITEM)IOL=0320; C$=C$(12)
5022 IF C$(1,20)<>%CUSTOMER$+ITEM_CODE$ THEN REMOVE (_QS1,KEY=QUOTE_DIV$+QUOTE_NUM$+QUOTE_LINE_NUM$,ERR=*NEXT)
5023 IF C$(1,20)<>%CUSTOMER$+ITEM_CODE$ THEN DIM C[31],C$(325); GOTO NEW_RFQ_ITEM
5025 GOSUB DEFAULT_CUSTOM
5030 RETURN 
5031 ! 
5035 NEW_RFQ_ITEM:! 5035,5
5040 GOSUB FIND_CUSTOM_ITEM
5045 GOSUB ITEM_COPY
5050 GOSUB AUX_READS
5055 GOSUB DEFAULT_CUSTOM
5060 ! 
5200 FIND_CUSTOM_ITEM:! ^5200,5
5205 DIM N$(20),N0$(100),C$(325),C[31]
5210 REM "Customer
5215 N$=%CUST_DIV$+%CUST_CODE$+A$(10,10)
5220 FIND (_AR1,KEY=N$(1,10),DOM=*NEXT)N0$
5250 ! ^5250,5; REM "Item Code
5255 FIND (_FM1,KEY=N$,DOM=NO_FUND)IOL=0320
5256 IF ACT$="DONE" AND N$=%NN$ THEN FIND (_FM1,KEY=N_CUST$+N_ITEM$,DOM=*NEXT)IOL=0320
5300 ! ^5300,5; REM "Convert to rfq
5305 C$(1,20)=%CUST_DIV$+%CUST_CODE$+A$(10,10),C[31]=0
5310 FOR I=5 TO 6; C[I]=0; NEXT I
5315 FOR I=19 TO 28; C[I]=0; NEXT I
5320 IF MID(P8$,7,1)<>"Y" THEN GOTO 5340
5325 FOR I=8 TO 17; C[I]=0; NEXT I
5330 C[29]=0,C[30]=0
5335 C$(109,6)="",C$(126,47)="",C$(185)=""
5340 C$=QUOTE_DIV$+QUOTE_NUM$+QUOTE_LINE_NUM$+C$; WRITE (_QS1,KEY=QUOTE_DIV$+QUOTE_NUM$+QUOTE_LINE_NUM$)IOL=0320; C$=C$(12)
5345 RETURN 
5350 ! 
5800 AUX_READS:! ^5800,5
5805 DIM E2$(130); FIND (_FM0,KEY="P"+A$(81,14),DOM=*NEXT)IOL=0340
5810 FIND (_QS1,KEY=A$(150,8)+A$(6,3),DOM=*NEXT)IOL=0320; C$=C$(12)
5815 RETURN 
5820 ! 
8000 DEFAULT_CUSTOM:! ^8000,5
8005 A$(20,61)=C$(21,61),A[24]=C[0]
8010 IF A$(95,4)="    " THEN A$(95,4)=C$(100,4),A[0]=C[4]
8015 IF E$(9,4)="    " THEN E$(9,4)=C$(96,4),E[0]=C[2]
8020 RETURN 
8025 ! 
8050 SYNC_CUSTOM:! ^8050,5
8055 IF A$(99,1)<>"Y" OR POS(" "<>A2$)=0 THEN GOTO 8090
8060 READ (_QS1,KEY=QUOTE_DIV$+QUOTE_NUM$+QUOTE_LINE_NUM$,DOM=8090)IOL=0320; C$=C$(12)
8065 C$(11,71)=A$(10,71),C[0]=A[24]
8070 C$=A1$+C$; WRITE (_QS1,KEY=A1$)IOL=0320
8075 IF A2$(21,19)+A2$(40,2)=A$(21,19)+A$(40,2) THEN GOTO 8090
8080 REMOVE (_QS2,KEY=A2$(21,19)+A2$(40,2)+A1$,DOM=*NEXT)
8085 WRITE (_QS2,KEY=A$(21,19)+A$(40,2)+A1$)
8090 RETURN 
8095 ! 
8100 SET_INFO:! ^8100,5
8105 A2$=A$(10,71)
8110 RETURN 
8115 ! 
8125 CHECK_CHANGES:! ^8125,5
8130 IF A2$<>A$(10,71) THEN GOSUB SYNC_CUSTOM
8135 RETURN 
8140 ! 
8300 ITEM_COPY:! ^8300,5
8305 REM "Copy records for item
8306 A1$=_KEY$
8310 WRITE (_QS2,KEY=C$(21,3)+C$(24,16)+C$(40,2)+A1$)
8315 _FILE_FROM=HFN; OPEN (_FILE_FROM)"FMS"+%C$; _FILE_TO=HFN; OPEN (_FILE_TO)"QSS"+%C$; _KEY_TYPE$="*"; GOSUB TRANSFER_RECS
8320 _FILE_FROM=HFN; OPEN (_FILE_FROM)"FMU"+%C$; _FILE_TO=HFN; OPEN (_FILE_TO)"QSU"+%C$; GOSUB TRANSFER_RECS
8325 _FILE_FROM=HFN; OPEN (_FILE_FROM)"FMV"+%C$; _FILE_TO=HFN; OPEN (_FILE_TO)"QSV"+%C$; GOSUB TRANSFER_RECS
8330 _FILE_FROM=HFN; OPEN (_FILE_FROM)"FSF"+%C$; _FILE_TO=HFN; OPEN (_FILE_TO)"QSF"+%C$; _KEY_TYPE$="*"; GOSUB TRANSFER_RECS
8335 RETURN 
8350 TRANSFER_RECS:! 8350,5
8355 REM "Transfer records with key N$ _FILE_FROM to _FILE_TO with a key of A1$
8360 EXTRACT (_FILE_FROM,KEY=N$,DOM=*NEXT)
8365 K$=KEY(_FILE_FROM,END=TRANSFER_DONE)
8370 IF MID(K$,1,LEN(N$))<>N$ THEN GOTO TRANSFER_DONE
8375 READ RECORD (_FILE_FROM,END=TRANSFER_DONE)A8$
8380 A8$(1,20)=%CUST_DIV$+%CUST_CODE$+A$(10,10)
8382 IF POS("QSF"=PTH(_FILE_TO))<>0 THEN A8$=A8$(1,LEN(A8$)-1)
8385 A8$=A1$+A8$; IF _KEY_TYPE$="*" THEN WRITE RECORD (_FILE_TO,KEY=A1$)A8$ ELSE WRITE RECORD (_FILE_TO,KEY=A8$(1,34))A8$
8390 READ (_FILE_FROM,KEY=K$,END=TRANSFER_DONE)
8395 GOTO 8365
8400 TRANSFER_DONE:! ^8400,5
8405 CLOSE (_FILE_FROM); CLOSE (_FILE_TO)
8410 _KEY_TYPE$=""
8415 RETURN 
8420 ! 
8600 RECOMPUTE_COST:! ^8600,5; ! Adjust QSD values if cost U/M changed!SSP#234369
8605 ! Z$="10C IC0...  10O QSD...  "!SSP#234369
8610 ! CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 8613,8675
8615 DIM M$(289),M[35] ! SSP#234369
8620 READ (_QSD,KEY=QUOTE$+QUOTE_LINE_NUM$,DOM=8623) ! SSP#234369
8625 K$=KEY(_QSD,END=8663) ! SSP#234369
8630 IF K$(1,11)<>QUOTE$+QUOTE_LINE_NUM$ THEN GOTO 8663
8635 READ (_QSD,KEY=K$,DOM=8625)IOL=0350 ! SSP#234369
8640 FOR I=1 TO 5
8645 IF M[I]<>0 THEN M[I]=M[I]*COST_QTY_PER/_ORIG_C.COST_QTY_PER ! SSP#234369
8650 NEXT I
8655 WRITE (_QSD,KEY=K$)IOL=0350 ! SSP#234369
8660 GOTO 8625
8665 ! Z$="10C QSD...  10O IC0...  "!SSP#234369
8670 ! CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1!SSP#234369
8675 RETURN 
8680 ! 
9900 CLOSE_FILES:! ^9900,5
9905 CLOSE (_FMP)
9910 CLOSE (_FM0)
9915 CLOSE (_QS1)
9920 CLOSE (_AR1)
9925 CLOSE (_QS2)
9930 CLOSE (_IC0)
9935 CLOSE (_FM1)
9936 SELL_QTY_PER=SAVE_QTY_PER,SELL_QTY_PER$=SAVE_SELL_QTY_PER$
9940 RETURN 
9945 ! 
9999 END 
10000 SEL_ITEM:
10005 REFRESH_FLG=1,NO_ITEM=1,ITEM_CODE$=PAD(ITEM_CODE$,10," "); DIM IC0(40) ! ssp 202874
10008 DIM _QS1(31); _QS11=HFN; OPEN (_QS11)"QS1"+%C$; READ (_QS11,KEY=QUOTE$+QUOTE_LINE_NUM$,DOM=10010)_QS1$,_QS1{ALL}
10009 QS1_YES=1,ITEM_DESC$=_QS1$(53,40),PROD_CODE$=_QS1$(32,3),LEFT_RIGHT$=_QS1$(35,8),TOP_BOTTOM$=_QS1$(43,8),PLYS$=_QS1$(51,2),SELL_UM$=_QS1$(111,4),COST_UM$=_QS1$(107,4),SELL_QTY_PER=_QS1(4),SELL_QTY_PER$=STR(_QS1(4)),COST_QTY_PER=_QS1(2),COST_QTY_PER$=STR(_QS1(2)); GOTO NO_ITEM
10010 _IC0=HFN; OPEN (_IC0)"IC0"+%C$
10020 READ (_IC0,KEY=%CUST_DIV$+%CUST_CODE$+ITEM_CODE$,DOM=CHECK_FM0)IC0$,IC0{ALL} ! ssp 202874
10030 ITEM_DESC$=IC0$(21,40),PROD_CODE$=IC0$(61,3),LEFT_RIGHT$=IC0$(64,8),TOP_BOTTOM$=IC0$(72,8),PLYS$=IC0$(80,2),NO_ITEM=0
10035 IF SELL_QTY_PER<=1 THEN SELL_QTY_PER=IC0(14),SELL_QTY_PER$=STR(IC0(14)) ! ssp 202874
10036 IF COST_QTY_PER<=1 THEN COST_QTY_PER=IC0(15),COST_QTY_PER$=STR(IC0(15)) ! ssp 202874
10040 GOTO NO_ITEM
10500 CHECK_FM0:
10510 _FM1=HFN; OPEN (_FM1)"FM1"+%C$
10515 IF ACT$="DONE" AND %CUST_DIV$+%CUST_CODE$+ITEM_CODE$=%NN$ THEN REMOVE (_FM1,KEY=%NN$,DOM=*NEXT); ACT$=""
10520 READ (_FM1,KEY=%CUST_DIV$+%CUST_CODE$+ITEM_CODE$,DOM=NO_ITEM)FM1$
10530 ITEM_DESC$=FM1$(42,40),PROD_CODE$=FM1$(21,3),LEFT_RIGHT$=FM1$(24,8),TOP_BOTTOM$=FM1$(32,8),PLYS$=FM1$(40,2),NO_ITEM=0
11000 NO_ITEM:
11010 CLOSE (_IC0,ERR=*NEXT)
11012 CLOSE (_FM1,ERR=*NEXT)
11020 RETURN 
12000 NO_FUND:
12005 COUNT+=1; IF COUNT>=2 THEN COUNT=0; GOTO 12020
12006 %NN$=N$
12010 CALL "QSGSEL",N_CUST$,N_ITEM$,ACT$
12011 IF ACT$<>"DONE" THEN GOTO 5256
12020 READ (_FM1,KEY=N_CUST$+N_ITEM$,DOM=5256)IOL=0320; C$(1,20)=N$; IF NOT(%RFQ) THEN WRITE (_FM1,KEY=C$(1,20))IOL=0320
12060 IF ACT$="DONE" THEN N$=N_CUST$+N_ITEM$; GOTO 5255
56000 ! "202874-RFQ Unit of Measure not saving if changed in RFQ Line Entry 
56002 REM "206206-RFQ. When setting up a new form and you use the copy feature
