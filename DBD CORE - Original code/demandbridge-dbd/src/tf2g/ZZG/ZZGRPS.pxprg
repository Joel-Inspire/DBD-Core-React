0010 REM "Report Writer Report Selection <ZZGRPS>              
0020 SETESC 9300; SETERR 9000
0035 REM "5.5 - 02/03/07 - 9.230277 - jme - SSP# 204533
0037 REM "204533-Create Bin Replinishment Report                             
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 INIT:
0110 X0$="ZZGRPS",X1$="Report Writer Report Selection"
0120 DIM Z0$(80,"-")
0125 DIM G[4],D[4],Y[4],P[8],X0[4],X1[4],S$(10)
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0500 REM "FILES
0505 DIM Z[256]
0510 Z$="13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
0530 RWR=UNT; OPEN (RWR)"RWR"+%C$
0990 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9190,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOSUB 6600; GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9750 REM 
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
9770 RETURN 
9900 REM "END PROGRAM
9902 WRAPUP:
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9915 CLOSE (RWR)
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 SETESC 9350
9950 EXIT 
9999 END 
10000 SELECT_REPORT_NAME:
10005 TO_PDF=0,O_PDF=0
10010 REPORT_NAME$=PAD(REPORT_NAME$,25)
10030 CALL "UPDRWR;READBYKEY",RWR,0,PAD(%RW_RPT_GRP$,10),REPORT_NAME$,SEG3$,SEG4$,SEG5$,RWR$,RWR{ALL},FOUNDRWR; IF NOT(FOUNDRWR) THEN MSGBOX MSG("INVALID_C"); NEXT_ID=REPORT_NAME.CTL; EXIT 
10050 REPORT$=STP(REPORT_NAME$,2)+".pvr"; RPT=NEW("*rpt/pvxreport"); IF NOT(RPT) THEN MSGBOX MSG("RPT_ERR"); NEXT_ID=REPORT_NAME.CTL; GOTO *RETURN
10060 RPT_O=RPT'OPEN(REPORT$,ERR=*NEXT)
10070 IF NOT(RPT_O) THEN MSGBOX MSG("INV_RPT"); DROP OBJECT RPT; NEXT_ID=REPORT_NAME.CTL; GOTO *RETURN
10080 DROP OBJECT RPT ! close object now ! used only to verify report exists
10090 CALL "*wingrp;enable",PRINT.GRP$
10095 NEXT_ID=PRINT.CTL
10100 IF RWR$(36,2)<>DIM(2) THEN {
10105 ! open topform printer
10107 DIM Z[256]
10110 X0$="ZZGRPS",X3$=%X3$,F$=RWR$(36,2),H0$="",H1$="",W0=0,W9=UNT
10115 ZZ9=UNT; OPEN (ZZ9)"ZZ9"+%C$
10120 READ (ZZ9,KEY=F$,DOM=*NEXT)ZZ9$; IF POS("tf_topdf"=ZZ9$)<>0 THEN TO_PDF=1 ! use pvx new pdf driver
10125 CLOSE (ZZ9)
10150 IF NOT(TO_PDF) THEN CALL "ZZPRIN",X0$,X3$,Y0$,F$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; IF W4>0 THEN MSGBOX MSG("INV_PTR"); NEXT_ID=REPORT_NAME.CTL; GOTO *RETURN
10160 IF TO_PDF THEN {
10165 F$="_RW"+FID(0)+"_"+STP(REPORT_NAME$,2)+".pdf"
10170 ERASE F$,ERR=*NEXT
10172 W9=UNT
10175 SERIAL F$
10180 OPEN (W9,ERR=*NEXT)"*PDF*;FILE="+F$; O_PDF=1
10185 IF NOT(O_PDF) THEN MSGBOX MSG("INV_PTR"); NEXT_ID=REPORT_NAME.CTL; GOTO *RETURN
10190  }
10195  } ! 10100
10490 RETURN 
10498 ! 
10499 ! 
10500 SELECT_PRINT:
10502 PRINT 'MESSAGE'('_BLUE'+'WHITE'+"PRINTING ",0)
10505 SETERR 10680
10510 IF RWR$(36,2)=DIM(2) THEN CALL "*rpt/runreport;Run_Call",REPORT$ ELSE W9$=STR(W9); CALL "*rpt/runreport;Run_Call",REPORT$,W9$
10550 IF W9>0 THEN CLOSE (W9)
10600 IF O_PDF THEN {
10605 TMP_CHAN=HFN; SERIAL %WDX$+"C:\"+F$,ERR=*NEXT
10610 OPEN PURGE (TMP_CHAN,ISZ=1,ERR=10690)%WDX$+"C:\"+F$; W9=HFN; OPEN (W9,ISZ=8000)F$
10620 READ RECORD (W9,END=*NEXT)J$; WRITE RECORD (TMP_CHAN,SIZ=LEN(J$))J$; GOTO *SAME
10630 CLOSE (W9); CLOSE (TMP_CHAN)
10640 SYSTEM_HELP "C:\"+F$
10650  }
10680 CMD_STR$="END"
10685 CLOSE (W9,ERR=*NEXT) ! incase error on line 10510
10690 RETURN 
11000 SELECT_EXIT:
11005 PRINT 'MESSAGE'('_BLUE'+'WHITE'+"PRINTING ",0)
11060 IF W9>0 THEN CLOSE (W9)
11080 CMD_STR$="END"
11090 RETURN 
56000 REM "204533-Create Bin Replinishment Report                             
