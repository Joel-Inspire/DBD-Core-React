0010 ! ZZGPAN - Copy panel from archive to Library
0020 ! "6.0 - 01/13/05 - 12.292777 - jir SSP# 191498
0030 ! "Copyright 2003 Computer Software Inc.; Norcross, Georgia
0035 REM "5.7 - 05/11/21 - 11.148771 - jvv - SSP# 307353
0037 REM "307353-Change to ZZGPAN for pvx2017                                
0040 REM "Copyright 2021 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 PROCESS "ZZGSSP","../ZZG/ZZ.EN",SSP$,DESC1$
0060 PROCESS "ZZGPAN","../ZZG/ZZ.EN",SSP$,DESC1$
0070 IF TCB(13)=1 THEN RUN "ZMENU" ELSE EXIT 
0100 INIT:! 100,10
0110 DIR$=%DATAPATH$; IF DIR$(LEN(DIR$))<>"/" THEN DIR$=DIR$+"/",REFRESH_FLG=1
0120 ! DIR$="/usr/lib/pvx/rel/panel_archive/" ! Line to test in dev
0130 CN=HFN; OPEN (CN)DIR$
0140 READ (CN,END=END_DIR)N$
0150 IF POS(ARG_1$=N$)=0 THEN GOTO 0140
0160 ! N$=SUB(N$,"^","/")
0170 XX=POS("^"=N$),SSP$=N$(1,XX-1),N$=N$(XX+1)
0180 XX=POS("^"=N$),LIB$=N$(1,XX-1),N$=N$(XX+1)
0190 XX=POS("^"=N$),PAN$=N$(1,XX-1),N$=N$(XX+1)
0200 XX=POS("^"=N$),BY$=N$(1,XX-1),N$=N$(XX+1)
0210 DAT$=N$
0220 IDX+=1; LIST_BOX LOAD LB_ARC.CTL,IDX,SSP$+SEP+LIB$+SEP+PAN$+SEP+BY$+SEP+STR(DAT$:"0000-00-00-00-00-00")+SEP
0230 GOTO 0140
0240 END_DIR:
0250 IF IDX<>0 THEN CALL "*wingrp;enable",SEL.GRP$
0260 RETURN 
0270 END_PROG:CLOSE (CN,ERR=*NEXT)
0280 RETURN 
0500 PROCEED:! 500,10
0510 FOR AA=1 TO LB_ARC.CTL'ITEMCOUNT
0520 LIST_BOX FIND LB_ARC.CTL,AA,AA$
0530 BB$=SUB(AA$,SEP,"^"),BB$=SUB(BB$,"-",""),CC$=SUB(AA$,SEP,SEP+'_RED'+'WHITE'),CC$='_RED'+'WHITE'+CC$,N$=AA$,DD$=SUB(AA$,SEP,SEP+'_GREEN'+'WHITE'),DD$='_GREEN'+'WHITE'+DD$
0540 XX=POS(SEP=N$),SSP$=N$(1,XX-1),N$=N$(XX+1)
0550 XX=POS(SEP=N$),LIB$=N$(1,XX-1),N$=N$(XX+1),LIB$=SUB(LIB$,"~",DLM),LIB$="../"+LIB$
0560 XX=POS(SEP=N$),PAN$=N$(1,XX-1),N$=N$(XX+1),PAN$=PAD(PAN$,12," ") ! SSP 194258
0570 BB$=BB$(1,LEN(BB$)-1)
0580 LIST_BOX LOAD LB_ARC.CTL,AA,*
0590 LIST_BOX LOAD LB_ARC.CTL,AA,CC$
0600 _LIB=HFN; OPEN (_LIB)LIB$; GOSUB COPY_LIBRARY
0610 _OPF=HFN; OPEN (_OPF)DIR$+BB$
0620 READ (_LIB,KEY=PAN$,DOM=*NEXT)
0630 _KPAN$=KEY(_LIB,END=END_PANEL); READ (_LIB)
0640 IF MID(_KPAN$,1,LEN(PAN$))=PAN$ THEN SET_FOCUS 0; PRINT 'MESSAGE'('_RED'+'WHITE'+"Remove Record: "+_KPAN$,0); REMOVE (_LIB,KEY=_KPAN$); GOTO 0630
0650 END_PANEL:
0660 _KOPF$=KEY(_OPF,END=END_OPF); READ RECORD (_OPF)REC$
0670 WRITE RECORD (_LIB,KEY=_KOPF$)STP(REC$,1,$00$) ! SSP 307352
0680 PRINT 'MESSAGE'('_RED'+'WHITE'+"Write Record: "+_KPAN$,0),
0690 GOTO END_PANEL
0700 END_OPF:
0710 CLOSE (_OPF)
0720 ERASE DIR$+BB$,ERR=*NEXT
0730 CLOSE (_LIB)
0740 LIST_BOX LOAD LB_ARC.CTL,AA,*
0750 LIST_BOX LOAD LB_ARC.CTL,AA,DD$
0760 NEXT 
0770 MSGBOX "Process Done!","FyI","!,tim=5"
0780 CMD_STR$="E"
0790 EXIT 
0800 COPY_LIBRARY:
0810 FR_LIB$=PTH(_LIB),TO_LIB$=FR_LIB$+".bck_"+DTE(0:"%Yl%Mz%Dz%Sz")
0820 INVOKE "cp "+FR_LIB$+" "+TO_LIB$
0830 RETURN 
9999 END 
56000 ! "191498-Create new routine to copy panel                            
56001 ! "194258-Problem with the panel copy program ZZGPAN                  
56003 ! "201277-Cannot use ZZGPAN to copy panel ARGCAA_VER7 what it does    
56004 REM "307353-Change to ZZGPAN for pvx2017                                
