0010 ! ZPGUAA - Remove Call Detail Records
0035 REM "5.5 - 02/26/07 - 18.861111 - crg - SSP# 205460
0037 REM "205460-Oracle - FIN(CHANNEL,"NUMREC") changed to use FN%FIN$()     
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! 
0060 IF TCB(13)=1 THEN BEGIN 
0070 PROCESS "ZPGUAA","../ZPG/ZP.EN"
0080 GOTO 9800
0100 INIT:! ^100,5 - Initialization routine
0105 K9$="",K9=0
0110 X0$="ZP2UAA",X2=1
0115 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2
0120 IF X1>0 THEN GOTO 9000
0125 ! 
0300 ! 300,5 - Iolists and Templates
0305 GLOBAL_IOL:IOLIST %SOURCE_OF_LEAD$,%SIC_DESC$,%CONT_CAT_DESC$,%SEL_COD_DESC$
0310 IOLIST LIST_CODE$:[LEN(4,SEP=SEP)],RMV_DATE$:[LEN(6,SEP=SEP)],ACT_CODES$:[LEN(16,SEP=SEP)],SIC_CODE$:[LEN(5,SEP=SEP)],SOURCE$:[LEN(3,SEP=SEP)],CAT_CODE$:[LEN(3,SEP=SEP)],MIN_BAR$:[LEN(1,SEP=SEP)],INC1$:[LEN(3,SEP=SEP)],INC2$:[LEN(3,SEP=SEP)],INC3$:[LEN(3,SEP=SEP)],INC4$:[LEN(3,SEP=SEP)],INC5$:[LEN(3,SEP=SEP)],INC6$:[LEN(3,SEP=SEP)],INC7$:[LEN(3,SEP=SEP)],INC8$:[LEN(3,SEP=SEP)],INC9$:[LEN(3,SEP=SEP)],INC10$:[LEN(3,SEP=SEP)],INC11$:[LEN(3,SEP=SEP)],INC12$:[LEN(3,SEP=SEP)],EX1$:[LEN(3,SEP=SEP)],EX2$:[LEN(3,SEP=SEP)],EX3$:[LEN(3,SEP=SEP)],EX4$:[LEN(3,SEP=SEP)],EX5$:[LEN(3,SEP=SEP)],EX6$:[LEN(3,SEP=SEP)],EX7$:[LEN(3,SEP=SEP)],EX8$:[LEN(3,SEP=SEP)],EX9$:[LEN(3,SEP=SEP)],EX10$:[LEN(3,SEP=SEP)],EX11$:[LEN(3,SEP=SEP)],EX12$:[LEN(3,SEP=SEP)],OLD_DATE$:[LEN(6,SEP=SEP)]
0315 IOLIST A$(1),A0,A1
0320 IOLIST E$,E[0],E[1]
0325 IOLIST G$
0330 ! 
0500 ! 500,5 - Open files
0503 GOSUB SETUP_MESSAGES
0505 _FILE_NAME$="ZZPARM"; _ZZPARM=HFN; OPEN (_ZZPARM,ERR=OPEN_ERR)_FILE_NAME$
0506 ! _FILE_NAME$="ZP0"+%C$; _ZP0=HFN; OPEN (_ZP0,ERR=OPEN_ERR)_FILE_NAME$
0507 ! _FILE_NAME$="ZP2"+%C$; _ZP2=HFN; OPEN (_ZP2,ERR=OPEN_ERR)_FILE_NAME$
0508 ! _FILE_NAME$="ZP1"+%C$; _ZP1=HFN; OPEN (_ZP1,ERR=OPEN_ERR)_FILE_NAME$
0509 _FILE_NAME$="ZP4"+%C$; _ZP4=HFN; OPEN (_ZP4,ERR=OPEN_ERR)_FILE_NAME$
0510 _FILE_NAME$="ZPB"+%C$; _ZPB=HFN; OPEN (_ZPB,ERR=OPEN_ERR)_FILE_NAME$
0511 _FILE_NAME$="ZP5"+%C$; _ZP5=HFN; OPEN LOCK (_ZP5,ERR=OPEN_ERR)_FILE_NAME$
0525 READ (_ZZPARM,KEY=K9$,DOM=*NEXT)
0530 DIM S9$(255); FIND (_ZZPARM,KEY="osec"+%X3_OP_ID$,DOM=*NEXT)S9$
0535 DIM E[2],A[2]
0540 DIM A$:IOL=0310
0545 A$(1,LEN(A1$))=A1$; IF A1$="" THEN A$(1,LEN(K9$))=K9$
0550 EXIT 
0555 ! 
0570 OPEN_ERR: MSGBOX _MSG_FILOPNERR1$+QUO+_FILE_NAME$+QUO+SEP+_MSG_DIRECTORY$+LWD+SEP+_MSG_PREFIX$+PFX,MSG(ERR),"!"
0575 CMD_STR$="END"
0580 RETURN 
0585 ! 
1000 CLEAR_REC:! ^1000,5 - Clear the screen
1005 READ DATA FROM "" TO IOL=GLOBAL_IOL
1010 READ DATA FROM "",REC=A$ TO IOL=0310
1015 NEXT_ID=A.LIST_CODE.CTL,REFRESH_FLG=1,A0=0,A1=0
1020 EXIT 
1025 ! 
7400 DELETE_REC:! 7400,5 - Confirm deletion
7405 IF STP(A.LIST_CODE$,2)="" THEN {
7410 MSGBOX "List Type Code is missing","Attention","!"
7415 NEXT_ID=A.LIST_CODE.CTL,REFRESH_FLG=1
7420 EXIT 
7425  }
7430 ! 
7435 MSGBOX MSG("DEL_RECS"),MSG("CONFIRM"),"?,YESNO,2",ANSWER$
7440 IF ANSWER$="NO" THEN CMD_STR$="E"; EXIT 
7450 CALL "*progbar;init","Deleting selected records",40
7460 A[0]=A0,A[1]=A1
7470 T_R=NUM(FN%FIN$(_ZP4,"numrec"))
7475 IF T_R<1 THEN T_R=1
7480 P_R=(T_R/20); IF P_R<1 THEN P_R=1
7485 COUNTER=0
7490 ! 
7500 ! ^100,5 - Process the records
7510 V$=DIM(71)+A$(5); DIM V[1]; V[0]=A[0]
7515 READ (_ZP4,KEY=A$(1,4),DOM=*NEXT)
7520 READ (_ZP4,END=7765)IOL=0320
7525 IF A$(1,4)<>E$(1,4) THEN GOTO 7765
7530 CALL "*progbar;update",ERR=*NEXT,E$(1,10)
7531 COUNTER++
7532 IF MOD(COUNTER,P_R)=0 THEN {
7533 CALL "*progbar;update_percent",ERR=*NEXT,"",COUNTER/T_R*100
7534  }
7535 CALL "ZP2SZA",X3$,E$,E{ALL},V$,V{ALL},"","",X9; ON X9 GOTO 7520,7600
7540 ! 
7600 ! ^100,5 - Process detail
7605 N0=0; READ (_ZPB,KEY=E$(1,10),DOM=*NEXT)
7610 K$=KEY(_ZPB,END=7520); READ (_ZPB)
7615 IF K$(1,10)=E$(1,10) THEN {
7620 READ (_ZP5,KEY=K$(1,10)+K$(16),DOM=7750)IOL=0325
7625 IF G$(18,1)="*" THEN GOTO 7610
7630  }
7635 N0=N0+1; IF G$(11,6)>V$(178,6) THEN GOTO 7610 ELSE IF N0<=A1 THEN GOTO 7610
7700 ! ^100,5 - Remove call note record
7705 REMOVE (_ZP5,KEY=K$(1,10)+K$(16),ERR=*NEXT)
7710 ! 
7750 ! ^50,5 - Remove sort key
7755 REMOVE (_ZPB,KEY=K$,DOM=*NEXT)
7760 GOTO 7610
7765 ! 
7800 ! ^100,5 - End of purge
7802 CALL "*progbar;update_percent","",100
7803 CALL "*progbar;wrap_up"
7805 GOTO CLEAR_REC ! CMD_STR$="E"
7810 EXIT 
7815 ! 
9000 AB_END:! 9000,5 - Abnormal end
9005 CMD_STR$="E"
9010 EXIT 
9015 ! 
9100 SETUP_MESSAGES:
9110 _MSG_FILOPNERR1$=MSG("FILOPNERR1")
9115 _MSG_DIRECTORY$=MSG("DIRECTORY")
9120 _MSG_PREFIX$=MSG("PREFIX")
9190 SETUP_MESSAGES_END:RETURN 
9195 ! 
9700 WRAPUP:! 9700,5 - Close files and clean up
9705 READ DATA FROM "" TO IOL=GLOBAL_IOL
9710 IF _ZZPARM THEN CLOSE (_ZZPARM)
9711 IF _ZP4 THEN CLOSE (_ZP4)
9712 IF _ZPB THEN CLOSE (_ZPB)
9713 IF _ZP5 THEN CLOSE (_ZP5)
9715 EXIT 
9720 ! 
9800 ! ^100,5 - Return to previous
9805 ! IF TCB(13)=1 THEN RUN "ZPGMEN"
9998 ! 9998,1 - End
9999 END 
10050 LIST_TYPE_ENTRY:
10055 IF POS(" "<>S9$(8,24))>0 AND POS(A.LIST_CODE$=S9$(8,24),4)=0 THEN {
10060 MSGBOX MSG("ACCESS_DEN")+" "+MSG("NOT_AUTH")+" "+MSG("LIST_T_C")+" "+A.LIST_CODE$,MSG("ATTENTION"),"!"
10065 NEXT_ID=A.LIST_CODE.CTL
10070  }
10090 LIST_TYPE_ENTRY_END:RETURN 
56002 REM "205460-Oracle - FIN(CHANNEL,"NUMREC") changed to use FN%FIN$()     
