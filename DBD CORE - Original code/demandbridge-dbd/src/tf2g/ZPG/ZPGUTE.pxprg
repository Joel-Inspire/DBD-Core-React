0010 ! ZPGUT2 - T/M Change/Move Contact Record
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 06/18/09 - 16.805555 - tma - SSP# 230782
0037 REM "230782-ZPGUTE shows T/M in heading                                 
0040 REM "Copyright 2009 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 PROCESS "ZPGUTE","../ZPG/ZP.EN"
0060 EXIT 
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$
0100 SETERR 9000
0105 INIT:
0110 X0$="ZP2UTE",X1$="C/M Change/Move Contact Record" ! SSP#230782
0120 DIM Z0$(80,"-")
0130 K0=20,K1=1
0135 C9=-1
0200 REM "
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O ZP5...  02O ZPB...  03O ZP0...  04O ZP4...  05O ZPA...  06O AR1...  07O ZPD...  08O ZPE...  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0550 DIM P8$(32); READ (Z[13],KEY=X3$(9,3)+"T/M",DOM=0551)P8$
0580 W9$=""; CALL "RT2PRM",ERR=0581,X3$,X4$,W9$
0582 IF W9$<>"" THEN Z$="14O RT6... "; GOSUB 9750; IF Z0>0 THEN W9$=""; REM "If Remote T/M then open RT6 file to get SEND to list, if er"+                "ror then don't do remote T/M at all
0600 REM "
0610 GOSUB 6000
1000 REM 
1035 DIM A$(64),FROM_LIST$(100),FROM_CC$(494),FROM_CC[1],TO_LIST$(100),TO_CC$(100),SOURCE_DATA[1] ! SSP 201822
1040 GOSUB 6000; GOSUB 6200
1042 GOSUB CLEAR_REC
1045 RETURN 
1050 GOTO 2000
1800 REM 
1820 CALL "ZZPROM","6B",X3$,Z,"","","",X0
1825 ON Z GOTO 1826,2000,9900
1830 GOSUB 7500; IF FLAG1$<>"OK" THEN GOTO 1800
1840 GOTO 3000
2000 REM "DATA SEQ
2010 C0=0,X0=-1,X1=1
2020 C9=1,X$="",C0=ABS(C0),X0=X0+1; IF C0=2 THEN IF X0>0 THEN X0=X0-2
2025 IF C0>3 OR X0<0 THEN GOTO 1800
2040 ON X0 GOTO 2200,2250,2300,2350,2400,2450,1800
2200 REM "From List Code
2210 CALL "ZZENTR","SUZ",A{ALL},A$,X4$,X3$,20,3,1,4,C0,"","{3"+X$,"","ZP2UTE02","ZP0","",""; IF C0=6 THEN GOSUB 6400; C0=1
2220 IF POS(" "<>A$(1,4))=0 THEN GOTO 2020
2230 FIND (Z[3],KEY=A$(1,4),DOM=2210)FROM_LIST$
2235 PRINT @(30,3),FROM_LIST$(5,40),
2240 GOTO 2020
2250 REM "From Contact Code
2260 CALL "ZZENTR","SUZ",A{ALL},A$,X4$,X3$,20,4,5,6,C0,"","{3"+X$,A$(1,4),"ZP2UTE04","ZP4","",""; IF C0=6 THEN GOSUB 6400; C0=1
2270 IF POS(" "<>A$(5,6))=0 THEN GOTO 2020
2280 FIND (Z[4],KEY=A$(1,10),DOM=2260)FROM_CC$,FROM_CC[0]
2285 PRINT @(30,4),FROM_CC$(11,40),
2290 GOTO 2020
2300 REM "To List Code
2310 CALL "ZZENTR","SUZ",A{ALL},A$,X4$,X3$,20,6,11,4,C0,"","{3"+X$,"","ZP2UTE06","ZP0","",""; IF C0=6 THEN GOSUB 6400; C0=1
2320 IF POS(" "<>A$(11,4))=0 THEN GOTO 2020
2330 FIND (Z[3],KEY=A$(11,4),DOM=2310)TO_LIST$
2335 PRINT @(30,6),TO_LIST$(5,40),
2340 GOTO 2020
2350 REM "To Contact Code
2352 SEL_TO_CONTACT_CODE:
2353 TO_CONTACT_CODE$=PAD(TO_CONTACT_CODE$,6,0,"0")
2360 A$(11,4)=TO_LIST_CODE$,A$(15,6)=TO_CONTACT_CODE$,TO_CONTACT_CODE.CTL'VALUE$=TO_CONTACT_CODE$ ! CALL "ZZENTR","SUZ",A{ALL},A$,X4$,X3$,20,7,15,6,C0,"","{3"+X$,"","ZP2UTE08","ZP4","",""; IF C0=6 THEN GOSUB 6400; C0=1
2370 IF POS(" "<>A$(15,6))=0 THEN GOTO 2020
2380 FIND (Z[4],KEY=A$(11,10),DOM=2390)TO_CC$
2385 MSGBOX "To Contact Code already exists ",MSG("WARNING"),"!,TIM=5"; TO_CONTACT_CODE$="",NEXT_ID=TO_CONTACT_CODE.CTL; EXIT 
2390 CALL "*WINGRP;ENABLE",GR4.GRP$
2399 RETURN 
2400 REM "Copy or Move?
2405 X$="C=copy, M=move (delete from code)"
2410 CALL "ZZENTR","SUR",A{ALL},A$,X4$,X3$,20,9,21,1,C0,"","{3"+X$,"CM","ZP2UTE10","","",""
2440 GOTO 2020
2450 REM "Should Notes be included?
2460 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,20,10,22,1,C0,"","{3"+X$,"","ZP2UTE12","","",""
2490 GOTO 2020
2550 REM "Unused
2560 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,60,11,115,1,C0,"","{3"+X$,"","ZP2UTE16","","",""
2590 GOTO 2020
2600 REM "Unused
2610 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,60,12,116,1,C0,"","{3"+X$,"","ZP2UTE18","","",""
2640 GOTO 2020
2650 REM "Unused
2660 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,60,13,117,1,C0,"","{3"+X$,"","ZP2UTE20","","",""
2690 GOTO 2020
2700 REM "Unused
2710 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,60,14,118,1,C0,"","{3"+X$,"","ZP2UTE22","","",""
2740 GOTO 2020
2750 REM "Unused
2760 CALL "ZZENTR","Y",A{ALL},A$,X4$,X3$,60,15,119,1,C0,"","{3"+X$,"","ZP2UTE24","","",""
2790 GOTO 2020
3000 REM "Perform Operation
3020 CALL "ZZPROM",".Y",X3$,Z,"Proceed?","","",0; ON Z GOTO 3021,9900
3030 PROCEED:
3040 GOSUB ASSIGN_PRG
3100 EXTRACT RECORD (Z[4],KEY=A$(1,10),DOM=3400)R$
3120 R$(1,10)=A$(11,10)
3130 WRITE RECORD (Z[4],KEY=R$(1,10))R$
3140 IF A$(21,1)="M" THEN REMOVE (Z[4],KEY=A$(1,10),DOM=3141)
3150 WRITE (Z[5],KEY=R$(1,4)+R$(419,20)+R$(5,6))
3160 IF A$(21,1)="M" THEN REMOVE (Z[5],KEY=A$(1,4)+FROM_CC$(419,20)+A$(5,6),DOM=3161)
3170 IF A$(21,1)="M" AND POS(" "<>R$(363,10))>0 THEN EXTRACT RECORD (Z[6],KEY=R$(363,10),DOM=3171)R1$; IF A$(1,10)=R1$(401,10) THEN R1$(401,10)=A$(11,10); WRITE RECORD (Z[6])R1$
3180 IF POS(X3$(9,3)="060")>0 THEN ZPD_OLD_KEY$=R$(200,12)+A$(1,10),ZPD_KEY$=R$(200,12)+A$(11,10) ELSE ZPD_OLD_KEY$=R$(200,10)+A$(1,10),ZPD_KEY$=R$(200,10)+A$(11,10)
3190 WRITE (Z[7],KEY=ZPD_KEY$)
3200 IF A$(21,1)="M" THEN REMOVE (Z[7],KEY=ZPD_OLD_KEY$,DOM=3201)
3210 WRITE (Z[8],KEY=R$(203,7)+R$(200,3)+R$(1,10))
3220 IF A$(21,1)="M" THEN REMOVE (Z[8],KEY=FROM_CC$(203,7)+FROM_CC$(200,3)+FROM_CC$(1,10),DOM=3221)
3230 IF W9$>"" THEN RT_COMM$="U"; RT_FILE$="ZP4...",RT_KEY$=R$(1,10),SOURCE_DATA$=R$,SOURCE_DATA[0]=FROM_CC[0]; GOSUB REMOTE_TM
3240 IF W9$>"" AND A$(21,1)="M" THEN RT_COMM$="D"; RT_FILE$="ZP4...",RT_KEY$=FROM_CC$(1,10),SOURCE_DATA$=FROM_CC$,SOURCE_DATA[0]=FROM_CC[0]; GOSUB REMOTE_TM
3300 REM "Notes
3310 READ (Z[1],KEY=A$(1,10),DOM=3311)
3320 READ (Z[1],END=3400)OLD_NOTE$
3330 IF OLD_NOTE$(1,10)<>A$(1,10) THEN GOTO 3400 ELSE NEW_NOTE$=A$(11,10)+OLD_NOTE$(11)
3340 IF A$(22,1)="Y" THEN WRITE (Z[1],KEY=NEW_NOTE$(1,17))NEW_NOTE$; NOTE_KEY_PART1$=NEW_NOTE$(1,10); GOSUB 7650; WRITE (Z[2],KEY=A2$)
3350 IF A$(21,1)="M" THEN REMOVE (Z[1],KEY=OLD_NOTE$(1,17),DOM=3351)
3360 IF A$(21,1)="M" THEN NOTE_KEY_PART1$=OLD_NOTE$(1,10); GOSUB 7650; REMOVE (Z[2],KEY=A2$,DOM=3361)
3390 GOTO 3320
3470 MSGBOX "Requested action complete",MSG("CONFIRMING"),"!,TIM=5"
3490 GOTO 1000
6000 REM "BACKGROUND
6001 RETURN 
6005 PRINT (0,ERR=6016)'SB',
6020 PRINT @(3,3),"From List Code:",@(0,4),"From Contact Code:",@(0,5),Z0$,@(5,6),"To List Code:",@(2,7),"To Contact Code:",@(0,8),Z0$,@(5,9),"Move or Copy:",@(4,10),"Include Notes:",
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
6200 REM "
6220 PRINT 'CF',@(20,3),A$(1,4),@(30,3),FROM_LIST$(5,40),@(20,4),A$(5,6),@(30,4),FROM_CC$(11,40),@(20,6),A$(11,4),@(30,6),TO_LIST$(5,40),@(20,7),A$(15,6),@(30,7),TO_CC$(11,40),@(20,9),A$(21,1),@(20,10),A$(22,1),
6290 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6455 IF C9<0 THEN GOTO 6445
6490 RETURN 
7500 REM "Check for valid entry"
7505 FLAG1$="OK"
7510 IF POS(" "<>A$(1,4))=0 THEN GOTO 7550
7515 IF POS(" "<>A$(5,6))=0 THEN GOTO 7550
7520 IF POS(" "<>A$(11,4))=0 THEN GOTO 7550
7525 IF POS(" "<>A$(15,6))=0 THEN GOTO 7550
7530 IF A$(21,1)=" " OR A$(22,1)=" " THEN GOTO 7550
7540 RETURN 
7550 REM 
7560 CALL "ZZPROM",".5",X3$,Z,"All data above must be filled in prior to proceeding","","",0; IF Z=1 THEN EXITTO 9900
7570 FLAG1$=""
7590 RETURN 
7650 REM "NOTES FILE BY DATE SORT
7660 CALL "ZZDATE",X3$,"","G10101",OLD_NOTE$(11,6),D0,1,0,0,0,0,0,"","",""; A2$=NOTE_KEY_PART1$+STR(100000-D0:"00000")+OLD_NOTE$(11,7)
7690 RETURN 
8400 REMOTE_TM:REM "Call RT2WOR to post to remote T/M based on paramters"+      "RT_FILE$ is file name, RT_COMM$ is command (Update or Delete) and "+      "RT_KEY$ is key value"
8403 IF SP_CODE$="" THEN SP_CODE$=SOURCE_DATA$(359,4) END_IF ; IF SP_CODE$=SOURCE_DATA$(359,4) THEN CALL "RT2LST",X3$,X4$,W9$,SOURCE_DATA$(1,4),SP_CODE$,SEND_TO$ ELSE CALL "RT2LST",X3$,X4$,W9$,SOURCE_DATA$(1,4),SP_CODE$,SEND_TO$; TEMP$=SEND_TO$; SP_CODE$=SOURCE_DATA$(359,4); CALL "RT2LST",X3$,X4$,W9$,SOURCE_DATA$(1,4),SP_CODE$,SEND_TO$; SEND_TO$=TEMP$+SEND_TO$
8405 FOR INDEX=1 TO LEN(SEND_TO$)-3 STEP 4
8420 CALL "RT2WOR",ERR=8421,X3$,X4$,SEND_TO$(INDEX,4),RT_FILE$,RT_COMM$,RT_KEY$,SOURCE_DATA$,1,SOURCE_DATA{ALL}
8430 NEXT INDEX
8440 SEND_TO$="",SP_CODE$=""; REM "Reset flags
8445 REMOTE_TM_END:RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9750 REM 
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
9770 RETURN 
9900 REM "END PROGRAM
9901 END_PROC: CMD_STR$="E"
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
10000 CLEAR_REC:
10010 FROM_LIST_CODE$="",%LIST_TYPE_DESC$="",FROM_CONTACT_CODE$=""
10020 %CONT_NAME$="",TO_LIST_CODE$="",%LIST_TYPE_DESC1$="",TO_CONTACT_CODE$=""
10030 %CONT_NAME1$="",REFRESH_FLG=1,CB_NOTE$="N",DB_ACTION$="C"
10040 FOR AA=1 TO 4
10050 EXECUTE "CALL "+QUO+"*WINGRP;DISABLE"+QUO+",GR"+STR(AA)+".GRP$"
10060 NEXT AA
10070 NEXT_ID=FROM_LIST_CODE.CTL
10080 RETURN 
10500 ASSIGN_PRG:
10510 A$(1,4)=FROM_LIST_CODE$,A$(5,6)=FROM_CONTACT_CODE$
10520 A$(11,4)=TO_LIST_CODE$,A$(15,6)=TO_CONTACT_CODE$
10530 A$(21,1)=DB_ACTION$,A$(22,1)=CB_NOTE$
10540 RETURN 
56000 ! "201822-ZPGUTE - line 1035 needs FROM_CC$ changed from 100 to 494 to
