0010 ! Gather Salesperson/Div Info <EIGUAA>
0020 ! Prog Type: I -2.9     
0030 SETESC 2020; SETERR 1850
0035 REM "5.7 - 09/09/13 - 11.381666 - tma - SSP# 265569
0037 REM "265569-EIGUAA-Gather S/person Division Data - Default Fiscal Year  
0040 REM "Copyright 2013 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0061 BML_TIME$=ML_TIME$
0062 PROCESS "EIGUAA","../EIG/EI.EN"
0063 ML_TIME$=BML_TIME$; EXIT 
0070 CLEAR ; SETERR 0080; ENTER X3$,X4$,Q0$,Q1$
0075 INIT:
0080 SETERR 1850; SETESC 2020
0090 X0$="EI2UAA",X1$="Gather Salesperson/Div Info",K9$="",K9=0
0100 DIM Z0$(80,"-")
0110 K0=4,K1=1
0120 C9=-1,V9=-2
0130 M0$="#,###,##0-",M1$="###.00%-"
0140 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0150 ZZPARM=HFN; OPEN (ZZPARM)"ZZPARM"; READ (ZZPARM,KEY=FID(0)+"      ")X3$; CLOSE (ZZPARM)
0160 ! CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 2145
0170 IF X3$(65,1)>"2" THEN PRECISION NUM(X3$(65,1),ERR=0175)
0180 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0190 REM "IOLISTS
0200 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7]
0210 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7]
0220 IOLIST D$
0230 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8]
0240 IOLIST F$,F[0],F[1]
0250 REM "GET E/I Info - added 400-460 by cwj 6/22/98 ssp#091686
0260 DIM Z[NUM(X3$(60,3))]
0270 Z$="13O ZZPARM  "
0280 GOSUB 2100; ON Z0 GOTO 0285,2130
0290 FIND (Z(13),KEY=X3$(9,3)+"E/I",DOM=NO_PARAMETER)E0$
0300 IF E0$(7,1)<>"Y" THEN E1$="..."; GOTO 0370 ELSE E1$=X3$(40,3)
0310 _EI0=HFN; OPEN (_EI0,ERR=0320)"EI0"+E1$; CLOSE (_EI0); GOTO 0340
0320 IF ERR=12 THEN DIRECT "EI0"+E1$,4,0,228,0,0; GOTO 0340
0322 IF ERR<>0 THEN GOTO 1850
0325 MSGBOX "File Is in Use: EI0"+E1$,"** Warning **","RETRYCANCEL,!",SEL$
0326 IF SEL$="RETRY" THEN GOTO 0310 ELSE CMD_STR$="END"; RETURN 
0330 GOTO 1850
0340 _EI1=HFN; OPEN (_EI1,ERR=0350)"EI1"+E1$; CLOSE (_EI1); GOTO 0365
0350 IF ERR=12 THEN DIRECT "EI1"+E1$,4,0,280,0,0; GOTO 0365
0352 IF ERR<>0 THEN GOTO 1850
0354 MSGBOX "File Is in Use","** Warning **","RETRYCANCEL,!",SEL$
0355 IF SEL$="RETRY" THEN GOTO 0340 ELSE CMD_STR$="END"; RETURN 
0360 GOTO 1850
0370 REM "Files - cwj 6/22/98 mod to 510 ssp#091686 adding E1$
0380 Z$="01O EI0"+E1$+"  02O EI1"+E1$+"  04O AR3...  05O ARA...  06O FSA...  07O FSD...  13O ZZPARM  "
0385 EI0$=FIN(Z(1),"FILENAME"),EI1$=FIN(Z(2),"FILENAME")
0390 GOSUB 2100; ON Z0 GOTO 0395,2130
0400 READ (Z[13],KEY=X3$(9,3)+"A/R")P0$
0410 READ (Z[1],KEY="",DOM=0415)P$
0420 READ (Z[13],KEY="STATAR3")S5$
0430 REM "
0440 A9$=P0$(7,6)
0450 GOSUB 1730
0460 REM "
0470 GOSUB 1420; GOSUB 1480
0472 GOSUB LOAD_FISCAL_YEAR
0475 RETURN 
0480 GOTO 0510
0490 REM "
0500 CALL "ZZPROM","0",X3$,Z,"Proceed with gathering of data for Executive Information System","","V",X0; ON Z GOTO 0670,2130,0510
0510 REM "DATA SEQ
0520 C0=0,X0=-1,X1=1
0530 SETERR 1850; X$="",Q$="",C0=ABS(C0),X0=X0+1; IF C0=2 THEN IF X0>0 THEN X0=X0-2
0540 IF INT(C0)=3 THEN GOSUB 1725 ELSE IF C0>3 OR X0<0 THEN GOTO 0490
0550 IF V9<>-2 THEN IF 6*(X0+K1)+5<LEN(V9$) THEN IF V9$((X0+K1)*6+5,1)="3" THEN GOTO 0530 ELSE IF V9$((X0+K1)*6+5,1)="2" AND C0<>2 THEN GOTO 0530
0560 IF X0<LEN(V7$) THEN V7$(X0+1,1)=""
0570 ON X0 GOTO 0580,0620,0490
0580 SELECT_FISCAL_YEAR:
0585 IF LEN(START_FISCAL$)>4 THEN START_FISCAL$=CR_YEAR$,A9$(1,4)=CR_YEAR$
0587 IF LEN(START_ACCTPD$)>2 THEN START_ACCTPD$=CR_PD$,A9$(5,2)=CR_PD$
0590 A9$(1,4)=START_FISCAL$ ! CALL "ZZENTR","Z",A{ALL},A9$,X4$,X3$,18,6,1,4,C0,"","{3"+X$,"","EI2UAA02","","",""
0600 GOSUB 1730; GOSUB 1420; GOSUB 1480; IF G$="" THEN NEXT_ID=START_FISCAL.CTL
0605 REFRESH_FLG=1
0610 RETURN 
0620 SELECT_ACCOUNTING_PERIOD:
0630 A9$(5,2)=START_ACCTPD$ ! CALL "ZZENTR","Z",A{ALL},A9$,X4$,X3$,43,6,5,2,C0,"","{3"+X$,"","EI2UAA04","","",""
0640 IF A9$(5,2)<"01" OR A9$(5,2)>"13" THEN GOTO 0630
0650 GOSUB 1760; GOSUB 1780
0655 REFRESH_FLG=1
0660 RETURN 
0670 REM "Start Gathering of Statistics
0675 PROCEED:
0680 PRINT 'DIALOGUE'(15,10,50,5,X1$),'CS',@(0,0),"Gathering of Statistics in Progress........",; WAIT 1
0690 CALL "ZZINIT",ERR=*NEXT,STR(Z[1]:"00")+STR(Z[2]:"00")
0691 IF FN%FID$(Z(1),ERR=*NEXT)<>"" THEN GOTO 0693 ! ([205703]-changed FID() to FN%FID$()
0692 OPEN (Z(1))"EI0"+E1$
0693 IF FN%FID$(Z(2),ERR=*NEXT)<>"" THEN GOTO 0700 ! [205703]-changed FID() to FN%FID$()
0694 OPEN (Z(2))"EI1"+E1$
0700 REM "Set up records in EI0 from Salesperson file
0710 READ (Z[4],KEY="",DOM=0715)
0720 READ (Z[4],END=0890)IOL=0220
0730 DIM A$(50),A[7]
0740 A$(1,4)=D$(1,4),A$(5,2)=D$(235,2)
0750 REM "Invoiced Orders - Sales
0760 F0=Z[5],S9$=S5$,Q1$=D$(1,4)+A9$(1,4),Q0$="S"; GOSUB 1630
0770 A[4]=A[0]+P[1],A[6]=A[2]+P[0]
0780 REM "Invoiced Orders - Profit
0790 Q0$="P"; GOSUB 1630
0800 A[5]=A[5]+P[1],A[7]=A[7]+P[0]
0810 REM "Orders Booked - Sales
0820 Q0$="B"; GOSUB 1630
0830 A[0]=A[0]+P[1],A[2]=A[2]+P[0]
0840 REM "Orders Booked - Profit
0850 Q0$="D"; GOSUB 1640
0860 A[1]=A[1]+P[1],A[3]=A[3]+P[0]
0870 WRITE (Z[1],KEY=A$(1,4))IOL=0200
0880 GOTO 0720
0890 REM "Obtain Booking from FSA Daily booking file (What about F(8)?)
0900 DIM F[8],A$(50)
0910 READ (Z[6],KEY="",DOM=0915)
0920 K$=KEY(Z[6],END=1050); READ (Z[6],KEY=K$)IOL=0230
0930 IF K$<>MID(F$,1,LEN(K$)) THEN GOTO 0920 ! SSP 206929
0940 IF F$(3,6)>G1$ THEN GOTO 0920
0950 FOR I=0 TO 4
0960 IF POS(" "<>F$(28+I*4,4))=0 OR F[I]=0 THEN GOTO 0990
0970 IF F$(28+I*4,4)<>A$(1,4) THEN GOSUB 1010
0980 X=F[5]*F[I]*.01,A[0]=A[0]+X,A[2]=A[2]+X,I1=F[6]*F[I]*.01,A[1]=A[1]+X-I1,A[3]=A[3]+X-I1
0990 NEXT I
1000 GOTO 0920
1010 REM 
1020 IF A$(1,4)<>DIM(4) THEN WRITE (Z[1],KEY=A$(1,4))IOL=0200
1030 IF F$<>"END" THEN DIM A$(50),A[7]; READ (Z[1],KEY=F$(28+I*4,4),DOM=1035)IOL=0200
1040 RETURN 
1050 REM "END OF FSA
1060 F$="END"; GOSUB 1010
1070 REM "Obtain Booking from FSD Monthly Order Booking
1080 DIM F[1],A$(0)
1090 READ (Z[7],KEY="",DOM=1095)
1100 KEY$=KEY(Z[7],END=1200); READ (Z[7],KEY=KEY$)IOL=0240
1110 IF KEY$<>F$(1,LEN(KEY$)) THEN GOTO 1100
1120 IF F$(7,6)>G1$ OR F$(3,1)="z" THEN GOTO 1100
1130 IF A$="" OR F$(3,4)<>A$(1,4) THEN GOSUB 1160
1140 A[0]=A[0]+F[0],A[1]=A[1]+F[0]-F[1],A[2]=A[2]+F[0],A[3]=A[3]+F[0]-F[1]
1150 GOTO 1100
1160 REM "Only update when salesperson changes
1170 IF A$<>"" THEN WRITE (Z[1],KEY=A$(1,4))IOL=0200
1180 IF F$<>"END" THEN DIM A$(50),A[7]; READ (Z[1],KEY=F$(3,4),DOM=1185)IOL=0200
1190 RETURN 
1200 REM "END OF FSD
1210 F$="END"; GOSUB 1160
1220 REM "Build Division Totals in EI1
1230 READ (Z[1],KEY="",DOM=1235)
1240 READ (Z[1],END=1320)IOL=0200
1250 DIM B$(50),B[7]; B$(1,2)="00",B$(3,2)=A$(5,2)
1260 READ (Z[2],KEY=B$(1,4),DOM=1265)IOL=0210
1270 FOR I=0 TO 7
1280 B[I]=B[I]+A[I]
1290 NEXT I
1300 WRITE (Z[2],KEY=B$(1,4))IOL=0210
1310 GOTO 1240
1320 REM "END
1330 DIM P$(50)
1340 P$(1,6)=A9$,P$(7,6)=G1$,P$(13,6)=X3$(21,6)
1345 TO_DAY$=FN%NTD$(JUL(0,0,0),"YYYYMMDD"),TO_DAY$=CHR(NUM(TO_DAY$(1,3))-125)+TO_DAY$(4)
1350 P$(19,5)=STR(INT(TIM):"00")+":"+STR(FPT(TIM)*60:"00"),P$(13,6)=TO_DAY$
1360 P$(24,3)=X3$(40,3),P$(27,2)=FID(0)
1370 REM "End
1375 TO_DAY$=DTE(0:"%Yl%Mz%Dz"); CALL "ZZWDTE",TO_DAY$,BB$,CC$
1380 IF E0$(7,1)="Y" THEN P$(29,3)=X3$(9,3); REM "cwj 6/22/98 ssp#091686
1390 WRITE (Z[1],KEY="")P$
1400 WRITE (Z[2],KEY="")P$
1410 GOTO 2130
1420 REM "BACKGROUND
1430 ! PRINT (0,ERR=1435)'SB',
1440 GOSUB 1810
1450 ! PRINT @(5,6),"Fiscal Year:",@(24),"Accounting Period:",
1460 ! PRINT (0,ERR=1465)'SF',
1470 RETURN 
1480 REM "DISPLAY DATA
1490 GOSUB 1600
1500 ML_FISCAL_YEAR$=A9$(1,4),ML_ACCTPD$=A9$(5,2) ! PRINT @(18,6),A9$(1,4),@(43,6),A9$(5,2),
1510 GOSUB 1780
1520 RETURN 
1530 REM "WHOLE SCREEN
1540 IF C9=0 THEN IF ABS(C0)=17 THEN GOTO 1625
1550 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
1560 GOSUB 1420
1570 IF C9>0 THEN GOSUB 1480 ELSE GOSUB 1600
1580 IF ABS(C0)>4 THEN C0=ABS(C0)-5
1590 RETURN 
1600 REM "DISPLAY KEYS
1610 IF C9<0 THEN GOTO 1590
1620 RETURN 
1630 REM "Read stats (Packed/Unpacked), P(0)=YTD,P(1)=MTD
1640 DIM K[14],P[1]
1650 Q=POS(Q0$=S9$(49),17); IF Q=0 THEN GOTO 1710 ELSE M0$=S9$(Q+48,17)
1660 CALL "ZZPACK",X3$,"R",M0$(3,2),"",0,0,K{ALL},F0,Q0$,Q1$,S9$
1670 FOR I=0 TO NUM(A9$(5,2))
1680 P[0]=P[0]+K[I]
1690 NEXT I
1700 P[1]=K[NUM(A9$(5,2))]
1710 RETURN 
1720 RETURN 
1730 REM "Period Ending Date
1740 G$=""
1750 FIND (Z[13],KEY=X3$(9,3)+"G/LYE"+A9$(1,4),DOM=1755)G$
1760 G1$=G$(15+NUM(A9$(5,2))*6,6)
1765 ML_ENDING$=FND$(G1$) ! PRINT @(46,6),"ending ",FND$(G1$),
1770 RETURN 
1780 REM 
1790 ML_ENDING$=FND$(G1$) ! PRINT @(46,6),"ending ",FND$(G1$),
1800 RETURN 
1810 REM "Date upated data
1820 IF LEN(P$)<50 THEN GOTO 1840
1830 ! PRINT @(0,3),'CE',@(3,3),"Current data for Fiscal Year: ",P$(1,4),"  Accounting Period: ",P$(5,2)," ending ",FND$(P$(7,6)),@(3,4),"Last updated: ",FND$(P$(13,6))," at ",P$(19,5)," by ",P$(24,3)," on terminal: ",P$(27,2),@(0,5),Z0$,
1835 ML_CURR_FISCAL_YEAR$=P$(1,4),ML_CURR_ACCTPD$=P$(5,2),ML_CURR_ENDING$=FND$(P$(7,6)),ML_LAST_UPDATE$=FND$(P$(13,6)),ML_TIME$=P$(19,5),ML_BY$=P$(24,3),ML_TERMINAL$=P$(27,2),REFRESH_FLG=1
1840 RETURN 
1850 REM "ERROR PROCESSING
1860 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 2060
1870 SETERR 1880; Y8$=LST(PGM(Y6))
1880 SETERR 1850
1890 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
1900 REM 
1910 ON Y7 GOTO 1930,1980,2125,1940,1970
1920 REM 
1930 RETRY 
1940 SETERR 1960
1950 EXECUTE Y7$
1960 SETERR 1850; RETRY 
1970 SETERR 0000; RETRY 
1980 REM " TRANSFER CONTROL
1990 ON Y8 GOTO 2130,0455,2145
2000 GOTO 0455
2010 GOTO 2125
2020 SETESC 2050
2030 SETERR 2050
2040 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
2050 SETERR 1850; SETESC 2020; RETURN 
2060 REM "CTRL LOGIC
2070 SETERR 1850; GOSUB 1530
2080 ON C9 GOTO 0485,0570
2090 RETURN 
2100 REM "FILES
2110 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
2120 RETURN 
2130 REM "END PROGRAM
2131 PRINT 'POP',
2135 END_PROG:
2140 FOR XXX=0 TO NUM(X3$(60,3))
2142 IF Z(XXX)<>0 THEN CLOSE (Z(XXX),ERR=*NEXT)
2143 NEXT XXX
2144 CLOSE (_EI0,ERR=*NEXT)
2145 CLOSE (_EI1,ERR=*NEXT)
2146 CLOSE (ZZPARM,ERR=*NEXT)
2150 RETURN 
2160 SETESC 2050
2170 RUN "ZMENU"
2180 END 
9999 END 
18000 NO_PARAMETER:
18010 MSGBOX MSG("NOPARAM")+SEP+SEP+MSG("WISH_RUN"),MSG("WARNING"),"?,YESNO",OPT$
18020 IF OPT$="NO" THEN CMD_STR$="E"; EXIT 
18030 PROCESS "EIGMPA","../EIG/EI.EN"
18040 GOTO 0290
23010 LOAD_FISCAL_YEAR:
23020 ZZPARM=HFN
23030 OPEN (ZZPARM)"ZZPARM"
23035 READ (ZZPARM,KEY=%C$+"G/L",DOM=*NEXT)GL_REC$; CR_YEAR$=A9$(1,4),CR_PD$=A9$(5,2) ! SSP#265569
23040 KE$=%C$+"G/LYE",START_FISCAL$=""
23050 READ (ZZPARM,KEY=KE$,DOM=*NEXT)
23060 K$=KEY(ZZPARM,END=23100); READ (ZZPARM)
23070 IF LEN(K$)<8 OR KE$<>K$(1,8) THEN GOTO END_LOAD_FISCAL_YEAR
23080 START_FISCAL$=START_FISCAL$+K$(9)+"/"
23090 GOTO 23060
23100 END_LOAD_FISCAL_YEAR:
23105 DROP_BOX LOAD START_FISCAL.CTL,START_FISCAL$
23110 DROP_BOX WRITE START_FISCAL.CTL,CR_YEAR$
23150 FOR ACCT=1 TO 12; START_ACCTPD$=START_ACCTPD$+STR(ACCT:"00")+"/"; NEXT ACCT
23160 DROP_BOX LOAD START_ACCTPD.CTL,START_ACCTPD$
23170 DROP_BOX WRITE START_ACCTPD.CTL,CR_PD$
23180 END_ACCTPD$=START_ACCTPD$
23210 RETURN 
56000 ! "206929-PE(047, EIGUAA-0925) when in Executive Sales.               
56001 REM "265569-EIGUAA-Gather S/person Division Data - Default Fiscal Year   and Period is looking at GL params, rather than AR Params 
