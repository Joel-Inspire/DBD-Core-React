0010 REM "Convert Customer File <UTGAR1>
0015 REM CALLED FROM ZZGIMP
0035 REM "5.7 - 09/29/15 - 15.898333 - dmm - SSP# 280030
0037 REM "280030-AR1 file import, CUST_STAT field, trying to change to X     
0040 REM "Copyright 2015 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0042 REM "Sales tax map numeric overrides customer tax exempt question
0080 PROCESS "UTGAR1","../UTG/UT.EN"
0090 EXIT 
0100 INIT:
0110 X0$="UTGAR1"
0120 DIM Z0$(80,"-"),Z1$(20,"0"),S0$(1000)
0122 DIM M$(9,"0")
0125 X3$=%X3$,X4$=%X4$
0127 DIM A[15],B[1],D[3],E[2]
0130 K0=20,K1=1
0200 REM "
0300 REM "IOLISTS
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14]
0320 IOLIST B$,B[0],B[1]
0330 IOLIST C$
0340 IOLIST D$,D[0],D[1],D[2],D[3]
0350 IOLIST E$,E[0],E[1],E[2]
0360 IOLIST DFLTS$,DFLTS[0],DFLTS[1],DFLTS[2],DFLTS[3]
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="02O AR1...  03O FMP...  04O AR1... 05O ARG...  06O AR5...  07O AR3...  080 AR2...  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0525 AR1S=UNT; OPEN (AR1S,ERR=9900)"AR1.SRT"
0535 READ (Z[13],KEY=X3$(9,3)+"A/R")P0$
0600 REM "
0610 OLD_CAT$="",NEW_CAT$=""
0615 OLD_TAX$="",NEW_TAX$=""
0620 OLD_REP$="",NEW_REP$=""
0625 OLD_TRM$="",NEW_TRM$=""
0950 ADDR "CA2CVT"
0980 ! CALL "$CTL-10;PB_CREATE",0,0,17,1.4,20,1,0   SSP#249543
0990 RETURN 
1000 MAIN_POST_DISPLAY:
1001 GOTO 5000
1010 KY$=KEY(AR1S,END=5000); READ (AR1S)
1050 READ (Z[2],KEY=KY$,DOM=1010)IOL=0310
1060 CUSTOMER$=A$(1,10),CUST_NAME$=A$(11,35)
1090 ++COUNT; CALL "$CTL-10;PB_VALUE",COUNT
1180 GOSUB 2000
1300 REM "Display progress every 2%
1900 GOTO 1000
2000 PROCESS_FILE:
2010 SHOW_CAT$="N",SHOW_TAX$="N",SHOW_REP$="N",SHOW_TRM$="N"; GOSUB ENABLE_GROUPS
2100 REM DIVISION
2110 ! A$(1,2)="00",A$(46,2)="00" ! SSP#250484
2225 REM "Alternate Bill-to
2230 IF STP(A$(46,10),3," ")<>"" THEN {
2235 READ (Z[4],KEY=A$(46,10),DOM=*NEXT); GOTO 2240
2237 READ (Z[4],KEY="00"+A$(48,8),DOM=*NEXT); GOTO 2240
2238 A$(46,10)=DIM(10)
2239  }
2340 REM "Zip code
2345 IF STP(A$(134,9),3," ")<>"" THEN Q$=A$(134,9); CALL "CA2CVT",X3$,X4$,"Z0",Q$,0,X$,0,"",0; A$(134,9)=X$
2360 REM "Fax number
2365 IF STP(A$(143,10),3," ")<>"" THEN Q$=A$(143,10); CALL "CA2CVT",X3$,X4$,"P0",Q$,0,X$,0,"",0; A$(143,10)=X$
2390 REM "Lookup Sequence
2400 IF STP(A$(155,10),3," ")="" THEN TMP$=STP(UCS(CVS(A$(11,35),16)),0); IF LEN(TMP$)>4 AND TMP$(1,4)="THE " THEN TMP$=TMP$(5)
2410 IF STP(A$(155,10),3," ")="" THEN TMP$=PAD(TMP$,10); A$(155,10)=TMP$
2460 REM "Phone Number (205,14)=Phone number + Extension
2465 IF STP(A$(205,10),3," ")<>"" THEN Q$=A$(205,10); CALL "CA2CVT",X3$,X4$,"P0",Q$,0,X$,0,"",0; A$(205,10)=X$
2490 REM "Phone Extension
2500 REM "Customer Status
2505 IF POS(A$(219,1)="AaIiX")=0 THEN A$(219,1)="A" ! SSP280030
2507 %CUST_CAT_LEN=NUM(P0$(20,1))
2510 NOF=1; FIND (Z[5],KEY=A$(220,9),DOM=*NEXT); NOF=0
2512 IF NOF THEN XP=POS(A$(220,9)=OLD_CAT$); IF XP<>0 THEN A$(220,9)=NEW_CAT$(XP,9),NOF=0
2515 IF NOF THEN {
2532 NEXT_ID=NEW_CUST_CAT.CTL,OLD_CUST_CAT$=A$(220,9); SHOW_CAT$="Y"; GOSUB ENABLE_GROUPS; RETURN 
2535 SELECT_NEW_CUST_CAT:
2537 UTGAR1_VAL$=NEW_CUST_CAT$; SHOW_CAT$="N"; GOSUB ENABLE_GROUPS
2540 FIND (Z[5],KEY=UTGAR1_VAL$,DOM=2510); OLD_CAT$=OLD_CAT$+A$(220,9); NEW_CAT$=NEW_CAT$+UTGAR1_VAL$; A$(220,9)=UTGAR1_VAL$
2550  }
2570 REM "Date Account Opened
2575 IF STP(A$(229,6),3)<>"" THEN Q$=A$(229,6); CALL "CA2CVT",X3$,X4$,"D2",Q$,0,X$,0,"",0; A$(229,6)=X$
2610 REM "Sales Tax Code
2615 NOF=1; READ (Z[6],KEY=A$(235,10),DOM=*NEXT); NOF=0
2617 IF NOF THEN XP=POS(A$(235,10)=OLD_TAX$); IF XP<>0 THEN A$(235,10)=NEW_TAX$(XP,10); NOF=0
2620 IF NOF THEN {
2632 NEXT_ID=NEW_TAX_CODE.CTL,OLD_TAX_CODE$=A$(235,10); SHOW_TAX$="Y"; GOSUB ENABLE_GROUPS; RETURN 
2635 SELECT_NEW_TAX_CODE:
2637 UTGAR1_VAL$=NEW_TAX_CODE$; SHOW_TAX$="N"; GOSUB ENABLE_GROUPS
2640 FIND (Z[6],KEY=UTGAR1_VAL$,DOM=2610); OLD_TAX$=OLD_TAX$+A$(235,10),NEW_TAX$=NEW_TAX$+UTGAR1_VAL$; A$(235,10)=UTGAR1_VAL$
2649  }
2650 REM "Customer Tax Exempt?
2670 IF A$(245,1)<>"Y" THEN A$(245,1)="N"
2720 REM "Finance Charge Code
2730 IF POS(A$(267,1)=" Yy")>0 THEN A$(267,1)="Y" ELSE A$(267,1)="N"
2740 REM "Statement Code
2750 IF POS(A$(268,1)=" Yy")>0 THEN A$(268,1)="Y" ELSE A$(268,1)="N"
2800 REM "Salesperson Code #1
2810 NOF=1; FIND (Z[7],KEY=A$(278,4),DOM=*NEXT); NOF=0
2812 IF NOF THEN XP=POS(A$(278,4)=OLD_REP$); IF XP<>0 THEN A$(278,4)=NEW_REP$(XP,4),NOF=0
2815 IF NOF THEN {
2832 REP_COUNT=0,NEXT_ID=NEW_REP_CODE.CTL,OLD_REP_CODE$=A$(278,4); SHOW_REP$="Y"; GOSUB ENABLE_GROUPS; RETURN 
2837 UTGAR1_VAL$=NEW_REP_CODE$; SHOW_REP$="N"; GOSUB ENABLE_GROUPS
2840 FIND (Z[7],KEY=UTGAR1_VAL$,DOM=2810); OLD_REP$=OLD_REP$+A$(278,4),NEW_REP$=NEW_REP$+UTGAR1_VAL$; A$(278,4)=UTGAR1_VAL$
2850  }
2855 REM "Salesperson Code #2
2860 NOF=1; FIND (Z[7],KEY=A$(282,4),DOM=*NEXT); NOF=0
2861 IF STP(A$(282,4),3," ")="" THEN NOF=0
2862 IF NOF THEN XP=POS(A$(282,4)=OLD_REP$); IF XP<>0 THEN A$(282,4)=NEW_REP$(XP,4),NOF=0
2865 IF NOF THEN {
2870 REP_COUNT=1,NEXT_ID=NEW_REP_CODE.CTL,OLD_REP_CODE$=A$(282,4); SHOW_REP$="Y"; GOSUB ENABLE_GROUPS; RETURN 
2885 UTGAR1_VAL$=NEW_REP_CODE$; SHOW_REP$="N"; GOSUB ENABLE_GROUPS
2887 UTGAR1_VAL$=PAD(UTGAR1_VAL$,4)
2890 FIND (Z[7],KEY=UTGAR1_VAL$,DOM=2860); OLD_REP$=OLD_REP$+A$(282,4),NEW_REP$=NEW_REP$+UTGAR1_VAL$; A$(282,4)=UTGAR1_VAL$
2899  }
2910 NOF=1; FIND (Z[7],KEY=A$(286,4),DOM=*NEXT); NOF=0
2911 IF STP(A$(286,4),3," ")="" THEN NOF=0
2912 IF NOF THEN XP=POS(A$(286,4)=OLD_REP$); IF XP<>0 THEN A$(286,4)=NEW_REP$(XP,4),NOF=0
2915 IF NOF THEN {
2932 REP_COUNT=2,NEXT_ID=NEW_REP_CODE.CTL,OLD_REP_CODE$=A$(286,4); SHOW_REP$="Y"; GOSUB ENABLE_GROUPS; RETURN 
2935 UTGAR1_VAL$=NEW_REP_CODE$; SHOW_REP$="N"; GOSUB ENABLE_GROUPS
2937 UTGAR1_VAL$=PAD(UTGAR1_VAL$,4)
2940 FIND (Z[7],KEY=UTGAR1_VAL$,DOM=2910); OLD_REP$=OLD_REP$+A$(286,4),NEW_REP$=NEW_REP$+UTGAR1_VAL$; A$(286,4)=UTGAR1_VAL$
2950  }
2960 NOF=1; FIND (Z[7],KEY=A$(290,4),DOM=*NEXT); NOF=0
2961 IF STP(A$(290,4),3," ")="" THEN NOF=0
2962 IF NOF THEN XP=POS(A$(290,4)=OLD_REP$); IF XP<>0 THEN A$(290,4)=NEW_REP$(XP,4),NOF=0
2965 IF NOF THEN {
2972 REP_COUNT=3,NEXT_ID=NEW_REP_CODE.CTL,OLD_REP_CODE$=A$(290,4); SHOW_REP$="Y"; GOSUB ENABLE_GROUPS; RETURN 
2975 UTGAR1_VAL$=NEW_REP_CODE$; SHOW_REP$="N"; GOSUB ENABLE_GROUPS
2977 UTGAR1_VAL$=PAD(UTGAR1_VAL$,4)
2990 FIND (Z[7],KEY=UTGAR1_VAL$,DOM=2960); OLD_REP$=OLD_REP$+A$(290,4),NEW_REP$=NEW_REP$+UTGAR1_VAL$; A$(290,4)=UTGAR1_VAL$
2999  }
3010 NOF=1; FIND (Z[7],KEY=A$(294,4),DOM=*NEXT); NOF=0
3011 IF STP(A$(294,4),3," ")="" THEN NOF=0
3012 IF NOF THEN XP=POS(A$(294,4)=OLD_REP$); IF XP<>0 THEN A$(294,4)=NEW_REP$(XP,4),NOF=0
3015 IF NOF THEN {
3032 REP_COUNT=4,NEXT_ID=NEW_REP_CODE.CTL,OLD_REP_CODE$=A$(294,4); SHOW_REP$="Y"; GOSUB ENABLE_GROUPS; RETURN 
3035 UTGAR1_VAL$=NEW_REP_CODE$; SHOW_REP$="N"; GOSUB ENABLE_GROUPS
3037 UTGAR1_VAL$=PAD(UTGAR1_VAL$,4)
3040 FIND (Z[7],KEY=UTGAR1_VAL$,DOM=3010); OLD_REP$=OLD_REP$+A$(294,4),NEW_REP$=NEW_REP$+UTGAR1_VAL$; A$(294,4)=UTGAR1_VAL$
3042  } ! SSP 230532
3050 IF FNS(A$(298,20))=0 THEN A$(298,20)=A$(165,20)
3080 IF FNS(A$(310,20))=0 THEN A$(310,20)=A$(185,20)
3130 IF STP(A$(338,14),3," ")<>"" THEN Q$=A$(338,14); CALL "CA2CVT",X3$,X4$,"P0",Q$,0,X$,0,"",0; A$(338,14)=X$
3140 IF FNS(A$(338,14))=0 THEN A$(338,14)=A$(205,14)
3180 REM "Date of Last Dun Letter
3190 IF STP(A$(353,6),3," ")<>"" THEN Q$=A$(353,6); CALL "CA2CVT",X3$,X4$,"D0",Q$,0,X$,0,"",0; A$(353,6)=X$
3200 REM "Terms Code
3210 NOF=1; FIND (Z[8],KEY=A$(359,2),DOM=*NEXT); NOF=0
3212 IF NOF THEN XP=POS(A$(359,2)=OLD_TRM$); IF XP<>0 THEN A$(359,2)=NEW_TRM$(XP,2),NOF=0
3215 IF NOF THEN {
3232 NEXT_ID=NEW_TERMS_CODE.CTL,OLD_TERMS_CODE$=A$(359,2); SHOW_TRM$="Y"; GOSUB ENABLE_GROUPS; RETURN 
3235 UTGAR1_VAL$=NEW_REP_CODE$; SHOW_REP$="N"; GOSUB ENABLE_GROUPS
3237 UTGAR1_VAL$=PAD(UTGAR1_VAL$,2)
3240 FIND (Z[8],KEY=UTGAR1_VAL$,DOM=3210); OLD_TRM$=OLD_TRM$+A$(359,2),NEW_TRM$=NEW_TRM$+UTGA1_VAL$; A$(359,2)=UTGAR1_VAL$
3250  }
3300 IF STP(A$(367,6),3," ")<>"" THEN Q$=A$(367,6); CALL "CA2CVT",X3$,X4$,"D2",Q$,0,X$,0,"",0; A$(367,6)=X$ ! SSP#247834
3320 IF STP(A$(373,6),3," ")<>"" THEN Q$=A$(373,6); CALL "CA2CVT",X3$,X4$,"D2",Q$,0,X$,0,"",0; A$(373,6)=X$ ! SSP#247834
3350 REM "Last Active Date
3360 IF STP(A$(379,6),3," ")<>"" THEN Q$=A$(379,6); CALL "CA2CVT",X3$,X4$,"D2",Q$,0,X$,0,"",0; A$(379,6)=X$ ! SSP#247834
3380 REM "High Credit Date
3385 IF STP(A$(385,6),3," ")<>"" THEN Q$=A$(385,6); CALL "CA2CVT",X3$,X4$,"D2",Q$,0,X$,0,"",0; A$(385,6)=X$ ! SSP#247834
3420 IF A$(397,1)=" " THEN A$(397,1)="Y"
3430 REM "Customer Price Category
3500 IF A[0]=0 THEN A[0]=100
3510 REM "Salesperson 2 Commission Split
3511 GOTO 4000 ! SSP#247834
3512 IF STP(R$(461,15),3," ")="" THEN GOTO 3530
3520 Q$=R$(461,15); GOSUB 7650; A[1]=X
4000 REM "Build Customer Default Record
4020 B$=""; DIM DFLTS[3]
4025 REM 'GET DEFAULTS
4027 READ (Z[13],KEY="DFLTFM2SHA",DOM=4800)IOL=0360
4030 B$="Y"; DFLTS$(1,11)="D"+A$(1,10)
4035 GOTO 4800
4050 REM "Finder's Fee Vendor Code
4060 IF FNS$(R$(542,10))="" OR FNU$(R$(542,10))="" THEN GOTO 4200
4070 DIM X$(100); X$(1)="AP4 "+R$(542,10)
4080 FIND (Z[12],KEY=X$(1,24))X$
4090 B$(13,10)=X$(25,10)
4100 REM "Finder's Fee Type
4110 B$(12,1)="S"
4120 REM "Finder's Fee Percentage
4130 CALL "CA2CVT",X3$,X4$,P9$(5,2),R$(812,4),0,X$,X,"",0; A[0]=X
4200 REM "Customer P/O Required?
4210 IF R$(276,1)="Y" THEN B$(25,1)="Y"
4900 REM "Write file(s)
4910 WRITE (Z[2],KEY=A$(1,10))IOL=0310; C2=C2+1
4920 IF B$="" THEN GOTO 4990
4930 WRITE (Z[3],KEY=DFLTS$(1,11))IOL=0360; C3=C3+1
4990 RETURN 
5000 REM "EOJ
5010 GOSUB 5200
5050 F$=DTE(0:"%Y%Mz%Dz%Hz%mz%s")
5060 CLOSE (AR1S)
5070 RENAME "AR1.SRT","AR1.SRT"+F$
5080 ! INVOKE "cp "+%FILE_NEW$+" "+%FILE_NEW$+F$; REM before file SSP230532
5085 ! INVOKE "cp "+%FL_NAME$+" "+%FL_NAME$+F$; REM after file SSP230532
5095 GOTO WRAP_UP
5200 REM "COMPLETE CYCLE
5210 CALL "AR2UT8",X3$,"","","*"
5220 REM CALL "CA2AR6",X3$,"","","*"
5230 REM CALL "AR2UT4",X3$,"","","*"
5240 REM CALL "AR2UT6",X3$,"","","*"
5250 REM CALL "AR2UTD",X3$,"","","*"
5290 RETURN 
7000 SELECT_NEW_REP_CODE:
7010 ON REP_COUNT GOTO 2835,2885,2935,2975,3035
7400 CALL_PANEL:
7405 %ABORT=0
7410 PROCESS "UTGAR1.1","../UTG/UT.EN"
7420 UTGAR1_VAL$=%UTGAR1_VAL$
7430 IF %RESTORE_FILE=0 THEN CMD_STR$=""
7490 RETURN 
7500 REM "Generalized Mapping
7510 X=0
7520 FIND (Z[12],KEY=X$(1,24),DOM=7521)X$,X; A$(I1,I2)=X$(25,I2); GOTO 7590
7560 X$(25)=Q$; WRITE (Z[12],KEY=X$(1,24))X$; GOTO 7520
7590 RETURN 
7600 REM "Generalized Date conversion
7610 IF FNS$(Q$)="" THEN X$=""; GOTO 7640
7620 CALL "CA2CVT",X3$,X4$,P9$(1,2),Q$,0,X$,0,"",0
7640 RETURN 
7650 REM "Generalized Numeric conversion
7660 IF STP(Q$,1)="" THEN X$="",X=0; GOTO 7690
7670 CALL "CA2CVT",X3$,X4$,P9$(5,2),Q$,0,X$,X,"",0
7690 RETURN 
7700 REM "Salesperson's Map
7705 REM 'IF FNS$(Q$)="" THEN RETURN
7710 DIM X$(100); X$(1)="AR3 "+Q$
7715 IF R$(1,1)="M" THEN X$(1)="AR3 "+"M"+Q$
7720 GOTO 7500
7800 REM "Convert Zip Code
7810 CALL "CA2CVT",X3$,X4$,P9$(7,2),Q$,0,X$,0,"",0
7840 RETURN 
8000 REM "AR1 Duplicate File
8010 I8$=STR(NUM(I8$)+1:"0000")
8020 WRITE (Z[11],KEY=R$(1,15)+I8$)R$
8040 RETURN 
8600 REM " CUSTOM SPECIFIC DEFAULTS
8695 RETURN 
8910 DEF FND$(Z9$)=Z9$(3,2)+"/"+Z9$(5,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8920 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
8925 DEF FNU$(Z9$)=Z9$(1,POS("000"=Z9$+"000")-1)
8930 DEF FNQ$(Z9$,Z9)=STR(NUM(Z9$):Z1$(1,Z9))
8940 DEF FNE$(Z9)=CHR(ASC("A")+INT(Z9/10))+STR(MOD(Z9,10))
8950 DEF FNS(Z9$)=POS(" "<>Z9$)
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 GOTO 1010
9800 SELECT_EXIT:
9810 %RESTORE_FILE=1
9900 WRAP_UP:
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 DROP "CA2CVT",ERR=9921
9950 CMD_STR$="END"
9990 RETURN 
9999 END 
55000 ENABLE_GROUPS:
55010 IF SHOW_CAT$="Y" THEN CALL "*wingrp;show",CAT.GRP$; SHOW_CAT$=""
55020 IF SHOW_CAT$="N" THEN CALL "*wingrp;hide",CAT.GRP$; SHOW_CAT$=""
55030 IF SHOW_TAX$="Y" THEN CALL "*wingrp;show",TAX.GRP$; SHOW_TAX$=""
55040 IF SHOW_TAX$="N" THEN CALL "*wingrp;hide",TAX.GRP$; SHOW_TAX$=""
55050 IF SHOW_REP$="Y" THEN CALL "*wingrp;show",REP.GRP$; SHOW_REP$=""
55060 IF SHOW_REP$="N" THEN CALL "*wingrp;hide",REP.GRP$; SHOW_REP$=""
55070 IF SHOW_TRM$="Y" THEN CALL "*wingrp;show",TRM.GRP$; SHOW_TRM$=""
55080 IF SHOW_TRM$="N" THEN CALL "*wingrp;hide",TRM.GRP$; SHOW_TRM$=""
55499 RETURN 
56000 ! "230532-Get error on AR1 import                                     
56002 REM "280030-AR1 file import, CUST_STAT field, trying to change to X     
