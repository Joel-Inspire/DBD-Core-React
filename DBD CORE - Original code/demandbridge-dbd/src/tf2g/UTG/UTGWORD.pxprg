0010 ! UTGWORD - Wordlink Expanded
0020 ! "6.0 - 08/09/04 - 09:08 AM - jir
0030 ! "Copyright 2004 Computer Software Inc.; Norcross, Georgia
0040 ! "        Licensed Software - All Rights Reserved.
0050 PROCESS "UTGWORD","../UTG/UT.EN"
0060 EXIT 
0100 ! 100,10
0110 INIT:
0120 _ZZP=HFN; OPEN (_ZZP)"ZZPARM"
0130 RETURN 
0500 MAIN_POST_DISPLAY:GOSUB LOAD_TEMPLATES
0510 RETURN 
0600 RETURN 
1000 ! 1000,10
1010 FIND_REC:
1020 READ (_ZZP,KEY="word"+ML_JOB_NAME$,DOM=NEW_RECORD)WORD$
1210 NEW_RECORD:
1220 MSGBOX MSG("ADD_RECORD"),MSG("CONFIRM"),"?,YESNO",_X$; IF _X$="NO" THEN NEXT_ID=OPERATOR_CODE.CTL; EXIT 
1230 GOSUB ENA_FIELDS
1290 RETURN 
1300 SEL_TEMPLATE:
1310 _TMP=HFN; OPEN (_TMP,ERR=NO_TEMPLATE)TPATH$+DB_TEMPLATE$
1500 NO_TEMPLATE:
1510 MSGBOX "Template : "+DB_TEMPLATE$+SEP+SEP+"Do you want to create",MSG("CONFIMING"),"?,YESNO",OPT$; IF OPT$="NO" THEN NEXT_ID=DB_TEMPLATE.CTL; EXIT 
2000 CREATE_DOCUMENT:
2010 CALL "[WDX]*CMDWORD;OPEN",WORD,2,CC$,DD$
2020 _TMP=HFN; IF RD_OPTION$="1" THEN OPEN (_TMP,IOL=*)"AR1"+%C$ ELSE OPEN (_TMP)"AP4"+%C$
2030 CALL PGN+";TMP_IOL",_TMP,"A",R_IOL$
2040 ERASE "[WDX]C:\TEMP_FILE.DOC",ERR=*NEXT
2050 SERIAL "[WDX]C:\TEMP_FILE.DOC",,1024
2055 _TT=HFN; OPEN LOCK (_TT)"[WDX]C:\TEMP_FILE.DOC"
2056 WRITE (_TT)QUO+R_IOL$+QUO
2060 _WD=HFN; OPEN (_WD)"[DDE]WINWORD;"
2070 WRITE RECORD (_WD)"[MailMergeCreateDataSource .Filename="+QUO+"C:\TEMP_FILE.DOC"+QUO+", .HeaderRecord="+QUO+R_IOL$+QUO+"]"
10000 ENA_FIELDS:! 10000,10
10010 CALL "*WINGRP;ENABLE",FIELDS.GRP$
10020 RETURN 
10030 DIS_FIELDS:
10040 CALL "*WINGRP;DISABLE",FIELDS.GRP$
10050 RETURN 
12000 LOAD_TEMPLATES:! 12000,10
12010 READ (_ZZP,KEY="PATH"+WHO)EXCEL$,WORDPAD$,TPATH$
12030 IF STP(TPATH$,3)>"" THEN TPATH$=%WDX$+TPATH$; GOTO 12035
12040 _MSDIR=HFN
12050 OPEN (_MSDIR,ERR=12140)TPATH$
12060 ! 
12070 SELECT TEMPLATE$ FROM _MSDIR WHERE TEMPLATE$ LIKE "*.[Dd][Oo][Tt]",ERR=*NEXT; GOTO 12090
12080 EXITTO 12140
12090 DROP_BOX LOAD DB_TEMPLATE.CTL,0,TEMPLATE$
12100 NEXT RECORD 
12110 ! 
12120 ! DROP_BOX ENABLE DB_TEMPLATE.CTL
12130 REFRESH_FLG=1
12140 CLOSE (_MSDIR,ERR=*NEXT)
12150 EXIT 
25000 ! 25000,10 ZZWIOL - Create iolist from data dictionary
25100 ! ^100,5 - Call/Enter String
25105 ! Enter channel of file with internal iolist, desired variable id
25110 ! returns iolist with variable names based on position of variable
25115 ! in string
25116 TMP_IOL:
25120 ENTER CHAN,VAR_ID$,RET_IOL$
25125 IF VAR_ID$="QRY" THEN FLAG=1,VAR_ID$=""
25130 IF NOT(CHAN) THEN EXIT 
25135 IF STP(VAR_ID$,2)="" THEN VAR_ID$="A"
25200 ! ^100,5 - Constants & functions
25205 I=0,START_POS=1,IND_NUM=1
26000 ! ^1000,5 - Main processing
26005 ! Read thru the data dictionary associated with the file to get
26010 ! field attributes
26015 ! WHILE G$<>"L" - jir
26020 DICTIONARY READ (CHAN,IND=IND_NUM,ERR=26075)A$,B$,C$,D$,E$,F$,G$
26025 ! First field doesn't need number
26030 IF I THEN VAR$=VAR_ID$+STR(I) ELSE VAR$=VAR_ID$
26035 ! Look for substring or last substring
26040 NVAR$=LST(A$),NVAR$=NVAR$(POS(" "=NVAR$)+1)
26045 IF FLAG THEN GOSUB CHECK_MSG
26050 ! Add to new iolist
26056 XX=POS("$:"=NVAR$); IF XX<>0 THEN NVAR$=NVAR$(1,XX-1)
26057 ! NVAR$=QUO+NVAR$+QUO
26060 RET_IOL$+=NVAR$+","
26065 IND_NUM++
26070 GOTO 26015 ! WEND jir
26075 ! Strip off last comma
26080 RET_IOL$=MID(RET_IOL$,1,LEN(RET_IOL$)-1)
26085 ! 9000,5 - Exit
26090 ! IF WHO="jir" THEN PRINT "----------------------"
26095 IF FLAG THEN MENS$=MID(MENS$,1,LEN(MENS$)-1),VAR_ID$=MENS$
26100 EXIT 
26105 CHECK_MSG:
26110 IF STP(C$)="" THEN C$="=MSG("+QUO+B$+QUO+")"
26115 MENS$=MENS$+C$(2)+","
26120 RETURN 
