0010 REM "Conversion Audit Report <UTGRPA>
0015 REM "Prog Type: OD-2.7     
0035 REM "5.5 - 09/07/07 - 16.456944 - jdf - SSP# 211380
0037 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 9000
0095 PRECISION 14; T2=TIM; PRECISION 2
0100 SETERR 9000; SETESC 9300
0110 X0$="UTGRPA",X1$="File Converison Audit Report"
0120 DIM A$(128),A[7],C$(170),C[21],D$(397),D[15],S[5],FILE$[120]
0140 Z0$="###,###.00-",Z1$="##,###,###.00-",Z2$="##,##0-",Z3$="##0-",Z4$="###.00-",Z5$=Z0$(1,LEN(Z0$)-1)+"#"
0210 T=1,T0=1,T1=3; REM " SSP# 143009
0215 W3=120
0225 W=999
0230 DIM T1$(W3,"-"),T2$(W3,"="),T3$(W3,"*"),Y5$(W3),Y6$(W3),W[4]
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,"",-1,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0260 CALL "ZZRPTP",X3$,X0$,X1$,V9$,V0,Q0$,Q1$,Q2$,Q3$,Q4$,Q5$,Q6$
0270 X1$="File Conversion Audit Report"
0300 REM "I/O lists
0305 REM "IOLIST FOR FS1 - FD Sales Order Header
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7]
0325 REM "IOLIST FOR FS2 - FD Sales Order Line Entry
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15],C[16],C[17],C[18],C[19],C[20],C[21]
0335 REM "IOLIST FOR AR1 - Customer Masterfile
0340 IOLIST D$,D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15]
0350 IOLIST S5$,S[0],S[1]
0360 IOLIST F$
0420 IOLIST X3$,X4$,V1$,V3$,V2$,IOL=0425
0425 IOLIST V$,V[0],V[1]
0450 IOLIST IC1$,IC1[0],IC1[1],IC1[2],IC1[3],IC1[4],IC1[5],IC1[6],IC1[7],IC1[8],IC1[9],IC1[10],IC1[11],IC1[12],IC1[13],IC1[14],IC1[15],IC1[16],IC1[17],IC1[18],IC1[19],IC1[20]
0500 REM "Files
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400
0509 REM "Z(10) reserved for Sort File
0510 Y$="01X FS1...  03O FS2...  04O AR1...  05O AR3...  06O FMN...  07O IC1...  09O FMP...  11O FT6...  16O FTO...  18O PO6...  "; Y$=Y$+"02O "+V1$+"  "
0520 GOSUB 9750
0530 GOSUB 6950
0575 READ (Z[13],KEY=X3$(9,3)+"I/C")P0$
0600 READ (Z[13],KEY=X3$(9,3)+"A/R",DOM=9900)P$
0800 REM "Alternate Sort Info & total dim"
0890 REM "Open Printer
0895 CALL "ZZPRIN",X0$,X3$,Y0$,V3$,Z{ALL},W0$,W1$,W0,W9,W2,W3,W4; ON W4 GOTO 0896,9920
0900 REM "READ THE FILE$ ARRAY
0905 J=0
0910 IF FILE$[J]<>"" THEN W=99; GOTO 1000 ELSE GOTO 5000; REM PROCESS FILE
0920 J=J+1
0930 GOTO 0910
1000 REM "OPEN FILE
1010 CLOSE (SLOT); OPEN (SLOT,ERR=5000)FILE$[J]
1020 IF V$(80,3)="AR1" THEN GOSUB 2000 ELSE IF V$(80,3)="AR6" THEN GOSUB 2200
1030 IF W>W0 THEN GOSUB 6000
1100 REM "Get record"
1110 K$=KEY(SLOT,END=0920); READ (SLOT,END=0920)
1115 IF W>W0 THEN GOSUB 6000
1120 IF V$(80,3)="AR1" THEN GOTO 3000 ELSE IF V$(80,3)="AR6" THEN GOTO 3100
1510 IF W>W0 THEN GOSUB 6000
1995 GOTO 1100
2000 REM "AR1
2005 FIELD_1$="Customer ",FIELD_2$="Customer Name"
2010 RETURN 
2200 REM " AR6
2205 FIELD_1$="Customer ",FIELD_2$="Invoice #",FIELD_3$="Invoice Date"
2210 RETURN 
3000 REM "AR1
3010 READ RECORD (Z[2],KEY=K$)AR1$
3020 DIM Y5$(79)
3025 CALL "ZZDISP","AX",AR1$(1,10),"A/R",X3$,X$,"",0,0,X4$; Y5$(1)=X$
3030 Y5$(13)=AR1$(11,35)
3040 GOSUB 7300
3099 GOTO 1100
3100 REM "AR6
3110 READ RECORD (Z[2],KEY=K$)AR6$
3120 DIM Y5$(79)
3125 CALL "ZZDISP","AX",AR6$(1,10),"A/R",X3$,X$,"",0,0,X4$; Y5$(1)=X$
3130 Y5$(13)=AR6$(11,8)
3140 Y5$(50)=FND$(AR6$(20,6))
3150 GOSUB 7300
3199 GOTO 1100
5000 REM "End of Print
5010 IF W0=99999999999999 THEN GOTO 5030; REM " SSP# 143489
5020 IF W8=0 THEN GOTO 5290
5030 T0$="END"
5050 REM "T=0; GOSUB 3100
5200 REM "
5295 GOTO 9900
6000 REM "Page header
6020 W0$=FILE$[J]
6040 CALL "ZZHEAD",X0$,X1$,X2$,X3$,W0$,W1$,W2$,W3$,W3,W,W9,W8,W0,W5,W2,W4$,W5$; ON W5 GOTO 6041,9900
6060 IF F0=0 THEN GOSUB 6100
6090 RETURN 
6100 REM "
6115 Y5$(1)=FIELD_1$,Y5$(13)=FIELD_2$,Y5$(50)=FIELD_3$
6120 GOSUB 7300
6130 GOSUB 7300; GOSUB 7300
6195 IF FID(W9)=FID(0) THEN PRINT 'SF',
6199 RETURN 
6900 REM "SORT
6950 REM GET LIST OF FILES TO PROCESS
6955 I=-1,J=0
6960 IMPORT_PATH$=%DATAPATH$+DLM
6965 SELECT AT$ FROM IMPORT_PATH$
6970 IF AT$<>"." AND AT$<>".." AND POS(V$(80,3)+".SRT"+FNX$(V$(83,6))=AT$) THEN FILE$[I+1]=AT$; I=I+1
6975 NEXT RECORD 
6980 SLOT=UNT
6985 J=0
6990 REM "IF FILE$[J]<>"" THEN PRINT J,"  ",FILE$[J] ELSE GOTO 6993
6991 REM "J=J+1
6992 REM "GOTO 6990
6993 J=0
6999 RETURN 
7000 REM "Total logic
7001 IF V$(99,1)<>"Y" THEN IF V0=2 AND T=4 THEN GOTO 7100
7003 IF T>0 AND T[T,0]<2 THEN GOSUB 7300; GOTO 7100
7004 IF V0=2 AND W+3>W0 THEN GOSUB 6200; IF T=1 THEN W=999; GOTO 7006 ELSE IF T<>1 THEN GOTO 7006
7005 IF W+3>W0 THEN GOSUB 6000
7007 IF P$(13,1)<>"Y" AND (LEN(T$)>=12 AND T$(5,8)="Division") THEN GOTO 7100
7008 IF V0=2 AND T=3 THEN Y5$(76)=T1$(1,LEN(Z1$)),Y5$(91)=T1$(1,LEN(Z0$)),Y5$(103)=T1$(1,LEN(Z0$)),Y5$(116)=T1$(1,LEN(Z4$)); GOSUB 7300
7009 IF T$(1,6)="Report" AND V0=2 THEN GOSUB 6000
7010 Y5$(1)=T3$(1,T0+1-T)+" "
7015 IF T$<>"" THEN Y5$(T0+2-T)=T$+" "+Q2$+" ("+STR(T[T,0]:"0")+"):"
7016 IF V$(108,1)="Y" THEN IF V$(99,1)="Y" THEN IF T[T,3]<>0 THEN Y5$(36)="Unbilled Costs: "+STR(T[T,3]:Z1$); REM " SSP# 143009
7020 Y5$(76)=STR(T[T,1]:Z1$),Y5$(91)=STR(T[T,2]:Z0$),Y5$(103)=STR(T[T,1]-T[T,2]:Z0$)
7030 IF T[T,1]<>0 THEN Y5$(116)=STR((T[T,1]-T[T,2])*100/T[T,1]:Z4$)
7040 GOSUB 7300
7090 IF T0$="END" THEN IF T=0 THEN GOSUB 7200; GOTO 7190
7095 GOSUB 7300; GOSUB 7300
7100 REM "Accumulate sub totals
7110 IF T=0 THEN GOTO 7190
7120 FOR X=0 TO T1
7130 T[T-1,X]=T[T-1,X]+T[T,X],T[T,X]=0
7140 NEXT X
7190 RETURN 
7200 REM "Elapsed time routine"
7205 GOSUB 7300; Y5$(1)=Q1$+": "+STR(T[0,0]); GOSUB 7300
7210 PRECISION 14; T2=TIM-T2
7220 T4$=STR(INT(T2):"##0")
7230 T3=INT(FPT(T2)*3600),T4=MOD(T3,60),T3=INT(T3/60)
7240 T3=T3/60
7250 T4$=T4$+":"+STR(T3:"00")+":"+STR(T4:"00")
7260 Y5$(1)=Q3$+": "+T4$; GOSUB 7300
7280 PRECISION 2
7290 RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7330 IF Y5$=Y6$ THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; DIM Y5$(W3)
7395 RETURN 
7410 Z$="12O ZZP     13O ZZPARM  "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7435 DIM V[1]
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7480 X3$(178,7)=Y4$,V0=NUM(V$(71,1)),W3$=V$(19,POS("   "=V$(19,40)+"   ")-1)
7485 REM "FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7486 V1$=V$(80,3)+"...  "
7490 RETURN 
7500 REM "CUSTOM PROGRAMMING ROUTINES
7525 REM "Modified stmts:
7550 REM "Added stmts:
7575 REM "Deleted stmts:
7600 REM "Convert quantity
7605 DIM S5$(21),S[5]
7610 FIND (Z[13],KEY="U/M"+C$(124,4),DOM=7611)IOL=0350
7620 IF S5$(20,1)<>"Y" THEN S[2]=C[5] ELSE S[2]=S[1]
7630 IF S[2]=0 THEN S[2]=1
7640 C0=C0/S[2]
7690 RETURN 
7750 REM "Build desc from H8$
7760 H9$=FNS$(H8$(32,8)); IF H9$<>"" THEN H9$=H9$+QUO; IF POS(" "<>H8$(40,8))<>0 THEN H9$=H9$+"x"
7770 H9$=H9$+FNS$(H8$(40,8)); IF H9$<>"" THEN IF POS(" "<>H8$(40,8))<>0 THEN H9$=H9$+QUO+" " ELSE H9$=H9$+" "
7775 IF NUM(H8$(48,2))<>0 THEN H9$=H9$+H8$(48,2)+" Ply "
7780 H9$=H9$+FNS$(H8$(50,40)); H8$=""
7790 RETURN 
7800 REM "Print Order Notepad
7810 READ (Z[6],KEY=U$,DOM=7815)IOL=0360; GOTO 7820
7815 READ (Z[11],KEY=U$,DOM=7890)IOL=0360
7820 FOR I=0 TO 9
7830 IF POS(" "<>F$(9+I*50,50))=0 THEN GOTO 7880
7835 IF V0=2 AND W+2>W0 THEN GOSUB 6200; GOTO 7841
7840 IF W+2>W0 THEN GOSUB 6000
7850 Y5$(23)=F$(9+I*50,50); GOSUB 7300
7880 NEXT I
7890 RETURN 
8000 REM "Special Sort
8020 READ (Z[1],KEY="",DOM=8021)
8030 READ (Z[1],ERR=8031,END=8080)IOL=0310; GOTO 8032
8031 IF ERR<>0 THEN READ (Z[1])IOL=0310 ELSE GOSUB SET_READONLY; READ (Z[1])IOL=0310; GOSUB CLEAR_READONLY
8040 IF V0=2 THEN B$=A$(93,4)+A$(118,2)+A$(6,10)+A$(118,8)
8050 IF V0=3 THEN B$=A$(118,2)+A$(6,10)+A$(118,8)
8060 WRITE (Z[2],KEY=B$)
8070 GOTO 8030
8080 READ (Z[2],KEY="",DOM=8081)
8090 RETURN 
8100 REM "Get & print unbilled costs"
8105 T9=0
8110 READ (Z[3],KEY=A$(118,8),DOM=8111)
8120 READ (Z[3],END=8160)IOL=0330
8130 IF C$(147,8)<>A$(118,8) THEN GOTO 8160
8135 IF C[19]=0 THEN GOTO 8155
8140 X=0; EXTRACT (Z[10],KEY=C$(147,2)+C$(29,3),DOM=8141)*,X
8150 X=X+C[19],T9=T9+C[19]; WRITE (Z[10],KEY=C$(147,2)+C$(29,3))C$(147,2)+C$(29,3),X
8155 GOTO 8120
8160 REM "Print Unbilled costs on this order
8170 IF T9<>0 THEN Y5$(36)="Unbilled Costs: "+STR(T9:Z1$)
8190 RETURN 
8200 REM "Define recap file of unbilled costs by product code
8210 X$="[32] Unbilled Cost Recap by Product Code"
8220 CALL "ZZ2SRT",X3$,X4$,Z[13],Z[3],5,X$,0,"NN"
8230 Y$="10O "+X$; GOSUB 9750
8240 RETURN 
8300 REM "We have found at least one order line, and this is lotted inventory ssber of the order lines that have committed lots of this item at this locati
8305 L9$=""
8306 READ (Z[3],KEY=A$(118,8),DOM=8307)
8307 K$=KEY(Z[3],END=8340)
8308 IF K$(1,8)<>A$(118,8) THEN GOTO 8340
8309 READ (Z[3],ERR=8310,END=8340)IOL=0330
8310 IF ERR<>0 THEN READ (Z[3],END=8340)IOL=0330 ELSE GOSUB SET_READONLY; READ (Z[3])IOL=0330; GOSUB CLEAR_READONLY
8313 IF C$(2,1)<>"Y" THEN GOTO 8307
8314 READ (Z[12],KEY=C$(161,10)+C$(19,10),DOM=8315)
8315 K9$=KEY(Z[12],END=8340)
8320 IF K9$(1,20)<>C$(161,10)+C$(19,10) THEN GOTO 8307
8325 READ (Z[12],KEY=K9$)L8$
8330 IF POS(K$(1,8)=L8$(110,8))<>0 THEN L9$=L9$+L8$(110,11); REM "If the order# lito an order line, add the order line to L9$. We are not looking for duplicabefore the add would increase the processing time here. We may pay more dur the other.                                                                
8335 GOTO 8315
8336 GOTO 8307
8340 IF L9$<>"" THEN STATUS$="*Lots Committed"
8345 RETURN 
8400 REM "New page
8410 F0=-1; GOSUB 6000
8420 Y5$(5)="Product Code",Y5$(28)="Unbilled Costs"
8430 GOSUB 7300
8440 RETURN 
8450 REM "Divison Break
8460 IF L$="" THEN GOTO 8480
8470 GOSUB 8375; GOSUB 7300
8480 L$=C$(1,2),T9=0
8490 RETURN 
8500 SET_READONLY:REM "Set the PRM READONLY to on
8510 SET_PARAM 'XI'; REM "Turn Readonly logic on
8525 SET_READONLY_END:RETURN 
8530 CLEAR_READONLY:REM "Clear the PRM READONLY flag to off
8535 SET_PARAM 'XI'=0; REM "Turn off READONLY logic
8545 CLEAR_READONLY_END:RETURN 
8600 REM "Only printing orders with unbilled costs, read FS2 to see if any
8605 TF_PRINT$="N"
8610 READ (Z[3],KEY=A$(118,8),DOM=8611)
8615 READ (Z[3],END=8645)IOL=0330
8620 IF C$(147,8)<>A$(118,8) THEN GOTO 8645
8625 IF C[19]<>0 THEN TF_PRINT$="Y"; GOTO 8645
8630 GOTO 8615
8645 RETURN 
8700 REM "Only print if backorder
8705 NOT_BO$="N",BO_LINES$="",PRICE=0,COST=0,STATUS$=""
8710 READ (Z[3],KEY=A$(118,8),DOM=8711)
8715 K$=KEY(Z[3],END=8745)
8720 IF K$(1,8)<>A$(118,8) THEN GOTO 8745
8725 READ (Z[3],ERR=8726,END=8745)IOL=0330; GOTO 8730
8726 IF ERR<>0 THEN READ (Z[3],END=8745)IOL=0330 ELSE GOSUB SET_READONLY; READ (Z[3])IOL=0330; GOSUB CLEAR_READONLY
8730 IF C[16]<>0 THEN STATUS$="Partial Shipment"; GOTO 8745
8735 REM "IF C[8]>0 THEN BO_LINES$=BO_LINES$+C$(6,3),PRICE=PRICE+C[6],COST=COST+C[3]; GOTO 8715 ELSE NOT_BO$="Y"; GOTO 8715
8736 IF C[8]=0 THEN NOT_BO$="Y"; GOTO 8741
8737 GOTO 8715
8741 IF NOT_BO$="N" AND STATUS$="" AND P0$(44,1)="Y" THEN GOSUB 8300
8745 RETURN 
8800 REM "err 0 on positioning read
8810 IF ERR<>0 THEN READ (Z[1]) ELSE GOSUB SET_READONLY; READ (Z[1]); GOSUB CLEAR_READONLY
8815 EXITTO 1000
8905 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
8910 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8911 DEF FNZ$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+Z9$(7-NUM(X3$(48,1))*2,2)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8912 DEF FNX$(Z9$)=STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")+Z9$(NUM(X3$(48,1))*2+1,2)+Z9$(7-NUM(X3$(48,1))*2,2)
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
8940 DEF FNS$(Z$)=Z$(1,POS("   "=Z$+"   ")-1)
8950 DEF FNQ$(Z9,Z9$)=STR(Z9:Z9$(1,POS(".00"=STR(Z9:Z9$)+".00")-1))
8960 DEF FNR$(Z9$)=Z9$(POS(" "<>Z9$))
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 1000
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 IF Y5=68 THEN RETRY ELSE ON C9 GOTO 1140,2040
9750 REM "Files Routine
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Y$,Z{ALL},Z0,Z1
9770 ON Z0 GOTO 9771,9900
9790 RETURN 
9900 REM "End program
9910 CALL "ZZERPT",X3$,X4$,X0$,Y3$,Y4$,W9,W2,W5,W,W0,W8,T3,V3$
9920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 IF NOT(NUL(Y4$)) THEN RUN Y4$,ERR=9931
9940 IF %GUI THEN EXIT ELSE RUN "ZMENU"
9999 END 
56000 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
