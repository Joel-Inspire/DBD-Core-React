8000 REM "Commit the Lots for the Components
8010 DIM T[1],I1$(0),I2$(0),I3$(0)
8020 READ (_KT0,KEY=CUSTOMER$+ITEM_CODE$,DOM=*NEXT)
8030 READ_KT0:
8040 READ (_KT0,END=END_KT0)
8045 IF CUSTOMER$+ITEM_CODE$<>_KT0.CUST_DIV$+_KT0.CUST_CODE$+_KT0.KIT_ITEM_CODE$ THEN GOTO END_KT0
8050 READ (_IC0,KEY=_KT0.CUST_DIV_2$+_KT0.CUST_CODE_2$+_KT0.COMPONENT_ITEM_CODE$,DOM=READ_KT0)
8060 DIM I$(35); FLAG$="",I$(1,24)=_KT0.CUST_DIV_2$+_KT0_CUST_CODE_2$+_KT0.COMPONENT_ITEM_CODE$+_KT0.USE_WHSE_LOC$; IF POS(" "<>I$(21,4))=0 THEN I$(21,4)=LOC_CODE$
8065 IF STP(PACKAGING_UM$)="" THEN Q=A4*A3 ELSE Q=A4*A2*A3
8070 I$(25,11)="KT"+LOT_NUM$,Q0=Q*QTY_REQ_PIECES,Q1=Q0; M$=P0$(52,1); IF POS(M$="AB")=0 THEN M$="A"
8072 IF I$(21,1)<>"9" AND _KT0.CUST_DIV$(1,1)="9" THEN I1$=I1$+I$,I2$=I2$+"WHSE ERROR",I3$=I3$+"WHSE ERROR",FLAG$="Y"
8075 IF LOT_INV_FOR_THIS_ITM$<>"Y" THEN GOSUB 8600; GOTO 8100
8080 S1=0; CALL "IC2LCA",X3$,X4$,M$,0,I$,Q1,C,F,S1,S1$,S2,S3$,S3,S4
8090 IF Q1<>Q0 AND FLAG$<>"Y" THEN I1$=I1$+I$,I2$=I2$+STR(Q1:M5$),I3$=I3$+STR(Q0:M5$)
8100 IF I$(21,1)="9" THEN C=0,F=0
8110 T[0]=T[0]+C,T[1]=T[1]+F
8115 _KT2.PRODUCTION_QTY_REQ=Q1,_KT2.COMPONENT_TOT_COST=C,_KT2.COMPONENT_TOT_UNITS_PER_FRT=F
8140 _KT2.CUST_DIV$=_KT1.CUST_DIV$,_KT2.CUST_CODE$=_KT1.CUST_CODE$,_KT2.ITEM_CODE$=_KT1.ITEM_CODE$; _KT2.CUST_DIV_2$=_KT0.CUST_DIV_2$,_KT2.CUST_CODE_2$=_KT0.CUST_CODE_2$,_KT2.ITEM_CODE$=_KT0.COMPONENT_ITEM_CODE$; _KT2.WHSE$=_KT0.USE_WHSE_LOC$,_KT2.RECEIPT_DATE$=_KT1.RECEIPT_DATE$; _KT2.SEQ_NUM$=_KT1.SEQ_NUM$ ! DIM E$(56); E$(1)=A1$+I$(1,24)
8155 REM "Component work file with value of committed lot(s)
8157 WRITE (_KT2,KEY=_KT2.CUST_DIV$+_KT2.CUST_CODE$+_KT2.ITEM_CODE$+_KT2.WHSE$+_KT2.RECEIPT_DATE$+_KT2.SEQ_NUM$+_KT2.CUST_DIV_2$+_KT2.CUST_CODE_2$+_KT2.COMPONENT_ITEM_CODE$); SIGN=1; GOSUB 8650
8180 GOTO 8040
8181 END_KT0:
8190 IF I1$="" THEN GOTO 8370
8200 FOR I=1 TO LEN(I1$) STEP 35
8205 J=(I-1)/35*10+1,Q$="Component item no.: "
8210 CALL "ZZDISP","AX",I1$(I,10),"A/R",X3$,X$,"",0,0,X4$
8220 IF FNS$(X$)>"" THEN Q$=Q$+FNS$(X$)+"-"
8230 CALL "ZZDISP","AX",I1$(I+10,10),"I/C",X3$,X$,"",0,0,X4$
8235 Q$=Q$+FNS$(X$)+" Whse: "+I1$(I+20,4); IF I3$(J,10)="WHSE ERROR" THEN Q$=Q$+" ERROR-component whse must be 9xxx"; GOTO 8250
8240 Q$=Q$+" Req qty= "+FNR$(I3$(J,10))+" Avl qty= "+FNR$(I2$(J,10))
8250 CALL "ZZPROM",".4",X3$,0,Q$,"","",0
8260 NEXT I
8270 PRINT @(0,21),'CE',"The component inventory must be resolved before posting this production entry",
8280 CALL "ZZPROM",".4",X3$,0,"Quantity Required being set to 0 -or- you may delete the entry","","",0
8300 GOSUB 8500
8330 DIM T[1]; A[4]=0
8370 A[0]=T[0],A[1]=T[1]
8380 WRITE (Z[1],KEY=A1$)IOL=0310
8390 RETURN 
8500 REM "Remove records from Component Work File/Decommit Lots
8510 READ (Z[5],KEY=A1$,DOM=*NEXT)
8520 READ (Z[5],END=8590)IOL=0350
8530 IF MID(E$,1,LEN(A1$))<>A1$ THEN GOTO 8590
8540 REMOVE (Z[5],KEY=E$(1,52),DOM=8541)
8545 READ (Z[3],KEY=E$(33,20),DOM=8520)IOL=0330; SIGN=-1; GOSUB 8650; IF C$(112,1)<>"Y" THEN GOTO 8520
8550 DIM I$(35); I$(1,24)=E$(33,24),I$(25,11)="KT"+A$(234,8)
8560 CALL "IC2LCA",X3$,X4$,"D",0,I$,0
8580 GOTO 8520
8590 RETURN 
8600 REM "Compute price for Non-Lotted Item
8610 DIM D[20]; READ (Z[11],KEY=I$(1,24),DOM=8611)IOL=0347
8615 REM "Use Loc Avg Cost 1st, then Overall Avg Cost, then Salesperson Cost
8620 IF D[2]<>0 THEN U=D[2] ELSE IF C[18]<>0 THEN U=C[18] ELSE U=C[20]
8625 CALL "FM2EXT",Z[13],0,C$(124,4),C[15],Q1,U,C,0
8630 Q0=D[3]+D[4]-D[5]+D[6]-D[7]-D[13]; IF Q0>=Q1 OR FLAG$="Y" THEN GOTO 8640
8635 I1$=I1$+I$,I2$=I2$+STR(Q0:M5$),I3$=I3$+STR(Q1:M5$)
8640 RETURN 
8650 REM "Adjust Component Production Commitments Inventory in bucket 13 of IC1
8660 DIM D3$(58),D[20]; D3$(1,24)=E$(33,24)
8670 EXTRACT (Z[11],KEY=D3$(1,24),DOM=8671)IOL=0347
8690 D[13]=D[13]+E[0]*SIGN
8700 WRITE (Z[11],KEY=D3$(1,24))IOL=0347
8702 IF RT$>"" THEN IF RT$(7,1)="H" THEN CUST$=D3$(1,10); CALL "RT2WOC",ERR=8703,X3$,X4$,CUST$,"IC1...","U",D3$(1,24)
8710 WRITE (Z[8],KEY=D3$(21,4)+C$(61,3)+D3$(1,20))
8740 RETURN 
8910 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
