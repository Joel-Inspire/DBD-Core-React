0010 V9=-3,V3=_GL1,V4=0,V5=0,V9$=INV_DATE$,V7=1
0020 SETESC 9300; SETERR 9000
0035 REM "5.4 - 03/28/06 - 9.312222 - jir - SSP# 192329
0037 REM "192329-When PO Receiving an order and you are NOT divisionalized   
0040 REM "Copyright 2006 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 IF J9<>0 THEN GOTO 8500
0085 IF L0=-1 THEN L0=0,X0$="AP2DAA"; GOTO 1800
0090 ON L0 GOTO 0095,ADD_ENTRY,DELETE,RE_DO_SCREEN
0100 CLEAR ; SETERR 0105; ENTER X3$,X4$,Q0$,Q1$; POR_GATEWAY$="Y"
0105 SETERR 9000; SETESC 9300
0110 X0$="AP2DAA",X1$="A/P GUI Invoice Entry",K9$="",K9=0
0120 DIM Y[4],S$(50)
0125 V8$="000209151899"
0126 F2$="*"
0127 T5=10; REM "Number of elements in T array
0130 K0=26,K1=4
0135 V9=0,Z9=1
0140 M0$="###,###,###.00-",M1$="-#0"
0144 IF POR_GATEWAY$="Y" THEN Q3$=Q1$,F2$=""; GOTO 0146
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0200 REM "
0240 IF POR_GATEWAY$<>"Y" THEN CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0300 REM "IOLISTS
0310 IOLIST A$(1,LEN(A$)),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14]
0320 IOLIST B$
0330 IOLIST C$,C[0],C[1],C[2]
0340 IOLIST D$,D[0],D[1]
0350 IOLIST E$(1),E[0],E[1],E[2]
0370 IOLIST G$
0390 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6]
0410 IOLIST K$
0420 IOLIST L$
0499 ! 
0500 OPEN_FILES:
0501 %NO_NEW_BATCH=0; GOTO 0505
0502 IF DONT_SET_BATCH THEN GOTO 0505 ELSE X0$="AP2DAA"; CALL "ZGBATC",X3$,X4$,X0$,X9; IF X9=1 THEN CMD_STR$="END"; EXIT 
0503 %APGDAA$=MSG("T_APGDAA"); IF STP(X3$(174,4))<>"" THEN %APGDAA$+=" - Batch No: "+X3$(174,4)
0505 Z9=NUM(X3$(60,3)); DIM Z[Z9]
0506 ESCAPE 
0510 Z$="01X API...  02O APK...  03O AP4...  04ORAP2...  05ORZYB...  07ORAP3...  08ORAPQ...  06O ZZPARM  11ORAPI...  12O AP8...  13O GL1...  14OSAPI...  "
0511 ! CALL "ZZWMX3"
0516 REM IF POS("J/C"=X4$(7),12)>0 THEN LET Z$=Z$+"09O JC0...  10O JC1...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0525 F=Z[2]
0530 _APE=Z[2],_AP4=Z[3],_AP2=Z[4],_ZYB=Z[5],_AP3=Z[7],_APQ=Z[8],_ZZPARM=Z[6],_API=Z[11],_AP8=Z[12],_GL1=Z[13],%_AP8=_AP8,%_AP4=_AP4
0535 %APD$=FIN(Z[1],"FILENAME")
0540 IF POS(X3$(9,3)="584",3) THEN CANADA_TAX=1
0545 OPEN_FILES_END:EXIT 
0549 ! 
0550 READ_PARMS:
0555 T5=10; DIM T[T5]
0560 DIM %F1$(120); READ (_ZZPARM,KEY=%C$+"AP2A",DOM=0562)%F1$; GOSUB SPECIAL_DESC
0565 REM "F9 IS LIMIT FOR AUTO INVOICE HOLD, REMOTE LOCATION LARAMS
0570 ! IF X3$(330,1)="1" THEN READ (Z[6],KEY="R/L"+X3$(9,3),DOM=0571)*,F9
0580 READ (_ZZPARM,KEY=%C$+"A/P",DOM=*NEXT)%F0$
0581 IF %F0$="" THEN ERR_MSG$=MSG("NOF")
0585 ! IF %F0$(70,1)="Y" THEN Z$="09O AR3...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0586,9900
0590 READ (_ZZPARM,KEY=%C$+"G/L",DOM=*NEXT)%G0$; %G8=NUM(%G0$(170,2))
0591 IF %G0$="" THEN ERR_MSG$=MSG("NOF")
0595 DIM %SEC$(100); FIND (_ZZPARM,KEY="osec"+%X3_OP_ID$,DOM=0596)%SEC$
0598 READ_PARMS_END:EXIT 
0599 ! 
0600 PRE_DISPLAY:
0601 ! GOSUB PROGRAM_FLOW_LOGIC; IF Q3$<>"" THEN F2$=""
0605 ! GOSUB AUDIT
0610 GOSUB CURRENT_FISCAL_YEAR
0615 GOSUB GET_GL_MASK
0620 ONLY_OPEN$="Y",TF_MODULE$="A/P"; PERFORM "ZZWLDB;LOAD_FY"
0621 ACCTPD$=CUR_ACCTPD$; %FY$=CUR_FY$; %ACCTPD$=CUR_ACCTPD$
0650 ! ON Z9 GOTO 7000,0651
0655 C9=-1,V0=0
0658 ! IF Q3$="" THEN CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,0,0,0
1000 REM "
1005 V0=0,Z9=-1,I1=0,A0=0
1010 ! IF POR_GATEWAY$<>"Y" THEN CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
1030 DIM B$(1),C$(300),C[2],D$(53),D[1],E$(108),E[2],G$(40),F9$(0)
1035 DIM A$(146+K9),A[14],T[T5]
1045 ! A$(1,16+K9)=K9$+A1$,A$(104,4)=X3$(9,3)+X3$(330,1)
1050 ! GOSUB BACKGROUND; GOSUB DISPLAY_KEYS
1098 PRE_DISPLAY_END:EXIT 
1099 ! 
1100 REM "KEY SEQ
1110 X0=-1,C0=0,X1=0,C9=0; IF A$(7+K9,2)="  " THEN X0=1
1120 C0=ABS(C0),X$=""; IF C0=2 AND X0>0 THEN X0=X0-1 ELSE IF C0<>2 THEN X0=X0+1; IF C0=4 THEN GOTO 9900
1140 ON X0 GOTO 1200,1250,1300,1350,1500
1199 ! 
1200 FY_ENTRY:
1201 IF ARG_3$="POGMAG" THEN %ACCTPD$=ACCTPD$,CUR_ACCTPD$=ACCTPD$
1205 IF FY$="" THEN RETURN 
1210 IF %P1$<>"" AND FY$=%P1$(9,4) THEN GOTO FY_ENTRY_END
1220 %P1$=""; FIND (_ZZPARM,KEY=%C$+"G/LYE"+FY$,DOM=*NEXT)%P1$; GOTO 1230
1221 MSGBOX MSG("INVALID")+" "+MSG("FISC_Y"),MSG("ATTN"),"!"; FY$="",NEXT_ID=FY.CTL,REFRESH_FLG=1; GOTO FY_ENTRY_END
1230 PERFORM "ZZWLDB;LOAD_ACCTPD"
1231 ACCTPD$=CUR_ACCTPD$
1232 IF ACCTPD$>"13" THEN ACCTPD$="01",CUR_ACCTPD$="01"
1235 PE_DATE$="Ending : "+FND$(PAD(MID(%P1$,NUM(ACCTPD$)*6+15,6),6)); REFRESH_FLG=1
1240 FY_ENTRY_END:EXIT 
1249 ! 
1250 ACCTPD_ENTRY:
1260 IF STP(ACCTPD$,3)="" THEN MSGBOX MSG("INVALID")+" "+MSG("ACCTPD"),MSG("ATTN"),"!"; ACCTPD$="",NEXT_ID=ACCTPD.CTL; REFRESH_FLG=1
1290 ACCTPD_ENTRY_END:EXIT 
1299 ! 
1300 VENDOR_CODE_ENTRY:! ENTER FIELD$,ERR_MSG$,VAR_TAG$,ERR=*NEXT
1304 ! IF F2$="*" THEN F2$="",A1$="",X0=0; GOTO 1140
1305 IF NUL(VENDOR$) THEN NEXT_ID=VENDOR.CTL; RETURN ! IF LEN(Q3$)>6 THEN A$(7,10)=Q3$(20,10); GOTO 1312
1308 ! X$="Press F10 to retrieve by Phone Number"
1310 CALL "ZZWLKU;PARSE_VEND",VENDOR$,VEND_DIV$,VEND_CODE$; VENDOR$=VEND_DIV$+VEND_CODE$
1312 ! IF ABS(C0)=2 THEN IF LEN(A1$)>4 THEN A1$=A1$(1,4)
1313 ! IF C0=-7 THEN X$="AP",C0=1; CALL "ZZ2PLU",X3$,A$,7,X$; IF X$="" THEN GOTO 1308 ELSE CALL "ZZDISP","A",A$(7,10),"A/P",X3$,"","",13,4+V0,X4$
1315 ! IF C0<0 THEN ON INT(ABS(C0)-2) GOTO 1316,6800,9700,6970
1319 ! GOSUB FORMAT_VENDOR
1320 DIM C[2]; FIND (%_AP4,KEY=VENDOR$,DOM=*NEXT)IOL=0330
1321 IF C$="" THEN ERR_MSG$=MSG("NOF"); GOTO VENDOR_CODE_ENTRY_END
1322 ! IF POS(X3$(9,3)="144244",3)>0 THEN IF A$(7+K9,2)="00" THEN CALL "ZZPROM",".X0AP2DAA",X3$,Z0,"Division 00 vendors are reserved for franchise operations","","",0; IF Z0=0 THEN GOTO 1308 ELSE GOSUB SOURCE_COMP_ENTRY
1325 ! IF POR_GATEWAY$<>"Y" THEN PRINT @(31,4+V0),C$(11,35),
1327 IF C$(246,1)="I" THEN ERR_MSG$=MSG("VEND_INACT"); GOTO VENDOR_CODE_ENTRY_END
1330 GOSUB VENDOR_MSG_BOXES
1340 VENDOR_CODE_ENTRY_END:EXIT 
1349 ! 
1350 INVOICE_NUM_ENTRY:! Not used at this time
1354 IF Q3$<>"" THEN A$(17+K9,10)=Q3$(10,10); GOSUB 6460
1355 Q$=A$(1,16)
1357 IF POR_GATEWAY$="Y" THEN GOTO 1120; REM "Bypass input
1360 CALL "ZZENTR","SUX",A{ALL},A$,X4$,X3$,13,5+V0,17+K9,10,C0,"","{2"+X$,Q$,"AP2DAA06","APD","",""; IF ABS(C0)>4 THEN GOSUB WHOLE_SCREEN; ON C0 GOTO 1360,1361
1361 IF POS("PO2MAG"=U1$) AND C0=-3.1 THEN C0=-1
1362 IF ABS(C0)=2 AND LEN(A1$)>6 THEN A1$=A1$(1,6)
1363 IF C0=-4 AND Q3$<>"" THEN GOTO 8930
1364 IF C0=-1 AND POS(" "<>A$(17+K9,10))<>0 THEN GOTO 1366
1365 IF C0=-1 THEN GOTO 1360 ELSE IF C0<0 THEN ON INT(ABS(C0)-2) GOTO 1366,6800,9700,6970
1390 INVOICE_NUM_ENTRY_END:
1399 ! 
1500 ! 
1505 Z9=0
1510 A1$=K9$+A$(LEN(K9$)+1,26),A$(1,LEN(K9$))=K9$
1515 IF Q3$<>"" THEN GOTO 1600; REM " Redefaulting distribution will orphan any previous lines distributed for an existing entry, but that's okay since we always process header first.
1520 READ (Z[1],KEY=A1$,DOM=1600)IOL=0310
1521 EXISTING_RECORD:
1525 Z9=0,INTERNAL_USE=NET_SALE,F9$="*",D9$=""
1530 ! IF POR_GATEWAY$<>"Y" THEN GOSUB 6080
1540 GOSUB NEW_OR_EXISTING
1590 ! GOTO 1700
1595 EXISTING_RECORD_END:EXIT 
1599 ! 
1600 NEW_RECORD:
1605 NEW_REC$="Y",D9$=""; APE_LINK$="0"
1610 GOSUB EXISTING_INVOICE; IF I1=1 THEN GOTO 1650
1615 IF Q3$<>"" THEN GOTO 1650
1620 ! CALL "ZZPROM","2",X3$,Z,"","","",0; ON Z GOTO 1650,1630,6975
1630 ! IF Q3$<>"" THEN GOTO 9700 ELSE GOTO 1000
1650 REM "Set defaults
1655 ! IF POR_GATEWAY$<>"Y" THEN GOSUB 6080
1660 GOSUB SET_DEFAULTS
1690 ! GOSUB DISPLAY_DATA
1695 ! IF Q3$<>"" THEN GOTO 1800 ELSE GOTO 2000
1698 NEW_RECORD_END:EXIT 
1699 ! 
1700 REM "
1790 GOSUB DISPLAY_DATA
1800 REM "
1805 IF POR_GATEWAY$="Y" THEN GOTO 7000; REM "Bypass prompt
1820 CALL "ZZPROM",STR(6+C9),X3$,Z,"","","V",X0; ON Z+1 GOTO 2040,1830,DELETE,7000,7000
1830 GOTO 2000
1850 REM "MODIFY
1855 X0=X0-1; IF Z9=1 THEN GOTO 1880 ELSE IF Z9=0 THEN Z9=1
1860 EXTRACT (Z[1],KEY=A1$,DOM=1870)IOL=0310
1865 C9=1
1870 GOSUB DISPLAY_DATA
1890 IF Z<0 THEN GOTO 2035 ELSE GOTO 2000
2000 REM "Data
2010 L0=1; RUN "AP2DAD"
2040 L0=2; RUN "AP2DAD"
5900 REM "REMOVE LINES
5910 IF A0=0 THEN GOTO 5990
5920 EXTRACT (F,IND=0,ERR=5960)IOL=0290
5925 IF Y[4]=-2 THEN READ (F,IND=0); WAIT 0; GOTO 5920 ELSE Y[4]=-2; WRITE (F,IND=0)IOL=0290
5930 A1=Y[1],Y[1]=A0,Y[0]=Y[0]-1
5935 READ (F,IND=A0)A; IF A>0 THEN Y[0]=Y[0]-1,A0=A; IF POS(BIN(A,3)=Y5$,3)=0 THEN Y5$=Y5$+BIN(A,3); GOTO 5935
5940 WRITE (F,IND=A0)A1
5950 Y[4]=-1; WRITE (F,IND=0)IOL=0290
5955 GOTO 5990
5960 IF ERR=0 THEN RETRY ELSE GOTO 9000
5990 RETURN 
6000 BACKGROUND:
6002 IF POR_GATEWAY$="Y" THEN RETURN 
6070 IF Z9<0 THEN GOTO 6160
6086 IF %F0$(80,1)="Y" THEN PRINT @(1,13+V0),"2nd Disc Amount:",@(40,13+V0),"2nd Disc Expires on:", ELSE PRINT @(0,13+V0),Z0$,; REM "WO131561
6090 IF %F0$(16,1)="Y" THEN PRINT @(1,17+V0),"Print check on bank code:",
6120 FOR X=0 TO 3; IF POS(" "<>%F1$(X*20+8,16))=0 THEN NEXT X ELSE PRINT @(0,9+X+V0),%F1$(8+X*20,16),":",; NEXT X
6130 IF %F0$(70,1)="Y" THEN PRINT @(54,14),"Salesperson:"
6135 IF X3$(69,1)="C" THEN PRINT @(40,14),"US$ Equiv Gross:",@(40,15),"US$ Discount:",
6190 BACKGROUND_END:RETURN 
6200 DISPLAY_DATA:
6205 IF POR_GATEWAY$="Y" THEN RETURN 
6215 GOSUB DISPLAY_KEYS
6224 FOR X=0 TO 3; IF POS(" "<>%F1$(8+X*20,16))=0 THEN NEXT X ELSE PRINT @(19,9+X+V0),A[2+X]:M0$,; NEXT X
6226 IF %F0$(80,1)="Y" THEN PRINT @(19,13+V0),A[14]:M0$,; CALL "ZZDISP","D",A$(111,6),"",X3$,"","",61,13+V0,X4$; REM "WO131561
6238 CALL "ZZDISP","A",A$(62+K9,10),"P/O",X3$,"","",27,15+V0,X4$
6240 IF %F0$(16,1)="Y" THEN PRINT @(27,17+V0),A$(72+K9,3),@(31,17),E$(4,30),
6250 CALL "ZZDISP","A",A$(75+K9,9),"AP2",X3$,"","",27,18+V0,X4$
6270 IF %F0$(70,1)="Y" THEN PRINT @(67,14),A$(100,4),
6275 CALL "AP2DAF",X3$,X4$,"D",A$,A{ALL}
6390 DISPLAY_DATA_END:RETURN 
6400 WHOLE_SCREEN:
6401 IF POR_GATEWAY$="Y" THEN RETURN 
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6410 GOSUB BACKGROUND
6430 IF Z9>=0 THEN GOSUB DISPLAY_DATA ELSE GOSUB DISPLAY_KEYS; GOSUB 8700
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 WHOLE_SCREEN_END:RETURN 
6450 DISPLAY_KEYS:
6453 IF POR_GATEWAY$="Y" THEN RETURN 
6455 IF A$="" THEN GOTO 6490
6460 IF POR_GATEWAY$="Y" THEN RETURN 
6464 CALL "ZZDISP","A",A$(7+K9,10),"A/P",X3$,"","",13,4+V0,X4$
6470 GOSUB PRINT_PE_DATE
6490 DISPLAY_KEYS_END:RETURN 
6499 ! 
6500 DELETE:
6505 GOSUB 5900
6510 REMOVE (Z[1],KEY=A1$,DOM=6511)
6520 Z9=2
6540 NET_SALE=0; T[0]=0; INTERNAL_USE=0; NET_SALE=0; GROSS_INV_AMT=0; A0=0; D9$=""
6590 GOTO 1630
6599 ! 
6600 ALT_KEY_DATA_READS:
6605 FIND (Z[3],KEY=A$(7+K9,10),DOM=6606)IOL=0330
6610 RETURN 
6630 DIM D$(100),D[1]; FIND (_AP2,KEY=TERMS_CODE$,DOM=6631)IOL=0340
6635 DIM E$(150),E[2]; FIND (_ZYB,KEY=PRNT_CHK_ON_BANK$,DOM=6636)IOL=0350
6640 IF Q3$="" THEN DIM G$(40); FIND (_AP3,KEY=CATEGORY$,DOM=6641)IOL=0370
6690 ALT_KEY_DATA_READS_END:RETURN 
6699 ! 
6700 ADD_ENTRY:
6705 A[0]=A0
6710 IF X3$(330,1)="1" THEN IF A$(62+K9,10)=S$(1,10) THEN CALL "ZZPROM",".4",X3$,0,"You must specify a P/O number","","",0; X0=16,C0=0; GOTO 2040
6730 WRITE (Z[1],KEY=A1$)IOL=0310
6740 IF POR_GATEWAY$="Y" THEN GOTO 9700
6780 ON Z9 GOTO 7000,6781
6785 C9=-1,V0=0
6788 IF Q3$="" THEN CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,0,0,0
6790 GOTO 1630
6800 REM "NEXT ENTRY IN FILE
6805 ON 10*FPT(C0)+2 GOTO 6850,6806
6810 A1$=KEY(Z[1],END=6895)
6815 GOSUB ALT_KEY_DATA_READS
6820 A$(1,LEN(A1$))=A1$
6825 IF A1$(1,LEN(K9$))<>K9$ THEN GOTO 6895
6830 GOSUB ALT_KEY_DATA_READS
6835 GOSUB DISPLAY_KEYS
6840 GOTO 1515
6850 REM "PRIOR ENTRY
6855 CALL "ZZKEYP",ERR=6856,Z[1],A1$; GOTO 6820
6860 CALL "ZZKEYL",ERR=6861,Z[1],A1$; GOTO 6820
6870 GOTO 6895
6890 GOTO 1515
6895 PRINT 'RB',; READ (Z[1],KEY=K9$,DOM=1140); GOTO 1140
6999 ! 
7000 SEL_LINES:
7001 ! IF X3$(330,1)="1" THEN IF A$(62,10)=S$(1,10) THEN CALL "ZZPROM",".4",X3$,0,"You must specify a P/O number","","",0; X0=16,C0=0; GOTO 2040
7003 IF FROM_POGMAG AND NOT(NUL(T9$)) THEN DEFAULT_T9$=T9$
7005 L0=1,A4=1,F=_APE,A0=NUM(APE_LINK$)
7006 IF FROM_POGMAG THEN INTERNAL_USE=0; A0=0; T9$=DEFAULT_T9$ ! for P/O receiving we need to clear, yes this will orphan those lines already attached.
7010 V9=-3,V3=_GL1,V4=0,V5=0,V9$=INV_DATE$,D9$=""
7012 REFRESH_FLG=1 ! IF A0<>0 THEN D9$="*"
7015 T[0]=-(NET_SALE); IF GROSS_INV_AMT<0 THEN NEG_VAL=1 ELSE NEG_VAL=2
7016 T0=T[0]; NO_GL=1; T6=NET_SALE ! GROSS_INV_AMT
7018 IF POS(" "<>T9$)=0 THEN T9$="" ELSE IF Q3$<>"" AND Q3$(30,1)<>"D" THEN T[0]=T6+T6+T[0] ELSE T[1]=-T[0] ! t[0]=T[1]
7019 T[0]=ABS(T[0]) ! IF POR_GATEWAY$="Y" THEN CALL "GL2XAA"; GOTO ADD_ENTRY
7020 PERFORM "GLGXAA"
7023 B_A0=DEC(Y$(1,2))
7025 APE_LINK$=STR(B_A0),A0=B_A0
7030 ! CALL "*WINGRP;SHOW",FLDS1.GRP$
7035 GL_ACCT$=""; NEXT_ID=GL_ACCT.CTL
7095 RETURN 
7099 ! 
7100 RE_DO_SCREEN:
7102 IF POR_GATEWAY$<>"Y" THEN CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,0,0,0
7105 V0=0
7120 IF POR_GATEWAY$<>"Y" THEN PRINT 'SB',@(0,3),"Fiscal Year:",@(23,3),"Period:",@(0,4),"Vendor Code:",@(25,4),"Name:",@(4,5),"Invoice:",@(25,5),"Date:",@(47,5),"Gross Amount:",@(0,6),Z0$,'SF',
7130 GOSUB DISPLAY_KEYS
7190 GOTO 7020
7199 ! 
7200 GET_AMT_IF_PO_RECEIPT:
7205 REM "IF Q3$(54,1)="D" THEN GOTO 07240
7210 IF Q3$<>"" THEN LINE_FREIGHT=0; CALL "AP2DAE",X3$,A$,A{ALL},T9$,T{ALL},Q3$,%G8,LINE_FREIGHT
7215 IF STP(A$(47,15),3)<>"" THEN INV_COMMENT$=A$(47,15)
7216 IF STP(A$(62,10),3)<>"" THEN OUR_REF_NUM$=STP(A$(62,10))
7217 IF STP(A$(72,3),3)<>"" THEN PRNT_CHK_ON_BANK$=A$(72,3)
7218 IF STP(A$(75,9),3)<>"" THEN CATEGORY$=A$(75,9),CATEGORY_ON_MAIN$=CATEGORY$
7219 IF STP(A$(100,4),3)<>"" THEN SPER_CODE$=A$(100,4)
7220 GROSS_INV_AMT=A[1],SPECIAL_AMT_1=A[2],NET_SALE=A[9]
7225 SPECIAL_AMT_2=A[3],SPECIAL_AMT_3=A[4],SPECIAL_AMT_4=A[5]
7230 T6=0,A0=0
7235 FOR I=1 TO T5; T6=T6+T[I]; NEXT I
7240 GET_AMT_IF_PO_RECEIPT_END:RETURN 
7399 ! 
7400 AUDIT:
7410 FIND (Z[1],KEY="",DOM=7490)V0$,K0$
7420 IF K0$>"" THEN MSGBOX "The update has already been initiated.","FYI","!"; CMD_STR$="END"; EXIT 
7430 EXTRACT (Z[1],KEY="",REC=T100$,ERR=9800)
7440 Q$="Audit report "+V0$(22,4)+"."+V0$(26,2)+" has already been printed for this data entry."+SEP+"Do you wish to modify?"
7445 MSGBOX Q$,"CONFIRM","?,YesNo",ANS$
7447 IF ANS$="NO" THEN CMD_STR$="END"; EXIT 
7450 REMOVE (Z[1],KEY="")
7490 AUDIT_END:RETURN 
7499 ! 
7600 CURRENT_FISCAL_YEAR:
7605 ! IF LEN(Q3$)>36 THEN A1$=Q3$(36,17); GOTO 7620
7610 FY$=%F0$(7,4),ACCTPD$=%F0$(11,2)
7620 FIND (_ZZPARM,DOM=NO_FY_REC,KEY=%C$+"G/L"+"YE"+FY$)%P1$
7655 %FY$=FY$; %ACCTPD$=ACCTPD$
7698 CURRENT_FISCAL_YEAR_END:RETURN 
7699 ! 
7700 PRINT_PE_DATE:ENTER FIELD$,VAR_TAG$,ERR=*NEXT
7720 IF POR_GATEWAY$<>"Y" THEN %PE_DATE$="Ending "+FND$(%P1$(NUM(FIELD$)*6+15,6))
7748 PRINT_PE_DATE_END:EXIT 
7749 ! 
7800 GET_GL_MASK:
7801 IF POR_GATEWAY$="Y" THEN RETURN 
7810 CALL "ZZDISP","AX","000000000000","G/L",X3$,W2$,"",0,0,X4$
7815 M2=0; FOR X=1 TO LEN(W2$); M2=M2+POS("0"=W2$(X,1)); NEXT X
7820 CALL "ZZDISP","AX","000000000000","J/C",X3$,W3$,"",0,0,X4$
7825 M3=0; FOR X=1 TO LEN(W3$); M3=M3+POS("0"=W3$(X,1)); NEXT X
7830 CALL "ZZDISP","AX","000000000000","JCC",X3$,W4$,"",0,0,X4$
7835 M4=0; FOR X=1 TO LEN(W4$); M4=M4+POS("0"=W4$(X,1)); NEXT X
7840 GET_GL_MASK_END:RETURN 
7849 ! 
7850 CALC_DISC_AMT:
7880 DISC_AMT=DISC_APPLIES_TO*D[0]/100
7882 IF %F0$(80,1)="Y" AND D$(43,1)="P" AND D[1]<>0 THEN DISC_AMT_2ND=DISC_APPLIES_TO*D[1]/100; REM "WO131561, 2nd discount amount
7885 ! IF POR_GATEWAY$<>"Y" THEN PRINT @(61,8+V0),A[6]:M0$,@(61,9+V0),A[7]:M0$,
7890 CALC_DISC_AMT_END:RETURN 
7899 ! 
7900 CALC_DISC_APPLIES_TO:
7910 DISC_APPLIES_TO=GROSS_INV_AMT
7915 DIM A[14]; A[2]=SPECIAL_AMT_1,A[3]=SPECIAL_AMT_2,A[4]=SPECIAL_AMT_3,A[5]=SPECIAL_AMT_4; FOR X=0 TO 3; IF POS(STR(X+1:"0")=C$(294,5))=0 AND %F1$(25+20*X,1)<>"Y" THEN DISC_APPLIES_TO=DISC_APPLIES_TO-A[2+X]
7918 NEXT X
7920 IF %F0$(79,1)="Y" AND POS("1"=C$(294,5))=0 AND %F1$(25,1)<>"Y" THEN DISC_APPLIES_TO=DISC_APPLIES_TO-LINE_FREIGHT; REM "SSP118375, exclude freight on lines from discount
7935 GOSUB CALC_DISC_AMT
7950 REM "CALC NET INV AMT
7955 NET_SALE=GROSS_INV_AMT
7960 FOR X=0 TO 3; IF %F1$(24+X*20,1)="Y" THEN NET_SALE=NET_SALE-A[2+X]; NEXT X ELSE NEXT X
7965 NET_SALE=NET_SALE-WORKMAN_COMP_WH
7970 IF %F0$(15,1)="L" THEN NET_SALE=NET_SALE-DISC_AMT
7985 ! IF POR_GATEWAY$<>"Y" THEN PRINT @(61,12+V0),A[9]:M0$,
7990 CALC_DISC_APPLIES_TO_END:RETURN 
7999 ! 
8000 SET_DEFAULTS:
8001 CALL "ZZWLKU;PARSE_VEND",VENDOR$,VEND_DIV$,VEND_CODE$; VENDOR$=VEND_DIV$+VEND_CODE$
8003 DIM C$(426),C[2]; FIND (_AP4,KEY=VENDOR$,DOM=*NEXT)IOL=0330
8005 INV_TYPE$="I"
8010 INV_DATE$=%X3_TODAY$,TERMS_CODE$=C$(286,2),PRNT_CHK_ON_BANK$=C$(283,3),INV_COMMENT$=C$(256,15),CATEGORY$=C$(247,9),CATEGORY_ON_MAIN$=CATEGORY$,PYMNT_SELECTION_CODE$=C$(288,2),PYMNT_PRIORITY_CODE$=C$(290,1),INV_ON_HOLD$=C$(291,1)
8011 IF LEN(Q3$)>30 THEN INV_DATE$=Q3$(30,6)
8012 T9$=C$(271,12),INV_ON_HOLD$="N"
8015 IF I1=0 THEN GROSS_INV_AMT=C[0],DAYS_TO_EXTEND=C[1]; GOTO NEW_OR_EXISTING
8025 REM "Existing invoice defaults
8040 INV_DATE$=K$(21,6),TERMS_CODE$=K$(27,2),INV_DUE_DATE$=K$(29,6),DISC_EXPIRE_DATE$=K$(35,6),INV_COMMENT$=K$(41,15),OUR_REF_NUM$=STP(K$(56,10)),PRNT_CHK_ON_BANK$=K$(66,3),CATEGORY$=K$(69,9),CATEGORY_ON_MAIN$=CATEGORY$,PYMNT_SELECTION_CODE$=K$(78,2),PYMNT_PRIORITY_CODE$=K$(80,1),INV_ON_HOLD$=K$(81,1),SPECIAL_INV_TYPE$=K$(82,1),INV_TYPE$="A"
8049 ! 
8100 NEW_OR_EXISTING:! If existing F9$="*"
8110 IF LEN(Q3$)>54 THEN TERMS_CODE$=Q3$(54,2)
8160 GOSUB 6630
8162 IF POS(" "<>ALT_CURR_CODE$)=0 THEN ALT_CURR_CODE$=E$(105,3)
8165 IF Q3$<>"" THEN GOSUB GET_AMT_IF_PO_RECEIPT
8170 IF F9$<>"*" THEN GOSUB CALC_DUE_DATE
8185 GOSUB CALC_DISC_APPLIES_TO
8186 IF POR_GATEWAY$="Y" THEN GOSUB CALC_DUE_DATE; GOSUB CALC_DISC_APPLIES_TO
8187 IF %F0$(71,1)="Y" AND F9$<>"*" THEN GROSS_INV_AMT=GROSS_INV_AMT-SPECIAL_AMT_2,SPECIAL_AMT_2=(GROSS_INV_AMT-DISC_AMT)*NUM(%F0$(72,4))*.0001,GROSS_INV_AMT=GROSS_INV_AMT+SPECIAL_AMT_2
8190 SET_DEFAULTS_END:RETURN 
8199 ! 
8200 EXISTING_INVOICE:
8205 I1=0; FIND (_API,KEY=VENDOR$+INV_NUM$,DOM=8206)IOL=0410; I1=1
8206 IF I1=0 THEN FIND (_APQ,KEY=VENDOR$+INV_NUM$,DOM=8240)IOL=0410; I1=2
8210 MSGBOX MSG("INV_OPEN"),MSG("CONFIRM"),"?,YESNO",S3$
8215 IF S3$<>"YES" THEN INV_NUM$="",NEXT_ID=INV_NUM.CTL; EXIT 
8240 EXISTING_INVOICE_END:RETURN 
8249 ! 
8300 CALC_DUE_DATE:
8305 REM "EXTRA DAYS ADDED TO DUE DATE AT PRINT TIME
8310 CALL "ZZDISC",X3$,D$,0,0,INV_DATE$,Q4$,Q2$,0,0
8370 INV_DUE_DATE$=Q4$,DISC_EXPIRE_DATE$=Q2$
8372 IF %F0$(80,1)="Y" AND D$(43,1)="P" AND D$(53,3)<>"   " THEN ORIGINAL_D$=D$,D$(44,3)=D$(53,3),Q2$=""; CALL "ZZDISC",X3$,D$,0,0,INV_DUE_DATE$,Q4$,Q2$,0,0; DISC_DATE_2ND$=Q2$,D$=ORIGINAL_D$; REM "W0131561, 2nd discount expires on date
8375 ! IF POR_GATEWAY$<>"Y" THEN PRINT @(61,7+V0),FND$(A$(35+K9,6)),@(61,10+V0),FND$(A$(41+K9,6)),
8395 CALC_DUE_DATE_END:RETURN 
8399 ! 
8500 REM "Return from set-up
8510 IF Q1$="" OR J9=0 THEN GOSUB WHOLE_SCREEN
8520 J9=0; C0=0
8530 IF Q1$>"" THEN A$(7,10)=Q1$; GOSUB WHOLE_SCREEN; GOTO 1311 ELSE GOTO 1300
8699 ! 
8700 VENDOR_MSG_BOXES:
8701 IF POR_GATEWAY$="Y" THEN RETURN 
8710 IF STP(C$(46,87),3)="" THEN TEXT$="No address info for this vendor."; GOTO 8740
8720 CALL "ZZDISP","AX",C$(124,9),"ZIP",%X3$,X$,"",0,0,%X4$
8730 TEXT$=C$(11,35)+SEP+C$(46,30)+SEP+C$(76,30)+SEP+STP(C$(106,16),1)+", "+C$(122,2)+" "+X$
8740 MSGBOX TEXT$,MSG("VEND_ADDR"),"INFO"
8760 IF %F0$(67,1)<>"Y" THEN GOTO CHECK_ON_HOLD
8770 FIND (%_AP8,KEY=FIELD$,DOM=CHECK_ON_HOLD)IOL=0420
8780 IF POS(" "<>L$(1,120))>0 THEN TEXT$=L$(11,60)+SEP+L$(71,60); MSGBOX TEXT$,MSG("IMP_MSG"),"!"
8790 CHECK_ON_HOLD:IF C$>"" THEN IF C$(291,1)="Y" THEN TEXT$=MSG("VEND_HOLD"); MSGBOX TEXT$,MSG("WARNING"),"!"
8795 VENDOR_MSG_BOXES_END:RETURN 
8799 ! 
8800 SOURCE_COMP_ENTRY:
8805 DIM J$(3),J1$(50)
8810 PRINT @(0,7+V0),'CE',@(0,10),'SB',@(0,10),"Source company code:",'SF',
8815 CALL "ZZENTR","ZU",A{ALL},J$,X4$,X3$,21,10,1,3,C0,"","","R/L","AP2DAA40","ZZ2CAB","",""; IF ABS(C0)>4 THEN GOSUB WHOLE_SCREEN; PRINT @(0,7+V0),'CE',@(0,10),'SB',@(0,10),"Source company code:",'SF',@(21,10),J$,@(25,10),J1$(7,40),; ON C0 GOTO 8815,8816
8820 READ (Z[6],KEY="R/L"+J$,DOM=8815)J0$
8825 READ (Z[6],KEY="CMP"+J$,DOM=8815)J1$
8830 PRINT @(25,10),J1$(7,40),
8835 CALL "ZZPROM","10",X3$,Z0,"","","",0; IF Z0=0 THEN GOTO 8815
8840 A$(104,3)=J$,A$(107,1)=J0$(10,1)
8845 SOURCE_COMP_ENTRY_END:RETURN 
8899 ! 
8900 NO_FY_REC:
8910 TEXT$=MSG("FY_INVALID")+SEP+MSG("AP_SYS_PRM"); MSGBOX TEXT$,MSG("ATTN"),"!"; FY$="",ACCTPD$=""; RETURN 
8915 ! 
8930 REM "Verify skip of A/P entry from P/O receipt
8935 IF LEN(Q3$)<30 THEN GOTO 9700 ELSE IF Q3$(30,1)="D" THEN GOTO 9700
8940 CALL "ZZPROM",".Y",X3$,S3,"|Verify that you wish to bypass entry of this A/P invoice","","",0
8945 ON S3 GOTO 9700,1360
8949 ! 
8950 PROGRAM_FLOW_LOGIC:
8960 DIM U0$(6); U0$(1)=FID(0),U0$=U0$+"PF"
8970 CLOSE (14); OPEN (14)"ZZPARM"; FIND (14,KEY=U0$,DOM=8990)U0$,U1$
8975 IF U1$(1,6)<>X0$ THEN Q3$=""; GOTO 8990
8980 Q1=NUM(U1$(7,2)),Q3$=U1$(9,Q1),U1$=U1$(Q1+9)
8990 PROGRAM_FLOW_LOGIC_END:RETURN 
8999 ! 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9300 SETESC 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB WHOLE_SCREEN
9520 ON C9 GOTO 1140,2040
9700 REM "PROG FLOW
9710 IF U1$="" THEN REMOVE (Z[6],KEY=U0$,DOM=9900); GOTO 9900
9715 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9720 WRITE (Z[6],KEY=U0$)U0$,U1$
9725 L0=0; PRINT @(0,3),'CE',
9730 RUN U1$(1,6)
9799 ! 
9900 CLOSE_FILES:
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9915 CLOSE_FILES_END:EXIT 
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
10000 ! 
11550 FORMAT_VENDOR:
11555 PAD_CHAR$=" ",PAD_POS=1
11560 IF NUM(FIELD$,ERR=*NEXT) THEN PAD_CHAR$="0",PAD_POS=0
11565 DIV$=MID(FIELD$,1,%AP_DIV_LEN)
11570 VEND$=PAD(MID(FIELD$,%AP_DIV_LEN+1),%VEND_LEN,PAD_POS,PAD_CHAR$)
11575 FIELD$=STR(NUM(DIV$,ERR=*NEXT):"00")+PAD(VEND$,8,1,"0"); GOTO FORMAT_VENDOR_END
11576 ERR_MSG$=MSG("INVA_DIV"); EXIT 
11595 FORMAT_VENDOR_END:RETURN 
11599 ! 
20000 SPECIAL_DESC:
20010 IF NOT(NUL(%F1$(8,16))) THEN SPECIAL_DESC_1$=STP(%F1$(8,16),1)+":"
20020 IF NOT(NUL(%F1$(28,16))) THEN SPECIAL_DESC_2$=STP(%F1$(28,16),1)+":"
20030 IF NOT(NUL(%F1$(48,16))) THEN SPECIAL_DESC_3$=STP(%F1$(48,16),1)+":"
20040 IF NOT(NUL(%F1$(68,16))) THEN SPECIAL_DESC_4$=STP(%F1$(68,16),1)+":"
20090 SPECIAL_DESC_END:RETURN 
20095 ! 
20100 FY_ENTRY_SELECT:! After selecting FY
20120 PERFORM "APGUT3.1;FY_ENTRY"; %FY$=FY$ ! ; IF STP(VENDOR$)="" THEN NEXT_ID=VENDOR.CTL
20195 RETURN 
20199 ! ******************************************************
56005 REM "5.4 - 03/21/06 - 16.962222 - kmc - SSP# 194087
56006 ! "192329-When PO Receiving an order and you are NOT divisionalized   
56007 ! "       the Our REf No. on the AP invoice does not display correctly
