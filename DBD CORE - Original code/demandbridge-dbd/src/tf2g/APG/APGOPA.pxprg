0010 ! APGOPA - File Maintenance Program for FS1_OrderHdr (="FS1"+%C$)
0020 ! Generated by ProvideX® NOMADS II File Maintenance on Mar. 24, 2003 9:11
0030 ! ************************************************************************
0035 REM "5.5 - 08/31/07 - 10.535 - jdf - SSP# 211380
0037 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 IF TCB(13)=1 THEN BEGIN 
0060 VENDOR$=%VENDOR$
0070 PROCESS "APGOPA","../APG/AP.EN"
0080 %VENDOR$=VENDOR$
0090 EXIT 
0095 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 _SV_KR=PRM('KR'); SET_PARAM 'KR'=0 ! Ensure native handling of KEP()
0140 CHANGE_FLG=0,_ENABLE_FLG=0,_KCNT=1,_FIRST_KEY=0,_FIRST_FIELD=0
0163 X2=-1; X0=-1
0165 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2
0170 DIM Z[NUM(X3$(60,3))]
0175 Z$="01O PO1...  02O PO2...  03O AP4...  05O AR1...  130 ZZPARM  "
0180 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
0190 ! IO list
0200 DIM PO2[27]
0210 ! iolist for VENDOR information
0220 IOLIST PO1$
0225 ! iolist for Order
0230 IOLIST PO2$,PO2{ALL}
0240 IOLIST AP4$
0250 IOLIST AR1$
0265 RETURN 
0300 ! 300 - Set up the message library
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0520 IF %VENDOR$<>"" THEN {
0530 VENDOR$=%VENDOR$
0540 DISABLE CONTROL VENDOR.CTL
0550 GOTO GET_VENDOR }
0560 NEXT_ID=VENDOR.CTL,REFRESH_FLG=1
0570 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0915 %LOC_TYPE$="",%VEND_DIV$="",%VEND_CODE$=""
0920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0960 SET_PARAM 'KR'=_SV_KR
0970 RETURN 
2000 ! get the VENDOR information
2010 GET_VENDOR:
2020 KEY_3$=VENDOR$
2030 READ (Z[3],KEY=VENDOR$,DOM=*RETURN)IOL=0240
2080 GOSUB LIST_ORDERS
2090 REFRESH_FLG=1
2110 RETURN 
2200 ! Get the CUSTOMER Information
2210 GET_CUSTOMER:
2215 DIM AR1$(300); CUST_NUM$=""
2220 IF NUL(PO1$(179,10)) THEN RETURN 
2230 KEY_5$=PO1$(179,10)
2240 CUST_NUM$=FN%ZZDISP$(KEY_5$,"A/R")
2250 FIND (Z[5],KEY=KEY_5$,DOM=*RETURN)IOL=0250
2290 RETURN 
2400 ! List the open Orders for the VENDOR specified
2410 LIST_ORDERS:
2416 LIST_BOX LOAD PO_ORDER.CTL,""
2420 KEY_1$=""
2430 READ (Z[1],KNO=1,KEY=VENDOR$,DOM=*NEXT)
2440 KEY_1$=KEY(Z[1],END=*RETURN); READ (Z[1])IOL=0220
2450 IF KEY_1$(1,10)<>VENDOR$ THEN RETURN 
2460 D1$=PO1$(192,6); D2$=PO1$(291,6)
2462 BL$=""
2463 IF PO1$(173,1)="S" THEN BL$='SF'+'_YELLOW'; CALL "*WINGRP;SHOW",INVO2.GRP$
2464 ! GOSUB CHECK_ORDER; IF BO_FLG THEN BL$='B?'; CALL "*WINGRP;SHOW",INVO3.GRP$
2465 CUST_NAME$=""; GOSUB GET_CUSTOMER; IF NOT(NUL(AR1$(11,35))) THEN CUST_NAME$=AR1$(11,35)
2467 IF LEN(STP(PO1$(297,9)))=8 THEN PO_N$=PO1$(297,2)+"-"+PO1$(299,6) ELSE PO_N$=PO1$(297,2)+"-"+PO1$(299,6)+"-"+PO1$(305,1)
2470 CALL "ZZWDTE;DISPLAY",D1$,A1$,A2$; CALL "ZZWDTE;DISPLAY",D2$,A1$,A2$
2480 LIST_BOX LOAD PO_ORDER.CTL,0,BL$+PO_N$+SEP+BL$+D1$+SEP+BL$+CUST_NUM$+SEP+BL$+CUST_NAME$+SEP+BL$+D2$+SEP+BL$+PO1$(17,4)+SEP+BL$+PO1$(21,35)
2490 ! READ (Z[2],KNO=1,KEY=KEY_2$,DOM=*NEXT)
2500 GOTO 2440
2510 RETURN 
2700 ! load the list box with the header
2710 LOAD_HEADER:
2720 LIST_BOX REMOVE PO_ORDER.CTL
2730 LIST_BOX PO_ORDER.CTL,@(2,6,78,19),OPT="r",FMT="[Order No.]l12 [Order Date]l10 [Req. Date]l10 [P/O #]l15 [Order Amt.]r10 [Ordered by]l20"
2740 RETURN 
2900 ! Get the order header information from the first panel
2910 SELECT_ORDER:
2911 ! READ DATA FROM PO_ORDER$ TO XX1$,XX2$,XX3$,XX4$,XX5$,XX6$
2920 LIST_BOX READ PO_ORDER.CTL,IDX
2930 LIST_BOX FIND PO_ORDER.CTL,IDX,ORD_HEAD$
2935 ! XX=POS($1B53461B4236$=ORD_HEAD$); IF XX<>0 THEN ORD_HEAD$=ORD_HEAD$(1,XX-1)+ORD_HEAD$(XX+6); GOTO 2935
2936 ! XX=POS($1B423F$=ORD_HEAD$); IF XX<>0 THEN ORD_HEAD$=ORD_HEAD$(1,XX-1)+ORD_HEAD$(XX+3); GOTO 2936
2937 XX=POS($1B53461B4233$=ORD_HEAD$); IF XX<>0 THEN ORD_HEAD$=ORD_HEAD$(1,XX-1)+ORD_HEAD$(XX+6); GOTO 2937
2940 ORDER_NUMBER$=ORD_HEAD$(1,POS(SEP=ORD_HEAD$)-1),ORD_HEAD$=ORD_HEAD$(POS(SEP=ORD_HEAD$)+1)
2945 IF ORDER_NUMBER$="" THEN RETURN 
2950 ORDER_DATE$=ORD_HEAD$(1,POS(SEP=ORD_HEAD$)-1),ORD_HEAD$=ORD_HEAD$(POS(SEP=ORD_HEAD$)+1)
2960 CUST_NUM$=ORD_HEAD$(1,POS(SEP=ORD_HEAD$)-1),ORD_HEAD$=ORD_HEAD$(POS(SEP=ORD_HEAD$)+1)
2970 C_NAME$=ORD_HEAD$(1,POS(SEP=ORD_HEAD$)-1),ORD_HEAD$=ORD_HEAD$(POS(SEP=ORD_HEAD$)+1)
2975 SC_DATE$=ORD_HEAD$(1,POS(SEP=ORD_HEAD$)-1),ORD_HEAD$=ORD_HEAD$(POS(SEP=ORD_HEAD$)+1)
2980 P_CODE$=ORD_HEAD$(1,POS(SEP=ORD_HEAD$)-1),ORD_HEAD$=ORD_HEAD$(POS(SEP=ORD_HEAD$)+1)
2985 P_NAME$=ORD_HEAD$
2987 Z2$=STR(Z[2]); Z1$=STR(Z[1])
2988 ORD_NUM$=STP(ORDER_NUMBER$,3,"-")
2990 PROCESS "APGOPA.1","../APG/AP.EN",ORDER_NUMBER$,ORDER_DATE$,CUST_NUM$,C_NAME$,SC_DATE$,Z2$,Z1$
3000 RETURN 
3100 ! Get the line on each order
3110 SELECT_LINE:
3115 LIST_BOX LOAD ORDER_LINE.CTL,""
3118 PO_NUMBER$=PAD(STP(ARG_1$,3,"-"),9)
3120 KEY_2$=""; KEY_2$=PO_NUMBER$; Z2=NUM(ARG_6$); DIM PO2[27]
3130 READ (Z2,KEY=KEY_2$,DOM=*NEXT)
3140 KEY_2$=KEY(Z2,END=*RETURN)
3150 READ (Z2,KEY=KEY_2$,DOM=*RETURN)IOL=0230
3160 IF KEY_2$(1,9)<>PO_NUMBER$ THEN RETURN 
3172 BL$=""
3173 IF PO2[12]<>0 THEN BL$='SF'+'_RED'; CALL "*WINGRP;SHOW",INVO4.GRP$
3175 IF PO2$(6,1)="Y" THEN BL$='SF'+'_CYAN'; CALL "*WINGRP;SHOW",INVO.GRP$
3190 LIST_BOX LOAD ORDER_LINE.CTL,0,BL$+PO2$(7,3)+SEP+BL$+PO2$(101,10)+SEP+BL$+PO2$(28,40)+SEP+BL$+STR(PO2[11]:"###,###,###.00-")+SEP+BL$+STR(PO2[1]:"###,###,###.00-")+SEP+BL$+PO2$(77,4)+SEP+BL$+STR(PO2[4]:"###,###,###.00")
3200 GOTO 3140
3210 RETURN 
3500 ! Get the line info for each the order
3510 SELECT_LINE_INFO:
3520 LIST_BOX READ ORDER_LINE.CTL,IDX
3530 LIST_BOX FIND ORDER_LINE.CTL,IDX,ORD_LINE$
3535 XX=POS($1B53461B4231$=ORD_LINE$); IF XX<>0 THEN ORD_LINE$=ORD_LINE$(1,XX-1)+ORD_LINE$(XX+6); GOTO 3535
3537 XX=POS($1B53461B4236$=ORD_LINE$); IF XX<>0 THEN ORD_LINE$=ORD_LINE$(1,XX-1)+ORD_LINE$(XX+6); GOTO 3537
3540 ORD_LN$=ORD_LINE$(1,POS(SEP=ORD_LINE$)-1)
3545 IF ORD_LN$="" THEN RETURN 
3680 PROCESS "APGOPA.4","../APG/AP.EN",PO_NUMBER$,ORD_LN$,ARG_6$,ARG_7$
3690 RETURN 
4000 ! Load Purchase Order Detail
4010 LOAD_DETAIL:
4020 Z1=NUM(ARG_4$); Z2=NUM(ARG_3$)
4030 DIM PO2[27]
4035 READ (Z1,KNO=0,KEY="",ERR=*NEXT)
4040 KEY_1$=ARG_1$; KEY_2$=ARG_1$+ARG_2$
4050 READ (Z1,KEY=KEY_1$,DOM=*NEXT)IOL=0220; GOSUB LOAD_PO_HEAD
4060 READ (Z2,KEY=KEY_2$,DOM=*RETURN)IOL=0230; GOSUB LOAD_PO_DETAIL
4080 REFRESH_FLG=1
4090 RETURN 
4200 ! Load the Purchase Order Header Information
4210 LOAD_PO_HEAD:
4220 AP4=HFN; OPEN (AP4)"AP4"+%C$
4225 VENDOR$=PO1$(7,10); GOSUB LOAD_VENDOR_INFO
4230 PLANT_CODE$=PO1$(17,4); PLANT_NAME$=PO1$(21,35)
4240 PLANT_ATTN$=PO1$(56,30)
4250 PLANT_ADDR_1$=PO1$(86,30); PLANT_ADDR_2$=PO1$(116,30)
4260 PLANT_CITY$=PO1$(146,16); PLANT_ST$=PO1$(162,2); PLANT_ZIP_CODE$=PO1$(164,9)
4270 PO_TYPE$=PO1$(173,1); ORDER$=PO1$(306,8); CUSTOMER$=PO1$(179,10)
4280 PRINT_THIS_PO$=PO1$(189,1); NEW_REPEAT$=PO1$(190,1)
4290 CONFIRMING$=PO1$(191,1); PO_DATE$=PO1$(192,6); GROUPING_CUTOFF_DATE$=PO1$(198,6)
4300 DATE_REQ$=PO1$(204,6); TERM_CODE$=PO1$(210,2)
4310 CUST_PO$=PO1$(328,15); SPER_CODE$=PO1$(343,4); CUST_SERV_REP$=PO1$(347,4)
4320 RUSH_SERVICE_PER$=PO1$(314,12); RUSH_SERV_WORK_DAYS$=PO1$(326,2)
4330 PLANT_CODE_NUM$=PO1$(210,2); PLANT_QUOTE_NUM_DATE$=PO1$(224,6)
4340 PREV_JOB_NUM$=PO1$(230,12); PREV_JOB_NUM_DATE$=PO1$(242,6)
4350 JOB_NUM$=PO1$(248,12); JOB_DATE$=PO1$(260,6)
4360 JOB_STATUS$=PO1$(266,12); JOB_STATUS_DATE$=PO1$(278,6)
4370 PROOF_STATUS$=PO1$(284,1); PROOF_STATUS_DATE$=PO1$(285,6)
4380 SCHED_SHIP_DATE$=PO1$(291,6); SEND_UNITED_DATA$=PO1$(352,1)
4390 REFRESH_FLG=1
4399 RETURN 
4400 ! Load the Line Detail Information
4410 LOAD_PO_DETAIL:
4420 LINE_NUM$=MID(PO2$,7,3); LINE_TYPE$=MID(PO2$,10,1)
4430 SPECS_REQ$=MID(PO2$,81,1); SPECIAL_SHIPPING$=MID(PO2$,14,1)
4440 PLYS$=MID(PO2$,15,2); LEFT_RIGHT$=MID(PO2$,17,8); TOP_BOTTOM$=MID(PO2$,111,8)
4450 PROD_CODE$=MID(PO2$,25,3); TF_DESC$=MID(PO2$,28,40); STARTING_NUM$=MID(PO2$,68,9)
4460 UM$=MID(PO2$,77,4); PO_NUM$=MID(PO2$,82,9); CUSTOMER$=MID(PO2$,91,10)
4470 ITEM_CODE$=MID(PO2$,101,10)
4480 STORAGE_EXP_DATE$=MID(PO2$,150,6); PROD_CODE_OVERRIDE$=MID(PO2$,156,3)
4490 COMM_CODE$=MID(PO2$,159,5); STND_COST_UOM$=MID(PO2$,164,4)
4500 COST=PO2[0]; UM_AMT=PO2[2]; EXT=PO2[4]
4510 LABEL_NUM=PO2[3]; CTN_PACK=PO2[5]; REAL_QTY_ORDERED=PO2[11]
4520 STND_UNIT_COST=PO2[22]; STND_COST_QTY_PER=PO2[23]
4580 REFRESH_FLG=1
4590 RETURN 
4700 ! Get the Vendor information
4710 LOAD_VENDOR_INFO:
4720 KEY_AP4$=VENDOR$
4730 READ (AP4,KEY=KEY_AP4$,DOM=*RETURN)IOL=0240
4740 VEND_ADDR_1$=AP4$(46,30); VEND_ADDR_2$=AP4$(76,30)
4750 VEND_CITY$=AP4$(106,16); VEND_ST$=AP4$(122,2); VEND_ZIP$=AP4$(124,9)
4760 VEND_CONT_PERSON$=AP4$(155,20)
4790 REFRESH_FLG=1
4795 RETURN 
5000 ! check the order details
5010 CHECK_ORDER:
5015 BO_FLG=0
5020 KEY_1$=KEY_2$(11,8)
5030 READ (Z[1],KEY=KEY_1$,DOM=*NEXT)
5040 KEY_1$=KEY(Z[1],END=*RETURN); READ (Z[1],KEY=KEY_1$)IOL=0240
5045 IF KEY_1$(1,8)<>KEY_2$(11,8) THEN RETURN 
5050 IF FS2$(48,1)="Y" OR FS2[8]<>0 THEN BO_FLG=1
5060 GOTO 5040
5090 RETURN 
9999 END 
56000 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
