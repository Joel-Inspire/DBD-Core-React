0010 ! APGMDA - SalesPerson Statistical Data
0030 ! ************************************************************************
0035 REM "5.5 - 06/12/06 - 15.560555 - tma - SSP# 196898
0037 REM "196898-Ref. 186869 Getting a gui error in Salesperson Statistical  
0040 REM "Copyright 2006 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0042 _VENDOR$=%VENDOR$ ! SSP 196869
0050 PROCESS "APGMDS","../APG/AP.EN"
0060 %VENDOR$=_VENDOR$
0070 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 ! 
0130 X0$="APGMDS"
0140 X0=-1; X2=-1
0150 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2
0160 ! 
0170 ! Dim Variables
0180 DIM Z[NUM(X3$(60,3))],AP9[14],AP4[2],APJ[2]
0190 ! 
0200 ! open Files
0210 Z$="06O ZZPARM  "
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z1,Z2
0230 GOSUB GET_PARAMS
0240 Z$="01O APS..."+"  02O "+F9$(35,6)+"  "
0250 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z1,0
0300 ! Iolist Area
0310 IOLIST PER_DATE$
0320 IOLIST AP9$,AP9{ALL}
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0520 IF %VENDOR$<>"" THEN {
0530 VENDOR$=%VENDOR$
0540 DISABLE CONTROL VENDOR.CTL
0545 REFRESH_FLG=1
0550 ! GOSUB PROCESS_VENDOR
0560  } ! GOSUB LOAD_INVOICE }
0570 NEXT_ID=VENDOR.CTL
0590 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0970 RETURN 
2000 ! Get the statistical data for the Vendor
2010 GET_STAT_DATA:
2020 DIM AP9[14]
2030 READ (Z[1],KEY=VENDOR$+SLS_MAN$+FISYR$+BAL_TYPE$,DOM=*RETURN)IOL=0320
2040 NEXT_ID=EXIT_1.CTL
2050 REFRESH_FLG=1
2090 RETURN 
3000 ! load Period End Dates for the fiscal year chosen...
3010 PERIOD_END_DATES:
3030 READ (Z[13],KEY=X3$(9,3)+"G/LYE"+FISYR$,DOM=*RETURN)IOL=0310
3040 NEXT_ID=SLS_MAN.CTL
3050 REFRESH_FLG=1
3090 RETURN 
4000 ! load statistics Information
4010 LOAD_INFO:
4015 T_AP9=0
4018 READ (Z[13],KEY=X3$(9,3)+"G/LYE"+FISYR$,DOM=*RETURN)IOL=0310
4020 FOR ZZ=1 TO 13; LIST_BOX LOAD STAT_DATA.CTL,1,*; NEXT ZZ
4030 FOR II=1 TO NUM(PER_DATE$(13,2))
4040 D1$=PER_DATE$(15+II*6,6)
4050 CALL "ZZWDTE;Display",D1$,A1$,B1$
4060 D1$=STR(II:"00. ")+D1$
4070 T_AP9+=AP9[II]
4080 LIST_BOX LOAD STAT_DATA.CTL,0,D1$+SEP+STR(AP9[II]:"###,###,###.00-")+SEP+STR(T_AP9:"###,###,###.00-")
4090 NEXT II
4190 RETURN 
8000 ! get system parameters
8010 GET_PARAMS:
8020 DIM SEC$(255); FIND (Z[6],KEY="osec"+X3$(40,3),DOM=*NEXT)SEC$
8030 READ (Z[6],KEY=X3$(9,3)+"G/L",DOM=*NEXT)F0$
8040 READ (Z[6],KEY="STAT"+"A/P",DOM=*NEXT)F9$,F0
8190 RETURN 
9999 END 
30180 LOAD_FISCAL_YEAR:
30190 ZZPARM=HFN
30200 OPEN (ZZPARM)"ZZPARM"
30210 READ (ZZPARM,KEY=%C$+"G/L",DOM=*NEXT)GL_REC$; CR_YEAR$=GL_REC$(34,4),CR_PD$=GL_REC$(38,2)
30215 IF NUL(FISYR$)=0 THEN CR_YEAR$=FISYR$
30220 KE$=%C$+"G/LYE",FISYR$=""
30230 READ (ZZPARM,KEY=KE$,DOM=*NEXT)
30240 K$=KEY(ZZPARM,END=30280); READ (ZZPARM)Z9$
30250 IF LEN(K$)<8 OR KE$<>K$(1,8) THEN GOTO END_LOAD_FISCAL_YEAR
30260 FISYR$=FISYR$+K$(9)+"/"
30265 IF K$(9,4)=CR_YEAR$ THEN CC$=Z9$(21)
30270 GOTO 30240
30280 END_LOAD_FISCAL_YEAR:
30290 DROP_BOX LOAD FISYR.CTL,FISYR$
30300 DROP_BOX WRITE FISYR.CTL,CR_YEAR$
30310 DROP_BOX LOAD END_FISCAL.CTL,FISYR$
30320 DROP_BOX WRITE END_FISCAL.CTL,CR_YEAR$
30321 FISYR$=CR_YEAR$
30322 IF NUL(RPT_PER$)=0 THEN CR_PD$=RPT_PER$
30325 RPT_PER$=""
30330 FOR ACCT=1 TO 12; RPT_PER$=RPT_PER$+STR(ACCT:"00")+"/"; NEXT ACCT
30340 DROP_BOX LOAD RPT_PER.CTL,RPT_PER$
30350 DROP_BOX WRITE RPT_PER.CTL,CR_PD$
30355 RPT_PER$=CR_PD$
30360 END_ACCTPD$=RPT_PER$
30370 DROP_BOX LOAD END_ACCTPD.CTL,RPT_PER$
30380 DROP_BOX WRITE END_ACCTPD.CTL,CR_PD$
30390 RETURN 
40000 ! Load Variables
40010 LOAD_VAR:
40020 ARG_1$=""; ARG_2$=""; ARG_3$=""; ARG_4$=""; ARG_5$=""
40030 FOR XX9=1 TO NUM(PER_DATE$(13,2)); ARG_1$+=STR(AP9[XX9])+","; NEXT XX9; ARG_1$=ARG_1$(1,LEN(ARG_1$)-1)+"/"
40040 ARG_2$="A/P Salesman Statistical Data Inquiry"
40050 FOR XX9=1 TO NUM(PER_DATE$(13,2)); IF AP9[XX9]=0 THEN NEXT XX9 ELSE ARG_3$+=STR(XX9:"00")+"="+STR(AP9[XX9])+"/"; NEXT XX9
40060 FOR XX9=1 TO NUM(PER_DATE$(13,2)); ARG_4$+=STR(XX9:"00")+"/"; NEXT XX9
40070 IF BAL_TYPE$="P" THEN ARG_5$="PURCHASES" ELSE ARG_5$="ADJUSTMENTS"
40080 RETURN 
40090 LOAD_GRAPHIC:
40100 VAR$=ARG_1$,CHART_1.CTL'TITLE1$=ARG_2$,VAL1$=ARG_3$,VAR2$=ARG_4$,XAXISTITLE$=ARG_5$
40110 GOSUB DEFAULTS
40120 FOR XX=1 TO 12; VAL3$=VAL3$+" =0/"; NEXT XX
40130 IF CB_3D$="0" THEN CHART_1.CTL'TITLE2$=ARG_2$,CHART_1.CTL'TITLE1$="" ELSE CHART_1.CTL'TITLE1$=ARG_2$,CHART_1.CTL'TITLE2$=""
40140 MTHS$=MSG("MTHS")
40150 FOR XX=1 TO LEN(MTHS$) STEP 3; MONTHS$=MONTHS$+MTHS$(XX,1)+"="+MTHS$(XX,3)+" "; NEXT XX
40160 PERFORM "GLGMDA;SELECT_GRAF" ! CHART LOAD CHART_1.CTL,VAR$
40170 REFRESH_FLG=1,B_GRAF$=""
40180 CHART ENABLE AA
40190 RETURN 
40220 SET_DEFAULTS:
40230 WRITE (_ZZPARM,KEY="*apgmds*"+%X3_OP_ID$)CB_3D$,BACKCOLOR$,COLORS$,GRAF$,LB_GRAP$,FONT$
40240 DEFAULTS: _ZZPARM=FFN("ZZPARM"); IF _ZZPARM<0 THEN _ZZPARM=HFN; OPEN (_ZZPARM)"ZZPARM"
40250 READ (_ZZPARM,KEY="*apgmds*"+%X3_OP_ID$,DOM=*NEXT)CB_3D$,BACKCOLOR$,COLORS$,GRAF$,LB_GRAP$,FONT$; GOTO *RETURN
40260 CB_3D$="1",BACKCOLOR$="Light White",COLORS$="Light Yellow",GRAF$="AREA",LB_GRAP$="1",FONT$="Georgia"
40270 GOTO SET_DEFAULTS
40280 RETURN 
56000 ! "196869-program exception looking at vendor statistical data        
56001 REM "196898-Ref. 186869 Getting a gui error in Salesperson Statistical  
