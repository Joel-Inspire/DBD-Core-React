0010 ! DTGDT0 class            
0030 ! 
0035 REM "5.5 - 09/24/07 - 10.729444 - jme - SSP# 203099
0037 REM "203099-Enhancements to Output Director.  Provide ability for       
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 DEF CLASS "DTGDT0" CREATE REQUIRED DELETE REQUIRED 
0110 LIKE "FILE"
0200 ! start variable list
0210 LOCAL DT0
0215 LOCAL OPEN_STATUS
0220 PROPERTY DT0_KEY$,DT0$
1000 FUNCTION GETDT0KEY(X0$,X1$,X2$,X3$,X4$,X5$,X6$,X7$,X8$)
1010 ENTER DTYPE$,SEG1$,SEG2$,SEG3$,SEG4$,SEG5$,SEG6$,SEG7$,SEG8$
1012 IOLIST DT0$
1015 FILENO=DT0
1020 X=_OBJ'READBYKEY(0,DTYPE$)
1030 X=_OBJ'READNEXT(); IF OUTPUT_TYPE$<>DTYPE$ THEN X=0
1045 OK=0
1050 WHILE X AND NOT(OK)
1070 DT0_TEST$=DIVISION$+KEY1$+KEY2$+KEY3$; SEG_TEST$=SEG1$+SEG2$+SEG3$+SEG4$+SEG5$+SEG6$+SEG7$+SEG8$; SEG_TEST$=PAD(SEG_TEST$,37,"~")
1080 FOR J=1 TO 37
1082 IF DT0_TEST$(J,1)=" " THEN DT0_TEST$(J,1)="~" ! convert existing file values
1085 IF DT0_TEST$(J,1)="~" THEN SEG_TEST$(J,1)="~" ! dont compare values if ~ is in dt0
1087 ! when blanks are entered in dt0 maint they are converted to ~ - this represents an 'all' value , therefore that value will not be tested
1090 NEXT J
1100 IF DT0_TEST$=SEG_TEST$ THEN OK=1,DT0_KEY$=DT0_TEST$
1120 IF OK THEN READ DATA FROM REC(IOL(FILENO)) TO IOL=1012
1150 IF NOT(OK) THEN X=_OBJ'READNEXT(); IF OUTPUT_TYPE$<>DTYPE$ THEN X=0
1180 WEND 
1190 RETURN OK
1200 FUNCTION GETNEXTDT0SEQ()
1205 FILENO=DT0
1220 X=_OBJ'READNEXT(); IF X THEN IF OUTPUT_TYPE$<>TYPE$ OR DIVISION$+KEY1$+KEY2$+KEY3$<>DT0_KEY$ THEN X=0
1230 IOLIST DT0$
1240 READ DATA FROM REC(IOL(FILENO)) TO IOL=1230
1290 RETURN X
1300 FUNCTION PRINT_REPORT(X,X$)
1310 ENTER PRINTER_CHAN,REPORT$
1315 IF WHO="jme" THEN ESCAPE 
1320 PRINT 'MESSAGE'('_BLUE'+'WHITE'+"OPENING RPT OBJECT",0)
1330 %RW_USEROUTPUT$="*rpt/rptoutput.pvc"; IF DT0$(427,1)<>"P" THEN %RW_USEROUTPUT$="*rpt/rpttext.pvc"
1340 ! CLOSE (PRINTER_CHAN); PRINTER_CHAN=HFN; OPEN PURGE (PRINTER_CHAN)"/tmp/jme.txt"
1360 RPT=NEW("*rpt/pvxreport"); IF NOT(RPT) THEN GOTO *RETURN
1370 PRINT 'MESSAGE'('_BLUE'+'WHITE'+"OPENING REPORT",0)
1400 IF RPT THEN {! 6900
1410 RPT_O=0; RPT_O=RPT'OPEN(REPORT$,ERR=*NEXT)
1415 IF RPT_O THEN {! 1890
1420 PRINT 'MESSAGE'('_BLUE'+'WHITE'+"SELECTING OUTPUT",0)
1450 SWITCH DT0$(61,1) ! output type
1460 CASE "1" ! printer
1470 RPT'OUTPUTPRINT(PRINTER_CHAN)
1490 BREAK
1700 DEFAULT ! text
1710 IF DT0$(427,1)<>"P" THEN {
1720 RPT'OUTPUTUSER(PRINTER_CHAN)
1740  } ELSE {
1750 RPT'OUTPUTPRINT(PRINTER_CHAN)
1780  }
1790 END SWITCH 
1795 PRINT 'MESSAGE'('_BLUE'+'WHITE'+"PRINTING REPORT",0)
1800 RPT'RUNREPORT() ! run report
1805 PRINT 'MESSAGE'('_BLUE'+'WHITE'+"CLOSING REPORT",0)
1850 RPT'CLOSE() ! close report
1890  } ! 1415
1900  } ! 6050
1950 DROP OBJECT RPT
1955 WAIT 2
1990 RETURN 
8999 END DEF
9999 END 
10000 ON_CREATE:
10005 OPEN_STATUS=0
10007 FILENAME$="DT0"
10010 COMPANY$=%C$ ! OOP_SYS=NEW("SYSTEM"); COMPANY$=OOP_SYS'GET_COMPANY$; DROP OBJECT OOP_SYSS
10051 OPEN (HFN,IOL=*,ERR=*RETURN)FILENAME$+COMPANY$ ! open object command prevents file i/o to opened channel outside object
10060 DT0=LFO
10070 STATIC IOL=IOL(DT0)
10080 OPEN_STATUS=1
10090 RETURN 
10098 ! 
10099 ! 
10100 ON_DELETE:
10110 IF OPEN_STATUS THEN CLOSE (DT0)
10190 RETURN 
10198 ! 
10199 ! 
56000 REM "211408-Modify Purchase Order Printing to integrate with            
