0010 REM Purchase Order Output Control Maintenance  <DTGOMA.U>
0035 REM "5.5 - 09/25/07 - 11.844722 - jme - SSP# 212091
0037 REM "212091-TOD Purchase Order - Output Director control maintenance    
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0052 REM "This program is called from DTGOMA. It cannont be run
0053 REM "stand alone.
0099 REM + End Program Notes
0100 IF TCB(13)=1 THEN RUN "ZMENU" ELSE EXIT 
0310 IOLIST DT0$
0320 IOLIST AP4$,AP4[0],AP4[1]
0330 IOLIST ARH$,ARH[0]
0340 IOLIST FMP$
9000 ! 9000 - Retrieve messages from the *msglib.xxx library
9010 SETUP_MESSAGES:
9020 _FYI$=MSG("FYI"),_ERROR$=MSG("ERROR")
9030 _MSG_DIRECTORY$=MSG("DIRECTORY")
9040 _MSG_END_OF_FIL$=MSG("END_OF_FIL")
9050 _MSG_FILOPNERR1$=MSG("FILOPNERR1")
9060 _MSG_JUST_CHECK$=MSG("JUST_CHECK")
9070 _MSG_MANDATORY$=MSG("MANDATORY")
9080 _MSG_NEXT$=MSG("NEXT")
9090 _MSG_NON_NUMER$=MSG("NON_NUMER")
9100 _MSG_NOT_FOUND$=MSG("NOT_FOUND")
9110 _MSG_OVRWRT_CHG$=MSG("OVRWRT_CHG")
9120 _MSG_PRECEDING$=MSG("PRECEDING")
9130 _MSG_PREFIX$=MSG("PREFIX")
9140 _MSG_REC_ACCESS$=MSG("REC_ACCESS")
9150 _MSG_REC_ALTERD$=MSG("REC_ALTERD")
9160 _MSG_REC_CR_NEW$=MSG("REC_CR_NEW")
9170 _MSG_REC_LOCKED$=MSG("REC_LOCKED")
9180 _MSG_X$=MSG("REC_MISS","^"),P=POS("^"=_MSG_X$),_MSG_REC_MISS1$=_MSG_X$(1,P-1),_MSG_REC_MISS2$=_MSG_X$(P+1)
9190 _MSG_REC_NOTFND$=MSG("REC_NOTFND")
9200 _MSG_REC_NO_1ST$=MSG("REC_NO_1ST")
9210 _MSG_REC_NO_LST$=MSG("REC_NO_LST")
9220 _MSG_REC_REMOVE$=MSG("REC_REMOVE")
9230 _MSG_REC_UPDADD$=MSG("REC_UPDADD")
9240 _MSG_X$=MSG("REC_VFYDEL","^"),P=POS("^"=_MSG_X$),_MSG_REC_VFYDEL1$=_MSG_X$(1,P-1),_MSG_REC_VFYDEL2$=_MSG_X$(P+1)
9250 _MSG_X$=MSG("REC_VIEW","^"),P=POS("^"=_MSG_X$),_MSG_REC_VIEW1$=_MSG_X$(1,P-1),_MSG_REC_VIEW2$=_MSG_X$(P+1)
9260 _MSG_REQ_FIELDS$=MSG("REQ_FIELDS")
9270 _MSG_START_FILE$=MSG("START_FILE")
9280 _MSG_UPDATE$=MSG("UPDATE")
9290 _MSG_UPD_OTHER1$=MSG("UPD_OTHER1")
9300 _MSG_UPD_OTHER2$=MSG("UPD_OTHER2")
9310 _MSG_UPD_SAME$=MSG("UPD_SAME")
9320 _MSG_WARNING$=MSG("WARNING")
9330 _MSG_CANNOT_WRITE$=MSG("CANT_WRITE")
9340 _MSG_DUP_UNIQUE$=MSG("DUP_UNIQUE")
9350 RETURN 
9999 END 
12000 DT0_LOOKUP:
12002 REM "This routine will call a Query window to display all of the
12004 REM "DT0 records for the Output Type 
12010 VAR$=""
12020 PROCESS "QRY_DT0_PU","../DTG/DT.EN",VAR$
12050 IF VAR$<>"" THEN {
12065 DIVISION$=VAR$(21,2)
12070 VENDOR$=VAR$(23,10),CUSTOMER$=VAR$(33,10)
12075 PLANT$=VAR$(44,4),SHIPTO$=VAR$(48,4)
12080 CALL "ZZWLKU;AR_CUST_VAL",CUSTOMER$,ERR_MSG$,VAR_TAG$
12082 CALL "ZZWLKU;VEND_CODE_VAL",VENDOR$,ERR_MSG$,VAR_TAG$
12084 CALL "ZZWLKU;PLANT_VAL",PLANT$,ERR_MSG$,VAR_TAG$
12086 CALL "ZZWLKU;SHIPTO_VAL",SHIPTO$,ERR_MSG$,VAR_TAG$
12090 DIM DT0_SEG1$(2,"~"),DT0_SEG2$(20,"~"),DT0_SEG3$(10,"~"),DT0_SEG4$(5,"~")
12092 IF STP(DIVISION$)<>"" THEN DT0_SEG1$=DIVISION$
12094 IF STP(VENDOR$)<>"" THEN DT0_SEG2$(1,LEN(VENDOR$))=VENDOR$
12096 IF STP(CUSTOMER$)<>"" THEN DT0_SEG2$(11,LEN(CUSTOMER$))=CUSTOMER$
12098 IF STP(PLANT$)<>"" THEN DT0_SEG3$(1,LEN(PLANT$))=PLANT$
12100 IF STP(SHIPTO$)<>"" THEN DT0_SEG3$(5,LEN(SHIPTO$))=SHIPTO$
12110 EN_INPUT$="N",EN_GRID$="Y"; GOSUB ENABLE_GROUPS
12140 REFRESH_FLG=1
12150 PERFORM "UPDDT0;BUILD_GRID"
12160  } ELSE {
12170 NEXT_ID=DIVISION.CTL
12180  }
12190 REFRESH_FLG=1
12195 RETURN 
17000 SELECT_VENDOR:
17010 IF STP(VENDOR$)="" THEN {
17020 %VEND_NAME$="All"
17040  } ELSE {
17080  }
17085 REFRESH_FLG=1
17090 RETURN 
18000 SELECT_PLANT:
18010 IF LEN(STP(PLANT$))=0 THEN %PLANT_NAME$="All"
18015 REFRESH_FLG=1
18020  } ELSE {
18040 RETURN 
18050 PRE_PLANT:
18055 %ML_VEND_CODE$=VENDOR$,%PLANT_VEND$=VENDOR$
18080  }
18085 REFRESH_FLG=1
18090 RETURN 
18098 ! 
18099 ! 
18200 SELECT_CUSTOMER:
18210 IF LEN(STP(CUSTOMER$))=0 THEN %CUST_NAME$="All"
18215 REFRESH_FLG=1
18290 RETURN 
18327 CUSTOMER$=CUST_DIV$+CUST_CODE$
18390 REFRESH_FLG=1
18395 RETURN 
18400 SELECT_DIVISION:
18410 IF LEN(STP(DIVISION$))=0 THEN {
18415 DIV_NAME$="All"
18420  } ELSE {
18425 DIVISION$=PAD(DIVISION$,2); DIVISION$=STR(NUM(DIVISION$,ERR=*NEXT):"00")
18430 FOUND=0; READ (ARH,KEY=DIVISION$,DOM=*NEXT)ARH$; FOUND=1
18440 IF FOUND THEN DIV_NAME$=ARH$(3,30) ELSE MSGBOX MSG("NOT_FOUND"); DIV_NAME$="",DIVISION$=""; NEXT_ID=DIVISION.CTL
18470  }
18480 REFRESH_FLG=1
18490 RETURN 
18600 PRE_SHIPTO:
18610 %FM0_PREFIX$="C"+CUSTOMER$,%CUSTOMER$=CUSTOMER$
18690 RETURN 
18750 SELECT_SHIPTO:
18760 IF SHIPTO$="" THEN %LOC_DESC$=""
18810 REFRESH_FLG=1
18900 EN_GRID$="Y"
18905 EN_INPUT$="N"
18910 GOSUB ENABLE_GROUPS
18950 DIM DT0_SEG1$(2,"~"),DT0_SEG2$(20,"~"),DT0_SEG3$(10,"~"),DT0_SEG4$(5,"~")
18951 IF STP(DIVISION$)<>"" THEN DT0_SEG1$=DIVISION$
18952 IF STP(VENDOR$)<>"" THEN DT0_SEG2$(1,LEN(VENDOR$))=VENDOR$
18953 IF STP(CUSTOMER$)<>"" THEN DT0_SEG2$(11,LEN(CUSTOMER$))=CUSTOMER$
18954 IF STP(PLANT$)<>"" THEN DT0_SEG3$(1,LEN(PLANT$))=PLANT$
18955 IF STP(SHIPTO$)<>"" THEN DT0_SEG3$(5,LEN(SHIPTO$))=SHIPTO$
18960 PERFORM "UPDDT0;BUILD_GRID"
18995 RETURN 
21000 INIT:
21001 X0$="DTGOMA.P",X1$="Output Control Maintenance"
21002 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,-1,X1,X2; IF X1>0 THEN GOSUB WRAPUP; GOTO *RETURN ! SSP#272144
21003 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=*NEXT)
21004 DIM Z[NUM(X3$(60,3))]
21005 DIM AP4[1],A[1],ARH[1]
21006 SEG2$="",SEG3$="",SEG4$="",SEG5$=""
21010 %NO_X=1
21015 GOSUB CLEAR_FIELDS
21040 CHANGE_FLG=0,_ENABLE_FLG=0,_KCNT=1,_FIRST_KEY=0,_FIRST_FIELD=0
21070 Z$="01X DT0...  03O FM0...  04O AR1...  05O DTG...  06O ARH...  07O FMP...  08O AP4...  "
21080 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; IF Z0>0 THEN GOTO OPEN_ERR
21081 DT0=Z[1],FM0=Z[3],DTG=Z[5],ARH=Z[6],FMP=Z[7],AP4=Z[8]
21082 TYPE_DESC$=%TYPE_DESC$; %TYPE_DESC$="",VTYPE$=%VTYPE$; %VTYPE$=""
21085 DTT$=%DTT$; %DTT$=""
21100 CALL "UPDDTT;GET_VAL_OUT_DROP",DTT$,VAL_OUT_DROP$
21110 CALL "UPDDTG;GET_VAL_OUT_REPT",DTG,DTT$,VAL_OUT_REPT$
21190 RETURN 
21200 OPEN_ERR:
21205 MSGBOX _MSG_FILOPNERR1$+QUO+_FILE_NAME$+QUO+SEP+_MSG_DIRECTORY$+LWD+SEP+_MSG_PREFIX$+PFX,MSG(ERR),"!"
21210 CMD_STR$="END"
21290 RETURN 
22000 MAIN_POST_DISPLAY:
22020 NEXT_ID=DIVISION.CTL
22090 RETURN 
22100 WRAPUP:
22110 %NO_X=0
22120 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
22150 REPLACEMENT_SCRN$="DTGOMA"
22190 RETURN 
22500 SELECT_EXIT:
22510 ! CALL "UPDDT0;VALIDATE_GRID",DT0,DT0_KEY$,OK,ROW,COLUMN; IF NOT(OK) THEN GR'CURRENTCOLUMN=COLUMN,GR'CURRENTROW=ROW; NEXT_ID=GR; GOTO *RETURN
22570 CMD_STR$="END"
22590 RETURN 
22600 SELECT_CLEAR:
22605 GOSUB CLEAR_FIELDS
22610 ! CALL "UPDDT0;VALIDATE_GRID",DT0,DT0_KEY$,OK,ROW,COLUMN; IF NOT(OK) THEN GR'CURRENTCOLUMN=COLUMN,GR'CURRENTROW=ROW; NEXT_ID=GR; GOTO *RETURN
22630 PERFORM "UPDDT0;DELETE_GRID"
22640 EN_INPUT$="Y"; EN_GRID$="N"; GOSUB ENABLE_GROUPS
22650 NEXT_ID=DIVISION.CTL,REFRESH_FLG=1
22690 RETURN 
22800 CLEAR_FIELDS:
22810 DIVISION$="",DIV_NAME$=""
22815 WHSE$="",WHS_DESC$=""
22820 CUSTOMER$="",%CUST_NAME$="",CUST_CODE$="",CUST_DIV$="",VENDOR$="",%VEND_NAME$=""
22825 SHIPTO$=""
22840 PLANT$="",%PLANT_NAME$="",%LOC_DESC$="",%CUSTOMER$=""
22895 RETURN 
55000 ENABLE_GROUPS:
55020 IF EN_INPUT$="Y" THEN CALL "*wingrp;enable",INPUT_FIELDS.GRP$; EN_INPUT$=""
55030 IF EN_INPUT$="N" THEN CALL "*wingrp;disable",INPUT_FIELDS.GRP$; EN_INPUT$=""
55060 IF EN_GRID$="Y" THEN CALL "*wingrp;enable",GRID.GRP$; EN_GRID$=""
55070 IF EN_GRID$="N" THEN CALL "*wingrp;disable",GRID.GRP$; EN_GRID$=""
55290 RETURN 
56000 REM + Modification History
56002 REM "212091-TOD Purchase Order - Output Director control maintenance    
