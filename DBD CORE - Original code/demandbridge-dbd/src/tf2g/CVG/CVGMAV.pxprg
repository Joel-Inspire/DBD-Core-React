0010 ! CVGMAV - File Maintenance Program for APX_GLInterface (="APX"+%C$)
0020 ! Generated by ProvideX® NOMADS II File Maintenance on May. 15, 2003 10:00
0030 ! ************************************************************************
0035 REM "5.7 - 10/12/20 - 13.860833 - crg - SSP# 307309
0037 REM "307309-DBD-113 - Authorize.Net support                             
0040 REM "Copyright 2020 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0042 ! COPIED FROM ARGMAV SSP229993
0045 IF TCB(13)=1 THEN BEGIN 
0050 _CUSTOMER$=%CUSTOMER$
0060 PROCESS "CVGMAV","../CVG/CV.EN"
0070 %CUSTOMER$=_CUSTOMER$
0080 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 ! 
0130 X0$="AR2MAV",X1$="Credit Card Information Setup"
0140 ! 
0150 X0=-1,X2=-1
0160 CALL "ZZCOMP",X0$,X11$,X2$,X3$,X4$,X5$,X0,X1,X2; IF X1>0 THEN GOSUB WRAPUP
0170 ! 
0190 DIM Z[NUM(X3$(60,3))],ARZ$(255),AR1[2],B_ARZ$(255) ! SSP229993, ARZ dim to 255
0200 ! Files
0210 Z$="01X ARZ...  02O AR1...  03O CD0...  04O CD4...  06O ZZPARM  "
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
0300 ! IOList Section
0310 IOLIST ARZ$
0320 IOLIST AR1$,AR1{ALL}
0330 IOLIST VEND$
0400 ! System Parameters
0410 GOSUB GET_SYS_PARAM
0420 AUTHNET$="N"
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0520 IF %CUSTOMER$<>"" THEN {
0530 CUSTOMER$=%CUSTOMER$
0535 %CUST$=CUSTOMER$
0540 DISABLE CONTROL CUSTOMER.CTL
0545 GOSUB GET_MERCH_ACCT
0550 REFRESH_FLG=1; RETURN  }
0560 NEXT_ID=CUSTOMER.CTL
0570 CALL "*wingrp;Show",NAV1.GRP$
0780 REFRESH_FLG=1
0790 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0970 RETURN 
1000 ! find Record
1010 FIND_REC:
1020 KEY_1$=CUSTOMER$+CREDIT_CARD_TYPE$+SEQ_NUM$
1030 FIND (Z[1],KEY=KEY_1$,DOM=NEW_MSG)IOL=0310
1040 ! 
1050 ARGEEMENT_ON_FILE$=ARZ$(19,1)
1055 VAULT_ID$=MID(ARZ$,90,64) ! SSP 229993
1060 CREDIT_CARD_NUMBER$=ARZ$(20,20)
1065 LAST_FOUR$=STP(ARZ$(20,20)),LAST_FOUR$=MID(LAST_FOUR$,LEN(LAST_FOUR$)-3) ! SSP 190139
1070 REM EXPIRATION_DATE$=ARZ$(40,6) ! SSP211214 jdf
1075 IF ARZ$(40,1)="K" THEN EXPIRATION_DATE$=FND$(ARZ$(40,6)) ELSE EXPIRATION_DATE$=ARZ$(40,4) ! SSP211214 jdf ! SSP231477 jdf
1077 MISC_FLD$=ARZ$(44,6) ! SSP231477 jdf
1080 REM NAME_ON_CARD$=ARZ$(46,40) ! SSP211214 jdf
1085 NAME_ON_CARD$=ARZ$(50,40) ! SSP211214 jdf
1090 BILL_ADDR_1$=ARZ$(154,30),BILL_ADDR_2$=ARZ$(184,30),BILL_CITY$=ARZ$(214,16),BILL_ST$=ARZ$(230,2),BILL_ZIP$=ARZ$(232,9) ! SSP293239, billing address
1150 MSG_1$=MSG("UPDATE_REC")
1160 CALL "*wingrp;Enable",BUTTON_1.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$
1170 B_ARZ$=ARZ$
1180 REFRESH_FLG=1
1190 RETURN 
1500 ! Write Record
1510 WRITE_REC:
1520 ! MSGBOX MSG_1$,MSG("CONFIRM"),"?,YesNo",ANS$
1530 ! IF ANS$="NO" THEN RETURN 
1535 ! SSP293239 REMOVING THIS SINCE THE CC NUMBER IS NO LONGER ALLOWED TO BE ENTERED FOR THE CC VAULT MODULE.....GOSUB VALIDATE_CCNUM; IF FLAG$="EXPIRED DATE" THEN MSGBOX MSG("INVALID")+" "+MSG("EXP_DATE"),MSG("WARNING"),"!STOP"; NEXT_ID=EXPIRATION_DATE.CTL; EXIT ELSE IF FLAG$<>"GOOD" AND FLAG$<>"NO" THEN MSGBOX "Invalid Credit Card Number",MSG("WARNING"),"!STOP"; NEXT_ID=CREDIT_CARD_NUMBER.CTL; EXIT ! 228789
1540 WRITE (Z[1],KEY=KEY_1$)IOL=0310
1545 IF NEW_ZIP THEN GOSUB UPDATE_ZIP ! SSP293239
1550 ! MSGBOX "Record Updated!","FYI","!"
1580 DIM ARZ$(255),AR1[2]; B_ARZ$=ARZ$ ! SSP229993, ARZ dim to 255
1585 CHANGE_FLG=0; GOSUB CLEAR_REC; NEXT_ID=_FIRST_KEY ! SSP#241192 ! CMD_STR$="E"
1590 RETURN 
1610 DELETE_REC:
1640 MSGBOX MSG("DELETE_REC"),MSG("CONFIRM"),"?,YESNO",_X$
1650 IF _X$<>"YES" THEN RETURN 
1660 REMOVE (Z(1),KEY=KEY_1$,DOM=*NEXT)
1670 CHANGE_FLG=0; GOSUB CLEAR_REC ! SSP#241192
1680 RETURN 
1810 CLEAR_REC:! SSP#241192
1820 IF CHANGE_FLG<>0 THEN GOSUB CHECK_CHANGES
1830 _CLR_FLG$="R"; GOSUB CLEAR_FIELDS
1850 CHANGE_FLG=0
1860 RETURN 
2000 ! Load Information
2010 LOAD_INFO:
2015 CUSTOMER$=ARZ$(1,10)
2020 CREDIT_CARD_TYPE$=ARZ$(11,4)
2030 SEQ_NUM$=ARZ$(15,4)
2040 ARGEEMENT_ON_FILE$=ARZ$(19,1)
2050 CREDIT_CARD_NUMBER$=ARZ$(20,20)
2052 LAST_FOUR$=STP(ARZ$(20,20)),LAST_FOUR$=MID(LAST_FOUR$,LEN(LAST_FOUR$)-3) ! SSP 190139
2055 VAULT_ID$=MID(ARZ$,90,64) ! SSP 229993
2060 REM EXPIRATION_DATE$=ARZ$(40,6) ! SSP211214 jdf
2065 IF ARZ$(40,1)="K" THEN EXPIRATION_DATE$=FND$(ARZ$(40,6)) ELSE EXPIRATION_DATE$=ARZ$(40,4) ! SSP211214 jdf  ! SSP231477 jdf
2067 MISC_FLD$=ARZ$(44,6) ! SSP231477 jdf
2070 REM NAME_ON_CARD$=ARZ$(46,40)  ! SSP211214 jdf
2075 NAME_ON_CARD$=ARZ$(50,40) ! SSP211214 jdf
2090 BILL_ADDR_1$=ARZ$(154,30),BILL_ADDR_2$=ARZ$(184,30),BILL_CITY$=ARZ$(214,16),BILL_ST$=ARZ$(230,2),BILL_ZIP$=ARZ$(232,9) ! SSP293239, billing address
2100 GOSUB GET_MERCH_ACCT
2160 CALL "*wingrp;Enable",BUTTON_1.GRP$
2165 CALL "*WINGRP;ENABLE",FIELDS.GRP$
2170 B_ARZ$=ARZ$
2180 REFRESH_FLG=1
2190 RETURN 
2300 ! Load Slections   
2310 LOAD_SELECTION:
2312 IF NUL(CUSTOMER$) THEN RETURN ! SSP 229993
2315 DIM ARZ$(255) ! SSP229993, ARZ dim to 255
2320 ARZ$(1,10)=CUSTOMER$
2330 ARZ$(11,4)=CREDIT_CARD_TYPE$
2340 ARZ$(15,4)=SEQ_NUM$
2350 ARZ$(19,1)=ARGEEMENT_ON_FILE$
2360 ARZ$(20,20)=DIM(16,"*")+LAST_FOUR$
2365 ARZ$(90,64)=VAULT_ID$ ! SSP 229993
2370 REM ARZ$(40,6)=EXPIRATION_DATE$ ! SSP211214 jdf
2375 ARZ$(40,4)=EXPIRATION_DATE$,ARZ$(44,6)=MISC_FLD$ ! SSP211214 jdf ! SSP231477 jdf
2380 REM ARZ$(46,40) = NAME_ON_CARD$ ! SSP211214 jdf
2385 ARZ$(50,40)=NAME_ON_CARD$ ! SSP211214 jdf
2390 ARZ$(154,30)=BILL_ADDR_1$,ARZ$(184,30)=BILL_ADDR_2$,ARZ$(214,16)=BILL_CITY$,ARZ$(230,2)=BILL_ST$,ARZ$(232,9)=BILL_ZIP$ ! SSP239239, billing address
2490 RETURN 
2500 ! Delete Record
2510 DEL_REC:
2520 MSGBOX MSG("DELETE_REC"),MSG("CONFIRM"),"?,YesNo",ANS$
2530 IF ANS$="NO" THEN RETURN 
2540 REMOVE (Z[1],KEY=KEY_1$)
2550 MSGBOX "Record Deleted!","FYI","!"
2590 RETURN 
3000 ! First Record
3010 FIRST_REC:
3020 KEY_1$=KEF(Z[1],END=NO_FIRST)
3030 READ (Z[1],KEY=KEY_1$)IOL=0310
3040 GOSUB LOAD_INFO
3090 RETURN 
3200 ! Last Record
3210 LAST_REC:
3220 KEY_1$=KEL(Z[1],ERR=NO_LAST)
3230 READ (Z[1],KEY=KEY_1$)IOL=0310
3240 GOSUB LOAD_INFO
3290 RETURN 
3400 ! Prior Record
3410 PRIOR_REC:
3420 KEY_1$=KEP(Z[1],END=START_FILE)
3430 READ (Z[1],KEY=KEY_1$)IOL=0310
3440 GOSUB LOAD_INFO
3490 RETURN 
3600 ! Next Record
3610 NEXT_REC:
3620 KEY_1$=KEN(Z[1],END=END_FILE)
3630 READ (Z[1],KEY=KEY_1$)IOL=0310
3640 GOSUB LOAD_INFO
3690 RETURN 
5000 ! Check Changes
5010 CHECK_CHANGES:
5015 IF CHANGE_FLG=0 THEN CMD_STR$="END"; EXIT ! SSP#229993
5020 IF ARZ$=B_ARZ$ THEN RETURN 
5030 MSGBOX MSG("REC_ALTERD"),MSG("UPDATE"),"?,YesNo",ANS$
5040 IF ANS$="NO" THEN RETURN 
5050 GOSUB WRITE_REC
5090 RETURN 
8000 ! Messages
8010 NEW_MSG:
8020 MSGBOX MSG("ADD_RECORD"),MSG("CONFIRM"),"?,YesNo",ANS$
8030 IF ANS$="NO" THEN CMD_STR$="E"; RETURN 
8040 NEXT_ID=ARGEEMENT_ON_FILE.CTL
8070 MSG_1$=MSG("ADD_RECORD")
8080 CALL "*wingrp;Enable",BUTTON_1.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$; REFRESH_FLG=1
8090 RETURN 
8100 ! No First Record
8110 NO_FIRST:
8120 MSGBOX MSG("REC_NO_1ST"),"FYI","!"
8130 RETURN 
8200 ! No Last Record
8210 NO_LAST:
8220 MSGBOX MSG("REC_NO_LST$"),"FYI","!"
8230 RETURN 
8300 ! Start of File
8310 START_FILE:
8320 MSGBOX MSG("START_FILE"),"FYI","!"
8330 RETURN 
8340 ! Date conversion
8350 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####") ! SSP211214  jdf
8400 ! End of File
8410 END_FILE:
8420 MSGBOX MSG("END_OF_FIL"),"FYI","!"
8430 RETURN 
9000 ! Parameters
9010 GET_SYS_PARAM:
9020 READ (Z[6],KEY=X3$(9,3)+"F/M",DOM=*NEXT)FM_PARAM$
9090 RETURN 
9999 END 
10000 GET_MERCH_ACCT:
10005 ! Check AR system parameters to see if there is a default merchant account. if not get the first record in CD0 as the default. A customer specific merchant account is the ultimate override
10010 DIM ARS$(255); READ (Z[6],KEY=X3$(9,3)+"A/R",DOM=*NEXT)ARS$(1); IF NOT(NUL(MID(ARS$,244,10))) THEN MERCH_ACCT$=MID(ARS$,244,10); GOTO GET_CUST_ACCT
10015 READ (Z[3],KEY="",DOM=*NEXT)
10020 MERCH_ACCT$=KEY(Z[3],END=*NEXT)
10025 GET_CUST_ACCT:
10030 DIM AR1$(599); READ (Z[2],KEY=CUSTOMER$,DOM=*NEXT)AR1$(1); IF NOT(NUL(MID(AR1$,484,10))) THEN MERCH_ACCT$=MID(AR1$,484,10)
10035 DIM CD0$(1000); FIND (Z[3],KEY=MERCH_ACCT$,ERR=*NEXT)CD0$
10036 AUTHNET$="N",CUST_PROFILE_ID$=""; IF STP(CD0$(41,10),2)="A" THEN DIM CD4$(100); AUTHNET$="Y"; READ (Z[4],KEY=CUSTOMER$+MERCH_ACCT$,DOM=*NEXT)CD4$; CUST_PROFILE_ID$=STP(MID(CD4$,21,40))
10037 REFRESH_FLG=1
10040 RETURN 
10049 ! 
10050 EDIT_CUST_PROFILE_ID:
10060 PROCESS "CVGCD4","../CVG/CV.EN",CUSTOMER$,MERCH_ACCT$
10065 GOTO LOAD_INFO
10095 RETURN 
10099 ! 
13000 CLEAR_FIELDS:! SSP#241192
13020 IF _CLR_FLG$="R" THEN CUST_DIV$="" ! SSP#241192
13030 IF _CLR_FLG$="R" THEN CUST_CODE$="" ! SSP#241192
13045 IF _CLR_FLG$="R" THEN %CUST_NAME$="",CUSTOMER$="" ! SSP 229993
13046 IF _CLR_FLG$="R" THEN AUTHNET$="N",CUST_PROFILE_ID$="",MERCH_ACCT$=""
13050 CREDIT_CARD_TYPE$="",SEQ_NUM$="",ARGEEMENT_ON_FILE$="",CREDIT_CARD_NUMBER$="",LAST_FOUR$="",EXPIRATION_DATE$="",MISC_FLD$="",NAME_ON_CARD$="" ! SSP#241192
13060 VAULT_ID$="" ! SSP 229993
13070 BILL_ADDR_1$="",BILL_ADDR_2$="",BILL_CITY$="",BILL_ST$="",BILL_ZIP$="" ! SSP293239
13080 REFRESH_FLG=1
13090 RETURN 
18000 SEL_PASSWORD:! SSP293239, found that this is not used but it is being performed from the panel for the VAULT_ID so I'm going to remove those performs
18001 RETURN 
18005 PRINT 'CI',
18010 L=0,OP$=ID'*,XX=ID'COL,YY=ID'LINE,XXX=ID'COLS,YYY=ID'LINES; DIM OP$[200],NA$[200]
18020 ! 
18030 NXT_OPT:
18040 X=POS(","=OP$); IF X=0 THEN GOTO END_OPT
18050 LST$=OP$(1,X-1),OP$=OP$(X+1),L=L+1,OP$[L]=LST$,NA$[L]=EVS("ID'"+LST$+"$")
18060 ! PRINT OP$[L],"  ",NA$[L]
18070 GOTO NXT_OPT
18080 ! 
18090 END_OPT:
18100 MULTI_LINE REMOVE ID
18110 IF REST=0 THEN MULTI_LINE ID,@(XX,YY,XXX,YYY),OPT="H"+OPT$; HIDE CONTROL ID+3000; LAST_FOUR$="",REFRESH_FLG=1 ELSE MULTI_LINE ID,@(XX,YY,XXX,YYY),OPT="H$"+OPT$; HEIGHT$=ID'HEIGHT$; SHOW CONTROL ID+3000; LAST_FOUR$=STP(CREDIT_CARD_NUMBER$); IF LEN(LAST_FOUR$)>=4 THEN LAST_FOUR$=MID(LAST_FOUR$,LEN(LAST_FOUR$)-3); REFRESH_FLG=1 ! SSP#241192
18120 FOR AA=1 TO L
18130 BB$=PAD(OP$[AA],6," "); IF POS(BB$="Len   Col   Cols  Line  Lines Width Height",6)<>0 THEN CONTINUE
18140 IF NOT(NUL(NA$[AA])) THEN EXECUTE "id'"+OP$[AA]+"$="+QUO+NA$[AA]+QUO
18150 NEXT AA
18160 RETURN 
19000 CHECK_EXP:
19010 CRED_CARD_EXP$=EXPIRATION_DATE$
19020 PERFORM "ECGMAD;CHECK_EXP",ERR=*NEXT ! SSP 228203
19030 IF NUL(CRED_CARD_EXP$) THEN EXPIRATION_DATE$="",NEXT_ID=EXPIRATION_DATE.CTL
19040 EXPIRATION_DATE$=CRED_CARD_EXP$,CRED_CARD_EXP$=""
19050 RETURN 
19500 VALIDATE_CCNUM:
19510 CALL "AR2VCC",%X3$,%X4$,STP(CREDIT_CARD_NUMBER$,1)+"|"+PAD(EXPIRATION_DATE$,4),CREDIT_CARD_TYPE$,FLAG$ ! SSP#241192
19520 RETURN 
21000 LOOKUP_ZIP:! Lookup zipcode, set city & state if found, set NEW_ZIP for later use SSP293239 COPIED FROM ARGMAB
21003 IF NUL(BILL_ZIP$) THEN RETURN 
21005 NEW_ZIP=0
21010 CALL "ZYGMBA;CHECK_ZIP",BILL_ZIP$,ZIP_FOUND,ZIP_CITY$,ZIP_ST$,"",ZIP_AREA_CODE$,"",ZIP_STAX_CODE$
21015 PHONE$=DIM(14)
21020 IF ZIP_FOUND THEN BILL_CITY$=ZIP_CITY$,BILL_ST$=ZIP_ST$,REFRESH_FLG=1,NEXT_ID=BILL_CITY.CTL ELSE NEW_ZIP=1
21095 RETURN 
21099 ! 
21100 UPDATE_ZIP:! If new_zip then update the zip code table SSP293239 COPIED FROM ARGMAB
21105 DIM PHONE$(14)
21110 IF NEW_ZIP THEN CALL "ZYGMBA;UPDATE_ZIP",BILL_ZIP$,BILL_CITY$,BILL_ST$,"",PHONE$(1,3),BILL_CITY$ ! get area code from phone,long city from regular city
21180 NEW_ZIP=0
21195 RETURN 
21199 ! 
56000 ! 229993-COPIED FROM ARGMAV CC PLUS - CVGMAV IS FOR CC VAULT
56002 REM "293239-CC Vault; ARZ needs expansion, add billing address, change  
