0010 ! CVGCD4 - File Maintenance Program for CD4_CustProfile (="CD4"+%C$)
0020 ! Generated by ProvideX® NOMADS II File Maintenance on Sep. 29, 2020 15:03
0030 ! ************************************************************************
0035 REM "5.7 - 05/24/22 - 9.223442 - crg - SSP# 307309
0037 REM "307309-DBD-113 - Authorize.Net support
0040 REM "Copyright 2022 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0045 IF TCB(13)=1 THEN BEGIN 
0050 _CUSTOMER$=%CUSTOMER$
0060 PROCESS "CVGCD4","../CVG/CV.EN"
0070 %CUSTOMER$=_CUSTOMER$
0080 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 ! 
0130 X0$="CVGCD4",X1$="Credit card - Customer Profile Setup"
0140 ! 
0150 X0=-1,X2=-1
0160 CALL "ZZCOMP",X0$,X11$,X2$,X3$,X4$,X5$,X0,X1,X2; IF X1>0 THEN GOSUB WRAPUP
0170 ! 
0190 DIM Z[NUM(X3$(60,3))],CD4$(100),B_CD4$(100) ! SSP229993, CD4 dim to 255
0200 ! Files
0210 Z$="01X CD4...  02O AR1...  06O ZZPARM  "
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
0300 ! IOList Section
0310 IOLIST CD4$
0320 IOLIST AR1$,AR1{ALL}
0400 ! System Parameters
0410 GOSUB GET_SYS_PARAM
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0520 IF %CUSTOMER$<>"" THEN {
0530 CUSTOMER$=%CUSTOMER$
0535 %CUST$=CUSTOMER$
0540 DISABLE CONTROL CUSTOMER.CTL
0550 REFRESH_FLG=1; RETURN  }
0555 IF NOT(NUL(ARG_1$)) AND NOT(NUL(ARG_2$)) THEN CUSTOMER$=ARG_1$,MERCH_ACC_NAME$=ARG_2$; GOTO FIND_REC
0560 NEXT_ID=CUSTOMER.CTL
0570 CALL "*wingrp;Show",NAV1.GRP$
0780 REFRESH_FLG=1
0790 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0970 RETURN 
1000 ! find Record
1010 FIND_REC:
1020 KEY_1$=CUSTOMER$+PAD(MERCH_ACC_NAME$,10)
1030 FIND (Z[1],KEY=KEY_1$,DOM=NEW_MSG)IOL=0310
1040 GOTO LOAD_INFO
1190 RETURN 
1500 ! Write Record
1510 WRITE_REC:
1520 GOSUB LOAD_SELECTION
1540 WRITE (Z[1],KEY=KEY_1$)IOL=0310
1580 DIM CD4$(100); B_CD4$=CD4$
1585 CHANGE_FLG=0; GOSUB CLEAR_REC; NEXT_ID=CUSTOMER.CTL
1590 RETURN 
1610 DELETE_REC:
1640 MSGBOX MSG("DELETE_REC"),MSG("CONFIRM"),"?,YESNO",_X$
1650 IF _X$<>"YES" THEN RETURN 
1660 REMOVE (Z(1),KEY=KEY_1$,DOM=*NEXT)
1670 CHANGE_FLG=0; GOSUB CLEAR_REC
1680 RETURN 
1810 CLEAR_REC:
1820 IF CHANGE_FLG<>0 THEN GOSUB CHECK_CHANGES
1830 _CLR_FLG$="R"; GOSUB CLEAR_FIELDS
1850 CHANGE_FLG=0
1860 RETURN 
2000 ! Load Information
2010 LOAD_INFO:
2015 CUSTOMER$=CD4$(1,10)
2020 MERCH_ACC_NAME$=CD4$(11,10)
2030 CUST_PROFILE_ID$=CD4$(21,40)
2160 CALL "*wingrp;Enable",BUTTONS.GRP$
2165 CALL "*WINGRP;ENABLE",FIELDS.GRP$
2170 B_CD4$=CD4$
2180 REFRESH_FLG=1
2190 RETURN 
2300 ! Load Slections   
2310 LOAD_SELECTION:
2312 IF NUL(CUSTOMER$) THEN RETURN ! SSP 229993
2315 DIM CD4$(100)
2320 CD4$(1,10)=CUSTOMER$
2330 CD4$(11,10)=MERCH_ACC_NAME$
2340 CD4$(21,40)=CUST_PROFILE_ID$
2490 RETURN 
2500 ! Delete Record
2510 DEL_REC:
2520 MSGBOX MSG("DELETE_REC"),MSG("CONFIRM"),"?,YesNo",ANS$
2530 IF ANS$="NO" THEN RETURN 
2540 REMOVE (Z[1],KEY=KEY_1$)
2550 MSGBOX "Record Deleted!","FYI","!"
2590 RETURN 
3000 ! First Record
3010 FIRST_REC:
3020 KEY_1$=KEF(Z[1],END=NO_FIRST)
3030 READ (Z[1],KEY=KEY_1$)IOL=0310
3040 GOSUB LOAD_INFO
3090 RETURN 
3200 ! Last Record
3210 LAST_REC:
3220 KEY_1$=KEL(Z[1],ERR=NO_LAST)
3230 READ (Z[1],KEY=KEY_1$)IOL=0310
3240 GOSUB LOAD_INFO
3290 RETURN 
3400 ! Prior Record
3410 PRIOR_REC:
3420 KEY_1$=KEP(Z[1],END=START_FILE)
3430 READ (Z[1],KEY=KEY_1$)IOL=0310
3440 GOSUB LOAD_INFO
3490 RETURN 
3600 ! Next Record
3610 NEXT_REC:
3620 KEY_1$=KEN(Z[1],END=END_FILE)
3630 READ (Z[1],KEY=KEY_1$)IOL=0310
3640 GOSUB LOAD_INFO
3690 RETURN 
5000 ! Check Changes
5010 CHECK_CHANGES:
5015 IF CHANGE_FLG=0 THEN CMD_STR$="END"; EXIT ! SSP#229993
5020 IF CD4$=B_CD4$ THEN RETURN 
5030 MSGBOX MSG("REC_ALTERD"),MSG("UPDATE"),"?,YesNo",ANS$
5040 IF ANS$="NO" THEN RETURN 
5050 GOSUB WRITE_REC
5090 RETURN 
8000 ! Messages
8010 NEW_MSG:
8020 MSGBOX MSG("ADD_RECORD"),MSG("CONFIRM"),"?,YesNo",ANS$
8030 IF ANS$="NO" THEN CMD_STR$="E"; RETURN 
8040 NEXT_ID=CUST_PROFILE_ID.CTL
8070 MSG_1$=MSG("ADD_RECORD")
8080 CALL "*wingrp;Enable",BUTTONS.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$; REFRESH_FLG=1
8090 RETURN 
8100 ! No First Record
8110 NO_FIRST:
8120 MSGBOX MSG("REC_NO_1ST"),"FYI","!"
8130 RETURN 
8200 ! No Last Record
8210 NO_LAST:
8220 MSGBOX MSG("REC_NO_LST$"),"FYI","!"
8230 RETURN 
8300 ! Start of File
8310 START_FILE:
8320 MSGBOX MSG("START_FILE"),"FYI","!"
8330 RETURN 
8400 ! End of File
8410 END_FILE:
8420 MSGBOX MSG("END_OF_FIL"),"FYI","!"
8430 RETURN 
9000 ! Parameters
9010 GET_SYS_PARAM:
9020 READ (Z[6],KEY=X3$(9,3)+"F/M",DOM=*NEXT)FM_PARAM$
9090 RETURN 
9999 END 
13000 CLEAR_FIELDS:! SSP#241192
13020 IF _CLR_FLG$="R" THEN CUST_DIV$=""
13030 IF _CLR_FLG$="R" THEN CUST_CODE$=""
13045 IF _CLR_FLG$="R" THEN %CUST_NAME$="",CUSTOMER$=""
13050 IF _CLR_FLG$="R" THEN MERCH_ACC_NAME$=""
13060 CUST_PROFILE_ID$=""
13070 CALL "*wingrp;Disable",BUTTONS.GRP$
13080 REFRESH_FLG=1
13090 RETURN 
56001 REM "307309-DBD-113 - Authorize.Net support
