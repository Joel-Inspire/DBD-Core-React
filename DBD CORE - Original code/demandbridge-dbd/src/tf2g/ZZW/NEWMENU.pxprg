0010 REM "System Menu Selection Program <ZZWMENU>
0035 ! "6.0 - 01/06/03 - 15.615277 - dmm
0040 ! "Copyright 2003 Computer Software Inc.; Norcross, Georgia
0041 ! "        Licensed Software - All Rights Reserved.
0100 ! ^100 - Process Main Menu Panel
0110 PROCESS "TREE",HWD+DLM+"tf2g"+DLM+"ZZW"+DLM+"ZZ.EN"
0120 RELEASE 
0130 ! 
0200 ! ^100
0210 INIT:
0220 IOLIST MENU_FULLNAME$,MPATH$
0230 IOLIST X3$,M1$,X4$,D0$,X$,A9$
0250 _TREE=GFN
0260 OPEN (_TREE,IOL=0220)"*MEMORY*"
0270 GOSUB FILES
0280 GOSUB FUNCTIONS
0290 GOSUB INIT_MENU
0300 GOSUB MSGLIB
0310 GOSUB CHECK_APP
0320 ! GOSUB RESIZE_PANEL
0330 EXIT 
0340 ! 
0400 ! ^100
0410 FILES:
0420 _ZX4=UNT,_FILE_NAME$="ZX4"
0430 OPEN (_ZX4,ERR=OPEN_ERR)_FILE_NAME$
0440 _ZX0=UNT,_FILE_NAME$="ZX0"
0450 OPEN (_ZX0,ERR=OPEN_ERR)_FILE_NAME$
0460 _ZZPARM=UNT,_FILE_NAME$="ZZPARM"
0470 OPEN (_ZZPARM,ERR=OPEN_ERR)_FILE_NAME$
0480 RETURN 
0490 ! 
0500 ! ^100
0510 OPEN_ERR: MSGBOX _MSG_FILOPNERR1$+QUO+_FILE_NAME$+QUO+SEP+_MSG_DIRECTORY$+LWD+SEP+_MSG_PREFIX$+PFX,MSG(ERR),"!"
0520 CMD_STR$="END"
0530 RETURN 
0540 ! 
0600 ! ^100
0610 MSGLIB:
0620 SWITCH %X3_LANG_CODE$
0630 CASE " "
0640 MSGLIB$="*tfmsglib.en"
0650 BREAK
0660 DEFAULT 
0670 MSGLIB$="*tfmsglib.en"
0680 END SWITCH 
0690 RETURN 
0700 ! 
0800 ! ^100
0810 INIT_MENU:
0820 ! CALL "ZZCOMP",ERR=0885,X0$,X1$,X2$,X3$,X4$,X5$,-1,0,0
0821 GOTO 0970
0890 DIM MNU_OPTNS$(100)
0900 _ZZPARM=13
0910 READ (_ZZPARM,KEY=X3$(1,8))IOL=0230
0920 DIM D0$(28); D0$(1,6)=X3$(1,2)+"DATE"
0930 READ (_ZZPARM,KEY=D0$(1,6),DOM=0940)D0$(1)
0940 GOSUB SET_DATE_TIME; %X3_MACH_DATE$=D0$(7,6)
0950 IF POS(" "<>%X3_TODAY$)>0 THEN IF POS(" "<>D0$(23,6))>0 THEN GOTO 0965
0960 %X3_TODAY$=D0$(7,6),D0$(20,9)="SYS"+D0$(7,6); WRITE (_ZZPARM,KEY=D0$(1,6))D0$
0970 RETURN 
0980 ! 
1000 ! ^1000
1010 MNU_SELECTION:
1030 LBNUM=LIST_BOX_1.CTL
1040 LIST_BOX READ LBNUM,M1$,MODE$,ERR=*NEXT
1050 IF STP(M1$,2)="" THEN GOTO MNU_SELECTION_END
1060 P=POS(SEP=M1$,-1); IF P>0 THEN M1$=MID(M1$,P+1) ELSE GOTO MNU_SELECTION_END
1070 ! Get Module Codes
1080 READ (_TREE,KEY="",ERR=*NEXT)
1090 READ (_TREE,KEY=M1$,ERR=MNU_SELECTION_END)IOL=0220
1100 ! Display Menu
1110 GOSUB 1500
1120 _APP=UNT,_FND=0
1130 OPEN (_APP,ERR=*NEXT)MENU_FULLNAME$; CLOSE (_APP); _FND=1
1140 ! 
1150 IF _FND THEN {
1160 LBNUM'ENABLED=0,REFRESH_FLG=1
1170 PRINT 'SHOW'(-1)
1180 PROCESS "MENU",MPATH$
1190 PRINT 'SHOW'(3)
1200  }
1210 MNU_SELECTION_END:
1220 ! 
1230 LBNUM'ENABLED=1,MODE$=""
1240 MPATH$="",M1$="",APP$=""
1250 REFRESH_FLG=1,CHANGE_FLG=0
1260 EXIT 
1400 ! ^100 Check Application
1410 CHECK_APP:
1420 CALL "TF"+%LIC_COMP$+";OSCAR",APPS_ALLOWED$
1430 RETURN 
1500 ! ^100 Set date & time
1510 SET_DATE_TIME:
1520 IF MID(X3$,77,1)="U" THEN Q1$=DAY; GOTO 1535
1530 IF MID(X3$,1,2)<>"T0" OR MID(SCRN_PRT$,2,3)<>"   " THEN GOTO 1560 ELSE Q1$=DAY
1540 Q1$=DTE(JUL(0,0,0):"YYYYMMDD"),Q1$=CHR(NUM(Q1$(1,3))-125)+Q1$(4)
1550 IF Q1$=MID(D0$,7,6) THEN GOTO 1560
1560 RETURN 
1570 ! 
1600 ! ^ 100 LOAD TREE
1610 LOAD_TREE:
1615 ! PREINPUT NEXT "tfw" 
1620 IF _ZX0=0 OR _ZX4=0 THEN GOSUB CLOSE_FILES; GOSUB FILES
1630 READ (_ZX4,KEY="",ERR=*NEXT)
1635 ! 
1640 K$=KEY(_ZX4,END=1990); DIM MENU$(200); READ (_ZX4,KEY=K$)MENU$
1650 CUR_MNU$=MENU$(76,2)
1660 MENU_NAME$=MENU$(3,73),P=POS("|"=MENU_NAME$); IF P<=0 THEN GOTO 1640
1670 CUR_DESC$=STP(MENU_NAME$(P+1),2)
1680 MENU_KEY$=CUR_DESC$
1690 FULLPATH$=STP(MENU_NAME$(1,P-1),2)+SEP+MENU_KEY$
1695 ! 
1700 DIM ZX0$(80); READ (_ZX0,KEY=CUR_MNU$,DOM=1640)ZX0$
1705 ! 
1710 IF FNAPP_INSTALLED(CUR_MNU$) THEN {
1720 APP$=ZX0$(41,2); IF APP$="FS" THEN APP$="OP"
1730 MENU_FULLNAME$=HWD+DLM+"tf2g"+DLM+APP$+"G"+DLM+APP$+"G"+"MEN"
1740 MPATH$=HWD+DLM+"tf2g"+DLM+APP$+"G"+DLM+APP$+".EN"
1750 _APP=UNT,_FND=0
1760 OPEN (_APP,ERR=*NEXT)MENU_FULLNAME$; CLOSE (_APP); _FND=1
1770 IF ERR<>12 THEN _FND=1
1780 IF _FND THEN M_ICON$="{!DONE}" ELSE M_ICON$="{!FILE}"
1790 LIST_BOX LOAD LIST_BOX_1.CTL,0,M_ICON$+FULLPATH$
1800 WRITE (_TREE,KEY=CUR_DESC$)IOL=0220
1810  } ELSE {
1820 LIST_BOX LOAD LIST_BOX_1.CTL,0,"{!KEY}"+FULLPATH$
1830  }
1840 GOTO 1640
1850 ! 
1990 RETURN 
2000 ! 
6000 ! ^6000 Show Window
6010 SHOW_MENU:
6020 ! WAIT .5; PRINT 'SHOW'(2)
6021 GOSUB RESIZE_PANEL
6030 RETURN 
8000 ! ^ 8000,10 Resize for server only at this time
8010 RESIZE_PANEL:
8020 WAIT .5
8030 PRINT 'MOVE'(0,0)
8040 PRINT 'SIZE'(132,35)
8050 PRINT 'SHOW'(2)
8060 EXIT 
8100 ! 
8200 ! ^8200,10
8210 INIT_LISTBOX:
8220 GOSUB LOAD_TREE
8230 GOSUB LOAD_PICTURE
8240 GOSUB RESIZE_LISTBOX
8250 REFRESH_FLG=1
8260 RETURN 
8270 ! 
8400 ! ^ 8400,10
8410 LOAD_PICTURE:
8420 IF DEC(MID(MSE,22,1))>0 THEN %WDX$="[WDX]" ELSE %WDX$=""
8430 IF %WDX$<>"" THEN {
8440 CALL %WDX$+"*WINDX.UTL;GET_LWD",%WINDX_DIR$
8450 IF %WINDX_DIR$(LEN(%WINDX_DIR$),1)<>DLM THEN %WINDX_DIR$+=DLM
8460  }
8470 IF NOT(LEN(%WDX$)) THEN {
8480 PICTURE$=".\tf_logo.bmp"
8490  } ELSE {
8500 PICTURE$=%WINDX$+%WINDX_DIR$+"topform\tf_logo.bmp"
8510  }
8520 RETURN 
8530 ! 
8600 ! ^8600,10
8610 RESIZE_LISTBOX:
8620 LBNUM=LIST_BOX_1.CTL
8630 LBNUM'VISIBLE=1
8640 RETURN 
8650 ! 
8800 ! ^8800
8810 FUNCTIONS:
8820 DEF FNAPP_INSTALLED(LOCAL APP_NAME$)
8830 IF POS(APP_NAME$=APPS_ALLOWED$)=0 THEN RESULT=0 ELSE RESULT=1
8840 RETURN RESULT
8850 END DEF
8860 RETURN 
9000 ! ^9000,10
9010 WRAP_UP:
9020 GOSUB CLOSE_FILES
9030 EXIT 
9040 ! 
9100 ! ^9100,10
9110 CLOSE_FILES:
9120 CLOSE (_ZX0,ERR=*NEXT)
9130 CLOSE (_ZZPARM,ERR=*NEXT)
9140 CLOSE (_TREE,ERR=*NEXT)
9145 CLOSE (_ZX4,ERR=*NEXT)
9150 RETURN 
