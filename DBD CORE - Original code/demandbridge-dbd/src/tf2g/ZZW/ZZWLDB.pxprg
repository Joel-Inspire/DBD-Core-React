0010 ! ZZWLDB - Load Drop Boxes
0020 ! 
0030 ! Load drop boxes such as fiscal year, accounting period
0035 REM "5.7 - 01/13/21 - 12.043611 - jvv - SSP# 307327
0037 REM "307327-WMS Receiving Fiscal Year and Accounting period - DBD-151   
0040 REM "Copyright 2021 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 ! Will use variables based on most common use in data dictionary
0060 ! 
0070 DEF FND$(Z9$)=Z9$(NUM(%X3$(48,1))*2+1,2)+%X3$(59,1)+Z9$(7-NUM(%X3$(48,1))*2,2)+%X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0100 LOAD_FY:
0105 ! ONLY_OPEN$="Y" means only load open FY's, TF_MODULE$ can be set to second part of key for that system parameter record, ie A/P, A/R, I/C
0110 FY$=""
0120 CLOSE_ZZPARM$="N"; IF _ZZPARM=0 THEN GOSUB OPEN_ZZPARM
0124 CUR_FY$="",CUR_ACCTPD$=""; IF TF_MODULE$<>"" THEN READ (_ZZPARM,KEY=%C$+TF_MODULE$,DOM=*NEXT)SYS_PARMS$; CUR_FY$=SYS_PARMS$(7,4),CUR_ACCTPD$=STR(NUM(SYS_PARMS$(11,2),ERR=*PROCEED):"00"); IF TF_MODULE$="G/L" THEN CUR_FY$=SYS_PARMS$(34,4),CUR_ACCTPD$=SYS_PARMS$(38,2); GOSUB CREATE_DATES
0125 IF NOT(NUL(SET_CUR_FY$)) AND NOT(NUL(SET_CUR_ACCTPD$)) THEN CUR_FY$=SET_CUR_FY$,SET_CUR_FY$=""; CUR_ACCTPD$=SET_CUR_ACCTPD$,SET_CUR_ACCTPD$=""; GOSUB CREATE_DATES
0126 IF TF_MODULE$="I/C" THEN GOSUB CREATE_DATES
0127 DIM GL$(300); READ (_ZZPARM,KEY=%C$+"G/L")GL$(1)
0128 DIM OSEC$(255); READ (_ZZPARM,KEY="osec"+%X3_OP_ID$,DOM=*NEXT)OSEC$
0130 READ (_ZZPARM,KEY=%C$+"G/LYE",DOM=*NEXT)
0140 K$=KEY(_ZZPARM,END=LOAD_FY_DROP_BOX); READ (_ZZPARM,KEY=K$)GLYE$
0150 IF LEN(K$)<8 OR K$(1,8)<>%C$+"G/LYE" THEN GOTO LOAD_FY_DROP_BOX
0160 IF ONLY_OPEN$="Y" AND POS(GLYE$(99,1)="CR")>0 THEN GOTO 0140
0165 IF GL$(256,1)="Y" AND OSEC$(58,1)<>"Y" AND K$(9,4)<GL$(34,4) THEN GOTO 0140
0170 FY$=FY$+K$(9,4)+"/"
0180 GOTO 0140
0190 LOAD_FY_DROP_BOX:
0195 IF SCRN_ID$="RFGMPA" THEN FY$="    "+"/"+FY$ ! SSP 307327
0200 DROP_BOX LOAD FY.CTL,FY$
0205 IF CUR_FY$<>"" THEN IF GL$(256,1)="Y" AND OSEC$(58,1)<>"Y" AND CUR_FY$<GL$(34,4) THEN CUR_FY$=GL$(34,4),CUR_ACCTPD$=GL$(38,2)
0206 IF CUR_ACCTPD$<>"" THEN IF GL$(256,1)="Y" AND OSEC$(58,1)<>"Y" AND CUR_FY$+CUR_ACCTPD$<GL$(34,6) THEN CUR_ACCTPD$=GL$(38,2) ! Fixed by 173826
0207 IF CUR_ACCTPD$>"12" THEN CUR_ACCTPD$="01"
0210 IF CUR_FY$<>"" THEN DROP_BOX WRITE FY.CTL,CUR_FY$
0220 IF CUR_FY$<>"" THEN FROM_FY$="Y",FY$=CUR_FY$; CR_FY$=FY$; GOSUB LOAD_ACCTPD ! SSP240496 jdf      
0280 IF CLOSE_ZZPARM$="Y" THEN GOSUB CLOSE_ZZPARM
0290 LOAD_FY_END:RETURN 
0295 ! 
0300 LOAD_ACCTPD:
0305 ! FY$ should be set to a valid fiscal year
0310 ACCTPD$=""
0320 IF FROM_FY$="Y" THEN GOTO 0340
0330 CLOSE_ZZPARM$="N"; IF _ZZPARM=0 THEN GOSUB OPEN_ZZPARM
0340 READ (_ZZPARM,KEY=%C$+"G/LYE"+FY$,DOM=LOAD_ACCTPD_END)GLYE$
0350 PDS=12; PDS=NUM(GLYE$(13,2),ERR=*NEXT) ! Number of periods in this FY
0360 FOR X=1 TO PDS
0365 X$=STR(X:"00"),FLAG$="NO"; CALL "ARGDTE",%X3$,%X4$,FY$+X$,FLAG$; IF FLAG$<>"*" THEN ACCTPD$=ACCTPD$+X$+"/" ! Checks osec, only load valid periods
0370 NEXT X
0375 DROP_BOX LOAD ACCTPD.CTL,ACCTPD$
0378 IF MODULO$="G/L" THEN REC_DAT$=GLYE$,PER_LEN=NUM(REC_DAT$(13,2)),REC_DAT$=REC_DAT$(21); GOSUB NXT_DATES
0380 IF FROM_FY$="Y" AND CUR_ACCTPD$<>"" THEN DROP_BOX WRITE ACCTPD.CTL,CUR_ACCTPD$; ACCTPD$=CUR_ACCTPD$ ! SSP 261203
0381 IF (SCRN_ID$="CRGUAA" OR SCRN_ID$="POGMAG") THEN IF STP(CR_ACCTPD$)="" THEN CR_ACCTPD$=CUR_ACCTPD$ ! SSP240496 jdf!SSP#238771
0382 IF SCRN_ID$="CRGUAA" THEN GOSUB LOAD_ENDING_DATE ! SSP240496 jdf
0385 IF FROM_FY$<>"Y" AND CLOSE_ZZPARM$="Y" THEN GOSUB CLOSE_ZZPARM
0390 LOAD_ACCTPD_END:RETURN 
0395 ! 
0500 OPEN_ZZPARM:
0510 FILE_NAME$="ZZPARM",_ZZPARM=HFN; OPEN (_ZZPARM,ERR=OPEN_ERR)FILE_NAME$
0520 CLOSE_ZZPARM$="Y"
0530 OPEN_ZZPARM_END:RETURN 
0535 ! 
0550 CLOSE_ZZPARM:
0560 IF _ZZPARM THEN CLOSE (_ZZPARM)
0570 _ZZPARM=0
0580 CLOSE_ZZPARM_END:RETURN 
0585 ! 
9000 OPEN_ERR:
9010 MSGBOX MSG("FILOPNERR1")+QUO+_FILE_NAME$+QUO+SEP+MSG("DIRECTORY")+LWD+SEP+MSG("PREFIX")+PFX,MSG(ERR),"!"
9020 CMD_STR$="END"; RETURN 
9030 ! 
9999 END 
10000 ! 
10010 CREATE_DATES:
10015 IF STP(CUR_FY$)="" THEN CUR_FY$=CR_YEAR$,CUR_ACCTPD$=CR_PD$
10020 FIND (_ZZPARM,KEY=%C$+"G/LYE"+CUR_FY$)REC_DAT$; PER_LEN=NUM(REC_DAT$(13,2)),REC_DAT$=REC_DAT$(21)
10025 NXT_DATES:
10030 DIM CUR_DATE$[PER_LEN]
10040 FOR XX=1 TO PER_LEN; CUR_DATE$[XX]=FND$(REC_DAT$(XX*6-5,6)); NEXT XX
10050 RETURN 
10100 ! 10100,10
10110 REV_LOAD_ACCTPD:
10120 ! FY$ should be set to a valid fiscal year
10130 ML_REV_PER$=""
10140 CLOSE_ZZPARM$="N"; IF _ZZPARM=0 THEN GOSUB OPEN_ZZPARM
10150 READ (_ZZPARM,KEY=%C$+"G/LYE"+ML_REV_YEAR$,DOM=LOAD_ACCTPD_END)GLYE$
10160 PDS=12; PDS=NUM(GLYE$(13,2),ERR=*NEXT) ! Number of periods in this FY
10170 FOR X=1 TO PDS
10180 X$=STR(X:"00"),FLAG$="NO"; CALL "ARGDTE",%X3$,%X4$,ML_REV_YEAR$+X$,FLAG$; IF FLAG$<>"*" THEN ML_REV_PER$+=X$+"/" ! Checks osec, only load valid periods
10190 NEXT X
10200 DROP_BOX LOAD ML_REV_PER.CTL,ML_REV_PER$
10210 IF MODULO$="G/L" THEN REC_DAT1$=GLYE$,PER_LEN=NUM(REC_DAT1$(13,2)),REC_DAT1$=REC_DAT1$(21); GOSUB NXT_DATES1
10220 IF FROM_FY$="Y" AND CUR_ACCTPD$<>"" THEN DROP_BOX WRITE ACCTPD.CTL,CUR_ACCTPD$
10230 IF FROM_FY$<>"Y" AND CLOSE_ZZPARM$="Y" THEN GOSUB CLOSE_ZZPARM
10240 REV_LOAD_ACCTPD_END:RETURN 
10250 ! 
10260 NXT_DATES1:
10270 ! 
10280 DIM CUR_DATE1$[PER_LEN]
10290 FOR XX=1 TO PER_LEN; CUR_DATE1$[XX]=FND$(REC_DAT1$(XX*6-5,6)); NEXT XX
10300 RETURN 
11010 LOAD_BANK_CODE:! SSP240496 jdf
11015 IF %NOT_NEW_CR<>0 THEN OLD_BANK_CODE$=BANK_CODE$; OLD_BANK_LIST$=BANK_CODE_LIST$ ! SSP240496 jdf
11020 DIM PARAM$(200); BANK_CODE_LIST$="" ! SSP240496 jdf
11030 READ (Z[13],KEY=%C$+"A/R",DOM=*NEXT)PARAM$ ! SSP240496 jdf
11040 IF PARAM$(16,1)<>"Y" THEN {! SSP240496 jdf
11050 READ (Z[5],KEY=PARAM$(43,3),DOM=*RETURN)ZYB$ ! SSP240496 jdf
11060 BANK_CODE_LIST$=ZYB$(1,3)+"-"+ZYB$(4,30) ! SSP240496 jdf
11065 IF %NOT_NEW_CR<>0 THEN BANK_CODE_LIST$=OLD_BANK_LIST$ ! SSP240496 jdf
11070 DROP_BOX LOAD BANK_CODE_LIST.CTL,1,BANK_CODE_LIST$ ! SSP240496 jdf
11080 DROP_BOX WRITE BANK_CODE_LIST.CTL,BANK_CODE_LIST$ ! SSP240496 jdf
11090 BANK_CODE$=BANK_CODE_LIST$(1,3) ! SSP240496 jdf
11095 IF %NOT_NEW_CR<>0 THEN BANK_CODE$=OLD_BANK_CODE$ ! SSP240496 jdf
11100 REFRESH_FLG=1; NEXT_ID=DEPOSIT_NUM.CTL ! SSP240496 jdf
11110 RETURN  } ! SSP240496 jdf
11120 READ (Z[5],KEY="",DOM=*NEXT) ! SSP240496 jdf
11130 KEY_9$=KEY(Z[5],END=11160); READ (Z[5])ZYB$ ! SSP240496 jdf
11140 BANK_CODE_LIST$+=ZYB$(1,3)+"-"+ZYB$(4,30)+"/" ! SSP240496 jdf
11145 IF ZYB$(1,3)=PARAM$(43,3) THEN DFLT_BANK_CODE$=ZYB$(1,3)+"-"+ZYB$(4,30) ! SSP240496 jdf
11150 GOTO 11130 ! SSP240496 jdf
11160 DROP_BOX LOAD BANK_CODE_LIST.CTL,BANK_CODE_LIST$ ! SSP240496 jdf
11170 DROP_BOX WRITE BANK_CODE_LIST.CTL,DFLT_BANK_CODE$ ! SSP240496 jdf
11175 BANK_CODE_LIST$=DFLT_BANK_CODE$ ! SSP240496 jdf
11177 BANK_CODE$=DFLT_BANK_CODE$(1,3) ! SSP240496 jdf
11180 IF %NOT_NEW_CR<>0 THEN BANK_CODE$=OLD_BANK_CODE$; BANK_CODE_LIST$=OLD_BANK_LIST$ ! SSP240496 jdf
11190 RETURN ! SSP240496 jdf
11200 ! Load the seletion for Bank Code   ! SSP240496 jdf
11210 SELECT_BANK_CODE:! SSP240496 jdf
11220 BANK_CODE$=BANK_CODE_LIST$(1,3) ! SSP240496 jdf
11230 REFRESH_FLG=1 ! SSP240496 jdf
11240 NEXT_ID=DEPOSIT_NUM.CTL ! SSP240496 jdf
11290 RETURN ! SSP240496 jdf
20250 LOAD_ENDING_DATE:! SSP240496 jdf
20255 KE$=%C$+"G/LYE" ! SSP240496 jdf
20260 IF LEN(FY$)>4 THEN VAL$=CUR_FY$ ELSE VAL$=FY$ ! SSP240496 jdf
20270 FIND (Z[13],KEY=KE$+VAL$)SYS_PARMS$; CC$=SYS_PARMS$(21) ! SSP240496 jdf
20280 IF LEN(ACCTPD$)>2 THEN VAL=NUM(CUR_ACCTPD$) ELSE VAL=NUM(ACCTPD$) ! SSP240496 jdf  ! SSP240628 jdf 
20283 REM IF STP(CR_PD$)<>"" THEN VAL=NUM(CR_PD$,ERR=*NEXT); CR_PD$=CR_ACCTPD$ ! SSP240496 jdf
20285 IF SCRN_ID$<>"CRGCAA" THEN IF LEN(CR_ACCTPD$)>2 THEN VAL=NUM(CR_PD$,ERR=*NEXT) ELSE VAL=NUM(CR_ACCTPD$,ERR=*NEXT) ! SSP240496 jdf ! SSP240628 jdf
20290 CC$=CC$(VAL*6-5,6),END_DATE$=CC$,REFRESH_FLG=1 ! SSP240496 jdf
20300 RETURN ! SSP240496 jdf
56000 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
56002 REM "240496-Cash Receipts Gateway GUI - GCR, P1 Option                  
56003 REM "238771-Able to enter an invalid Fiscal Period in PO Receiving      
56004 REM "261203-Ref: 261151 The gui AP Parameters should not allow you      
56005 REM "261224- The gui OP Parameters should not allow you      
56006 REM "307327-WMS Receiving Fiscal Year and Accounting period - DBD-151   
