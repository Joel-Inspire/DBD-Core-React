0010 ! ECGMAA - Buyer ID - Setup
0035 REM "5.6 - 12/11/07 - 15.230277 - jdf - SSP# 212624
0037 REM "212624-Encrypt Buyer credit card information. Modify buyer maint   
0040 REM "Copyright 2007 DemandBridge, Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 PROCESS "ECGMAA","../ECG/EC.EN"
0060 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 ! 
0130 X0$="EC3MAA",X1$="EC Buyer Parameters"
0140 ! 
0150 X0=-1,X2=-1
0155 DIM HIDE_CCN$(20) ! SSP212624  jdf
0160 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2; IF X1>0 THEN CMD_STR$="END"; EXIT 
0170 ! 
0190 DIM Z[NUM(X3$(60,3))],FM1[31],IC0[30]
0200 ! Files
0210 Z$="01O ECA...  02O IC0...  03O FM1...  04O ECS...  05O FM0...  06O ZZPARM  07O FMP...  08O ECG...  09O EDA...  10O EE2...  11O EDF...  "
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
0300 ! IOList Section
0310 IOLIST ECA$,ECA2$
0320 IOLIST GL1$
0330 IOLIST IC0$,IC0{ALL}
0340 IOLIST FM1$,FM1{ALL}
0400 ! System Parameters
0410 GOSUB GET_SYS_PARAM
0430 CALL "*wingrp;disable",FIELDS.GRP$; ENABLE_FLG=0
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0550 ! 
0790 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0970 RETURN 
1000 ! READ RECORD
1010 FIND_REC:
1015 IF NOT(NUL(BUYER_ID$)) THEN BUYER_ID$=PAD(BUYER_ID$,15) ELSE RETURN 
1020 KEY_1$=BUYER_ID$
1030 FIND (Z[1],KEY=KEY_1$,DOM=TERM_MSG)IOL=0310
1040 BUYER_NAME$=ECA$(16,35)
1050 GOSUB LOAD_INFO
1060 CALL "*wingrp;Enable",BUTTONS.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$; NEXT_ID=BUYER_NAME.CTL
1070 B_ECA$=ECA$
1075 ENABLE_FLG=1
1080 GOSUB GET_WAREHOUSE
1185 REFRESH_FLG=1
1190 RETURN 
1300 ! GET ITEM INFORMATION
1310 GET_ITEM:
1315 ITEM_CODE$=PAD(ITEM_CODE$,10)
1320 IF NOT(NUL(BUYER_ID$)) THEN GOTO 1350
1325 KEY_2$="          "+ITEM_CODE$
1330 READ (Z[2],KEY=KEY_2$,DOM=INVALID_ITM)IOL=0330
1335 %ITEM_DESC$=IC0$(21,40)
1337 GOSUB FIND_REC
1340 REFRESH_FLG=1; RETURN 
1350 KEY_3$=BUYER_ID$+ITEM_CODE$
1360 READ (Z[3],KEY=KEY_3$,DOM=INVALID_ITM)IOL=0340
1370 %ITEM_DESC$=FM1$(42,40)
1380 REFRESH_FLG=1
1385 GOSUB FIND_REC
1390 RETURN 
1500 ! Write Record
1510 WRITE_REC:
1540 REM WRITE (Z[1],KEY=KEY_1$)IOL=0310 ! SSP212624 jdf
1543 CALL "UPDECA;UPDATE_ECA",Z[1],ECA$,ECA2$,BUSY,CHANGE_CCN$ ! SSP212624 jdf
1545 GOSUB CATEGORIES
1550 GOSUB CLEAR_REC ! SGBOX "Record Updated!","FYI","!"
1580 B_ECA$=ECA$
1590 RETURN 
2000 ! Load Information
2010 LOAD_INFO:
2011 COST_DESC$="",SHIPTO_DESC$=""
2013 IF NUL(ECA$) THEN RETURN 
2015 BUYER_ID$=ECA$(1,15); BUYER_NAME$=ECA$(16,35)
2020 BUYER_PASSWORD$=ECA$(65,15); BUYER_CUST_CODE$=ECA$(51,10),%CUSTOMER$=BUYER_CUST_CODE$; BUYER_LOC_CODE$=ECA$(61,4),VENDOR$=ECA$(888,10)
2025 ACTIVE_ITEM_CATEGORY$=ECA$(483,10); GOSUB SEL_ACTIVE_ITEM
2026 ML_DFLT_CUST_PO$=ECA$(307,15),ML_EMAIL_ORDER$=ECA$(944,40),CB_SHOW$=ECA$(995,1)
2030 SESSION_EXP_MIN$=ECA$(80,3); TEMPLATE_CODE$=ECA$(276,15); WEBEC_ADMIN$=ECA$(324,1); ASSIGNED_TO_TOPFORM$=ECA$(480,3)
2040 EMAIL_BUYER$=ECA$(109,60); EMAIL_ACT_BUYER$=ECA$(256,10); EMAIL_PURCH_AGENT$=ECA$(169,60); EMAIL_ACT_PURCH_AGNT$=ECA$(266,10)
2050 EMAIL_ADDRESS_CSR$=ECA$(340,60); EMAIL_ACTIONS_CSR$=ECA$(460,10); EMAIL_ADDRESS_SALES$=ECA$(400,60); EMAIL_ACTIONS_SALES$=ECA$(470,10)
2060 ORDER_STATUS_1$=ECA$(97,1); ORDER_STATUS_2$=ECA$(98,1); ORDER_STATUS_3$=ECA$(99,1); ORDER_STATUS_4$=ECA$(100,1)
2070 ORD_STAT_ID_CUST_LOC$=ECA$(92,1); ORD_STAT_SRT_DEFAULT$=ECA$(336,2); SHIPTO_DDL_CC$=ECA$(726,9)
2075 EC_ROWS$=ECA$(1035,3); REM SSP190507 jdf
2080 SUPER_USER_SC$=ECA$(86,1); SECURE_ITEMS$=STP(ECA$(233,20)+ECA$(898,40),2); SHOW_PRICE2$=ECA$(322,1)
2090 EC_CATALOG_ID$=ECA$(325,10); SHOW_ACTIVE_ITEMS$=ECA$(339,1)
2100 MULTI_CTLG_1$=ECA$(626,10); MULTI_CTLG_2$=ECA$(636,10); MULTI_CTLG_3$=ECA$(646,10); MULTI_CTLG_4$=ECA$(656,10); MULTI_CTLG_5$=ECA$(666,10)
2110 MULTI_CTLG_6$=ECA$(676,10); MULTI_CTLG_7$=ECA$(686,10); MULTI_CTLG_8$=ECA$(696,10); MULTI_CTLG_9$=ECA$(706,10); MULTI_CTLG_10$=ECA$(716,10)
2120 BUYER_CATEGORY$=ECA$(83,3); CAN_ORDER$=ECA$(88,1); IGNORE_MAX_LIM$=ECA$(87,1)
2130 PERC_MAX_USAGE_ORD$=ECA$(229,4); DEFAULT_CUST_PO_NUM$=ECA$(291,15); TEST_OPER$=ECA$(338,1)
2140 DEFAULT_ATTENTION$=ECA$(561,30); DEFAULT_MARK_FOR$=ECA$(591,35); SHIP_VIA_CODE_SET$=ECA$(735,10)
2150 CREDIT_CARD_REQ$=ECA$(254,1); CREDIT_CARD_TYPE$=ECA$(493,4)
2152 WMS_TYPE$=ECA$(255,1)
2154 HIDE_CCN$=ECA$(497,20) ! SSP212624  jdf
2160 CREDIT_CARD_NUMBER$=DIM(12,"*")+MID(STP(HIDE_CCN$,2),-4,4); CREDIT_CARD_EXP_DATE$=ECA$(517,4); NAME_ON_CREDIT_CARD$=ECA$(521,40) ! SSP212624 jdf
2165 LAST_FOUR$=STP(ECA$(497,20)),LAST_FOUR$=MID(LAST_FOUR$,LEN(LAST_FOUR$)-3) ! ssp 190139
2170 BILL_TO_NAME_OVR$=ECA$(745,35); B_T_ADDR_1_OVR$=ECA$(780,30); B_T_ADDR_2_OVR$=ECA$(810,30); B_T_CITY_OVR$=ECA$(840,16); B_T_STATE_OVR$=ECA$(856,2); B_T_ZIP_OVR$=ECA$(858,9)
2175 CAN_APPROVE_ORD$=ECA$(867,1); IGNORE_APPR_CRIT$=ECA$(868,1); BUYERS_ID$=ECA$(869,15); DEFAULT_SHIP_TO$=ECA$(884,4)
2180 ! ITEM_SEL_CODE_11$=ECA$(505,3); ITEM_SEL_CODE_12$=ECA$(508,3); ITEM_SEL_CODE_13$=ECA$(511,3); ITEM_SEL_CODE_14$=ECA$(514,3); ITEM_SEL_CODE_15$=ECA$(517,3)
2183 CC_ID$=ECA$(985,10); DISPLAY_STAT$=ECA$(984,1); ADMIN_LINK$=ECA$(996,1); IF ECPARM$(946,1)<>"Y" THEN DISPLAY_STAT$=DIM(1)
2184 COLOR_SC$=ECA$(1029,6),CB_TOPS$=ECA$(997,1); IF COLOR_SC$<>DIM(6) THEN GOSUB FIND_COLOR
2185 IMAGE_VIEW_CAT$=ECA$(1038,1); REM ,NUM_ROWS_PRODCAT$=ECA$(1035,3) ! SSP190507 jdf
2186 MAX_ORD_AMT$=STR(NUM(ECA$(1039,10)):"#,###,###,##0")
2187 APP_GROUP_CD$=ECA$(1049,14),IS_SUPER_APP$=ECA$(1063,1) ! 205923,207913
2189 B_ECA$=ECA$
2190 REFRESH_FLG=1
2195 CALL "*wingrp;Enable",BUTTONS.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$; ENABLE_FLG=1
2196 GOSUB READ_ALT_FILE
2199 RETURN 
2300 ! Load Slections
2310 LOAD_SELECTION:
2312 IF STP(ECA$,2)="" THEN RETURN 
2315 ECA$(1,15)=BUYER_ID$; ECA$(16,35)=BUYER_NAME$
2320 ECA$(65,15)=BUYER_PASSWORD$; ECA$(51,10)=BUYER_CUST_CODE$; ECA$(61,4)=BUYER_LOC_CODE$,ECA$(888,10)=VENDOR$
2325 ECA$(483,10)=ACTIVE_ITEM_CATEGORY$,ECA$(307,15)=ML_DFLT_CUST_PO$,ECA$(944,40)=ML_EMAIL_ORDER$,ECA$(995,1)=CB_SHOW$
2330 ECA$(80,3)=SESSION_EXP_MIN$; ECA$(276,15)=TEMPLATE_CODE$; ECA$(324,1)=WEBEC_ADMIN$; ECA$(480,3)=ASSIGNED_TO_TOPFORM$
2340 ECA$(109,60)=EMAIL_BUYER$; ECA$(256,10)=EMAIL_ACT_BUYER$; ECA$(169,60)=EMAIL_PURCH_AGENT$; ECA$(266,10)=EMAIL_ACT_PURCH_AGNT$
2350 ECA$(340,60)=EMAIL_ADDRESS_CSR$; ECA$(460,10)=EMAIL_ACTIONS_CSR$; ECA$(400,60)=EMAIL_ADDRESS_SALES$; ECA$(470,10)=EMAIL_ACTIONS_SALES$
2360 ECA$(97,1)=ORDER_STATUS_1$; ECA$(98,1)=ORDER_STATUS_2$; ECA$(99,1)=ORDER_STATUS_3$; ECA$(100,1)=ORDER_STATUS_4$
2370 ECA$(92,1)=ORD_STAT_ID_CUST_LOC$; ECA$(336,2)=ORD_STAT_SRT_DEFAULT$; ECA$(726,9)=SHIPTO_DDL_CC$
2380 ECA$(86,1)=SUPER_USER_SC$; IF LEN(SECURE_ITEMS$)>20 THEN ECA$(233,20)=SECURE_ITEMS$(1,20); ECA$(898,40)=SECURE_ITEMS$(21) ELSE ECA$(233,20)=SECURE_ITEMS$ END_IF ; ECA$(322,1)=SHOW_PRICE2$
2390 ECA$(325,10)=EC_CATALOG_ID$; ECA$(339,1)=SHOW_ACTIVE_ITEMS$
2400 ECA$(626,10)=MULTI_CTLG_1$; ECA$(636,10)=MULTI_CTLG_2$; ECA$(646,10)=MULTI_CTLG_3$; ECA$(656,10)=MULTI_CTLG_4$; ECA$(666,10)=MULTI_CTLG_5$
2410 ECA$(676,10)=MULTI_CTLG_6$; ECA$(686,10)=MULTI_CTLG_7$; ECA$(696,10)=MULTI_CTLG_8$; ECA$(706,10)=MULTI_CTLG_9$; ECA$(716,10)=MULTI_CTLG_10$
2420 ECA$(83,3)=BUYER_CATEGORY$; ECA$(88,1)=CAN_ORDER$; ECA$(87,1)=IGNORE_MAX_LIM$
2430 ECA$(229,4)=PERC_MAX_USAGE_ORD$; ECA$(291,15)=DEFAULT_CUST_PO_NUM$; ECA$(338,1)=TEST_OPER$
2440 ECA$(561,30)=DEFAULT_ATTENTION$; ECA$(591,35)=DEFAULT_MARK_FOR$; ECA$(735,10)=SHIP_VIA_CODE_SET$
2450 ECA$(254,1)=CREDIT_CARD_REQ$; ECA$(493,4)=CREDIT_CARD_TYPE$
2452 ECA$(255,1)=WMS_TYPE$
2455 ECA$(1035,3)=EC_ROWS$ ! SSP190507 jdf
2457 IF CREDIT_CARD_NUMBER$<>"" THEN IF CREDIT_CARD_NUMBER$(1,1)="*" THEN CREDIT_CARD_NUMBER$=HIDE_CCN$ ! SSP212624  jdf
2460 ECA$(497,20)=CREDIT_CARD_NUMBER$; ECA$(517,4)=CREDIT_CARD_EXP_DATE$; ECA$(521,40)=NAME_ON_CREDIT_CARD$
2470 ECA$(745,35)=BILL_TO_NAME_OVR$; ECA$(780,30)=B_T_ADDR_1_OVR$; ECA$(810,30)=B_T_ADDR_2_OVR$; ECA$(840,16)=B_T_CITY_OVR$; ECA$(856,2)=B_T_STATE_OVR$; ECA$(858,9)=B_T_ZIP_OVR$
2475 ECA$(867,1)=CAN_APPROVE_ORD$; ECA$(868,1)=IGNORE_APPR_CRIT$; ECA$(869,15)=BUYERS_ID$; ECA$(884,4)=DEFAULT_SHIP_TO$
2480 ! ECA$(505,3)=ITEM_SEL_CODE_11$; ECA$(508,3)=ITEM_SEL_CODE_12$; ECA$(511,3)=ITEM_SEL_CODE_13$; ECA$(514,3)=ITEM_SEL_CODE_14$; ECA$(517,3)=ITEM_SEL_CODE_15$
2483 ECA$(984,1)=DISPLAY_STAT$; ECA$(985,10)=CC_ID$; ECA$(996,1)=ADMIN_LINK$
2485 ECA$(1029,6)=COLOR_SC$,ECA$(997,1)=CB_TOPS$
2486 ECA$(1038,1)=IMAGE_VIEW_CAT$
2487 REM ECA$(1035,3)=NUM_ROWS_PRODCAT$,ECA$(1038,1)=IMAGE_VIEW_CAT$ ! SSP190507 jdf
2488 ECA$(1039,10)=STR(NUM(MAX_ORD_AMT$):"#########0")
2489 ECA$(1049,14)=APP_GROUP_CD$,ECA$(1063,1)=IS_SUPER_APP$ ! 205923,207913
2490 RETURN 
2500 ! Delete Record
2510 DELETE_REC:
2520 MSGBOX MSG("DELETE_REC"),MSG("CONFIRM"),"?,YesNo",ANS$
2530 IF ANS$="NO" THEN RETURN 
2540 REM REMOVE (Z[1],KEY=KEY_1$,DOM=*NEXT) ! SSP212624 jdf
2545 CALL "UPDECA;DELETE_ECA",Z[1],ECA$,ECA2$ ! SSP212624 jdf
2550 ! MSGBOX "Record Deleted!","FYI","!"
2570 GOSUB CLEAR_REC
2590 RETURN 
3000 ! First Record
3010 FIRST_REC:
3020 KEY_1$=KEF(Z[1],END=NO_FIRST)
3030 READ (Z[1],KEY=KEY_1$)IOL=0310
3040 GOSUB LOAD_INFO
3090 RETURN 
3200 ! Last Record
3210 LAST_REC:
3220 KEY_1$=KEL(Z[1],ERR=NO_LAST)
3230 READ (Z[1],KEY=KEY_1$)IOL=0310
3240 GOSUB LOAD_INFO
3290 RETURN 
3400 ! Prior Record
3410 PRIOR_REC:
3420 KEY_1$=KEP(Z[1],END=START_FILE)
3430 READ (Z[1],KEY=KEY_1$)IOL=0310
3440 GOSUB LOAD_INFO
3490 RETURN 
3600 ! Next Record
3610 NEXT_REC:
3620 KEY_1$=KEY(Z[1],END=END_FILE)
3630 READ (Z[1],KEY=KEY_1$)IOL=0310
3640 GOSUB LOAD_INFO
3690 RETURN 
5000 ! Check Changes
5010 CHECK_CHANGES:
5020 IF ECA$=B_ECA$ THEN RETURN 
5030 MSGBOX MSG("REC_ALTERD"),MSG("UPDATE"),"?,YesNo",ANS$
5040 IF ANS$="NO" THEN CMD_STR$="END"; EXIT 
5050 GOSUB WRITE_REC
5090 RETURN 
5500 ! CLEAR RECORD
5510 CLEAR_REC:
5511 KEY_1$=""; REM SSP  210229
5515 BUYER_ID$=""; BUYER_NAME$=""; BUYER_PASSWORD$=""; WEBEC_ADMIN$=""; SESSION_EXP_MIN$="",BUYER_DESC$="",BUYERS_EMAIL$=""
5520 ASSIGNED_TO_TOPFORM$=""; BUYER_CUST_CODE$=""; BUYER_LOC_CODE$=""; SUPPLY_WHSE$=""; TEMPLATE_CODE$=""; VENDOR$=""
5530 EMAIL_ACTIONS_CSR$=""; EMAIL_ACTIONS_SALES$=""; EMAIL_ACT_BUYER$=""; EMAIL_ACT_PURCH_AGNT$=""
5540 EMAIL_ADDRESS_CSR$=""; EMAIL_ADDRESS_SALES$=""; EMAIL_BUYER$=""; EMAIL_PURCH_AGENT$=""
5550 ORDER_STATUS_1$=""; ORDER_STATUS_2$=""; ORDER_STATUS_3$=""; ORD_STAT_ID_CUST_LOC$=""; ORD_STAT_SRT_DEFAULT$=""; SHIPTO_DDL_CC$=""
5560 ACTIVE_ITEM_CATEGORY$=""; EC_CATALOG_ID$=""; SHOW_ACTIVE_ITEMS$=""; SHOW_PRICE2$=""; SUPER_USER_SC$=""
5570 ML_ACTIVE_DESC$=""; ML_DFLT_CUST_PO$=""; MULTI_CTLG_10$=""; MULTI_CTLG_1$=""; MULTI_CTLG_2$=""; MULTI_CTLG_3$=""
5580 MULTI_CTLG_4$=""; MULTI_CTLG_5$=""; MULTI_CTLG_6$=""; MULTI_CTLG_7$=""; MULTI_CTLG_8$=""; MULTI_CTLG_9$=""; SECURE_ITEMS$=""
5590 BUYER_CATEGORY$=""; CAN_ORDER$=""; DEFAULT_ATTENTION$=""; DEFAULT_CUST_PO_NUM$=""; DEFAULT_MARK_FOR$=""
5600 IGNORE_MAX_LIM$=""; PERC_MAX_USAGE_ORD$=""; SHIP_VIA_CODE_SET$=""; TEST_OPER$=""
5610 CC_ID$=""; CREDIT_CARD_EXP_DATE$=""; CREDIT_CARD_NUMBER$=""; CREDIT_CARD_REQ$=""; CREDIT_CARD_TYPE$=""
5620 NAME_ON_CREDIT_CARD$=""; ADMIN_LINK$=""; BILL_TO_NAME_OVR$=""; DEFAULT_SHIP_TO$=""
5630 BUYERS_ID$=""; B_T_ADDR_1_OVR$=""; B_T_ADDR_2_OVR$=""; B_T_CITY_OVR$=""; B_T_STATE_OVR$=""
5640 B_T_ZIP_OVR$=""; CAN_APPROVE_ORD$=""; CB_SHOW$=""; DISPLAY_STAT$="",COST_DESC$="",SHIPTO_DESC$=""
5650 IGNORE_APPR_CRIT$=""; ML_EMAIL_ORDER$="",COLOR_SC$="",COLOR_DESC$=""
5660 MAX_ORD_AMT$=""
5662 APP_GROUP_CD$="",IS_SUPER_APP$="" ! 205923,207913
5685 REFRESH_FLG=1; NEXT_ID=BUYER_ID.CTL,NEXT_FOLDER=FLDR.ECGMAA.1.CTL
5687 DIM ECA$(1540),B_ECA$(1540)
5690 RETURN 
6000 ! GET THE SUPPLY WAREHOUSE
6010 GET_WAREHOUSE:
6016 IF STP(BUYER_CUST_CODE$)="" THEN MSGBOX "Please enter Customer code",MSG("WARNING","!,TIM=5"); NEXT_ID=BUYER_CUST_CODE.CTL
6020 KEY_4$=BUYER_CUST_CODE$
6030 DIM ECS$(1000); FIND (Z[4],KEY=KEY_4$,DOM=*NEXT)ECS$
6033 IF EMAIL_ADDRESS_CSR$="" THEN EMAIL_ADDRESS_CSR$=ECS$(42,60),EMAIL_ACTIONS_CSR$=ECS$(102,10); REM SSP208367 jdf
6035 IF EMAIL_ADDRESS_SALES$="" THEN EMAIL_ADDRESS_SALES$=ECS$(384,60),EMAIL_ACTIONS_SALES$=ECS$(444,10); REM SSP208367 jdf
6040 IF NUL(ECA$(61,4)) THEN DIM FM0$(500); FIND (Z[5],KEY="C"+ECA$(51,14),DOM=*NEXT)FM0$
6045 IF NUL(FM0$) THEN DIM FM0$(500)
6050 DIM FMPD$(500); FIND (Z[7],KEY="D"+KEY_4$,DOM=*NEXT)FMPD$
6070 GOSUB LOAD_WAREHOUSE_INFO
6080 REFRESH_FLG=1
6090 RETURN 
6100 ! LOAD THE WAREHOUSE
6110 LOAD_WAREHOUSE_INFO:
6120 DIM SUPPLY_WHSE$(12)
6125 IF ECA$(1008,21)<>DIM(21) THEN SUPPLY_WHSE$="Whse Grp: "+ECA$(1008,21); GOTO 6175 ! ssp 183142
6130 IF STP(ECS$(515,21),3," ")="" THEN GOTO 6150
6140 SUPPLY_WHSE$="Whse Grp: "+ECS$(515,21); GOTO 6190
6150 IF STP(ECA$(61,4),3," ")="" THEN GOTO 6170
6160 IF STP(FM0$(284,4),3," ")="" THEN GOTO 6170 ELSE SUPPLY_WHSE$="Shipto: "+FM0$(284,4); GOTO 6190
6170 IF STP(FMPD$(238,4),3," ")="" THEN SUPPLY_WHSE$="*NeedtoSet" ELSE SUPPLY_WHSE$="Cust: "+FMPD$(238,4)
6190 RETURN 
6300 ! Get Catalog ID
6310 GET_CATALOG:
6320 EC_CATALOG_ID$=PAD(EC_CATALOG_ID$,10)
6330 DIM EDA$(128); FIND (Z[9],KEY=EC_CATALOG_ID$,DOM=NOT_FOUND)EDA$
6340 MULTI_CTLG_1$=EC_CATALOG_ID$
6390 RETURN 
6400 ! CATALOG NOT FOUND
6410 NOT_FOUND:
6420 MSGBOX MSG("REC_NOTFND"),MSG("WARNING"),"STOP"
6430 MULTI_CTLG_1$=""; EC_CATALOG_ID$=""
6440 NEXT_ID=EC_CATALOG_ID.CTL
6480 REFRESH_FLG=1
6490 RETURN 
8000 ! Messages
8010 TERM_MSG:
8020 MSGBOX MSG("ADD_RECORD"),MSG("CONFIRM"),"?,YesNo",ANS$
8030 IF ANS$="NO" THEN BUYER_ID$=""; NEXT_ID=BUYER_ID.CTL; EXIT 
8040 DIM ECA$(1540); NEXT_ID=CUST_LOGO_FILE_NAME.CTL
8045 GOSUB COPY_OPTION
8050 CALL "*wingrp;Enable",FIELDS.GRP$; CALL "*wingrp;Enable",BUTTONS.GRP$
8080 ENABLE_FLG=1,REFRESH_FLG=1
8085 ECA$(480,3)=%X3$(9,3),ECA$(80,3)="060",ECA$(253,1)="Y"
8086 ASSIGNED_TO_TOPFORM$=ECA$(480,3),SESSION_EXP_MIN$="060"
8087 CAN_ORDER$="Y",ECA$(88,1)="Y" ! SSP 208372
8090 RETURN 
8100 ! No First Record
8110 NO_FIRST:
8120 MSGBOX MSG("REC_NO_1ST"),"FYI","!"
8130 RETURN 
8200 ! No Last Record
8210 NO_LAST:
8220 MSGBOX MSG("REC_NO_LST$"),"FYI","!"
8230 RETURN 
8300 ! Start of File
8310 START_FILE:
8320 MSGBOX MSG("START_FILE"),"FYI","!"
8330 RETURN 
8400 ! End of File
8410 END_FILE:
8420 MSGBOX MSG("END_OF_FIL"),"FYI","!"
8430 RETURN 
8500 ! Invalid Day Message
8510 INVALID_MSG:
8520 MSGBOX MSG("INVALID_D"),"FYI","!"
8590 RETURN 
8800 ! Invalid Item Code Message
8810 INVALID_ITM:
8820 MSGBOX MSG("INVA_ITEM"),MSG("WARNING"),"STOP"
8830 ITEM_CODE$=""; NEXT_ID=ITEM_CODE.CTL
8890 RETURN 
9000 ! Parameters
9010 GET_SYS_PARAM:
9020 DIM ECPARM$(1000); READ (Z[6],KEY=X3$(9,3)+"E/C",DOM=*NEXT)ECPARM$
9030 DIM ARPARM$(255); READ (Z(6),KEY=%C$+"A/R",DOM=*NEXT)ARPARM$
9040 DIM USERPARM$(255); READ (Z(6),KEY="osec"+X3$(40,3),DOM=*NEXT)USERPARM$
9090 RETURN 
9999 END 
10100 QUERY:
10110 PROCESS "QRY_ECA","../ECG/EC.EN",VAL$; IF STP(VAL$)="" THEN RETURN 
10120 BUYER_ID$=VAL$(1,10); ITEM_CODE$=VAL$(11,10)
10150 GOSUB FIND_REC
10160 NEXT_ID=DEF_CATEGORY.CTL
10180 REFRESH_FLG=1
10190 RETURN 
11000 ! Item Query
11010 ITEM_QUERY:
11020 VAL$=""
11030 IF NUL(BUYER_ID$) THEN %ITEM_CUST$="          "; PROCESS "QRY_IC0.1.4","../ICG/IC.EN",VAL$; IF NUL(VAL$) THEN RETURN ELSE QRY_VAL$=VAL$
11040 IF NOT(NUL(BUYER_ID$)) THEN %BUYER_ID$=BUYER_ID$; PROCESS "QRY_FM1_ITEM","../FMG/FM.EN",VAL$; IF NUL(VAL$) THEN RETURN ELSE QRY_VAL$=VAL$
11070 REFRESH_FLG=1
11080 RETURN 
12000 SEL_ACTIVE_ITEM: REFRESH_FLG=1
12010 IF NOT(NUL(ACTIVE_ITEM_CATEGORY$)) THEN ACTIVE_ITEM_CATEGORY$=STR(NUM(ACTIVE_ITEM_CATEGORY$,ERR=*NEXT):"0000000000"); GOTO 12030 ELSE ACTIVE_ITEM_CATEGORY$=""
12020 ACTIVE_ITEM_CATEGORY$=PAD(ACTIVE_ITEM_CATEGORY$,10," ")
12030 FIND (Z(8),KEY=ACTIVE_ITEM_CATEGORY$,DOM=NO_ECG)ECG$
12040 ML_ACTIVE_DESC$=ECG$(11,30)
12050 RETURN 
12100 NO_ECG:
12105 IF ID$<>"ACTIVE_ITEM_CATEGORY" THEN RETURN 
12110 MSGBOX "Record no Found",MSG("WARNING"),"!"
12120 ACTIVE_ITEM_CATEGORY$="",NEXT_ID=ACTIVE_ITEM_CATEGORY.CTL
12130 RETURN 
13000 CATEGORIES:
13010 IF ECA$(480,3)<>DIM(3) AND ECA$(480,3)<>%X3$(9,3) THEN RETURN 
13020 DIM OPTIONS$(50)
13030 IF ECA$(61,4)=DIM(4) THEN OPTIONS$(16,1)="Y"; REM "set to ignore the active items for purchasing agents that would prevent publishing (154600)
13040 CALL "EC3UT4",%X3$,%X4$,ECA$(1,15),CATEGORIES$,OPTIONS$
13050 ECA2$=CATEGORIES$
13060 WRITE (Z[1],KEY=KEY_1$)IOL=0310
13070 ECA2$="",CATEGORIES$=""
13080 RETURN 
14000 COPY_OPTION:
14005 PRINT 'CI',
14010 PROCESS "ECGMAA.COPY","../ECG/EC.EN",OPTION$,FROM_BUYER$
14020 IF OPTION$<>"1" THEN RETURN 
14030 FIND RECORD (Z(1),KEY=FROM_BUYER$,DOM=*NEXT)COPY_FROM$; GOTO 14050
14050 COPY_FROM$(1,15)=BUYER_ID$,COPY_FROM$(998,10)=DIM(10)
14060 WRITE RECORD (Z(1),KEY=COPY_FROM$(1,15))COPY_FROM$
14070 GOTO FIND_REC
18000 SEL_PASSWORD:IF FOLDER_ID$<>"ECGMAA.1" THEN RETURN ! SSP 202725
18001 PRINT 'CI',
18010 L=0,OP$=ID'*,XX=ID'COL,YY=ID'LINE,XXX=ID'COLS,YYY=ID'LINES; DIM OP$[200],NA$[200]
18020 ! 
18030 NXT_OPT:
18040 X=POS(","=OP$); IF X=0 THEN GOTO END_OPT
18050 LST$=OP$(1,X-1),OP$=OP$(X+1),L=L+1,OP$[L]=LST$,NA$[L]=EVS("ID'"+LST$+"$")
18060 ! PRINT OP$[L],"  ",NA$[L]
18070 GOTO NXT_OPT
18080 ! 
18090 END_OPT:
18100 MULTI_LINE REMOVE ID
18110 IF REST=0 THEN MULTI_LINE ID,@(XX,YY,XXX,YYY),OPT="H"+OPT$; HIDE CONTROL ID+3000; LAST_FOUR$="",REFRESH_FLG=1 ELSE MULTI_LINE ID,@(XX,YY,XXX,YYY),OPT="H$"+OPT$; HEIGHT$=ID'HEIGHT$; SHOW CONTROL ID+3000; LAST_FOUR$=STP(CREDIT_CARD_NUMBER$),LAST_FOUR$=MID(LAST_FOUR$,LEN(LAST_FOUR$)-3),REFRESH_FLG=1 ! SSP 190139
18120 FOR AA=1 TO L
18130 BB$=PAD(OP$[AA],6," "); IF POS(BB$="Len   Col   Cols  Line  Lines Width Height",6)<>0 THEN CONTINUE
18140 IF NOT(NUL(NA$[AA])) THEN EXECUTE "id'"+OP$[AA]+"$="+QUO+NA$[AA]+QUO
18150 NEXT AA
18160 RETURN 
21000 LOOKUP_ZIP:! Lookup zipcode, set city & state if found, set NEW_ZIP for later use
21003 IF NUL(B_T_ZIP_OVR$) THEN RETURN 
21005 NEW_ZIP=0
21010 CALL "ZYGMBA;CHECK_ZIP",B_T_ZIP_OVR$,ZIP_FOUND,ZIP_CITY$,ZIP_ST$,"",ZIP_AREA_CODE$,""
21020 IF ZIP_FOUND THEN B_T_CITY_OVR$=ZIP_CITY$,B_T_STATE_OVR$=ZIP_ST$; REFRESH_FLG=1 ELSE NEW_ZIP=1
21095 RETURN 
21099 ! 
21100 UPDATE_ZIP:! If new_zip then update the zip code table
21105 IF NUL(CUST_PHONE$) THEN DIM CUST_PHONE$(14)
21110 IF NEW_ZIP THEN CALL "ZYGMBA;UPDATE_ZIP",B_T_ZIP_OVR$,B_T_CITY_OVR$,B_T_STATE_OVR$,"",CUST_PHONE$(1,3),B_T_CITY_OVR$ ! get area code from phone,long city from regular city
21180 NEW_ZIP=0
21195 RETURN 
21199 ! 
22000 SEL_COLOR: REFRESH_FLG=1
22010 IF STP(COLOR_SC$,1)<>"" THEN XX=NUM(COLOR_SC$,ERR=*NEXT),COLOR_SC$=STR(XX:"000000"); GOTO 22030 ELSE GOTO *NEXT
22020 COLOR_SC$=PAD(COLOR_SC$,6," ")
22030 FIND_COLOR:FIND (Z(10),KEY=COLOR_SC$,DOM=NO_COLOR)CO$
22040 COLOR_DESC$=MID(CO$,7,35)
22050 RETURN 
22100 NO_COLOR:IF ID$="COLOR_SC" THEN MSGBOX "Color Scheme not found",MSG("WARNING"),"!,TIM=5"; COLOR_SC$="",COLOR_DESC$="",NEXT_ID=COLOR_SC.CTL; EXIT ELSE RETURN 
22500 SEL_COST_CENTER: REFRESH_FLG=1
22505 IF STP(SHIPTO_DDL_CC$)="" THEN RETURN 
22510 XX=NUM(SHIPTO_DDL_CC$,ERR=*NEXT),SHIPTO_DDL_CC$=STR(XX:"0000"); GOTO 22530
22520 SHIPTO_DDL_CC$=PAD(SHIPTO_DDL_CC$,4," ")
22530 _KK$="c"+%CUSTOMER$+SHIPTO_DDL_CC$,_KK$=PAD(_KK$,20," ")
22540 FIND (Z(7),KEY=_KK$,DOM=NO_COST)FMP$
22550 COST_DESC$=STP(FMP$(21,30))
22560 RETURN 
22600 NO_COST:IF ID$="SHIPTO_DDL_CC" THEN MSGBOX "Cost Center no found",MSG("WARNING"),"!,TIM=6"; SHIPTO_DDL_CC$="",NEXT_ID=SHIPTO_DDL_CC.CTL; EXIT ELSE RETURN 
22610 SEL_SHIPTO: REFRESH_FLG=1
22615 IF STP(DEFAULT_SHIP_TO$)="" THEN COST_DESC$="",SHIPTO_DESC$=""; RETURN 
22620 XX=NUM(DEFAULT_SHIP_TO$,ERR=*NEXT),DEFAULT_SHIP_TO$=STR(XX:"0000"); GOTO 22640
22630 DEFAULT_SHIP_TO$=PAD(DEFAULT_SHIP_TO$,4," ")
22640 _KK$="C"+%CUSTOMER$+DEFAULT_SHIP_TO$
22650 FIND (Z(5),KEY=_KK$,DOM=NO_LOC)FM0$
22660 SHIPTO_DESC$=STP(FM0$(16,35))
22670 RETURN 
22680 NO_LOC:IF ID$="DEFAULT_SHIP_TO" THEN MSGBOX "Ship to Location no found",MSG("WARNING"),"!,TIM=6"; NEXT_ID=DEFAULT_SHIP_TO.CTL,DEFAUT_SHIP_TO$=""; EXIT ELSE RETURN 
22700 READ_ALT_FILE: REFRESH_FLG=1
22710 GOSUB SEL_COLOR; GOSUB SEL_COST_CENTER; GOSUB SEL_SHIPTO; GOSUB READ_EDF
22720 GOSUB GET_WAREHOUSE; GOSUB CHECK_BUYER
22730 RETURN 
22800 READ_EDF: REFRESH_FLG=1,BUYER_DESC$=""
22805 IF STP(BUYER_CATEGORY$)="" THEN RETURN 
22810 XX=NUM(BUYER_CATEGORY$,ERR=*NEXT),BUYER_CATEGORY$=STR(XX:"000"); GOTO 22830
22820 BUYER_CATEGORY$=PAD(BUYER_CATEGORY$,3," ")
22830 FIND (Z(11),KEY=BUYER_CATEGORY$,DOM=NO_BUY)EDF$
22840 BUYER_DESC$=EDF$(4,30)
22850 RETURN 
22860 NO_BUY:IF ID$="BUYER_CATEGORY" THEN MSGBOX "Buyer Category no found",MSG("WARNING"),"!,TIM=6"; NEXT_ID=BUYER_CATEGORY.CTL,BUYER_CATEGORY$="" ELSE RETURN 
23000 CHECK_BUYER: BUYERS_EMAIL$=""
23005 IF STP(BUYERS_ID$)="" THEN RETURN 
23010 REFRESH_FLG=1; IF ID$="BUYERS_ID" AND STP(BUYER_ID$)=STP(BUYERS_ID$) THEN NEXT_ID=BUYERS_ID.CTL; MSGBOX MSG("PA_BC")+":"+BUYERS_ID$+" "+%EC_BUYER_NAME$+SEP+"not allowed in this field "+MSG("BUYER_ID")+":"+BUYER_ID$,MSG("WARNING"),"!,TIM=8"; BUYERS_ID$=""; RETURN 
23020 FIND (Z(1),KEY=BUYERS_ID$)BUYERS$
23025 B_BUYERS_ID$=BUYERS_ID$
23030 READ (Z(1),KEY=KEY_1$,DOM=*NEXT)IOL=0310
23035 BUYERS_ID$=B_BUYERS_ID$
23037 IF ID$="BUYERS_ID" AND POS("@"=BUYERS$(109,60))=0 THEN NEXT_ID=BUYERS_ID.CTL; MSGBOX "Buyer "+STP(BUYERS_ID$)+" "+%EC_BUYER_NAME$+SEP+" does not have a valid email address",MSG("WARNING"),"!,TIM=7"; NEXT_ID=BUYERS_ID.CTL,BUYERS_ID$=""; RETURN ! SSP208433 jdf
23040 REM IF ID$="BUYERS_ID" AND POS("@"=BUYERS$(109,60))=0 THEN MSGBOX "Buyer "+STP(BUYERS_ID$)+" "+%EC_BUYER_NAME$+SEP+" does not have a valid email address",MSG("WARNING"),"!,TIM=7"; NEXT_ID=BUYERS_ID.CTL; NEXT_ID=BUYER_ID.CTL,BUYERS_ID$=""; RETURN ! SSP208433 jdf
23050 IF ID$="BUYERS_ID" AND STP(BUYERS$(51,10))<>STP(BUYER_CUST_CODE$) THEN NEXT_ID=BUYERS.ID.CTL; MSGBOX "Buyer : "+BUYERS_ID$+" "+%EC_BUYER_NAME$+SEP+"Not Associated with Customer : "+FN%ZZDISP$(BUYER_CUST_CODE$,"A/R"),MSG("WARNING"),"!,TIM=7"; NEXT_ID=BUYERS_ID.CTL,BUYERS_ID$=""; RETURN 
23055 BUYERS_EMAIL$=BUYERS$(109,60)
23060 RETURN 
23200 GET_NUM_ROWS:! SSP190507 jdf-added routine
23210 TMP_FLD=NUM(EC_ROWS$,ERR=INVALID_ROWS)
23220 EC_ROWS$=STR(TMP_FLD:"000")
23280 REFRESH_FLG=1
23295 RETURN 
23300 INVALID_ROWS:! SSP190507 jdf-added routine
23310 TMP_TITLE$="Invalid Number of Rows"
23315 TMP_MSG$="The number of rows must be 0-999."
23340 MSGBOX TMP_MSG$,TMP_TITLE$,"!, ok"
23350 EC_ROWS$=""
23380 NEXT_ID=EC_ROWS.CTL
23395 RETURN 
56000 ! "190139-Credit Card Information on Orders is showing to all numbers
56001 ! "       should only display the last four digits
56002 REM "180032-Wireless Warehousing
56010 REM "190074-SSP184884; Color Scheme field added, new file EE2, can set
56020 REM "192510-Order Approval based on dollar amount, per order, set by buyer
56021 ! "183142-WO182124, warehouse group by buyer                          
56022 REM "198131-Buyer setup defaults color scheme value to "000000", not "" 
56024 REM "192407-Buyer needs 20 additional secure codes.                     
56025 ! "202725-Error #65: window element does not exist, when in ECGMAA    
56026 REM "205923-Would like quote on two tiered purchase approval.           
56028 REM "207913-Purchase approvals: Super-approver must be able to approve all worksheets
56030 REM "208367-When in webec customer parameters and you set up the default
56032 REM "190507- WO189439; NEW EC BUYER PARAMETER
56033 ! "208372-In buyer setup when setting up a new buyer on the order     
56035 REM "212624-Encrypt Buyer credit card information. Modify buyer maint   
