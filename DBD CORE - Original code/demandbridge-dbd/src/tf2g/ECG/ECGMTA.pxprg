0010 ! EGCMTA - Tracking Information setup
0020 ! Generated by ProvideX® NOMADS II File Maintenance on May. 15, 2003 10:00
0030 ! ************************************************************************
0035 REM "5.7 - 09/12/13 - 11.838611 - tma - SSP# 261361
0037 REM "261361-ECGMTA - can we add a right query to this panel, similar to 
0040 REM "Copyright 2013 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 PROCESS "ECGMTA","../ECG/EC.EN"
0060 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 ! 
0130 X0$="EC3MTA",X1$="Freight Trackin System"
0140 ! 
0150 X0=-1,X2=-1
0160 CALL "ZZCOMP",X0$,X11$,X2$,X3$,X4$,X5$,X0,X1,X2; IF X1>0 THEN CMD_STR$="END"; EXIT 
0170 ! 
0190 DIM Z[NUM(X3$(60,3))],SM4[15],FS1[13],PO2[27],FS2[29] ! WO244750, expand SM4
0200 ! Files
0210 Z$="01O SM4...  02O PO1...  03O PO2...  04O FS1...  05O FS2...  06O ZZPARM  07O SM5...  08O SM6...  09O EC6...  " ! SSP 186935
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
0300 ! IOList Section
0310 IOLIST SM4$,SM4{ALL}
0320 IOLIST PO1$
0330 IOLIST PO2$,PO2{ALL}
0340 IOLIST FS1$,FS1{ALL}
0350 IOLIST FS2$,FS2{ALL}
0400 ! System Parameters
0410 GOSUB GET_SYS_PARAM
0430 CALL "*wingrp;disable",FIELDS.GRP$; ENABLE_FLG=0
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0550 ! 
0790 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0920 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0970 RETURN 
1000 ! READ RECORD
1010 FIND_REC:
1015 IF NUL(PORDER$) THEN RETURN 
1020 KEY_1$=PORDER$+PAD(PO_LINE_NUM$,3)+PAD(LOC_CODE$,1)+BOX_NUMBER$ ! SSP198515 jdf,A1$="",A2$="",A3$=""
1030 FIND (Z[1],KEY=KEY_1$,DOM=TERM_MSG)IOL=0310
1040 ! 
1050 GOSUB LOAD_INFO
1060 CALL "*wingrp;Enable",BUTTONS.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$
1070 B_SM4$=SM4$
1085 REFRESH_FLG=1
1090 RETURN 
1100 ! Purchase Order Header
1110 PO_HEAD:
1112 CUSTOMER1$=""
1113 IF QRY_VAL$<>"" THEN PORDER$=QRY_VAL$,QRY_VAL$="",REFRESH_FLG=1
1120 IF NUL(PORDER$) THEN RETURN 
1121 IF LEN(PORDER$)>=8 THEN P_DD$=PORDER$(1,2) ELSE P_DD$="" ! SSP 198515
1122 IF ARPARM$(13,1)="N" AND LEN(PORDER$)>=8 THEN PORDER$=PORDER$(3)
1123 CALL "ZZWLKU;PARSE_PORDER",PORDER$,P_D$,P_C$; PORDER$=P_D$+P_C$
1124 IF P_DD$<>"" AND PORDER$(1,2)<>P_DD$ THEN PORDER$(1,2)=P_DD$ ! SSP 198515
1125 IF (LEN(PORDER$)=8 OR MID(PORDER$,9,1)=" ") THEN TF_ACCT_TYPE$[1,0]="O/P" ELSE TF_ACCT_TYPE$[1,0]="P/O"
1130 DIM FS1$(350); FIND (Z[4],KEY=PORDER$(1,8),DOM=*NEXT)IOL=0340; CUSTOMER1$=FS1$(6,10); CALL "ZZWLKU;PARSE_CUST",CUSTOMER1$,%CUST_DIV$,%CUST_CODE$; GOTO 1150
1140 DIM PO1$(400); READ (Z[2],KEY=PORDER$,DOM=*NEXT)IOL=0320; GOTO 1150
1150 IF NUL(FS1$) THEN VENDOR_1$=PO1$(7,10) ELSE CALL "*WINGRP;HIDE",VEND_1.GRP$; CALL "*WINGRP;SHOW",CUST_1.GRP$
1180 REFRESH_FLG=1
1190 RETURN 
1200 ! Purchase order Line
1210 PO_LINE:
1215 ITEM_CODE$="",ITEM_DESC$=""
1220 IF NUL(PO_LINE_NUM$) THEN RETURN 
1230 PO_LINE_NUM$=PAD(PO_LINE_NUM$,3,0,"0"),ITEM_CODE$=""
1240 DIM PO2$(170); READ (Z[3],KEY=PORDER$+PO_LINE_NUM$,DOM=*NEXT)IOL=0330; GOTO 1260
1250 DIM FS2$(230); FIND (Z[5],KEY=PORDER$(1,8)+PO_LINE_NUM$,DOM=*NEXT)IOL=0350
1260 IF NUL(FS2$) THEN ITEM_CODE$=PO2$(101,10); ITEM_DESC$=PO2$(28,40) ELSE ITEM_CODE$=FS2$(19,10); ITEM_DESC$=FS2$(50,40)
1280 REFRESH_FLG=1
1290 RETURN 
1300 ! GET ITEM INFORMATION
1310 GET_ITEM:
1315 ITEM_CODE$=PAD(ITEM_CODE$,10)
1320 IF NOT(NUL(BUYER_ID$)) THEN GOTO 1350
1325 KEY_2$="          "+ITEM_CODE$
1330 READ (Z[2],KEY=KEY_2$,DOM=INVALID_ITM)IOL=0330
1335 %ITEM_DESC$=IC0$(21,40)
1337 GOSUB FIND_REC
1340 REFRESH_FLG=1; RETURN 
1350 KEY_3$=BUYER_ID$+ITEM_CODE$
1360 READ (Z[3],KEY=KEY_3$,DOM=INVALID_ITM)IOL=0340
1370 %ITEM_DESC$=FM1$(42,40)
1380 REFRESH_FLG=1
1385 GOSUB FIND_REC
1390 RETURN 
1400 ! Box Sequense Number
1410 BOX_NUM: REFRESH_FLG=1
1420 IF NUL(BOX_NUMBER$) THEN RETURN 
1430 BOX_NUMBER$=PAD(BOX_NUMBER$,3,0,"0")
1490 RETURN 
1500 ! Write Record
1510 WRITE_REC:
1540 WRITE (Z[1],KEY=KEY_1$)IOL=0310
1545 GOSUB WRITE_ALT_FILE ! SSP 186935
1550 GOSUB CLEAR_REC ! MSGBOX "Record Updated!","FYI","!"
1580 B_SM4$=SM4$
1590 RETURN 
2000 ! Load Information
2010 LOAD_INFO:
2013 IF NUL(SM4$) THEN RETURN 
2015 PORDER$=SM4$(1,9); PO_LINE_NUM$=SM4$(10,3) ! SSP198515 jdf
2020 LOC_CODE$=SM4$(13,1); SEQ_NUM$=SM4$(14,1); SHIPPED_ON_DATE$=SM4$(15,6)
2030 SHIPPED_ON_TIME$=SM4$(21,4); EST_ARRIVAL$=SM4$(25,6); CARRIER_ID$=SM4$(31,6); CARRIER_NAME$=SM4$(37,12)
2040 TRACKING_NUM$=SM4$(383,60); PICKUP_NUM$=SM4$(69,16); ZIP_CODE$=SM4$(85,9); ZONE$=SM4$(94,3),TF_ZONE$=SM4$(94,3) ! SSP 186935 SSP 257952
2050 UPDATE_ORDER$=SM4$(97,1); RECVD$=SM4$(98,1); DONT_BILL$=SM4$(99,1); INVOICED$=SM4$(100,1)
2060 AR_INV_NUM$=SM4$(101,8); PACKER_ID$=SM4$(109,3); LOT_ID$=SM4$(112,12); BOX_NUMBER$=SM4$(124,3)
2070 TOTAL_BOXES$=SM4$(127,3); RECVG_REPORT_NUM$=SM4$(130,8); STARTING_NUM$=SM4$(138,9)
2110 QTY=SM4[0]; ACTUAL_WEIGHT=SM4[1]; SHIPPING_WT=SM4[2]; TOTAL_COST=SM4[3]
2185 B_SM4$=SM4$
2190 REFRESH_FLG=1
2195 CALL "*wingrp;Enable",BUTTONS.GRP$; CALL "*wingrp;Enable",FIELDS.GRP$; ENABLE_FLG=1
2196 GOSUB PO_HEAD
2199 RETURN 
2300 ! Load Slections   
2310 LOAD_SELECTION:
2313 IF NUL(PORDER$) THEN RETURN 
2315 SM4$(1,9)=PORDER$; SM4$(10,3)=PO_LINE_NUM$ ! SSP198515 jdf
2320 SM4$(13,1)=LOC_CODE$; SM4$(14,1)=SEQ_NUM$; SM4$(15,6)=SHIPPED_ON_DATE$
2330 SM4$(21,4)=SHIPPED_ON_TIME$; SM4$(25,6)=EST_ARRIVAL$; SM4$(31,6)=CARRIER_ID$; SM4$(37,12)=CARRIER_NAME$
2340 SM4$(383,60)=TRACKING_NUM$; SM4$(69,16)=PICKUP_NUM$; SM4$(85,9)=ZIP_CODE$; SM4$(94,3)=TF_ZONE$ ! SSP 186935 SSP 257952
2350 SM4$(97,1)=UPDATE_ORDER$; SM4$(98,1)=RECVD$; SM4$(99,1)=DONT_BILL$; SM4$(100,1)=INVOICED$
2360 SM4$(101,8)=AR_INV_NUM$; SM4$(109,3)=PACKER_ID$; SM4$(112,12)=LOT_ID$; SM4$(124,3)=BOX_NUMBER$
2370 SM4$(127,3)=TOTAL_BOXES$; SM4$(130,8)=RECVG_REPORT_NUM$; SM4$(138,9)=STARTING_NUM$
2410 SM4[0]=QTY; SM4[1]=ACTUAL_WEIGHT; SM4[2]=SHIPPING_WT; SM4[3]=TOTAL_COST
2490 RETURN 
2500 ! Delete Record
2510 DELETE_REC:
2520 MSGBOX MSG("DELETE_REC"),MSG("CONFIRM"),"?,YesNo",ANS$
2530 IF ANS$="NO" THEN RETURN 
2540 REMOVE (Z[1],KEY=KEY_1$,DOM=*NEXT)
2550 GOSUB DELETE_ALT_FILE ! SSP 186935
2570 GOSUB CLEAR_REC
2590 RETURN 
3000 ! First Record
3010 FIRST_REC:
3020 KEY_1$=KEF(Z[1],END=NO_FIRST)
3030 READ (Z[1],KEY=KEY_1$)IOL=0310
3040 GOSUB LOAD_INFO
3090 RETURN 
3200 ! Last Record
3210 LAST_REC:
3220 KEY_1$=KEL(Z[1],ERR=NO_LAST)
3230 READ (Z[1],KEY=KEY_1$)IOL=0310
3240 GOSUB LOAD_INFO
3290 RETURN 
3400 ! Prior Record
3410 PRIOR_REC:
3420 KEY_1$=KEP(Z[1],END=START_FILE)
3430 READ (Z[1],KEY=KEY_1$)IOL=0310
3440 GOSUB LOAD_INFO
3490 RETURN 
3600 ! Next Record
3610 NEXT_REC:
3620 KEY_1$=KEY(Z[1],END=END_FILE)
3630 READ (Z[1],KEY=KEY_1$)IOL=0310
3640 GOSUB LOAD_INFO
3690 RETURN 
5000 ! Check Changes
5010 CHECK_CHANGES:
5015 GOSUB LOAD_SELECTION
5020 IF SM4$=B_SM4$ THEN RETURN 
5030 MSGBOX MSG("REC_ALTERD"),MSG("UPDATE"),"?,YesNo",ANS$
5040 IF ANS$="NO" THEN CMD_STR$="END"; EXIT 
5050 GOSUB WRITE_REC
5090 RETURN 
5500 ! CLEAR RECORD
5510 CLEAR_REC:
5515 PORDER$=""; PO_LINE_NUM$="",CUSTOMER1$="",ITEM_CODE$="",%CUST_NAME$="",ITEM_DESC$=""
5520 LOC_CODE$=""; SEQ_NUM$=""; SHIPPED_ON_DATE$=""
5530 SHIPPED_ON_TIME$=""; EST_ARRIVAL$=""; CARRIER_ID$=""; CARRIER_NAME$=""
5540 TRACKING_NUM$=""; PICKUP_NUM$=""; ZIP_CODE$=""; TF_ZONE$="" ! SSP 186935
5550 UPDATE_ORDER$=""; RECVD$=""; DONT_BILL$=""; INVOICED$=""
5560 AR_INV_NUM$=""; PACKER_ID$=""; LOT_ID$=""; BOX_NUMBER$=""
5570 TOTAL_BOXES$=""; RECVG_REPORT_NUM$=""; STARTING_NUM$=""
5610 QTY=0; ACTUAL_WEIGHT=0; SHIPPING_WT=0; TOTAL_COST=0
5685 REFRESH_FLG=1; NEXT_ID=PORDER.CTL,CUSTOMER1$="",ITEM_CODE$="",ITEM_DESC$="" ! SSP 186935
5690 RETURN 
8000 ! Messages
8010 TERM_MSG:
8020 MSGBOX MSG("ADD_RECORD"),MSG("CONFIRM"),"?,YesNo",ANS$
8030 IF ANS$="NO" THEN BOX_NUMBER$=""; NEXT_ID=BOX_NUMBER.CTL; RETURN 
8040 DIM SM4$(700),SM4[15]; NEXT_ID=QTY.CTL ! WO244750, expand SM4
8050 CALL "*wingrp;Enable",FIELDS.GRP$; CALL "*wingrp;Enable",BUTTONS.GRP$
8090 RETURN 
8100 ! No First Record
8110 NO_FIRST:
8120 MSGBOX MSG("REC_NO_1ST"),"FYI","!"
8130 RETURN 
8200 ! No Last Record
8210 NO_LAST:
8220 MSGBOX MSG("REC_NO_LST$"),"FYI","!"
8230 RETURN 
8300 ! Start of File
8310 START_FILE:
8320 MSGBOX MSG("START_FILE"),"FYI","!"
8330 RETURN 
8400 ! End of File
8410 END_FILE:
8420 MSGBOX MSG("END_OF_FIL"),"FYI","!"
8430 RETURN 
8500 ! Invalid Day Message
8510 INVALID_MSG:
8520 MSGBOX MSG("INVALID_D"),"FYI","!"
8590 RETURN 
8800 ! Invalid Item Code Message
8810 INVALID_ITM:
8820 MSGBOX MSG("INVA_ITEM"),MSG("WARNING"),"STOP"
8830 ITEM_CODE$=""; NEXT_ID=ITEM_CODE.CTL
8890 RETURN 
9000 ! Parameters
9010 GET_SYS_PARAM:
9020 DIM ECPARM$(1000); READ (Z[6],KEY=X3$(9,3)+"E/C",DOM=*NEXT)ECPARM$
9030 READ (Z[6],KEY=X3$(9,3)+"A/R",DOM=*NEXT)ARPARM$
9090 RETURN 
9900 ! Ship Query Info....
9910 SHIP_QRY:
9920 ENTER TYPE$
9930 IF STP(TYPE$)<>"S" THEN EXIT 123
9940 EXIT 
9999 END 
10100 QUERY:
10110 PROCESS "QRY_SM4","../ECG/EC.EN",VAL$; IF STP(VAL$)="" THEN RETURN 
10120 BUYER_ID$=VAL$(1,10); ITEM_CODE$=VAL$(11,10)
10150 GOSUB FIND_REC
10160 NEXT_ID=DEF_CATEGORY.CTL
10180 REFRESH_FLG=1
10190 RETURN 
11000 ! Item Query
11010 ITEM_QUERY:
11020 VAL$=""
11030 IF NUL(BUYER_ID$) THEN %ITEM_CUST$="          "; PROCESS "QRY_IC0.1.4","../ICG/IC.EN",VAL$; IF NUL(VAL$) THEN RETURN ELSE QRY_VAL$=VAL$
11040 IF NOT(NUL(BUYER_ID$)) THEN %BUYER_ID$=BUYER_ID$; PROCESS "QRY_FM1_ITEM","../FMG/FM.EN",VAL$; IF NUL(VAL$) THEN RETURN ELSE QRY_VAL$=VAL$
11070 REFRESH_FLG=1
11080 RETURN 
12000 DELETE_ALT_FILE:! SSP 186935
12010 REMOVE (Z[7],KEY=A2$,DOM=*NEXT)
12020 REMOVE (Z[8],KEY=A3$,DOM=*NEXT)
12030 RETURN 
12100 WRITE_ALT_FILE:
12110 REMOVE (Z[7],KEY=A2$,DOM=*NEXT)
12120 WRITE (Z[7],KEY=SM4$(15,6)+SM4$(1,13)+SM4$(124,3))
12130 REMOVE (Z[8],KEY=A3$,DOM=*NEXT)
12140 WRITE (Z[8],KEY=MID(FS1$,6,10)+SM4$(15,6)+SM4$(1,13)+SM4$(124,3))
12150 RETURN 
13000 CHECK_CARRIER:! SSP 218151
13001 IF _EOM$=$00$ THEN RETURN 
13005 REFRESH_FLG=1
13010 IF MID(ECPARM$,555,1)<>"Y" OR STP(CARRIER_ID$)<>"!" THEN RETURN 
13015 IF ID$="CARRIER_NAME" THEN VAL$=CARRIER_NAME$
13017 IF STP(VAL$)="" THEN NEXT_ID=CARRIER_NAME.CTL; EXIT 
13020 CALL "ZZWLKU;EC_3RD_PARTY_FMT",VAL$,VAR_TAG$
13030 CALL "ZZWLKU;EC_3RD_PARTY_VAL",VAL$,ERR_MSG$,VAR_TAG$
13040 IF ERR_MSG$<>"" THEN MSGBOX ERR_MSG$,MSG("WARNING"),"TIM=5"; CARRIER_NAME$="",REFRESH_FLG=1,NEXT_ID=CARRIER_NAME.CTL; EXIT 
13050 CARRIER_NAME$=VAL$,NEXT_ID=TRACKING_NUM.CTL,SM4$(37,12)=VAL$
13060 RETURN 
15000 SEL_QRY_1: VAL$="" ! SSP#261361
15010 PROCESS "QRY_SM4.1","../SMG/SM.EN",VAL$ ! SSP#261361
15020 IF VAL$="" THEN RETURN 
15030 _KEY$=VAL$,PORDER$=VAL$(1,9),PO_LINE_NUM$=VAL$(10,3),LOC_CODE$=VAL$(13,1),BOX_NUMBER$=VAL$(14,3) ! SSP#261361
15040 GOSUB FIND_REC ! SSP#261361
15050 NEXT_ID=QTY.CTL ! SSP#261361!SSP#261361
15060 RETURN 
15929 ! SSP#261361
56000 REM "198515-Does the tracking gateway feature work in GUI?              
56001 ! "186935-Tracking information does not mask the order number         
56002 ! "218151-Is there a way to have the tracking numbers show up for the 
56004 REM "244750-Inbound Freight processing in the Customer Invoicing Gateway
56005 REM "257952-Need larger tracking number field to replace 20 character   
56006 REM "261361-ECGMTA - can we add a right query to this panel, similar to 
