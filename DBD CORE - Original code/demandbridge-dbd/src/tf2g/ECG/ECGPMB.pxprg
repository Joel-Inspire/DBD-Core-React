0020 SETESC 9300; SETERR 9000
0030 REM "5.1 - 11/14/2002 - jir
0035 REM "5.5 - 08/31/07 - 9.680277 - jdf - SSP# 211380
0037 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 REM "        Licensed Software - All Rights Reserved.
0060 PROCESS "ECGPMB","../ECG/EC.EN"
0070 CLOSE (*)
0080 RUN "ZMENU"
0100 INIT:
0110 ECM=HFN; OPEN (ECM,ERR=*NEXT)"ECM"+%C$; GOTO 0130
0120 MSGBOX "File ECM"+%C$+" No Exit, Please Create","!Error","!"; CMD_STR$="END"; GOTO INIT_END
0130 READ (ECM,END=INIT_END)A$,B$
0140 OP=OP+1; EXECUTE "SEL"+STR(OP)+"$=A$,DESC"+STR(OP)+"$=B$"
0150 GOTO 0130
0200 INIT_END:
0210 CALL "ZZCOMP","","",X2$,X3$,X4$,M9$,X0,X1,0
0220 RETURN 
1000 SELECT_FILE:
1005 MESS$="Open File"; GOSUB PRT_MESS
1010 SEL=HFN; OPEN (SEL,ERR=*NEXT)ML_TEMP_FILE$
1200 MAIN_READ:
1201 MESS$="Reading File"; GOSUB PRT_MESS
1205 LINE=0
1210 READ (SEL,END=END_READ_FILE)XML$
1220 FOR A=1 TO OP
1230 EXECUTE "XXX=POS(SEL"+STR(A)+"$=XML$)"
1240 IF XXX=0 THEN CONTINUE
1250 LINE=LINE+1,TF_DESC$=EVS("DESC"+STR(A)+"$")+":"
1260 XX=29-LEN(TF_DESC$),LL=3+LINE; PRINT @(XX,LL),TF_DESC$; LINE=LINE+1
1270 ! INPUT (0,ERR=1270)@(6+LEN(TF_DESC$),5+LINE),VAL$
1280 EXECUTE "MULTI_LINE SHOW ML_VAL"+STR(A)+".CTL"
1300 REFRESH_FLG=1
3000 NEXT A
3005 GOTO 1210
3010 END_READ_FILE:
3020 CALL "*WINGRP;ENABLE",BUTTON.GRP$
3030 REFRESH_FLG=1
3040 MESS$="Generate Information"; GOSUB PRT_MESS
3050 RETURN 
5000 CREATE_FILE:
5010 FILE_NAME$="tmp"+FID(0)
5020 ERASE FILE_NAME$,ERR=*NEXT
5030 SERIAL FILE_NAME$
5040 TMP=HFN; OPEN LOCK (TMP)FILE_NAME$
5050 CLOSE (SEL); OPEN (SEL)ML_TEMP_FILE$
6000 READ_FILES_AND_CREATE:
6001 MESS$="Generate Files..."; GOSUB PRT_MESS
6010 READ (SEL,END=8020)XML$
6020 FOR A=1 TO OP
6030 EXECUTE "XXX=POS(SEL"+STR(A)+"$=XML$),LENG=LEN(SEL"+STR(A)+"$)"
6040 IF XXX=0 THEN CONTINUE
6050 BB$=XML$(1,XXX-1)+EVS("ML_VAL"+STR(A)+"$")+XML$(LENG+1)
6060 XML$=BB$
6070 NEXT A
7000 WRITE_FILES:
7010 PRINT (TMP)XML$
7015 CONTENT$=CONTENT$+XML$
8010 GOTO 6010
8020 MESS$="Ending Generate"; GOSUB PRT_MESS
8030 MSGBOX "Do you want To Send a file ","?Ask","YesNo",SEL$; IF SEL$="NO" THEN GOTO END_PROGRAM
8040 CALL "EC3SND",X3$,X4$,ML_URL$,CONTENT$,ML_PROXY$,OPTION$,RETURN$
8050 IF RETURN$="" THEN GOTO END_PROGRAM
8060 PROCESS "ECGPMB.1","../ECG/EC.EN",RETURN$
9000 END_PROGRAM:
9998 CMD_STR$="END"
9999 END 
10000 CLEAR_DISPLAY:
10010 CALL "*WINGRP;HIDE",INPUT.GRP$
10020 CALL "*WINGRP;DISABLE",BUTTON.GRP$
10030 FOR XX=1 TO 15
10040 PRINT @(1,3+XX),'CL',
10050 NEXT XX
10055 PRINT @(45,1),'CL',
10060 RETURN 
11000 GET_FILES:
11010 DIM BB$[2]
11020 BB$[1]="*.xml"
11030 CALL "**wdxopn.fle",ML_TEMP_FILE$,FP$,FT$,BB${ALL},MODE$
11040 REFRESH_FLG=1,NEXT_ID=ML_TEMP_FILE.CTL
11050 RETURN 
12000 PRT_MESS:
12010 PRINT @(45,1),'CL','BLUE',@(65-LEN(MESS$),1),MESS$,'BLACK'
12020 WAIT 1
12030 RETURN 
56000 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
