0010 ! ARGCUST- Lookup Customer Options
0035 REM "5.7 - 07/02/18 - 13.709722 - jvv - SSP# 300901
0037 REM "300901-GUI: Invoice Loading Time. In Cash Receipts Invoice Number  
0040 REM "Copyright 2018 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0070 PROCESS "ARGCUST","../ARG/AR.EN"
0080 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 _SV_KR=PRM('KR'); SET_PARAM 'KR'=0 ! Ensure native handling of KEP()
0125 CALL "ZZWMX3"
0130 GOSUB SETUP_LIBRARY; IF %FLMAINT_MSG$<>"" THEN MESSAGE_LIB %FLMAINT_MSG$
0140 ARG_1$=""
0160 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,-1,X1,X2; DIM Z[NUM(X3$(60,3))]
0165 Z$="01O FS6... 02O AR1... 03O ASG... 04O AXM... 05O ASH... 06O ARW... 13O ZZPARM " ! SSP 192330
0170 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
0180 GOSUB SETUP_OPTS
0195 RETURN 
0199 ! 
0300 ! 300 - Set up the message library
0310 SETUP_LIBRARY:
0320 _SV_MSGLIB$=MSG(*)
0330 _LANG$=LCS(%NOMAD_DEF_SFX$); IF _LANG$="" THEN _LANG$=LCS(ENV("PVXLANG")); IF _LANG$="" THEN _LANG$=LCS(ENV("LANG")); IF _LANG$="" THEN _LANG$="en"
0340 MESSAGE_LIB "*msglib."+_LANG$,ERR=*NEXT; GOTO 0360
0350 MESSAGE_LIB "*msglib.en"
0370 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0520 MESSAGE_LIB _SV_MSGLIB$
0570 RETURN 
0700 CLEAR_FIELDS:
0710 INVOICE$="",SUMM_BILL$=""
0720 ORDER$="",ZIP_CODE$="",PHONE$=""
0750 REFRESH_FLG=1
0790 RETURN 
0799 ! 
0800 SETUP_OPTS:
0810 MSGO$=MSG("ARGOR0_02")
0820 MSGI$="Invoice Number "+MSG("NOT_FOUND")
0825 MSGP$="Phone Number "+MSG("NOT_FOUND")
0830 MSGZ$="Zip Code "+MSG("NOT_FOUND")
0835 MSGS$="Summary Bill "+MSG("NOT_FOUND")
0840 %START_FLD$="",%END_FLD$=""
0890 RETURN 899 ! 
0900 ! 900 - Wrapup
0910 WRAPUP:
0915 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0950 MESSAGE_LIB _SV_MSGLIB$
0960 SET_PARAM 'KR'=_SV_KR
0970 RETURN 
0999 ! 
1000 GET_CUSTOMER:! given the ORDER$, get the customer#
1001 IF QRY_VAL$<>"" THEN READ (Z(1),KNO=6,KEY=QRY_VAL$,DOM=*NEXT)K$; GOTO 1012 ! SSP 192330
1003 ! F QRY_VAL$<>"" THEN READ (Z(1),KNO=6,KEY=QRY_VAL$,DOM=*NEXT)K$; GOTO 1012 ! SSP 192330
1005 IF NUL(ORDER$) THEN CMD_STR$="END"; GOTO DONE
1010 READ (Z[1],KNO=6,KEY=ORDER$,DOM=*NEXT)K$ ! SSP 192330
1011 READ (Z(1),END=ORDER_NOT_ON_FILE)K$ ! SSP 192330
1012 IF ORDER$<>K$(22,8) THEN GOTO ORDER_NOT_ON_FILE ! SSP 192330
1015 IF X3$(333,2)<>"  " THEN IF X3$(333,2)<>K$(22,2) THEN GOTO DIV_NOT_ALLOWED ! SSP 223715
1020 CUST$=K$(1,10) ! FIND (Z[2],KEY=K$(1,10),DOM=CUSTOMER_NOT_ON_FILE) ! SSP 192330
1025 GOTO RETURN_CUSTOMER
1080 ! CMD_STR$="END"
1095 RETURN 
1099 ! 
1100 QRY_ORDER:
1105 QRY_VAL$=ORDER$
1110 PROCESS "QRY_FS6.O","../ARG/AR.EN",QRY_VAL$; ORDER$=""; GOTO GET_CUSTOMER
1120 RETURN 
1129 ! 
1400 DONE:
1410 GOSUB CLEAR_FIELDS
1415 QRY_VAL$=""
1420 REFRESH_FLG=1
1495 RETURN 
1499 ! ***********************************************
1500 ORDER_NOT_ON_FILE: MSGBOX MSG("ARGOR0_02"),MSG("MB_ATTN"),"!"; GOTO DONE
1520 DISP_MSG: MSGBOX MSGD$,MSG("MB_ATTN"),"!"; GOSUB CLEAR_FIELDS; RETURN 
1530 CUSTOMER_NOT_ON_FILE: MSGBOX MSG("ARGOR0_03"),MSG("MB_ATTN"),"!"; GOTO DONE
1540 DIV_NOT_ALLOWED: MSGBOX MSG("ARGOR0_04"),MSG("MB_ATTN"),"!"; GOTO DONE
1599 ! 
2000 GET_INV_CUSTOMER:! given the Invoice$, get the customer#
2005 %START_FLD$="",%END_FLD$=""
2010 IF QRY_VAL$<>"" THEN K$=QRY_VAL$; CUST$=K$(9,10); GOTO RETURN_CUSTOMER ! ESCAPE ; FIND (Z(3),KEY=K$,DOM=*NEXT); GOTO 2065 ! SSP 192330
2015 ICNT=0
2020 IF NUL(INVOICE$) THEN GOTO DONE
2025 IF _EOM$=$00$ AND STP(INVOICE$,2)<>"" THEN START_FLD$=STP(INVOICE$,2); GOTO INV_QRY
2028 INVOICE$=PAD(INVOICE$,8)
2030 READ (Z[3],KEY=INVOICE$,DOM=*NEXT) ! SSP 192330
2035 K$=KEY(Z[3],END=2060); READ (Z[3])
2050 IF INVOICE$<>K$(1,8) THEN GOTO CHECK_FOR_INVOICE ! SSP 192330
2052 ICNT=ICNT+1; CUST$=K$(9,10); GOTO 2035
2055 ! IF X3$(333,2)<>"  " THEN IF X3$(333,2)<>K$(22,2) THEN GOTO DIV_NOT_ALLOWED ! SSP 223715
2058 CHECK_FOR_INVOICE:
2060 IF ICNT=0 THEN MSGD$=MSGI$; GOSUB DISP_MSG; NEXT_ID=INVOICE.CTL; RETURN 
2062 IF ICNT>1 THEN START_FLD$=INVOICE$; GOTO INV_QRY ! %START_FLD$=INVOICE$,%END_FLD$=%START_FLD$; PROCESS "QRY_ASG","../ARG/AR.EN",QRY_VAL$; INVOICE$=""; GOTO GET_INV_CUSTOMER
2070 GOTO RETURN_CUSTOMER
2095 RETURN 
2099 ! 
2100 QRY_INVOICE:
2105 QRY_VAL$=""
2110 PROCESS "QRY_ASG","../ARG/AR.EN",QRY_VAL$; INVOICE$=""; GOTO GET_INV_CUSTOMER
2120 RETURN 
2129 ! 
2150 INV_QRY:
2152 %START_FLD$=START_FLD$,%END_FLD$=%START_FLD$
2160 GOTO QRY_INVOICE
2170 ! 
3000 GET_SB_CUSTOMER:! given the Summary Bill$, get the customer#
3005 %START_FLD$="",%END_FLD$=""
3010 IF QRY_VAL$<>"" THEN K$=QRY_VAL$; CUST$=K$(9,10); GOTO RETURN_CUSTOMER
3015 ICNT=0
3020 IF NUL(SUMM_BILL$) THEN GOTO DONE
3025 IF _EOM$=$00$ AND STP(SUMM_BILL$,2)<>"" THEN START_FLD$=STP(SUMM_BILL$,2); GOTO SB_QRY
3028 SUMM_BILL$=PAD(SUMM_BILL$,8,1)
3030 READ (Z[4],KEY=SUMM_BILL$,DOM=*NEXT) ! SSP 192330
3035 K$=KEY(Z[4],END=3060); READ (Z[4],KEY=K$)
3050 IF SUMM_BILL$<>K$(1,8) THEN GOTO CHECK_FOR_SB ! SSP 192330
3052 ICNT=ICNT+1; CUST$=K$(9,10); GOTO 3035
3055 ! IF X3$(333,2)<>"  " THEN IF X3$(333,2)<>K$(22,2) THEN GOTO DIV_NOT_ALLOWED ! SSP 223715
3058 CHECK_FOR_SB:
3060 IF ICNT=0 THEN MSGD$=MSGS$; GOSUB DISP_MSG; NEXT_ID=SUMM_BILL.CTL; RETURN 
3062 IF ICNT>1 THEN START_FLD$=SUMM_BILL$; GOTO SB_QRY
3070 GOTO RETURN_CUSTOMER
3095 RETURN 
3099 ! 
3100 QRY_SB:
3105 QRY_VAL$=""
3110 PROCESS "QRY_AXM","../ARG/AR.EN",QRY_VAL$; SUMM_BILL$=""; GOTO GET_SB_CUSTOMER
3120 RETURN 
3129 ! 
3150 SB_QRY:
3152 %START_FLD$=START_FLD$,%END_FLD$=%START_FLD$
3160 GOTO QRY_SB
3170 ! 
3200 GET_ZIP_CUSTOMER:! given the Invoice$, get the customer#
3205 %START_FLD$="",%END_FLD$=""
3210 IF QRY_VAL$<>"" THEN K$=QRY_VAL$; CUST$=K$(10,10); GOTO RETURN_CUSTOMER
3215 ICNT=0
3220 IF NUL(ZIP_CODE$) THEN GOTO DONE
3225 IF _EOM$=$00$ AND STP(ZIP_CODE$,2)<>"" THEN START_FLD$=STP(ZIP_CODE$,2); GOTO ZIP_QRY
3228 ZIP_CODE$=PAD(ZIP_CODE$,9,1)
3230 READ (Z[5],KEY=ZIP_CODE$,DOM=*NEXT)K$ ! SSP 192330
3235 K$=KEY(Z[5],END=3260); READ (Z[5])
3250 IF ZIP_CODE$<>K$(1,9) THEN GOTO CHECK_FOR_ZIP ! SSP 192330
3252 ICNT=ICNT+1; CUST$=K$(10,10); GOTO 3235
3255 ! IF X3$(333,2)<>"  " THEN IF X3$(333,2)<>K$(22,2) THEN GOTO DIV_NOT_ALLOWED ! SSP 223715
3258 CHECK_FOR_ZIP:
3260 IF ICNT=0 THEN MSGD$=MSGZ$; GOSUB DISP_MSG; NEXT_ID=ZIP_CODE.CTL; RETURN 
3262 IF ICNT>1 THEN START_FLD$=ZIP_CODE$; GOTO ZIP_QRY
3270 GOTO RETURN_CUSTOMER
3295 RETURN 
3299 ! 
3300 QRY_ZIP:
3305 QRY_VAL$=""
3310 PROCESS "QRY_ASH","../ARG/AR.EN",QRY_VAL$; ZIP_CODE$=""; GOTO GET_ZIP_CUSTOMER
3320 RETURN 
3329 ! 
3350 ZIP_QRY:
3352 %START_FLD$=START_FLD$,%END_FLD$=%START_FLD$
3360 GOTO QRY_ZIP
3370 ! 
3700 GET_TEL_CUSTOMER:! given the pHONE nUMBER$, get the customer#
3705 %START_FLD$="",%END_FLD$=""
3710 IF QRY_VAL$<>"" THEN K$=QRY_VAL$; CUST$=K$(11,10); GOTO RETURN_CUSTOMER ! SSP 192330
3715 ICNT=0
3720 IF NUL(PHONE$) THEN GOTO DONE
3725 IF _EOM$=$00$ AND STP(PHONE$,2)<>"" THEN START_FLD$=STP(PHONE$,2); GOTO TEL_QRY
3728 PHONE$=PAD(PHONE$,10,1)
3730 READ (Z[6],KEY=PHONE$,DOM=*NEXT) ! SSP 192370
3735 K$=KEY(Z[6],END=3760); READ (Z[6])
3750 IF PHONE$<>K$(1,10) THEN GOTO CHECK_FOR_TEL ! SSP 192330
3752 ICNT=ICNT+1; CUST$=K$(11,10); GOTO 3735
3755 ! IF X3$(333,2)<>"  " THEN IF X3$(333,2)<>K$(22,2) THEN GOTO DIV_NOT_ALLOWED ! SSP 223715
3758 CHECK_FOR_TEL:
3760 IF ICNT=0 THEN MSGD$=MSGP$; GOSUB DISP_MSG; NEXT_ID=PHONE.CTL; RETURN 
3762 IF ICNT>1 THEN START_FLD$=PHONE$; GOTO TEL_QRY ! %START_FLD$; PROCESS "QRY_ARW","../ARG/AR.EN",QRY_VAL$; PHONE$=""; GOTO GET_TEL_CUSTOMER
3763 ! F ICNT>1 THEN %START_FLD$=PHONE$,%END_FLD$=%START_FLD$; PROCESS "QRY_ARW","../ARG/AR.EN",QRY_VAL$; PHONE$=""; GOTO GET_TEL_CUSTOMER
3770 GOTO RETURN_CUSTOMER
3795 RETURN 
3799 ! 
3800 QRY_PHONE:
3805 QRY_VAL$=""
3810 PROCESS "QRY_ARW","../ARG/AR.EN",QRY_VAL$; PHONE$=""; GOTO GET_TEL_CUSTOMER
3820 RETURN 
3830 TEL_QRY:
3838 %START_FLD$=START_FLD$,%END_FLD$=%START_FLD$
3840 GOTO QRY_PHONE
3899 ! 
5000 RETURN_CUSTOMER:
5005 FIND (Z[2],KEY=CUST$,DOM=CUSTOMER_NOT_ON_FILE) ! SSP 192330
5010 ARG_1$=CUST$
5020 CMD_STR$="END"
5050 RETURN 
5099 ! 
9999 END 
56000 ! "192330-Look up by order number in customer setup and inquiry       
56010 REM "300901-GUI: Invoice Loading Time. In Cash Receipts Invoice Number  
