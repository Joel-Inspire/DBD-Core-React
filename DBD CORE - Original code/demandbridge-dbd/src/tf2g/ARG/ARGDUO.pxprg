0010 REM "A/R Invoice Update Overlay <AR2DUO>
0020 SETESC 9300; SETERR 9000
0035 REM "5.5 - 09/10/07 - 15.656944 - jdf - SSP# 211380
0037 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 SETERR 9000
0295 DIM Z0$(80,X3$(235,1)); Z0$=MNM('GS')+Z0$+MNM('GE')
0310 IOLIST A$,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20]
0500 REM "FILES
0505 Z=NUM(X3$(60,3)); DIM Z[Z]
0515 IF FLG$="1" THEN V$="FC",V1$="ARR...",V2$="ARS..." ELSE V$="SJ",V1$="ARB...",V2$="ARD..."
0516 IF X3$(188,3)="CM2" THEN V$="RL",V1$="CM3...",V2$="ARD..."
0518 Z$="01L "+V1$+"  03O ARC...  04O AR1...  05O AR6...  06O ARI...  07X AR7...  08O ARY...  09O ARK...  10O ARL...  11O ARM...  12O ARN...  13O ZZPARM  14O FS1... 15O ASU...  "
0519 Z$=Z$+"25O AR2...  "; REM "LET Z$=Z$+"14O "+FID(0)+"      "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 0521,9900
0550 READ (Z[13],KEY=X3$(9,3)+"G/L")G0$
0555 IF POS(X3$(9,3)="144244",3)>0 THEN READ (Z[13],KEY="PFGG/L")F0$
0580 Q9$="C"; IF G0$(40,1)="A" THEN Q9$="A" ELSE IF G0$(180,1)="Y" THEN Q9$=Q9$+"A"
0585 W9$=""; CALL "RT2PRM",ERR=0586,X3$,X4$,W9$
0600 REM "Read parameters
0610 DIM P[8],P0$(90),P1$(32)
0620 FIND (Z[13],KEY=X3$(9,3)+"A/R",DOM=9800)P0$,P[0],P[1],P[2],P[3],P[4],P[5],P[6],P[7],P[8]
0630 FIND (Z[13],KEY=X3$(9,3)+"AR1",DOM=9800)P1$
0635 GB$=""; FIND (Z[13],KEY=X3$(9,3)+"G/B",DOM=0636)GB$
0660 REM "Get date"
0680 D0$=X3$(15,6)
0730 DIM A$(162),A[20]
0740 DIM B$(37),B[4]
0750 DIM C$(159),C[24]
0800 REM "CHECK FOR ROOM?
0805 PRINT @(12,22),"Determining file information...",
0810 DIM X[Z,1],X$(0)
0815 FOR X=1 TO Z
0820 CALL "ZZINFO",X,0,X3$,A,B,0,0,0,0,0,""; X[X-1,0]=A,X[X-1,1]=B
0825 NEXT X
0830 PRINT @(0,22),'CL',
0835 IF X[Z[1]-1,0]=0 THEN CALL "ZZPROM","4",X3$,S3,"There is no data to update. Press <Return>:","","",0; GOTO 9900
0840 GOTO 0900
0880 REM "PROMPT OUT OF ROOM
0885 X$="There is not enough room to update this data. Press <Return>: "
0890 CALL "ZZPROM","4",X3$,S3,X$,"","",0; GOTO 9900
0900 REM "RESTART LOGIC
0905 V0$=X3$(1,6)+X3$(40,3)+DAY+STR(TIM*100:"0000")+X3$(178,6); WRITE (Z[1],KEY="",DOM=0906)V0$
0910 EXTRACT (Z[1],KEY="")V0$,K0$,K1$,K0,K1; I1=IND(Z[1])
0915 GOSUB 6000
0919 READ (Z[1],KEY="",DOM=0960); GOTO 0960
0920 IF K0$="" THEN READ (Z[1],KEY=K0$); GOTO 0960
0930 EXTRACT (Z[1],KEY=K0$,DOM=0931)IOL=0310
0935 PRINT @(12,12),"Restarting update with record: ",A$(1,4)+"-"+A$(5,2)+"-"+A$(7,8)
0940 PRINT @(12,14),"WARNING: You should contact software support services",@(22,15),"to ensure that no data is lost."
0970 CALL "ZZPROM","9",X3$,S3,"","","",0; ON S3 GOTO 0971,9900
0975 PRINT @(0,12),'CL',
0978 CALL "AR2XBA",X3$,X4$,Z[1],0,Z; IF Z=1 THEN GOTO 9900
0980 CALL "ZZDAPP",X3$,"DALL"; CALL "ZZDAPP",X3$,"!AGL2XUAAR2XAA"
0990 IF V1$(1,3)="ARB" AND P0$(97,1)="Y" THEN CALL "AR2EBF",X3$,X4$
0992 READ (Z[13],KEY=X3$(9,3)+"EXPORTAR",DOM=0993)EXPORT_PARAM$; IF EXPORT_PARAM$(21,1)="Y" AND V1$(1,3)="ARB" THEN CALL "AR2XBF",X3$,X4$,"",""; REM "WO91521, Consolidated orders
0995 IF V1$(1,3)="ARB" AND (P1$(63,1)="Y" OR POS(X3$(9,3)="030",3)>0) THEN CALL "AR2XBC",X3$,X4$,"",""
0996 CALL "ZZ2PRP","EM",RESULT$,TF_DATE$; IF RESULT$="Y" AND V1$(1,3)="ARB" THEN CALL "ED2RED",ERR=0997,X3$,X4$ ELSE GOTO 0997; REM "Read from ARB to build ASCII file from invoices - and check for EDI 810 document added SSP# 119947
0997 IF V1$(1,3)="ARB" AND POS(X3$(9,3)="049500",3)>0 THEN CALL "AR2XBD",X3$,X4$,"",""
0998 IF V1$(1,3)="ARB" AND P0$(108,1)="Y" THEN CALL "AR2XBE",X3$,X4$,"",""
1000 REM "Return to program AR2DUA
1008 IF POS(X3$(9,3)="128")<>0 THEN INVOKE "/usr/lib/pvx/facts_sor.conv"
1010 L0=1
1020 READ (Z[1],KEY="",DOM=1021)
1090 RUN "ARGDUA" ! exit
6000 REM "BACKGROUND
6005 PRINT (0,ERR=6016)'SB',
6020 PRINT @(12,4),"This program will update information from the",@(12,5),"A/R Invoice Data Entry Header"
6025 PRINT @(12,7),"These entries were printed on audit report #",V0$(22,4),".",V0$(26,2),
6165 PRINT (0,ERR=6066)'SF',
6190 RETURN 
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,1
9050 ON Y7 GOTO 9060,9100,9190,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOSUB 6600; GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "END PROGRAM
9905 CALL "ZZDAPP",X3$,"!DGL2XUA"
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9915 IF POS(X3$(9,3)="128")<>0 THEN CLOSE (Z[6])
9918 REM "IF POS(X3$(9,3)="128")<>0 THEN SYSTEM "RM /USR4/TF/TF2D/SOR 1>/DEV/NULL 2>/DEV/NULL"
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 ! IF Y4$>"" THEN RUN Y4$
9950 EXIT 
9999 END 
56000 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
