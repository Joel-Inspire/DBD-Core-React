0010 ! ARGMEB - File Maintenance Program for AR5_SlsTax  Veratax (="AR5"+%C$)
0020 ! Generated by ProvideX® NOMADS II File Maintenance on Jun. 5, 2002 14:50
0030 ! ************************************************************************
0035 REM "5.7 - 06/17/16 - 12.085277 - jvv - SSP# 284976
0037 REM "284976-Sales Tax Interface: Modifications to freight salestax logic
0040 REM "Copyright 2016 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 PROCESS "ARGMEB","../ARG/AR.EN"
0060 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0120 ! 
0125 ! %SALES_TAX_MASK$="XX-XXXXX-XXX";REM SSP 220726
0130 X0$="AR2MEB",X1$="Veratax Sales Tax Code Setup"
0140 ! 
0150 X2=-1,X0=-1
0160 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,X2; IF X1>0 THEN GOTO WRAPUP
0170 ! 
0190 DIM Z[NUM(X3$(60,3))],AR5[15],GL1[3],AR5_2[15],AR5$(400),B_AR5[15],B_AR5$(400) ! WO 249775
0200 ! Files
0210 Z$="01X AR5...  02O GL1...  050 FMP...  06O ZZPARM  " ! WO249775
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
0300 ! Iolist
0310 IOLIST AR5$,AR5{ALL}
0320 IOLIST GL1$,GL1{ALL}
0330 IOLIST AR5_2$,AR5_2{ALL}
0400 ! 
0410 GOSUB GET_SYS_PARAM
0490 RETURN 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0511 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
0530 IF PARAM1$(119,1)="Y" THEN CALL "*WINGRP;ENABLE",GL_CODES.GRP$
0570 RETURN 
0900 ! 900 - Wrapup
0910 WRAPUP:
0930 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
0970 RETURN 
1000 ! Find Record
1010 FIND_REC:
1015 IF STAX_CODE$="" THEN RETURN 
1016 NEW_RECORD=0,SETUP_DONE=0
1017 TR_TOTAL=0
1020 CODE_LEN=LEN(STP(STAX_CODE$))
1065  }
1070 ! 
1110 REM "GOSUB LOAD_TAX_LIST
1140 ! 
1160 GOSUB GET_STATE_TAX
1190 SETUP_DONE=1; GOSUB LOAD_TAX_LIST
1260 LIST_BOX LOAD TAX_LIST.CTL,0,""+SEP+""+SEP+"------------"+SEP+""
1270 LIST_BOX LOAD TAX_LIST.CTL,0,""+SEP+""+SEP+STR(TR_TOTAL:"###.00")+SEP+""
1280 REFRESH_FLG=1; CALL "*wingrp;Enable",BUTTON_1.GRP$
1285 CALL "*wingrp;Enable",FIELDS.GRP$
1287 NEXT_ID=STAX_DESC.CTL
1290 RETURN 
1500 ! Get State Tax
1505 GET_STATE_TAX:
1510 KEY_1$=STAX_CODE$; KEY_1$=PAD(KEY_1$,10,1," ")
1520 PRECISION 3; READ (Z[1],KEY=KEY_1$,DOM=STATE_MSG)IOL=0310 ! PRECISION 2
1530 STAX_DESC$=AR5$(11,25); TF_STATE$=AR5$(154,1),TF_COUNTY$=AR5$(155,1),TF_CITY$=AR5$(156,1)
1531 TAX_FRT$=AR5$(36,1) ! 257245
1532 STAX_P_A$=AR5$(55,12); ACCR_S_A$=AR5$(67,12)
1534 STAX_RATE=AR5[0]; MAX_STAX=AR5[1]
1535 COUNTY_TAX_IF_OTHER=AR5[2],STATE_TAX_IF_OTHER=AR5[3],ST_STAX_RATE=AR5[4],CNTY_STAX_RATE=AR5[5],MAX_OTHER=AR5[6],TAX_RATE_TOTAL=AR5[0]+AR5[2]+AR5[3]
1542 VERTEX_UPDT_DATE$=AR5$(37,6),VERTEX_UPDT_NUM$=AR5$(43,6),VERTEX_EFF_DATE$=AR5$(49,6)
1543 CITY_STS$=AR5$(79,25),ZIP_STS$=AR5$(109,10),STATE_STS$=AR5$(119,2),COUNTY_STS$=AR5$(121,25),COUNTY_CODE_STS$=AR5$(151,3)
1544 TF_STATE$=AR5$(154,1),TF_COUNTY$=AR5$(155,1),TF_CITY$=AR5$(156,1),STATE_DESC$=AR5$(157,25),NO_OVRDE_T_C$=AR5$(182,1),TOTAL_TAX$=AR5$(183,7)
1546 LOCATION$=AR5$(146,4); REM SSP 210276
1550 PROD_CODE_SET_STATE$=MID(AR5$,191,3),PROD_CODE_SET_COUNTY$=MID(AR5$,194,3),PROD_CODE_SET_CITY$=MID(AR5$,198,3) ! WO 249775
1552 IGNORE_PCS_COUNTY$=MID(AR5$,197,1),IGNORE_PCS_CITY$=MID(AR5$,201,1) ! WO 249775
1555 FREIGHT_ITEMS_NOT_TAXABLE$=MID(AR5$,202,1) ! WO 249775
1556 FREIGHT_OVER_ITEM_PRICE$=MID(AR5$,203,1) ! WO 284976
1560 B_AR5$=AR5$; B_AR5[0]=AR5[0]; B_AR5[1]=AR5[1]; B_AR5[2]=AR5[2]; B_AR5[3]=AR5[3]; B_AR5[4]=AR5[4]; B_AR5[5]=AR5[5]; B_AR5[6]=AR5[6]; B_AR5[7]=AR5[7]
1580 IDX=0; STATE_TAX=AR5[0]
1582 REM "LIST_BOX FIND TAX_LIST.CTL,1,VV$,ERR=*RETURN; LIST_BOX LOAD TAX_LIST.CTL,1,*; GOTO *SAME
1632 STAX_P_A$=AR5$(55,12); ACCR_S_A$=AR5$(67,12)
1680 COUNTY_TAX=AR5[0]
1732 STAX_P_A$=AR5$(55,12); ACCR_S_A$=AR5$(67,12)
1782 LIST_BOX FIND TAX_LIST.CTL,1,VV$,ERR=*RETURN; LIST_BOX LOAD TAX_LIST.CTL,1,*; GOTO *SAME
1790 RETURN 
2000 ! write record
2010 WRITE_REC:
2020 ! IF NEW_RECORD THEN MSGBOX MSG("ADD_RECORD"),MSG("CONFIRM"),"?,YesNo",ANS$
2030 ! IF ANS$="NO" THEN RETURN 
2040 PRECISION 3; WRITE (Z[1],KEY=KEY_1$)IOL=0310 ! PRECISION 2
2060 B_AR5$=AR5$; B_AR5[0]=AR5[0]; B_AR5[1]=AR5[1]; B_AR5[2]=AR5[2]; B_AR5[3]=AR5[3]; B_AR5[4]=AR5[4]; B_AR5[5]=AR5[5]; B_AR5[6]=AR5[6]; B_AR5[7]=AR5[7]
2080 CALL "*wingrp;Disable",FIELDS.GRP$
2082 GOSUB CLEAR_FIELDS; NEXT_ID=STAX_CODE.CTL
2090 RETURN 
2500 ! load Info
2510 LOAD_INFO:
2515 DIM AR5$(400) ! WO 249775
2516 AR5$(37,6)=VERTEX_UPDT_DATE$,AR5$(43,6)=VERTEX_UPDT_NUM$,AR5$(49,6)=VERTEX_EFF_DATE$
2520 AR5$(1,10)=STAX_CODE$
2530 AR5$(11,25)=STAX_DESC$; AR5$(36,1)=TAX_FRT$
2532 AR5$(79,25)=CITY_STS$,AR5$(109,10)=ZIP_STS$,AR5$(119,2)=STATE_STS$
2534 AR5$(121,25)=COUNTY_STS$,AR5$(151,3)=COUNTY_CODE_STS$,AR5$(154,1)=TF_STATE$
2535 AR5$(155,1)=TF_COUNTY$,AR5$(156,1)=TF_CITY$,AR5$(157,25)=STATE_DESC$
2540 AR5$(55,12)=STAX_P_A$; AR5$(67,12)=ACCR_S_A$
2570 AR5[0]=STAX_RATE; AR5[1]=MAX_STAX
2572 AR5[2]=COUNTY_TAX_IF_OTHER,AR5[3]=STATE_TAX_IF_OTHER,AR5[4]=ST_STAX_RATE,AR5[5]=CNTY_STAX_RATE,AR5[6]=MAX_OTHER,AR5[7]=TAX_RATE_TOTAL
2574 AR5$(154,1)=TF_STATE$,AR5$(155,1)=TF_COUNTY$,AR5$(156,1)=TF_CITY$
2575 IF STP(AR5$,3)<>"" THEN IF POS("Y"=AR5$(154,3))<>0 THEN AR5$(36,1)="Y" ELSE AR5$(36,1)="N" ! SSP#262899
2576 AR5$(182,1)=NO_OVRDE_T_C$
2577 AR5$(183,7)=TOTAL_TAX$ ! 233585
2580 AR5$(191,3)=PROD_CODE_SET_STATE$,AR5$(194,3)=PROD_CODE_SET_COUNTY$,AR5$(198,3)=PROD_CODE_SET_CITY$ ! WO 249775
2582 AR5$(197,1)=IGNORE_PCS_COUNTY$,AR5$(201,1)=IGNORE_PCS_CITY$ ! WO 249775
2584 AR5$(202,1)=FREIGHT_ITEMS_NOT_TAXABLE$ ! WO 249775
2585 IF FREIGHT_ITEMS_NOT_TAXABLE$<>"Y" THEN AR5$(203,1)=" " ELSE AR5$(203,1)=FREIGHT_OVER_ITEM_PRICE$ ! WO 284976
2590 RETURN 
2600 REM " Figure the total sales tax rate
2605 GET_TAX_RATE_TOTAL:
2610 TAX_RATE_TOTAL=STAX_RATE+COUNTY_TAX_IF_OTHER+STATE_TAX_IF_OTHER
2615 TOTAL_TAX$=STR(TAX_RATE_TOTAL:"-##.000") ! 233585
2620 REFRESH_FLG=1
2649 RETURN 
3000 ! delete record
3010 DELETE_REC:
3020 MSGBOX MSG("DELETE_REC"),MSG("VERIFY"),"?,YesNo",ANS$
3030 IF ANS$="NO" THEN RETURN 
3035 GOTO 3090 ! IF CODE_LEN=10 THEN GOTO 3090
3040 DEL_FLG=0
3050 KEY_2$=KEY_1$
3060 ! KEY_2$=KEY(1,END=3090)
3070 ! READ (Z[1],KEY=KEY_2$)
3080 ! IF KEY_1$(1,CODE_LEN)=KEY_2$(1,CODE_LEN) THEN DEL_FLG=1; GOSUB DEL_MSG; RETURN 
3090 REMOVE (Z[1],KEY=KEY_1$,DOM=*NEXT)
3180 NEXT_ID=STAX_CODE.CTL; REFRESH_FLG=1
3182 GOSUB CLEAR_FIELDS; CALL "*WINGRP;DISABLE",FIELDS.GRP$
3190 RETURN 
5000 ! check if any changes made
5010 CHECK_CHANGES:
5015 ! IF B_AR5$="" THEN RETURN 
5017 IF AR5$=DIM(400) THEN RETURN ! WO 249775
5020 IF B_AR5$=AR5$ AND B_AR5[0]=AR5[0] AND B_AR5[1]=AR5[1] AND B_AR5[2]=AR5[2] AND B_AR5[3]=AR5[3] AND B_AR5[4]=AR5[4] AND B_AR5[5]=AR5[5] AND B_AR5[6]=AR5[6] AND B_AR5[7]=AR5[7] THEN RETURN 
5030 MSGBOX MSG("REC_ALTERD"),MSG("UPDATE"),"?,YesNo",ANS$
5040 IF ANS$="NO" THEN RETURN 
5050 GOSUB WRITE_REC
5090 RETURN 
6000 ! load List box
6010 LOAD_TAX_LIST:
6020 LIST_BOX LOAD TAX_LIST.CTL,0,AR5$(11,25)+SEP+AR5$(36,1)+SEP+STR(AR5[0]:"###.00")+SEP+STR(AR5[1]:"###.00")
6190 RETURN 
7000 ! First Record
7010 FIRST_REC:
7020 KEY_1$=KEF(Z[1],END=NO_FIRST)
7030 STAX_CODE$=KEY_1$; REFRESH_FLG=1
7040 GOSUB FIND_REC
7090 RETURN 
7100 ! Last Record
7110 LAST_REC:
7120 KEY_1$=KEL(Z[1],ERR=NO_LAST)
7130 STAX_CODE$=KEY_1$; REFRESH_FLG=1
7140 GOSUB FIND_REC
7190 RETURN 
7200 ! Prior Record
7210 PRIOR_REC:
7220 KEY_1$=KEP(Z[1],END=START_FILE)
7230 STAX_CODE$=KEY_1$; REFRESH_FLG=1
7240 GOSUB FIND_REC
7290 RETURN 
7300 ! Next Record
7310 NEXT_REC:
7320 KEY_1$=KEY(Z[1],END=END_FILE) ! 231076
7330 STAX_CODE$=KEY_1$; REFRESH_FLG=1
7340 GOSUB FIND_REC
7350 RETURN 
8000 ! messages
8010 STATE_MSG:
8015 ! PRECISION 2
8020 MSG_1$=MSG("ADD_RECORD")
8021 REM "MSG_1$=STAX_CODE$+" "+MSG("STAX_MSG")+SEP+MSG("ADD_RECORD")
8030 MSGBOX MSG_1$,MSG("CONFIRM"),"?,YesNo",ANS$; IF ANS$="NO" THEN GOTO DONT_SETUP ELSE NEW_RECORD=1
8040 STATE_TAX=0
8050 CALL "*wingrp;Enable",FIELDS.GRP$; CALL "*wingrp;Enable",BUTTON_1.GRP$
8060 NEXT_ID=STAX_DESC.CTL
8065 TF_COUNTY$="N",TF_CITY$="N",TF_STATE$="N",TAX_FRT$="N" ! SSP#262899
8090 EXIT 
8300 ! Cannot delete message
8310 DEL_MSG:
8320 MSG1$=MSG("TAX_EX")+SEP+MSG("TAX_EX_2")
8330 MSGBOX MSG1$,MSG("FYI"),"INFO"
8390 RETURN 
8500 ! No First Record
8510 NO_FIRST:
8520 MSGBOX MSG("REC_NO_1ST"),"FYI","!"
8530 RETURN 
8600 ! No Last Record
8610 NO_LAST:
8620 MSGBOX MSG("REC_NO_LST$"),"FYI:," ! "
8630 RETURN 
8700 ! Start of File
8710 START_FILE:
8720 MSGBOX MSG("START_FILE"),"FYI","!"
8730 RETURN 
8800 ! End of File
8810 END_FILE:
8820 MSGBOX MSG("END_OF_FIL"),"FYI","!"
8830 RETURN 
8850 INVALID_PCS:! WO 249975
8860 MSGBOX MSG("INV_PCS"),"FYI","!"
8865 INVALID_PCS=1
8870 RETURN 
9000 ! Parameters
9010 GET_SYS_PARAM:
9020 READ (Z[6],KEY=X3$(9,3)+"A/R")PARAM1$
9030 IF PARAM1$(134,1)<>"Y" THEN CMD_STR$="END"; GOTO WRAPUP ! Change because this flag calling another program
9040 IF PARAM1$(119,1)="Y" THEN RETURN ! Look at the formating for this Flag
9090 RETURN 
9500 ! Clear ALl Fields
9510 CLEAR_FIELDS:
9520 STAX_CODE$=""
9530 STAX_DESC$=""; TAX_FRT$=""
9540 STAX_P_A$=""; ACCR_S_A$=""
9550 STAX_RATE=0; MAX_STAX=0
9555 VERTEX_UPDT_DATE$="",VERTEX_UPDT_NUM$="",VERTEX_EFF_DATE$=""
9556 STAX_P_A$="",ACCR_S_A$="",CITY_STS$="",ZIP_STS$="",STATE_STS$="",COUNTY_STS$="",COUNTY_CODE_STS$="",TF_STATE$="",TF_COUNTY$="",TF_CITY$="",STATE_DESC$="",NO_OVRDE_T_C$="",TOTAL_TAX$=""
9557 STAX_RATE=0,MAX_STAX=0,COUNTY_TAX_IF_OTHER=0,STATE_TAX_IF_OTHER=0,ST_STAX_RATE=0,CNTY_STAX_RATE=0,MAX_OTHER=0,TAX_RATE_TOTAL=0
9558 LOCATION$=""; REM SSP 219276
9559 PROD_CODE_SET_STATE$="",PROD_CODE_SET_COUNTY$="",PROD_CODE_SET_CITY$="",IGNORE_PCS_COUNTY$="",IGNORE_PCS_CITY$="",FREIGHT_ITEMS_NOT_TAXABLE$="",FREIGHT_OVER_ITEM_PRICE$="" ! WO249775 WO 284976
9560 DIM AR5$(400),AR5[15],B_AR5[15]; B_AR5$="" ! WO249775
9565 CALL "*wingrp;Disable",BUTTON_1.GRP$ ! WO 249775
9570 REM "CALL "*wingrp;Disable",STATE.GRP$
9575 REFRESH_FLG=1
9576 CALL "*wingrp;Disable",STATE.GRP$
9580 LIST_BOX FIND TAX_LIST.CTL,1,VV$,ERR=*RETURN; LIST_BOX LOAD TAX_LIST.CTL,1,*; GOTO *SAME
9590 RETURN 
9600 DONT_SETUP:! ^100 Answered NO to setup new record
9605 NEXT_ID=STAX_CODE.CTL
9695 EXIT 
9699 ! **********************************
9999 END 
10000 FIND_PCS_REC:! WO 249775
10005 INVALID_PCS=0
10010 PCS_KEY$="e"+PCS$
10020 FIND (Z[5],KEY=PCS_KEY$,DOM=INVALID_PCS)FMP$
10050 RETURN 
56000 REM "219276-Veratax enhancements related to new taxing requirements        
56001 REM "220726-Possibly change AR parameter to use Sales Tax Code stored 
56002 REM "231076-Sales Tax maintenance screen ARGMEB, issue with Next Record 
56003 REM "233585-Sales tax issue with override ship to-Order was invoiced at 
56004 REM "249775-Changes to sales tax parameters and tax calculations to     
56005 REM "257245-Issue with sales tax code setup panel - Tax Freight getting cleared
56006 REM "262899-Sales Tax Maintenance - Tax Freight checked - but in the     file 36,1 tax_frt is blank
56007 REM "284976-Sales Tax Interface: Modifications to freight salestax logic
56008 REM "284976-Sales Tax Interface: Modifications to freight salestax logic
