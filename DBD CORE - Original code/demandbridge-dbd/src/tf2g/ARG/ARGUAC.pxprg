0010 REM "Salesperson GUI Delete Routine <ARGUAC>
0020 SETESC 9300; SETERR 9000
0035 ! "6.0 - 06/10/02 - 9.061111 - dmm
0040 ! "Copyright 2002 Computer Software Inc.; Norcross, Georgia
0041 ! "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$,Q2$,Q3$
0100 SETERR 9000
0110 X0$="ARGUAC",X1$="Salesman Delete Routine",K9$="",K9=0
0120 DIM Z0$(80,"-"),A[14],Y[4],F[6],K[14],J[14]
0160 DEF FNS$(Z9$)=Z9$(1,POS("  "=Z9$+"  ")-1)
0200 REM "
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0300 REM "IOLISTS
0320 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0360 IOLIST F$,F[0],F[1],F[2],F[3],F[4],F[5],F[6]
0500 ! 500,5 - Open files
0503 GOSUB SETUP_MESSAGES
0505 _FILE_NAME$="ARU"+%C$; _ARU=HFN; OPEN (_ARU,ERR=OPEN_ERR)_FILE_NAME$
0510 _FILE_NAME$="AR3"+%C$; _AR3=HFN; OPEN (_AR3,ERR=OPEN_ERR)_FILE_NAME$
0515 _FILE_NAME$="ARA"+%C$; _ARA=HFN; OPEN (_ARA,ERR=OPEN_ERR)_FILE_NAME$
0520 _FILE_NAME$="ARF"+%C$; _ARF=HFN; OPEN (_ARF,ERR=OPEN_ERR)_FILE_NAME$
0525 _FILE_NAME$="ARM"+%C$; _ARM=HFN; OPEN (_ARM,ERR=OPEN_ERR)_FILE_NAME$
0526 _FILE_NAME$="ARY"+%C$; _ARY=HFN; OPEN (_ARY,ERR=OPEN_ERR)_FILE_NAME$
0530 _FILE_NAME$="FSA"+%C$; _FSA=HFN; OPEN (_FSA,ERR=OPEN_ERR)_FILE_NAME$
0535 _FILE_NAME$="ZZPARM"; _ZZPARM=HFN; OPEN (_ZZPARM,ERR=OPEN_ERR)_FILE_NAME$
0600 READ (_ZZPARM,KEY="STAT"+"A/R")S9$
0650 GOTO CONTINUE
0660 ! 
0670 OPEN_ERR: MSGBOX _MSG_FILOPNERR1$+QUO+_FILE_NAME$+QUO+SEP+_MSG_DIRECTORY$+LWD+SEP+_MSG_PREFIX$+PFX,MSG(ERR),"!"
0675 Q2$="ERR"
0680 GOTO WRAP_UP
0685 ! 
0700 CONTINUE:
1000 REM "
1100 REM "Salesman file
1110 READ (_AR3,KEY=Q1$(1,4),DOM=5000)A$
1150 REM "Customer sort
1160 READ (_ARU,KEY=A$(1,4),DOM=1161)
1170 K$=KEY(_ARU,END=1200); READ (_ARU)
1180 IF K$(1,4)=A$(1,4) THEN Q2$="N1"; GOTO 5000
1200 REM "Commission Payable
1210 READ (_ARM,KEY="",DOM=1211)
1220 K$=KEY(_ARM,END=1300); READ (_ARM)
1230 IF K$(7,4)=A$(1,4) THEN Q2$="N2"; GOTO 5000
1240 GOTO 1220
1300 REM "Salesperson booking
1310 READ (_ARY,KEY="",DOM=1311)
1320 K$=KEY(_ARY,END=1400); READ (_ARY)
1330 IF K$(7,4)=A$(1,4) THEN Q2$="N3"; GOTO 5000
1340 GOTO 1320
1400 REM "Order booking file
1410 READ (_FSA,KEY="",DOM=1411)
1420 READ (_FSA,END=1490)K$
1430 FOR I=0 TO 4
1440 IF K$(28+I0*4,4)=A$(1,4) THEN Q2$="N4"; EXITTO 5000
1450 NEXT I
1460 GOTO 1420
2000 REM "Delete Customer Information
2001 IF Q3$<>"P" THEN GOTO 2100
2003 PRINT @(0,16),'CL',@(12),"Salesman No:  ",A$(1,4),
2100 REM "Lookup Code file
2110 REMOVE (_ARF,KEY=A$(139,10)+A$(1,4),DOM=2111)
2400 REM "Combine Stats
2430 READ (_ARA,KEY=A$(1,4),DOM=2431)
2440 K$=KEY(_ARA,END=2600)
2445 IF K$(1,4)<>A$(1,4) THEN GOTO 2600
2450 Q1$=K$(1,8),Q0$=K$(9,1),P9$=Q1$+Q0$
2460 DIM K[14],J[14]
2470 GOSUB 7100
2480 FOR X=0 TO 14; J[X]=K[X]; NEXT X
2500 Q1$(1,4)="z   ",P9$=Q1$+Q0$
2505 GOSUB 6000
2510 DIM K[14]
2520 GOSUB 7100
2530 FOR X=0 TO 14; K[X]=K[X]+J[X]; NEXT X
2540 GOSUB 7150
2545 REMOVE (_ARA,KEY=K$)
2547 READ (_ARA,KEY=K$,DOM=2548)
2550 GOTO 2440
3060 REMOVE (_AR3,KEY=A$(1,4),DOM=3061)
3100 REM "Deleted Return to Overlay
3110 Q2$="Y"
3140 GOTO 9900
5000 REM "No Delete Return to Overlay
5010 REM "LET Q2$="N"
5090 GOTO 9900
5900 REM "REMOVE LINES
5910 IF A0=0 THEN GOTO 5990
5920 EXTRACT (F,IND=0,ERR=5960)IOL=0320
5925 IF Y[4]=-2 THEN READ (F,IND=0); WAIT 0; GOTO 5920 ELSE Y[4]=-2; WRITE (F,IND=0)IOL=0320
5930 A1=Y[1],Y[1]=A0,Y[0]=Y[0]-1
5935 READ (F,IND=A0,ERR=5940)A; IF A>0 THEN Y[0]=Y[0]-1,A0=A; GOTO 5935
5940 WRITE (F,IND=A0)A1
5950 Y[4]=-1; WRITE (F,IND=0)IOL=0320
5955 GOTO 5990
5960 IF ERR=0 THEN RETRY ELSE GOTO 9000
5990 RETURN 
6000 REM "Write z record to master & sorts
6010 DIM A2$(244); A2$(1,33)=Q1$(1,4)+"Deleted salesman's statistics",A2$(139,1)="z"; WRITE (_AR3,KEY=A2$(1,4),DOM=6011)A2$
6020 WRITE (_ARF,KEY="z         "+Q1$(1,4),DOM=6021)
6050 RETURN 
7000 REM "Update stats
7010 DIM K[14]; P9$=Q1$+Q0$
7020 GOSUB 7100
7030 FOR Q1=0 TO 13
7040 K[Q1]=K[Q1]+J[Q1]
7050 NEXT Q1
7060 GOSUB 7150
7090 RETURN 
7100 REM "Read stats (Packed/Unpacked)
7105 Q=POS(Q0$=S9$(49),17); IF Q=0 THEN GOTO 7190 ELSE M0$=S9$(Q+48,17)
7110 CALL "ZZPACK",X3$,"E",M0$(3,2),"",0,0,K{ALL},_ARA,Q0$,Q1$,S9$
7135 GOTO 7190
7150 REM "Write stats
7155 Q=POS(Q0$=S9$(49),17); IF Q=0 THEN GOTO 7190 ELSE M0$=S9$(Q+48,17)
7160 CALL "ZZPACK",X3$,"W",M0$(3,2),"",0,0,K{ALL},_ARA,Q0$,Q1$,S9$
7190 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 9900
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9200 SETUP_MESSAGES:
9210 _MSG_FILOPNERR1$=MSG("FILOPNERR1")
9220 _MSG_DIRECTORY$=MSG("DIRECTORY")
9230 _MSG_PREFIX$=MSG("PREFIX")
9290 SETUP_MESSAGES_END:RETURN 
9295 ! 
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9800 REM "EXIT PROGRAM
9900 WRAP_UP:
9905 IF _ARU THEN CLOSE (_ARU)
9910 IF _AR3 THEN CLOSE (_AR3)
9915 IF _ARA THEN CLOSE (_ARA)
9920 IF _ARF THEN CLOSE (_ARF)
9925 IF _ARM THEN CLOSE (_ARM)
9930 IF _ARY THEN CLOSE (_ARY)
9935 IF _FSA THEN CLOSE (_FSA)
9940 IF _ZZPARM THEN CLOSE (_ZZPARM)
9980 EXIT 
9990 ! 
9999 END 
