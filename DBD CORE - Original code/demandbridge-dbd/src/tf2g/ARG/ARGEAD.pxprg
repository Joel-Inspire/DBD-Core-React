0010 REM "A/R Invoice Data Entry II <ARGEAD>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 09/25/19 - 12.409166 - jvv - SSP# 307216
0037 REM "307216-Incorrect Commission Calculation on Invoice Total when House
0040 REM "Copyright 2019 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 SETERR 0100; L$=""; ENTER X3$,X4$,A1$,A$,A{ALL},L1,F5$; L$="Y",GP_ADJ=%GP_ADJ; SETERR 9000; GOTO 0140
0100 SETERR 9000
0120 IF H1=2 THEN PRINT @(0,3),'CE',; GOSUB 6000; GOSUB 6200; RUN "AR2EAH" ELSE IF H1=1 THEN H1=0; IF M1=1 THEN GOTO 9804 ELSE GOTO 1800
0125 M8=J9,J9=0; ON M8 GOTO 0140,0126,0127,0128,0129,0130,0140
0126 GOSUB 6400; ON C0 GOTO 3410,3411
0127 GOSUB 6400; ON C0 GOTO 2310,2311
0128 GOSUB 6400; ON C0 GOTO 2360,2361
0129 GOSUB 6400; ON C0 GOTO 3910,3911
0130 GOSUB 6400; ON C0 GOTO 3360,3361
0140 M0$="-#,###,###.00",M1$="-###,###.00",M3$="-###.00"
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 FID_0$=FID(0); IF %IN_WEBEC$="Y" THEN FID_0$(1,1)="G"
0200 REM "
0210 O2=0,V8$="00020613193099"
0300 REM "IOLISTS
0310 IOLIST A$(1,LEN(A$)),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14],A[15],A[16],A[17],A[18],A[19],A[20],A[21],A[22],A[23],A[24],A[25],A[26],A[27],A[28],A[29],A[30]
0320 IOLIST B$
0330 IOLIST C$,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15]
0340 IOLIST D$
0350 IOLIST E$,E[0],E[1],E[2],E[3]
0370 IOLIST G$,G[0],G[1],G[2]
0380 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13],H[14],H[15]
0390 IOLIST I$
0450 DIM B$(20),C[15],E$(54),E[3],G$(37),G[3],H$(48),H[23],I$(244)
0501 IF L$="Y" AND %ACTION$="C" THEN DIM Z[NUM(X3$(60,3))]; Z$="01X GRB...  02ORFMP...  03O AR1...  04O PO3...  05ORAR2...  06O ZZPARM  07O AR5...  08ORAR4...  09ORAR3...  10O FS1...  11ORGRC...  12O FMN...  13O FM0...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0503,9900
0502 IF L$="Y" THEN DIM Z[NUM(X3$(60,3))]; Z$="01X ARB...  02ORFMP...  03O AR1...  04O PO3...  05ORAR2...  06O ZZPARM  07O AR5...  08ORAR4...  09ORAR3...  10O FS1...  11ORARC...  12O FMN...  13O FM0...  "; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0503,9900
0503 GOSUB CHECK_INBOUND_FREIGHT ! WO244750
0504 GOSUB GET_MARKUP
0505 GOSUB 7500
0506 READ (Z[6],KEY=X3$(9,3)+"A/R",DOM=0507)P0$
0507 FIND (Z[8],KEY=A$(128,5),DOM=0508)IOL=0380
0508 IF A[2]<>0 OR MID(FMPM$,35,1)="S" THEN GOSUB 4600
0509 IF F5$<>"" AND A[2]=0 THEN A[2]=NUM(F5$,ERR=0510); GOSUB 4600
0510 S0=0; GOSUB 4100; IF L$="Y" THEN WRITE (Z[1],KEY=A1$)IOL=0310; GOTO 9800; REM "Removed "GOSUB 4150" prior to WRITE, this should be done correctly in 8000's in AR2EAL, here will be incorrect if any commisions by line.
0515 IF %IN_WEBEC$<>"Y" THEN PRINT @(0,6),'CE',
0520 GOSUB 6000
0530 GOSUB 6200
1700 GOTO 1900
1800 REM "
1801 %FREIGHT=0
1810 IF A$(77,1)="C" AND A[9]>0 THEN CALL "ZZPROM","X1AR2EAD",X3$,Z,"","","V",X0; ON Z+1 GOTO 1830,1850,9700,8500
1819 IF %HAS_IMAGE_LIB THEN %IL_IMAGE_TYPE$="ORDER",%IL_IMAGE_KEY$=A$(92,8)
1820 CALL "ZZPROM","X0AR2EAD",X3$,Z,"","","V",X0; %IL_IMAGE_TYPE$="",%IL_IMAGE_KEY$=""; ON Z+1 GOTO 1830,1850,9700,9800,8500
1830 C0=0,X0=X0-2; GOTO 2000
1850 REM "MODIFY
1865 C9=1
1870 GOSUB 6200
1890 X0=-1,C0=0; GOTO 2000
1990 C0=0; IF A[20]<=0 THEN X0=3 ELSE IF A[2]=0 OR A(17)=0 THEN X0=4 ELSE GOTO 2050
2000 REM "DATA SEQ
2005 IF L$="Y" THEN GOTO 9900 ! SSP#218159
2010 ! IF F5$<>"" AND A[2]=0 AND DONT_PRINT$<>"RETAIN" THEN A[2]=NUM(F5$,ERR=2011); GOSUB 4600; GOSUB 4100; GOSUB 6300
2011 IF F5$<>"" AND DONT_PRINT$<>"RETAIN" THEN A[2]=%FREIGHT; GOSUB 4600; GOSUB 4100; GOSUB 6300
2020 C9=1,X$="",C0=ABS(C0),X0=X0+1; IF C0=2 THEN IF X0>0 THEN X0=X0-2
2025 IF INT(C0)=3 THEN GOSUB 7300 ELSE IF C0>3 OR X0<0 THEN GOTO 2050
2045 ON X0 GOTO 2600,3900,2400,2350,2750,2650,2700,2800,2850,2900,2950,3000,3050,2300,2500,3150,3200,3250,3300,3500,3400,3450,3400,3450,3400,3450,3400,3450,3400,3450,3350,3950,2050
2050 GOSUB 7900; O2=1; GOSUB 8400; GOTO 1800
2300 REM "Terms code
2303 IF OP_SEC$(65,1)="Y" THEN GOTO 2020
2310 CALL "ZZENTR","SZX",A{ALL},A$,X4$,X3$,67,6,65,2,C0,"","{3"+X$,"","AR2EAD14","AR2","X",""; IF ABS(C0)=102 THEN RUN "AR2EAF" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2310,2311
2320 FIND (Z[5],KEY=A$(65,2),DOM=2310)IOL=0350
2330 IF C0>=0 THEN GOSUB 8300; IF A[1]<>0 THEN GOSUB 4100; GOSUB 6300
2340 GOTO 2020
2350 REM "Sales tax code
2360 CALL "ZZENTR","AUX",A{ALL},A$,X4$,X3$,16,9,67,10,C0,"AR5","{3"+X$,"","AR2EAD16","AR5","X",""; IF ABS(C0)=102 THEN RUN "AR2EAF" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 2360,2361
2370 FIND (Z[7],KEY=A$(67,10),DOM=2360)IOL=0370
2380 IF C0>=0 THEN IF A[1]<>0 OR A[2]<>0 THEN GOSUB 4100; GOSUB 6300
2390 GOTO 2020
2400 REM "Job no
2410 CALL "ZZENTR","S",A{ALL},A$,X4$,X3$,33,8,325,12,C0,"","{3"+X$,"","AR2EAD27","","",""
2440 GOTO 2020
2500 REM "Invoice date
2510 CALL "ZZENTR","DX",A{ALL},A$,X4$,X3$,67,7,86,6,C0,"","{3"+X$,"","AR2EAD22","","",""
2520 IF C0>=0 THEN GOSUB 8300
2540 GOTO 2020
2550 REM "Our order number
2555 GOTO 2020
2560 CALL "ZZENTR","Z",A{ALL},A$,X4$,X3$,60,10,92,8,C0,"","{3"+X$,"","AR2EAD24","","",""
2590 GOTO 2020
2600 REM "Customer P/O number
2610 CALL "ZZENTR","S",A{ALL},A$,X4$,X3$,16,7,100,15,C0,"","{3"+X$,"","AR2EAD26","","",""
2640 GOTO 2020
2650 REM "Net amount
2655 IF A[20]>0 THEN GOTO 2020
2660 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,31,12,1,722,C0,M0$,"{3"+X$,"","AR2EAD28","","",""
2670 IF C0>0 THEN GOSUB 4100; GOSUB 4150; GOSUB 6300
2690 GOTO 2020
2700 REM "Freight
2705 IF A$(177,1)="Y" THEN GOSUB 4700
2707 HOLD_A2=A[2]
2710 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,33,13,2,621,C0,M1$,"{3"+X$,"","AR2EAD30","","",""
2715 REM IF HOLD_A2<>A[2] THEN DONT_PRINT$="MORE"
2720 IF C0>=0 THEN IF HOLD_A2<>A[2] THEN GOSUB 4600; REM SSP 199591
2725 HOLD_A2=0
2730 IF ABS(C0)<2 OR ABS(C0)>3.9 THEN X0=12
2735 IF C0>0 THEN GOSUB 4100; GOSUB 6300
2740 GOTO 2020
2750 REM "Exempt?
2760 CALL "ZZENTR","YX",A{ALL},A$,X4$,X3$,40,9,115,1,C0,"","{3"+X$,"","AR2EAD32","","",""
2770 IF C0<0 THEN GOTO 2790
2780 IF A$(115,1)="Y" THEN FOR I=3 TO 8; A[I]=0; NEXT I
2785 GOSUB 4100; GOSUB 6300
2795 GOTO 2020
2800 REM "State taxable amount
2805 IF A$(115,1)="Y" OR A$(178,1)="Y" THEN GOTO 2020
2810 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,4,15,3,722,C0,M0$,"{3"+X$,"","AR2EAD34","","",""
2820 IF C0>=0 THEN S0=3; GOSUB 4200; GOSUB 4125; GOSUB 6300
2840 GOTO 2020
2850 REM "State tax billed
2855 IF A$(115,1)="Y" OR A$(178,1)="Y" THEN GOTO 2020
2860 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,18,15,4,621,C0,M1$,"{3"+X$,"","AR2EAD36","","",""
2865 IF C0>=0 THEN S0=4; GOSUB 4100; GOSUB 6300
2890 GOTO 2020
2900 REM "County taxable amount
2905 IF A$(115,1)="Y" OR A$(69,4)=Z1$(1,4) OR A$(178,1)="Y" THEN GOTO 2020
2910 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,4,16,5,722,C0,M0$,"{3"+X$,"","AR2EAD38","","",""
2920 IF C0>=0 THEN S0=5; GOSUB 4200; GOSUB 4125; GOSUB 6300
2940 GOTO 2020
2950 REM "County tax billed
2955 IF A$(115,1)="Y" OR A$(69,4)=Z1$(1,4) OR A$(178,1)="Y" THEN GOTO 2020
2960 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,18,16,6,621,C0,M1$,"{3"+X$,"","AR2EAD40","","",""
2965 IF C0>=0 THEN S0=6; GOSUB 4100; GOSUB 6300
2990 GOTO 2020
3000 REM "Local taxable amount
3005 IF A$(115,1)="Y" OR A$(73,4)=Z1$(1,4) OR A$(178,1)="Y" THEN GOTO 2020
3010 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,4,17,7,722,C0,M0$,"{3"+X$,"","AR2EAD42","","",""
3020 IF C0>=0 THEN S0=7; GOSUB 4200; GOSUB 4125; GOSUB 6300
3040 GOTO 2020
3050 REM "Local tax billed
3055 IF A$(115,1)="Y" OR A$(73,4)=Z1$(1,4) OR A$(178,1)="Y" THEN GOTO 2020
3060 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,18,17,8,621,C0,M1$,"{3"+X$,"","AR2EAD44","","",""
3065 IF C0>=0 THEN S0=8; GOSUB 4100; GOSUB 6300
3090 GOTO 2020
3100 REM "Invoice total
3105 GOTO 2020
3110 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,25,21,9,722,C0,M0$,"{3"+X$,"","AR2EAD46","","",""
3140 GOTO 2020
3150 REM "Invoice due date
3160 CALL "ZZENTR","D",A{ALL},A$,X4$,X3$,67,8,116,6,C0,"","{3"+X$,"","AR2EAD48","","",""
3190 GOTO 2020
3200 REM "Discount due date
3210 CALL "ZZENTR","D",A{ALL},A$,X4$,X3$,67,9,122,6,C0,"","{3"+X$,"","AR2EAD50","","",""
3240 GOTO 2020
3250 REM "Discount amount
3260 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,67,10,10,621,C0,M1$,"{3"+X$,"","AR2EAD52","","",""
3290 GOTO 2020
3300 REM "Cost
3301 IF SEC$>"" AND SEC$(63,1)="Y" THEN GOTO 2020
3303 IF X3$(9,3)="036" THEN GOTO 3306
3305 IF A[20]>0 THEN GOTO 2020
3310 CALL "ZZENTR","NX",A{ALL},A$,X4$,X3$,65,12,11,722,C0,M0$,"{3"+X$,"","AR2EAD54","","",""
3335 IF C0>0 THEN GOSUB 4150; GOSUB 6380
3340 GOTO 2020
3350 REM "Commission code
3355 IF A[20]>0 THEN GOTO 2020
3360 CALL "ZZENTR","SZUX",A{ALL},A$,X4$,X3$,66,19,128,5,C0,"","{3"+X$,"","AR2EAD56","AR4","X",""; IF ABS(C0)=102 THEN RUN "AR2EAF" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3360,3361
3365 IF C0<=0 THEN GOTO 3380
3370 FIND (Z[8],KEY=A$(128,5),DOM=3360)IOL=0380
3375 CALL "AR2COM",ERR=3376,"",H$,H{ALL},Q,A[1],A[11]-A[19]
3376 A[18]=Q
3380 GOSUB 6380
3390 GOTO 2020
3400 REM "Salespersons
3401 IF X3$(9,3)<>"030" THEN IF A[20]>0 THEN GOTO 2020
3402 J6=INT((X0-2)/2)-9,J8=133+4*J6
3405 IF MOD(J6,2)=0 THEN I8=64 ELSE I8=48
3406 IF J6=0 THEN I9=20 ELSE IF J6<=2 THEN I9=21 ELSE I9=22
3407 I9=I9-4
3409 IF J6>0 THEN IF POS(" "<>A$(J8-4,4))=0 OR P2$(8,1)<STR(J6+1:"0") THEN GOTO 2020
3410 CALL "ZZENTR","SZUX",A{ALL},A$,X4$,X3$,I8,I9,J8,4,C0,"","{3"+X$,"","AR2EAD58","AR3","X",""; IF ABS(C0)=102 THEN RUN "AR2EAF" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3410,3411
3415 S0=J6+1; GOSUB 8000
3419 IF POS(" "<>A$(J8,4))=0 THEN GOTO 2020
3420 IF C0<0 THEN GOTO 2020
3430 FIND (Z[9],KEY=A$(J8,4),DOM=3410)IOL=0390
3435 IF J6=0 THEN GOSUB 4500
3440 GOTO 2020
3450 REM "Commission rate
3452 J6=INT((X0-2)/2)-9,J8=133+4*J6,J5=12+J6
3455 IF MOD(J6,2)=0 THEN I8=70 ELSE I8=54
3456 IF J6=0 THEN I9=20 ELSE IF J6<=2 THEN I9=21 ELSE I9=22
3457 I9=I9-4
3459 IF POS(" "<>A$(J8,4))=0 THEN GOTO 2020 ELSE IF J6=0 AND P2$(8,1)="1" THEN GOTO 2020 ELSE IF P2$(8,1)<STR(J6+1:"0") THEN GOTO 2020
3460 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,I8,I9,J5,320,C0,M3$,"{3"+X$,"","AR2EAD60","","",""
3470 IF J6+1=NUM(P2$(8,1)) THEN GOSUB 7900
3490 GOTO 2020
3500 REM "GP Adj
3501 IF SEC$>"" AND SEC$(63,1)="Y" THEN GOTO 2020
3502 IF A[20]>0 THEN GOTO 2020
3505 X$="Total Gross Profit Adjustment INCLUDES Load"
3510 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,67,15,19,621,C0,M1$,"{3"+X$,"","AR2EAD71","","",""
3540 GOTO 2020
3900 REM "Category code"
3910 CALL "ZZENTR","AX",A{ALL},A$,X4$,X3$,16,8,153,9,C0,"ARG","{3"+X$,"","AR2EAD78","ARG","X",""; IF ABS(C0)=102 THEN RUN "AR2EAF" ELSE IF ABS(C0)>4 THEN GOSUB 6400; ON C0 GOTO 3910,3911
3915 IF C0=-2 THEN GOTO 2020
3920 FIND (Z[12],KEY=A$(153,9),DOM=3910)
3940 GOTO 2020
3950 REM "Commission amount
3955 IF A[20]>0 AND MID(H$,32,1)<>"I" THEN GOTO 2020
3960 CALL "ZZENTR","N",A{ALL},A$,X4$,X3$,67,20,18,621,C0,M1$,"{3"+X$,"","AR2EAD52","","",""
3990 GOTO 2020
4000 REM "Routines to calculate and/or lookup values"
4100 REM "Set sales tax values, calc totals, set disc & display
4120 CALL "AR2EAR",X3$,X4$,4,A$,A{ALL},G$,G{ALL},H$,H{ALL},I$,Z1$,S0,Z{ALL},T9{ALL},P2$,M3$,K9; S0=0
4125 A[9]=A[1]+A[2]+A[4]+A[6]+A[8]
4126 GOSUB 8300
4130 IF E$(43,1)<>" " THEN A[10]=(A[1]-A[17])*E[0]*.01 ELSE A[10]=0
4140 RETURN 
4150 REM "Recal comm
4160 CALL "AR2COM",ERR=4161,"",H$,H{ALL},Q,A[1],A[11]-A[19]
4170 A[18]=Q
4190 RETURN 
4200 REM "Calc taxable sale or sales tax based on S0=array pos in A()
4210 CALL "AR2EAR",X3$,X4$,0,A$,A{ALL},G$,G{ALL},H$,H{ALL},I$,Z1$,S0,Z{ALL},T9{ALL},P2$,M3$,K9; S0=0
4290 RETURN 
4500 REM "Get commission code from 1st salesperson"
4510 CALL "AR2EAR",X3$,X4$,1,A$,A{ALL},G$,G{ALL},H$,H{ALL},I$,Z1$,S0,Z{ALL},T9{ALL},P2$,M3$,K9
4536 GOSUB 4140; GOSUB 6380
4540 RETURN 
4600 REM "Freight Mark
4601 IF %RETAIN_INV THEN GOTO *RETURN
4602 IF %MSLC THEN PERFORM "ARGSCM;ARGEAD_CALL"; GOTO 4642 ! SSP 225300
4609 IF A[2]<>0 OR MID(FMPM$,35,1)="S" THEN IF DONT_PRINT$="" THEN DONT_PRINT$=L$ END_IF ; %DONT_PRINT$=DONT_PRINT$,%GP_ADJ_FRT=0; CALL "AR2FIS",X3$,X4$,P2$,DONT_PRINT$,A$,A{ALL},Z{ALL} END_IF ; GP_ADJ=GP_ADJ+%GP_ADJ_FRT; REM L$="Y"; REM " SSP# 131719
4610 FIND (Z[8],KEY=A$(128,5),DOM=4642)IOL=0380
4611 IF H$(32,1)<>"L" THEN CALL "AR2COM",ERR=4616,"",H$,H{ALL},Q,A[1],A[11]-GP_ADJ,"",A{ALL},B{ALL},EXTRA{ALL}; A[18]=Q; REM SSP 19992 REMOVED IF A[18]=0 THEN...       !Readd change 218159 SSP 307216
4612 A$(415,5)=%ALL_BRACKET$,%ALL_BRACKET$="",%BRACKET$="",%LAST_RATE=0; REM " SSP# 166575
4613 IF H$(45,1)<>"Y" THEN GOTO 4642
4614 IF H$(32,1)="L" THEN GOTO 4642
4615 FOR SLSP=0 TO 4
4616 IF A[SLSP+12]=0 THEN EXITTO 4642
4617 IF H$(31,1)<>"A" THEN %LAST_RATE=0,%BRACKET$=""
4618 DIM DET_IN[7]; DET_IN[0]=(A[1]-A[11]+A[19])*A[12+SLSP]/100,DET_IN[1]=A[SLSP+21],DET_IN[2]=A[26+SLSP],DET_IN[3]=A[1]*A[12+SLSP]/100,DET_IN[4]=A[11]*A[12+SLSP]/100
4619 DIM STAT_IN[14],STAT_OUT[14]; TF_INDEX$="ALL"
4620 DIM DET_IN$(146); DET_IN$(1,4)=A$(133+(SLSP*4),4),DET_IN$(5,6)=A$(1,6),DET_IN$(11,1)=A$(77,1),DET_IN$(12,8)=A$(7,8),DET_IN$(20,3)=SEQ$,DET_IN$(23,5)=A$(128,5),DET_IN$(28,1)=A$(415+SLSP,1),DET_IN$(29,1)=" ",DET_IN$(30,10)=A$(15,10),DET_IN$(40,6)=A$(86,6),DET_IN$(46,8)=STR(A5:"00000000"),F_YEAR$=A$(1,4),ACCT_PER$=A$(5,2)
4622 CALL "AR2XAC",X3$,X4$,"D",DET_IN$,DET_IN{ALL},DET_OUT$,DET_OUT{ALL},STAT_IN$,STAT_IN{ALL},STAT_OUT$,STAT_OUT{ALL},F_YEAR$,ACCT_PER$,TRANS_T$,AMOUNT,TF_INDEX$,UNUSED_2$,UNUSED1,UNUSED2
4623 AMOUNT=DET_IN[0]
4624 CALL "AR2XAC",X3$,X4$,"W",DET_IN$,DET_IN{ALL},DET_OUT$,DET_OUT{ALL},STAT_IN$,STAT_IN{ALL},STAT_OUT$,STAT_OUT{ALL},F_YEAR$,ACCT_PER$,TRANS_T$,AMOUNT,TF_INDEX$,UNUSED_2$,UNUSED1,UNUSED2; %LAST_RATE=0,%BRACKET$=""
4625 IF L$<>"Y" THEN GOSUB 4100; GOSUB 6200; GOSUB 6300
4630 F5$=""
4641 NEXT SLSP
4642 IF L$<>"Y" THEN PRINT @(33,13),A[17]:M1$,
4643 IF L$<>"Y" THEN GOSUB 4100; GOSUB 6200; GOSUB 6300
4644 F5$=""
4645 RETURN 
4700 REM "Special Shipping"
4720 X$="Order indicates special shipping (splits and/or partials)"
4730 CALL "ZZPROM",".4",X3$,J6,X$,"","V",X0
4740 RETURN 
6005 PRINT @(50,1),"    ",
6010 CALL "AR2EAP",X3$,X4$,A$,A{ALL},0,P1$,C$,P2$
6090 RETURN 
6200 REM "DISPLAY DATA
6210 CALL "AR2EAP",X3$,X4$,A$,A{ALL},1,P1$,C$,P2$
6240 RETURN 
6255 CALL "AR2EAP",X3$,X4$,A$,A{ALL},5,P1$,C$,P2$
6290 RETURN 
6310 CALL "AR2EAP",X3$,X4$,A$,A{ALL},3,P1$,C$,P2$
6370 RETURN 
6380 CALL "AR2EAP",X3$,X4$,A$,A{ALL},4,P1$,C$,P2$
6390 RETURN 
6400 REM "WHOLE SCREEN
6405 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,X5$,X0,X1,0
6420 GOSUB 6000
6430 IF C9>=0 THEN GOSUB 6200 ELSE GOSUB 6450
6440 IF ABS(C0)>4 THEN C0=ABS(C0)-5
6445 RETURN 
6450 REM "DISPLAY KEYS
6470 CALL "AR2EAP",X3$,X4$,A$,A{ALL},2,P1$,C$,P2$
6490 RETURN 
7300 REM 
7310 ON FPT(C0)*10 GOTO 7390,7325,7330,7390
7325 IF V8$="" THEN X0=X0+4; GOTO 7390 ELSE X0=NUM(V8$(POS(STR(X0:"00")<=V8$,2),2)); GOTO 7390
7330 IF V8$="" THEN X0=X0-6; GOTO 7335 ELSE X0=POS(STR(X0-1:"00")<=V8$,2)-2; IF X0<0 THEN X0=0; GOTO 7390 ELSE X0=NUM(V8$(X0,2)); GOTO 7390
7335 IF X0<0 THEN X0=0; GOTO 7390
7390 C0=3; RETURN 
7500 REM "RESET FILES
7510 FIND (Z[3],KEY=A$(15,10),DOM=1531)IOL=0330
7530 DIM E$(54),E[3]; FIND (Z[5],KEY=A$(65,2),DOM=7531)IOL=0350
7590 RETURN 
7900 REM "Check for 100% addition
7905 IF POS(" "<>A$(133,20))=0 THEN RETURN 
7910 CALL "AR2EAR",X3$,X4$,2,A$,A{ALL},G$,G{ALL},H$,H{ALL},I$,Z1$,S0,Z{ALL},T9{ALL},P2$,M3$,K9
7990 RETURN 
8000 REM " move salesperson codes up
8010 IF POS(" "<>A$(129+S0*4,4))<>0 THEN RETURN 
8020 CALL "AR2EAR",X3$,X4$,3,A$,A{ALL},G$,G{ALL},H$,H{ALL},I$,Z1$,S0,Z{ALL},T9{ALL},P2$,M3$,K9
8042 GOSUB 6255
8045 RETURN 
8300 REM "CALC DUE DATE
8305 IF E$(1,2)<>A$(65,2) THEN DIM E$(54),E[3]; FIND (Z[5],KEY=A$(65,2),DOM=8306)IOL=0350
8310 CALL "ZZDISC",X3$,E$,0,0,A$(86,6),Q0$,Q1$,0,0
8315 A$(116,6)=Q0$; IF E$(43,1)<>" " THEN A$(122,6)=Q1$ ELSE A$(122,6)=""
8320 IF L$<>"Y" THEN CALL "ZZDISP","D",A$(116,6),"",X3$,"","",67,8,X4$
8325 IF L$<>"Y" THEN CALL "ZZDISP","D",A$(122,6),"",X3$,"","",67,9,X4$
8345 RETURN 
8400 REM "Check for valid terms, salestax & category
8401 IF L$="Y" THEN GOTO 8490
8402 X$="Invoice must have a valid "
8405 FIND (Z[5],KEY=A$(65,2),DOM=8406); GOTO 8410
8406 X0=0,X$=X$+"terms code",C0=0; EXITTO 2040
8410 FIND (Z[7],KEY=A$(67,10),DOM=8411); GOTO 8415
8411 X0=1,C0=0,X$=X$+"sales tax code"; EXITTO 2040
8415 IF P0$(19,1)<>"Y" THEN GOTO 8425
8420 FIND (Z[12],KEY=A$(153,9),DOM=8421); GOTO 8425
8421 X0=1,C0=0,X$=X$+"category code"; EXITTO 2040
8439 X$=""
8450 REM "Check credit limit
8455 H1$="AR2EAD"
8460 IF O9$="*" THEN GOTO 8490
8470 IF L$<>"Y" THEN IF C[5]>0 AND C[6]+C[13]<=C[5] AND C[6]+C[13]+A[9]>C[5] THEN H0=1; RUN "AR2EAH"
8490 RETURN 
8500 REM "Go back to lines"
8510 J9=-10; RUN "AR2EAL"
8900 REM "
8910 CALL "ZZPROM","4",X3$,S3,"Check the parameters for this company. Press |Return to continue","","",0; GOTO 9900
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9900
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9700 REM "Delete entry
9705 IF %IN_WEBEC$<>"Y" THEN PRINT @(16,4),'CL',@(0,6),'CE',
9710 L0=2; RUN "AR2EAA"
9803 IF O2=0 THEN M1=1; GOSUB 8400
9804 M1=0
9805 C0=0,L0=0
9806 IF GB$<>"" THEN IF L$<>"Y" THEN IF A[1]>0 AND A[11]>A[1] THEN CALL "ZZPROM",".10",X3$,TMP,"|WARNING - Cost is greater the Price!!","","",0; IF TMP=0 THEN GOTO 1800
9807 IF LEN(A1$)<14 THEN A1$=A$(1,14)
9808 WRITE (Z[1],KEY=A1$)IOL=0310
9809 EXTRACT (Z[1],KEY=A1$)IOL=0310
9810 IF H$(45,1)<>"Y" THEN GOTO 9825
9811 IF H$(32,1)<>"I" THEN GOTO 9825
9812 FOR SLSP=0 TO 4
9813 IF A[12+SLSP]=0 THEN EXITTO 9825
9814 DIM DET_IN$(146); DET_IN$(1,4)=A$(133+(SLSP*4),4),DET_IN$(5,6)=A$(1,6),DET_IN$(11,1)=A$(77,1),DET_IN$(12,8)=A$(7,8),DET_IN$(20,3)=SEQ$,DET_IN$(23,5)=A$(128,5),DET_IN$(28,1)=A$(415+SLSP,1),DET_IN$(29,1)=" ",DET_IN$(30,10)=A$(15,10),DET_IN$(40,6)=A$(86,6),DET_IN$(46,8)=STR(A5:"00000000"),F_YEAR$=A$(1,4),ACCT_PER$=A$(5,2)
9815 IF H$(31,1)<>"A" THEN %LAST_RATE=0,%BRACKET$=""
9816 DIM DET_IN[7]; DET_IN[0]=(A[1]-A[11]+A[19])*A[12+SLSP]/100,DET_IN[1]=A[SLSP+21],DET_IN[2]=A[26+SLSP],DET_IN[3]=A[1]*A[12+SLSP]/100,DET_IN[4]=A[11]*A[12+SLSP]/100
9817 DIM STAT_IN[14],STAT_OUT[14]
9818 TF_INDEX$="ALL"
9819 CALL "AR2XAC",X3$,X4$,"D",DET_IN$,DET_IN{ALL},DET_OUT$,DET_OUT{ALL},STAT_IN$,STAT_IN{ALL},STAT_OUT$,STAT_OUT{ALL},F_YEAR$,ACCT_PER$,TRANS_T$,AMOUNT,TF_INDEX$,UNUSED_2$,UNUSED1,UNUSED2
9820 AMOUNT=DET_IN[0]
9823 CALL "AR2XAC",X3$,X4$,"W",DET_IN$,DET_IN{ALL},DET_OUT$,DET_OUT{ALL},STAT_IN$,STAT_IN{ALL},STAT_OUT$,STAT_OUT{ALL},F_YEAR$,ACCT_PER$,TRANS_T$,AMOUNT,TF_INDEX$,UNUSED_2$,UNUSED1,UNUSED2; %LAST_RATE=0,%BRACKET$=""
9824 NEXT SLSP
9825 IF L$="Y" THEN CALL "ARGEAC.2",X3$,X4$,A$,A{ALL},Z{ALL},Y1$,Y0$,F,Y{ALL},G0$,I0$,M$,P0$,E{ALL},T9$,T{ALL}; GOTO 9827
9826 IF L$="Y" THEN CALL "AR2EAC",X3$,X4$,A$,A{ALL},Z{ALL},Y1$,Y0$,F,Y{ALL},G0$,I0$,M$,P0$,E{ALL}; Z$="01C ARB...   01X ARB...  "; IF %ACTION$="C" THEN Z$="01C GRB...  01X GRB...  " END_IF ; CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; REM "Need to reopen ARB, may have been closed if this is an immedita print invoice, WO122361.  SSP166845, If in C mode for CC was opening ARB file instead of GRB and writing out additional invoice in error
9827 WRITE (Z[1],KEY=A1$)IOL=0310
9828 EXTRACT (Z[1],KEY=A1$)IOL=0310
9829 GOTO 9900
9830 RUN "AR2EAC"
9900 REM "END PROGRAM
9910 IF L$="Y" THEN CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
10000 GET_MARKUP:
10010 DIM FMPM$(48),FMPM[11]
10020 IF MID(A$,92,8)<>DIM(8) THEN {
10030 READ (Z[10],KEY=A$(92,8),ERR=*RETURN)ORDER$
10040 READ (Z[2],KEY="M"+ORDER$(244,2),ERR=*RETURN)FMPM$,FMPM[0],FMPM[1],FMPM[2],FMPM[3],FMPM[4],FMPM[5],FMPM[6],FMPM[7],FMPM[8],FMPM[9],FMPM[10],FMPM[11]
10050 IF MID(FMPM$,35,1)="S" AND F5$="0" AND A[2]=0 THEN F5$=""
10080  }
10090 RETURN 
10098 ! 
10099 ! 
12000 CHECK_INBOUND_FREIGHT:
12010 FIND (Z[6],KEY=X3$(9,3)+"S/H",DOM=9900)SH_PARM$
12020 IFP$=""; IF MID(SH_PARM$,227,1)="Y" THEN IFP$="Y" ELSE RETURN ! WO 224750
12040 PO_FRT=0,FS1_FRT$=""; CALL "SM2IFP;PROCESS_SMI",A$(7,8),A$(92,8),ARB_FRT,FS1_FRT$ ! WO244750
12050 IF ARB_FRT<>0 THEN A[2]=A[2]+ARB_FRT
12060 IF FS1_FRT$<>"" THEN F5$=FS1_FRT$
12990 RETURN 
12999 ! 
56000 REM "190090-[helpdesk #22316] Auto Freight Mark-up Issue                
56001 REM "199591-Buried frt showing with sell
56002 REM "218159-Commissions and Requisition charges - what to change so that,readd lms changes from 199928
56003 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
56004 REM "244750-Inbound Freight processing in the Customer Invoicing Gateway
56005 REM "307216-Incorrect Commission Calculation on Invoice Total when House
