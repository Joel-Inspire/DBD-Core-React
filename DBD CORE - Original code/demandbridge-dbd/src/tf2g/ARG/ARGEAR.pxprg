0010 REM "Calculations for invoice 3rd screen <ARGEAR>
0020 SETESC 9300; SETERR 9000
0035 ! "6.0 - 10/15/02 - 14.713888 - dmm
0040 ! "Copyright 2002 Computer Software Inc.; Norcross, Georgia
0041 ! "        Licensed Software - All Rights Reserved.
0100 SETERR 9000
0110 ENTER X3$,X4$,C9,A$,A{ALL},G$,G{ALL},H$,H{ALL},I$,Z1$,S0,Z{ALL},T9{ALL},P2$,M3$,K9
0120 DIM Z1$(30)
0370 IOLIST G$,G[0],G[1],G[2]
0380 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13],H[14],H[15]
0390 IOLIST I$
0900 REM "C9 = 4 is for defaulting sales tax
1000 ON C9 GOSUB 4200,4500,7900,8000,4100
1010 GOTO 9900
4000 REM 
4020 CALL "ARGEAY",X3$,X4$,A$,A{ALL},S0
4030 GOTO 9900
4100 REM "Default sales tax amount and everything
4101 GOTO 4000
4120 IF A$(115,1)<>"Y" THEN FOR S0=3 TO 8; GOSUB 4200; NEXT S0
4190 RETURN 
4200 REM "Calc taxable sale or sales tax based on S0=array pos in A()
4201 GOTO 4000
4205 IF A[20]=0 THEN T9[0]=A[1]
4210 ON S0-3 GOTO 4220,4220,4230,4230,4240,4240
4220 IF A$(67,2)="  " THEN A[S0]=0; GOTO 4290 ELSE IF A$(67,2)+Z1$(1,8)<>G$(1,10) THEN READ (Z[7],KEY=A$(67,2)+Z1$(1,8),DOM=4290)IOL=0370; GOTO 4250 ELSE GOTO 4250
4230 IF A$(69,4)=Z1$(1,4) THEN A[S0]=0; GOTO 4290 ELSE IF A$(67,6)+Z1$(1,4)<>G$(1,10) THEN READ (Z[7],KEY=A$(67,6)+Z1$(1,4),DOM=4290)IOL=0370; GOTO 4250 ELSE GOTO 4250
4240 IF A$(73,4)=Z1$(1,4) THEN A[S0]=0; GOTO 4290 ELSE IF A$(67,10)<>G$(1,10) THEN READ (Z[7],KEY=A$(67,10),DOM=4290)IOL=0370
4250 ON MOD(S0,2) GOTO 4270,4260
4260 IF C9=4 THEN IF G$(36,1)="Y" THEN A[S0]=T9[0]+T9[1]+A[2] ELSE A[S0]=T9[0]
4261 REM " WAS IF C9=4 THEN IF G$(36,1)="Y" THEN LET A(S0)=T9+A(2)+A(17) ELSE LET A(S0)=T9
4265 GOTO 4290
4270 REM "Figure tax"
4275 A[S0]=A[S0-1]*G[0]/100
4280 IF G[1]>0 THEN IF ABS(A[S0])>G[1] THEN A[S0]=G[1]*SGN(A[S0])
4290 RETURN 
4500 REM "Get commission code from 1st salesperson"
4510 IF A$(133,4)<>I$(1,4) THEN FIND (Z[9],KEY=A$(133,4),DOM=4511)IOL=0390
4520 A$(128,5)=I$(219,5)
4530 FIND (Z[8],KEY=A$(128,5),DOM=4531)IOL=0380
4532 CALL "AR2COM","",H$,H{ALL},Q,A[1],A[11]-A[19]
4533 A[18]=Q
4535 PRINT @(66,19),A$(128,5),
4540 RETURN 
7900 REM "Check for 100% addition
7905 IF POS(" "<>A$(133,20))=0 THEN RETURN 
7907 T6=0,T7=-1
7910 FOR I=0 TO NUM(P2$(8,1))-1
7915 IF A$(133+I*4,4)="    " THEN A[I+12]=0; GOTO 7940
7920 T7=I,T6=T6+A[I+12]
7940 NEXT I
7945 IF T7=-1 THEN GOTO 7990 ELSE IF T6=100 THEN GOTO 7990
7950 A[T7+12]=A[T7+12]+100-T6
7960 IF P2$(8,1)="1" THEN GOTO 7990 ELSE ON T7 GOTO 7965,7970,7975,7980,7985
7965 PRINT @(70,16),A[12]:M3$,; GOTO 7990
7970 PRINT @(54,17),A[13]:M3$,; GOTO 7990
7975 PRINT @(70,17),A[14]:M3$,; GOTO 7990
7980 PRINT @(54,18),A[15]:M3$,; GOTO 7990
7985 PRINT @(70,18),A[16]:M3$,
7990 RETURN 
8000 REM " move salesperson codes up
8010 IF POS(" "<>A$(129+S0*4,4))<>0 THEN RETURN 
8020 FOR I=S0-1 TO 3
8030 I0=K9+I*4,A$(133+I0,4)=A$(137+I0,4),A[I+12]=A[I+13]
8034 IF I=3 THEN A$(137+I0,4)="",A[16]=0
8035 NEXT I
8040 PRINT @(64,16),'CL',@(48,17),'CL',@(48,18),'CL',
8041 GOSUB 7900
8045 RETURN 
9000 REM "ERROR PROCESSING
9001 PRINT @(0,20),'CE',"ERR=",ERR," LINE: ",TCB(5),; INPUT *
9005 EXIT ERR
9900 REM "END PROGRAM
9910 EXIT 
9999 END 
