0005 J7=9; RUN "ARGEAL"
0010 REM "A/R Invoice Data Entry - II <ARGEAM>
0035 REM "5.5 - 08/31/07 - 10.089444 - jdf - SSP# 211380
0037 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 SETERR 9000; SETESC 9300
0160 DEF FNP$(Z9$)="("+Z9$(1,3)+") "+Z9$(4,3)+"-"+Z9$(7,4)+" Ext: "+Z9$(11,4)
0165 DEF FND$(Z9$)=Z9$(NUM(X3$(48,1))*2+1,2)+X3$(59,1)+Z9$(7-NUM(X3$(48,1))*2,2)+X3$(59,1)+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
0170 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
0180 CLOSE (14); OPEN (14)"ZZPARM"
0190 DIM SEC$(255); FIND (14,KEY="osec"+X3$(40,3),DOM=0191)SEC$; REM "jel 100164 GoldBond
0195 READ (Z[2],KEY="D"+A$(15,10),DOM=*NEXT)FMPD$,FM1D0,FMPD1,FMPD2,FMPD3,FMPD4,FMP5; REM " SSP# 161760                                                  
0202 IF D6$="*" THEN IF D5$="*" THEN RUN "ARGEAI" ELSE GOSUB 6500
0203 IF D5$="*" THEN GOTO 2040
0205 J8=J7,J7=0; ON J8 GOTO 2000,2040,0210,0210,0210,0210,0210,0210,0210,0210,2000
0210 GOTO 6500
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
0310 IOLIST A,B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20]
0311 IOLIST A,B$,B[0],B[1],STR(B[2]),STR(B[3]),B[4],B[5],B[6],B[7],B[8],B[9],B[10],B[11],B[12],B[13],B[14],B[15],B[16],B[17],B[18],B[19],B[20]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6]
0340 IOLIST D$
0352 IOLIST E$,E[0],E[1],E[2]
0370 IOLIST G$
0380 IOLIST H$,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13],H[14],H[15]
0390 IOLIST P3$,P[0],P[1]
0400 IOLIST W$
0410 IOLIST J$,J[0],J[1],J[2]
1000 J7=1; RUN "AR2EAL"
1100 J7=2; RUN "AR2EAL"
1120 J7=3; RUN "AR2EAL"
1125 J7=4; RUN "AR2EAL"
1160 J7=5; RUN "AR2EAL"
1800 J7=6; RUN "AR2EAL"
1900 J7=7; RUN "AR2EAL"
2010 C0=0,D9=1,X0=-1,X1=1,T=0,U=0,Q$="?"; IF Y<0 OR A7=1 THEN T=-1,X0=0
2020 X$="",C0=ABS(C0); IF C0=2 AND X0=0 THEN X0=999; GOTO 2040 ELSE IF C0=2 THEN X0=X0-1 ELSE X0=X0+1; IF C0=2 AND X0=0 THEN X[0]=X[0]-1; GOTO 1100
2025 REM "IF INT(C0)=3 THEN GOSUB 8300 ELSE IF C0>3 OR X0<0 THEN LET X0=999
2026 IF C0>3 OR X0<0 THEN X0=999
2037 IF X0>1 AND X0<999 THEN U=1
2039 IF O9$="*" AND X0>1 AND B$(47,3)<>"   " THEN IF X0<18 THEN X0=18; IF ABS(C0)=2 THEN C0=1
2040 IF GB$<>"" AND A5=NUM(A$(410,5)) THEN DIM Q[1]; ON X0 GOTO 2510,2560,1900 ELSE IF B$(1,1)="M" THEN ON X0 GOTO 2050,2100,2150,3100,1900 ELSE ON X0 GOTO 2050,2100,2650,2200,2800,2800,2800,2800,2800,2400,2750,2250,2300,2350,2500,3100,2450,2550,3000,3150,3050,2700,3200,3250,2600,1900
2055 GOTO 2020
2100 REM "Line type
2101 LINE_TYPE_ENTRY:
2104 DIM Q[12]
2105 B9$=B$(1,1),X3$(29,1)="",B8$="NSMICF "
2106 IF O9$<>"*" THEN X$="F=custom item, I=inventory, C=cust inventory, N=nonstock, S=special, M=message" ELSE X$="S=special, M=message"
2109 REM "IF D5$="*" THEN LET D5$=""; ON C0 GOTO 2110,2111
2110 B$(1,1)=LINE_TYPE$ ! CALL "ZZENTR","SZXUR",B{ALL},B$,X4$,X3$,16,6,1,1,C0,"","{M"+X$,B8$,"AR2EAM02","","",""; IF ABS(C0)>4 THEN GOSUB 6500
2111 IF POS(X3$(9,3)="044",3)=0 AND O9$="*" AND Y<0 THEN IF POS(B$(1,1)="SM")=0 THEN B$(1,1)=B9$; GOTO 2110
2112 IF Y>=0 AND O9$="*" AND B$(47,3)<>"   " THEN B$(1,1)=B9$; IF ABS(C0)>1 THEN RETURN ELSE RETURN 
2113 ! IF B9$=" " OR B$(1,1)=B9$ THEN GOTO 2115 ELSE CALL "ZZPROM",".Y",X3$,S3,"Change type?","","",0; IF S3=0 THEN GOTO 2114 ELSE B$(1,1)=B9$; GOTO 2110
2114 PRINT_ON_INV$=B$(6,1); B9$=B$(1,1); GOSUB 6800; B$(1,1)=B9$; PERFORM "ARGEAJ"; GOTO 2140
2115 ! IF ABS(C0)=2 THEN GOTO 2110 ELSE IF Y<0 THEN IF U=0 AND C0<0 AND (ABS(C0)=2 OR ABS(C0)=4 OR INT(ABS(C0))=3) THEN C7=1,J7=8; RUN "AR2EAL"
2117 ON POS(B$(1,1)=B8$) GOTO 2110,2119,2140,2140,2137,2135,2138,2110
2119 IF POS(" "<>B$(50,4))<>0 THEN GOTO 2140 ELSE B$(50,4)="M",X0=X0+1; FIND (Z[6],KEY="U/M"+B$(50,4),DOM=2120)IOL=0390
2120 GOSUB 7900; GOSUB 6200; GOTO 2140
2135 GOTO 2140
2137 PERFORM "ARGEAJ"; GOTO 2140 ! X3$,X4$,B$,B{ALL},D7,H$,J0,G$,2,W$,M5$; GOTO 2140
2138 B$(55,10)=A$(15,10); GOTO 2140
2140 GOSUB 6900
2143 REFRESH_FLG=1
2145 RETURN ! GOTO 2020
2150 REM "Desc
2151 DESC_ENTRY:
2159 IF D5$="*" THEN D5$=""; ON C0 GOTO 2160,2161
2160 IF POS(B$(1,1)="IC")=0 THEN B$(7,40)=TF_DESC$ ! CALL "ZZENTR","S",B{ALL},B$,X4$,X3$,39,8,7,40,C0,"","{3"+X$,"","AR2EAM04","","",""; IF ABS(C0)>4 THEN GOSUB 6500
2190 RETURN ! GOTO 2020
2200 REM "Product code
2201 PROD_CODE_ENTRY:
2202 IF B$(1,1)="M" THEN RETURN ! GOTO 2020
2205 IF D5$<>"*" THEN IF B$(1,1)="F" THEN X0=X0+7; RETURN ELSE IF B$(1,1)="I" OR B$(1,1)="C" THEN X0=X0+4; RETURN 
2209 IF D5$="*" THEN D5$="" ! ON C0 GOTO 2210,2211
2210 B$(3,3)=PROD_CODE$ ! CALL "ZZENTR","SUZ",B{ALL},B$,X4$,X3$,11,8,3,3,C0,"","{3"+X$,"T","AR2EAM06","FMPP","X",""; IF ABS(C0)=102 THEN J7=3; RUN "AR2EAN" ELSE IF ABS(C0)>4 THEN GOSUB 6500
2220 FIND (Z[2],KEY="T"+B$(3,3),DOM=2210)IOL=0340
2225 ! PRINT @(30,22),D$(5,15),
2230 B$(75,9)=D$(24,9)
2235 FIND (Z[12],KEY=B$(75,9),DOM=2236)IOL=0370
2236 SALES_DIST_CODE$=B$(75,9) ! CALL "ZZDISP","A",B$(75,9),"ARV",X3$,"","",17,14,X4$; PRINT @(J0-6,14),G$(10,17),
2237 GOSUB 8100
2239 IF C0=1 THEN IF POS(B$(1,1)="ICF")=0 THEN X0=X0+3 ELSE X0=X0+4
2240 RETURN ! GOTO 2020
2250 REM "Qty ordered
2251 QTY_ORD_ENTRY:
2255 IF POS(B$(1,1)="NICLFS")=0 THEN RETURN ! GOTO 2020
2256 IF B$(1,1)="S" AND E$(61,1)="Y" THEN RETURN ! GOTO 2020
2257 DIM K[1]; K[0]=B[0]/D7 ! GOSUB 8700
2258 IF D5$="*" THEN D5$=""; ON C0 GOTO 2259,2261
2259 IF A$(77,1)="C" THEN X$="This is a Credit Memo - enter a negative order amount!"
2260 K[0]=QTY_ORDERED ! CALL "ZZENTR","N.X",K{ALL},B$,X4$,X3$,12,10,0,822,C0,M0$,"{3"+X$,"","AR2EAM08","","",""; IF ABS(C0)>4 THEN GOSUB 6500
2264 B[0]=K[0]*D7
2265 IF B[1]=0 THEN B[1]=B[0]
2270 IF ABS(C0)=4 THEN C0=C0/4
2273 GOSUB 7850
2275 GOSUB 7600
2290 RETURN ! GOTO 2020
2300 REM "Qty shipped
2301 QTY_SHIP_ENTRY:
2305 IF POS(B$(1,1)="NICFS")=0 THEN RETURN ! GOTO 2020
2306 IF B$(1,1)="S" AND E$(61,1)="Y" THEN RETURN ! GOTO 2020
2307 DIM K[1]; K[1]=B[1]/D7
2309 IF D5$="*" THEN D5$=""; ON C0 GOTO 2310,2311
2310 K[1]=QTY_SHIPPED ! CALL "ZZENTR","N.X",K{ALL},B$,X4$,X3$,27,10,1,822,C0,M0$,"{3"+X$,"","AR2EAM10","","",""; IF ABS(C0)>4 THEN GOSUB 6500
2314 B[1]=K[1]*D7
2320 GOSUB 7850
2325 GOSUB 7600
2340 RETURN ! GOTO 2020
2350 REM "Price
2351 PRICE_ENTRY:
2352 IF P3$(21,1)="Y" OR POS(B$(1,1)="NICFS")=0 OR B$(89,1)="9" THEN RETURN ! GOTO 2020
2353 IF B$(1,1)="S" AND E$(61,1)="Y" THEN RETURN ! GOTO 2020
2354 IF FMPD4=0 THEN GOTO 2359
2355 IF B[2]>=B[3]+(B[3]*FMPD4/100) THEN GOTO 2359 ELSE B[2]=B[3]+(B[3]*FMPD4/100)
2357 REM GOSUB 7800
2359 IF D5$="*" THEN D5$=""; ON C0 GOTO 2360,2361
2360 PRECISION M5[1]; B[2]=UNIT_SELL_PRICE ! CALL "ZZENTR","N&",B{ALL},B$,X4$,X3$,42,10,2,M5[0],C0,M5$,"{3"+X$,"","AR2EAM12","","",""; PRECISION 2; IF ABS(C0)>4 THEN GOSUB 6500
2380 GOSUB 7600
2390 RETURN ! GOTO 2020
2400 REM "U/M
2401 UM_ENTRY:
2406 O0=B[6],O0$=B$(50,4)
2409 IF D5$="*" THEN D5$=""; ON C0 GOTO 2410,2411
2410 B$(50,4)=UNIT$ ! CALL "ZZENTR","SUX",B{ALL},B$,X4$,X3$,0,10,50,4,C0,"","{3"+X$,"U/M","AR2EAM14","U/M","X",""; IF ABS(C0)=102 THEN J7=9; RUN "AR2EAN" ELSE IF ABS(C0)>4 THEN GOSUB 6500
2412 FIND (Z[6],KEY="U/M"+B$(50,4),DOM=2410)IOL=0390
2415 GOSUB 7900
2440 RETURN ! GOTO 2020
2450 REM "Cost
2451 COST_ENTRY:
2453 IF SEC$(63,1)="Y" THEN RETURN ! GOTO 2020
2455 IF P3$(21,1)="Y" OR POS(B$(1,1)="NICFS")=0 OR B$(89,1)="9" THEN RETURN ! GOTO 2020
2456 IF B$(1,1)="S" AND E$(61,1)="Y" THEN RETURN ! GOTO 2020
2459 IF D5$="*" THEN D5$=""; ON C0 GOTO 2460,2461
2460 PRECISION M5[1]; B[3]=UNIT_COST ! CALL "ZZENTR","NX&",B{ALL},B$,X4$,X3$,42,11,3,M5[0],C0,M5$,"{3"+X$,"","AR2EAM16","","",""; PRECISION M5[1]; IF ABS(C0)>4 THEN GOSUB 6500
2470 GOSUB 7600
2472 IF FMPD4=0 THEN GOTO 2490; REM " SSP 161760                               
2473 IF B[2]>=B[3]+(B[3]*FMPD4/100) THEN GOTO 2480 ELSE B[2]=B[3]+(B[3]*FMPD4/100); REM " SSP 161760                                                     
2476 GOSUB 7600
2490 RETURN ! GOTO 2020
2500 REM "Extend amount
2501 EXT_AMT_ENTRY:
2502 IF P3$(21,1)="Y" THEN GOTO 2504
2503 IF B$(1,1)<>"S" OR E$(61,1)<>"Y" THEN RETURN ! GOTO 2020
2504 IF D5$="*" THEN D5$=""; ON C0 GOTO 2509,2511
2505 IF FMPD4=0 THEN GOTO 2507
2506 IF B[4]<B[5]+(B[5]*FMPD4/100) THEN B[4]=B[5]+(B[5]*FMPD4/100); REM " SSP 161760
2509 IF A$(77,1)="C" THEN X$="This is a Credit Memo - enter a negative extension amount!"
2510 B[4]=SELL_PRICE_EXT ! CALL "ZZENTR","N",B{ALL},B$,X4$,X3$,54,10,4,822,C0,M0$,"{3"+X$,"","AR2EAM18","","",""; IF ABS(C0)>4 THEN GOSUB 6500
2520 GOSUB 7636
2530 GOSUB 8600
2540 RETURN ! GOTO 2020
2550 REM "Total cost
2551 TOT_COST_ENTRY:
2553 IF SEC$(63,1)="Y" THEN RETURN ! GOTO 2020
2555 IF P3$(21,1)="Y" THEN GOTO 2559
2556 IF B$(1,1)<>"S" OR E$(61,1)<>"Y" THEN RETURN ! GOTO 2020
2559 IF D5$="*" THEN D5$=""; ON C0 GOTO 2560,2561
2560 B[5]=COST_EXT ! CALL "ZZENTR","N",B{ALL},B$,X4$,X3$,54,11,5,822,C0,M0$,"{3"+X$,"","AR2EAM20","","",""; IF ABS(C0)>4 THEN GOSUB 6500
2562 IF FMPD4=0 THEN GOTO 2570; REM " SSP 161760                               
2563 IF B[4]>B[5]+(B[5]*FMPD4/100) THEN GOTO 2570 ELSE B[4]=B[5]+(B[5]*FMPD4/100); REM "SSP 161760                                                       
2570 GOSUB 7636
2575 GOSUB 8600
2590 RETURN ! GOTO 2020
2600 REM "Taxable?
2601 TAXABLE_ENTRY:
2605 REM "IF B$(2,1)="Y" THEN GOTO 02020
2606 REM "IF C$(245,1)="Y" THEN GOTO 02020
2609 IF D5$="*" THEN D5$=""; ON C0 GOTO 2610,2611
2610 B$(54,1)=TAXABLE$ ! X$="For non-exempt customers, Y=yes, N=no, C=yes, but at 1/2 rate, F=tax as freight"; CALL "ZZENTR","SRU",B{ALL},B$,X4$,X3$,77,14,54,1,C0,"","{3"+X$,"YNCF","AR2EAM22","","",""; IF ABS(C0)>4 THEN GOSUB 6500
2640 RETURN ! GOTO 2020
2650 REM "Item code
2651 ITEM_CODE_ENTRY:
2652 U=1
2655 IF POS(B$(1,1)="NFICS")=0 THEN DIM E[20]; B$(55,20)=""; RETURN ! GOTO 2020
2660 PERFORM "ARGEAI" ! RUN "ARGEAI"
2690 RETURN ! GOTO 2020
2700 REM "Sale dist
2701 SALES_DIST_ENTRY:
2709 IF D5$="*" THEN D5$=""; ON C0 GOTO 2710,2711
2710 B$(75,9)=SALES_DIST_CODE$ ! CALL "ZZENTR","AUX",B{ALL},B$,X4$,X3$,17,14,75,9,C0,"ARV","{3"+X$,"","AR2EAM25","ARV","X",""; IF ABS(C0)=102 THEN J7=4; RUN "AR2EAN" ELSE IF ABS(C0)>4 THEN GOSUB 6500 ELSE IF ABS(C0)=2 THEN GOTO 2020
2730 FIND (Z[12],KEY=B$(75,9),DOM=2710)IOL=0370
2731 ! PRINT @(J0-6,14),G$(10,17),
2740 RETURN ! GOTO 2020
2750 REM "Qty per unit
2751 QTY_PER_ENTRY:
2755 IF B$(1,1)="L" OR P3$(20,1)="Y" THEN RETURN ! GOTO 2020
2756 O0=B[6],O0$=B$(50,4)
2759 IF D5$="*" THEN D5$=""; ON C0 GOTO 2760,2761
2760 B[6]=QTY_PER_UNIT ! CALL "ZZENTR","NX&",B{ALL},B$,X4$,X3$,5,10,6,600,C0,"#####0","{3"+X$,"","AR2EA25","","",""; IF ABS(C0)>4 THEN GOSUB 6500
2765 GOSUB 7925
2790 RETURN ! GOTO 2020
2800 REM "AR2EAW overlay
2810 RUN "AR2EAW"
3000 REM "Commission code
3001 COMM_CODE_ENTRY:
3005 IF POS(H$(32,1)="L ")=0 THEN GOTO 3040
3009 IF D5$="*" THEN D5$=""; ON C0 GOTO 3010,3011
3010 B$(84,5)=COMM_CODE$ ! CALL "ZZENTR","SZ",B{ALL},B$,X4$,X3$,17,13,84,5,C0,"","{3"+X$,"","AR2EAM11","AR4","X",""; IF ABS(C0)=102 THEN J7=5; RUN "AR2EAN" ELSE IF ABS(C0)>4 THEN GOSUB 6500
3020 FIND (Z[8],KEY=B$(84,5),DOM=3010)IOL=0380
3025 ! PRINT @(23,13),H$(6,19),
3030 GOSUB 8600
3040 RETURN ! GOTO 2020
3050 REM "Commission amount
3051 COMM_AMT_ENTRY:
3055 IF POS(H$(32,1)="L ")=0 THEN GOTO 3090
3059 IF D5$="*" THEN D5$=""; ON C0 GOTO 3060,3061
3060 B[7]=COMM_AMT ! CALL "ZZENTR","NX",B{ALL},B$,X4$,X3$,68,13,7,621,C0,M1$,"{3"+X$,"","AR2EAM13","","",""; IF ABS(C0)>4 THEN GOSUB 6500
3090 RETURN ! GOTO 2020
3100 REM "Print line?
3101 PRINT_LINE_ENTRY:
3105 IF B[4]<>0 THEN B$(6,1)="Y"; PRINT_ON_INV$="Y"; RETURN ! GOTO 2020
3109 IF D5$="*" THEN D5$=""; ON C0 GOTO 3110,3111
3110 B$(6,1)=PRINT_ON_INV$ ! CALL "ZZENTR","Y",B{ALL},B$,X4$,X3$,12,11,6,1,C0,"","{3"+X$,"","AR2EAM21","","",""; IF ABS(C0)>4 THEN GOSUB 6500
3140 RETURN ! GOTO 2020
3150 REM "GP Adjust
3151 GP_ADJ_ENTRY:
3153 IF SEC$(63,1)="Y" THEN RETURN ! GOTO 2020
3155 X$="(BEFORE Load)  Enter % of cost with F2 key"; IF POS(B$(1,1)="CI")>0 THEN IF E[20]<>0 THEN X$="Std cost = "+STR(E[20]:M1$)+"/"+E$(124,4)+"/"+STR(E[15])+"   "+X$
3159 IF D5$="*" THEN D5$=""; ON C0 GOTO 3160,3161
3160 B[8]=GP_ADJ_B4_LOAD ! CALL "ZZENTR","NFX",B{ALL},B$,X4$,X3$,50,13,8,621,C0,M1$,"{3"+X$,"","AR2EAM23","","",""
3162 IF C0=11 THEN GOSUB 8150
3165 IF ABS(C0)>10 THEN GOTO 3160 ELSE IF ABS(C0)>4 THEN GOSUB 6500
3170 GOSUB 8600
3190 RETURN ! GOTO 2020
3200 REM "Order type
3201 ORD_TYPE_ENTRY:
3205 X$="Order type: N=new, R=repeat, blank=other"
3210 B$(111,1)=ORD_TYPE$ ! CALL "ZZENTR","SRU",B{ALL},B$,X4$,X3$,51,14,111,1,C0,"","{3"+X$,"NR ","AR2EAM67","","",""; IF ABS(C0)>4 THEN GOSUB 6500
3240 RETURN ! GOTO 2020
3250 REM "Sales tax code, if different
3251 STAX_CODE_ENTRY:
3255 X$="Sales tax code if different from invoice header"
3260 B$(125,10)=STAX_CODE$ ! CALL "ZZENTR","AU",B{ALL},B$,X4$,X3$,59,14,125,10,C0,"AR5","{3"+X$,"","AR2EAM69","","",""; IF ABS(C0)>4 THEN GOSUB 6500
3290 RETURN ! GOTO 2020
5000 REM "LINE LINE Z0 TO LINE Z1
5010 Q=(Z0-1)*Y9+1; IF Q>LEN(Y$) OR Q<1 THEN GOTO 5090 ELSE Z9=DEC(Y$(Q,Y9))
5012 Q=(Z1-1)*Y9+1; IF Q>LEN(Y$) OR Q<1 THEN Z8=-1 ELSE Z8=DEC(Y$(Q,Y9))
5015 READ (F,IND=Z9)IOL=0310
5020 IF Z1>LEN(Y$)/Y9 THEN Z8=-1
5030 IF A<>Z8 THEN A=Z8; WRITE (F,IND=Z9)IOL=0311
5095 RETURN 
6200 REM "PRINT ONE ENTRY
6210 CALL "ARGEAJ",X3$,X4$,B$,B{ALL},D7,H$,J0,G$,0,W$,M5$
6290 RETURN 
6295 CALL "ARGEAJ",X3$,X4$,B$,B{ALL},D7,H$,J0,G$,1,W$,M5$
6296 RETURN 
6500 REM "RE-DO SCREEN
6505 D5$="*"; RUN "ARGEAL"
6800 REM "Setup new line"
6820 DIM B$(289),B[20],P3$(40),P[1],H$(100),H[15],W$(150)
6825 B$(54,1)="Y",B$(6,1)="Y"; IF C9$="S" THEN B$(54,1)="" ELSE IF A$(115,1)="Y" THEN B$(54,1)="N"
6840 C3$="*"+B$(1,1)+X3$(9,3)+A$(128,5); REM "'*'= no p/o code processing
6845 CALL "AR2COM",ERR=6846,"DEFAULT",C3$,C{ALL},Z[6],0,0
6848 B$(84,5)=C3$
6850 FIND (Z[8],KEY=B$(84,5),DOM=6851)IOL=0380
6890 RETURN 
6900 REM "Default comm code
6910 REM IF A<>-1 OR POS(" "<>A$(128,5))>0 THEN RETURN
6920 S3=POS(B$(1,1)="FICNS"); IF S3=0 THEN RETURN 
6925 C3$="*"+B$(1,1)+X3$(9,3)+A$(128,5); REM "'*' means no p/o processing
6930 DIM EXTRA[20]; CALL "AR2COM","DEFAULT",C3$,C{ALL},Z[6],0,0,"",A{ALL},B{ALL},EXTRA{ALL}
6935 B$(84,5)=C3$
6940 COMM_CODE$=B$(84,4) ! PRINT @(17,13),B$(84,5),
6945 RETURN 
6950 REM "Clear data fields except B$(1,1)
6960 ! PRINT @(50,6),'CL',@(0,8),'CL',@(0,10),'CL',@(12,11),'CL',@(17,13),'CL',@(17,14),'CL','SB',@(36,11),"Cost:",@(43,13),"GP Adj:",@(62),"Comm:",@(41,14),"Ord type:",@(54),"STC:",@(72),"Tax?",'SF',
6965 ! DIM C2$(20); PRINT @(19,6),C2$,
6990 RETURN 
7005 J7=9; RUN "ARGEAL"
7105 IF X0<=0 THEN X0=1
7110 X[0]=X0; GOTO 1125
7410 Q=INT(Q/Y9),L0=Q,L1=A4
7440 GOSUB 6300
7490 RETURN 
7510 CALL "ARGEAO",X3$,X4$,A$,P1$,0
7515 RETURN 
7609 REM "/ b4 * for unfixed type UM's, after * for fixed UM's
7610 IF P3$(21,1)<>"Y" THEN IF B[6]<>0 THEN IF P3$(20,1)="Y" THEN B[4]=B[1]*B[2]/B[6],B[5]=B[1]*B[3]/B[6] ELSE B[4]=B[1]/B[6]*B[2],B[5]=B[1]/B[6]*B[3]
7615 IF POS(B$(1,1)="IC")>0 THEN IF E[20]<>0 THEN CALL "FM2EXT",Z[6],0,E$(124,4),E[15],B[1],E[20],S3,0; B[8]=B[5]-S3
7620 GOSUB 8600
7625 TOTCOST=B[5]; IF SEC$(63,1)<>"Y" THEN GOTO 7626 ELSE TOTCOST=O
7635 SELL_PRICE_EXT=B[4],COST_EXT=TOTCOST
7636 B=B[4]-B[5],GP=B; IF SEC$(63,1)<>"Y" THEN GOTO 7637 ELSE GP=0
7637 ! PRINT @(69,10),GP:M1$,
7638 IF SEC$(63,1)="Y" THEN GOTO 7640
7639 ! IF B[4]<>0 THEN PRINT @(72,11),B*100/ABS(B[4]):"-###.00%",
7640 RETURN 
7710 B$(7,40)=E$(21,40),B$(3,3)=E$(61,3),B$(50,4)=E$(120,4),B$(93,18)=E$(64,18)
7715 B[2]=E[0],B[3]=E[17],B[6]=E[14],D7=E[14]
7720 DIM D$(40); FIND (Z[2],KEY="T"+B$(3,3),DOM=7721)IOL=0340
7725 B$(75,9)=D$(24,9)
7730 FIND (Z[12],KEY=B$(75,9),DOM=7731)IOL=0370
7735 GOSUB 8100
7780 GOSUB 6200
7790 RETURN 
7800 PRICE_BREAK:
7803 CALL "*WINGRP;HIDE",LINE.GRP$; CALL "*WINGRP;SHOW",QTY_B.GRP$
7804 FOR XX9=0 TO 10; LIST_BOX LOAD PRICE_BREAK.CTL,0,*; NEXT XX9
7805 IF POS(B$(1,1)="IC")=0 OR (Q[1]=0 AND E[1]=0) THEN RETURN 
7806 GOSUB 8500
7808 IF E[14]=0 THEN D8=100 ELSE D8=B[6]*100/E[14]
7810 ! PRINT @(0,17),'CE','SB',@(11,17),"Base price:",@(14,18),"Quantity",@(34,18),"Price",
7812 ! IF E[5]<>0 THEN PRINT @(52,18),"Quantity",@(72,18),"Price",
7815 LIST_BOX LOAD PRICE_BREAK.CTL,0,STR(E[0]*D8/100:M1$)+SEP+""+SEP+""
7817 I5=11,I6=18
7820 FOR I=1 TO 11 STEP 2
7825 I6=I6+1; IF I6>21 THEN I6=19,I5=49
7830 IF Q[I]=0 THEN EXITTO 7840 ELSE LIST_BOX LOAD PRICE_BREAK.CTL,0,""+SEP+STR(Q[I]/D7:M0$)+SEP+STR(Q[I+1]*D8/100:M1$)
7835 NEXT I
7840 RETURN 
7855 IF B$(89,1)="9" OR POS(B$(1,1)="IC")=0 OR (Q[1]=0 AND E[1]=0) THEN E9=E[0]; GOTO 7882
7858 IF E[14]=0 THEN D8=100 ELSE D8=B[6]*100/E[14]
7860 IF B[0]>B[1] THEN B2=B[0] ELSE B2=B[1]
7864 REM IF B2<=E(1) THEN LET B(2)=E(0)/D8; GOTO 7880
7865 FOR I=1 TO 11 STEP 2
7870 IF Q[I]=0 OR Q[I]>B2 THEN B[2]=Q[I-1]*D8/100; EXITTO 7880
7875 NEXT I
7876 B[2]=Q[12]*D8/100
7880 E9=B[2]
7882 IF POS(X3$(9,3)="049500",3)>0 AND NUM(C$(398,3),ERR=7883)>0 THEN B[2]=E9*(100-NUM(C$(398,3)))*.01 ! PRINT @(0,22),'CL',"Customer Discount% = ",NUM(C$(398,3)),"  List Price is: ",E9:M0$
7885 UNIT_SELL_PRICE=B[2]
7890 RETURN 
7910 IF POS(" "<>O0$)=0 OR O0$=B$(50,4) THEN GOTO 7960
7925 P3=0,P4=1
7930 FIND (Z[6],KEY="U/M"+O0$,DOM=7931)P4$,P3,P4
7933 IF P4$(20,1)<>"Y" THEN IF B$(1,1)<>"N" THEN P1=E[14]; GOTO 7936
7935 IF P3>1 THEN P1=P3 ELSE P1=P4
7940 IF P3$(20,1)<>"Y" THEN P2=B[6] ELSE IF P[0]>1 THEN P2=P[0] ELSE P2=P[1]
7960 IF P3$(20,1)="Y" THEN IF P[0]<>0 THEN B[6]=P[0] ELSE B[6]=P[1]
7965 IF B[6]=0 THEN B[6]=1
7970 GOSUB 8500
7980 GOSUB 8550
7990 RETURN 
8010 IF A0<=0 THEN GOTO 8090 ELSE A[1]=0,A[11]=0; IF A0=0 THEN GOTO 8090
8020 FOR X=1 TO LEN(Y$) STEP Y9
8030 READ (F,IND=DEC(Y$(X,Y9)))IOL=0310
8040 A[1]=A[1]+B[4],A[11]=A[11]+B[5]
8050 NEXT X
8090 RETURN 
8100 REM "Set taxable to N if never taxed
8102 IF C9$="S" THEN B$(54,1)="" ELSE IF A$(115,1)="Y" THEN B$(54,1)="N"
8105 ON POS(D$(23,1)="NC") GOTO 8130,8110,8120
8110 B$(54,1)="N"; GOTO 8130
8120 IF B$(54,1)="Y" THEN B$(54,1)="C"
8130 PRINT @(77,14),B$(54,1),
8135 IF ARS$(122,1)="Y" THEN FIND (Z[15],KEY=A$(133,4)+B$(3,3),DOM=8136)ASQ$; FIND (Z[8],KEY=ASQ$(8,5),DOM=8136)IOL=0380; B$(84,5)=ASQ$(8,5); COMM_CODE$=B$(84,5) ! REM "WO89451
8140 RETURN 
8150 REM "GP ADJ
8160 B[8]=B[8]*B[5]*.01,C0=1
8190 RETURN 
8300 REM 
8310 ON FPT(C0)*10 GOTO 8350,8320,8330,8350
8320 IF V8$="" THEN X0=X0+4; GOTO 8350 ELSE X0=NUM(V8$(POS(STR(X0:"00")<=V8$,2),2)); GOTO 8350
8330 IF V8$="" THEN X0=X0-6; GOTO 8340 ELSE X0=POS(STR(X0-1:"00")<=V8$,2)-2; IF X0<0 THEN X0=0; GOTO 8350 ELSE X0=NUM(V8$(X0,2)); GOTO 8350
8340 IF X0<0 THEN X0=0; GOTO 8350
8350 C0=3; RETURN 
8500 REM "Set D7 for quantities
8501 REM "Assumes IOLIST 390 has been read in properly
8505 IF P3$(20,1)="Y" THEN D7=P[1] ELSE D7=B[6]
8510 IF D7=0 THEN D7=1
8540 RETURN 
8550 REM "Adjust price if u/m changed
8555 IF O0=0 OR O0=B[6] THEN GOTO 8580
8560 PRECISION M5[1]; B[2]=B[2]*B[6]/O0,B[3]=B[3]*B[6]/O0; PRECISION 2
8580 GOSUB 6295
8585 GOSUB 7600
8590 RETURN 
8600 REM "Calculate commission
8605 IF H$(32,1)<>"L" THEN B[7]=0; GOTO 8630
8607 IF H$(31,1)="T" THEN Q=0; IF POS(B$(1,1)="IC")>0 THEN CALL "FM2EXT",Z[6],0,B$(50,4),B[6],B[1],E9,Q,2 ELSE Q=(B[5]-B[8])/.6
8611 X$="  "+B$(112,4)+"[X3$B]"+X3$+"[X3$E]"+"[A$]"+A$+"[B$]"+B$
8613 DIM EXTRA[20]; CALL "AR2COM",ERR=8614,X$,H$,H{ALL},Q,B[4],B[5]-B[8],"",A{ALL},B{ALL},EXTRA{ALL}
8614 IF H$(31,1)="A" THEN B$(137,1)=%BRACKET$ ELSE B$(137,1)=" " END_IF ; REM %BRACKET$="",%LAST_RATE=0; REM " SSP# 166575 - HAVE %LAST_RATE HERE      
8615 B[7]=Q
8616 IF H$(31,1)="A" THEN B$(141,5)=%ALL_BRACKET$(1,LEN(%ALL_BRACKET$)) ELSE B$(141,5)="     " END_IF ; %ALL_BRACKET$=""
8617 IF H$(31,1)<>"A" AND A$(133,4)<>DIM(4) THEN B[16]=%LAST_RATE
8618 IF H$(31,1)<>"A" AND A$(137,4)<>DIM(4) THEN B[17]=%LAST_RATE
8619 IF H$(31,1)<>"A" AND A$(141,4)<>DIM(4) THEN B[18]=%LAST_RATE
8620 IF H$(31,1)<>"A" AND A$(145,4)<>DIM(4) THEN B[19]=%LAST_RATE
8621 IF H$(31,1)<>"A" AND A$(149,4)<>DIM(4) THEN B[20]=%LAST_RATE
8630 PRINT @(50,13),B[8]:M1$,@(68,13),B[7]:M1$,
8640 RETURN 
8700 REM "PRICING TABLE
8701 QTY_BREAK:
8705 IF POS(B$(1,1)="IC")=0 THEN GOTO 8740
8710 DIM Q[35]; FOR I=1 TO 12; Q[I]=E[I]; NEXT I; Q[0]=E[0]
8720 IF POS(" "<>E$(109,3))>0 AND POS(" "<>C$(398,3))>0 THEN X$="~"+E$(109,3)+C$(398,3)+E$(1,20); CALL "IC2ICF",X3$,Z[2],X$,E[14],E[15],E[14],E[0],E[18],E[17],E[20],Q{ALL}
8730 GOSUB 7800
8740 RETURN 
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,"AR2EAM",Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6500
9520 ON C9 GOTO 1140,2040
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 BEGIN ; SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 REM "188524-GUI is writing the ART record out short.  144 bytes         
56002 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
