0010 REM "WMS Order Picking Header Selection<RFGPH0"
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 08/14/22 - 17.350833 - crg - SSP# 307416
0037 REM "307416-DBD-256 Enhance WMS picking templates                       
0040 REM "Copyright 2022 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT
0100 SETERR 9000
0110 X0$="RFGPH0",X1$="WMS Order Picking Selection"
0120 EOL$=$0D0A$; EOL$=ATH(STP(EC_PARM$(57,8),1))
0127 HTML_TEXT$="Content-type: text/html"
0140 DIM MESS_INFO$[20] ! ,EC_PARM$(1275)(1275)
0230 DIM ESY$(512)
0240 DIM ECC$(1984),ECC[3]
0250 DIM ESZ$(128),ESZ[18]
0330 IOLIST ESY$
0340 IOLIST ECC$,ECC[0],ECC[1],ECC[2]
0350 IOLIST ESZ$,ESZ[0],ESZ[1],ESZ[2],ESZ[3],ESZ[4],ESZ[5],ESZ[6],ESZ[7],ESZ[8],ESZ[9],ESZ[10],ESZ[11],ESZ[12],ESZ[13],ESZ[14],ESZ[15],ESZ[16],ESZ[17],ESZ[18]
0370 IOLIST ZW2$,ZW2[0],ZW2[1],ZW2[2]
0380 IOLIST ZW9A$,ZW9B$
0400 IOLIST ZW7A$,ZW7B$
0410 IOLIST ZW8A$
0500 REM "Open files
0502 CLOSE (13); OPEN (13)"ZZPARM"
0505 DIM Z[NUM(X3$(60,3))],BLGRBNKS$(100)
0510 Z$="01O RF2...  02O RF0...  03O RFS...  04O AR1...  05O RF3...  09O RFB...  10O FS1...  11O FS2...  12O IC1...  13O ZZPARM  14O IC0...  16O RFZ...  17O PO3...  18O FMP...  19O ICF...  20O RFS...  22O FM1...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0550 RF2=Z[1],RF0=Z[2],RFS=Z[3],RF3=Z[5],FS1=Z[10],FS2=Z[11],AR1=Z[4],IC1=Z[12],IC0=Z[14],RFS_2=Z[20]
0560 RFB=Z[9],RFZ=Z[16],PO3=Z[17],FMP=Z[18],ICF=Z[19],FM1=Z[22]
0900 PRINT_DOC=0
1000 REM "Process DATA array
1010 FOR I=1 TO NUM_ENTRIES
1015 TAG$=DATA$[I,0],TF_VALUE$=DATA$[I,1]
1050 SWITCH TAG$ ! 1185 end switch
1055 CASE "print_doc"
1057 PRINT_DOC=1; BREAK
1058 CASE "show_tags"
1059 SHOW_TAGS=1; BREAK
1060 CASE "task_num"
1062 TASK_NUM$=TF_VALUE$
1065 CASE "pick_cart"
1067 PICK_CART$=PAD(TF_VALUE$,10); BREAK
1080 CASE "template"
1082 TEMPLATE$=TF_VALUE$; BREAK
1100 CASE "ord_num"
1105 ORDER$=TF_VALUE$; BREAK
1985 END SWITCH ! 1050
1990 NEXT I
2000 ! process data
2015 MSG$=""
2020 SESSION_ID$=EC$[1](1,7)
2025 BUYER$=EC$[2](1,15),BASIC$="RFGPH0",TEMPLATE$="rfgph0.htm"
2040 WHSLIST$=""; CALL "UPDRFK;READBYKEY",Z[15],0,BUYER$,SEG2$,SEG3$,SEG4$,SEG5$,RFK$,RFK{ALL},FOUNDRFK; IF FOUNDRFK THEN WHSLIST$=RFK$(23,40) ! 248055 - Same fix as 217661
2050 CALL "UPDRF2;GETBINLIST",Z[1],"P",BINLIST$,BUYER$,WHSLIST$
2060 IF ORDER$="" AND RFK$(110,1)<>"Y" THEN MSG$="An Order Number Must Be Entered"; GOTO 3900 ! 204749
2100 IF TASK_NUM$="" THEN CALL "UPDRF0;GET_TASK",RF0,X3$,BUYER$,TASK_NUM$; CALL "UPDRFS;CHANGE_TASK",RFS,BUYER$,TASK_NUM$,PICK_CART$ ! user could have timed out: update old task number to new task number
2110 PICK_TYPE$=RFK$(18,1)
2120 MAX_ORD=1; IF NUM(RFK$(16,2),ERR=*NEXT)>0 THEN MAX_ORD=NUM(RFK$(16,2))
2125 MAX_ORD=1 ! not yet working
2200 IF ORDER$<>"" THEN {
2205 XP=POS("-"=ORDER$); IF XP=3 AND LEN(ORDER$)>3 THEN ORDER$=ORDER$(1,2)+PAD(ORDER$(4),6,0,"0")
2210 IF XP=0 THEN ORDER$=PAD(ORDER$,8,0,"0")
2240  }
2250 ! SSP268441 now write directly to RFS in FM2ODZ, RF3 obsolete CALL "UPDRFS;GET_FROM_RF3",RFS,RF3,FS1,FS2,IC1,IC0,RFB,RFZ,PO3,FMP,ICF ! build rfs
2300 SELECT_CART:
2320 IF PICK_CART$<>"" THEN {! 3895
2420 CALL "UPDRF2;EXTRACTBYKEY",Z[1],0,PICK_CART$,SEG2$,SEG3$,SEG4$,SEG5$,RF2$,RF2{ALL},FOUNDRF2,BUSYRF2; IF FOUNDRF2 THEN OK=1; IF BUSYRF2 THEN MSGPO1$="Cart/Pallet "+REC_BIN$+" Record is Busy",OK=0 ELSE IF RF2$(11,1)="P" AND RF2$(12,15)<>BUYER$ THEN MSGPO1$="Cart/Pallet "+REC_BIN$+" is Being accessed from Buyer "+RF2$(12,15),OK=0
2422 IF FOUNDRF2 AND NOT(OK) THEN CALL "UPDRF2;CLEAR_LOCK",Z[1] ELSE IF FOUNDRF2 AND OK THEN RF2$(1,10)=PICK_CART$,RF2$(11,1)="P",RF2$(12,15)=BUYER$; CALL "UPDRF2;UPDATE",Z[1],RF2$,RF2{ALL},BUSYRF2
2450 IF NOT(OK) THEN {! 2470 }
2460 MSG$=MSGPO1$
2470  } ELSE {! 3885
2500 ! get orders
2510 NUM_ORD=0
2520 IF ORDER$="" THEN CALL "UPDRFS;READBYKEY",RFS,2,DIM(10),SEG2$,SEG3$,SEG4$,SEG5$,RFS$,RFS{ALL},FOUNDRFS ELSE CALL "UPDRFS;READBYKEY",RFS,0,ORDER$,SEG2$,SEG3$,SEG4$,SEG5$,RFS$,RFS{ALL},FOUNDRFS
2525 CALL "UPDRFS;READNEXT",RFS,RFS$,RFS{ALL},FOUNDRFS; IF NOT(FOUNDRFS) THEN MSG$="No Orders to Pick"; ELSE CALL "UPDFS1;READBYKEY",FS1,0,RFS$(1,8),SEG2$,SEG3$,SEG4$,SEG5$,FS1$,FS1{ALL},FOUNDFS1; IF FOUNDFS1 THEN IF FS1$(63,1)="P" AND RFK$(107,1)<>"Y" AND ORDER$="" THEN GOTO *SAME
2535 IF FOUNDRFS THEN {! 2549
2536 IF FOUNDFS1 THEN IF FS1$(63,1)="P" AND RFK$(107,1)<>"Y" AND ORDER$<>"" THEN FOUNDRFS=0,MSG$="Order is on Pick Hold"
2537 IF RFS$(43,10)<>DIM(10) AND RFS$(43,10)<>TASK_NUM$ AND ORDER$="" THEN FOUNDRFS=0,MSG$="No Orders to Pick"
2540 IF RFS$(1,8)<>ORDER$ AND ORDER$<>"" THEN FOUNDRFS=0,MSG$="Order is Not in Queue"
2545 IF RFS$(1,8)=ORDER$ AND ORDER$<>"" AND RFS$(43,10)<>DIM(10) AND RFS$(43,10)<>TASK_NUM$ THEN FOUNDRFS=0,MSG$="Order is being picked by "+RFS$(117,15)
2549  }
2550 IF NOT(FOUNDRFS) THEN {
2560 TEMPLATE$="rfgph0.htm"
2570 RF2$(12,15)=DIM(15),RF2$(11,1)=" "; CALL "UPDRF2;UPDATE",Z[1],RF2$,RF2{ALL},BUSYRF2
2580 CALL "UPDRF0;READBYKEY",RF0,0,TASK_NUM$,SEG2$,SEG3$,SEG4$,SEG5$,RF0$,RF0{ALL},FOUNDRF0; IF FOUNDRF0 THEN CALL "UPDRF0;DELETE",RF0,RF0$,RF0{ALL},FOUNDRF0,BUSYRF0
2585 TASK_NUM$=""
2590  }
2600 WHILE NUM_ORD<MAX_ORD AND FOUNDRFS ! 3850 wend
2610 SWITCH PICK_TYPE$ ! 3800 end switch
2620 CASE "W" ! wave
2695 BREAK
2700 CASE "Z" ! zone
2795 BREAK
2800 CASE "C" ! consolidator
2895 BREAK
3200 DEFAULT ! order
3210 CALL "UPDFS1;EXTRACTBYKEY",FS1,0,RFS$(1,8),SEG2$,SEG3$,SEG4$,SEG5$,FS1$,FS1{ALL},FOUNDFS1,BUSYFS1
3250 IF FOUNDFS1 THEN {! 3750}
3260 IF NOT(BUSYFS1) THEN {! 3700
3270 FS1$(63,1)="S" ! shipping flag
3310 RFS$(43,10)=TASK_NUM$,RFS$(117,15)=BUYER$; CALL "UPDRFS;UPDATE",RFS_2,RFS$,RFS{ALL},BUSY
3320 CALL "UPDRFS;READBYKEY",RFS_2,0,RFS$(1,8),SEG2$,SEG3$,SEG4$,SEG5$,RFS_2$,RFS_2{ALL},FOUNDRFS2
3330 CALL "UPDRFS;READNEXT",RFS_2,RFS_2$,RFS_2{ALL},FOUND_RFS2; IF FOUND_RFS2 THEN IF RFS_2$(1,8)<>RFS$(1,8) THEN FOUND_RFS2=0
3350 WHILE FOUND_RFS2 ! 3450
3360 RFS_2$(43,10)=TASK_NUM$,RFS_2$(117,15)=BUYER$
3365 RFS_2$(189,10)=RF2$(1,10)
3370 CALL "UPDRFS;UPDATE",RFS_2,RFS_2$,RFS_2{ALL},BUSYRFS_2
3440 CALL "UPDRFS;READNEXT",RFS_2,RFS_2$,RFS_2{ALL},FOUND_RFS2; IF FOUND_RFS2 THEN IF RFS_2$(1,8)<>RFS$(1,8) THEN FOUND_RFS2=0
3450 WEND ! 3350 while found_rfs2
3690 CALL "UPDFS1;UPDATE",FS1,FS1$,FS1{ALL},BUSYFS1
3695 NUM_ORD=NUM_ORD+1
3700  } ! 3260
3750  } ELSE {
3760 CALL "UPDRFS;DELETE",RFS,RFS$,RFS{ALL},FOUND,BUSY
3765 FOUNDRFS=0,TEMPLATE$="rfgph0.htm",MSG$="ORDER "+RFS$(1,8)+" is Not on File"
3780  }
3800 END SWITCH ! 2600
3845 IF FOUNDRFS THEN TEMPLATE$="rfgpd0.htm",BASIC$="RFGPD0"
3850 WEND ! 2600 while num_ord<max_ord and foundrfs
3885  } ! 2470
3895  } ! 2320
3900 DIM BYBINFO$[5]; BYBINFO$[1]=PGN,BYBINFO$[2]="180032.20060308",BYBINFO$[3]=TEMPLATE$,BYBOPTIONS$=""
4000 SWITCH TEMPLATE$
4010 CASE "rfgpd0.htm"
4020 PERFORM "RFGPDT;PROCESS_TEMPLATE_RFGPD0"
4050 BREAK
4100 DEFAULT 
4110 PERFORM "RFGPDT;PROCESS_TEMPLATE_RFGPH0"
4200 END SWITCH 
4900 GOTO 9900
5000 ! printdesc
5010 LINE$=TAG$+" "+TAGDESC$
5090 RETURN 
5100 ADD_MSG_TO_LOG:! Add message to log file
5110 MOUT$="SESSION ID|"+EC$[1](1,7)+"|FILE|"+%WEBEC_FILE_NAME$+"|WORKSHEET|"+ECD$(1,10)+"|LINE|"+ECE$(25,3)+"|MESSAGE NO|"+STR(MESSAGE_NO:"00000")+"|MESSAGE|"+MESSAGE$+"|"
5135 MX=FN%_LOG_MESSAGE("MESG",MOUT$)
5145 RETURN 
5149 ! 
5490 RETURN ! 5200
5500 REM create description html
5590 RETURN 
8150 BYB_PROCESSING:! Send LINE$ to EC3BYB for generic fields processing
8160 CALL "EC3BYB",ERR=8161,X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT,LINE$,BYBINFO${ALL},BYBOPTIONS$
8195 RETURN 
8910 DEF FND$(Z9$)=Z9$(3,2)+"/"+Z9$(5,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
9000 REM "ERROR PROCESSING
9002 J=ERR,K=TCB(5); SETERR 0000; ENDTRACE 
9010 LAST_WEBEC_ERR$="ERR: "+STR(J)+" AT: "+STR(K); LAST_WEBEC_ERR$=GBL("LAST_WEBEC_ERR",LAST_WEBEC_ERR$); REM "131928
9090 GOTO 9900
9900 REM "End
9905 CLOSE (100)
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9912 CLOSE (13,ERR=*NEXT)
9950 EXIT 
9999 END 
56000 REM "180032-Wireless Warehousing                                        
56002 REM "197945-WMS picking.  if zero pick or qty<ord                       
56004 REM "203997-WMS server is not responding during WMS picking             
56006 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
56008 REM "248055-WMS user can't get a pick cart if cart is assigned a whse
56010 REM "268441-WMS - Picking                                               
56011 REM "307416-DBD-256 Enhance WMS picking templates                       
