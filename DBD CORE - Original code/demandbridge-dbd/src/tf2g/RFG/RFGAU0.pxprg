0010 REM "WMS Purchase Order Put Away  Update <RFGAU0"
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 07/19/11 - 13.076111 - crg - SSP# 248055
0037 REM "248055-WMS user can't get a pick cart if cart is assigned a whse
0040 REM "Copyright 2011 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT
0100 SETERR 9000
0110 X0$="RFGAU0",X1$="WMS Purchase Order Put Away Update "
0120 EOL$=$0D0A$; EOL$=ATH(STP(EC_PARM$(57,8),1))
0127 HTML_TEXT$="Content-type: text/html"
0140 DIM MESS_INFO$[20] ! ,EC_PARM$(1275)(1275)
0230 DIM ESY$(512)
0240 DIM ECC$(1984),ECC[3]
0250 DIM ESZ$(128),ESZ[18]
0310 IOLIST AR$
0330 IOLIST ESY$
0340 IOLIST ECC$,ECC[0],ECC[1],ECC[2]
0350 IOLIST ESZ$,ESZ[0],ESZ[1],ESZ[2],ESZ[3],ESZ[4],ESZ[5],ESZ[6],ESZ[7],ESZ[8],ESZ[9],ESZ[10],ESZ[11],ESZ[12],ESZ[13],ESZ[14],ESZ[15],ESZ[16],ESZ[17],ESZ[18]
0370 IOLIST ZW2$,ZW2[0],ZW2[1],ZW2[2]
0380 IOLIST ZW9A$,ZW9B$
0400 IOLIST ZW7A$,ZW7B$
0410 IOLIST ZW8A$
0490 IOLIST R0$,W$,W[0],W[1],W[2],W[3],W[4]
0500 REM "Open files
0502 CLOSE (13); OPEN (13)"ZZPARM"
0505 DIM Z[NUM(X3$(60,3))],BLGRBNKS$(100)
0510 Z$="01O RF2...  02O RF1...  03O ZZS...  04O AP4...  05O RFP...  09O RFB...  10O PO1...  11O FTO...  12O PO2...  13O ZZPARM  14O FMN...  15O SM7...  16O PO6...  17O RFK...  18O FS2...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0525 RF1=Z[2],SM7=Z[15],PO6=Z[16],FTO=Z[11]
0530 ZZPARM=Z[13],RFK=Z[17],PO2=Z[12]
0540 ZZS=Z[3],FS2=Z[18]
0900 PRINT_DOC=0
1000 REM "Process DATA array
1010 FOR I=1 TO NUM_ENTRIES
1015 TAG$=DATA$[I,0],TF_VALUE$=DATA$[I,1]
1050 SWITCH TAG$ ! 1185 end switch
1055 CASE "print_doc"
1057 PRINT_DOC=1; BREAK
1058 CASE "show_tags"
1059 SHOW_TAGS=1; BREAK
1065 CASE "rec_bin"
1067 REC_BIN$=TF_VALUE$; BREAK
1080 CASE "template"
1082 TEMPLATE$=TF_VALUE$; BREAK
1985 END SWITCH ! 1050
1990 NEXT I
2000 ! process data
2015 MSG$=""
2020 SESSION_ID$=EC$[1](1,7)
2025 BUYER$=EC$[2](1,15),BASIC$="RFGAH0",TEMPLATE$="rfgah0.htm"
2320 IF REC_BIN$<>"" THEN {! 2895
2330 CALL "UPDRF1;READBYKEY",Z[2],1,REC_BIN$,SEG2$,SEG3$,SEG4$,SEG5$,RF1$,RF1{ALL},FOUNDRF1
2340 UPDATE=1
2350 CALL "UPDRF1;READNEXT",Z[2],RF1$,RF1{ALL},FOUNDRF1; IF FOUNDRF1 THEN IF RF1$(156,10)=REC_BIN$ THEN IF RF1$(195,1)="Y" OR RF1$(96,1)="Y" THEN GOTO *SAME ELSE UPDATE=0
2500 IF UPDATE THEN {! 2800 
2505 CALL "UPDRF2;READBYKEY",Z[1],0,REC_BIN$,SEG2$,SEG3$,SEG4$,SEG5$,RF2$,RF2{ALL},FOUNDRF2; IF FOUNDRF2 THEN RF2$(11,1)=" ",RF2$(12,15)=DIM(15); CALL "UPDRF2;UPDATE",Z[1],RF2$,RF2{ALL},BUSY
2510 IF X3$(145,1)="1" THEN CALL "ZZBATZ",X3$,X4$,"PO2MAG","WMS PO Receiving "+BUYER$ ! batch  # 
2515 CALL "UPDFTO;CHANGE_WMS_BATCH",RF1,FTO,X3$,REC_BIN$
2517 GOSUB ZZS_OVERRIDE
2520 CALL "UPDRF1;UPDATE_SM7",RF1,SM7,PO6,ZZPARM,PO2,FS2,X3$,REC_BIN$
2530 %WMS_RECV$="Y"
2550 CALL "SM2UAA",X3$,X4$,"SM7",REC_BIN$
2555 %WMS_RECV$=""
2590 X3$(174,4)=DIM(4)
2600 GOSUB RESET_FILES
2800  } ELSE {! 2890 }
2810 MSG$="All Items Have Not Been Put Away"
2820 BASIC$="RFGAD0",TEMPLATE$="rfgad0.htm"
2890  } ! 2800/2500
2895  } ! 2320
3000 DIM BYBINFO$[5]; BYBINFO$[1]=PGN,BYBINFO$[2]="180032.20060308",BYBINFO$[3]=TEMPLATE$,BYBOPTIONS$=""
4000 SWITCH TEMPLATE$
4010 CASE "rfgad0.htm"
4020 PERFORM "RFGRDT;PROCESS_TEMPLATE_RFGAD0"
4025 BREAK
4100 DEFAULT 
4120 WHSLIST$=""; CALL "UPDRFK;READBYKEY",RFK,0,BUYER$,SEG2$,SEG3$,SEG4$,SEG5$,RFK$,RFK{ALL},FOUNDRFK; IF FOUNDRFK THEN WHSLIST$=RFK$(23,40) ! 248055
4130 CALL "UPDRF2;GETBINLIST",Z[1],"R",BINLIST$,BUYER$,WHSLIST$
4150 IF BINLIST$="" THEN MSG$="No Receiving Cart/Pallets are Available"
4180 PERFORM "RFGRDT;PROCESS_TEMPLATE_RFGAH0"
4200 END SWITCH 
4900 GOTO 9900
5000 ! printdesc
5010 LINE$=TAG$+" "+TAGDESC$
5090 RETURN 
5100 ADD_MSG_TO_LOG:! Add message to log file
5110 MOUT$="SESSION ID|"+EC$[1](1,7)+"|FILE|"+%WEBEC_FILE_NAME$+"|WORKSHEET|"+ECD$(1,10)+"|LINE|"+ECE$(25,3)+"|MESSAGE NO|"+STR(MESSAGE_NO:"00000")+"|MESSAGE|"+MESSAGE$+"|"
5135 MX=FN%_LOG_MESSAGE("MESG",MOUT$)
5145 RETURN 
5149 ! 
5490 RETURN ! 5200
5500 REM create description html
5590 RETURN 
8150 BYB_PROCESSING:! Send LINE$ to EC3BYB for generic fields processing
8160 CALL "EC3BYB",ERR=8161,X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT,LINE$,BYBINFO${ALL},BYBOPTIONS$
8195 RETURN 
8910 DEF FND$(Z9$)=Z9$(3,2)+"/"+Z9$(5,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
9000 REM "ERROR PROCESSING
9002 J=ERR,K=TCB(5); SETERR 0000; ENDTRACE 
9010 LAST_WEBEC_ERR$="ERR: "+STR(J)+" AT: "+STR(K); LAST_WEBEC_ERR$=GBL("LAST_WEBEC_ERR",LAST_WEBEC_ERR$); REM "131928
9090 GOTO 9900
9900 REM "End
9905 CLOSE (100)
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9915 CLOSE (13)
9950 EXIT 
9999 END 
10000 ZZS_OVERRIDE:
10010 READ (ZZS,KEY="SM2RBA"+DIM(12),DOM=*NEXT)IOL=0310; IOL=490
10015 IF R0$="" THEN DIM R0$(128); R0$(1,3)="IP7",R0$(8,3)="NNN"
10020 IF R0$(2,2)="PP" THEN R0$(2,2)="P7" ! change to null printer if pp
10030 AR$=PAD(AR$,97); AR$(1,6)="SM2RBA",AR$(72,1)="N",AR$(80,1)="N",AR$(97,1)="N"
10035 AR$(81,15)=DIM(15)
10050 W$=DIM(39),T0=1,L0$="SM7   "
10055 T1$=L0$((T0-1)*6+1,6),K$=X3$(1,8)
10080 ZZP=UNT; OPEN (ZZP)"ZZP"; WRITE (ZZP,KEY=K$)X3$,X4$,T1$,R0$,W$,IOL=0310; CLOSE (ZZP)
10090 RETURN 
10098 ! 
10099 ! 
12000 RESET_FILES:
12005 FILE_NAME$="ECA",FSLOT=33004; GOSUB 12500
12010 FILE_NAME$="ECB",FSLOT=33005; GOSUB 12500
12020 FILE_NAME$="ECC",FSLOT=33006; GOSUB 12500
12030 FILE_NAME$="AR1",FSLOT=33007; GOSUB 12500
12040 FILE_NAME$="FM0",FSLOT=33008; GOSUB 12500
12050 FILE_NAME$="FMP",FSLOT=33009; GOSUB 12500
12060 FILE_NAME$="ECS",FSLOT=33010; GOSUB 12500
12070 FILE_NAME$="ECU",FSLOT=33011; GOSUB 12500
12080 FILE_NAME$="EDC",FSLOT=33012; GOSUB 12500
12090 FILE_NAME$="EDB",FSLOT=33015; GOSUB 12500
12100 FILE_NAME$="ZZPARM",FSLOT=33013; GOSUB 12530
12110 FILE_NAME$="ASP",FSLOT=33016; GOSUB 12500
12120 FILE_NAME$="AR2",FSLOT=33017; GOSUB 12500
12130 REM "do not use FSLOT 33018 - used in 6300 for process scheduling
12140 FILE_NAME$="ECE",FSLOT=33019; GOSUB 12500
12150 FILE_NAME$="ECZ",FSLOT=97; GOSUB 12500
12160 FILE_NAME$="ECY",FSLOT=99; GOSUB 12500
12190 RETURN 
12198 ! 
12199 ! 
12500 REM "Given FILE_NAME$ and FSLOT open file on fslot, try w/comp code, then without, if not able to open log message and leave
12520 CLOSE (FSLOT); OPEN (FSLOT,ERR=*NEXT)FILE_NAME$+X3$(9,3); GOTO 12535
12530 CLOSE (FSLOT); OPEN (FSLOT,ERR=*NEXT)FILE_NAME$; GOTO 12535
12590 RETURN 
12598 ! 
12599 ! 
56000 REM "180032-Wireless Warehousing                                        
56002 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
56004 REM "248055-WMS user can't get a pick cart if cart is assigned a whse
