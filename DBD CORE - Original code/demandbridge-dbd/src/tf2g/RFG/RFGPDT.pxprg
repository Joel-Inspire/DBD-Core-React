0010 REM "WMS Ship Confirmation Template Display <RFGPDT>"
0035 REM "5.7 - 08/14/22 - 17.818048 - crg - SSP# 307416
0037 REM "307416-DBD-256 Enhance WMS picking templates                       
0040 REM "Copyright 2022 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
4000 DIRECTED_PICKING:
4005 TF_ZONE$="",BIN_LOC$="",WHS$="",TF_ITEM$="",ITEM_DESC$="",ORDER$="",RFS_KEY$=""
4007 PICK=0
4010 CALL "UPDRFS;READBYKEY",RFS,2,TASK_NUM$,SEG2$,SEG3$,SEG4$,SEG5$,RFS$,RFS{ALL},FOUNDRFS
4020 CALL "UPDRFS;READNEXT",RFS,RFS$,RFS{ALL},FOUNDRFS; IF FOUNDRFS THEN IF RFS$(43,10)<>TASK_NUM$ THEN FOUNDRFS=0
4030 WHILE FOUNDRFS ! 2450 wend
4040 IF RFS$(147,1)<>"Y" THEN {! 2430 }
4050 TF_ZONE$=RFS$(63,4),BIN_LOC$=RFS$(71,10),WHS$=RFS$(81,4)
4052 WAREHOUSE$=WHS$ ! [204385]
4055 LOT_NUM$=RFS$(12,8)
4060 TF_ITEM$=RFS$(23,20),ITEM_DESC$=RFS$(149,40)
4062 ORDER$=RFS$(1,8)
4065 PICK=1,RFS_KEY$=RFS$(1,22)
4067 UOM$=RFS$(85,4),UOM_QTY=RFS[2]; IF UOM_QTY=0 THEN UOM_QTY=1
4068 IF RFS$(105,12)<>DIM(12) THEN CVT_QTY=1 ELSE CVT_QTY=UOM_QTY
4069 ORD_QTY$=STR(RFS[0]/CVT_QTY)
4070 FOUNDRFS=0
4080  } ! 2310
4090 IF FOUNDRFS THEN CALL "UPDRFS;READNEXT",RFS,RFS$,RFS{ALL},FOUNDRFS; IF FOUNDRFS THEN IF RFS$(43,10)<>TASK_NUM$ THEN FOUNDRFS=0
4100 WEND 
4110 IF NOT(PICK) THEN MSG$="No More Items to Pick"
4190 RETURN 
4198 ! 
4199 ! 
5000 ! print desc
5010 LINE$=LINE1$+TAGDESC$+LINE2$
5090 RETURN 
8150 BYB_PROCESSING:! Send LINE$ to EC3BYB for generic fields processing
8160 CALL "EC3BYB",ERR=8161,X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT,LINE$,BYBINFO${ALL},BYBOPTIONS$
8195 RETURN 
8910 DEF FND$(Z9$)=Z9$(3,2)+"/"+Z9$(5,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
9000 REM "ERROR PROCESSING
9002 J=ERR,K=TCB(5); SETERR 0000; ENDTRACE 
9010 LAST_WEBEC_ERR$="ERR: "+STR(J)+" AT: "+STR(K); LAST_WEBEC_ERR$=GBL("LAST_WEBEC_ERR",LAST_WEBEC_ERR$); REM "131928
9090 GOTO 9900
9900 REM "End
9905 CLOSE (100)
9950 EXIT 
9999 END 
10000 PROCESS_TEMPLATE_RFGPH0:
10005 CLOSE (100); OPEN (100,OPT="TEXT",ERR=9000)TEMPLATE$
10010 READ (100,END=11990)LINE$; GOSUB BYB_PROCESSING ! 2950 end of main routine
10020 CHKTAG=1
10030 WHILE CHKTAG
10040 P1=MSK(LINE$,"\?tf\?[^?]*\?"); IF P1=0 THEN CHKTAG=0; BREAK
10050 TAG$=LINE$(P1,MSL)
10060 LINE1$=LINE$(1,P1-1); LINE2$=MID(LINE$,P1+MSL)
10070 SWITCH TAG$
10080 CASE "?tf?session_id?"
10100 IF PRINT_DOC THEN TAGDESC$="Contains the current session Id"; GOSUB 5000 ELSE LINE$=LINE1$+SESSION_ID$+LINE2$
10110 BREAK
10120 CASE "?tf?base_page_ref?"
10130 IF PRINT_DOC THEN TAGDESC$="Contains the base web page location"; GOSUB 5000 ELSE LINE$=LINE1$+%BASEPAGEREF$+LINE2$
10140 BREAK
10150 CASE "?tf?cgi_command?"
10160 IF PRINT_DOC THEN TAGDESC$="Contains the cgi-command path"; GOSUB 5000 ELSE LINE$=LINE1$+%CGICOMMAND$+LINE2$
10170 BREAK
10180 CASE "?tf?next_template?"
10190 IF PRINT_DOC THEN TAGDESC$="Contains the next html template"; GOSUB 5000 ELSE LINE$=LINE1$+"rfgrd0.htm"+LINE2$
10200 BREAK
10210 CASE "?tf?wms_err_msg_1?"
10220 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+MSG$+LINE2$
10230 BREAK
10240 CASE "?tf?wms_err_msg_2?"
10250 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG2$+LINE2$
10260 BREAK
10270 CASE "?tf?wms_err_msg_3?"
10280 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG3$+LINE2$
10285 BREAK
10290 CASE "?tf?wms_task_num?"
10295 LINE$=LINE1$+TASK_NUM$+LINE2$
10297 BREAK
10300 CASE "?tf?wms_err_msg_4?"
10310 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG4$+LINE2$
10320 CASE "?tf?wms_pick_bin_list?"
10330 LINE$=""
10335 ! IF LEN(BINLIST$)>=10 THEN {
10340 FOR K=1 TO LEN(BINLIST$) STEP 10
10350 LINE$=LINE$+LINE1$+"<option value="+BINLIST$(K,10)+">"+BINLIST$(K,10)+"</option>"+EOL$+LINE2$
10360 NEXT K
10362  } ELSE {
10365 LINE$=LINE1$+LINE2$
10367  }
10370 BREAK
10380 CASE "?tf?basic?"
10390 LINE$=LINE1$+BASIC$+LINE2$
10400 BREAK
10410 DEFAULT 
10420 IF PRINT_DOC=0 THEN LINE$=LINE1$+LINE2$
11000 END SWITCH ! 10030 
11100 WEND 
11500 IF LINE$<>"" THEN PRINT (OUTPUT)LINE$
11900 GOTO 10010
11990 EXIT 
11998 ! 
11999 ! 
20000 PROCESS_TEMPLATE_RFGPD0:
20002 GOSUB DIRECTED_PICKING
20003 GOSUB GET_ITEM_LOT_DETAILS
20005 CLOSE (100); OPEN (100,OPT="TEXT",ERR=9000)TEMPLATE$
20010 READ (100,END=21990)LINE$; GOSUB BYB_PROCESSING ! 2950 end of main routine
20020 CHKTAG=1
20030 WHILE CHKTAG
20040 P1=MSK(LINE$,"\?tf\?[^?]*\?"); IF P1=0 THEN CHKTAG=0; BREAK
20050 TAG$=LINE$(P1,MSL)
20060 LINE1$=LINE$(1,P1-1); LINE2$=MID(LINE$,P1+MSL)
20070 SWITCH TAG$
20080 CASE "?tf?session_id?"
20090 IF PRINT_DOC THEN TAGDESC$="Contains the current session Id"; GOSUB 5000 ELSE LINE$=LINE1$+SESSION_ID$+LINE2$
20100 BREAK
20110 CASE "?tf?base_page_ref?"
20120 IF PRINT_DOC THEN TAGDESC$="Contains the base web page location"; GOSUB 5000 ELSE LINE$=LINE1$+%BASEPAGEREF$+LINE2$
20130 BREAK
20140 CASE "?tf?cgi_command?"
20150 IF PRINT_DOC THEN TAGDESC$="Contains the cgi-command path"; GOSUB 5000 ELSE LINE$=LINE1$+%CGICOMMAND$+LINE2$
20160 BREAK
20170 CASE "?tf?wms_next_template?"
20180 IF PRINT_DOC THEN TAGDESC$="Contains the next html template"; GOSUB 5000 ELSE LINE$=LINE1$+NEXT_TEMPLATE$+LINE2$
20190 BREAK
20200 CASE "?tf?wms_err_msg_1?"
20210 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+MSG$+LINE2$
20220 BREAK
20230 CASE "?tf?wms_err_msg_2?"
20240 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG2$+LINE2$
20250 BREAK
20260 CASE "?tf?wms_err_msg_3?"
20270 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG3$+LINE2$
20280 BREAK
20290 CASE "?tf?wms_task_num?"
20295 LINE$=LINE1$+TASK_NUM$+LINE2$
20297 BREAK
20430 CASE "?tf?basic?"
20432 LINE$=LINE1$+BASIC$+LINE2$; BREAK
20520 CASE "?tf?wms_pick_cart?"
20522 LINE$=LINE1$+PICK_CART$+LINE2$; BREAK
20530 CASE "?tf?wms_last_item"
20532 LINE$=LINE1$+LAST_ITEM$+LINE2$; BREAK
20535 CASE "?tf?wms_last_item_desc?"
20537 LINE$=LINE1$+LAST_ITEM_DESC$+LINE2$; BREAK
20540 CASE "?tf?wms_last_item_qty?"
20545 IF LAST_ITEM_QTY>0 THEN LINE$=LINE1$+STR(LAST_ITEM_QTY)+LINE2$ ELSE LINE$=LINE1$+LINE2$
20547 BREAK
20550 CASE "?tf?wms_rfs_zone?"
20555 LINE$=LINE1$+TF_ZONE$+LINE2$; BREAK
20560 CASE "?tf?wms_rfs_uom?"
20562 IF PICK THEN LINE$=LINE1$+UOM$+"/"+STR(UOM_QTY)+LINE2$ ELSE LINE$=LINE1$+LINE2$
20564 BREAK
20565 CASE "?tf?wms_rfs_order_qty?"
20567 IF PICK THEN LINE$=LINE1$+ORD_QTY$+LINE2$ ELSE LINE$=LINE1$+LINE2$
20569 BREAK
20570 CASE "?tf?wms_rfs_whs?"
20572 ! IF WHS$<>"" THEN WHS$="WHS: "+WHS$
20575 LINE$=LINE1$+WHS$+LINE2$; BREAK
20580 CASE "?tf?wms_item_number?"
20585 LINE$=LINE1$+TF_ITEM$+LINE2$; BREAK
20590 CASE "?tf?wms_rfs_lot_serial_num?"
20592 ! IF STP(LOT_NUM$,2)<>"" THEN LOT_NUM$="LOT: "+LOT_NUM$
20595 LINE$=LINE1$+LOT_NUM$+LINE2$; BREAK
20600 CASE "?tf?wms_order_number?"
20604 LINE$=LINE1$+ORDER$+LINE2$; BREAK
20606 CASE "?tf?wms_fmt_order_number?"
20608 LINE$=LINE1$+FN%ZZDISP$(ORDER$,"O/P")+LINE2$; BREAK
20610 CASE "?tf?wms_item_desc?"
20615 LINE$=LINE1$+ITEM_DESC$+LINE2$; BREAK
20620 CASE "?tf?wms_rfs_key?"
20625 LINE$=LINE1$+RFS_KEY$+LINE2$; BREAK
20700 CASE "?tf?wms_rfs_bin?"
20710 GOSUB BUILD_BIN_LOC ! [204385]
20780 LINE$=LINE1$+RF1BINLOC$+LINE2$
20790 BREAK
20800 CASE "?tf?wms_item_cust_code?"
20805 LINE$=LINE1$+FN%ZZDISP$(MID(TF_ITEM$,1,10),"A/R")+LINE2$; BREAK
20810 CASE "?tf?wms_item_code?"
20815 LINE$=LINE1$+STP(MID(TF_ITEM$,11,20))+LINE2$; BREAK
20900 DEFAULT 
20901 IF POS("?tf?ic0_"=TAG$)=1 THEN GOSUB PROCESS_IC0_TAG; PP=FNP(STP(IC0_TAG_VAL$)); BREAK
20902 IF POS("?tf?fm1_"=TAG$)=1 THEN GOSUB PROCESS_FM1_TAG; PP=FNP(STP(FM1_TAG_VAL$)); BREAK
20903 IF POS("?tf?icf_"=TAG$)=1 THEN GOSUB PROCESS_ICF_TAG; PP=FNP(STP(ICF_TAG_VAL$)); BREAK
20910 IF PRINT_DOC=0 THEN LINE$=LINE1$+LINE2$
21000 END SWITCH ! 10030 
21100 WEND 
21500 IF LINE$<>"" THEN PRINT (OUTPUT)LINE$
21900 GOTO 20010
21990 EXIT 
21998 ! 
21999 ! 
22000 PROCESS_TEMPLATE_RFGPD1:
22003 GOSUB GET_ITEM_LOT_DETAILS
22010 CLOSE (100); OPEN (100,OPT="TEXT",ERR=9000)TEMPLATE$
22020 READ (100,END=22990)LINE$; GOSUB BYB_PROCESSING ! 2950 end of main routine
22030 CHKTAG=1
22040 WHILE CHKTAG
22050 P1=MSK(LINE$,"\?tf\?[^?]*\?"); IF P1=0 THEN CHKTAG=0; BREAK
22060 TAG$=LINE$(P1,MSL)
22070 LINE1$=LINE$(1,P1-1); LINE2$=MID(LINE$,P1+MSL)
22080 SWITCH TAG$
22090 CASE "?tf?session_id?"
22100 IF PRINT_DOC THEN TAGDESC$="Contains the current session Id"; GOSUB 5000 ELSE LINE$=LINE1$+SESSION_ID$+LINE2$
22110 BREAK
22120 CASE "?tf?base_page_ref?"
22130 IF PRINT_DOC THEN TAGDESC$="Contains the base web page location"; GOSUB 5000 ELSE LINE$=LINE1$+%BASEPAGEREF$+LINE2$
22140 BREAK
22150 CASE "?tf?cgi_command?"
22160 IF PRINT_DOC THEN TAGDESC$="Contains the cgi-command path"; GOSUB 5000 ELSE LINE$=LINE1$+%CGICOMMAND$+LINE2$
22170 BREAK
22180 CASE "?tf?wms_next_template?"
22190 IF PRINT_DOC THEN TAGDESC$="Contains the next html template"; GOSUB 5000 ELSE LINE$=LINE1$+NEXT_TEMPLATE$+LINE2$
22200 BREAK
22210 CASE "?tf?wms_err_msg_1?"
22220 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+MSG$+LINE2$
22230 BREAK
22240 CASE "?tf?wms_err_msg_2?"
22250 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG2$+LINE2$
22260 BREAK
22270 CASE "?tf?wms_err_msg_3?"
22280 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG3$+LINE2$
22290 BREAK
22300 CASE "?tf?wms_rfs_key?"
22305 LINE$=LINE1$+RFS_KEY$+LINE2$; BREAK
22310 CASE "?tf?wms_rfs_order_qty?"
22315 LINE$=LINE1$+ORDER_QTY$+LINE2$; BREAK
22320 CASE "?tf?wms_rfs_order_uom?"
22325 LINE$=LINE1$+ORDER_UOM$+LINE2$; BREAK
22550 CASE "?tf?basic?"
22560 LINE$=LINE1$+BASIC$+LINE2$; BREAK
22570 CASE "?tf?wms_pick_cart?"
22580 LINE$=LINE1$+PICK_CART$+LINE2$; BREAK
22590 CASE "?tf?wms_task_num?"
22595 LINE$=LINE1$+TASK_NUM$+LINE2$; BREAK
22660 CASE "?tf?wms_rfs_zone?"
22670 LINE$=LINE1$+TF_ZONE$+LINE2$; BREAK
22680 CASE "?tf?wms_rfs_bin?"
22685 GOSUB BUILD_BIN_LOC ! [204385]
22690 LINE$=LINE1$+RF1BINLOC$+LINE2$; BREAK ! [204385]
22700 CASE "?tf?wms_rfs_whs?"
22710 LINE$=LINE1$+WHS$+LINE2$; BREAK
22720 CASE "?tf?wms_item_number?"
22730 LINE$=LINE1$+TF_ITEM$+LINE2$; BREAK
22740 CASE "?tf?wms_rfs_lot_serial_num?"
22750 LINE$=LINE1$+ORDER_LOT_NUM$+LINE2$
22752 BREAK
22760 CASE "?tf?wms_order_number?"
22770 LINE$=LINE1$+ORDER$+LINE2$; BREAK
22772 CASE "?tf?wms_fmt_order_number?"
22774 LINE$=LINE1$+FN%ZZDISP$(ORDER$,"O/P")+LINE2$; BREAK
22780 CASE "?tf?wms_item_desc?"
22790 LINE$=LINE1$+ITEM_DESC$+LINE2$; BREAK
22800 CASE "?tf?wms_item_cust_code?"
22805 LINE$=LINE1$+FN%ZZDISP$(MID(TF_ITEM$,1,10),"A/R")+LINE2$; BREAK
22810 CASE "?tf?wms_item_code?"
22815 LINE$=LINE1$+STP(MID(TF_ITEM$,11,20))+LINE2$; BREAK
22920 DEFAULT 
22921 IF POS("?tf?ic0_"=TAG$)=1 THEN GOSUB PROCESS_IC0_TAG; PP=FNP(STP(IC0_TAG_VAL$)); BREAK
22922 IF POS("?tf?fm1_"=TAG$)=1 THEN GOSUB PROCESS_FM1_TAG; PP=FNP(STP(FM1_TAG_VAL$)); BREAK
22923 IF POS("?tf?icf_"=TAG$)=1 THEN GOSUB PROCESS_ICF_TAG; PP=FNP(STP(ICF_TAG_VAL$)); BREAK
22930 IF PRINT_DOC=0 THEN LINE$=LINE1$+LINE2$
22940 END SWITCH ! 10030 
22950 WEND 
22970 IF LINE$<>"" THEN PRINT (OUTPUT)LINE$
22980 GOTO 22020
22990 EXIT 
22998 ! 
22999 ! 
30000 REM + Build Bin Location with Mask     ! [204385]-created routine
30010 BUILD_BIN_LOC:
30015 WAREHOUSE$=RFS$(81,4)
30020 BIN_LOC$=PAD(STP(BIN_LOC$),10,1," ")
30025 RF1BINLOC$=BIN_LOC$
30030 DIM BIN_MASK$(15); CALL "UPDRFB;READBYKEY",RFB,0,BIN_LOC$,WAREHOUSE$,SEG3$,SEG4$,SEG5$,RFB$,RFB{ALL},FOUNDRFB
30035 IF FOUNDRFB THEN {
30040 RF1BINLOC$="",BIN_MASK$=RFB$(69,15),RF1BIN$=BIN_LOC$
30045 TMP_BIN_MASK$=PAD(STP(BIN_MASK$),15,1,"X")
30050 RF1BINLOC$=STR(RF1BIN$:TMP_BIN_MASK$)
30055  }
30095 RETURN 
30099 ! 
35000 GET_ITEM_LOT_DETAILS:
35010 IC0KEY$=TF_ITEM$; READ (IC0,KEY=IC0KEY$,KNO=0,ERR=*PROCEED,REC=IC0$)
35020 FM1KEY$=TF_ITEM$; READ (FM1,KEY=FM1KEY$,KNO=0,ERR=*PROCEED,REC=FM1$)
35030 ICFKEY$=PAD(MID(RFS$,23,20),20)+PAD(MID(RFS$,105,12),12); READ (ICF,KEY=ICFKEY$,KNO=0,ERR=*PROCEED,REC=ICF$)
35095 RETURN 
35099 ! 
35100 PROCESS_IC0_TAG:
35105 TAG$=MID(TAG$,5); TAG$=STP(TAG$,1,"?")
35106 IC0_TAG_VAL$=""
35110 IC0_TAG_VAL$=EVS(SUB(UCS(TAG$),"IC0_","IC0.")+"$") ! IF LEN(IC0_TAG_VAL$)=0 THEN IC0_TAG_VAL$=STR(EVN(SUB(UCS(TAG$),"IC0_","IC0."),ERR=*NEXT))
35145 RETURN 
35149 ! 
35200 PROCESS_FM1_TAG:
35205 TAG$=MID(TAG$,5); TAG$=STP(TAG$,1,"?")
35206 FM1_TAG_VAL$=""
35210 FM1_TAG_VAL$=EVS(SUB(UCS(TAG$),"FM1_","FM1.")+"$") ! IF LEN(FM1_TAG_VAL$)=0 THEN FM1_TAG_VAL$=STR(EVN(SUB(UCS(TAG$),"FM1_","FM1."),ERR=*NEXT))
35245 RETURN 
35249 ! 
35300 PROCESS_ICF_TAG:
35305 TAG$=MID(TAG$,5); TAG$=STP(TAG$,1,"?")
35306 ICF_TAG_VAL$=""
35310 ICF_TAG_VAL$=EVS(SUB(UCS(TAG$),"ICF_","ICF.")+"$") ! IF LEN(ICF_TAG_VAL$)=0 THEN ICF_TAG_VAL$=STR(EVN(SUB(UCS(TAG$),"ICF_","ICF."),ERR=*NEXT))
35345 RETURN 
35349 ! 
35400 FNP:
35410 DEF FNP(LOCAL DATA$)
35420 LINE$=LINE1$+DATA$+LINE2$
35430 RETURN 0
35445 END DEF
35449 ! 
56000 REM "180032-Wireless Warehousing                                        
56002 REM "203740-WMS if you enter an invalid login it just hangs, should     
56004 REM "204385-WMS bin mask - how does it work, what is maximum            
56006 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
56007 REM "227739-WMS: EC program and template modifications to allow WMS user
56008 REM "307416-DBD-256 Enhance WMS picking templates                       
