0010 REM "WMS Purchase Order Receiving Clear PO<RFGRU1"
0020 SETESC 9300; SETERR 9000
0035 REM "5.5 - 09/10/07 - 9.455 - jdf - SSP# 211380
0037 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
0040 REM "Copyright 2007 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT
0100 SETERR 9000
0110 X0$="RFGRU1",X1$="WMS Purchase Order Receiving Clear Receiving"
0120 EOL$=$0D0A$; EOL$=ATH(STP(EC_PARM$(57,8),1))
0127 HTML_TEXT$="Content-type: text/html"
0140 DIM MESS_INFO$[20] ! ,EC_PARM$(1275)(1275)
0230 DIM ESY$(512)
0240 DIM ECC$(1984),ECC[3]
0250 DIM ESZ$(128),ESZ[18]
0330 IOLIST ESY$
0340 IOLIST ECC$,ECC[0],ECC[1],ECC[2]
0350 IOLIST ESZ$,ESZ[0],ESZ[1],ESZ[2],ESZ[3],ESZ[4],ESZ[5],ESZ[6],ESZ[7],ESZ[8],ESZ[9],ESZ[10],ESZ[11],ESZ[12],ESZ[13],ESZ[14],ESZ[15],ESZ[16],ESZ[17],ESZ[18]
0370 IOLIST ZW2$,ZW2[0],ZW2[1],ZW2[2]
0380 IOLIST ZW9A$,ZW9B$
0400 IOLIST ZW7A$,ZW7B$
0410 IOLIST ZW8A$
0500 REM "Open files
0502 CLOSE (13); OPEN (13)"ZZPARM"
0505 DIM Z[NUM(X3$(60,3))],BLGRBNKS$(100)
0510 Z$="01O RF2...  02O RF1...  04O AP4...  05O RFP...  09O RFB...  10O PO1...  11O FTO...  12O PO2...  13O ZZPARM  14O FMN...  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0900 PRINT_DOC=0
1000 REM "Process DATA array
1010 FOR I=1 TO NUM_ENTRIES
1015 TAG$=DATA$[I,0],TF_VALUE$=DATA$[I,1]
1050 SWITCH TAG$ ! 1185 end switch
1055 CASE "print_doc"
1057 PRINT_DOC=1; BREAK
1058 CASE "show_tags"
1059 SHOW_TAGS=1; BREAK
1060 CASE "po_number"
1062 PORDER$=TF_VALUE$; BREAK
1065 CASE "rec_bin"
1067 REC_BIN$=TF_VALUE$; BREAK
1080 CASE "template"
1082 TEMPLATE$=TF_VALUE$; BREAK
1985 END SWITCH ! 1050
1990 NEXT I
2000 ! process data
2015 MSG$=""
2020 SESSION_ID$=EC$[1](1,7)
2022 TASK_NUM$="000"+SESSION_ID$
2025 BUYER$=EC$[2](1,15),BASIC$="RFGRH0",TEMPLATE$="rfgrh0.htm"
2300 SELECT_PORDER:
2320 IF PORDER$<>"" AND REC_BIN$<>"" THEN {! 2895
2330 CALL "ZZWLKU;PARSE_PORDER",PORDER$,PO_DIV$,PO_NUM$; PORDER$=PO_DIV$+PO_NUM$
2340 CALL "UPDPO1;READBYKEY",Z[10],0,PO_DIV$,PO_NUM$,SEG3$,SEG4$,SEG5$,PO1$,PO1{ALL},FOUNDPO1
2380 CALL "UPDPO1;CLEAR_PO_FLAG",Z[10],Z[11],X3$,PO1$,PO1{ALL},BUYER$,OK,MSGPO1$
2400 CALL "UPDRF2;READBYKEY",Z[1],0,REC_BIN$,SEG2$,SEG3$,SEG4$,SEG5$,RF2$,RF2{ALL},FOUNDRF2; IF FOUNDRF2 THEN CALL "UPDRF2;DELETE",Z[1],RF2$,RFA{ALL}
2490 CALL "UPDRF1;READBYKEY",Z[2],0,PO_DIV$,PO_NUM$,SEG3$,SEG4$,SEG5$,RF1$,RF1{ALL},FOUNDRF1; IF FOUNDRF1 THEN IF RF1$(1,9)<>PO_DIV$+PO_NUM$ THEN FOUNDRF1=0
2500 WHILE FOUNDRF1
2510 CALL "UPDRF1;DELETE",Z[2],RF1$,RF1{ALL},FOUNDRF1,BUSYRF1
2520 CALL "UPDRF1;READBYKEY",Z[2],0,PO_DIV$,PO_NUM$,SEG3$,SEG4$,SEG5$,RF1$,RF1{ALL},FOUNDRF1; IF FOUNDRF1 THEN IF RF1$(1,9)<>PO_DIV$+PO_NUM$ THEN FOUNDRF1=0
2540 WEND 
2895  } ! 2320
3000 DIM BYBINFO$[5]; BYBINFO$[1]=PGN,BYBINFO$[2]="180032.20060308",BYBINFO$[3]=TEMPLATE$,BYBOPTIONS$=""
4000 SWITCH TEMPLATE$
4100 DEFAULT 
4110 PERFORM "RFGRDT;PROCESS_TEMPLATE_RFGRH0"
4200 END SWITCH 
4900 GOTO 9900
5000 ! printdesc
5010 LINE$=TAG$+" "+TAGDESC$
5090 RETURN 
5100 ADD_MSG_TO_LOG:! Add message to log file
5110 MOUT$="SESSION ID|"+EC$[1](1,7)+"|FILE|"+%WEBEC_FILE_NAME$+"|WORKSHEET|"+ECD$(1,10)+"|LINE|"+ECE$(25,3)+"|MESSAGE NO|"+STR(MESSAGE_NO:"00000")+"|MESSAGE|"+MESSAGE$+"|"
5135 MX=FN%_LOG_MESSAGE("MESG",MOUT$)
5145 RETURN 
5149 ! 
5490 RETURN ! 5200
5500 REM create description html
5590 RETURN 
8150 BYB_PROCESSING:! Send LINE$ to EC3BYB for generic fields processing
8160 CALL "EC3BYB",ERR=8161,X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT,LINE$,BYBINFO${ALL},BYBOPTIONS$
8195 RETURN 
8910 DEF FND$(Z9$)=Z9$(3,2)+"/"+Z9$(5,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
9000 REM "ERROR PROCESSING
9002 J=ERR,K=TCB(5); SETERR 0000; ENDTRACE 
9010 LAST_WEBEC_ERR$="ERR: "+STR(J)+" AT: "+STR(K); LAST_WEBEC_ERR$=GBL("LAST_WEBEC_ERR",LAST_WEBEC_ERR$); REM "131928
9090 GOTO 9900
9900 REM "End
9905 CLOSE (100)
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9915 CLOSE (13)
9950 EXIT 
9999 END 
10000 PROCESS_TEMPLATE_RFGRH0:
10005 IF PRINT_DOC=0 THEN CLOSE (100); OPEN (100,OPT="TEXT",ERR=9000)TEMPLATE$
10010 IF PRINT_DOC THEN READ DATA LINE$,ERR=11990 ELSE READ (100,END=11990)LINE$; GOSUB BYB_PROCESSING ! 2950 end of main routine
10020 CHKTAG=1
10030 WHILE CHKTAG ! 11100 wend
10040 P1=MSK(LINE$,"\?tf\?[^?]*\?"); IF P1=0 THEN CHKTAG=0; BREAK
10050 TAG$=LINE$(P1,MSL)
10060 LINE1$=LINE$(1,P1-1); LINE2$=MID(LINE$,P1+MSL)
10070 SWITCH TAG$
10080 CASE "?tf?session_id?"
10090 IF PRINT_DOC THEN TAGDESC$="Contains the current session Id"; GOSUB 5000 ELSE LINE$=LINE1$+SESSION_ID$+LINE2$
10100 BREAK
10110 CASE "?tf?base_page_ref?"
10120 IF PRINT_DOC THEN TAGDESC$="Contains the base web page location"; GOSUB 5000 ELSE LINE$=LINE1$+%BASEPAGEREF$+LINE2$
10130 BREAK
10140 CASE "?tf?cgi_command?"
10150 IF PRINT_DOC THEN TAGDESC$="Contains the cgi-command path"; GOSUB 5000 ELSE LINE$=LINE1$+%CGICOMMAND$+LINE2$
10160 BREAK
10170 CASE "?tf?next_template?"
10180 IF PRINT_DOC THEN TAGDESC$="Contains the next html template"; GOSUB 5000 ELSE LINE$=LINE1$+"rfgrd0.htm"+LINE2$
10190 BREAK
10200 CASE "?tf?wms_err_msg_1?"
10210 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+MSG$+LINE2$
10220 BREAK
10230 CASE "?tf?wms_err_msg_2?"
10240 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG2$+LINE2$
10250 BREAK
10260 CASE "?tf?wms_err_msg_3?"
10270 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG3$+LINE2$
10280 BREAK
10290 CASE "?tf?wms_err_msg_4?"
10300 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG4$+LINE2$
10350 CASE "?tf?wms_rec_bin?"
10355 LINE$=""
10360 FOR K=1 TO LEN(BINLIST$) STEP 10
10365 LINE$=LINE$+LINE1$+"<option value="+BINLIST$(K,10)+">"+BINLIST$(K,10)+"</option>"+EOL$+LINE2$
10370 NEXT K
10390 BREAK
10415 CASE "?tf?basic?"
10417 LINE$=LINE1$+BASIC$+LINE2$
10420 BREAK
10900 DEFAULT 
10910 IF PRINT_DOC=0 THEN LINE$=LINE1$+LINE2$
11000 END SWITCH ! 10030 
11100 WEND 
11500 IF LINE$<>"" THEN PRINT (OUTPUT)LINE$
11600 DATA "tf?session_id?","?tf?base_page_ref?","?tf?cgi_command?"
11900 GOTO 10010 ! next read
11990 RETURN ! 10000-11999
11998 ! 
11999 ! 
20000 PROCESS_TEMPLATE_RFGRD0:
20005 IF PRINT_DOC=0 THEN CLOSE (100); OPEN (100,OPT="TEXT",ERR=9000)TEMPLATE$
20010 IF PRINT_DOC THEN READ DATA LINE$,ERR=21990 ELSE READ (100,END=21990)LINE$; GOSUB BYB_PROCESSING ! 2950 end of main routine
20020 CHKTAG=1
20030 WHILE CHKTAG ! 11000 wend
20040 P1=MSK(LINE$,"\?tf\?[^?]*\?"); IF P1=0 THEN CHKTAG=0; BREAK
20050 TAG$=LINE$(P1,MSL)
20060 LINE1$=LINE$(1,P1-1); LINE2$=MID(LINE$,P1+MSL)
20070 SWITCH TAG$
20080 CASE "?tf?session_id?"
20090 IF PRINT_DOC THEN TAGDESC$="Contains the current session Id"; GOSUB 5000 ELSE LINE$=LINE1$+SESSION_ID$+LINE2$
20100 BREAK
20110 CASE "?tf?base_page_ref?"
20120 IF PRINT_DOC THEN TAGDESC$="Contains the base web page location"; GOSUB 5000 ELSE LINE$=LINE1$+%BASEPAGEREF$+LINE2$
20130 BREAK
20140 CASE "?tf?cgi_command?"
20150 IF PRINT_DOC THEN TAGDESC$="Contains the cgi-command path"; GOSUB 5000 ELSE LINE$=LINE1$+%CGICOMMAND$+LINE2$
20160 BREAK
20170 CASE "?tf?wms_next_template?"
20180 IF PRINT_DOC THEN TAGDESC$="Contains the next html template"; GOSUB 5000 ELSE LINE$=LINE1$+NEXT_TEMPLATE$+LINE2$
20190 BREAK
20200 CASE "?tf?wms_err_msg_1?"
20210 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+MSG$+LINE2$
20220 BREAK
20230 CASE "?tf?wms_err_msg_2?"
20240 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG2$+LINE2$
20250 BREAK
20260 CASE "?tf?wms_err_msg_3?"
20270 IF PRINT_DOC THEN TAGDESC$="Displays an error message"; GOSUB 5000 ELSE LINE$=LINE1$+ERR_MSG3$+LINE2$
20280 BREAK
20320 CASE "?tf?wms_vend_name?"
20325 LINE$=LINE1$+VEND_NAME$+LINE2$; BREAK
20330 CASE "?tf?wms_note1?"
20335 LINE$=LINE1$+NOTE1$+LINE2$; BREAK
20340 CASE "?tf?wms_note2?"
20345 LINE$=LINE1$+NOTE2$+LINE2$; BREAK
20350 CASE "?tf?wms_note3?"
20355 LINE$=LINE1$+NOTE3$+LINE2$; BREAK
20360 CASE "?tf?wms_note4?"
20365 LINE$=LINE1$+NOTE4$+LINE2$; BREAK
20370 CASE "?tf?wms_note5?"
20375 LINE$=LINE1$+NOTE5$+LINE2$; BREAK
20380 CASE "?tf?wms_note6?"
20385 LINE$=LINE1$+NOTE6$+LINE2$; BREAK
20390 CASE "?tf?wms_note7?"
20395 LINE$=LINE1$+NOTE7$+LINE2$; BREAK
20400 CASE "?tf?wms_note8?"
20405 LINE$=LINE1$+NOTE8$+LINE2$; BREAK
20410 CASE "?tf?wms_note9?"
20415 LINE$=LINE1$+NOTE9$+LINE2$; BREAK
20420 CASE "?tf?wms_note10?"
20425 LINE$=LINE1$+NOTE10$+LINE2$; BREAK
20430 CASE "?tf?basic?"
20432 LINE$=LINE1$+BASIC$+LINE2$; BREAK
20520 CASE "?tf?wms_po_number?"
20522 LINE$=LINE1$+PO_DIV$+PO_NUM$+LINE2$; BREAK
20600 CASE "?tf?wms_po_line_list?"
20605 LINE$=""
20610 CALL "UPDPO2;READBYKEY",Z[12],0,PO1$(297,9),SEG2$,SEG3$,SEG4$,SEG5$,PO2$,PO2{ALL},FOUNDPO2
20620 CALL "UPDPO2;READNEXT",Z[12],PO2$,PO2{ALL},FOUNDPO2; IF FOUNDPO2 THEN IF PO2$(82,9)<>PO1$(297,9) THEN FOUNDPO2=0
20650 WHILE FOUNDPO2
20670 LINE$=LINE$+LINE1$+"<option value="+PO2$(7,3)+">"+PO2$(91,20)+"-"+PO2$(28,40)+"</option>"+EOL$+LINE2$
20680 CALL "UPDPO2;READNEXT",Z[12],PO2$,PO2{ALL},FOUNDPO2; IF FOUNDPO2 THEN IF PO2$(82,9)<>PO1$(297,9) THEN FOUNDPO2=0
20690 WEND 
20695 BREAK
20900 DEFAULT 
20910 IF PRINT_DOC=0 THEN LINE$=LINE1$+LINE2$
21000 END SWITCH ! 10030 
21100 WEND 
21198 ! 
21199 ! 
21500 IF LINE$<>"" THEN PRINT (OUTPUT)LINE$
21900 GOTO 20010
21990 RETURN 
56000 REM "180032-Wireless Warehousing                                        
56002 REM "211380-TopForm file feldnames which are SQL keywords break Oracle. 
