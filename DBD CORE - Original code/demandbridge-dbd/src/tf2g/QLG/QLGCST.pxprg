0010 ! QLGCST - Select EQLINK Customers
0030 ! ************************************************************************
0035 REM "5.7 - 02/02/22 - 17.108171 - jvv - SSP# 307387
0037 REM "307387-EQLink DBD Bridge to Qnet                                   
0040 REM "Copyright 2022 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0049 ! 
0050 ENTER CHANNEL,ERR=*NEXT
0052 IF NUL(%WDX$) THEN MSGBOX "You must be using Windx to use this process"; GOTO 0075
0055 ARG_1$=STR(CHANNEL)
0060 PROCESS "QLGCST","../QLG/QL.EN",ARG_1$
0065 CHANNEL=NUM(ARG_1$,ERR=*NEXT)
0075 EXIT 
0090 ! 
0100 ! 100 - Initialization
0110 INIT:
0154 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,-1,X1,X2; DIM Z[NUM(X3$(60,3))]
0210 Z$="01O AR1...  020 ASW...  13O ZZPARM  "
0220 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0
0240 _FILE_NAME$=FIN(Z[1],"FILENAME"),_FIL_NO=Z[1]
0250 CLOSE (_FIL_NO); OPEN (_FIL_NO,IOL=*)_FILE_NAME$
0300 ! IOList Section
0310 IOL_EFQ:IOLIST EFQ$
0315 DIM EFQ$[1:20]
0320 IOL_DR0:IOLIST DR0$
0400 ! 
0410 _FYI$=MSG("FYI"),_ERROR$=MSG("ERROR")
0420 CTAB$=DIM(2)
0490 RETURN 
0499 ! 
0500 ! 500 - Main panel post_display logic
0510 MAIN_POST_DISPLAY:
0520 MEMCHN=NUM(ARG_1$,ERR=*NEXT)
0530 IF MEMCHN=0 THEN OPEN (HFN)"*MEMORY*"; MEMCHN=LFO
0570 RETURN 
0599 ! 
0900 ! 900 - Wrapup
0910 WRAPUP:
0950 ARG_1$=STR(MEMCHN)
0970 RETURN 
0999 ! 
1000 REM "Event handler - OnSelect
1005 SELECT_FILE:
1010 READ DATA FROM FILE_GRID.CTL'ROWDATA$ TO IOL=FILE_GRID.CTL'LOADIOLIST$
1020 IF C_SEL$="1" THEN {
1030 WRITE (MEMCHN,KEY=PAD(STP(C_DBD_CUST$,2),10),ERR=*NEXT)PAD(STP(C_DBD_CUST$,2),10)
1040  } ELSE {
1050 REMOVE (MEMCHN,KEY=PAD(STP(C_DBD_CUST$,2),10),ERR=*NEXT)
1060  }
1095 RETURN 
1099 ! 
2000 LOAD_FILE_LIST:
2002 TIME_MASK$="00:00:00"; IF MID(%X3$,56,3)="DMY" THEN DATE_FORMAT$="%Dz-%Mz-%Y" ELSE DATE_FORMAT$="%Mz-%Dz-%Y"
2005 GRID LOAD FILE_GRID.CTL,0,0,""; FILT_CNT=0
2010 ! GOSUB USER_DEF_SETUP
2040 READ (_FIL_NO,KEY="",DOM=*NEXT)
2110 NEXT_AR1:
2125 KQ$=KEY(_FIL_NO,END=END_LOAD_FILTERS)
2130 READ (Z[1],KEY=KQ$,END=END_LOAD_FILTERS)
2132 IF STP(ELINK_FLG$,2)="" OR ELINK_FLG$="N" THEN GOTO NEXT_AR1
2133 CUSTID$=CUST_DIV$+CUST_CODE$
2134 CUSTOMER$=CUST_DIV$+"-"+CUST_CODE$
2135 ! CALL "ZZWLKU;PARSE_CUST",CUSTOMER$,CUST_DIV$,CUST_CODE$; CUSTOMER$=CUST_DIV$+CUST_CODE$
2138 ECUST$=EQD_CUST$
2140 FILT_CNT++
2200 LOAD_GRID_LINE:
2220 GOSUB CLEAR_READONLY ! SSP#253613
2235 GRID LOCK FILE_GRID.CTL,0,0; IF FILT_CNT THEN GRID UNLOCK FILE_GRID.CTL,1,0
2250 GRID LOAD FILE_GRID.CTL,1,0,SEP+ECUST$+SEP+CUSTOMER$+SEP+CUST_NAME$+SEP+CUSTID$+SEP; ++FILT_CNT
2260 ! EMAIL_GRID.CTL'ROW=GRID_ROW,EMAIL_GRID.CTL'COLUMN=7,EMAIL_GRID.CTL'ROWHEIGHT=1.8,EMAIL_GRID.CTL'FONT$="MS Sans Serif,-9,B",EMAIL_GRID.CTL'ALIGN$="C",EMAIL_GRID.CTL'BACKCOLOUR$="Light Gray",EMAIL_GRID.CTL'TEXTCOLOUR$="Black" ! Set BUTTON    column                         
2290 GOTO NEXT_AR1
2299 ! 
2300 END_LOAD_FILTERS:
2310 IF NOT(FILT_CNT) THEN MSGBOX ("No customers selected to  Process"); GOSUB CLEAR_REC; GRID LOAD FILE_GRID.CTL,1,0,SEP
2315 CLEAR_GRID:! SSP 304343
2320 GRID LOCK FILE_GRID.CTL,0,0; IF FILT_CNT THEN GRID UNLOCK FILE_GRID.CTL,1,0
2340 REFRESH_FLG=1
2350 EXIT 
3500 USER_DEF_SETUP:
3510 ASV_CHL=HFN; OPEN (ASV_CHL)"ASV"+%C$
3515 CFIELD$=""
3520 K9$="C"; GOSUB FIND_UDF
3530 CLOSE (ASV_CHL)
3535 RETURN 
3540 ! 
3545 FIND_UDF:
3550 READ (ASV_CHL,KEY=K9$,DOM=*NEXT)
3555 NEXT_ASV:
3560 DIM A$(150),A[3]; KV$=KEY(ASV_CHL,END=END_FIND); READ (ASV_CHL,KEY=KV$)ASV$
3565 IF ASV$(1,1)<>K9$ THEN GOTO END_FIND
3570 DFLD$=UCS(STP(MID(ASV$,6,75),2))
3575 IF K9$="C" AND POS("EQD"=DFLD$)<>0 THEN CFIELD$=KV$(2,4)
3590 GOTO NEXT_ASV
3595 END_FIND:RETURN 
4000 CLEAR_REC:
4090 RETURN 
4500 CLEAR_READONLY:
4510 RETURN 
5000 EQD_CUST:
5010 ! Find UDF for customer to get EQ-LINK Customer code
5020 DIM ASW$(100); IF CFIELD$<>"" THEN FIND (Z[2],KEY=CUST_DIV$+CUST_CODE$+CFIELD$,DOM=*NEXT)ASW$
5030 ECUST$=STP(ASW$(15,75),2); IF ECUST$="" THEN ECUST$=CUST_CODE$(3)
5050 RETURN 
9999 END 
10300 ! 
10500 ! 
10505 CHECK_SELECTED:
10510 FIND (PRESEL,KEY=PAD(STP(WRK.TF_NAME$,2),60),DOM=*NEXT); IS_SEL$="1"
10545 RETURN 
10549 ! 
56000 ! 
56001 REM "307387-EQLink DBD Bridge to Qnet                                   
