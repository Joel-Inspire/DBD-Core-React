0010 REM ""EC Support Issue Close issue processing <EC4CL1>"
0020 SETESC 9300; SETERR 9000
0035 REM "5.3 - 05/11/04 - 15.19 - jme - SSP# 171390
0040 REM "Copyright 2004 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT
0100 SETERR 9000
0110 X0$="EC4CL1",X1$="EC Support Issue Close Issue Processing"
0120 EOL$=$0D0A$; REM EOL$=ATH(STP(EC_PARM$(57,8),1))
0127 HTML_TEXT$="Content-type: text/html"
0140 DIM MESS_INFO$[20],EC_PARM$(1275)
0210 DIM ESA$(1540),ESA2$(1000)
0220 DIM ESB$(1984),ESB[3]
0230 DIM ESY$(512)
0240 DIM ECC$(1984),ECC[3]
0250 DIM ESZ$(128),ESZ[18]
0260 DIM SS1$(726)
0270 DIM ZW2$(411),ZW2[3]
0300 DIM ZWT$(126)
0310 IOLIST ESA$,ESA2$
0320 IOLIST ESB$,ECB[0],ECB[1],ECB[2]
0330 IOLIST ESY$
0340 IOLIST ECC$,ECC[0],ECC[1],ECC[2]
0350 IOLIST ESZ$,ESZ[0],ESZ[1],ESZ[2],ESZ[3],ESZ[4],ESZ[5],ESZ[6],ESZ[7],ESZ[8],ESZ[9],ESZ[10],ESZ[11],ESZ[12],ESZ[13],ESZ[14],ESZ[15],ESZ[16],ESZ[17],ESZ[18]
0360 IOLIST SS1$
0370 IOLIST ZW2$,ZW2[0],ZW2[1],ZW2[2]
0380 IOLIST ZW9A$,ZW9B$
0400 IOLIST ZW7A$,ZW7B$
0410 IOLIST ZW8A$
0420 IOLIST ZWT$
0500 REM "Open files
0505 DIM Z[NUM(X3$(60,3))],BLGRBNKS$(100)
0510 Z$="010 ESA... 02O ESB... 03O ESY... 04O ESC... 05O ESZ... 06O SS1    07O ZW2    08O ZW9    09O ZWD    10O ZWY    11O ZW8    12O ZWT    13O ZWE    14O ZWF    15O ZWH    "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
1490 SET_PARAM -'XI'
1500 ZW2KY$=KEY(Z[7],END=9900); IF ZW2KY$(1,1)<>"G" THEN GOTO 9900
1510 READ (Z[7],KEY=ZW2KY$)IOL=0370
2990 GOTO 9900
4000 REM process zw1 records
4005 ISSDET=0,LINE$=""
4010 ZW2KY$=KEY(Z[7],END=*RETURN); IF ZW2KY$(1,10)<>%CLIENT$ THEN GOTO *RETURN ELSE READ (Z[7],KEY=ZW2KY$,DOM=*SAME)IOL=0370; IF ZW2$(195,1)="C" THEN READ (Z[7],KEY=%CLIENT$+"D",ERR=*SAME); GOTO *SAME ELSE IF POS(ZW2$(195,1)="FYEL")>0 THEN GOTO *SAME
4015 IF BEGDT$="" THEN BEGDT$=DTE(0:"%Mz/%Dz/%Y"); MT=NUM(BEGDT$(1,2)),YR=NUM(BEGDT$(7,4)); MT=MT-1; IF MT<1 THEN MT=12,YR=YR-1 END_IF ; BEGDT$(1,2)=STR(MT:"00"),BEGDT$(7,4)=STR(YR:"0000")
4020 STATDT$=FND$(ZW2$(196,6))
4030 REM IF STATDT$(7,4)+STATDT$(1,2)+STATDT$(4,2)<BEGDT$(7,4)+BEGDT$(1,2)+BEGDT$(4,2) THEN GOTO 4010
4050 ISSDET=1
4090 LINE$=WKLINE$
4095 RETURN 
4100 REM ' get detail tags
4105 WKLINE$="",LINE$=""
4110 READ (100,END=*NEXT)DLINE$; IF POS("?ss?issueend?"=DLINE$)=0 THEN WKLINE$=WKLINE$+DLINE$+EOL$; GOTO *SAME
4150 READ (Z[7],KNO=1,KEY=%CLIENT$,ERR=4151)
4190 RETURN 
5000 REM print tag desc html
5010 LINE$=TAG$+" "+TAGDESC$
5090 RETURN 
5100 ADD_MSG_TO_LOG:! Add message to log file
5110 MOUT$="SESSION ID|"+EC$[1](1,7)+"|FILE|"+%WEBEC_FILE_NAME$+"|WORKSHEET|"+ECD$(1,10)+"|LINE|"+ECE$(25,3)+"|MESSAGE NO|"+STR(MESSAGE_NO:"00000")+"|MESSAGE|"+MESSAGE$+"|"
5135 MX=FN%_LOG_MESSAGE("MESG",MOUT$)
5145 RETURN 
5149 ! 
5490 RETURN ! 5200
5500 REM create description html
5590 RETURN 
8150 BYB_PROCESSING:! Send LINE$ to EC3BYB for generic fields processing
8160 CALL "EC3BYB",ERR=8161,X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT,LINE$,BYBINFO${ALL},BYBOPTIONS$
8195 RETURN 
8910 DEF FND$(Z9$)=Z9$(3,2)+"/"+Z9$(5,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
9000 REM "ERROR PROCESSING
9002 J=ERR,K=TCB(5); SETERR 0000; ENDTRACE 
9010 %WEBSSERR$="ERR: "+STR(J)+" AT: "+STR(K)+" IN "+PGN
9090 GOTO 9900
9835 DEF FNE$(Z0$)=CHR(NUM(Z0$(1,3))-190+65)+Z0$(4,1)
9900 REM "End
9901 SET_PARAM 'XI'
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9950 EXIT 
9999 END 
