0010 REM "Generic String Parsing Pgm <EC3BYD>
0020 SETESC 9300; SETERR 9000
0035 REM "5.1 - 09/17/02 - 9.976666 - wab - SSP# 135020
0040 REM "Copyright 2002 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 REM "tags should be of following format: LET STRING_TAGS$="001<USER>002<CUST_CODE>003<PASSWORD>"
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,EC_PARM$,EC${ALL},TAG_HDR$,TAG_TERMINATOR$,STRING_TAGS$,NUM_TAGS,TAG_VALUES${ALL},STRING$
0100 SETERR 9000
0110 X0$="EC3BYD",X1$="E/C Generic String Parsing Program"
0120 EOL$=$0D0A$
1000 REM "mainline
1506 REM "Setup line_tags$
1515 INDEX=POS(TAG_HDR$=STRING$); IF INDEX=0 THEN GOTO 4000
1520 END_INDEX=POS(TAG_TERMINATOR$=STRING$(INDEX+LEN(TAG_HDR$))),TAG$=STRING$(INDEX+4,END_INDEX-1),STRING1$=STRING$(1,INDEX-1),STRING2$=STRING$(INDEX+END_INDEX+4),LPOS=POS("<"+TAG$+">"=STRING_TAGS$); IF LPOS=0 THEN LINDEX=0 ELSE LINDEX=NUM(STRING_TAGS$(LPOS-3,3))
1530 GOSUB 2000; GOTO 1515
1995 GOTO 4000
1999 REM "Get tag value & substitute
2001 STRING$=STRING1$+TAG_VALUES$[LINDEX]+STRING2$; GOTO 2095
2095 RETURN 
2150 REM "Return CATEGORY_LIST$ as HTML for drop down list
2155 CATEGORY_LIST$="",PUBLISHED$=EC$[6],HOLD_ECG$=ECG$; REM "133591
2157 IF LEN(STP(PUBLISHED$,2))=0 THEN GOTO 2195
2158 IF POS("<!"=STRING1$)<>0 THEN STRING1$=STRING1$(1,POS("<!"=STRING1$)-1); REM "Remove start of comment if there
2159 FOR PP=0 TO LEN(PUBLISHED$)/10-1; CURRCAT$=PUBLISHED$(PP*10+1,10)
2160 READ (Z[4],KEY=CURRCAT$,DOM=2180)IOL=0340
2163 IF CATEGORY$="" THEN IF PP=0 THEN SELECTED$="<option selected"; GOTO 2165 ELSE SELECTED$="<option"; GOTO 2165
2164 IF CATEGORY$<>"" THEN IF CURRCAT$=CATEGORY$ THEN SELECTED$="<option selected" ELSE SELECTED$="<option"
2165 CATEGORY_LIST$=CATEGORY_LIST$+SELECTED$+" value="+QUO+CURRCAT$+QUO+">"+ECG$(11,30)+"</option>"; REM "if first item in list (pp=0) then set to be SELECTED as the initial value in the dd list
2180 NEXT PP
2185 STMP=POS("</select>"=STRING1$,-1); IF STMP<>0 THEN CATEGORY_LIST$=CATEGORY_LIST$+"</select>"; IF STMP=1 THEN STRING1$="" ELSE STRING1$=STRING1$(1,STMP-1)
2186 IF STRING2$>"" THEN IF STRING2$(1,1)=">" THEN STRING2$=STRING2$(2); REM "if token was part of a comment, then remove the end of the comment.
2195 ECG$=HOLD_ECG$; RETURN ; REM "133591
2200 REM "Store category header template into CAT_TEMPLATE$, it will be used in the entry section
2204 CAT_TEMPLATE$=STRING$,STRING$=""
2205 READ (100,END=2206)STRING$; GOSUB 7550
2206 IF POS("?tf?categoryend?"=STRING$)<>0 THEN GOTO 2209 END_IF ; INDEX=POS("?tf?"=STRING$); IF INDEX=0 THEN GOTO 2209; REM "searching for tags within the category heading section
2207 END_INDEX=POS("?"=STRING$(INDEX+4)),TAG$=STRING$(INDEX+4,END_INDEX-1),STRING1$=STRING$(1,INDEX-1),STRING2$=STRING$(INDEX+END_INDEX+4),LPOS=POS("<"+TAG$+">"=STRING_TAGS$); IF LPOS=0 THEN LINDEX=0 ELSE LINDEX=NUM(STRING_TAGS$(LPOS-3,3))
2208 GOSUB 2000; REM "process tags within the category section
2209 CAT_TEMPLATE$=CAT_TEMPLATE$+STRING$+EOL$; IF POS("?tf?categoryend?"=STRING$)=0 THEN GOTO 2205
2230 STRING$=""
2245 RETURN 
4000 REM "complete
4100 GOTO 9900
8910 DEF FND$(Z9$)=Z9$(1*2+1,2)+"/"+Z9$(7-1*2,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
9000 REM "ERROR PROCESSING
9002 J=ERR,K=TCB(5); SETERR 0000; ENDTRACE 
9010 LAST_WEBEC_ERR$="ERR: "+STR(J)+" AT: "+STR(K); LAST_WEBEC_ERR$=GBL("LAST_WEBEC_ERR",LAST_WEBEC_ERR$); REM "131928
9090 GOTO 9900
9900 REM "End
9950 EXIT 
9999 END 
