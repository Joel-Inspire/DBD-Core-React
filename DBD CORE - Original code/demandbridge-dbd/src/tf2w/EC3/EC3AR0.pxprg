0010 REM "EC Customer Status <EC3AC0>
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 01/09/19 - 11.035277 - dmm - SSP# 303115
0037 REM "303115-FN%HTML_ESC$ additions in EC programs                       
0040 REM "Copyright 2019 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT
0100 SETERR 9000
0110 X0$="EC3AC0",X1$="E/C Customer Status"
0120 EOL$="" ! $0D0A$; EOL$=ATH(STP(EC_PARM$(57,8),1))
0130 NY$="NY"
0310 IOLIST AR1$,AR1[0],AR1[1],AR1[2],AR1[3],AR1[4],AR1[5],AR1[6],AR1[7],AR1[8],AR1[9],AR1[10],AR1[11],AR1[12],AR1[13],AR1[14],AR1[15]
0320 IOLIST ARPARM$(1,LEN(ARPARM$)),ARPARM[0],ARPARM[1],ARPARM[2],ARPARM[3],ARPARM[4],ARPARM[5],ARPARM[6],ARPARM[7],ARPARM[8]
0500 REM "Open files
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O AR1...  13O ZZPARM "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0524 IF EC$[2](1066,1)<>"Y" THEN GOTO 9900
0525 GOSUB SET_READONLY
0600 REM "Build search strings
0910 CALL "ZZDISP","AX",EC$[2](51,10),"A/R",X3$,CUST_CODE$,"",0,0,X4$
1000 REM "Process DATA array
1005 DATA_TAGS$="001<template>"
1006 DISPLAY_INVOICE$=""
1010 FOR I=1 TO NUM_ENTRIES
1015 TAG$=DATA$[I,0],VALUE$=DATA$[I,1]
1018 DPOS=POS("<"+TAG$+">"=DATA_TAGS$); IF DPOS=0 THEN GOTO 1090 ELSE DINDEX=NUM(DATA_TAGS$(DPOS-3,3),ERR=1090)
1019 ON DINDEX GOTO 1090,1021,1090
1021 TEMPLATE$=VALUE$; GOTO 1090; REM "template
1090 NEXT I
1100 REM "
1101 VERSION$="20080808",PROGRAM$=PGN; DIM BYBINFO$[5]; BYBINFO$[1]=PROGRAM$,BYBINFO$[2]=VERSION$,BYBINFO$[3]=TEMPLATE$,BYBOPTIONS$=""
1105 GOSUB 3200
1500 REM "Use template$ to open file, read line by line and insert
1501 IF %BASIC2$<>"" THEN GOTO 1995; REM "156580
1505 CLOSE (100); OPEN (100,OPT="TEXT",ERR=9000)TEMPLATE$
1506 REM "Setup customer info tags
1507 LINE_TAGS$="001<cust_code_ar1>002<cust_name>003<cust_addr_1>004<cust_addr_2>005<cust_city>006<cust_st>007<cust_zip_code>008<purch_agent>009<cust_fax>010<cust_phone>011<date_setup>012<aged_as_of_date>013<alt_cust_code>014<reorder_num_months>015<united_account>016<csr_web_orders>017<market_channel>018<job_card>019<cust_bal>020<future_bal>021<curr_bal>022<age_bal_1>023<age_bal_2>024<age_bal_3>025<age_bal_4>026<open_order_amt>027<age_lbl_0>028<age_lbl_1>029<age_lbl_2>030<age_lbl_3>031<age_lbl_4>"
1510 READ (100,END=1595)LINE$; GOSUB 7650
1515 INDEX=POS("?tf?"=LINE$); IF INDEX=0 THEN PRINT (OUTPUT)LINE$,EOL$,; GOTO 1510
1520 END_INDEX=POS("?"=LINE$(INDEX+4)),TAG$=LINE$(INDEX+4,END_INDEX-1),LINE1$=LINE$(1,INDEX-1),LINE2$=LINE$(INDEX+END_INDEX+4),LPOS=POS("<"+TAG$+">"=LINE_TAGS$); IF LPOS=0 THEN LINDEX=0 ELSE LINDEX=NUM(LINE_TAGS$(LPOS-3,3))
1530 GOSUB 3300; GOTO 1515
1995 GOTO 9900
3200 REM "Read in customer information
3205 GOSUB SET_READONLY
3208 DIM AR1$(599),AR1[15]; FIND (Z[1],KEY=EC$[2](51,10),DOM=3240)IOL=0310
3210 DIM ARPARM$(255),ARPARM[8]; FIND (Z[13],KEY=X3$(9,3)+"A/R",DOM=*NEXT)IOL=0320
3244 GOSUB CLEAR_READONLY
3245 RETURN 
3300 REM "Display customer information
3310 ON LINDEX GOTO 3389,3311,3312,3313,3314,3315,3316,3317,3318,3319,3320,3321,3322,3323,3324,3325,3326,3327,3328,3329,3330,3331,3332,3333,3334,3335,3336,3337,3338,3339,3340,3341,3389
3311 CALL "ZZDISP","AX",AR1$(1,10),"A/R",X3$,CUST_CODE$,"",0,0,X4$; LINE$=LINE1$+FN%HTML_ESC$(CUST_CODE$)+LINE2$; GOTO 3390; REM "cust_code_ar1 SSP303115
3312 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(11,35),1))+LINE2$; GOTO 3390; REM "cust_name SSP303115
3313 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(56,30),1))+LINE2$; GOTO 3390; REM "cust_addr_1 SSP303115
3314 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(86,30),1))+LINE2$; GOTO 3390; REM "cust_addr_2 SSP303115
3315 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(116,16),1))+LINE2$; GOTO 3390; REM "cust_city SSP303115
3316 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(132,2),1))+LINE2$; GOTO 3390; REM "cust_st SSP303115
3317 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(134,9),1))+LINE2$; GOTO 3390; REM "cust_zip_code SSP303115
3318 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(165,20),1))+LINE2$; GOTO 3390; REM "purch_agent SSP303115
3319 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(143,12),1))+LINE2$; GOTO 3390; REM "cust_fax SSP303115
3320 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(205,14),1))+LINE2$; GOTO 3390; REM "cust_phone SSP303115
3321 CALL "ZZDISP","DX",AR1$(229,6),"",X3$,DATE1$,"",0,0,X4$; LINE$=LINE1$+FN%HTML_ESC$(DATE1$)+LINE2$; GOTO 3390; REM "date_setup SSP303115
3322 CALL "ZZDISP","DX",AR1$(391,6),"",X3$,DATE1$,"",0,0,X4$; LINE$=LINE1$+FN%HTML_ESC$(DATE1$)+LINE2$; GOTO 3390; REM "aged_as_of_date SSP303115
3323 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(411,20),1))+LINE2$; GOTO 3390; REM "alt_cust_code SSP303115
3324 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(434,2),1))+LINE2$; GOTO 3390; REM "reorder_num_months SSP303115
3325 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(436,6),1))+LINE2$; GOTO 3390; REM "united_account SSP303115
3326 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(442,4),1))+LINE2$; GOTO 3390; REM "csr_web_orders SSP303115
3327 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(446,10),1))+LINE2$; GOTO 3390; REM "market_channel SSP303115
3328 LINE$=LINE1$+FN%HTML_ESC$(STP(AR1$(456,15),1))+LINE2$; GOTO 3390; REM "job_card SSP303115
3329 LINE$=LINE1$+FN%HTML_ESC$(STR(AR1[6]:"-$###,###.00"))+LINE2$; GOTO 3390; REM "cust_bal SSP303115
3330 LINE$=LINE1$+FN%HTML_ESC$(STR(AR1[7]:"-$###,###.00"))+LINE2$; GOTO 3390; REM "future_bal SSP303115
3331 LINE$=LINE1$+FN%HTML_ESC$(STR(AR1[8]:"-$###,###.00"))+LINE2$; GOTO 3390; REM "curr_bal SSP303115
3332 LINE$=LINE1$+FN%HTML_ESC$(STR(AR1[9]:"-$###,###.00"))+LINE2$; GOTO 3390; REM "age_bal_1 SSP303115
3333 LINE$=LINE1$+FN%HTML_ESC$(STR(AR1[10]:"-$###,###.00"))+LINE2$; GOTO 3390; REM "age_bal_2 SSP303115
3334 LINE$=LINE1$+FN%HTML_ESC$(STR(AR1[11]:"-$###,###.00"))+LINE2$; GOTO 3390; REM "age_bal_3 SSP303115
3335 LINE$=LINE1$+FN%HTML_ESC$(STR(AR1[12]:"-$###,###.00"))+LINE2$; GOTO 3390; REM "age_bal_4 SSP303115
3336 LINE$=LINE1$+FN%HTML_ESC$(STR(AR1[13]:"-$###,###.00"))+LINE2$; GOTO 3390; REM "open_order_amt SSP303115
3337 LINE$=LINE1$+FN%HTML_ESC$(STP(MID(ARPARM$,48,8),1))+LINE2$; GOTO 3390; REM "age_lbl_0 SSP303115
3338 LINE$=LINE1$+FN%HTML_ESC$(STP(MID(ARPARM$,56,8),1))+LINE2$; GOTO 3390; REM "age_lbl_1 SSP303115
3339 LINE$=LINE1$+FN%HTML_ESC$(STP(MID(ARPARM$,64,8),1))+LINE2$; GOTO 3390; REM "age_lbl_2 SSP303115
3340 LINE$=LINE1$+FN%HTML_ESC$(STP(MID(ARPARM$,72,8),1))+LINE2$; GOTO 3390; REM "age_lbl_3 SSP303115
3341 LINE$=LINE1$+FN%HTML_ESC$(STP(MID(ARPARM$,80,8),1))+LINE2$; GOTO 3390; REM "age_lbl_4 SSP303115
3389 LINE$=LINE1$+"?"+LINE2$; GOTO 3390; REM "tag not found, replace with '?'
3395 RETURN 
7400 SET_READONLY:
7410 SET_PARAM 'XI'
7420 SET_READONLY_END:RETURN 
7430 CLEAR_READONLY:
7435 SET_PARAM -'XI'
7440 CLEAR_READONLY_END:RETURN 
7650 REM "Send LINE$ to EC3BYB for generic fields processing
7660 CALL "EC3BYB",ERR=7661,X3$,X4$,EC_PARM$,EC${ALL},DATA${ALL},NUM_ENTRIES,OUTPUT,LINE$,BYBINFO${ALL},BYBOPTIONS$,100
7695 RETURN 
8910 DEF FND$(Z9$)=Z9$(1*2+1,2)+"/"+Z9$(7-1*2,2)+"/"+STR((ASC(Z9$(1,1))-65)*10+1900+NUM(Z9$(2,1))-1570*POS("  "=Z9$(1,2)):"####")
8915 DEF FNT$(Z9$)=STR(NUM(Z9$(1,2))-12*POS("13"<=Z9$(1,2),2)+12*POS("00"=Z9$(1,2)):"00")+":"+STR(NUM(Z9$(3,2))*.6:"00")+" "+CHR(65+15*POS("12"<=Z9$(1,2),2))+"M"
9000 REM "ERROR PROCESSING
9002 J=ERR,K=TCB(5); SETERR 0000; ENDTRACE 
9005 GOSUB CLEAR_READONLY
9010 LAST_WEBEC_ERR$="ERR: "+STR(J)+" AT: "+STR(K); LAST_WEBEC_ERR$=GBL("LAST_WEBEC_ERR",LAST_WEBEC_ERR$); REM "131928
9090 GOTO 9900
9900 REM "End
9905 GOSUB CLEAR_READONLY
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9950 EXIT 
9999 END 
56001 REM "220527-Create new programs/pages to display cust info, open invoice
56002 REM "303115-FN%HTML_ESC$ additions in EC programs                       
