0010 REM "Load quantity break variables <EC3QB1>
0020 SETESC 9300; SETERR 9000
0035 REM "5.3 - 09/02/04 - 12.345555 - dmm - SSP# 175232
0040 REM "Copyright 2004 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0051 REM "QTYBREAKS_INEFFECT$ (returned)  N - single tier pricing  Y - more than one tier
0055 ! OPTIONS$(1,1)="Y" means use_alt_um_qb set to Y coming from EC3PC1
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,EC_PARM$,EC${ALL},STOCK$,FLAGGED_STOCK$,FMPCHANNEL,ECR$,IC0$,IC0{ALL},AR1$,Q{ALL},P{ALL},BREAKQTY${ALL},BREAKPRICE${ALL},BREAKALL${ALL},BREAKRANGE${ALL},BREAKRANGEALL${ALL},QTYBREAKS_INEFFECT$,OPTIONS$; REM "157200A
0100 SETERR 9000
0110 X0$="EC3QB1",X1$="Load qty break variables"
0120 DIM Z0$(80,"-")
0130 K0=20,K1=1
0135 C9=-1
0200 REM "                                                                 
0240 REM "*CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0295 DIM Z0$(80,X3$(235,1)); Z0$=ESC+"BG"+Z0$+ESC+"EG"
0300 REM "IOLISTS                                                          
0310 IOLIST A$
0320 IOLIST B$
0500 REM "FILES                                                            
0505 DIM Z[NUM(X3$(60,3))]
0510 Z$="01O XXX...  02O XXX...  13O ZZPARM  "
0520 REM "*CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0600 REM "                                                                 
1000 REM "BEGIN MAIN PROCESS                                               
1010 GOSUB 7950
1020 IF Q[1,0]=0 THEN QTYBREAKS_INEFFECT$="N" ELSE QTYBREAKS_INEFFECT$="Y"; REM "157200
1900 GOTO 5000
5000 REM "EOJ                                                              
5040 GOTO 9900
6000 REM "BACKGROUND                                                       
6190 RETURN 
7950 REM "break variables
7951 REM "BI - passed in containing break level to process
7952 REM "returns the formatted tag values on line 7960
7953 REM "BREAKQTY$ = 10 BOX/50"
7954 REM "BREAKPRICE$ = $105.00"
7955 REM "BREAKALL$ = "10 BOX/50 AT $105.00 PER BOX"
7956 REM "BREAKRANGE$ = "1 TO 10 BOX/50"
7957 REM "BREAKRANGEALL$ = "1 TO 10 BOX/50 AT $105.00 PER BOX"
7959 DIM BREAKQTY$[12],BREAKPRICE$[12],BREAKALL$[12],BREAKRANGE$[12],BREAKRANGEALL$[12]
7960 IF STOCK$<>"Y" AND FLAGGED_STOCK$<>"Y" AND ECR$(253,1)<>"I" THEN DIM Q[12,1]; GOTO 7995; REM "157200.  SSP167703.
7961 SELL_UM$=IC0$(120,4); IF IC0[14]=0 THEN BPACK=1 ELSE BPACK=IC0[14]
7962 IF EC_PARM$(557,1)="Y" THEN QBB$="<br>" ELSE QBB$=""; REM "insert break before returned quantity beaks - 157200
7964 %BPACK=0,%SELL_UM$="" ! WO175232
7965 CALL "EC3UTE",X3$,X4$,EC_PARM$,EC${ALL},FMPCHANNEL,IC0$,IC0{ALL},AR1$(398,3),Q{ALL},P{ALL},OPTIONS$
7966 IF MID(OPTIONS$,2,1)="Y" THEN BPACK=%BPACK,SELL_UM$=%SELL_UM$ ! WO175232, using alt unit logic
7967 %BPACK=0,%SELL_UM$="" ! WO175232
7970 FOR BI=0 TO 12; REM "base price to qty break 12 - ssp 157200
7971 IF BI=1 THEN IF Q[BI,0]=0 THEN NOBKTXT$=STP(EC_PARM$(754,35),2),BREAKQTY$[BI]=NOBKTXT$,BREAKALL$[BI]=NOBKTXT$,BREAKRANGE$[BI]=NOBKTXT$,BREAKRANGEALL$[BI]=NOBKTXT$; GOTO 7987; REM "ssp 157200
7972 IF Q[BI,0]<>0 THEN BREAKQTY$[BI]=STP(STP(STR(Q[BI,1]:"###,##0"),2)+" "+STP(SELL_UM$,2)+"/"+STP(STR(BPACK:"###0"),2),2); REM "ssp 157200 "
7974 IF P[BI]<>0 THEN BREAKPRICE$[BI]=STP(X3$(69,1)+STP(STR(P[BI]:"###,##0.00"),2),2); REM "ssp 157200"
7976 IF Q[BI,0]<>0 THEN BREAKALL$[BI]=STP(STR(Q[BI,1]:"###,##0"),2)+" "+STP(SELL_UM$,2)+"/"+STP(STR(BPACK:"###0"),2)+" at "+BREAKPRICE$[BI]; REM "ssp 157200  "
7980 IF Q[BI,0]=0 THEN GOTO 7987
7982 IF BI=12 THEN TORANGE$=" and Over" ELSE IF Q[BI+1,0]<>0 THEN TORANGE$=" to "+STP(STR(INT(Q[BI+1,1]-1):"###,##0"),2) ELSE TORANGE$=" and Over"
7984 BREAKRANGE$[BI]=STP(STR(Q[BI,1]:"###,##0"),2)+TORANGE$+" "+STP(SELL_UM$,2)+"/"+STP(STR(BPACK:"###0"),2)
7985 BREAKRANGEALL$[BI]=STP(STR(Q[BI,1]:"###,##0"),2)+TORANGE$+" "+STP(SELL_UM$,2)+"/"+STP(STR(BPACK:"###0"),2)+" at "+BREAKPRICE$[BI]
7988 NEXT BI
7990 FOR BI=0 TO 12; REM "ssp 157200 - add on breaks
7991 IF BI<>0 AND Q[BI,0]<>0 THEN BREAKQTY$[BI]=QBB$+BREAKQTY$[BI],BREAKALL$[BI]=QBB$+BREAKALL$[BI],BREAKRANGE$[BI]=QBB$+BREAKRANGE$[BI],BREAKRANGEALL$[BI]=QBB$+BREAKRANGEALL$[BI]; REM "ssp 157200
7992 NEXT BI; REM "ssp 157200
7995 RETURN 
8950 DEF FNS$(Z9$)=Z9$(1,POS("     "=Z9$+"     ")-1)
9000 REM "ERROR PROCESSING                                                 
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL                                
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC                                       
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM                                      
9910 REM "*CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
