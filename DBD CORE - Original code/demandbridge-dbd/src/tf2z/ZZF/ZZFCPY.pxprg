0010 REM "File copy Utility <ZZFCPY>
0030 REM "(C) 1985-1987 Basic Ideas, Inc; Atlanta, GA. USA
0035 REM "This software contains trade secrets and proprietary information"
1010 SETERR 1011; ENTER X3$,X0$,F0$,F1$,D0,D1,K0$,X9; GOTO 1030
1020 SETERR 9800; IF X3$="?" THEN CALL "ZZPDOC","ZZFCPY"; EXIT ELSE EXIT ERR
1030 SETERR 9700
1080 DIM S$(20),Z[NUM(X3$(60,3))]
1085 I0=256,I1=1,I9=I0*I1,X9=-1; IF F1$>"" THEN F1$=F1$+S$(1,8-LEN(F1$))
1090 T0$="I?D?P?????A"
1095 IF POS("M"=X0$)>0 THEN GOTO 3200
1100 REM "
1105 F0$=F0$+S$; F0$=F0$(1,8)
1110 Z$="01OS"+F0$+" "+"02OS"+F0$
1120 GOSUB 9750; ON Z0 GOTO 1121,9800
1140 F0=Z[1],F1=Z[2]
1150 CALL "ZZINFO",Z[1],Z0,X3$,R0,R1,K,B,D,T0,S0,F$
1155 Q=40; GOSUB 8000; I1=Q
1200 REM 
1810 IF T0=0 OR T0=4 THEN GOSUB 2000; GOTO 1890
1815 IF T0=2 OR T0=3 AND K0$="" THEN GOTO 2000 ELSE GOTO 3000
1890 IF T0<>4 THEN GOTO 1950
1920 READ RECORD (F1,IND=0)I0$
1930 I0$(4,LEN(F1$))=F1$
1940 WRITE RECORD (F1,IND=0)I0$
1950 REM 
1960 CLOSE (Z[1]); CLOSE (Z[2])
1990 GOTO 9900
2000 REM "SIMPLE CASE - COPY FILE F0$ DIRECT
2010 Q$=FID(Z[1]),D=D1,F9$=F1$,S0=0,R=R1
2020 IF T0=4 THEN I2=256
2040 GOSUB 4800
2050 REM "OPEN FILES
2060 CLOSE (Z[1]); OPEN (Z[1],ISZ=I2,ERR=2100)F0$
2065 CLOSE (Z[2]); OPEN (Z[2],ISZ=I2,ERR=2100)F1$
2080 F0=Z[1],F1=Z[2]; GOSUB 5000
2095 RETURN 
2100 REM "ERROR ON OPEN
2110 IF ERR=33 OR ERR=32 THEN GOSUB 8050; GOTO 2050 ELSE GOTO 9000
2390 ESCAPE 
3000 REM "SELECTIVE COPY - DIRECT/SORT FILES
3020 Q9=0; GOSUB 5200
3030 IF R2=0 THEN R2=2
3035 CLOSE (Z[1]); OPEN (Z[1])F0$(1,8)
3050 CALL "ZZFDEF",ERR=3051,X3$,F1$,T0,K,R2,B,D1,0,"",0,0; GOTO 3055
3052 IF ERR<>12 THEN GOTO 9000
3055 CLOSE (Z[2]); OPEN (Z[2])F1$
3080 Q9=1; GOSUB 5200
3085 CLOSE (Z[1]); CLOSE (Z[2])
3090 GOTO 9900
3200 REM "MULTIPLE FILES - CHECK DIRECTORY
3205 F8$=F0$,F0$="",F7$=F1$,F1$=""; IF POS("E"=X0$)>0 THEN IF F7$="" THEN F7$=".T"
3210 CALL "ZZDDAT",X3$,V0$,V1$,V2,V3
3215 P=POS(STR(D0:"0")=V0$(1,V2)); IF P=0 THEN GOTO 9700 ELSE P=P-1
3220 Z$=V1$(P*V3+1,V3),Z$="03O "+Z$+S$(1,8-LEN(Z$))+"02OS"+Z$+S$(1,8-LEN(Z$))
3225 GOSUB 9750; ON Z0 GOTO 3226,9700
3230 R2=0,R3=0; P0=POS("?"=K0$),P1=POS("*"=K0$); IF P0=0 THEN P0=P1 ELSE IF P1>0 AND P1<P0 THEN P0=P1
3235 IF P0=0 THEN R2=1; GOTO 3236 ELSE P0=P0-1; EXTRACT (Z[3],KEY=K0$(1,P0),DOM=3236)
3250 REM "PROCESS DIRECTORY
3260 K$=KEY(Z[3],END=3295); K$=K$(1,8); IF LEN(K$)<P0 AND K$>K0$ THEN GOTO 3295 ELSE IF K$(1,P0)>K0$(1,P0) THEN GOTO 3295
3265 READ (Z[3]); IF K0$>"" THEN CALL "ZZFLTR",X3$,K0$,"",K$,Q0,Q1; IF Q0=0 THEN GOTO 3260
3270 Q$=K$; GOSUB 3300
3290 GOTO 3260
3295 GOTO 9900
3300 REM "COPY FILE K$ FROM CURRENT DISK TO DISK D1
3310 IF D0=D1 THEN GOTO 9700
3320 F0$=K$,F1$="-"+X3$(1,5); ERASE F1$,ERR=3321; GOTO 3320
3325 Z$="01CU        01L "+F0$(1,8); GOSUB 9750
3330 CALL "ZZINFO",Z[1],Z0,X3$,R0,R1,K,B,D,T0,S0,F$; R=R1,D=D1,Q=40; GOSUB 8000
3332 Q$=T0$(T0+1,1); IF POS("*"=F8$)=0 THEN IF POS(Q$=F8$)=0 THEN GOTO 3390
3334 PRINT @(40,22),'CL',"Copy file: ",K$,
3335 F9$=F1$,F0=Z[1],F1=Z[2]; GOSUB 3400
3338 CLOSE (F0); CLOSE (F1)
3340 Q$=F0$; IF POS("E"=X0$)>0 THEN Q$=Q$+S$,Q$=Q$(1,6)+F7$+S$,Q$=Q$(1,8)
3345 RENAME F1$,Q$
3395 RETURN 
3400 REM "SELECTIVE COPY
3405 IF POS("<"=X0$)>0 AND T0=2 THEN R=R0
3410 GOSUB 4800
3420 IF POS("<"=X0$)=0 OR T0<>2 THEN GOSUB 2050; GOTO 3490
3425 CLOSE (Z[1]); OPEN (Z[1])F0$
3430 CLOSE (Z[2]); OPEN (Z[2])F1$
3450 W9$=K0$,K0$="*",Q9=1; GOSUB 5200; K0$=W9$
3495 RETURN 
4800 REM "CREATE FILE F9$
4815 IF R=0 THEN R=1
4820 CALL "ZZINFO",0,Z0,X3$,R2,R3,K2,B2,D2,T2,0,F1$
4825 IF Z0>=0 THEN IF B2=B AND K2=K THEN GOTO 4841
4830 IF Z0>=0 THEN IF T2=0 OR T2=4 THEN ERASE F1$,ERR=4831; GOTO 4830
4840 CALL "ZZFDEF",X3$,F9$,T0,K,R,B,D,0,"",X0,X1
4895 RETURN 
5000 REM "PHYSICAL FILE COPY F0 TO F1
5005 J0=0,J1=I1,J2=J1*I0
5015 READ RECORD (F0,IND=J0,END=5090,SIZ=J2)I0$
5020 WRITE RECORD (F1,IND=J0,SIZ=J2)I0$
5040 J0=J0+1
5080 GOTO 5010
5095 RETURN 
5100 REM "END
5190 RETURN 
5200 REM "COUNT RECORDS IN KEY RANGE (Q9=0 COUNT ONLY, Q0=1 COPY TO Z(1)   )
5205 R2=0,R3=0; P0=POS("?"=K0$),P1=POS("*"=K0$); IF P0=0 THEN P0=P1 ELSE IF P1>0 AND P1<P0 THEN P0=P1
5207 IF K0$="*" AND Q9=0 THEN R2=R0; GOTO 5280
5220 IF P0=0 THEN R2=1; GOTO 5280 ELSE P0=P0-1; EXTRACT (Z[1],KEY=K0$(1,P0),DOM=5221)
5230 K$=KEY(Z[1],END=5280); IF LEN(K$)<P0 AND K$>K0$ THEN GOTO 5280 ELSE IF K$(1,P0)>K0$(1,P0) THEN GOTO 5280
5232 IF Q9=1 THEN READ RECORD (Z[1])A$ ELSE READ (Z[1])
5235 IF K0$<>"*" THEN CALL "ZZFLTR",X3$,K0$,"",K$,Q0,Q1 ELSE Q0=1
5240 IF Q0=1 THEN R2=R2+1; IF Q9>0 THEN GOSUB 5300
5260 GOTO 5230
5295 RETURN 
5300 REM "COPY RECORD
5302 I9$=K$; IF LEN(I9$)>14 THEN I9$=I9$(1,14)
5305 PRINT @(60,22),"Key: ",I9$,
5310 WRITE RECORD (Z[2],KEY=K$,END=5400)A$
5395 RETURN 
5400 REM "OVERFLOW
5405 PRINT @(0,0),F1$
5410 CALL "ZZEXPF",X3$,X4$,"X"+STR(Z[2]),F1$,X0
5490 GOTO 5310
8000 REM "GET SECTOR MULTIPLE OF S0 - RETURN IN Q
8010 FOR I1=Q TO 1 STEP -1; IF S0/I1=INT(S0/I1) THEN EXITTO 8020 ELSE NEXT I1
8020 I2=I0*I1
8045 RETURN 
8050 REM "NEXT ISZ DOWN - ERROR 32 ON OPEN
8055 Q=I1-1; GOTO 8000
8100 REM "ERROR 32 - GET NEXT SIZE DOWN
9700 REM "TROUBLE SPOT
9710 X9=TCB(5)+ERR/100
9740 EXIT 99
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9900 REM 
9910 SETERR 9940
9920 EXIT 
9999 END 
