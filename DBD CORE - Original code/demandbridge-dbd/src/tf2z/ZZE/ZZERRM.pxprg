0010 REM "ASG Std Error Processing <ZZERRM>
0030 REM "(C) 1985-1988 Basic Ideas, Inc; Atlanta, GA. USA
0035 REM "5.7 - 09/19/13 - 16.826666 - crg - SSP# 263771
0037 REM "263771-If we get a record is currently in use, if we are in GUI,   
0040 REM "Copyright 2013 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 ! IF %GUI THEN PERFORM "ERROR"; EXIT 
0110 SETESC 9300
1000 ENTER X0$,X1$,X2$,X3$,X0,X1,X2,X3,X4
1010 SETERR 9000; IF X3$="" THEN X2=2; GOTO 9000
1020 T0$=X3$(169,3); IF T0$<>FID(0)+" " THEN X3$(169,3)=FID(0) ELSE T0$=""
1031 STACK$=FN%GET_STACK$
1032 IF %IN_WEBEC$="Y" THEN LAST_WEBEC_ERR$="ERR: "+STR(X0)+" AT: "+STR(X1)+" IN "+X1$+STACK$,X2=2,LAST_WEBEC_ERR$=GBL("LAST_WEBEC_ERR",LAST_WEBEC_ERR$); GOTO 8400; REM "131928. SSP167651, not getting errors in log                                
1035 IF %UNATTEND AND (POS("PO2PAB"=STACK$)>0 OR POS("FM2RBC"=STACK$)>0) THEN %UNATTEND_ERROR$="ERR: "+STR(X0)+" AT: "+STR(X1)+" IN "+X1$+" STACK: "+STACK$; IF POS(">"=STACK$,1,0)>3 THEN X2=3; X2$="EXIT "+STR(X0) ELSE X2=2 END_IF ; GOTO 8400; REM "248040-Unattended printing errors will be recorded in log, no interactive prompts, only supported program at this time is PO2PAB; 257735-Added FM2RBC
1100 REM "
1102 IF X0=89 THEN X0=67
1105 IF X0<>33 THEN GOTO 1110 ELSE F0=1; GOSUB 6000; X2=2; GOTO 9010
1110 IF X0=66 THEN X2=4; GOTO 8062 ELSE IF X0=67 THEN X2$="RUN"+$22$+"ZSTART"+$22$,X2=3; GOTO 8400 ELSE IF X0=65 OR X0=64 THEN X2=0; GOTO 8400
1120 IF X0<>2 THEN GOTO 1200 ELSE X2=0,F0=1; GOSUB 6000
1130 CALL "ZZEXPF",X3$,X4$,"?","",Q; F0=0; GOSUB 6000; ON Q GOTO 1140,1150
1140 GOTO 8400
1200 REM "
1210 PRINT (0,ERR=1211)'EA',
1220 CALL "ZZPROM","XX",X3$,0,Q0$,"","",0; Q0$=Q0$+" ("+STR(X0:"000")+", "+X1$+"-"+STR(X1:"0000")+")"
1320 CALL "ZZPROM","ER"+STR(X0:"000"),X3$,0,Q$,"","SR",0; IF Q$>"" THEN Q0$=Q$
1390 GOTO 8000
6010 F0$="ZZFLESZZCOMPZZDISPZZTIME"
6015 FOR X=1 TO LEN(F0$) STEP 6; IF F0>0 THEN DROP F0$(X,6),ERR=6016 ELSE ADDR F0$(X,6),ERR=6016
6020 NEXT X; RETURN 
8000 REM "
8010 PRINT (0,ERR=8011)@(39-INT(LEN(Q0$)/2),21),Q0$,
8020 IF %IN_JOBSTREAM THEN GOTO 8047
8030 IF X0=0 THEN GOSUB DISPLAY_ERROR_0 ! 248257
8040 CALL "ZZPROM","X"+STR(X4:"0")+"ZZERRM",X3$,X2,"","","",0
8042 IF X3$(234,1)="1" THEN CALL "ZZERRL",X3$,X0,X1,X1$,X2
8045 IF NOT(%IN_JOBSTREAM) THEN GOTO 8055
8047 LOG=HFN; OPEN LOCK (LOG,ERR=*NEXT)"JSERR.log"; GOTO 8050
8048 SERIAL "JSERR.log"; GOTO 8047
8050 ERR_REC$=DAY+"|"+STR(TIM)+"|"+Q0$+"|"+STACK$; PRINT (LOG)ERR_REC$
8051 CLOSE (LOG); RELEASE 
8055 PRINT @(0,21),'CE',
8060 IF X2<3 THEN GOTO 8400 ELSE DIM Q$(68)
8062 IF X2=4 THEN X2$="SETERR0;RETRY"; GOTO 8090
8065 PRINT @(0,22),"Command:",
8070 L=LEN(Q$); CALL "ZZENTR","SXU",X{ALL},Q$,"",X3$,9,22,1,L,C0,"","Enter the Business Basic command to be executed","","","","",""; IF C0<0 THEN GOTO 8000
8075 IF STP(Q$,1)="ESCAPE" THEN ESCAPE ; EXIT 
8080 SETERR 8100; A$=CPL("0"+Q$); SETERR 0000
8090 X2$=FNS$(Q$),Q$=""; GOTO 8400
8100 REM "
8120 CALL P0$,"5",X3$,Q,"BAD COMMAND LINE. PRESS |RETURN TO RETRY OR TYPE |END","","",0
8130 ON Q GOTO 8065,8400
8400 REM "
8420 IF T0$>"" THEN X3$(169,3)=T0$
8450 EXIT 
8500 DISPLAY_ERROR_0:! 248257
8510 IF X0<>0 THEN RETURN 
8520 PSLINE$=FN%TCB87$("")
8527 IF NOT(NUL(PSLINE$)) THEN {
8529 TCBUSER$=""; OPEN (HFN)"ZZPARM"; ZZPARM=LFO; FIND (ZZPARM,KEY="o"+MID(PSLINE$,1,3),DOM=*NEXT)TCBUSER$
8531 CLOSE (ZZPARM)
8533 IF NUL(TCBUSER$) THEN TCBUSER$=" ** " ELSE TCBUSER$=STP(MID(TCBUSER$,5,30),2) END_IF ; PSLINE$=SUB(PSLINE$," ",", "+TCBUSER$+", ")
8535 PSLINE$="(User, Name, Process ID): "+PSLINE$
8537 PRINT (0,ERR=*NEXT)@(1,20),'BR',PAD(Q0$,78,2),'ER',@(1,21),'BR',PAD(MID(PSLINE$,1,78),78,2),'ER',
8539  }
8545 RETURN 
8549 ! 
8910 DEF FNS$(Q9$)=Q9$(1,POS("  "=Q9$+"   ")-1)
9000 EXIT 123
9010 X2$="SETERR0;RETRY"; GOTO 8090
9350 RETURN 
9999 END 
56002 REM "248257-Modify the Error Handler program to report more ERR 0 info
56003 REM "257735-EDI940; Trigger alternate packing list format for one end   
