0010 REM "Report Printing - End of Report <ZZERPT>
0030 REM "(C) 1985,1986,1987 Basic Ideas, Inc; Atlanta, Ga.
0035 REM "5.7 - 12/18/18 - 10.791666 - tma - SSP# 304752
0037 REM "304752-Printing AR Invoices and getting a syntex error message.    
0040 REM "Copyright 2018 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 ENTER X3$,X4$,P$,X$,X1$,W9,W2,W5,W,W0,W8,T3,V3$
0110 X0$="ZZERPT"
0200 DIM S$(10)
0210 X$=X$+S$(1,6-LEN(X$))
0420 IOLIST X3$,X4$,V1$,V2$,V3$,V0$
0460 IOLIST F0$,F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],F[8],F[9],F[10],F[11],F[12],F[13],F[14],F[15],F[16],F[17],F[18],F[19],F[20]
0520 IF %IL_PDF THEN CLOSE (%IL_PDF,ERR=*PROCEED); %IL_PDF=0
0530 IF W9=-1 THEN GOTO 1000
0532 JET_MODE=0,JET_PARM$=GBL("JET_PARM",ERR=0536) ! 237186
0534 JET_DEVICE=NUM(JET_PARM$,ERR=*NEXT) ! 237186
0536 IF JET_DEVICE>0 AND JET_DEVICE<>999 OR POS("-z "=OPT(W9)) THEN JET_MODE=1 ! 237186 - Unform channels will have a "-z " present in the options 
0540 DIM Y5$(80)
0550 IF W5=3 THEN CALL "ZZPROM","I",X3$,0,Q$,"","",0; GOSUB 7300; GOSUB 7300; Y5$(20)=Q$; GOSUB 7300
0610 ON W2 GOTO 0620,0630,0640,0650
0620 GOSUB 3500
0625 GOTO 0690
0630 ON W5 GOTO 0631,0636,4000
0631 CALL "ZZPROM","R3",X3$,X4,"","","",0
0635 ON X4 GOTO 0636,4000
0636 PRINT (W9,ERR=0637)'CS','T1',
0637 GOTO 0690
0640 GOSUB 3500
0642 PRINT (W9,ERR=0643)'EA',
0645 GOTO 0690
0995 IF W5=4 THEN GOTO 3000
1000 REM "Remove record from ZZP file"
1005 IF W9>0 THEN CLOSE (W9,ERR=*NEXT) ! SSP#304752
1010 DIM Z[NUM(X3$(60,3))]
1015 Z$="01O ZZP     02O ZZQ     06O ZZPARM  "
1020 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
1030 IF X9=1 THEN GOSUB 6000
1050 REMOVE (Z[1],KEY=X$,DOM=1051,ERR=1051)
2000 REM "Remove printing record from ZZQ"
2005 IF V3$>"" THEN REMOVE (Z[2],KEY=V3$(2,6),DOM=2006)
2006 READ (Z[2],KEY=V3$(2,6),DOM=2007)
2010 REM "Check for next record for this printer"
2015 IF V3$(1,1)<>"Q" THEN GOTO 3000
2020 K$=KEY(Z[2],END=3000)
2025 READ RECORD (Z[2],END=3000)A$
2026 IF K$(7,1)>="Z" THEN GOTO 2020
2030 IF K$(1,1)<>"G" THEN IF A$(1,6)<>V3$(2,6) THEN GOTO 3000
2100 REM "Put in ZZP and remove from ZZQ, and put it back as the current printing record"
2110 B$=FID(0)+S$,B$=B$(1,8)
2120 WRITE RECORD (Z[1],KEY=B$)SUB(A$(33),$00$,"") ! 240570
2130 REMOVE (Z[2],KEY=K$)
2135 X1$=A$(20,6)
2150 WRITE RECORD (Z[2],KEY=K$(1,6))A$
3000 REM "End of routine"
3090 GOTO 9900
3500 REM "Formfeed Routine"
3501 IF JET_MODE=1 THEN GOTO 3590
3502 IF W8=0 THEN GOTO 3590
3505 IF X3$(184,1)="1" THEN CALL "ZZPROM","X0ZZREST",X3$,0,Q$,"","",0; Y5$(20)=Q$; GOSUB 7300
3510 IF W0=58 THEN PRINT (W9,ERR=3511)'FF',; GOTO 3550
3520 FOR X=W+1 TO W0+8; PRINT (W9,ERR=3521)'LF',; NEXT X
3550 W8=W8+1,X9=1
3560 IF POS("G"=FID(0))<>1 THEN PRINT (0,ERR=3561)'CI',
3590 RETURN 
4000 REM "Routine to repeat the report"
4010 X1$=P$
4090 GOTO 3000
6000 REM "UPDATE FORMS DATA TEMP DISCONNECTED
6005 DIM F[20]; SETERR 6090
6010 EXTRACT (Z[6],ERR=6090,KEY="FORM"+V3$(17,1))IOL=0460
6020 F[2]=F[2]+W8,F[16]=F[16]+W8
6030 D0=NUM(X3$(23,2)),F[3+D0]=F[3+D0]+W8
6035 P0=0,P1=0
6040 FOR I=4 TO 15; IF F[I]<>0 THEN P0=P0+F[I],P1=P1+1; NEXT I ELSE NEXT I
6050 F[18]=P0/P1
6060 WRITE (Z[6],KEY="FORM"+V3$(17,1))IOL=0460
6090 SETERR 9000; RETURN 
7300 REM "Output line Y5$ to output device
7310 W=W+1
7330 IF POS(" "<>Y5$)=0 THEN PRINT (W9)"" ELSE PRINT (W9)Y5$; Y5$(1)=""
7395 RETURN 
9000 REM "ERROR PROCESSING
9010 E0=ERR,E1=TCB(5)
9015 SETERR 9016; E0$=LST(PGM(E1))
9016 SETERR 9000
9040 CALL "ZZERRM",E0$,X0$,E1$,X3$,E0,E1,E2,E3
9050 ON E2 GOTO 9060,9100,9900,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE E1$
9080 SETERR 9000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOTO 9800
9300 REM "ESCAPE
9390 RETURN 
9800 REM "ERROR DURING EXIT
9820 X0=1; GOTO 9900
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},Z0,Z1
9940 EXIT 
9999 END 
56001 REM "237186-Setup Unform device drivers and linkfiles to allow printing 
56002 REM "304752-Printing AR Invoices and getting a syntex error message.    
