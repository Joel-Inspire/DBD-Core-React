0010 REM "Batch Control Program <ZZBATC>
0020 SETESC 9300; SETERR 9000
0035 REM "5.5 - 10/16/06 - 9.105 - jme - SSP# 201051
0037 REM "201051-Problem reported by multiple customers that the batch       
0040 REM "Copyright 2006 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
1020 ENTER X3$,X4$,P0$,X9
1030 X9=0; IF P0$="" THEN P0$=X3$(146,6) ELSE P0$=P0$+"     ",P0$=P0$(1,6)
1100 REM 
1110 IF X3$(77,1)="T" THEN P$="ZZCOMPZZDISPZZTIME"; CALL "ZZDAPP",X3$,"D"+P$
1140 DIM Z[NUM(X3$(60,3))]; Z$="01O ZY9 02O ZZPARM"; GOSUB 9750
1200 REM 
1210 P9$=""; CALL "ZZXPRG",P9$,0,P0$,0,0
1990 READ (Z[1],KEY="",DOM=1991)
2000 REM "OLD BATCHES
2010 REM "Assuming that screen is avail from line 3 down
2020 K$=KEY(Z[1],END=2200); READ (Z[1])Q$
2030 IF Q$(6,6)<>P0$ THEN GOTO 2000
2035 IF Q$(110,3)<>X3$(9,3) THEN GOTO 2000
2040 IF Q$(54,3)=X3$(40,3) AND K0$="" THEN K0$=K$
2050 K1$=K1$+K$
2090 GOTO 2000
2210 IF K1$="" OR K0$="" THEN GOTO 4000
2215 FIND (Z[1],KEY=K0$)B0$
2220 IF K0$>"" THEN O$=K0$,Q$="+ ("+K0$(1,4)+": "+FNS$(B0$(159,30))+")"; CALL "ZZPROM","X3ZZBATC",X3$,S3,Q$,"","",0; ON S3 GOTO 4500,2231,4000,9800,3000,3100
2230 ON S3 GOTO 4500,2231,4000,9800,3000,3100
2300 REM "DISPLAY STUFF
2302 IF K1$="" THEN GOTO 9800
2305 X0=0; READ (Z[1],KEY="",DOM=2306)
2310 PRINT @(0,3),'CE',@(0,3),"Batch",@(10),"Operator Initiating",@(60),"Date and Time Started",
2315 CALL "ZZDISP","-","04","",X3$,"","",0,0,X4$
2320 IF X3$(27,1)="1" THEN PRINT @(75,3),"Comp#",
2350 FOR X=1 TO LEN(K1$) STEP 5
2355 DIM Q$(240)
2360 READ (Z[1],KEY=K1$(X,5),DOM=2400)Q$(1)
2365 X0=X0+1
2370 PRINT @(0,X0+4),Q$(1,5),@(10),FNS$(Q$(57,40)),"/ ",Q$(159,30),
2380 CALL "ZZDISP","D",Q$(100,6),"",X3$,"","",60,X0+4,X4$
2385 CALL "ZZDISP","T",Q$(106,4),"",X3$,"","",71,X0+4,X4$
2390 IF X3$(27,1)="1" THEN PRINT @(75,X0+4),Q$(110,3),
2395 IF X0>15 THEN GOTO 2700
2400 NEXT X
2490 GOTO 4670
2600 REM "Remarks
2605 PRINT @(0,3),'CE',; CALL "ZZBATD",X3$,B0$
2610 CALL "ZZENTR","S",X{ALL},B0$,X4$,X3$,26,20,159,30,C0,"","{3"+X$,"","ZY2CAA22","","",""
2660 CALL "ZZPROM","X4ZZBATC",X3$,S3,"","","",0; ON S3 GOTO 2690,2610,2670
2670 REMOVE (Z[1],KEY=B0$(1,5),DOM=2675)
2675 X0=1; GOTO 9800
2690 RETURN 
2700 REM "EOP
2710 CALL "ZZPROM","5",X3$,S3,"'End' option proceeds to 'Enter your batch'","","",0; ON S3 GOTO 2711,4670
2720 PRINT @(0,5),'CE',
2730 X0=0
2740 GOTO 2400
3000 REM "Special setup of a specific batch number - blind option
3020 DIM I0$(4); CALL "ZZENTR","Z",X{ALL},I0$,X4$,X3$,55,22,1,4,C0,"","{3"+X$,"","ZY2CAA24","","",""
3040 IF NUM(I0$)=0 THEN GOTO 2220
3050 READ (Z[1],KEY=I0$+" ",DOM=4200)
3060 GOTO 2220
3100 REM "Set last batch number used
3120 DIM I0$(4); CALL "ZZENTR","Z",X{ALL},I0$,X4$,X3$,55,22,1,4,C0,"","{3"+X$,"","ZY2CAA26","","",""
3140 WRITE (Z[1],KEY="")NUM(I0$)
3160 GOTO 2220
4000 REM "NEW BATCH
4002 IF X3$(185,1)="A" THEN IF K1$="" THEN GOTO 9800 ELSE GOTO 2300
4005 REM IF P0$<>X3$(146,6) THEN IF K1$="" THEN GOTO 9800 ELSE GOTO 2300
4010 CALL "ZZPROM","X0ZZBATC",X3$,S3,"","","",0; ON S3 GOTO 4011,2300
4020 SETERR 9000
4100 REM 
4120 I0=0; EXTRACT (Z[1],KEY="",DOM=4121)I0
4125 I0=I0+1; IF I0>9999 THEN I0=1
4130 WRITE (Z[1],KEY="")I0
4140 I0$=STR(I0:"0000")
4150 READ (Z[1],KEY=I0$+" ",DOM=4200)
4160 GOTO 4120
4200 REM 
4210 DIM B0$(189)
4220 B0$(1,5)=I0$,B0$(6,8)=P0$
4250 B0$(54,3)=X3$(40,3)
4260 DIM Q$(120); FIND (Z[2],KEY="o"+X3$(40,3),DOM=4261)Q$(1)
4270 B0$(57,40)=Q$(5,30)
4280 B0$(97,3)=X3$(1,3),B0$(100,6)=X3$(21,6),B0$(106,4)=STR(INT(TIM*100):"0000")
4290 B0$(110,3)=X3$(9,3)
4295 Q$=""; FIND (Z[2],KEY="CMP"+X3$(9,3),DOM=4296)Q$; B0$(113,40)=Q$(7,40)
4320 CALL "ZZAUDT",X3$,B0$(6,8),Z[2],0
4340 CALL "ZZAUDT",X3$,B0$(6,8),Z[2],1
4380 X3$(174,4)=I0$
4390 B0$(153,6)=X3$(178,4)+"00"
4400 REM "WRITE RECORD
4410 CALL "ZZXPRG",Q$,0,P0$,0,0; B0$(14,40)=Q$
4420 GOSUB 2600
4440 WRITE (Z[1],KEY=B0$(1,5))B0$
4490 GOTO 9900
4500 REM "Continue with existing batch
4550 X3$(174,4)=K0$
4555 X3$(85,1)=O$(5,1)
4560 GOTO 9900
4600 REM "Use another batch
4610 IF K1$="" THEN GOTO 9900
4650 REM "Select another batch in process
4660 CALL "ZZPROM","X1ZZBATC",X3$,S3,"","","",0; ON S3 GOTO 9800,4661
4670 CALL "ZZPROM","X2ZZBATC",X3$,0,Q$,"","",0; PRINT @(48-LEN(Q$),22),Q$,
4680 DIM O$(5); CALL "ZZENTR","AUX",X{ALL},O$,X4$,X3$,50,22,1,5,C0,"BAT","","","","","",""
4690 IF C0<0 THEN GOTO 9800 ELSE IF POS(O$=K1$,5)=0 THEN GOTO 4680
4695 K0$=O$; GOTO 4500
8910 DEF FNS$(X$)=X$(1,POS("    "=X$+"    ")-1)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9040 CALL "ZZERRM",Y8$,"ZZBATC",Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "DON'T CONTINUE
9805 X9=1+SGN(X0)
9905 IF S3<>3 THEN FIND (Z[1],KEY=K0$,DOM=9906)Q$; Q$=GBL("BATCHCTRL_PARMS",Q$); REM "SP#[123167]
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9920 IF P$>"" THEN CALL "ZZDAPP",X3$,"A"+P$
9940 EXIT 
9999 END 
56000 REM "201051-Problem reported by multiple customers that the batch       
