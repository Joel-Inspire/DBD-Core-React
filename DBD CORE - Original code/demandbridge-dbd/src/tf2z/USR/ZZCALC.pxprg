0010 REM "Calculator Module <ZZCALC>
0030 REM "(C) 1985-1988 Basic Ideas, Inc; Atlanta, GA. USA
0480 ENTER C3$,Q0,Q1; X3$=C3$,R0=Q0,R9=R0
0510 P$=X3$(64,3); IF P$="   " THEN P$="902"
0515 PRECISION NUM(P$(3,1))
0520 P9=NUM(P$); CALL "ZZMASK",P$,M0$; GOSUB 4300
0530 X0=60,Y0=23,X1=1,T0=12,D9=340,P=1; GOSUB 7800
1210 DIM S$(25),Q$(0); CALL "ZZPROM","X0ZZCALC",X3$,0,Q$,"","",0
1220 CALL "ZZDISP","-","22","",C3$,"","",0,0,""; PRINT @(1,21),Q$,
1280 GOSUB 7900; DIM A[T0]; GOSUB 8000; GOSUB 7500
2010 X=P+R*(LEN(M0$)+3),C1=0
2015 A[R]=0
2040 CALL "ZZENTR","NXUFMC",A{ALL},A$,X4$,X3$,X,Y0,R,P9,C0,M0$,"","","","","",""
2050 IF ABS(C0)=20 THEN GOTO 4200
2055 IF ABS(C0)=18 THEN GOTO 4000
2060 IF ABS(C0)=19 THEN GOSUB 4100; IF R=0 THEN GOSUB 7500; C0=10 ELSE GOTO 2040
2200 REM "
2210 IF C0=1 THEN C0=10; IF R1$="-" THEN C0=11 ELSE IF POS(R1$="/*")>0 THEN GOSUB 3400
2212 IF ABS(C0)=16 OR ABS(C0)=17 THEN GOTO 5000
2215 IF ABS(C0)=15 THEN GOTO 3500
2216 IF ABS(C0)=14 THEN GOSUB 3400; GOTO 2000
2218 IF C0<-9 THEN C0=ABS(C0),C1=-1
2220 IF C0<10 THEN GOTO 2000
2240 R1$=ATH(X9$((C0-10)*12+1,2))
2250 GOSUB 8360
2270 ON C0-10 GOSUB 3200,3200,3200,3200,3400,3500,3900
2280 R2$=R1$
2290 GOTO 2000
3200 REM "PROCESS OPERAND & OPERATOR(S)
3202 IF R=1 THEN Q$=R1$,R1$=R2$; GOSUB 3400; R1$=Q$,R=0,C1=-1,A[0]=R0,R2$=R1$
3204 IF R=0 AND C1<0 THEN A[0]=R0,R=R+1,X=P; GOSUB 8300; GOTO 2000
3210 IF R=0 THEN R=1; RETURN 
3220 R0=A[0]*A[1],A[0]=R0
3225 R=0
3290 GOTO 7500
3400 REM "EQUALS
3410 SETERR 9000; IF R1$=" " THEN R1$="+"
3411 IF R1$="*" THEN R0=A[0]*A[1]; GOTO 3430
3412 IF R1$="/" THEN SETERR 3419; R0=A[0]/A[1]; SETERR 9000; GOTO 3430
3413 IF R1$="+" THEN R0=A[0]+A[1]; GOTO 3430
3414 IF R1$="-" THEN R0=A[0]-A[1]; GOTO 3430
3419 PRINT 'RB',
3430 X=E0; GOSUB 7520
3432 PRINT @(0+LEN(M0$),Y0),S$(1,4+LEN(M0$)),
3435 DIM A[10]; R=0
3440 R9=R0,R1$=" "
3490 RETURN 
3500 REM "CLEAR ALL
3510 R0=0,R=0,R1$="",R1=0; DIM A[T0]; GOSUB 7900; GOTO 2000
3900 REM "
3910 PRINT 'RB',
3990 RETURN 
4000 REM "STORE RESULT
4010 R1=R0,M$="*"; IF C0>0 THEN R1=A[R]; IF R1>M9 THEN R1=M9; PRINT 'RB',
4020 GOSUB 7950
4090 GOTO 2000
4100 REM "RETRIEVE MEMORY
4110 IF M$="" THEN PRINT 'RB',; EXITTO 2000
4120 A[R]=R1,R0=R1
4125 IF R=0 THEN GOSUB 7500
4190 RETURN 
4200 REM "PRECISION
4210 P9$=P$
4240 P$=P9$,C0=1; CALL "ZZENTR","SEX",A{ALL},P$,X4$,X3$,E1,Y0-1,1,3,C0,M0$,"","","","","",""
4250 IF C0<>1 AND C0<>0 THEN P$=P9$,P9$=""; GOTO 4290
4260 P$=P$(1,POS(" "=P$+" ")-1)
4270 IF P$="" THEN GOTO 4200 ELSE P$=P$+"000",P$=P$(1,3); P9=ASC(ATH("0"+P$(1,1)))*100+NUM(P$(2,2))
4275 PRECISION NUM(P$(2,1))
4280 CALL "ZZMASK",P$,M0$
4285 GOSUB 7800; GOSUB 4300
4290 GOSUB 7900; GOSUB 7500; GOTO 2000
4310 M9=10^INT(P9/100)-1
4312 DIM M9$(LEN(M0$)); Q=INT(LEN(M9$)/2),M9$(Q)="* ERR *"
4320 RETURN 
5000 REM "FINISH UP
5010 Q0=R0
5020 IF ABS(C0)=16 THEN Q1=0 ELSE Q1=1,Q0=R0
5040 PRINT @(0,22),'CE',
5090 GOTO 9900
5155 PRECISION NUM(P$(2,1))
5452 P$="621"; GOSUB 4260
7510 X=P
7520 IF ABS(R0)<=M9 THEN CALL "ZZDISP","NM",STR(R0:M0$),"",C3$,"","",X,Y0,"" ELSE PRINT @(X,Y0),M9$,
7590 RETURN 
7800 REM "SET STUFF BASED ON MASK
7810 E0=79-LEN(M0$)
7815 E1=76,E2=E0-4-LEN(M0$)-2
7820 E9=LEN(M0$)+P+1
7830 DIM S$(E0-1)
7890 RETURN 
7900 REM "STATUS LINE
7910 PRINT @(0,23),'CL',
7920 PRINT @(E1-1,Y0-1),"P",P$,
7935 IF ABS(R0)<=M9 THEN CALL "ZZDISP","N",STR(R0:M0$),"",C3$,"","",E0,Y0,"" ELSE PRINT @(E0,Y0),M9$,
7950 IF M$>"" THEN IF ABS(R1)<=M9 THEN PRINT @(E2,Y0),"M:",; CALL "ZZDISP","N",STR(R1:M0$),"",C3$,"","",E2+3,Y0,"" ELSE PRINT @(E2+3,Y0),M9$,
7990 RETURN 
8000 REM "RESET CONTROL VALUES FOR CALC
8010 X3$=C3$
8020 Q$="+-*/=+xxxxx"; X9=LEN(Q$)*12; DIM X9$(X9,"0"),X8$(12*9,"F"); X8$(6*12+1,12)=X3$(D9+5*12,12)
8040 FOR X=0 TO LEN(Q$)-1
8042 IF X>4 THEN H0$=C3$(D9+(X+8)*12,12); GOTO 8050
8045 H0$=HTA(Q$(X+1,1))
8050 X9$(X*12+1,LEN(H0$))=H0$
8060 NEXT X
8065 X3$=C3$(1,D9-1)+X8$+X9$
8090 RETURN 
8340 Q$=STR(A[0]:M0$)
8350 IF ABS(A[0])<=M9 THEN CALL "ZZDISP","N",Q$,"",C3$,"","",X,Y0,"" ELSE PRINT @(X,Y0),M9$,
8360 PRINT @(E9,Y0),R1$,
8390 RETURN 
9000 REM "
9020 SETERR 0000; RETRY 
9900 REM 
9910 PRINT @(0,21),'CE',
9940 EXIT 
9999 END 
