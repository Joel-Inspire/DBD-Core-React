0010 REM "Audit control functions <ZZAUDT>
0030 REM "(C) 1985,1986,1987 Basic Ideas, Inc; Atlanta, Ga.
0035 REM "4.0 - 11/14/96 - 16.7 - dmm - SSP# 078071
0040 REM "Copyright 1996 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
1000 ENTER X3$,Q0$,F9,X9
1020 Q1$=Q0$(7),Q0$=Q0$(1,6); IF LEN(Q1$)>6 THEN Q1$=Q1$(1,6)
1220 ON X9 GOSUB 5300,6700,7400
1290 GOTO 9900
5300 REM "Get Audit Control Number
5305 IF X3$(145,1)="1" AND X3$(174,4)<>"    " THEN GOTO 5400
5310 A2$=Q0$(1,6)+"  000100",A0$=X3$(9,3)+"AUDIT",A1$=""; READ (F9,KEY=A0$,DOM=5311)A0$,A1$
5315 A0=POS(A2$(1,6)=A1$,14); IF A0=0 THEN A1$=A1$+A2$; GOTO 5315 ELSE A2$=A1$(A0,14),A2=NUM(A1$(A0+12,2))+1,A2$(13,2)=STR(A2:"00"),A1$(A0,14)=A2$
5320 X3$(178,6)=A2$(9,6); WRITE (F9,KEY=A0$)A0$,A1$
5340 RETURN 
5400 REM "Batch Audit Control Number
5402 F0=NUM(X3$(60,3))
5408 CLOSE (F0); OPEN (F0)"ZY9"
5410 EXTRACT (F0,KEY=X3$(174,4)+X3$(85,1))B0$
5420 A2$=B0$(153,6); A2$(5,2)=STR(NUM(A2$(5,2))+1:"00")
5430 B0$(153,6)=A2$; WRITE (F0,KEY=B0$(1,5))B0$; CLOSE (F0)
5450 X3$(178,6)=A2$
5490 RETURN 
6700 REM "Increment Audit Control No.
6705 IF Q0$="" THEN Q0$=X3$(146,6)
6710 A2$=Q0$+"  000100",A0$=X3$(9,3)+"AUDIT",A1$=""; EXTRACT (F9,KEY=A0$,DOM=6716)A0$,A1$
6715 A0=POS(A2$(1,6)=A1$,14); IF A0=0 THEN A1$=A1$+A2$; GOTO 6715 ELSE A2=NUM(A1$(A0+8,4))+1,A2$(9,6)=STR(A2:"0000")+"00",A1$(A0,14)=A2$
6720 WRITE (F9,KEY=A0$)A0$,A1$
6740 RETURN 
7400 REM "Audit already run
7410 S3=1; FIND (F9,KEY="",DOM=7490)V0$,K0$
7420 IF K0$>"" THEN CALL "ZZPROM","U0",X3$,S3,"","","",0; ON S3 GOTO 7500,7421
7430 EXTRACT (F9,KEY="",ERR=7500)
7440 Q$="+ ("+V0$(20,4)+"."+V0$(24,2)+")"
7445 CALL "ZZPROM","X2AUDITS",X3$,S3,Q$,"","",0; ON S3 GOTO 7500,7446
7450 REMOVE (F9,KEY="")
7490 RETURN 
7500 REM 
7510 S3=0
7540 EXIT 99
9900 REM 
9920 EXIT 
9999 END 
