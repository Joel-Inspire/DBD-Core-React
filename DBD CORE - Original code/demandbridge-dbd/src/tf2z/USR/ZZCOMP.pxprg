0010 REM "Screen Setup/Refresh Routine <ZZCOMP>
0035 REM "5.7 - 09/06/16 - 16.155277 - crg - SSP# 286997
0037 REM "286997-Batch update prompts hidden from view; users are not able to
0040 REM "Copyright 2016 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0110 SETESC 9300; SETERR 9000
0120 IF %GUI THEN ERROR_HANDLER "ERROR"
1040 ENTER X0$,X1$,X2$,U3$,C0$,X5$,X0,X1,X2; SETERR 9000; IF X0>0 THEN GOTO 2000 ELSE IF U3$>"" THEN GOTO 1900
1050 SETERR 9000
1104 IF %WC THEN F=HFN; OPEN (F)%DATAPATH$+DLM+"ZZPARM"; GOTO 1120
1105 F=13; IF POS("ZZPARM"=FID(F,ERR=1106))=4 THEN GOTO 1120
1110 CLOSE (F); OPEN (F)"ZZPARM"
1115 IF POS("G"=FID(0))<>1 THEN OPEN (14,ERR=1116)FID(0)
1120 X4$=FID(0)+"      "; READ (F,KEY=X4$,DOM=9800)U3$,*,C0$; IF C0$="" THEN C0$=U3$(9,3)+"ZZP"
1125 IF U3$(235,1)=" " THEN U3$(235,1)="-"
1270 IF U3$(9,3)<>"   " THEN C$=U3$(9,3)+"- "
1920 IF X5$="" THEN CALL "ZZMASK",ERR=1921,U3$(64,3),X5$
1995 IF X0$="" THEN X0$=U3$; GOTO 2900
2005 X2$=FNS$(U3$(86,40)),C$=U3$(9,3); IF X0>=0 THEN X2=X2+1,P=43; IF X2=2 THEN GOTO 2900 ELSE DIM B1$(80,"-")
2007 IF U3$(30,1)="M" OR U3$(330,1)="1" THEN X2$=C$+"-"+X2$
2008 IF POS("G"=FID(0))=1 OR X0<0 THEN GOTO 2900
2009 IF %GUI THEN IF %ZZCOMP_WIN_ID OR %ZZCOMP_SKIP THEN GOTO 2900 ELSE GOTO GUI ! If GUI mode then if not window already open or and %ZZCOMP_SKIP is not set then open GUI window, else don't
2011 IF X2=0 THEN X2=1; PRINT @(16,1),'CL','SB',; GOTO 2025
2012 PRINT (0,ERR=2015)'CF',; ON X2-1 GOTO 2015,2100
2014 IF U3$(201,1)>"0" THEN U1$=U3$(201,1)
2015 PRINT 'CS','SB',
2018 L0$=U3$(239,1); CALL "ZZLANG",U3$,L0$
2020 PRINT @(FNQ(210,9,8),0),FNS$(L0$(210,8)),": ",X0$,U1$,; IF U3$(239,1)<>" " THEN PRINT "-",U3$(239,1),
2022 PRINT @(P-INT(LEN(X2$)/2),0),X2$,
2025 PRINT @(P-INT(LEN(X1$)/2),1),X1$,; IF U3$(236,1)<>$FF$ THEN CALL "ZZDISP","=","02",X3$,U3$,"","",0,0,X4$ ELSE REM 
2090 IF U3$(78,1)="1" THEN GOSUB 6900
2100 GOSUB 8000
2105 IF U3$(78,1)="1" THEN IF X2<2 AND X2>0 THEN CALL "ZZTIME",ERR=2106,U3$,1,0
2110 PRINT (0,ERR=2111)'SF',
2915 CALL "TF"+%LIC_COMP$+";NOVEMBER",ERR=9700 ! Check ssn, on error goto 9700
2920 ! q$="000"+u3$(163,6),q=NUM(q$)
2925 ! serial_num=%ssn; IF u3$(77,1)="D" THEN CALL "ZZNTSN",u3$,SSN,flag$,master_ssn; IF flag$="Y" THEN serial_num=master_ssn
2940 ! IF POS("G"=FID(0))<>1 THEN q$=u3$(40,12)+q$+$1F$+u3$(154,18),q$=HTA(CRC(q$)); IF q$<>u3$(73,4) OR q<>MOD(serial_num,1000000) AND u3$(43,2)<>"SU" THEN GOTO 9700
2990 GOTO 9900
6910 IF U3$(278,1)<>"1" OR L0$="" THEN GOTO 6940 ELSE IF POS(U3$(185,1)="RUA*")>0 THEN PRINT @(FNQ(594,69,12),1),FNS$(L0$(594,12)),":", ELSE PRINT @(FNQ(202,69,8),1),FNS$(L0$(202,8)),":",
6920 PRINT @(FNQ(194,9,8),1),FNS$(L0$(194,8)),":",
6940 RETURN 
8090 RETURN 
8910 DEF FNQ(X,Y,Z)=Y-LEN(FNS$(L0$(X,Z)))-1
8915 DEF FNS$(Q$)=Q$(1,POS("   "=Q$+"   ")-1)
9010 EXIT ERR
9050 ON E2 GOTO 9060,9100,9900,9070
9080 SETERR 9000; RETRY 
9300 RETURN 
9350 RETURN 
9710 %TF_PROG$="",%TF_TITLE$="" ! #151802
9720 RESET 
9730 SETERR 0000; EXIT 89
9800 %TF_PROG$="",%TF_TITLE$=""; EXIT ERR ! # 151802"
9910 %TF_PROG$=X0$,%TF_TITLE$=X1$ ! #151802
9915 IF %WC THEN CLOSE (F)
9940 EXIT 
9999 END 
10000 GUI:! Handle gui setup
10005 CALL "[wdx]*windx.utl;get_lwd",_L$; _L$=SUB(_L$,"in\WindX","in\lib\_bmp\db_logo.ico") ! SSP 226398
10010 MESSAGE_LIB %FLMAINT_MSG$ ! 194087
10020 GDATE$=FN%FMT_TFDATE$(U3$(21,6),MSG("ZZCOMP_1"))
10025 GTITLE$=X1$+" - "+X0$+" - "+GDATE$+" - "+C$+"  "+X2$
10050 GOSUB GUI_WINDOW_ADD
10055 PRINT 'FONT'("MS Sans Serif",1), ! SSP 226398
10060 PRINT 'MESSAGE'(DEF 30,45)
10065 PRINT 'MESSAGE'(GDATE$,0),'MESSAGE'(X0$,1),'MESSAGE'(C$+" - "+X2$,2),
10995 GOTO 2900
10999 ! 
11100 GUI_WINDOW_ADD:! setup window for GUI functions
11110 %ZZCOMP_WIN_ID=201,%ZZCOMP_WIN_LEVEL=TCB(12),IDTMP$=FIN(0),CURR_WIN=DEC($00$+IDTMP$(10,1))
11115 ! calculate location for dialogue box
11120 OBJ$=OBJ(0),MSE$=MSE
11125 DX=INT(MAX(0,DEC($00$+OBJ$(21,2))/DEC($00$+MSE$(10,1)))); DY=INT(MAX(0,DEC($00$+OBJ$(23,2))/DEC($00$+MSE$(11,1))))-2
11130 ! build window
11134 PRINT (0,ERR=*NEXT)'DROP'(%ZZCOMP_WIN_ID),
11135 ! PRINT 'B?','DIALOGUE'(8,5,78,20,%ZZCOMP_WIN_ID,OPT="hcZ"); GOTO 11143 ! For testing this line is helpful
11136 ! DY=5 ! jir
11140 PRINT (0,ERR=*NEXT)'BLACK','B?','DF','DIALOGUE'(DX,DY-3,80,29,%ZZCOMP_WIN_ID,STP(GTITLE$),OPT="ScZ") ! ssp 199634 SSP 226398
11150 PRINT 'CS',
11160 PRINT 'IMAGE'("FRAME"),'FRAME'(@X(0),@Y(0),@X(78),@Y(28),-2), ! SSP 226398
11185 PRINT 'OPTION'("WDWICON",_L$),'CAPTION'(GTITLE$), ! SSP 226398
11186 PRINT (0)'SHOW'(2), ! SSP 286997
11195 RETURN 
11199 ! 
11200 GUI_WINDOW_DROP:! Drop the GUI window
11205 IF NOT(%GUI) THEN RETURN 
11210 PRINT (0,ERR=*NEXT)'DROP'(%ZZCOMP_WIN_ID),
11220 %ZZCOMP_WIN_ID=0,%ZZCOMP_WIN_LEVEL=0
11295 RETURN 
11299 ! 
56005 REM "194087-Changes made at Whitepaper during 2nd week of install       
56006 ! "199634-Program GLGRDS General Ledger Detail Transaction Report the 
56007 ! "       update button is hidden behind the panels."
56008 ! "226398-Modify ZZPROM to display GUI like prompts                   
56009 REM "286997-Batch update prompts hidden from view; users are not able to
