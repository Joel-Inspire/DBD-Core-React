0010 REM "GUI Menu Startup Program <ZSTARTG>
0012 SETESC 9300
0015 %GUI=1
0035 REM "5.7 - 11/29/23 - 14.965289 - jvv - SSP# 307466
0037 REM "307466-Clear ZZPARM program flow record at start of new session    
0040 REM "Copyright 2023 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0050 IF NOT(NUL(ENV("SB_WINDX"))) THEN IF NUL(%WDX$) THEN START PGN ! 191681 if SB_WINDX environment variable set then we must be WINDX to continue
0100 PRINT (0,ERR=*NEXT)'SHOW'(-1),
0110 ERROR_HANDLER "ERROR"
0120 BEGIN ; SETERR 9000; SETESC 9300; N1$="DemandBridge Resource Manager",N2$="DemandBridge Software Inc.",S9=PSZ; GOSUB 7950; IF S9<>PSZ THEN GOTO 4000 ELSE GOSUB 0600; CALL "ZZDROP"; GOSUB 2000; CALL "ZZDAPP",X3$,"IPL"; GOSUB 5000; GOSUB 2080 ! SSP212146
0125 DIM UU0$(6); UU0$(1)=FID(0),UU0$=UU0$+"PF"; REMOVE (6,KEY=UU0$,DOM=*NEXT) ! SSP 307466
0135 IF S0$(86,1)="?" THEN CALL "ZZ2PRZ"; GOTO 0010
0136 IF X3$(28,1)="1" THEN IF X3$(77,1)="U" THEN GOSUB 8700
0140 IF X3$(200,1)<>" " THEN CALL "ZZPROM","X9ZZMAIL",X3$,S3,"","","",0; IF S3=0 THEN RUN "ZZ2MBA" ELSE CALL "ZZSETM",X3$,K$(1,3),"-"
0150 REM 
0152 IF P7$="" THEN GOTO 0190
0155 REM IF S0$(64,3)<>"   "GOTO 00190
0160 CALL "ZZ2PRX"
0170 ! <SEC> CALL "ZZINST",ERR=0171,"DONE!",0,0,"","",""
0180 ! 
0190 SETDEV TSK()%TSK_DEVICES$
0200 REM "UPDATE ZZPARM FILE IF ZZARGS FILE EXISTS"
0210 CLOSE (32001,ERR=0211)
0220 CLOSE (32002,ERR=0221)
0230 CLOSE (32003,ERR=0231)
0240 OPEN (32001,OPT="TEXT",ERR=0310)"ZZARGS"; ZZARGFILE$=FID(32001)
0250 READ (32001,ERR=0310)NEWPARAMETER$
0260 OPEN (32002,ERR=0300)"ZZPARM"; READ (32002,KEY="CMP",DOM=0265)
0265 OPEN (32003,ERR=0290)"ZZPARM"
0270 READ (32002,END=0290)COMPANY$; IF COMPANY$(1,3)<>"CMP" THEN GOTO 0290
0280 IF COMPANY$<>"" THEN NEWREC$=COMPANY$(4,3)+NEWPARAMETER$; WRITE (32003,DOM=0270,ERR=0270,KEY=NEWREC$)NEWREC$; GOTO 0270
0290 CLOSE (32003,ERR=0291)
0300 CLOSE (32002,ERR=0301)
0310 CLOSE (32001,ERR=0311); ERASE "ZZARGS",ERR=0311; FILE ZZARGFILE$,ERR=0311
0390 CLOSE (6,ERR=*NEXT) ! ZZPARM
0391 CLOSE (8,ERR=*NEXT) ! ZX0
0392 CLOSE (F0,ERR=*NEXT) ! ZMS
0400 RUN "ZMENU.GUI"
0600 REM "
0605 DIM B1$(80,"-"),Z$(12,"0"),S$(80),X3$(339); X3$(238,1)="0"
0615 GOSUB 6600; CALL "ZZTRMI",ERR=*NEXT,X$,""
0616 ! PRINT 'CS','SB',
0617 ! CALL "ZZDISP","-","0002","",X3$,"","",0,0,""
0620 ! P=39-INT(LEN(N1$)/2),P1=P+LEN(N1$)
0622 ! GOTO 0655
0625 ! FOR X=LEN(N1$) TO 1 STEP -1
0628 ! IF N1$(X,1)=" " THEN GOTO 0645
0630 ! FOR Y=1 TO P+X
0635 ! PRINT @(Y-1,1)," ",@(Y),N1$(X,1),
0640 ! NEXT Y
0645 ! PRINT @(0,1),
0650 ! NEXT X
0655 ! PRINT @(40-INT(LEN(N1$)/2),1),N1$,
0660 L0$=""; CALL "ZZLANG",X3$,L0$
0680 GOSUB 6000
0690 RETURN 
0700 C_INIT:
0790 RETURN 
0795 ! 
0800 C_POST_DISPLAY:
0810 GOSUB LOAD_COMMERCIAL
0890 RETURN 
0895 ! 
0900 C_WRAPUP:
0990 RETURN 
0995 ! 
1000 LOAD_COMMERCIAL:
1010 LIST_BOX LOAD OPTION.CTL,""
1015 LIST_BOX LOAD OPTION.CTL,0,""
1020 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_2")
1030 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_3")
1040 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_4")
1050 LIST_BOX LOAD OPTION.CTL,0,""
1060 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_5")
1070 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_6")
1080 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_7")
1090 LIST_BOX LOAD OPTION.CTL,0,""
1100 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_A1")
1110 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_A2")
1120 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_A3")
1130 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_A4")
1140 LIST_BOX LOAD OPTION.CTL,0,""
1150 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_8")
1160 LIST_BOX LOAD OPTION.CTL,0,MSG("COM_9")
1190 RETURN 
1195 ! 
1200 U_INIT:
1210 OP_CODE$="",PASSWORD$=""
1240 RETURN 
1245 ! 
1250 U_POST_DISPLAY:
1290 RETURN 
1295 ! 
1300 U_WRAPUP:
1340 RETURN 
1345 ! 
1350 U_CLEAR:
1360 OP_CODE$="",PASSWORD$=""
1370 NEXT_ID=OP_CODE.CTL
1380 REFRESH_FLG=1
1390 RETURN 
1395 ! 
1400 L_INIT:
1410 LICENSED_TO$=ARG_1$,SERIAL_NUM$=ARG_2$,VERSION$=ARG_3$
1420 AUTHORIZATION$=ARG_4$,MACH_CLASS$=ARG_5$,OPERATOR$=ARG_6$
1430 LAST_SYS_USE$=ARG_7$
1440 RETURN 
1445 ! 
1450 L_POST_DISPLAY:
1460 LIST_BOX LOAD MESSAGE.CTL,""
1465 FOR X=8 TO 14
1470 VAR$="ARG_"+STR(X)+"$"
1475 LIST_BOX LOAD MESSAGE.CTL,0,VIS(VAR$)
1480 NEXT X
1490 RETURN 
1495 ! 
1500 L_WRAPUP:
1540 RETURN 
1545 ! 
2000 REM "SETUP X3$ CONTROL RECORD
2005 REMOVE (6,KEY=X3$(1,8),DOM=2006)
2010 IF PSZ<>S9 THEN GOTO 4400 ELSE CLOSE (6); OPEN (6,ERR=6800)"ZZPARM"
2020 DIM P$(80),Q$(160); X3$(1,2)=FID(0); X3$(163,6)=Q$(8,6),X3$(201,1)="0",X3$(64,3)="922"
2022 GOSUB 7300
2025 Q$="00"; GOSUB 8200; GOSUB 8300
2030 GOSUB 6600; REMOVE (6,KEY=X3$(1,8),DOM=2031)
2031 REMOVE (6,KEY=X3$(1,2)+"NOTE",DOM=2032)
2035 X3$(238,1)="0"; PRINT (0,ERR=2036)'SP',; X3$(238,1)="1"; GOTO 2037; REM "if SP then don't check for ZW
2036 PRINT (0,ERR=2037)'ZW',; X3$(238,1)="2"; REM "Set flag to indicate how to handle revers video
2037 X3$(238,1)="2"; REM "PVX
2070 FOR X=1 TO 9; Q0$=FNS$(Q$(X*12+1,12)),Q$(X*12+1,12)=Q0$+Z$(1,12-LEN(Q0$)); NEXT X; FOR X=0 TO 11; Q0$=FNS$(Q$(X*12+201,12)),Q$(X*12+201,12)=Q0$+Z$(1,12-LEN(Q0$)); NEXT X
2071 Q0$=""; FOR X=1 TO 9; Q0$=Q0$+Q$(X*12+1,12); NEXT X; X3$=X3$+Q0$
2072 Q0$=""; FOR X=0 TO 11; Q0$=Q0$+Q$(X*12+201,12); NEXT X; X3$=X3$+Q0$
2073 S9=PSZ; IF S9<>PSZ THEN GOTO 4400 ELSE CALL "TF"+%LIC_COMP$+";LIMA",S0$; IF NUM(S0$(47,9))<>S8 THEN GOTO 4010 ELSE X3$(163,6)=S0$(50,6),X3$(77,1)=S0$(72,1),X3$(51,1)=S0$(74,1),X3$(63,1)=S0$(73,1),X3$(27,1)=S0$(78,1),X3$(278,2)=S0$(83,2),X3$(28,1)=S0$(85,1),X3$(234,1)=STR(SGN(POS("2"=S0$(92,6)))); IF S0$(78,1)="0" THEN X3$(9,3)=S0$(79,3) END_IF ; IF POS("MS"=SYS)=1 AND X3$(77,1)="U" THEN X3$(77,1)="D"
2074 X3$(276,1)="S"; IF S0$(82,1)="1" THEN X3$(276,1)="" ELSE IF S0$(82,1)="3" THEN X3$(276,1)="H" ELSE IF S0$(82,1)="4" THEN X3$(276,2)="SL" ELSE IF S0$(82,1)="5" THEN X3$(276,2)="SC"
2075 GOSUB 5450; IF X3$(163,6)="      " THEN GOSUB 3000; RETURN 
2080 Q$=X3$(40,16)+$1F$+X3$(154,26),X3$(73,4)=HTA(CRC(Q$))
2081 IF X3$(40,3)<>"   " THEN P6$=""; READ (6,KEY="osec"+X3$(40,3),DOM=2082)P6$; X3$(333,2)=P6$(37,2)
2082 Q$=X3$(9,3); CALL "ZZMNUC",X3$,X4$,Q$,N1$
2085 GOSUB 2900; WRITE (6,KEY=X3$(1,8))X3$,"",X4$,"","",A9$
2087 IF X4$>"" THEN PERFORM "ZZGGBL;SET_GLOBALS"
2088 CALL "EXGPRM",ERR=*NEXT,X3$,X4$,Q0$,Q1$ ! 212150
2090 RETURN 
2095 RETURN 
2920 Q$="000"+X3$(163,6)
2925 IF T0$>"" THEN X3$(169,3)=T0$ ELSE X3$(169,3)=FID(0)
2940 Q$=X3$(40,12)+Q$+$1F$+X3$(154,18),Q$=HTA(CRC(Q$)); X3$(73,4)=Q$
2950 Q$=STR(S8:"000000000"),S0=S8; IF S0$="" THEN GOTO 2990
2952 CALL "TF"+%LIC_COMP$+";OSCAR",Q9$ ! <SEC>
2953 A9$=""; FOR X=1 TO LEN(Q9$) STEP 17; A9$=A9$+Q9$(X,5); NEXT X
2954 A2$=U0$(2,2); FOR X=6 TO 1 STEP -1; A2$=A2$+STR(MOD(INT(S0/(1+X+NUM(Q$(X,1)))),10))+Q$(X,1); NEXT X; A2$=A2$+U0$(1,1)+"7"; A3$=""; FOR X=1 TO 11 STEP 2; A3$=A3$+CHR(NUM(A2$(X,2))); NEXT X; A3$=HTA(LRC(A3$)+CRC(A9$)); A4$=HTA(LRC(A9$)),A3$=A4$(1,1)+A3$+A4$(2,1),S1$=A3$
2970 ! IF S1$<>S0$(56,8) THEN GOTO 4010 ! <MK
2975 IF LEN(P$)=3 THEN P$=" "+P$
2980 IF MID(P$,2,3)<>"   " THEN GOSUB 3400
2995 RETURN 
3000 REM "New installation
3010 IF PSZ<>S9 THEN GOTO 4400 ELSE DIM A0$(8); E0=0; GOSUB 3330
3011 SETESC 0000; ESCAPE 
3020 IF E0>3 THEN GOTO 4000
3021 REM "??? MK LET B$=FIN(14,"NUMREC"); LET R0=DEC(B$)
3050 GOSUB 2900
3100 REM "
3101 SETERR 0000
3110 CALL "TF"+%LIC_COMP$+";OSCAR",Q9$ ! <SEC>
3112 A9$=""; FOR X=1 TO LEN(Q9$) STEP 17; A9$=A9$+Q9$(X,5); NEXT X
3120 S0=S8,U0$=STR(U0:"000")
3125 Q$=STR(S0:"000000000"); PRINT @(40,6),I0$,@(40,8),Q$,@(40,10),U0$,@(40,12),A0$,
3140 IF X3$(77,1)="D" THEN CALL "ZZENTR","ZT",X{ALL},Q$,X4$,X3$,40,8,1,9,C0,"","","","","","",""; S0=NUM(Q$)
3150 E0=E0+1; GOTO 3160
3155 REM # OF USERS;CALL "ZZENTR","ZT",X(ALL),U0$,X4$,X3$,40,10,1,3,C0,"","","","","","","";IF C0=10 PRINT 'RB',;GOTO 03150 ELSE IF C0=4 GOTO 09900
3160 CALL "ZZENTR","SUTJ",X{ALL},A0$,X4$,X3$,40,12,1,8,C0,"","","","","","",""; IF ABS(C0)=10 THEN PRINT 'RB', ELSE IF ABS(C0)=4 OR A0$="ABORT " THEN GOTO 9900 ELSE IF A0$(1,6)="TAICHI" THEN WRITE (6,KEY="")S1$(5,1)+S1$(2,1)+S1$(1,1)+S1$(3,2)+S1$(6,1); E0=3; GOTO 3020 ELSE IF C0=2 THEN GOTO 3155
3180 A2$=U0$(2,2); FOR X=6 TO 1 STEP -1; A2$=A2$+STR(MOD(INT(S0/(1+X+NUM(Q$(X,1)))),10))+Q$(X,1); NEXT X; A2$=A2$+U0$(1,1)+"7"; A3$=""; FOR X=1 TO 11 STEP 2; A3$=A3$+CHR(NUM(A2$(X,2))); NEXT X; A3$=HTA(LRC(A3$)+CRC(A9$)); A4$=HTA(LRC(A9$)),A3$=A4$(1,1)+A3$+A4$(2,1),S1$=A3$
3185 IF S1$<>A0$ THEN GOTO 3020 ELSE A1$=S1$
3190 X3$(163,6)=Q$(4,6),X3$(40,5)=""; GOSUB 2900
3192 READ (6,KEY="INSTALLX",ERR=3193)S9$; S9$(64,3)=""
3195 IF PSZ<>S9 THEN GOTO 3300 ELSE DIM Q$(200); Q$(1)=S9$,Q$(1,7)="INSTALL",Q$(8,30)=I0$,Q$(67,3)=STR(U0:"000"),Q$(47,9)=STR(S0:"000000000"),Q$(56,8)=A1$; GOSUB 3200; WRITE (6,KEY=Q$(1,7))Q$,V0$; CALL "ZZUSER","","!*","CSI",NUM(U0$),0; GOTO 2073
3200 REM 
3205 SETERR 3230
3230 SETERR 9000; Q$(72,1)=" ",Q$(73,12)="0110 0001511",Q$(87,5)="00000"
3232 Q$(72,1)="U",Q$(86,1)="?"; IF I0$>"" THEN Q$(86,1)=""
3235 IF POS("MS"=SYS)=1 THEN Q$(72,1)="D"
3240 RETURN 
3400 REM "Check applications for version codes
3401 IF A8$>"" THEN GOTO 3490
3402 PRINT @(0,22),'CE',@(12),"Initializing",
3405 A8$=A9$,A9$="",K$="@"+STR(%SSN)
3410 CLOSE (8); OPEN (8)"ZX0"
3415 L8=13
3416 L8=13; REM "pvx conv
3420 FOR X=1 TO LEN(A8$) STEP 5
3421 IF A8$(X,1)="!" THEN X3$(30,1)=A8$(X+1,1); GOTO 3480
3425 READ (8,KEY=A8$(X,2),DOM=3480)Q$
3430 O$=A8$(X,2)+"2VER"; IF LEN(Q$)>41 THEN IF Q$(41,6)<>"      " THEN O$=Q$(41,6)
3431 A9$=A9$+A8$(X,5); GOTO 3480; REM "pvx conv
3432 CLOSE (14); OPEN (14,ERR=3475)O$; READ RECORD (14)C9$; IF C9$(L8,1)<>$80$ THEN GOTO 3475
3435 CALL O$,ERR=3475,Q0$,Q1$,C9$
3440 CALL "ZZCRYP",X3$,K$,"","U",X$,X{ALL},C9$,X9; IF X9=0 THEN IF ATH(X$(11,10))=A8$(X,5) OR (ATH(X$(11,10))="EF370" AND A8$(X,4)="EFJF") THEN A9$=A9$+A8$(X,5); PRINT ".", ELSE PRINT "!",; S0$(64,3)=""
3445 GOTO 3480
3475 PRINT "*",; S0$(64,3)=""
3480 NEXT X; A8$=A9$
3485 GOSUB 8800
3490 RETURN 
3500 REM "INSTALL
3502 IF POS("MS"=SYS)=1 THEN X3$(77,1)="D"; REM "Check for MS only to cover both Dos and Windows version under "+             "the D type
3503 PRINT @(0,18),
3505 REM " LET P7$="TF.INST"; IF X3$(77,1)="D" THEN IF POS("7."=SYS)<>0 THEN SYSTEM "COPY TFINSTAL UTILS\TFINSTAL"; LET P7$="TFINSTAL"; GOTO 03511 ELSE LET P7$="TFINSTAL"
3510 REM " IF POS("MS W"=SYS)<>1 THEN SYSTEM "CP TF.INST UTILS"-> NOT NEEDED IF HIEARCHARL DIR EXISTS ON  DISK 10 AS IT SHOULD
3512 ! <SEC> CALL "ZZTFNM",p7$
3515 PRINT @(0,18),'CL'
3520 REM " PVX  CLOSE (14); OPEN (14,ERR=9900)P7$
3521 SETESC 0000; ESCAPE 
3530 ! <SEC> CALL "ZZINST",ERR=3550,z8$,0,0,v0$,z7$,a0$; v9$="INSTALL"
3535 ! <SEC> v0$="@"+STR(s8); CALL "ZZINST",v0$,0,0,"","",""
3540 RETRY 
3550 REM "Incorrect tape for this ssn
3560 PRINT @(0,3),'CE',@(0,5),"This release tape is not the correct tape fo"+"r your system.",@(0,7),"Release tape SSN: ",Z7$," for ",Z8$
3580 INPUT 'LF','LF',"Press Enter to continue: ",*
3590 GOTO 9900
4000 REM "UNMATCHED SSNS
4005 PRINT @(0,3),'CE',; CALL "ZZVDTP",X3$,"ZSTART","*","",0
4010 PRINT @(0,3),'CL',; FOR X=5 TO 11; PRINT @(1,X),S$(1,78),; NEXT X; CALL "ZZVDTP",X3$,"ZSTRTX","","",.1; PRINT @(0,22),'CE',
4020 PRINT 'CI','RB',; WAIT 1; PRINT 'RB',; GOSUB 6200
4040 GOSUB 3300; GOTO 0010
4410 RUN "ZSTART"
4500 REM "UNIX GET LOGNAME
4501 REM X3$(85,1)="7"
4520 O9$=""; CALL "ZSTRTU.GUI",X3$,P$,T9$,""; IF P$="" THEN IF X3$(77,1)<>"D" THEN GOTO 4590
4530 P$=P$+S$,P$=P$(1,8),O9$=P$(1,3),Q0$=""; EXTRACT (6,KEY="OLS"+P$,DOM=4550)Q0$; I6=IND(6)
4540 O9$=Q0$(12,3),P$=O9$,X3$(32,6)=STR(I6:"000000")
4545 CALL "ZSTRTO",X3$,Q0$,6,I6
4550 REM "OPERATOR CODE
4555 P6$=""; READ (6,KEY="osec",DOM=4556)P6$
4580 P$=O9$,O9$=""; EXTRACT (6,KEY="o"+P$,DOM=4590)P$; O9$=P$(2,3)
4595 RETURN 
5000 REM "Operator code
5001 DIM O$(12) ! MK
5002 GOSUB 4500; READ (6,KEY="o",DOM=5003)
5003 IF X3$(32,6)<>S$(1,6) THEN O1$=""
5004 IF O9$>"" AND U6=0 THEN IF O1$<>"&" THEN GOTO 5220
5005 IF FID(0)<>T0$ THEN GOSUB 8500
5010 O=0
5020 READ (6,KEY="o",DOM=5021)
5030 READ (6,END=5090)Q$; IF Q$="" THEN GOTO 5090 ELSE IF Q$(1,1)<>"o" THEN GOTO 5090
5040 GOSUB 2900; GOSUB 5100
5050 REM "
5090 RETURN 
5100 REM "
5110 O=-1,S9=0
5120 ! PRINT @(0,3),'CE',
5125 ! GOSUB 7800
5140 IF S9>2 THEN GOTO 5300 ELSE DIM O$(12); PROCESS "ZSTART.U","../ZZW/ZZ.EN",OP_CODE$,PASSWORD$
5160 ! CALL "ZZENTR","ST",X{ALL},O$,X4$,X3$,40,10,1,3,C0,"","","","ZSTART01","","",""; IF C0=10 THEN GOTO 5390
5180 ! CALL "ZZENTR","SPUT",X{ALL},O$,X4$,X3$,40,12,4,6,C0,"","","","","","",""
5185 ! IF C0=2 THEN GOTO 5160 ELSE O=O+1
5200 REM 
5203 O$(1,3)=OP_CODE$,O$(4,6)=PASSWORD$,OP_CODE$="",PASSWORD$=""
5205 S9=S9+1,O=O+1
5210 DIM P$(200); READ (6,KEY="o"+O$(1,3),DOM=5140)P$(1)
5215 P6$=""; READ (6,KEY="osec"+O$(1,3),DOM=5216)P6$
5220 IF FNS$(O$(4,6))<>FNS$(P$(35,6)) THEN GOTO 5140
5290 GOTO 5400
5300 REM "
5310 CALL "ZZPROM",".X1ZSTART",X3$,A,"","","",0
5390 RUN "ZZEND"
5400 REM "
5450 REM "
5452 IF LEN(P$)>94 THEN X3$(160,2)=P$(94,2)
5455 X3$(40,3)=P$(2,3),X3$(43,2)=P$(41,2),X3$(45,1)=P$(57,1),X3$(140,3)=P$(51,3),X3$(154,6)=P$(65,6),X3$(51,1)=P$(58,1),X3$(172,6)=P$(59,2),X3$(162,1)=P$(61,1),X3$(47,1)=P$(64,1)
5456 IF LEN(P$)>61 THEN X3$(197,1)=$FF$,X3$(197,1)=CHR(100+NUM(P$(62,2),ERR=5457))
5457 IF S0$(84,1)<>"1" THEN X3$(9,3)="001"
5458 Q$=X3$(9,3); IF P$(54,3)<>"   " THEN Q$=P$(54,3)
5460 CALL "ZZMNUC",X3$,X4$,Q$,N1$
5465 IF POS(X3$(40,3)="   csiCSISYS",3)=0 THEN READ (6,KEY=X3$(9,3)+"R/T",DOM=5466)J9$; IF J9$(7,1)<>"H" THEN X3$(45,1)="0",X3$(51,1)="0",X3$(140,3)="R/T"; CALL "RT2AUT",X3$,AUTH_CODE; IF AUTH_CODE<>0 THEN RELEASE END_IF ; D0$=FID(0)+"DATE"; REMOVE (6,KEY=D0$,DOM=5466); REM "If not csi or sys operator, if Remote T/M exists and this i"+                "s a remote, then restrict DIRect menu and option access and"+                " put R/T as 'MAIN' menu, remove the date record to force "+                "the entry of a date the first time"
5475 IF P$(1,1)="o" THEN IF S0$(75,1)<>"2" THEN X3$(239,1)=P$(71,1),L0$=X3$(239,1); CALL "ZZLANG",X3$,L0$; GOSUB 7500
5478 IF P$(1,1)="o" THEN IF P$(72,2)<>"00" THEN Q$=P$(72,2); GOSUB 8200
5480 IF P$(1,1)="o" THEN GOSUB 7600; GOSUB 8000
5490 RETURN 
6000 REM "COMMERCIAL
6005 IF S9<>PSZ THEN GOTO 4400 ! ELSE PRINT (0,ERR=6500)@(3,3),'CE',
6010 ! CALL "ZZVDTP",ERR=6011,X3$,"ZSTART","*",Q$,0; IF Q$>"" THEN Q$=""; GOTO 6220
6015 PROCESS "ZSTART.C","../ZZW/ZZ.EN"
6200 REM 
6210 ! PRINT (0,ERR=6211)'EB'
6220 D0=1; IF POS("G"=FID(0))=1 THEN D0=0
6225 ! IF D0>0 THEN CLOSE (D0); OPEN (D0)FID(0)
6230 Q$=FNS$(L0$(58,40)) ! PRINT @(46-LEN(Q$)-2,22),Q$,":",@(46),
6240 Q$=" "; GOTO 6246; REM "PRINT (0)'CI',; READ RECORD (D0,TIM=60,SIZ=1,ERR=6241)Q$; GOTO 6246
6245 RUN "ZZEND"
6246 IF POS(Q$="uU")>0 THEN U6=1,Q$=" "
6250 IF Q$="*" THEN GOTO 7000 ELSE IF POS(Q$="Xx")>0 THEN CALL "ZZDROP",ERR=9900; GOTO 9900 ELSE T0$=FID(0); IF Q$=":" THEN T0$=FID(0)+"D"
6251 ! PRINT @(0,21),'CE', ! IF q$=$15$ THEN GOSUB 3300 ELSE PRINT @(0,21),'CE',
6252 IF Q$="&" THEN O1$="&" ELSE IF POS(Q$=": ?#")=0 THEN PRINT 'RB',; GOTO 6230
6253 IF Q$="?" THEN CALL "ZZWHOS"; GOTO 9920 ELSE IF Q$="#" THEN GOSUB 6900; RETURN 
6255 ! CALL "ZZPROM","X0ZSTART",X3$,0,"","","!",0
6260 ! WAIT 1
6270 IF T0$>"" THEN IF T0$<>FID(0) THEN OPEN (10,ISZ=1,ERR=2960)T0$; WRITE RECORD (10,IND=0)$01$; CLOSE (10)
6290 RETURN 
6310 READ RECORD (D0,SIZ=1)Q$
6320 EXITTO 0600
6505 PRINT (0,ERR=6506)'CS','RB',@(0,10),; GOTO 6510
6507 FOR X=0 TO 22; PRINT ""; NEXT X
6510 PRINT "** The terminal mnemonics are not set correctly or the configur"+"ation of",'LF',"   the terminal type is incorrect.  Refer to installa"+"tion and setup",'LF',"   sections of the DemandBridge documentation." ! SSP212146
6520 BEGIN 
6550 DELETE 0001,9999
6560 GOTO 9900
6600 REM "TERMINAL TYPE
6605 SETERR 6800; CLOSE (6); OPEN (6)"ZZPARM"; SETERR 9000
6606 IF TCB(88)<>0 THEN X$="WINDX   " ELSE X$=PAD(UCS(ENV("TERM")),8,1)
6607 IF POS("MS"=SYS)>0 THEN X$="WINDX   " ! IF STP(X$,2)="" AND POS("MS"=SYS)>0 THEN X$="WINDX   " ! DMM - Loading new XP laptop, 10/16/03
6608 %TERM_TYPE$=X$
6610 X3$(198,1)="0"; READ (6,KEY="GRCTRL",DOM=6690)Q$; REM "PVX
6635 Q=POS(X$=Q$(8,6*8),8); IF Q>0 THEN Q=INT(Q/8); X3$(198,1)=STR(Q)
6640 SETESC 0000; FIND (6,KEY="GR"+X$+" ",DOM=6650)Q$; GOTO 6660
6650 FIND (6,KEY="GRMISC    "+" ",DOM=6680)Q$
6660 X3$(235,1)="-"; SETERR 6661; X3$(235,1)=ATH(Q$(158,2)); X3$(236,1)=X3$(235,1); IF Q$(180,2)<>"00" THEN X3$(236,1)=ATH(Q$(180,2))
6665 SETERR 9000
6680 DIM Q$(357); FIND (6,KEY="TCTL"+X$,DOM=7000)Q$(1); Q$=Q$(13)
6685 %TERM_TYPE$=X$
6690 RETURN 
6800 REM "DEFINE PARM FILE
6805 IF ERR<>12 THEN E0=ERR,E0$="open"; GOTO 6830
6815 OPEN (6,ERR=6820)"ZYPARM"; F$=FN%FID$(6); D=ASC(F$(20)); CLOSE (6); RENAME "ZZPXXX","ZZPARM"; WAIT 2; RETRY ! [205703]-changed FID() to FN%FID$()
6820 DIRECT "ZZPARM",12,100,1024,ERR=6822; RETRY 
6822 E0=ERR,E0$="Define"
6830 PRINT @(0,22),'CL',@(5),"Unable to ",E0$," parameter file - Error ",E0,; INPUT *; START 10
6910 FOR X=0 TO 25; PRINT ""; NEXT X
6914 IF T9$>"" THEN PRINT "Default terminal type is ",T9$(1,8)
6915 INPUT "Enter your terminal type or press Enter to use the default:",T$; IF T$="END" THEN GOTO 9900 ELSE IF T9$>"" THEN IF T$="" THEN T$=T9$(1,8)
6920 T$=T$+S$,T$=T$(1,8)
6930 READ (6,KEY="GR"+T$+" ",DOM=6915)
6935 IF X3$(85,1)="7" THEN Q0$(101,8)=T$ ELSE X$=T$
6940 FOR X=1 TO 25; PRINT ""; NEXT X
6945 RETURN 
7000 REM "CONTROL SETTINGS
7030 CALL "ZZCTRL",X3$,X4$,M1$,M2$
7090 GOTO 0010
7200 REM "PREFERENCES
7220 CALL "ZZXPRA",ERR=7221
7230 GOTO 7090
7300 REM "NUMBER OF USERS
7302 SETERR 7308
7305 CALL "TF"+%LIC_COMP$+";KILO",U; IF U>0 THEN U0$=STR(U:"000"); RETURN 
7308 SETERR 7310; IF U=0 THEN CALL "ZZUSER","","!*","CSI",1,0; GOTO 7305
7310 PRINT @(0,3),'CE',; CALL "ZZVDTP",ERR=7311,X3$,"ZSTRTU","",V0$,1
7315 Q$="___"; P=POS(Q$=V0$); IF P=0 THEN GOTO 7350
7320 V0$(P,3)=STR(U:"**0"); GOTO 7315
7350 PRINT @(0,3),V0$,
7390 PRINT @(0,20),; GOTO 9940
7480 IF P$(1,4)<>"    " THEN GOSUB 7600
7500 REM "
7530 REM FOR X=0 TO 2;P=1+(POS(X3$(70+X,1)=X3$(56,3))-1)*2;X3$(80+X,1)=STR(P:"0");NEXT X
7540 X3$(31,1)="0"; CLOSE (4); OPEN (4,ERR=7541)X3$(32,4); Q$=FN%FID$(4); IF LEN(Q$)>2 THEN X3$(31,1)=STR(ASC(Q$(20,1))) ! [205703]-changed FID() to FN%FID$()
7590 RETURN 
7600 REM "
7605 IF X3$(77,1)=" " OR S0$(8,1)="?" THEN GOTO 7645
7608 GOSUB 7900
7610 ! PRINT @(0,3),'CE',; CALL "ZZVDTP",ERR=7611,X3$,"ZSTRTA","*","",0
7612 ! PRINT 'SF'
7613 V8$=V0$; V8$="710" ! SSP213071, change from 600 to 700. SSP261436, change from 700 to 710.
7615 ! PRINT @(22,4),S0$(8,39),@(22,5),S0$(47,9),@(22,6),V8$,@(57,5),S0$(56,8),@(57,6),S0$(72,1),"-",U," User",'SF',
7620 ! X$=FNS$(L0$(138,40)); PRINT @(39-INT(LEN(X$)/2),8),X$,
7625 ! PRINT @(29,10),FNS$(P$(5,30))," (",P$(2,3),")",
7626 CALL "ZZDISP","DX",P$(76,6),"",X3$,DATE$,"",0,0,X4$
7627 CALL "ZZDISP","TX",P$(82,4),"",X3$,TIME$,"",0,0,X4$
7630 LICENSED_TO$=S0$(8,39),SERIAL_NUM$=S0$(47,9),VERSION$=V8$,AUTHORIZATION$=S0$(56,8),MACH_CLASS$=S0$(72,1)+"- "+STR(U)+" User",OPERATOR$=FNS$(P$(5,30))+" ("+P$(2,3)+")",LAST_SYS_USE$=DATE$+DIM(3)+TIME$,%USER_NAME$=FNS$(P$(5,30))
7635 GOSUB 7700
7640 PROCESS "ZSTART.L","../ZZW/ZZ.EN",LICENSED_TO$,SERIAL_NUM$,VERSION$,AUTHORIZATION$,MACH_CLASS$,OPERATOR$,LAST_SYS_USE$,MSG_0$,MSG_1$,MSG_2$,MSG_3$,MSG_4$,MSG_5$,MSG_6$
7645 RETURN 
7700 REM "MESSAGE OF THE DAY
7701 REM Modified 6/1/01 - plh
7705 IF X3$(77,1)=" " THEN GOTO 7790 ELSE T0=0,X3$(185,1)="*",F0=NUM(X3$(60,3))
7710 OLDPRECISION=PRC
7715 PRECISION 8
7720 T$=""
7725 CLOSE (F0,ERR=*NEXT)
7730 OPEN (F0,ERR=7790)"ZMS"
7735 REC_CNT=NUM(FN%FIN$(F0,"NUMREC"))
7736 SECONDS=TIM*3600
7737 IF SECONDS<REC_CNT THEN WITH_SEED=MOD(REC_CNT,SECONDS) ELSE WITH_SEED=MOD(SECONDS,REC_CNT)
7738 RANDOMIZE WITH_SEED
7740 RN_REC=RND(REC_CNT)
7742 IF RN_REC=0 THEN RN_REC=1
7745 READ (F0,RNO=RN_REC,DOM=*NEXT)T$; GOTO 7750
7746 READ (F0,ERR=*NEXT)T$
7750 FOR X=0 TO 6
7755 ! PRINT @(12,X+14),MID(T$,7+X*60,60),
7756 VAR$="MSG_"+STR(X)+"$"
7757 VIA VAR$=MID(T$,7+X*60,60)
7760 NEXT X
7765 PRECISION OLDPRECISION
7780 ! CALL "ZZPROM","4 ZSTART",X3$,Q,"","","*",0; ON Q GOTO 7781,7708
7790 SETERR 9000; RETURN 
7800 REM 
7820 FOR X=0 TO 1; Q$=FNS$(L0$(98+X*20,20)); PRINT @(37-LEN(Q$),10+X*2),Q$,":",; NEXT X
7840 RETURN 
7900 REM "CHECK VERSION
7910 CALL "ZZ2VER",ERR=9900,V0$,"",""
7945 RETURN 
7950 REM "Set S8 to correct serial number
7955 IF %TFCENTRAL THEN S8=NUM(%LIC_COMP$) ELSE TMP$=SSN; S8=NUM(TMP$(10)) ! <SEC>
7960 ! <SEC> IF POS("MS"=SYS)=1 THEN CALL "ZZNTSN",x3$,(%ssn),flag$,master_ssn; IF flag$="Y" THEN s8=master_ssn
7965 CALL "TF"+%LIC_COMP$+";KILO",AVAILABLE_LICENSES
7969 IF %APS THEN PERFORM "ZZ2PID"
7970 CALL "ZZGFID;USED_TF_LICENSES",ERR=DONE_7900,0,TBL(%TFCENTRAL,"",%LIC_COMP$+""),USED_LICENSES ! 263321
7975 IF USED_LICENSES>AVAILABLE_LICENSES THEN MSGBOX "You only have "+STR(AVAILABLE_LICENSES)+" licenses of DemandBridge, and all of them are in use at this time."; GOTO 9800 ! SSP212146
7990 DONE_7900:
7995 RETURN 
8000 REM "CK FOR MESSAGES
8010 CLOSE (7,ERR=8095); OPEN (7,ERR=8095)"ZZM"; READ (7,KEY=X3$(40,3),DOM=8011)
8020 READ (7,END=8090,ERR=8090)K$; IF K$(1,3)=X3$(40,3) THEN IF K$(620,1)="1" OR K$(60,6)>X3$(21,6) THEN GOTO 8020 ELSE CALL "ZZSETM",X3$+"  ",K$(1,3),"+"; X3$(200,1)="M"
8095 CLOSE (7); RETURN 
8200 REM "Set preferences data
8205 READ (6,KEY="PRF"+Q$,DOM=8206)P5$; GOTO 8210
8207 IF Q$="00" THEN GOTO 9900 ELSE Q$="00"; GOTO 8200
8210 X3$(38,2)=P5$(4,2),X3$(46,1)=P5$(105,1),X3$(59,1)=P5$(37,1),X3$(67,1)=P5$(38,1),X3$(68,1)=P5$(39,1)
8215 X3$(78,1)=P5$(104,1),X3$(79,1)=P5$(106,1),X3$(126,1)=P5$(40,1),X3$(127,1)=P5$(41,1),X3$(83,1)=P5$(102,1),X3$(84,1)=P5$(103,1),X3$(280,30)=P5$(42,30)
8220 X3$(48,1)=P5$(36,1)
8225 X3$(80,3)="513"; IF X3$(48,1)="2" THEN X3$(80,3)="531" ELSE IF X3$(48,1)="3" THEN X3$(80,3)="135"
8230 IF X3$(48,1)="1" THEN X3$(56,3)=X3$(71,1)+X3$(72,1)+X3$(70,1) ELSE IF X3$(48,1)="2" THEN X3$(56,3)=X3$(72,1)+X3$(71,1)+X3$(70,1) ELSE IF X3$(48,1)="3" THEN X3$(56,3)=X3$(70,1)+X3$(71,1)+X3$(72,1)
8240 Q=0,L=0,L9=0,Q$=""; FOR X=0 TO 29; IF P5$(72+X,1)=" " THEN EXITTO 8250 ELSE IF P5$(72+X,1)="." THEN Q=Q+1 ELSE Q$=Q$+STR(Q),Q=0,L=L+1
8242 IF P5$(72+X,1)="?" THEN L9=X+1
8245 NEXT X
8250 X3$(310,20)=CHR(100+L)+CHR(100+L9)+Q$
8290 RETURN 
8300 REM "FILE DATA
8310 X3$(60,3)="256"
8340 RETURN 
8505 X3$(169,3)=FID(0)
8510 CALL "ZZDEMO",ERR=0010,X3$,2,0,"",M0
8580 X3$(169,3)=T0$
8590 RETURN 
8700 REM "GHOST TASK STARTUP
8710 F0=NUM(X3$(60,3)); CLOSE (F0)
8720 OPEN (F0,ERR=8721)"G0"; CLOSE (F0); GOTO 8740
8725 IF ERR<>13 THEN GOTO 8750
8730 START 10,ERR=8760,"ZGHOST","G0"
8745 RETURN 
8755 Q$="+("+STR(ERR)+")"
8760 CALL "ZZPROM","G0ZSTART",X3$,0,Q$,"","",0
8790 RETURN 
8800 REM "CHECK SECURE PROGRAMS
8801 SETERR 9000
8802 RETURN ! <MK
8803 L8=13
8805 X$=""; CLOSE (14); OPEN (14)"ZS1"
8810 READ (14,END=8811)Q$; IF Q$(18,1)="1" THEN X$=X$+Q$(1,8)+"  "; GOTO 8810 ELSE GOTO 8810
8815 IF X$="" THEN GOTO 8825 ELSE Q=0; FOR X=1 TO LEN(X$) STEP 10
8820 CLOSE (14); X$(X+8,1)="0"; OPEN (14,ERR=8821)X$(X,8); READ RECORD (14,ERR=8821)Q$; IF Q$(L8,1)=$80$ THEN X$(X+8,1)="" ELSE Q=Q+1
8822 IF X$(X+8,1)=" " THEN PRINT ".", ELSE PRINT "!",
8825 NEXT X
8830 IF Q=0 THEN RETURN ELSE CALL "ZZPROM","X2ZSTART",X3$,Q,"","","",0; ON Q GOTO 8831,9900
8835 PRINT @(0,3),'CE',
8840 FOR X=1 TO LEN(X$) STEP 10
8845 PRINT X$(X,8),"   ",X$(X+8,1)
8850 NEXT X
8860 CALL "ZZPROM","4",X3$,0,"","","",0
8865 PRINT @(0,3),'CE',
8870 RETURN 
8880 GOTO 9900
8910 DEF FNS$(Z9$)=Z9$(1,POS("   "=Z9$+"   ")-1)
9005 IF POS(STR(ERR:"000")="064065069",3)>0 THEN GOSUB 7800; SETERR 9000; RETRY 
9010 IF ERR=67 THEN GOTO 0010
9040 IF ERR=29 THEN GOTO 6500
9350 GOTO 9900
9840 IF WHO<>"jir" THEN RELEASE 
9900 REM 
9910 PRINT @(0,3),'CE',
9920 PRINT 'LF',"** DemandBridge(R) Startup Program Terminated **" ! SSP212146
9940 BEGIN 
9999 END 
56000 REM "200237-System moving slowly since the release this morning.        
56002 REM "205460-Oracle - FIN(CHANNEL,"NUMREC") changed to use FN%FIN$()     
56003 REM "212150-After Upgrade takes longer for A/P jounal to update.        
56006 ! 212146-Change company name from TopForm to DemandBridge
56008 ! 213071-Change release from 6.0 to 7.0
56010 REM "261436-Change graphical version release number from 7.0 to 7.1.    
56011 REM "269390-Having slowness when using GUI.                             
56012 REM "307466-Clear ZZPARM program flow record at start of new session    
