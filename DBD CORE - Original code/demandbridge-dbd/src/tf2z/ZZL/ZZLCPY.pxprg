0010 REM "Move linked list lines to/from Workfile <ZZLCPY>
0030 REM "(C) 1985,1986 Basic Ideas, Inc; Atlanta, Ga.
0035 REM "5.7 - 06/21/13 - 9.472777 - jvv - SSP# 262361
0037 REM "262361-GUI conversion of Accounts Payable Gateway - Module GW_A/P  
0040 REM "Copyright 2013 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0290 IOLIST Y[0],Y[1],Y[2],Y[3],Y[4]
1000 REM 
1020 ENTER X3$,F9$,F0,F1,A1$,A0,F9
1030 F=F1,X0$=PGN
1035 DIM Y[5],Z0$(10,$00$)
1040 SETERR 9000; SETESC 9300
1100 REM "
1110 ON POS(F9$="RWD") GOTO 1200,1400,1600,1800
1200 REM "INVALID
1250 EXIT 99
1400 REM "READ FROM FILE TO WORKFILE 
1405 A0=-1
1408 IF NOT(%GUI) THEN CALL "ZZPROM","X0ZZLCPY",X3$,0,"","","",0 ! SSP 262361
1410 READ (F0,KEY=A1$,DOM=1411)
1420 READ RECORD (F0,END=1500)Q$; IF I9=0 THEN I9=LEN(Q$); DIM Z0$(I9,$00$)
1430 IF Q$(1,LEN(A1$))<>A1$ THEN GOTO 1500 ELSE IF A0=-1 THEN GOSUB 5200; I0=A9,A0=0
1440 IF F9=0 THEN Q$=Q$(LEN(A1$)+4)
1450 I0=A9; GOSUB 5200
1460 A$=STR(A9)+$8A$+FNZ$(Q$)
1480 WRITE RECORD (F1,IND=I0)A$
1485 IF A0=0 THEN A0=I0
1490 GOTO 1420
1500 REM 
1510 IF A0<=0 THEN A0=0; GOTO 1580
1515 Q=POS($8A$=A$),Q$=A$(Q+1)
1520 A$="0"+$8A$+Q$
1530 WRITE RECORD (F1,IND=I0)A$
1540 Z=A9; GOSUB 5300
1595 GOTO 5000
1600 REM "COPY FROM WORKFILE TO LINESFILE
1605 X0=0; READ (F0,KEY=A1$,DOM=1606)
1608 IF NOT(%GUI) THEN CALL "ZZPROM","X1ZZLCPY",X3$,0,"","","",0 ! SSP 262361
1610 IF A0<=0 THEN GOTO 1700
1620 READ RECORD (F1,IND=A0)Q$
1625 Q=POS($8A$=Q$),X=NUM(Q$(1,Q-1)),Q$=Q$(Q+1),X0=X0+1,Q=X
1630 K$=A1$+STR(X0:"000"); IF F9=0 THEN Q$=K$+Q$ ELSE Q$(1,LEN(K$))=K$
1635 Q$=FNZ$(Q$)
1640 WRITE RECORD (F0,KEY=K$)Q$
1645 Z=A0; GOSUB 5300
1650 A0=Q; GOTO 1610
1700 REM "Remove old extra lines in Direct (main) file
1710 K$=KEY(F0,END=1780); IF POS(A1$=K$)<>1 THEN GOTO 1780
1720 REMOVE (F0,KEY=K$); GOTO 1710
1780 REM 
1790 GOTO 5000
1800 REM "DELETE ALL KEYLINES
1808 IF NOT(%GUI) THEN CALL "ZZPROM","X2ZZLCPY",X3$,0,"","","",0 ! SSP248947 jdf
1810 READ (F0,KEY=A1$,DOM=1820)
1820 GOSUB 5900
1830 GOTO 1700
2020 X0$=PGN
4900 REM "END OF LINES
4910 Y[4]=-1; WRITE (F,IND=0)IOL=0290
4920 CALL "ZZEXPF",X3$,X4$,"X"+STR(F),"",G9; IF G9>0 THEN GOTO 7000
4925 EXTRACT (F,IND=0)IOL=0290
4930 Z=NUM(FIN(F,"MAXREC")); Y[3]=Z-1
4935 Y[4]=-2; WRITE (F,IND=0)IOL=0290
4940 GOTO 5230
4980 GOTO 7000
5000 REM 
5090 GOTO 9900
5100 REM "BUILD INDEX STRING
5105 Y$="",Y=A0
5120 IF Y<=0 THEN GOTO 5195 ELSE Q$=BIN(Y,Y9); IF POS(Q$=Y$,Y9)=0 THEN Y$=Y$+Q$ ELSE GOTO 5195
5130 READ (F,IND=Y,END=5131)Y; GOTO 5120
5140 IF Y$>"" THEN Y$=Y$(1,LEN(Y$)-Y9)
5195 RETURN 
5200 REM "GET NEXT INDEX TO FILE IN A9
5210 GOSUB 5800
5230 IF Y[1]<1 THEN A9=Y[2],Y[2]=Y[2]+1; GOTO 5260
5255 A9=Y[1]; READ (F,IND=A9)Y[1]
5260 IF Y[0]<Y[3] THEN Y[0]=Y[0]+1,Y[4]=-1 ELSE Y[2]=Y[2]-1; GOTO 4900
5280 WRITE (F,IND=0)IOL=0290
5290 RETURN 
5295 IF ERR<>0 THEN GOTO 9000 ELSE RETRY 
5300 REM "REMOVE INDEX Z
5310 GOSUB 5800
5330 WRITE (F,IND=Z)Y[1]
5340 Y[1]=Z,Y[4]=-1,Y[0]=Y[0]-1
5350 WRITE (F,IND=0)IOL=0290
5390 RETURN 
5395 ON ERR GOTO 5310,5311,9000
5400 REM "DELETE CURRENT LINE
5800 REM "BUSY LINES FILE - CK LOCK
5805 EXTRACT (F,IND=0,ERR=5895)IOL=0290
5810 IF Y[4]=-1 THEN Y[4]=-2; GOTO 5890 ELSE READ (F)
5820 LOCK (F,ERR=5805); UNLOCK (F); GOTO 5890
5890 WRITE (F,IND=0)IOL=0290; RETURN 
5895 IF ERR=0 THEN RETRY ELSE GOTO 9000
5900 REM "REMOVE LINES
5910 IF A0=0 THEN GOTO 5990
5920 EXTRACT (F,IND=0,ERR=5960)IOL=0290
5925 IF Y[4]=-2 THEN READ (F,IND=0); WAIT 0; GOTO 5920 ELSE Y[4]=-2; WRITE (F,IND=0)IOL=0290
5930 A1=Y[1],Y[1]=A0,Y[0]=Y[0]-1
5935 READ (F,IND=A0)A; IF A>0 THEN Y[0]=Y[0]-1,A0=A; GOTO 5935
5940 WRITE (F,IND=A0)A1
5950 Y[4]=-1; WRITE (F,IND=0)IOL=0290
5955 GOTO 5990
5960 IF ERR=0 THEN RETRY ELSE GOTO 9000
5990 RETURN 
8910 DEF FNZ$(X9$)=X9$(1,POS(Z0$=X9$+Z0$)-1)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 RETURN 
9900 REM 
9910 PRINT @(0,22),'CL',
9940 EXIT 
9999 END 
56000 REM "248947-Ran my first order entry gateway and got an error           
56002 REM "262361-GUI conversion of Accounts Payable Gateway - Module GW_A/P  
