0010 REM "Head-up Routine - Preprinted Forms <ZZPAGE>
0025 REM "3.1
0030 REM "(C) 1985,1986,1987,1992 Basic Ideas, Inc; Atlanta, Ga.
0035 REM "This software contains trade secrets and proprietary information"
0100 SETESC 9300; SETERR 9000
1000 REM "
1020 ENTER X0$,X1$,X2$,X3$,H0$,H1$,H2$,W9$,H0,H1,H2,H3,H4,H5,H6,H4$,H5$,V3$,X4$,X5$,X6$
1030 REM "H4$ is options, an 'S' means suppress date time & page #, an 's' means just suppress Date and time X means no heading"
1040 REM "H5=1 end report normally, H5=2 redisplay report, H5=3 report interrupted"
1045 H3$=W9$
1055 IF H0=0 THEN H0=80
1060 H=INT(H0/2)
1070 DIM Z$(H0),S$(H0),S0$(H0)
1100 REM "Lang Interface
1120 L0$=X3$(239,1); CALL "ZZLANG",X3$,L0$
1180 GOSUB 6900
1200 REM "Goto proper routine depending on output device
1205 H9=H1,H1=0,H3=H3+1
1210 ON H6 GOTO 2000,1500,1600,1800
1500 REM "Terminal Specific part
1510 IF H3<=1 THEN GOTO 1540 ELSE W9=1
1511 REM "1510 WAS <2
1520 W9=0; GOTO 1550
1530 CALL "ZZPROM","X0ZZHEAD",X3$,X4,"","","",0
1531 ON X4 GOTO 1540,1535,1537,1550
1535 H5=1; GOTO 9900
1537 H5=2; GOTO 9900
1540 PRINT (H2)'CS','SB',; IF W9$>"" THEN W9$(1)=""
1545 GOTO 2030
1550 REM "H0=WIDTH OF REPORT IN COLMS
1555 Q=INT((H0+NUM(V3$(28,3))-1)/NUM(V3$(28,3)))
1560 CALL "ZZVIEW",ERR=1530,X3$,2,W9,H0,0,H1,W9$,V3$
1565 W9=MOD(W9+1,Q)
1590 GOTO 1530
1600 REM "AUX
1610 IF H3>1 THEN IF X3$(184,1)="1" THEN CALL "ZZPROM","X0ZZREST",X3$,0,Q$,"","",0; S$(H-39)=Q$; GOSUB 7300
1620 GOSUB 8200
1630 IF H3>1 THEN GOSUB 3000
1640 GOTO 2030
1800 REM "Forms type printing"
1801 IF FID(H2)=FID(0) THEN GOTO 1500
1805 IF H3<2 THEN GOTO 2910
1820 FOR X=H9+1 TO H4; PRINT (H2)'LF',; NEXT X
1840 GOTO 2910
2000 REM "Printer Specific part
2015 GOSUB 8200
2020 IF H3>1 THEN GOSUB 3000
2025 IF POS("G"=FID(0))<>1 THEN PRINT @(0,20),'CL',@(20),"Processing page ",H3,
2030 W9$(1)=""; CLOSE (14); OPEN (14)"ZYP"; READ (14,KEY=V3$(17,1),DOM=2031)
2035 READ (14,END=2200)Q$; IF Q$(1,1)<>V3$(17,1) THEN GOTO 2200
2040 H1=NUM(Q$(2,3)),H9=NUM(Q$(5,3)),Q$=Q$(9)+S$
2045 IF POS("["=Q$)>0 THEN GOSUB 7500
2100 REM "SET PRINT STRING
2101 REM "H1=LINE NUMBER, H0=LINE WIDTH
2110 Q$=FNS$(Q$)
2120 W9$((H1-1)*H0+H9,LEN(Q$))=Q$
2190 GOTO 2035
2900 REM "
2910 H5=0
2950 GOTO 9900
3000 REM "Form feed routine"
3005 CALL "ZZVIEW",X3$,3,W9,H0,H2,H1,W9$,V3$
3010 IF H4=58 THEN PRINT (H2,ERR=3011)'FF',; GOTO 3090
3020 FOR X=H9+1 TO H4+8; PRINT (H2)'LF',; NEXT X; GOTO 3090
3090 RETURN 
6900 REM "DISP DATE/TIME
6905 Q$=STR(INT(TIM):"00")+STR(FPT(TIM)*100:"00")
6910 CALL "ZZDISP","TX",Q$,"",X3$,O0$,"",0,0,""
6915 Q$=X3$(21,6)
6920 CALL "ZZDISP","DX",Q$,"",X3$,O1$,"",0,0,""
6935 IF X3$(174,4)<>"    " THEN Q$=" ("+X3$(174,4)+")" ELSE Q$=""
6940 IF X3$(185,1)="A" THEN O3$=FNS$(L0$(472,16))+":"+STR(NUM(X3$(178,6))/100:"###0.00")+Q$
6950 IF X3$(184,1)="1" THEN O3$=O3$+"*" ELSE O3$=O3$+" "
6990 RETURN 
7300 REM "Output line  S$ to output device
7310 IF W9$>"" AND POS("V"=H4$)>0 THEN CALL "ZZVIEW",X3$,-1,0,H0,H2,H1,W9$,S$; GOTO 7345
7320 H1=H1+1; IF POS(" "<>S$)=0 THEN PRINT (H2)"" ELSE PRINT (H2)S$; S$(1)=""
7395 RETURN 
7500 REM "RETURN STRING FOR TOKEN Q$
7505 P0=POS("["=Q$); IF P0=0 THEN RETURN ELSE P1=POS("]"=Q$(P0)); IF P1=0 THEN RETURN 
7510 X$=Q$(P0+1,P1-2),Q$(P0,P1)=""
7535 IF X$="TITLE" THEN X$=X1$; GOTO 7690
7540 IF X$="PAGE" THEN X$=STR(H3:"###0"); GOTO 7690
7545 IF X$="COMP#" THEN X$=X3$(9,3); GOTO 7690
7550 IF X$="COMP" THEN X$=X2$; GOTO 7690
7555 IF X$="ADATE" THEN CALL "ZZDISP","DX",X3$(15,6),X2$,X3$,Q$,Q1$,0,0,X4$; Q$=FNS$(L0$(380,30))+": "+Q$,X$=Q$; GOTO 7690
7560 IF X$="RDATE" THEN X$=O1$; GOTO 7690
7565 IF X$="RTIME" THEN X$=O0$; GOTO 7690
7570 IF X$="DESCR1" THEN X$=H0$; GOTO 7690
7575 IF X$="DESCR2" THEN X$=H1$; GOTO 7690
7580 IF X$="DESCR3" THEN X$=H2$; GOTO 7690
7690 IF P0+LEN(X$)<LEN(Q$) THEN Q$(P0,LEN(X$))=X$
7695 GOTO 7505
8200 REM "GET CTRL VALUE
8205 IF POS("G"=FID(0))=1 THEN RETURN 
8215 READ RECORD (0,SIZ=1,ERR=8250)Q$ ! REMOVED TIM=0 <plh>
8220 IF POS(Q$="Ii")=0 THEN RETURN 
8240 H5=3; EXITTO 9900
8250 RETURN 
8910 DEF FNS$(Z$)=Z$(1,POS(S0$=Z$+S0$)-1)
9000 REM "ERROR PROCESSING
9010 E0=ERR,E1=TCB(5); IF E0=66 AND X3$(47,1)="1" THEN EXIT E0
9040 CALL "ZZERRM",E0$,"ZZPAGE",E1$,X3$,E0,E1,E2,E3,0
9050 ON E2 GOTO 9060,9100,9190,9070
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE E1$
9080 SETERR 9000; RETRY 
9100 REM " TRANSFER CONTROL
9190 H4=2
9195 GOTO 9900
9300 RETURN 
9900 REM "END PROGRAM
9920 EXIT 
9999 END 
