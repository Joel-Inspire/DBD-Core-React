0010 REM "<ZZPRMQ> Write Formatted Prompt Data
0030 REM "(C) 1985,1986,1987 Basic Ideas, Inc; Atlanta, Ga.
0035 REM "5.0 - 12/28/01 - 15.391666 - lms - SSP# 142887
0040 REM "Copyright 2001 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0320 DIM S$(132),M$(132,"_"),Z9$(6,$00$)
0980 X1=-1,X2=X1,X4=-1,C0=-1,T=10,D1=448
1000 SETERR 1005; ENTER X0$,X1$,X0,X2$,V0$,X4$,X1; GOTO 1010
1005 IF X0$="?" THEN CALL "ZZPDOC","ZZPRMQ"; EXIT ELSE EXIT ERR
1010 SETERR 9000; SETESC 9300; X8=X1
1013 P_L22=22,P_L23=23
1015 V0$=""
1016 REM "See if ZW mnemonic is set, if yes then set ZW_SET$ to 'Y'"+      " it will be checked later to see if extra space needs to be added"
1020 PRINT (0,ERR=1021)@(0,15),'ZW',; ZW_SET$="Y"
1025 IF LEN(X1$)>340 THEN D2$=ATH(X1$(340,12)+X1$(D1,10*12)),A0$=$1B$+"B"+X1$(46,1); IF ZW_SET$="Y" THEN A1$=$1B$+"ER " ELSE A1$=$1B$+"E"+X1$(46,1)
1030 S=X0,D0=NUM(X1$(60,3)); IF D0=0 THEN D0=14
1120 IF X0$="" THEN EXIT 36
1310 GOSUB 7000
1315 GOSUB 7700; X4$=X4$+FNS$(P$(77,5))
1318 IF POS("W"=X4$)>0 THEN X8=14,P_L22=14,P_L23=15
1320 IF POS("M"=X4$)>0 THEN P=POS(":"=X4$); IF P=0 THEN X8=7.2,X1=X8 ELSE X8=ASC(ATH("0"+X4$(P+1)))+.2,X1=X8
1321 X5$=X1$(276,2); IF POS("="=X4$)>0 THEN X5$=X4$(1+POS("="=X4$))
1322 IF POS("R"=X4$)>0 THEN X2$=""
1325 IF POS("R"=X4$)>0 OR POS("Q"=X4$)>0 THEN S0=0 ELSE IF POS("S"=X5$)>0 THEN S0=1 ELSE IF POS("H"=X5$)>0 THEN S0=2 ELSE S0=0
1330 IF POS("T"=X4$)>0 THEN X2$=P$(82,160); X0=POS(S$(1,16)=X2$+S$,16),X2$=X2$(1,X0-1),X0=INT(X0/16); GOTO 1585
1370 IF S0=0 THEN GOSUB 7100 ELSE GOSUB 7200
1540 IF X2<0 THEN X2=P_L22; IF POS("Q"=X4$)>0 OR POS("R"=Q4$)>0 THEN X2=23
1543 IF POS("W"=X4$)>0 THEN X2=P_L22
1545 IF POS("Q"=X4$)>0 OR POS("R"=Q4$)>0 THEN X2=23
1550 X9=39-INT(LEN(Q0$)/2); IF X9<0 THEN X9=0
1555 IF POS("W"=X4$)>0 THEN X9=0
1560 IF POS("R"=X4$)>0 THEN X2$=Q0$
1570 ON S0 GOSUB 8000,8100,8400
1575 Q=POS("."=X4$); IF Q>0 THEN V0$=V0$+$1B$+"RB",X4$(Q,1)=""
1585 CLOSE (D0); OPEN (D0)"ZZT2"
1586 IF POS("Q"=X4$)>0 OR POS("R"=X4$)>0 THEN X2$=V0$; P=POS($1B02$=X2$); IF P>0 THEN X2$=X2$(1,P-1)+X2$(P+4)
1587 IF X5$<>"H" AND POS("H"=X4$)=0 THEN H9$="",Q2$="",Q0$=""
1590 WRITE (D0,KEY=P$(3,9)+X1$(238,1))I0,V0$,X4$,Q5$,Q3$,Q4$,S0$,P9,S0,X5$,X2$,X9,Q6$,Q0$,Q2$,H9$
1595 GOTO 9900
1610 IF S0>0 OR POS("Q"=X4$)>0 THEN X0=C0; GOTO 1700
1620 P0=1,X0=-1
1625 IF Q2$(P0)="" THEN GOTO 9500 ELSE P=POS("|"=Q2$(P0)),X0=X0+1
1630 Q$=Q2$(P0,P-1),P0=P0+P; IF Q$="\" THEN Q$=""
1635 IF Q$="" THEN IF Q4$="" THEN GOTO 1700 ELSE GOTO 1625
1640 FOR X=1 TO LEN(Q$)
1650 IF Q$(X,1)<"a" OR Q$(X,1)>"z" THEN IF LEN(Q4$)<X THEN EXITTO 1625 ELSE IF Q4$(X,1)<>Q$(X,1) THEN EXITTO 1625
1655 IF Q$(X,1)>="a" AND Q$(X,1)<="z" THEN IF LEN(Q4$)<X THEN EXITTO 1700 ELSE IF CHR(ASC(Q$(X,1))-32)<>Q4$(X,1) THEN EXITTO 1625
1680 NEXT X
1690 IF LEN(Q4$)>LEN(Q$) THEN GOTO 1625
1790 GOTO 9900
1801 IF Q0$="" THEN RETURN 
1802 Q8=0; IF X9=0 THEN X9=1
1805 X1=X9+LEN(Q0$); IF POS("Q"=X4$)>0 THEN X2=23; IF X8<>0 THEN X2=X8
1807 IF POS("R"=X4$)=0 THEN V0$=V0$+$1B0200$+CHR(X2)
1810 P0=1,A9$="*"; IF X1$(238,1)="1" THEN P2=1
1811 IF POS("!"=X4$)>0 THEN V0$=V0$+$1B$+"BB"
1812 IF A9$="" THEN A0$=" ",A1$=" "
1815 IF POS("R"=X4$)=0 THEN V0$=V0$+$1B01$+CHR(X9)
1820 P=POS("|"=Q0$(P0)); IF P=0 THEN V0$=V0$+Q0$(P0); GOTO 1880
1825 V0$=V0$+Q0$(P0,P-1)
1830 P0=P0+P,P=POS(" "=Q0$(P0)+" ")-1,X1=X1-1,Q8=Q8+1
1840 IF P2=1 THEN V0$=V0$+$1B$+"BS"
1842 V0$=V0$+A0$+Q0$(P0,P)+A1$; IF P2=0 THEN V0$=V0$+" "
1845 P0=P0+P+1; IF P0<=LEN(Q0$) THEN GOTO 1820
1880 IF POS("R"=X4$)>0 THEN X2$=Q0$
1885 P0=P0+1+Q8
1890 IF POS("!"=X4$)>0 THEN V0$=V0$+$1B$+"EB"
1895 RETURN 
5005 L1$="",L2$=""
5010 P=POS("-"=X6$)
5020 IF P=0 THEN GOTO 5100
7005 CLOSE (D0); OPEN (D0)"ZZT"; F0=D0; RETURN 
7090 RETURN 
7105 Q2$="",Q0$=FNS$(P$(12,65))
7110 FOR X=0 TO 9
7115 IF POS(" "<>P$(82+X*16))=0 THEN EXITTO 7131
7125 Q$=FNS$(P$(82+X*16,16)); IF Q$<>"" THEN IF Q$="\" THEN Q$="|" ELSE Q$=Q$+"|"
7128 IF Q$<>"" THEN Q2$=Q2$+Q$
7130 NEXT X
7140 Q2$=Q2$+X9$
7145 GOSUB 7900
7150 IF S0=0 AND POS("Q"=P$(77,5))=0 AND POS("R"=P$(77,5))=0 THEN Q0$=Q0$+": "
7195 RETURN 
7210 Q2$="",Q0$=FNS$(P$(12,65)),Q3$="",Q4$="",Q4=0,Q5$="",Q6$="",Q8=0,R7=1,R8=P_L22,H9$="",Q=0; IF POS("M"=X4$)>0 THEN R8=INT(X1),R7=22
7220 FOR X=0 TO 10
7225 Q$=FNS$(P$(82+X*16,16)); IF Q$="" OR (POS("#"=P$(291+X*3,3))>0 AND X1$(43,2)<="99") THEN GOTO 7260 ELSE IF POS("!"=P$(291+X*3,3))>0 THEN Q4$=Q4$+STR(X:"000")
7228 IF X=0 THEN X$="Ret" ELSE X$="F"+STR(X)
7229 IF POS("L"=X5$)>0 THEN X$=Q$(1,1)
7230 IF LEN(Q2$+Q$)+5-Q>79 THEN Q9$=Q2$,Q2$="",Q=0,Q8=0,R8=R8+1,R7=1
7232 IF POS("H"=X5$)>0 THEN Q2$=Q2$+CHR(R7)+CHR(R8)+CHR(LEN(Q$))+Q$,H9$=H9$+P$(324+X*35,35),R9=0; IF POS("M"=X4$)=0 THEN R7=R7+3+LEN(Q$); GOTO 7242 ELSE R8=R8+10*FPT(X1); GOTO 7242
7235 X$=A0$+X$+A1$; IF X1$(238,1)="0" THEN X$=X$+" "
7240 IF POS("Q"=P$(291+X*3,3))=0 THEN Q2$=Q2$+X$+Q$+" ",Q8=Q8+1; IF X1$(238,1)="0" THEN Q2$=Q2$+" ",Q=Q+6 ELSE Q=Q+4
7242 IF POS("S"=P$(291+X*3,3))>0 THEN S0$=S0$+STR(X:"000")
7243 IF POS("A"=P$(291+X*3,3))>0 THEN D2=NUM(P$(324+X*35,3),ERR=7244),D2$=D2$+ATH(X1$(340+(D2-1)*12,12)),Q5$=Q5$+STR(D2+10:"000"),Q3$=Q3$+P$(258+X*3,3),Q6$=Q6$+$FF$; GOTO 7265
7245 IF R9=0 THEN Q3$=Q3$+P$(258+X*3,3),Q4=Q4-2,Q5$=Q5$+STR(X:"000"),Q6$=Q6$+Q$(1,1)
7265 NEXT X; P9=LEN(Q2$)-Q+POS("1"=X1$(238,1))
7290 RETURN 
7615 X$=FNS$(P$(C0*35+324,35))
7620 X0=0; CALL "ZZPROM",ERR=7621,X$,X1$,X0,"","","",X1
7640 IF X0=0 THEN RESET ; GOTO 1580
7690 RESET ; GOTO 1700
7705 DIM P$(709)
7715 I0=-1; EXTRACT (F0,KEY=X0$,DOM=7720)P$(1); I0=IND(F0); GOTO 7790
7730 EXIT 11
7799 RETURN 
7920 IF X2$>"" THEN IF X2$(1,1)<>"+" THEN Q0$=X2$ ELSE Q0$=Q0$+" "+X2$(2)
7940 RETURN 
8005 X2=P_L23; GOSUB 1800
8050 RETURN 
8105 GOSUB 8700; X9=0
8110 IF Q9$>"" THEN Q0$=Q9$,X2=P_L22 ELSE Q0$=FNS$(P$(12,65))
8111 GOSUB 7900; GOSUB 1800
8115 Q0$=Q2$,X2=P_L23,X9=0; GOSUB 1800
8190 RETURN 
8205 PRINT @(P9,P_L23),; IF M0=0 THEN READ RECORD (D0,SIZ=1,TIM=T,ERR=8850)Q$ ELSE GOSUB 8250
8206 IF Q$="" THEN GOTO 8205
8210 REM "IF Q$=$0D$ THEN C0=1,X3=C0; GOTO 8240 ELSE IF Q$=$03$ THEN EXIT 66 ELSE IF Q$=$05$ THEN EXIT 67 ELSE IF Q$=$10$ THEN CALL "ZZSCRN",ERR=8205,X1$,""; GOTO 8205
8211 IF Q$=$10$ THEN IF TCB(88) THEN CALL "*conv.tdb/tf_control" ELSE CALL "ZZSCRN",X3$,X4$; GOTO 8205 ELSE IF Q$=$05$ THEN EXIT 67 ! <plh>
8212 X8$=Q$,C0=-1,P=POS(X8$=D2$,6); IF P>0 THEN GOTO 8235 ELSE IF POS("C"=X4$+X5$)>0 OR POS("L"=X5$)>0 THEN P=POS(Q$=Q6$); IF P>0 THEN C0=NUM(Q5$((P-1)*3+1,3))+1,X3=C0; GOTO 8240 ELSE IF ASC(Q$)>90 THEN Q$=CHR(ASC(Q$)-32); GOTO 8212
8213 PRINT 'RB',; GOTO 8200
8225 Q$=""; IF M0=0 THEN READ RECORD (D0,SIZ=1,TIM=POS("P"=X1$(77,1)),ERR=8235)Q$ ELSE GOSUB 8250
8227 IF X8$="" THEN IF Q$=$03$ THEN EXIT 66
8230 X8$=X8$+Q$; IF LEN(X8$)>6 THEN GOTO 8235 ELSE P=POS(X8$+Z9$(1,6-LEN(X8$))=D2$,6); IF P=0 THEN GOTO 8225
8235 IF Q$="" THEN PRINT 'RB',; GOTO 8200 ELSE IF LEN(X8$)>6 THEN PRINT 'RB',; RETURN ELSE P=POS(X8$+Z9$(1,6-LEN(X8$))=D2$,6); IF P=0 THEN GOTO 8225 ELSE C0=INT(P/6)+1,X3=C0
8245 RETURN 
8255 CALL "ZZDEMO",X1$,1,D0,Q$,M0; RETURN 
8290 RETURN 
8305 Q$=FNS$(P$(82+C0*16,16)),V$=""; PRINT @(0,P_L22),'CE',
8315 CALL "ZZPROM","V",X1$,0,V$,"","",0; V$=V$+" "+Q$
8320 CALL "ZZPROM","Y",X1$,V0,V$,Q$,"",0
8390 RETURN 
8400 RETURN 
8410 Q$="CDH"; IF POS("M"=X4$)>0 THEN Q$=Q$+"M"
8490 X0=C0; GOTO 9900
8710 T0$=FNS$(X1$(169,3)),D0$="",D0$=FID(D0,ERR=8711)
8715 CLOSE (D0); IF LEN(T0$)=2 THEN OPEN (D0)T0$ ELSE CALL "ZZDEMO",X1$,0,D0,Q$,M0
8740 RETURN 
8805 Q$=""
8810 CALL "ZZPROM","X0ZZPROM",X1$,0,Q$,"","R",0; PRINT @(0,P_L22),'CE',@(0,P_L23),Q$,":",; Q=LEN(Q$)+2
8830 DIM A4$(3); CALL "ZZENTR","ZX",A{ALL},A4$,"",X1$,Q,P_L23,1,3,C0,"","","","","","",""; IF C0<0 THEN RETURN 
8840 IF POS("V"=X4$)=0 OR A4$="" THEN EXITTO 1580 ELSE P=-1,X1=NUM(A4$)
8845 RETURN 
8860 IF X1$(78,1)<>"1" OR POS(X1$(185,1)="RUA*")>0 THEN GOTO 8205 ELSE Q=1+POS("M"=X1$(185,1)); CALL "ZZTIME",ERR=8861,X1$,Q,0; T9=0
8864 GOTO 8205
8890 RETURN 
8910 DEF FNS$(Z0$)=Z0$(1,POS("    "=Z0$+"    ")-1)
9020 EXIT ERR
9310 IF X1$(47,1)="1" THEN EXIT 66 ELSE RETURN 
9510 IF POS("V"=X4$)=0 OR Q4$="" THEN GOTO 1580 ELSE X0=-1,X1=NUM(Q4$,ERR=1580); GOTO 9900
9920 CLOSE (F0,ERR=9921)
9940 EXIT 
9999 END 
