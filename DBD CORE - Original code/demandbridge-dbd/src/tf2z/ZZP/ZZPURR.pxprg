0010 REM "Text Implementation of Event Prediction <ZZPURR>
0030 REM "(C) 1985,1986,1987 Basic Ideas, Inc; Atlanta, Ga.
0035 REM "This software contains trade secrets and proprietary information"
0039 REM 
0040 REM "Prediction based on multiple contexts - an event consisting
0041 REM "of one word or punctuation.
0100 BEGIN 
0110 DIM Z$(10,"0"),S$(20)
0305 W0=3,W1=1,M0=2000,M2=3
0306 W2=14
0360 IOLIST A0$,A1$,A2
0400 REM "FILE
0410 INPUT "RE-CREATE FILE? = F4",*; IF CTL<>4 THEN GOTO 0490
0420 ERASE "ZPR",ERR=0421
0430 DIRECT "ZPR",11,M0,64
0490 OPEN (1)"ZPR"
0495 OPEN (9)FID(0)
0500 REM "
0600 REM "GET PRIMES USING SIEVE METHOD
0620 DIM Z0$(M0,$00$)
0630 PRINT "Sieve of Aristostanes Method"
0635 PRINT 'LF',@(0),"CHECKING NUMBERS:",
0650 FOR X=2 TO INT(M0/2); IF X<>2 AND MOD(X,2)=0 THEN GOTO 0670
0652 PRINT @(20),X:"###,##0",
0655 FOR Y=2*X TO M0 STEP X
0660 Z0$(Y,1)=$01$
0665 NEXT Y
0670 NEXT X
0675 FOR X=LEN(Z0$) TO 3 STEP -1
0690 IF Z0$(X,1)=$00$ THEN P$=P$+BIN(X,2)
0695 NEXT X; Z0$=""
0700 REM 
0710 REM "W0=WINDOW SIZE IN EVENTS, W0$ IS WINDOW
0711 REM "M0=SIZE OF MEMORY,M1=LENGTH OF EACH CELL, M2=TIMES TO ADD EACH EVENT
0712 REM "W1=LENGTH OF WINDOW IN BYTES
0800 REM 
0820 PRINT 'LF',"READY..."
1000 REM "
1020 GOSUB 8000
1100 REM 
1110 IF LEN(W0$)<W1*W0 THEN W0$=W0$+W$; GOTO 1300
1200 REM "LETTER CONTEXT
1202 REM GOTO1300
1205 C9$="L",W9=W1
1220 W9$=W0$,W8$=W$; GOSUB 7000
1270 W0$=W0$+W$
1280 IF LEN(W0$)>W1*W0 THEN W0$=W0$(W1+1)
1285 W9$=W0$; GOSUB 7200
1286 IF POS(FNS$(W$)=".!?")>0 THEN W0$=""
1300 REM "WORD CONTEXT
1302 IF W$>="a" AND W$<="z" THEN W$=CHR(ASC(W$)-32)
1305 W9=W2
1310 IF POS(W$="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789")<>0 THEN W1$=W1$+W$; GOTO 1400
1315 W1$=W1$+S$; W1$=W1$(1,W2); IF FNS$(W1$)="" THEN W1$=""; GOTO 1400
1320 W2$=W2$+W1$; IF LEN(W2$)<=W2*W0 THEN GOTO 1390 ELSE W9$=W2$(1,W0*W2)
1330 C9$="W",W8$=W1$,W9=W2; GOSUB 7000; W1$=""
1350 W2$=W2$(W2+1)
1360 W9$=W2$; GOSUB 7200
1390 W1$=""
1990 GOTO 1000
7000 REM "CONTEXT OF W9$ AND EVENT OF W8$
7005 IF C9$="" THEN C9$=" "
7010 P0=0,C0$=HSH(W9$),C0=DEC($00$+C0$),P=0
7015 P0=P0+1,P1=DEC($00$+P$((P0-1)*2+1,2))
7020 P9=MOD(C0,P1)
7050 REM "ADD TO MEMORY
7055 READ (1,KEY=C9$+STR(P9:Z$(1,10)),DOM=7065)IOL=0360
7060 IF A0$<>W8$ THEN GOTO 7015 ELSE GOTO 7080
7065 A0$=W8$,A1$=W9$,A2=P1
7070 WRITE (1,KEY=C9$+STR(P9:Z$(1,10)))IOL=0360
7080 IF P=M2 THEN RETURN ELSE P=P+1; GOTO 7015
7200 REM "CONTEXT OF W9$; PREDICT EVENT W9$
7210 P0=0,C0$=HSH(W9$),C0=DEC($00$+C0$),P=0,P0$="",P9$="",P1$=""
7215 P0=P0+1,P1=DEC($00$+P$((P0-1)*2+1,2))
7220 P9=MOD(C0,P1)
7225 READ (1,KEY=C9$+STR(P9:Z$(1,10)),DOM=7300)IOL=0360
7230 IF W9$<>A1$ THEN GOTO 7300
7240 Q=POS(A0$=P0$,W9); IF Q=0 THEN P0$=P0$+A0$,P1$=P1$+$00$ ELSE Q=1+INT((Q-1)/W9); IF P1$(Q,1)<$FF$ THEN P1$(Q,1)=CHR(ASC(P1$(Q,1))+1)
7245 GOTO 7215
7300 REM "
7302 PRINT P0$
7310 P9$="",P5$=P0$,X9$=""
7320 IF P1$="" THEN GOTO 7380 ELSE Q=ASC(P1$(1,1)),P1$=P1$(2); IF Q>=0 THEN P9$=P9$+P0$(1,W9); X9$=X9$+FNS$(P0$(1,W9))+", "
7330 P0$=P0$(W9+1); GOTO 7320
7380 IF P9$>"" THEN PRINT 'BR',C9$,"<",P9$,'ER',
7390 RETURN 
8000 REM "ENTER AN EVENT
8002 W$=""
8005 READ RECORD (9,SIZ=1)Q$; IF Q$="/" THEN PRINT 'RB',; GOTO 8000 ELSE IF W1=1 THEN W$=Q$; PRINT W$,; GOTO 8090
8006 IF Q$="Ê" THEN IF P9$>"" THEN W$=P9$(1,W1); GOTO 8085
8010 IF Q$<>" " THEN W$=W$+Q$; GOTO 8005
8020 W$=W$+S$,W$=W$(1,W1)
8085 PRINT FNS$(W$)," ",
8090 RETURN 
8900 REM "Bit level flags / functions
8905 DEF FNS$(X$)=Z$(1,POS("  "=Z$+"  ")-1)
8910 DEF FNP$(Z0,Z0$)=IOR(CHR(2^(Z0-1)),Z0$)
8915 DEF FNQ$(Z0,Z0$)=XOR(CHR(2^(Z0-1)),Z0$)
8920 DEF FNR(Z0,Z0$)=SGN(ASC(AND(CHR(2^(Z0-1)),Z0$)))
9999 END 
