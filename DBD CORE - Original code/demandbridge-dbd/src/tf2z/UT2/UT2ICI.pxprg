0010 REM "Rebuild expanded FMZ data from ICI <UT2ICI>
0100 BEGIN 
0120 DIM A$(335),A[14],B[7],S$(40)
0310 IOLIST A$(1),A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],A[8],A[9],A[10],A[11],A[12],A[13],A[14]
0320 IOLIST B$,B[0],B[1],B[2],B[3],B[4],B[5],B[6],B[7]
0330 IOLIST C$,C0
0405 C0$="047"
0410 OPEN (1)"FMZ"+C0$
0420 OPEN (2)"ICI"+C0$
0500 REM 
0510 C1$="0004530000"
0900 REM "CREATE TEMP FILE
0905 Q$="TMP"+FID(0)
0910 ERASE Q$,ERR=0911; GOTO 0910
0915 DIRECT Q$,17,10000,32
0930 OPEN (3)Q$
0990 READ (2,KEY=C1$,DOM=0991)
1000 REM "BUILD ICI SORT BY RELEASE NUMBER
1020 K$=KEY(2,END=2000); I2=IND(2); READ (2,END=2000)IOL=0320
1025 IF K$(1,LEN(C1$))<>C1$ THEN GOTO 2000
1040 Q$=B$(110,11)+STR(I2:"000000")
1045 PRINT @(0),K$,
1050 WRITE (3,KEY=Q$,DOM=1051)Q$,I2; GOTO 1200
1055 ESCAPE 
1080 REM 
1200 REM 
1280 GOTO 1020
2000 REM "PROCESS FMZ
2005 PRINT 'LF',"PROCESSING DETAIL FILE:"
2010 READ (1,KEY=C1$,DOM=2011)
2020 K$=KEY(1,END=3000); READ (1,END=3000)IOL=0310; IF A$(1,LEN(C1$))<>C1$ THEN GOTO 39000
2021 PRINT @(0),K$,
2022 IF A$(231,9)<>S$(1,9) THEN PRINT "."; GOTO 2020
2025 DIM C[10,1]; C9=0
2030 Q$=A$(113,8)+A$(151,3)
2040 READ (3,KEY=Q$,DOM=2041)
2045 X$=KEY(3,END=2200); IF X$(1,LEN(Q$))<>Q$ THEN GOTO 2200
2050 REM "GOES WITH THIS ORDER
2055 READ (3)IOL=0330
2060 C[C9,0]=C0,C9=C9+1
2080 GOTO 2045
2200 REM 
2204 REM "CK FOR MULTIPLE ENTRIES
2205 REM IF C9<>1 THEN ESCAPE
2300 REM "ONE LINE FOR THIS ENTRY
2310 IF C9=0 THEN GOTO 2020
2320 READ (2,IND=C[0,0])IOL=0320
2325 IF A$(1,10)+A$(16,10)<>B$(1,20) THEN ESCAPE 
2330 A$(155,10)="ICI DATA",A$(231,9)=B$(41,9)
2331 A$(240,6)=B$(50,6),A$(246,12)=B$(56,12),A$(258,10)=B$(100,10),A$(268,8)=B$(121,8)
2332 A$(276,40)=B$(156,40),A$(316,19)=B$(196,12)
2333 IF A$(86,6)=S$(1,6) THEN A$(86,6)=B$(215,6)
2350 WRITE (1,KEY=K$)IOL=0310
2390 GOTO 2020
3020 INPUT "COMPLETED!  PRESS RETURN",*
3040 RUN "ZMENU"
9999 END 
