0010 REM "SEARCH FOR INVALID BATCH FILES <UT2BAT>
0035 REM "5.2 - 05/21/03 - 8.654444 - tma - SSP#  156041 
0040 REM "Copyright 2003 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0100 BEGIN 
0200 REM "
0205 X0$="UT2BAT",X1$="Check for Orphan Batch Files"
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(65,1)>"2" THEN PRECISION NUM(X3$(65,1),ERR=0246)
0410 OPEN (1)"ZY9"
0430 OPEN (3)"ZZE"
0600 D0=NUM(X3$(31,1))
0605 IF D0<>0 THEN D0=0; ESCAPE 
0610 OPEN (2)%DATAPATH$
0620 TSK$=TSK(0,ERR=0621)
0640 CALL "ZZPROM",".Y",X3$,Z,"Proceed?","","",0; ON Z GOTO 0641,9900
1010 IF X3$(77,1)="T" THEN K$=KEY(2,END=5000); READ (2); F$=K$(1,8); GOTO 1200
1020 READ RECORD (2,END=5000)F$
1030 IF POS(F$+"0"=TSK$,3)<>0 OR POS(F$+"2"=TSK$,3)<>0 THEN GOTO 1000
1040 F$=F$(1,POS($00000000$=F$+$00000000$)-1)
1050 OPEN (5,ERR=1000)F$; CLOSE (5); GOTO 1225
1200 REM 
1220 F$=F$(1,POS("   "=F$+"   ")-1)
1225 PRINT @(15,9),"Processing file: ",F$,'CL',
1240 IF LEN(F$)<>7 THEN GOTO 1000
1250 IF F$="TCONFIG" THEN GOTO 1000
1260 FIND (3,KEY=F$(1,3)+"   ",DOM=1000)F0$
1280 IF F0$(46,1)<>"1" THEN GOTO 1000
1300 REM "THIS IS A BATCH FILE
1310 B=NUM(F$(4,4),ERR=1000)
1320 READ (1,KEY=F$(4,4)+" ",DOM=1321)F0$; GOTO 2000
1330 F0$=KEY(1,END=1600)
1350 IF F0$(1,4)<>F$(4,4) THEN GOTO 1600
1400 GOTO 2000
1600 REM "THIS IS A BAD FILE
1610 OPEN (5)F$; R0$=FIN(5,"NUMREC"); R0=NUM(R0$)
1615 CLOSE (5)
1619 PRINT @(0,20),'CL',@(5,20),"Records in use: ",R0
1620 REM "INPUT 'RB',@(12,12),"THERE IS NO BATCH CONTROL RECORD FOR THIS FILE! (RETURN) ",*,@(0,12),'CL',
1630 IF X3$(43,2)="SU" THEN CALL "ZZPROM","YE",X3$,S3,"Do you wish to remove this batch file? ","","",0; PRINT @(0,20),'CL',; ON S3 GOTO 1631,2060,9900
1635 IF X3$(43,2)<>"SU" THEN CALL "ZZPROM",".5",X3$,Z,"","","",0; PRINT @(0,20),'CL',; ON Z+1 GOTO 2060,2060,9900
1700 CLOSE (5)
1710 PRINT @(20,20),F$,
1720 ERASE F$
1900 GOTO 1000
2000 REM HAS CONTROL RECORD
2060 GOTO 1000
5050 GOTO 9900
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)<>"1" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; SETESC 9300; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9740 RETURN 
9750 REM "FILES
9760 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1
9790 RETURN 
9800 REM "EXIT PROGRAM
9900 REM "END PROGRAM
9905 Y8=2
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q1$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
