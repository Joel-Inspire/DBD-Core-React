0010 REM "Update Image Library -Customer Related file UT2ILG
0020 SETESC 9300; SETERR 9000
0035 REM "5.7 - 12/01/16 - 12.788333 - tma - SSP# 288426
0037 REM "288426-With our conversion from 05 to 04 in the image library, the 
0040 REM "Copyright 2016 Demand Bridge, LLC.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0045 REM "Q0$ IS THE ACTUAL DATA RECORD TO BE UPDATED
0050 REM "Q1$ IS THE NEW DATA TO REPLACE THE OLD DATA
0051 REM "K0$ IS THE KEY DATA
0052 REM "F$  IS THE FILE NAME Q0$ IS FROM
0054 REM "G$  IS THE GROUP
0056 REM "K   IS THE POSITION IN THE KEY
0058 REM "D   IS THE POSITION IN THE DATA RECORD
0060 REM "L   IS THE LENGTH OF THE DATA FIELD
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,Q0$,Q1$,K0$,F$,G$,K,D,L
0100 REM SETERR 9000
0240 CALL "ZZCOMP",X0$,X1$,X2$,X3$,X4$,M9$,X0,X1,X2; IF X1>0 THEN GOTO 9920
0245 IF X3$(66,1)>"2" THEN PRECISION NUM(X3$(66,1),ERR=0246)
0250 PRECISION 9
0300 REM "IOLISTS
0400 DIM COUNTER$[5000,2]; REM SSP 221104!SSP#257500
0420 IOLIST X3$,X4$,V1$,V3$,V2$,V0$; REM SSP 221104
0500 REM "FILES                                                         
0505 DIM Z[NUM(X3$(60,3))]; GOSUB 7400; REM SSP 221104
0510 Z$="01O UT3...  02O IL1...  13O ZZPARM  "
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0610 GOSUB 6000
0710 CLOSE (15); OPEN LOCK (15,ERR=*NEXT)"CHANGED_LOG"; GOTO 0730
0720 IF ERR=12 THEN SERIAL "CHANGED_LOG"; GOTO 0710
0730 CLOSE (14); OPEN LOCK (14,ERR=*NEXT)"BAD_LOG"; GOTO 0750
0740 IF ERR=12 THEN SERIAL "BAD_LOG"; GOTO 0730
1000 REM "MAIN LOOP
1001 R=0,CO=0,CN=1; REM SSP 221104
1002 READ (Z[1],KEY="",DOM=*NEXT)
1003 UT3_K$=KEY(Z[1],END=1011); READ (Z[1]); REM SSP 221104
1005 READ (Z[1],KEY=UT3_K$)UT3$
1006 IF V2$(1,3)<>UT3_K$(1,3) THEN GOTO 1003
1007 OLD_CUST$=UT3$(5,10); NEW_CUST$=UT3$(25,10)
1008 COUNTER$[R,CO]=OLD_CUST$,COUNTER$[R,CN]=NEW_CUST$; REM SSP 221104
1009 R=R+1; REM SSP 221104
1010 GOTO 1003; REM SSP 221104
1011 READ (Z[2],KNO=1,KEY="",DOM=*NEXT)
1012 IL1_K$=KEY(Z[2],KNO=1,END=9900); READ (Z[2]); REM SSP 221104
1015 IF POS(IL1_K$(1,2)="00010211A2A4A8",2)=0 AND V2$(1,3)="VNC" THEN GOTO 1012; REM IL1 record is not a vendor type
1016 IF POS(IL1_K$(1,2)="05061014A0A3A4A5A60913",2)=0 AND POS(V2$(1,3)="AR1ARD",3)<>0 THEN GOTO 1012; REM IL1 record is not a customer type, SSP243528!SSP#288426
1017 READ (Z[2],KEY=IL1_K$)IL1$
1018 PRINT @(12,12),IL1$(8,10),IL1$(213,30); REM SSP 221104
1020 FOR SAM=0 TO R; REM SSP 221104
1022 IF COUNTER$[SAM,0]<>IL1$(8,10) AND COUNTER$[SAM]<>IL1$(213,10) THEN GOTO 1040; REM SSP 221104
1030 OLD_CUST$=COUNTER$[SAM,0],NEW_CUST$=COUNTER$[SAM,1]
1035 EXITTO 1060; REM SSP 221104
1040 NEXT SAM; REM SSP 221104
1060 IF SAM>=R THEN GOTO 1012; REM SSP 221104
1080 ON POS(IL1_K$(1,2)="05061014A0A3A5A609000111A2A4A813",2) GOTO 1012,1100,1012,1200,1012,1300,1012,1200,1012,1400,1012,1500,1012,1600,1012,1700,1012,1800,1012,1900,1012,2000,1012,2100,1012,2100,1012,2200,1012,2300,1012,2400,1012,2500,1012; REM 221104,243528!SSP#288426
1100 REM "TYPE 05 - Customer Check
1102 IF OLD_CUST$<>IL1$(8,10) THEN GOTO 1199
1103 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 1199
1176 FINAL_REC$=IL1$
1178 FINAL_REC$(8,10)=NEW_CUST$
1179 FINAL_REC$(213,10)=NEW_CUST$
1190 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1199
1199 GOTO 1012
1200 REM "TYPE 06 - Customer Logo, TYPE 14 - Customer Tax Form
1202 IF OLD_CUST$<>IL1$(8,10) THEN GOTO 1299
1203 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 1299
1276 FINAL_REC$=IL1$
1278 FINAL_REC$(8,10)=NEW_CUST$
1290 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1299
1299 GOTO 1012
1300 REM "TYPE 10 - Customer Note
1302 IF OLD_CUST$<>IL1$(8,10) THEN GOTO 1399
1303 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 1399
1376 FINAL_REC$=IL1$
1378 FINAL_REC$(8,10)=NEW_CUST$
1390 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1399
1399 GOTO 1012
1400 REM "Type A0 - Customer Invoice
1402 IF OLD_CUST$<>IL1$(213,10) THEN GOTO 1499
1404 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 1499
1476 FINAL_REC$=IL1$
1478 FINAL_REC$(213,10)=NEW_CUST$
1490 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1499
1499 GOTO 1012
1500 REM "Type A3 - Reorder Notice
1502 IF OLD_CUST$<>IL1$(8,10) THEN GOTO 1599
1503 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 1599
1576 FINAL_REC$=IL1$
1578 FINAL_REC$(8,10)=NEW_CUST$
1590 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1599
1599 GOTO 1012
1600 REM "Type A5 - Customer Quote
1602 IF OLD_CUST$<>IL1$(213,10) THEN GOTO 1699
1603 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 1699
1676 FINAL_REC$=IL1$
1678 FINAL_REC$(213,10)=NEW_CUST$
1690 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1699
1699 GOTO 1012
1700 REM " Type A6 - Customer Statement
1702 IF OLD_CUST$<>IL1$(8,10) THEN GOTO 1799
1703 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 1799
1776 FINAL_REC$=IL1$
1778 FINAL_REC$(8,10)=NEW_CUST$
1790 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1799
1799 GOTO 1012
1800 REM "Type 09 Item Image
1802 IF OLD_CUST$<>IL1$(213,10) THEN GOTO 1799
1803 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 1899
1876 FINAL_REC$=IL1$
1878 FINAL_REC$(213,10)=NEW_CUST$
1890 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1799
1899 GOTO 1012
1900 REM "TYPE 00 - Vendor Quote
1902 IF OLD_CUST$<>IL1$(8,10) THEN GOTO 1012
1903 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 1999
1976 FINAL_REC$=IL1$
1978 FINAL_REC$(8,10)=NEW_CUST$
1990 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1799
1999 GOTO 1012
2000 REM "TYPE 01 - Vendor Invoice
2002 IF OLD_CUST$<>IL1$(213,10) THEN GOTO 1799
2003 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 2099
2076 FINAL_REC$=IL1$
2078 FINAL_REC$(213,10)=NEW_CUST$
2090 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1799
2099 GOTO 1012
2100 REM "TYPE 11 - Vendor Note
2102 IF OLD_CUST$<>IL1$(8,10) THEN GOTO 1799
2103 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 2199
2176 FINAL_REC$=IL1$
2178 FINAL_REC$(8,10)=NEW_CUST$
2190 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1799
2199 GOTO 1012
2200 REM "TYPE A2 - Purchase Order to Vendor
2202 IF OLD_CUST$<>IL1$(213,10) THEN GOTO 1799
2203 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 2299
2276 FINAL_REC$=IL1$
2278 FINAL_REC$(213,10)=NEW_CUST$
2290 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1799
2299 GOTO 1012
2300 REM "Type A4 - RFQ to Vendor
2302 IF OLD_CUST$<>IL1$(213,10) THEN GOTO 1799
2303 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 2399
2376 FINAL_REC$=IL1$
2378 FINAL_REC$(213,10)=NEW_CUST$
2390 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1799
2399 GOTO 1012
2400 REM "Type A8 - Check to Vendor
2402 IF OLD_CUST$<>IL1$(213,10) THEN GOTO 1799
2403 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 2499
2476 FINAL_REC$=IL1$
2478 FINAL_REC$(213,10)=NEW_CUST$
2490 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 1799
2499 GOTO 1012
2500 REM "Type 13 - Customer PO                                         !SSP#288426
2502 IF OLD_CUST$<>IL1$(213,10) THEN GOTO 2599
2504 IF DELETE$="Y" THEN REMOVE (Z[2],KEY=IL1$(1,5)); DELETE$=""; GOTO 2599
2576 FINAL_REC$=IL1$
2578 FINAL_REC$(213,10)=NEW_CUST$
2590 WRITE RECORD (Z[2],KEY=IL1$(1,5))FINAL_REC$; GOTO 2599
2599 GOTO 1012
6000 REM "BACKGROUND                                                            
6005 PRINT (0,ERR=6016)'SB',
6020 PRINT @(0,4),"This CSI utility program Updates the Image Library Masterfile during a Customer Number Change",
6165 PRINT (0,ERR=6166)'SF',
6190 RETURN 
7400 REM "Read report selection parameters"  SSP 221104
7410 Z$="12O ZZP     "
7420 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 7421,9900
7430 Y3$=X3$(1,6),Y4$=X3$(178,7)
7450 READ (Z[12],KEY=X3$(1,8),DOM=7451)IOL=0420
7480 X3$(178,7)=Y4$,V0=NUM(V0$(71,1)),W3$=V0$(19,POS("   "=V0$(19,40)+"  ")-1)
7485 FOR U1=1 TO LEN(V1$); IF V1$(U1,1)=" " THEN V1$(U1,1)="."; NEXT U1 ELSE NEXT U1
7490 RETURN 
7999 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9500 REM "CTRL LOGIC
9510 SETERR 9000; GOSUB 6400
9520 ON C9 GOTO 1140,2040
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; Q0$=A1$; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
56000 REM "217233-Modify the program that moves Images for the Customer 
56001 REM "221104-Issues with utilities to move vendor/customer images during
56002 REM PROGRAM COPIED FROM UT2CUS
56003 REM "243528-UT2ILG does not update the tax certificate records to the   
56004 REM "288426-With our conversion from 05 to 04 in the image library, the 
