0010 REM "System File Definition Routine <ZZ2SYS>
0035 REM "5.2 - 08/23/03 - 12.035277 - dmm - SSP# 133604
0040 REM "Copyright 2003 TopForm Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0320 IOLIST F1$,S[0],S[1],S[2]
0901 REM "Company data files definition
0902 REM "Q$="D-DEFINE, E-ERASE
0905 REM "C0$ IS COMPANY CODE EXTENSION, BLANK USES X3$(9,3)
1000 REM 
1010 SETERR 9000
1011 IF %GUI THEN SETERR 1030
1020 ENTER X3$,Q$,C0$,D
1030 X0$="ZZ2SYS"
1035 IF C0$="" THEN C0$=X3$(9,3)
1200 REM "
1205 REM "D IS DISK TO DEFINE FILES ON, F1 IS OVERRIDING DEFAULT
1210 DIM Z[NUM(X3$(60,3))],S$(40)
1220 Z$="01O ZZE  02O ZYE...  "
1240 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,0; ON Z0 GOTO 1241,9900
1500 REM 
1501 IF %GUI THEN PRINT 'DIALOGUE'(10,10,80,10,X1$)
1520 PRINT @(0,22),'CE',@(17),"Enter system size (1=small, 2=medium, 3=large): ",
1530 DIM S0$(20); CALL "ZZENTR","ZX",X{ALL},S0$,X4$,X3$,65,22,1,1,C0,"","","","","","",""
1540 IF C0<0 THEN GOTO 9800 ELSE IF POS(S0$(1,1)="123")=0 THEN GOTO 1530
1550 S0=NUM(S0$(1,1)),F1=100
1990 READ (Z[2],KEY="",DOM=1991)
2000 REM "STEP THROUGH FILES
2005 X$="DEFINITION"; IF Q$="E" THEN X$="DELETION"
2020 DIM S[10]; READ (Z[2],END=2500)IOL=0320
2100 F$=F1$(1,6),F0$=FNS$(F$); IF LEN(F0$)=3 THEN IF F1$(57,1)<>"Y" THEN F0$=F0$(1,3)+C0$
2120 FIND (Z[1],KEY=F$,DOM=2140)A$
2130 GOTO 2200
2140 CALL "ZZPROM","4",X3$,0,"CANNOT GET'ZZE' FILE DEFINITION DATA FOR "+F$,"","",0; GOTO 2020
2200 REM "
2220 K=NUM(A$(48,2)),B=0,B=NUM(A$(50,4),ERR=2221)
2230 GOSUB 3000
2234 REM "If indexed file, rec size must be at least 16 to write control rec
2235 IF K<>0 AND B>0 AND B<16 THEN B=16
2239 IF R=0 THEN PRINT 'RB',@(0,22),"RECORDS=0",; INPUT *
2240 IF R=0 AND (B<>0 OR K=0) THEN GOTO 2480 ELSE IF R<10 THEN R=10
2290 F$=F0$
2400 REM "
2404 REM "Skip all existing files
2405 CLOSE (14); OPEN (14,ERR=2406)F$; GOTO 2450
2410 PRINT @(0,22),'CL',@(7),X$,": File: ",F$,"- ",F1$(17,40),
2415 IF Q$="E" THEN GOTO 2600 ELSE SETERR 7000
2418 R=INT(R)
2420 IF K=0 THEN INDEXED F$,R,B; GOSUB 5200; GOTO 2480
2430 IF B=0 THEN SORT F$,K; GOTO 2480
2440 DIRECT F$,K,R,B
2450 REM "Get file defaults if applicable
2455 IF F1$(58,16)<>S$(1,16) THEN GOSUB 3200
2480 SETERR 9000
2485 REM "
2490 READ (Z[2],KEY=F1$(1,16))
2495 GOTO 2020
2500 REM "Done with file definition
2550 CALL "ZZPROM",".4",X3$,0,"Action completed: "+X$,"","",0; GOTO 9900
2590 GOTO 9900
2600 REM "ERASE FILE
2620 IF LEN(F$)>3 AND F$(4,3)=C0$ THEN ERASE F$,ERR=2621; GOTO 2620
2680 GOTO 2485
3000 REM "Get number of records for this file
3005 R=0,F2=0; IF F1$(74,16)<>S$(1,16) THEN GOTO 3100
3020 IF S0=1 THEN R=S[0]
3025 IF S0=2 THEN R=S[1]; IF R=0 THEN R=S[0]
3030 IF S0=3 THEN R=S[2]; IF R=0 THEN R=S[1]; IF R=0 THEN R=S[0]
3045 IF R=0 THEN R=F1
3050 REM 
3095 RETURN 
3100 REM "Get number of records in another file
3120 Q$=F1$(74,16),P=POS("*"=Q$),F2=1; IF P>0 THEN F2=NUM(Q$(1,P-1)),Q$=Q$(P+1); IF F2=0 THEN F2=1
3125 Q$=Q$+S$,Q$=Q$(1,16); READ (Z[2],KEY=Q$,DOM=3180)*,S[0],S[1],S[2]; FOR X=0 TO 2; S[X]=S[X]*F2; NEXT X; GOTO 3010
3180 REM "
3185 CALL "ZZPROM",".4",X3$,0,"Problem getting number of records - using defaults","","",0
3190 GOTO 3010
3200 REM "Copy defaults file into new file
3205 PRINT @(0,19),'CE',"Copying default data for ",F$,": ",
3210 CLOSE (14); OPEN (14,ERR=3280)FNS$(F1$(58,16))
3215 Z$="04O "+F$; GOSUB 9750; ON Z0 GOTO 3216,3280
3220 K$=KEY(14,END=3250); READ RECORD (14)Q$
3221 Z9=POS("%%%"=K$); IF Z9>0 THEN K$(Z9,3)=C0$,Q$(Z9,3)=C0$
3222 IF X3$(9,3)="144" THEN IF LEN(K$)>5 THEN IF K$(4,6)="A/R" THEN Q$(89,7)=C0$+"0000"; REM "For PFG, default next invoice number to company code + 4 0's
3223 PRINT @(45,19),K$,
3224 IF F$="ZZPARMDF" THEN INPUT "WAIT",*
3225 WRITE RECORD (Z[4],KEY=K$)Q$; GOTO 3230
3240 GOTO 3220
3250 Z$="04C "+F$; GOSUB 9750
3255 PRINT @(0,19),'CE',
3260 RETURN 
3280 CALL "ZZPROM",".4",X3$,0,F$+": Unable to copy file data defaults: "+FNS$(F1$(58,16)),"","",0
3290 RETURN 
5200 REM "INITIALIZE INDEXED FILE
5205 SETERR 9000
5210 CLOSE (14); OPEN (14)F$
5220 CALL "ZZINIT","14"
5290 RETURN 
7000 REM "ERROR ON FILE DEFINITION
7010 E0=ERR,X$="+("+F$+", "+STR(E0)+", "+STR(TCB(5))+")",Q$="X2"
7030 IF E0=15 THEN Q$="X3"
7035 IF E0=12 THEN GOTO 7200
7070 CALL "ZZPROM",Q$+"ZZ2SYS",X3$,A,X$,"","",0; ON A GOTO 7080,2485,9700
7200 REM "ASK IF REPLACE FILE
7220 CALL "ZZPROM","X4ZZ2SYS",X3$,A,X$,"","",0; ON A GOTO 2485,7250,9700
7240 ON A GOTO 7250,2485,9700
7250 ERASE F$,ERR=7255; GOTO 7250
7255 IF ERR=0 THEN Q$="X5",X$="+( "+F$+")"; GOTO 7270
7260 GOTO 2300
7270 IF ERR=0 THEN GOTO 7070 ELSE GOTO 7010
7900 REM "DELETE FILES CREATED
7990 GOTO 9900
8910 DEF FNS$(Z9$)=Z9$(1,POS(S$=Z9$+S$)-1)
9000 REM "ERROR PROCESSING
9010 Y5=ERR,Y6=TCB(5); IF Y5=68 OR Y5=69 THEN GOTO 9500
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9045 REM 
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9055 REM 
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9120 ON Y8 GOTO 9900,0990,9920
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9750 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},0,0
9790 RETURN 
9800 REM "Abort
9810 CALL "ZZPROM",".4",X3$,0,"No files were defined","","",0
9820 GOTO 9900
9900 REM "END PROGRAM
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9915 IF %GUI THEN PRINT 'POP'
9920 SETERR 9940
9930 Q1$=A1$; EXIT 
9940 SETESC 9350
9950 EXIT 
9999 END 
