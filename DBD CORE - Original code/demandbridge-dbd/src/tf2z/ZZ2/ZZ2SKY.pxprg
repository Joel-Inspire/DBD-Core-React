0010 REM "Update Sort Key Files <ZZ2SKY>
0020 SETESC 9300; SETERR 9000
0035 REM "3.9 - 02/03/96 - 11.95 - wmz
0040 REM "Copyright 1996 Computer Software Inc.; Norcross, Georgia
0041 REM "        Licensed Software - All Rights Reserved.
0048 REM "F$ - Source file
0050 REM "T$ - A=add, D=delete just passed sort keys, DALL=delete all sort keys (none supplied)
0052 REM "A$ - new string being written to file
0054 REM "A1$ - primary key
0090 CLEAR ; SETERR 0100; ENTER X3$,X4$,F$,T$,A$,A1$,B2$,B3$,B4$,B5$,B6$,B7$,B8$,B9$
0100 SETERR 9000
0110 X0$="ZZ2SKY"
0200 REM "Generalize routine so all sort keys to file can be done in the future
0205 REM "B(x,0)=beginning postion of Bx$ in A$ string, B(x,1)=length, B(x,2)=postion within string of Keys K$ , B(x,3)= length of field passed (should be same as B(x,1))
0210 DIM B[9,3]; K=1,K9$=A1$
0220 IF F$="AR1" THEN GOSUB 7700; GOTO 0400
0230 IF F$="FM0C" THEN GOSUB 7800; GOTO 0400
0390 GOTO 9900
0400 REM "
0410 IF Z$="" THEN GOTO 9900
0500 REM "FILES
0505 DIM Z[NUM(X3$(60,3))]
0520 CALL "ZZFLES",X3$,Y1$,Y0$,Z$,Z{ALL},Z0,Z1; ON Z0 GOTO 0521,9900
0990 IF T$(1,1)="D" THEN GOTO 2000
1000 REM "WRITE SORT RECORDS
1020 FOR I=2 TO 9
1040 IF B[I,0]=0 THEN GOTO 1300
1050 IF K$(B[I,2],B[I,3])=A$(B[I,0],B[I,1]) THEN GOTO 1300
1070 C1$=""; IF F$="AR1" AND I=7 THEN DIM C1$(4)
1175 REM PRINT 'CS'," T$=",T$," F$=",F$," Z$=",Z$," I=",I," Z(I)=",Z(I)," K$=",K$," HTA(K$)=",HTA(K$)," B(I,2)=",B(I,2)," B(I,3)=",B(I,3)," B(I,0)=",B(I,0)," B(I,1)=",B(I,1)," K9$=",K9$," C1$=",C1$,'LF',; INPUT *,
1180 IF K$(B[I,2],B[I,3])<>$FF$ THEN REMOVE (Z[I],KEY=K$(B[I,2],B[I,3])+K9$+C1$,DOM=1181)
1200 WRITE (Z[I],KEY=A$(B[I,0],B[I,1])+K9$+C1$)
1300 NEXT I
1900 GOTO 9900
2000 REM "DELETE SORT RECORDS
2020 FOR I=2 TO 9
2025 IF B[I,0]=0 THEN GOTO 2260
2030 C1$=""; IF F$="AR1" AND I=7 THEN DIM C1$(4)
2240 IF K$(B[I,2],B[I,3])<>$FF$ THEN REMOVE (Z[I],KEY=K$(B[I,2],B[I,3])+K9$+C1$,DOM=2241)
2250 IF T$="DALL" THEN REMOVE (Z[I],KEY=A$(B[I,0],B[I,1])+K9$+C1$,DOM=2251)
2260 NEXT I
2290 GOTO 9900
7500 REM "Build string of passed values
7505 IF I$="" THEN K$=$FF$
7510 B[I,2]=K,K$=K$+I$
7520 I1=LEN(I$),B[I,3]=I1,K=K+I1
7540 RETURN 
7600 REM "Allow for coming from ship to
7700 REM "Customer Master File AR1 - Only B7$ passed for now
7720 Z$=Z$+"02O ARE...  ",B[2,0]=155,B[2,1]=10,I=2,I$=B2$; GOSUB 7500; REM "SORT BY LOOKUP
7770 Z$=Z$+"07O ASH...  ",B[7,0]=134,B[7,1]=9,I=7,I$=B7$; GOSUB 7500
7795 RETURN 
7800 REM "Customer Ship-To File FM0 - "C" types  - Only B7$ passed for now
7870 Z$=Z$+"07O ASH...  ",B[7,0]=129,B[7,1]=9,I=7,I$=B7$; GOSUB 7500
7895 RETURN 
9000 REM "ERROR PROCESSING
9005 IF ERR=69 THEN GOTO 9500
9010 Y5=ERR,Y6=TCB(5)
9015 SETERR 9016; Y8$=LST(PGM(Y6))
9016 SETERR 9000
9040 CALL "ZZERRM",Y8$,X0$,Y7$,X3$,Y5,Y6,Y7,Y8,0
9050 ON Y7 GOTO 9060,9100,9800,9070,9090
9060 RETRY 
9070 SETERR 9080
9075 EXECUTE Y7$
9080 SETERR 9000; RETRY 
9090 SETERR 0000; RETRY 
9100 REM " TRANSFER CONTROL
9180 GOTO 0990
9190 GOTO 9800
9300 SETESC 9350
9310 SETERR 9350
9315 IF X3$(47,1)="N" THEN RETURN ELSE SETESC 0000; RETURN 
9350 SETERR 9000; RETURN 
9900 REM "END PROGRAM
9905 PRINT @(0,22),'CL',
9910 CALL "ZZFLES",X3$,Y1$,Y0$,"END",Z{ALL},0,0
9930 SETERR 9940; EXIT 
9940 SETESC 9350
9950 RUN "ZMENU"
9999 END 
